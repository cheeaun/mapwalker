var T=Object.defineProperty,D=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var I=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,O=(t,e)=>{for(var i in e||(e={}))B.call(e,i)&&I(t,i,e[i]);if(j)for(var i of j(e))V.call(e,i)&&I(t,i,e[i]);return t},F=(t,e)=>D(t,M(e));import{j as z,a as K,F as J,s as b,l as E,y as _,M as x,A as U,N as X,G as Z,S as C,L as w,b as G,u as $,c as H,d as Y}from"./vendor.977f75c3.js";const W=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))h(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&h(d)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function h(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}};W();const{VITE_ORS_API_KEY:q}={VITE_MAPBOX_ACCESS_TOKEN:"",VITE_ORS_API_KEY:"",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0},k={OSM_DE:(t,e)=>`https://routing.openstreetmap.de/routed-foot/route/v1/driving/${t.join(",")};${e.join(",")}`,ORS:()=>"https://api.openrouteservice.org/v2/directions/foot-hiking/geojson",GHOP:()=>"https://graphhopper.com/api/1/route"},Q=async(t,e,i)=>{var y,p,S;const h=fetch(k.OSM_DE(t,e)+"?"+new URLSearchParams(O({geometries:"geojson",overview:"full",continue_straight:!1},i))).then(c=>c.json()).catch(c=>{}),n=fetch(k.ORS(),{method:"POST",headers:{"Content-Type":"application/json",Authorization:q},body:JSON.stringify({coordinates:[t,e],instructions:!1})}).then(c=>c.json()).catch(c=>{}),a=new URLSearchParams({vehicle:"foot",key:"LijBPDQGfu7Iiq80w3HzwB4RUDJbMbhs6BU0dEnn",instructions:!0,points_encoded:!1,point:[...t].reverse().join(",")});a.append("point",[...e].reverse().join(","));const d=fetch(k.GHOP()+"?"+a).then(c=>c.json()).catch(c=>{}),[g,u,m]=await Promise.all([h,n,d]);return console.log({response1:g,response2:u,response3:m}),{type:"FeatureCollection",features:[{type:"Feature",geometry:(y=g==null?void 0:g.routes[0])==null?void 0:y.geometry,properties:{index:0,provider:"osm-de"}},{type:"Feature",geometry:(p=u==null?void 0:u.features[0])==null?void 0:p.geometry,properties:{index:1,provider:"ors"}},{type:"Feature",geometry:(S=m==null?void 0:m.paths[0])==null?void 0:S.points,properties:{index:2,provider:"graphhopper"}}]}};var f={get:t=>{try{return JSON.parse(localStorage.getItem(LS_PREFIX+t))}catch{return null}},set:(t,e)=>{try{e?localStorage.setItem(LS_PREFIX+t,JSON.stringify(e)):localStorage.removeItem(LS_PREFIX+t)}catch{}},del:t=>{try{localStorage.removeItem(LS_PREFIX+t)}catch{}}};const r=z,v=K,N=J,{VITE_MAPBOX_ACCESS_TOKEN:P}={VITE_MAPBOX_ACCESS_TOKEN:"",VITE_ORS_API_KEY:"",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0},ee=2;function te(t){return $(()=>new H(t),{position:t.position}),null}const R={type:"FeatureCollection",features:[]};function oe(){const t=b(),e=b(),i=b(),[h,n]=E(!1),a=b(),[d,g]=E(R),[u,m]=E(f.get("walk-route")||null);_(()=>{f.set("walk-route",u)},[u]);const[o,y]=E(f.get("destination-marker")||null);_(()=>{f.set("destination-marker",o)},[o]);const[p,S]=E(f.get("marker-pinned")||!1);_(()=>{f.set("marker-pinned",p)},[p]);const c={walkRoute:{layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#0e90df","line-opacity":.75,"line-width":["interpolate",["linear"],["zoom"],15,4,18,12],"line-dasharray":[0,2]}}};return v(N,{children:[r("div",{id:"map",children:v(x,{ref:t,mapboxAccessToken:P,mapStyle:"mapbox://styles/cheeaun/cl0ds1jbz003014px6nthvdle/draft",initialViewState:f.get("view-state")||{center:[103.8198,1.3521]},boxZoom:!1,renderWorldCopies:!1,maxZoom:21,attributionControl:!1,logoPosition:"top-right",onLoad:l=>{var s;(s=a.current)==null||s.trigger()},onMoveStart:()=>{e.current.hidden||e.current.classList.add("faded")},onMoveEnd:l=>{e.current.hidden||(e.current.classList.remove("faded"),f.set("view-state",l.viewState))},onMove:l=>{var A;const{viewState:s}=l,L=s.zoom<16;e.current.hidden=L,L||(A=i.current)==null||A.jumpTo(F(O({},s),{center:[s.longitude,s.latitude],zoom:s.zoom-ee}))},onClick:l=>{if(o)return;const{lngLat:s}=l;y(s)},children:[r(U,{position:"top-right",compact:!0}),r(te,{accessToken:P,marker:!1,clearAndBlurOnSelect:!0,collapsed:!0,position:"top-left"}),r(X,{visualizePitch:!0,position:"top-right"}),r(Z,{ref:a,fitBoundsOptions:{zoom:17},positionOptions:{enableHighAccuracy:!0,timeout:3e3},trackUserLocation:!0,showUserLocation:!0,position:"top-right",onGeolocate:l=>{console.log({onGeolocate:l});const{coords:s}=l;g({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[s.longitude,s.latitude]}}]})}}),r(C,{id:"walk-route",type:"geojson",data:u||R,children:r(w,O({id:"walk-route",type:"line"},c.walkRoute))}),r(G,{anchor:"bottom",draggable:!p,longitude:(o==null?void 0:o.lng)||0,latitude:(o==null?void 0:o.lat)||0,onDragEnd:l=>{const{lngLat:s}=l;y(s)},children:r("img",{src:"../assets/pin.png",width:"18",hidden:!o})})]})}),r("div",{id:"overview-map",ref:e,hidden:!0,children:v(x,{ref:i,mapboxAccessToken:P,mapStyle:"mapbox://styles/cheeaun/cl0ds1jbz003014px6nthvdle/draft",initialViewState:{center:[103.8198,1.3521],zoom:11},attributionControl:!1,interactive:!1,maxZoom:16,minZoom:14.5,children:[r(C,{id:"walk-route",type:"geojson",data:u||R,children:r(w,O({id:"walk-route",type:"line"},c.walkRoute))}),v(C,{id:"geolocation",type:"geojson",data:d,children:[r(w,{id:"geolocation-outer",type:"circle",paint:{"circle-radius":5,"circle-color":"#1ea1f1"}}),r(w,{id:"geolocation-inner",type:"circle",paint:{"circle-radius":3,"circle-color":"#1ea1f1","circle-stroke-width":1,"circle-stroke-color":"#fff"}})]}),r(G,{anchor:"bottom",longitude:(o==null?void 0:o.lng)||0,latitude:(o==null?void 0:o.lat)||0,children:r("img",{src:"../assets/pin.png",width:"10",hidden:!o})})]})}),v("div",{id:"actions",children:[h&&r("div",{class:"loading"}),o?v(N,{children:[r("button",{type:"button",onClick:()=>{y(null),S(!1)},title:"Remove marker",children:"\u274C"}),r("button",{type:"button",onClick:()=>{S(!p)},class:p?"":"faded",title:p?"Unpin marker":"Pin marker",children:"\u{1F4CC}"}),r("button",{type:"button",onClick:()=>{var l;(l=t.current)==null||l.flyTo({center:o})},title:"Fly to marker",children:"\u{1F50D}"}),r("button",{type:"button",onClick:async()=>{n(!0),console.log({geolocationGeoJSON:d,destinationMarker:o});const l=await Q(d.features[0].geometry.coordinates,[o.lng,o.lat]);m(l),n(!1),S(!0)},title:"Generate route to marker",children:"\u{1F503}"})]}):!!u&&r("button",{type:"button",onClick:()=>{m(null)},title:"Clear route",children:"\u274C\u{1F504}"})]})]})}Y(r(oe,{}),document.getElementById("app"));
