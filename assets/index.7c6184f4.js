var X1=Object.defineProperty,K1=Object.defineProperties;var Y1=Object.getOwnPropertyDescriptors;var Ag=Object.getOwnPropertySymbols;var J1=Object.prototype.hasOwnProperty,Q1=Object.prototype.propertyIsEnumerable;var Cg=(l,s,f)=>s in l?X1(l,s,{enumerable:!0,configurable:!0,writable:!0,value:f}):l[s]=f,wi=(l,s)=>{for(var f in s||(s={}))J1.call(s,f)&&Cg(l,f,s[f]);if(Ag)for(var f of Ag(s))Q1.call(s,f)&&Cg(l,f,s[f]);return l},dr=(l,s)=>K1(l,Y1(s));function eb(l,s){return s.forEach(function(f){f&&typeof f!="string"&&!Array.isArray(f)&&Object.keys(f).forEach(function(m){if(m!=="default"&&!(m in l)){var x=Object.getOwnPropertyDescriptor(f,m);Object.defineProperty(l,m,x.get?x:{enumerable:!0,get:function(){return f[m]}})}})}),Object.freeze(Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}))}const tb=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))m(x);new MutationObserver(x=>{for(const T of x)if(T.type==="childList")for(const k of T.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&m(k)}).observe(document,{childList:!0,subtree:!0});function f(x){const T={};return x.integrity&&(T.integrity=x.integrity),x.referrerpolicy&&(T.referrerPolicy=x.referrerpolicy),x.crossorigin==="use-credentials"?T.credentials="include":x.crossorigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function m(x){if(x.ep)return;x.ep=!0;const T=f(x);fetch(x.href,T)}};tb();var wu,Tt,iv,rv,ru,nv,Mg,ov,Td={},av=[],ib=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function Ko(l,s){for(var f in s)l[f]=s[f];return l}function sv(l){var s=l.parentNode;s&&s.removeChild(l)}function Mn(l,s,f){var m,x,T,k={};for(T in s)T=="key"?m=s[T]:T=="ref"?x=s[T]:k[T]=s[T];if(arguments.length>2&&(k.children=arguments.length>3?wu.call(arguments,2):f),typeof l=="function"&&l.defaultProps!=null)for(T in l.defaultProps)k[T]===void 0&&(k[T]=l.defaultProps[T]);return nu(l,k,m,x,null)}function nu(l,s,f,m,x){var T={type:l,props:s,key:f,ref:m,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:x==null?++iv:x};return x==null&&Tt.vnode!=null&&Tt.vnode(T),T}function lv(){return{current:null}}function Yo(l){return l.children}function mo(l,s){this.props=l,this.context=s}function Rl(l,s){if(s==null)return l.__?Rl(l.__,l.__.__k.indexOf(l)+1):null;for(var f;s<l.__k.length;s++)if((f=l.__k[s])!=null&&f.__e!=null)return f.__e;return typeof l.type=="function"?Rl(l):null}function cv(l){var s,f;if((l=l.__)!=null&&l.__c!=null){for(l.__e=l.__c.base=null,s=0;s<l.__k.length;s++)if((f=l.__k[s])!=null&&f.__e!=null){l.__e=l.__c.base=f.__e;break}return cv(l)}}function kp(l){(!l.__d&&(l.__d=!0)&&ru.push(l)&&!Sd.__r++||Mg!==Tt.debounceRendering)&&((Mg=Tt.debounceRendering)||nv)(Sd)}function Sd(){for(var l;Sd.__r=ru.length;)l=ru.sort(function(s,f){return s.__v.__b-f.__v.__b}),ru=[],l.some(function(s){var f,m,x,T,k,o;s.__d&&(k=(T=(f=s).__v).__e,(o=f.__P)&&(m=[],(x=Ko({},T)).__v=T.__v+1,im(o,T,x,f.__n,o.ownerSVGElement!==void 0,T.__h!=null?[k]:null,m,k==null?Rl(T):k,T.__h),fv(m,T),T.__e!=k&&cv(T)))})}function uv(l,s,f,m,x,T,k,o,N,U){var V,F,Y,$,ye,be,Ue,Ge=m&&m.__k||av,S=Ge.length;for(f.__k=[],V=0;V<s.length;V++)if(($=f.__k[V]=($=s[V])==null||typeof $=="boolean"?null:typeof $=="string"||typeof $=="number"||typeof $=="bigint"?nu(null,$,null,null,$):Array.isArray($)?nu(Yo,{children:$},null,null,null):$.__b>0?nu($.type,$.props,$.key,null,$.__v):$)!=null){if($.__=f,$.__b=f.__b+1,(Y=Ge[V])===null||Y&&$.key==Y.key&&$.type===Y.type)Ge[V]=void 0;else for(F=0;F<S;F++){if((Y=Ge[F])&&$.key==Y.key&&$.type===Y.type){Ge[F]=void 0;break}Y=null}im(l,$,Y=Y||Td,x,T,k,o,N,U),ye=$.__e,(F=$.ref)&&Y.ref!=F&&(Ue||(Ue=[]),Y.ref&&Ue.push(Y.ref,null,$),Ue.push(F,$.__c||ye,$)),ye!=null?(be==null&&(be=ye),typeof $.type=="function"&&$.__k===Y.__k?$.__d=N=hv($,N,l):N=dv(l,$,Y,Ge,ye,N),typeof f.type=="function"&&(f.__d=N)):N&&Y.__e==N&&N.parentNode!=l&&(N=Rl(Y))}for(f.__e=be,V=S;V--;)Ge[V]!=null&&(typeof f.type=="function"&&Ge[V].__e!=null&&Ge[V].__e==f.__d&&(f.__d=Rl(m,V+1)),mv(Ge[V],Ge[V]));if(Ue)for(V=0;V<Ue.length;V++)pv(Ue[V],Ue[++V],Ue[++V])}function hv(l,s,f){for(var m,x=l.__k,T=0;x&&T<x.length;T++)(m=x[T])&&(m.__=l,s=typeof m.type=="function"?hv(m,s,f):dv(f,m,m,x,m.__e,s));return s}function Bo(l,s){return s=s||[],l==null||typeof l=="boolean"||(Array.isArray(l)?l.some(function(f){Bo(f,s)}):s.push(l)),s}function dv(l,s,f,m,x,T){var k,o,N;if(s.__d!==void 0)k=s.__d,s.__d=void 0;else if(f==null||x!=T||x.parentNode==null)e:if(T==null||T.parentNode!==l)l.appendChild(x),k=null;else{for(o=T,N=0;(o=o.nextSibling)&&N<m.length;N+=2)if(o==x)break e;l.insertBefore(x,T),k=T}return k!==void 0?k:x.nextSibling}function rb(l,s,f,m,x){var T;for(T in f)T==="children"||T==="key"||T in s||Ed(l,T,null,f[T],m);for(T in s)x&&typeof s[T]!="function"||T==="children"||T==="key"||T==="value"||T==="checked"||f[T]===s[T]||Ed(l,T,s[T],f[T],m)}function Ig(l,s,f){s[0]==="-"?l.setProperty(s,f):l[s]=f==null?"":typeof f!="number"||ib.test(s)?f:f+"px"}function Ed(l,s,f,m,x){var T;e:if(s==="style")if(typeof f=="string")l.style.cssText=f;else{if(typeof m=="string"&&(l.style.cssText=m=""),m)for(s in m)f&&s in f||Ig(l.style,s,"");if(f)for(s in f)m&&f[s]===m[s]||Ig(l.style,s,f[s])}else if(s[0]==="o"&&s[1]==="n")T=s!==(s=s.replace(/Capture$/,"")),s=s.toLowerCase()in l?s.toLowerCase().slice(2):s.slice(2),l.l||(l.l={}),l.l[s+T]=f,f?m||l.addEventListener(s,T?zg:kg,T):l.removeEventListener(s,T?zg:kg,T);else if(s!=="dangerouslySetInnerHTML"){if(x)s=s.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(s!=="href"&&s!=="list"&&s!=="form"&&s!=="tabIndex"&&s!=="download"&&s in l)try{l[s]=f==null?"":f;break e}catch{}typeof f=="function"||(f!=null&&(f!==!1||s[0]==="a"&&s[1]==="r")?l.setAttribute(s,f):l.removeAttribute(s))}}function kg(l){this.l[l.type+!1](Tt.event?Tt.event(l):l)}function zg(l){this.l[l.type+!0](Tt.event?Tt.event(l):l)}function im(l,s,f,m,x,T,k,o,N){var U,V,F,Y,$,ye,be,Ue,Ge,S,we,Le=s.type;if(s.constructor!==void 0)return null;f.__h!=null&&(N=f.__h,o=s.__e=f.__e,s.__h=null,T=[o]),(U=Tt.__b)&&U(s);try{e:if(typeof Le=="function"){if(Ue=s.props,Ge=(U=Le.contextType)&&m[U.__c],S=U?Ge?Ge.props.value:U.__:m,f.__c?be=(V=s.__c=f.__c).__=V.__E:("prototype"in Le&&Le.prototype.render?s.__c=V=new Le(Ue,S):(s.__c=V=new mo(Ue,S),V.constructor=Le,V.render=ob),Ge&&Ge.sub(V),V.props=Ue,V.state||(V.state={}),V.context=S,V.__n=m,F=V.__d=!0,V.__h=[]),V.__s==null&&(V.__s=V.state),Le.getDerivedStateFromProps!=null&&(V.__s==V.state&&(V.__s=Ko({},V.__s)),Ko(V.__s,Le.getDerivedStateFromProps(Ue,V.__s))),Y=V.props,$=V.state,F)Le.getDerivedStateFromProps==null&&V.componentWillMount!=null&&V.componentWillMount(),V.componentDidMount!=null&&V.__h.push(V.componentDidMount);else{if(Le.getDerivedStateFromProps==null&&Ue!==Y&&V.componentWillReceiveProps!=null&&V.componentWillReceiveProps(Ue,S),!V.__e&&V.shouldComponentUpdate!=null&&V.shouldComponentUpdate(Ue,V.__s,S)===!1||s.__v===f.__v){V.props=Ue,V.state=V.__s,s.__v!==f.__v&&(V.__d=!1),V.__v=s,s.__e=f.__e,s.__k=f.__k,s.__k.forEach(function(Ze){Ze&&(Ze.__=s)}),V.__h.length&&k.push(V);break e}V.componentWillUpdate!=null&&V.componentWillUpdate(Ue,V.__s,S),V.componentDidUpdate!=null&&V.__h.push(function(){V.componentDidUpdate(Y,$,ye)})}V.context=S,V.props=Ue,V.state=V.__s,(U=Tt.__r)&&U(s),V.__d=!1,V.__v=s,V.__P=l,U=V.render(V.props,V.state,V.context),V.state=V.__s,V.getChildContext!=null&&(m=Ko(Ko({},m),V.getChildContext())),F||V.getSnapshotBeforeUpdate==null||(ye=V.getSnapshotBeforeUpdate(Y,$)),we=U!=null&&U.type===Yo&&U.key==null?U.props.children:U,uv(l,Array.isArray(we)?we:[we],s,f,m,x,T,k,o,N),V.base=s.__e,s.__h=null,V.__h.length&&k.push(V),be&&(V.__E=V.__=null),V.__e=!1}else T==null&&s.__v===f.__v?(s.__k=f.__k,s.__e=f.__e):s.__e=nb(f.__e,s,f,m,x,T,k,N);(U=Tt.diffed)&&U(s)}catch(Ze){s.__v=null,(N||T!=null)&&(s.__e=o,s.__h=!!N,T[T.indexOf(o)]=null),Tt.__e(Ze,s,f)}}function fv(l,s){Tt.__c&&Tt.__c(s,l),l.some(function(f){try{l=f.__h,f.__h=[],l.some(function(m){m.call(f)})}catch(m){Tt.__e(m,f.__v)}})}function nb(l,s,f,m,x,T,k,o){var N,U,V,F=f.props,Y=s.props,$=s.type,ye=0;if($==="svg"&&(x=!0),T!=null){for(;ye<T.length;ye++)if((N=T[ye])&&"setAttribute"in N==!!$&&($?N.localName===$:N.nodeType===3)){l=N,T[ye]=null;break}}if(l==null){if($===null)return document.createTextNode(Y);l=x?document.createElementNS("http://www.w3.org/2000/svg",$):document.createElement($,Y.is&&Y),T=null,o=!1}if($===null)F===Y||o&&l.data===Y||(l.data=Y);else{if(T=T&&wu.call(l.childNodes),U=(F=f.props||Td).dangerouslySetInnerHTML,V=Y.dangerouslySetInnerHTML,!o){if(T!=null)for(F={},ye=0;ye<l.attributes.length;ye++)F[l.attributes[ye].name]=l.attributes[ye].value;(V||U)&&(V&&(U&&V.__html==U.__html||V.__html===l.innerHTML)||(l.innerHTML=V&&V.__html||""))}if(rb(l,Y,F,x,o),V)s.__k=[];else if(ye=s.props.children,uv(l,Array.isArray(ye)?ye:[ye],s,f,m,x&&$!=="foreignObject",T,k,T?T[0]:f.__k&&Rl(f,0),o),T!=null)for(ye=T.length;ye--;)T[ye]!=null&&sv(T[ye]);o||("value"in Y&&(ye=Y.value)!==void 0&&(ye!==l.value||$==="progress"&&!ye||$==="option"&&ye!==F.value)&&Ed(l,"value",ye,F.value,!1),"checked"in Y&&(ye=Y.checked)!==void 0&&ye!==l.checked&&Ed(l,"checked",ye,F.checked,!1))}return l}function pv(l,s,f){try{typeof l=="function"?l(s):l.current=s}catch(m){Tt.__e(m,f)}}function mv(l,s,f){var m,x;if(Tt.unmount&&Tt.unmount(l),(m=l.ref)&&(m.current&&m.current!==l.__e||pv(m,null,s)),(m=l.__c)!=null){if(m.componentWillUnmount)try{m.componentWillUnmount()}catch(T){Tt.__e(T,s)}m.base=m.__P=null}if(m=l.__k)for(x=0;x<m.length;x++)m[x]&&mv(m[x],s,typeof l.type!="function");f||l.__e==null||sv(l.__e),l.__e=l.__d=void 0}function ob(l,s,f){return this.constructor(l,f)}function ys(l,s,f){var m,x,T;Tt.__&&Tt.__(l,s),x=(m=typeof f=="function")?null:f&&f.__k||s.__k,T=[],im(s,l=(!m&&f||s).__k=Mn(Yo,null,[l]),x||Td,Td,s.ownerSVGElement!==void 0,!m&&f?[f]:x?null:s.firstChild?wu.call(s.childNodes):null,T,!m&&f?f:x?x.__e:s.firstChild,m),fv(T,l)}function rm(l,s){ys(l,s,rm)}function _v(l,s,f){var m,x,T,k=Ko({},l.props);for(T in s)T=="key"?m=s[T]:T=="ref"?x=s[T]:k[T]=s[T];return arguments.length>2&&(k.children=arguments.length>3?wu.call(arguments,2):f),nu(l.type,k,m||l.key,x||l.ref,null)}function Ud(l,s){var f={__c:s="__cC"+ov++,__:l,Consumer:function(m,x){return m.children(x)},Provider:function(m){var x,T;return this.getChildContext||(x=[],(T={})[s]=this,this.getChildContext=function(){return T},this.shouldComponentUpdate=function(k){this.props.value!==k.value&&x.some(kp)},this.sub=function(k){x.push(k);var o=k.componentWillUnmount;k.componentWillUnmount=function(){x.splice(x.indexOf(k),1),o&&o.call(k)}}),m.children}};return f.Provider.__=f.Consumer.contextType=f}wu=av.slice,Tt={__e:function(l,s,f,m){for(var x,T,k;s=s.__;)if((x=s.__c)&&!x.__)try{if((T=x.constructor)&&T.getDerivedStateFromError!=null&&(x.setState(T.getDerivedStateFromError(l)),k=x.__d),x.componentDidCatch!=null&&(x.componentDidCatch(l,m||{}),k=x.__d),k)return x.__E=x}catch(o){l=o}throw l}},iv=0,rv=function(l){return l!=null&&l.constructor===void 0},mo.prototype.setState=function(l,s){var f;f=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=Ko({},this.state),typeof l=="function"&&(l=l(Ko({},f),this.props)),l&&Ko(f,l),l!=null&&this.__v&&(s&&this.__h.push(s),kp(this))},mo.prototype.forceUpdate=function(l){this.__v&&(this.__e=!0,l&&this.__h.push(l),kp(this))},mo.prototype.render=Yo,ru=[],nv=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Sd.__r=0,ov=0;var ab=Object.freeze(Object.defineProperty({__proto__:null,render:ys,hydrate:rm,createElement:Mn,h:Mn,Fragment:Yo,createRef:lv,get isValidElement(){return rv},Component:mo,cloneElement:_v,createContext:Ud,toChildArray:Bo,get options(){return Tt}},Symbol.toStringTag,{value:"Module"}));const sb="modulepreload",Pg={},lb="./",cb=function(s,f){return!f||f.length===0?s():Promise.all(f.map(m=>{if(m=`${lb}${m}`,m in Pg)return;Pg[m]=!0;const x=m.endsWith(".css"),T=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${T}`))return;const k=document.createElement("link");if(k.rel=x?"stylesheet":sb,x||(k.as="script",k.crossOrigin=""),k.href=m,document.head.appendChild(k),x)return new Promise((o,N)=>{k.addEventListener("load",o),k.addEventListener("error",()=>N(new Error(`Unable to preload CSS for ${m}`)))})})).then(()=>s())};var Vl,fn,Dg,Bl=0,gv=[],Lg=Tt.__b,Rg=Tt.__r,Bg=Tt.diffed,Og=Tt.__c,Fg=Tt.unmount;function Tu(l,s){Tt.__h&&Tt.__h(fn,l,Bl||s),Bl=0;var f=fn.__H||(fn.__H={__:[],__h:[]});return l>=f.__.length&&f.__.push({}),f.__[l]}function Ri(l){return Bl=1,yv(vv,l)}function yv(l,s,f){var m=Tu(Vl++,2);return m.t=l,m.__c||(m.__=[f?f(s):vv(void 0,s),function(x){var T=m.t(m.__[0],x);m.__[0]!==T&&(m.__=[T,m.__[1]],m.__c.setState({}))}],m.__c=fn),m.__}function Jt(l,s){var f=Tu(Vl++,3);!Tt.__s&&nm(f.__H,s)&&(f.__=l,f.__H=s,fn.__H.__h.push(f))}function xs(l,s){var f=Tu(Vl++,4);!Tt.__s&&nm(f.__H,s)&&(f.__=l,f.__H=s,fn.__h.push(f))}function vt(l){return Bl=5,Gr(function(){return{current:l}},[])}function Nl(l,s,f){Bl=6,xs(function(){return typeof l=="function"?(l(s()),function(){return l(null)}):l?(l.current=s(),function(){return l.current=null}):void 0},f==null?f:f.concat(l))}function Gr(l,s){var f=Tu(Vl++,7);return nm(f.__H,s)&&(f.__=l(),f.__H=s,f.__h=l),f.__}function Yt(l,s){return Bl=8,Gr(function(){return l},s)}function bs(l){var s=fn.context[l.__c],f=Tu(Vl++,9);return f.c=l,s?(f.__==null&&(f.__=!0,s.sub(fn)),s.props.value):l.__}function Xo(l,s){Tt.useDebugValue&&Tt.useDebugValue(s?s(l):l)}function ub(){for(var l;l=gv.shift();)if(l.__P)try{l.__H.__h.forEach(_d),l.__H.__h.forEach(zp),l.__H.__h=[]}catch(s){l.__H.__h=[],Tt.__e(s,l.__v)}}Tt.__b=function(l){fn=null,Lg&&Lg(l)},Tt.__r=function(l){Rg&&Rg(l),Vl=0;var s=(fn=l.__c).__H;s&&(s.__h.forEach(_d),s.__h.forEach(zp),s.__h=[])},Tt.diffed=function(l){Bg&&Bg(l);var s=l.__c;s&&s.__H&&s.__H.__h.length&&(gv.push(s)!==1&&Dg===Tt.requestAnimationFrame||((Dg=Tt.requestAnimationFrame)||function(f){var m,x=function(){clearTimeout(T),Ug&&cancelAnimationFrame(m),setTimeout(f)},T=setTimeout(x,100);Ug&&(m=requestAnimationFrame(x))})(ub)),fn=null},Tt.__c=function(l,s){s.some(function(f){try{f.__h.forEach(_d),f.__h=f.__h.filter(function(m){return!m.__||zp(m)})}catch(m){s.some(function(x){x.__h&&(x.__h=[])}),s=[],Tt.__e(m,f.__v)}}),Og&&Og(l,s)},Tt.unmount=function(l){Fg&&Fg(l);var s,f=l.__c;f&&f.__H&&(f.__H.__.forEach(function(m){try{_d(m)}catch(x){s=x}}),s&&Tt.__e(s,f.__v))};var Ug=typeof requestAnimationFrame=="function";function _d(l){var s=fn,f=l.__c;typeof f=="function"&&(l.__c=void 0,f()),fn=s}function zp(l){var s=fn;l.__c=l.__(),fn=s}function nm(l,s){return!l||l.length!==s.length||s.some(function(f,m){return f!==l[m]})}function vv(l,s){return typeof s=="function"?s(l):s}function xv(l,s){for(var f in s)l[f]=s[f];return l}function Pp(l,s){for(var f in l)if(f!=="__source"&&!(f in s))return!0;for(var m in s)if(m!=="__source"&&l[m]!==s[m])return!0;return!1}function Dp(l){this.props=l}function Ia(l,s){function f(x){var T=this.props.ref,k=T==x.ref;return!k&&T&&(T.call?T(null):T.current=null),s?!s(this.props,x)||!k:Pp(this.props,x)}function m(x){return this.shouldComponentUpdate=f,Mn(l,x)}return m.displayName="Memo("+(l.displayName||l.name)+")",m.prototype.isReactComponent=!0,m.__f=!0,m}(Dp.prototype=new mo).isPureReactComponent=!0,Dp.prototype.shouldComponentUpdate=function(l,s){return Pp(this.props,l)||Pp(this.state,s)};var Vg=Tt.__b;Tt.__b=function(l){l.type&&l.type.__f&&l.ref&&(l.props.ref=l.ref,l.ref=null),Vg&&Vg(l)};var hb=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Su(l){function s(f,m){var x=xv({},f);return delete x.ref,l(x,!(m=f.ref||m)||typeof m=="object"&&Object.keys(m).length===0?null:m)}return s.$$typeof=hb,s.render=s,s.prototype.isReactComponent=s.__f=!0,s.displayName="ForwardRef("+(l.displayName||l.name)+")",s}var Ng=function(l,s){return l==null?null:Bo(Bo(l).map(s))},om={map:Ng,forEach:Ng,count:function(l){return l?Bo(l).length:0},only:function(l){var s=Bo(l);if(s.length!==1)throw"Children.only";return s[0]},toArray:Bo},db=Tt.__e;Tt.__e=function(l,s,f,m){if(l.then){for(var x,T=s;T=T.__;)if((x=T.__c)&&x.__c)return s.__e==null&&(s.__e=f.__e,s.__k=f.__k),x.__c(l,s)}db(l,s,f,m)};var jg=Tt.unmount;function ou(){this.__u=0,this.t=null,this.__b=null}function bv(l){var s=l.__.__c;return s&&s.__e&&s.__e(l)}function wv(l){var s,f,m;function x(T){if(s||(s=l()).then(function(k){f=k.default||k},function(k){m=k}),m)throw m;if(!f)throw s;return Mn(f,T)}return x.displayName="Lazy",x.__f=!0,x}function Qc(){this.u=null,this.o=null}Tt.unmount=function(l){var s=l.__c;s&&s.__R&&s.__R(),s&&l.__h===!0&&(l.type=null),jg&&jg(l)},(ou.prototype=new mo).__c=function(l,s){var f=s.__c,m=this;m.t==null&&(m.t=[]),m.t.push(f);var x=bv(m.__v),T=!1,k=function(){T||(T=!0,f.__R=null,x?x(o):o())};f.__R=k;var o=function(){if(!--m.__u){if(m.state.__e){var U=m.state.__e;m.__v.__k[0]=function F(Y,$,ye){return Y&&(Y.__v=null,Y.__k=Y.__k&&Y.__k.map(function(be){return F(be,$,ye)}),Y.__c&&Y.__c.__P===$&&(Y.__e&&ye.insertBefore(Y.__e,Y.__d),Y.__c.__e=!0,Y.__c.__P=ye)),Y}(U,U.__c.__P,U.__c.__O)}var V;for(m.setState({__e:m.__b=null});V=m.t.pop();)V.forceUpdate()}},N=s.__h===!0;m.__u++||N||m.setState({__e:m.__b=m.__v.__k[0]}),l.then(k,k)},ou.prototype.componentWillUnmount=function(){this.t=[]},ou.prototype.render=function(l,s){if(this.__b){if(this.__v.__k){var f=document.createElement("div"),m=this.__v.__k[0].__c;this.__v.__k[0]=function T(k,o,N){return k&&(k.__c&&k.__c.__H&&(k.__c.__H.__.forEach(function(U){typeof U.__c=="function"&&U.__c()}),k.__c.__H=null),(k=xv({},k)).__c!=null&&(k.__c.__P===N&&(k.__c.__P=o),k.__c=null),k.__k=k.__k&&k.__k.map(function(U){return T(U,o,N)})),k}(this.__b,f,m.__O=m.__P)}this.__b=null}var x=s.__e&&Mn(Yo,null,l.fallback);return x&&(x.__h=null),[Mn(Yo,null,s.__e?null:l.children),x]};var Gg=function(l,s,f){if(++f[1]===f[0]&&l.o.delete(s),l.props.revealOrder&&(l.props.revealOrder[0]!=="t"||!l.o.size))for(f=l.u;f;){for(;f.length>3;)f.pop()();if(f[1]<f[0])break;l.u=f=f[2]}};function fb(l){return this.getChildContext=function(){return l.context},l.children}function pb(l){var s=this,f=l.i;s.componentWillUnmount=function(){ys(null,s.l),s.l=null,s.i=null},s.i&&s.i!==f&&s.componentWillUnmount(),l.__v?(s.l||(s.i=f,s.l={nodeType:1,parentNode:f,childNodes:[],appendChild:function(m){this.childNodes.push(m),s.i.appendChild(m)},insertBefore:function(m,x){this.childNodes.push(m),s.i.appendChild(m)},removeChild:function(m){this.childNodes.splice(this.childNodes.indexOf(m)>>>1,1),s.i.removeChild(m)}}),ys(Mn(fb,{context:s.context},l.__v),s.l)):s.l&&s.componentWillUnmount()}function Vd(l,s){return Mn(pb,{__v:l,i:s})}(Qc.prototype=new mo).__e=function(l){var s=this,f=bv(s.__v),m=s.o.get(l);return m[0]++,function(x){var T=function(){s.props.revealOrder?(m.push(x),Gg(s,l,m)):x()};f?f(T):T()}},Qc.prototype.render=function(l){this.u=null,this.o=new Map;var s=Bo(l.children);l.revealOrder&&l.revealOrder[0]==="b"&&s.reverse();for(var f=s.length;f--;)this.o.set(s[f],this.u=[1,0,this.u]);return l.children},Qc.prototype.componentDidUpdate=Qc.prototype.componentDidMount=function(){var l=this;this.o.forEach(function(s,f){Gg(l,f,s)})};var Tv=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.element")||60103,mb=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|marker(?!H|W|U)|overline|paint|stop|strikethrough|stroke|text(?!L)|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,_b=typeof document!="undefined",gb=function(l){return(typeof Symbol!="undefined"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(l)};function yb(l,s,f){return s.__k==null&&(s.textContent=""),ys(l,s),typeof f=="function"&&f(),l?l.__c:null}function vb(l,s,f){return rm(l,s),typeof f=="function"&&f(),l?l.__c:null}mo.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(l){Object.defineProperty(mo.prototype,l,{configurable:!0,get:function(){return this["UNSAFE_"+l]},set:function(s){Object.defineProperty(this,l,{configurable:!0,writable:!0,value:s})}})});var $g=Tt.event;function xb(){}function bb(){return this.cancelBubble}function wb(){return this.defaultPrevented}Tt.event=function(l){return $g&&(l=$g(l)),l.persist=xb,l.isPropagationStopped=bb,l.isDefaultPrevented=wb,l.nativeEvent=l};var Sv,Zg={configurable:!0,get:function(){return this.class}},qg=Tt.vnode;Tt.vnode=function(l){var s=l.type,f=l.props,m=f;if(typeof s=="string"){var x=s.indexOf("-")===-1;for(var T in m={},f){var k=f[T];_b&&T==="children"&&s==="noscript"||T==="value"&&"defaultValue"in f&&k==null||(T==="defaultValue"&&"value"in f&&f.value==null?T="value":T==="download"&&k===!0?k="":/ondoubleclick/i.test(T)?T="ondblclick":/^onchange(textarea|input)/i.test(T+s)&&!gb(f.type)?T="oninput":/^onfocus$/i.test(T)?T="onfocusin":/^onblur$/i.test(T)?T="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(T)?T=T.toLowerCase():x&&mb.test(T)?T=T.replace(/[A-Z0-9]/,"-$&").toLowerCase():k===null&&(k=void 0),m[T]=k)}s=="select"&&m.multiple&&Array.isArray(m.value)&&(m.value=Bo(f.children).forEach(function(o){o.props.selected=m.value.indexOf(o.props.value)!=-1})),s=="select"&&m.defaultValue!=null&&(m.value=Bo(f.children).forEach(function(o){o.props.selected=m.multiple?m.defaultValue.indexOf(o.props.value)!=-1:m.defaultValue==o.props.value})),l.props=m,f.class!=f.className&&(Zg.enumerable="className"in f,f.className!=null&&(m.class=f.className),Object.defineProperty(m,"className",Zg))}l.$$typeof=Tv,qg&&qg(l)};var Wg=Tt.__r;Tt.__r=function(l){Wg&&Wg(l),Sv=l.__c};var Tb={ReactCurrentDispatcher:{current:{readContext:function(l){return Sv.__n[l.__c].props.value}}}};function Sb(l){return Mn.bind(null,l)}function Ev(l){return!!l&&l.$$typeof===Tv}function Av(l){return Ev(l)?_v.apply(null,arguments):l}function Eb(l){return!!l.__k&&(ys(null,l),!0)}function Ab(l){return l&&(l.base||l.nodeType===1&&l)||null}var Cb=function(l,s){return l(s)},Mb=function(l,s){return l(s)},Cn={useState:Ri,useReducer:yv,useEffect:Jt,useLayoutEffect:xs,useRef:vt,useImperativeHandle:Nl,useMemo:Gr,useCallback:Yt,useContext:bs,useDebugValue:Xo,version:"17.0.2",Children:om,render:yb,hydrate:vb,unmountComponentAtNode:Eb,createPortal:Vd,createElement:Mn,createContext:Ud,createFactory:Sb,cloneElement:Av,createRef:lv,Fragment:Yo,isValidElement:Ev,findDOMNode:Ab,Component:mo,PureComponent:Dp,memo:Ia,forwardRef:Su,flushSync:Mb,unstable_batchedUpdates:Cb,StrictMode:Yo,Suspense:ou,SuspenseList:Qc,lazy:wv,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:Tb},Ib=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function kb(l){if(l.__esModule)return l;var s=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(l).forEach(function(f){var m=Object.getOwnPropertyDescriptor(l,f);Object.defineProperty(s,f,m.get?m:{enumerable:!0,get:function(){return l[f]}})}),s}var am={exports:{}};(function(l,s){(function(f,m){l.exports=m()})(Ib,function(){var f,m,x;function T(o,N){if(!f)f=N;else if(!m)m=N;else{var U="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+f+")(sharedChunk); ("+m+")(sharedChunk); self.onerror = null;",V={};f(V),x=N(V),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(x.workerUrl=window.URL.createObjectURL(new Blob([U],{type:"text/javascript"})))}}T(["exports"],function(o){var N="2.7.1",U=V;function V(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n}V.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},V.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},V.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},V.prototype.solveCurveX=function(t,e){var r,n,c,u,p;for(e===void 0&&(e=1e-6),c=t,p=0;p<8;p++){if(u=this.sampleCurveX(c)-t,Math.abs(u)<e)return c;var g=this.sampleCurveDerivativeX(c);if(Math.abs(g)<1e-6)break;c-=u/g}if((c=t)<(r=0))return r;if(c>(n=1))return n;for(;r<n;){if(u=this.sampleCurveX(c),Math.abs(u-t)<e)return c;t>u?r=c:n=c,c=.5*(n-r)+r}return c},V.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var F=Y;function Y(t,e){this.x=t,this.y=e}Y.prototype={clone:function(){return new Y(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),c=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Y.convert=function(t){return t instanceof Y?t:Array.isArray(t)?new Y(t[0],t[1]):t};var $=typeof self!="undefined"?self:{},ye=1e-6,be=typeof Float32Array!="undefined"?Float32Array:Array;function Ue(){var t=new be(9);return be!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Ge(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function S(t,e,r){var n=e[0],c=e[1],u=e[2],p=e[3],g=e[4],v=e[5],w=e[6],A=e[7],C=e[8],M=e[9],L=e[10],B=e[11],G=e[12],q=e[13],Q=e[14],oe=e[15],ce=r[0],de=r[1],pe=r[2],me=r[3];return t[0]=ce*n+de*g+pe*C+me*G,t[1]=ce*c+de*v+pe*M+me*q,t[2]=ce*u+de*w+pe*L+me*Q,t[3]=ce*p+de*A+pe*B+me*oe,t[4]=(ce=r[4])*n+(de=r[5])*g+(pe=r[6])*C+(me=r[7])*G,t[5]=ce*c+de*v+pe*M+me*q,t[6]=ce*u+de*w+pe*L+me*Q,t[7]=ce*p+de*A+pe*B+me*oe,t[8]=(ce=r[8])*n+(de=r[9])*g+(pe=r[10])*C+(me=r[11])*G,t[9]=ce*c+de*v+pe*M+me*q,t[10]=ce*u+de*w+pe*L+me*Q,t[11]=ce*p+de*A+pe*B+me*oe,t[12]=(ce=r[12])*n+(de=r[13])*g+(pe=r[14])*C+(me=r[15])*G,t[13]=ce*c+de*v+pe*M+me*q,t[14]=ce*u+de*w+pe*L+me*Q,t[15]=ce*p+de*A+pe*B+me*oe,t}function we(t,e,r){var n,c,u,p,g,v,w,A,C,M,L,B,G=r[0],q=r[1],Q=r[2];return e===t?(t[12]=e[0]*G+e[4]*q+e[8]*Q+e[12],t[13]=e[1]*G+e[5]*q+e[9]*Q+e[13],t[14]=e[2]*G+e[6]*q+e[10]*Q+e[14],t[15]=e[3]*G+e[7]*q+e[11]*Q+e[15]):(c=e[1],u=e[2],p=e[3],g=e[4],v=e[5],w=e[6],A=e[7],C=e[8],M=e[9],L=e[10],B=e[11],t[0]=n=e[0],t[1]=c,t[2]=u,t[3]=p,t[4]=g,t[5]=v,t[6]=w,t[7]=A,t[8]=C,t[9]=M,t[10]=L,t[11]=B,t[12]=n*G+g*q+C*Q+e[12],t[13]=c*G+v*q+M*Q+e[13],t[14]=u*G+w*q+L*Q+e[14],t[15]=p*G+A*q+B*Q+e[15]),t}function Le(t,e,r){var n=r[0],c=r[1],u=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ze(t,e,r){var n=Math.sin(r),c=Math.cos(r),u=e[4],p=e[5],g=e[6],v=e[7],w=e[8],A=e[9],C=e[10],M=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*c+w*n,t[5]=p*c+A*n,t[6]=g*c+C*n,t[7]=v*c+M*n,t[8]=w*c-u*n,t[9]=A*c-p*n,t[10]=C*c-g*n,t[11]=M*c-v*n,t}function xe(t,e,r){var n=Math.sin(r),c=Math.cos(r),u=e[0],p=e[1],g=e[2],v=e[3],w=e[8],A=e[9],C=e[10],M=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*c-w*n,t[1]=p*c-A*n,t[2]=g*c-C*n,t[3]=v*c-M*n,t[8]=u*n+w*c,t[9]=p*n+A*c,t[10]=g*n+C*c,t[11]=v*n+M*c,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Se=S;function Re(){var t=new be(3);return be!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Je(t){var e=new be(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ot(t){return Math.hypot(t[0],t[1],t[2])}function st(t,e,r){var n=new be(3);return n[0]=t,n[1]=e,n[2]=r,n}function wt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function ai(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function vi(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Ft(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function Vi(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function Dt(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function kt(t,e){var r=e[0],n=e[1],c=e[2],u=r*r+n*n+c*c;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t[2]=e[2]*u,t}function ui(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Di(t,e,r){var n=e[0],c=e[1],u=e[2],p=r[0],g=r[1],v=r[2];return t[0]=c*v-u*g,t[1]=u*p-n*v,t[2]=n*g-c*p,t}function At(t,e,r){var n=e[0],c=e[1],u=e[2],p=r[3]*n+r[7]*c+r[11]*u+r[15];return t[0]=(r[0]*n+r[4]*c+r[8]*u+r[12])/(p=p||1),t[1]=(r[1]*n+r[5]*c+r[9]*u+r[13])/p,t[2]=(r[2]*n+r[6]*c+r[10]*u+r[14])/p,t}function hi(t,e,r){var n=r[0],c=r[1],u=r[2],p=e[0],g=e[1],v=e[2],w=c*v-u*g,A=u*p-n*v,C=n*g-c*p,M=c*C-u*A,L=u*w-n*C,B=n*A-c*w,G=2*r[3];return A*=G,C*=G,L*=2,B*=2,t[0]=p+(w*=G)+(M*=2),t[1]=g+A+L,t[2]=v+C+B,t}var cr,yr=ai,Gn=vi,tn=ot;function mr(t,e,r){var n=e[0],c=e[1],u=e[2],p=e[3];return t[0]=r[0]*n+r[4]*c+r[8]*u+r[12]*p,t[1]=r[1]*n+r[5]*c+r[9]*u+r[13]*p,t[2]=r[2]*n+r[6]*c+r[10]*u+r[14]*p,t[3]=r[3]*n+r[7]*c+r[11]*u+r[15]*p,t}function Pn(){var t=new be(4);return be!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function $n(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Dn(t,e,r){r*=.5;var n=e[0],c=e[1],u=e[2],p=e[3],g=Math.sin(r),v=Math.cos(r);return t[0]=n*v+p*g,t[1]=c*v+u*g,t[2]=u*v-c*g,t[3]=p*v-n*g,t}function Ln(t,e){return t[0]===e[0]&&t[1]===e[1]}Re(),cr=new be(4),be!=Float32Array&&(cr[0]=0,cr[1]=0,cr[2]=0,cr[3]=0),Re(),st(1,0,0),st(0,1,0),Pn(),Pn(),Ue(),function(){var t;t=new be(2),be!=Float32Array&&(t[0]=0,t[1]=0)}();const tr=Math.PI/180,Or=180/Math.PI;function Et(t){return t*tr}function Zi(t){return t*Or}const vr=[[0,0],[1,0],[1,1],[0,1]];function Dr(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}function $r(t,e,r,n){const c=new U(t,e,r,n);return function(u){return c.solve(u)}}const pn=$r(.25,.1,.25,1);function Nt(t,e,r){return Math.min(r,Math.max(e,t))}function Mr(t,e,r){return(r=Nt((r-t)/(e-t),0,1))*r*(3-2*r)}function xr(t,e,r){const n=r-e,c=((t-e)%n+n)%n+e;return c===e?r:c}function Fr(t,e,r){if(!t.length)return r(null,[]);let n=t.length;const c=new Array(t.length);let u=null;t.forEach((p,g)=>{e(p,(v,w)=>{v&&(u=v),c[g]=w,--n==0&&r(u,c)})})}function _r(t){const e=[];for(const r in t)e.push(t[r]);return e}function Gt(t,...e){for(const r of e)for(const n in r)t[n]=r[n];return t}let Ai=1;function He(){return Ai++}function rt(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function xt(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Ht(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Xt(t,e){t.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Ni(t,e){return t.indexOf(e,t.length-e.length)!==-1}function ir(t,e,r){const n={};for(const c in t)n[c]=e.call(r||this,t[c],c,t);return n}function Lr(t,e,r){const n={};for(const c in t)e.call(r||this,t[c],c,t)&&(n[c]=t[c]);return n}function Ne(t){return Array.isArray(t)?t.map(Ne):typeof t=="object"&&t?ir(t,Ne):t}const bt={};function et(t){bt[t]||(typeof console!="undefined"&&console.warn(t),bt[t]=!0)}function zt(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function xi(t){let e=0;for(let r,n,c=0,u=t.length,p=u-1;c<u;p=c++)r=t[c],n=t[p],e+=(n.x-r.x)*(r.y+n.y);return e}function Ut(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function di(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,n,c,u)=>{const p=c||u;return e[n]=!p||p.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let fi,pi,Ct,$t=null;function qi(t){if($t==null){const e=t.navigator?t.navigator.userAgent:null;$t=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return $t}function rn(t){try{const e=$[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const ji={now:()=>Ct!==void 0?Ct:$.performance.now(),setNow(t){Ct=t},restoreNow(){Ct=void 0},frame(t){const e=$.requestAnimationFrame(t);return{cancel:()=>$.cancelAnimationFrame(e)}},getImageData(t,e=0){const r=$.document.createElement("canvas"),n=r.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return r.width=t.width,r.height=t.height,n.drawImage(t,0,0,t.width,t.height),n.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:t=>(fi||(fi=$.document.createElement("a")),fi.href=t,fi.href),get devicePixelRatio(){return $.devicePixelRatio},get prefersReducedMotion(){return!!$.matchMedia&&(pi==null&&(pi=$.matchMedia("(prefers-reduced-motion: reduce)")),pi.matches)}};let J;const D={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(J==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{J={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):t}catch{J=t}}return J},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},O={supported:!1,testSupport:function(t){!le&&ee&&(he?fe(t):H=t)}};let H,ee,le=!1,he=!1;function fe(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ee),t.isContextLost())return;O.supported=!0}catch{}t.deleteTexture(e),le=!0}$.document&&(ee=$.document.createElement("img"),ee.onload=function(){H&&fe(H),H=null,he=!0},ee.onerror=function(){le=!0,H=null},ee.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ue="01",_e="NO_ACCESS_TOKEN";function Me(t){return t.indexOf("mapbox:")===0}function Pe(t){return D.API_URL_REGEX.test(t)}const Fe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ht(t){const e=t.match(Fe);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ft(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function pt(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent($.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class mt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=pt(D.ACCESS_TOKEN);let n="";return n=r&&r.u?$.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(c,u)=>String.fromCharCode(Number("0x"+u)))):D.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=rn("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const c=$.localStorage.getItem(r);c&&(this.eventData=JSON.parse(c));const u=$.localStorage.getItem(n);u&&(this.anonId=u)}catch{et("Unable to read from LocalStorage")}}saveEventData(){const e=rn("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{$.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&$.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{et("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,n,c){if(!D.EVENTS_URL)return;const u=ht(D.EVENTS_URL);u.params.push(`access_token=${c||D.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:N,skuId:ue,userId:this.anonId},g=r?Gt(p,r):p,v={url:ft(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=Zn(v,w=>{this.pendingRequest=null,n(w),this.saveEventData(),this.processRequests(c)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const Lt=new class extends mt{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){D.EVENTS_URL&&D.ACCESS_TOKEN&&Array.isArray(t)&&t.some(r=>Me(r)||Pe(r))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=pt(D.ACCESS_TOKEN),r=e?e.u:D.ACCESS_TOKEN;let n=r!==this.eventData.tokenU;Ht(this.anonId)||(this.anonId=rt(),n=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),p=new Date(c),g=(c-this.eventData.lastSuccess)/864e5;n=n||g>=1||g<-1||u.getDate()!==p.getDate()}else n=!0;if(!n)return this.processRequests();this.postEvent(c,{"enabled.telemetry":!1},u=>{u||(this.eventData.lastSuccess=c,this.eventData.tokenU=r)},t)}},mi=Lt.postTurnstileEvent.bind(Lt),bi=new class extends mt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,r,n){this.skuToken=e,this.errorCb=n,D.EVENTS_URL&&(r||D.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(_e)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Ht(this.anonId)||(this.anonId=rt()),this.postEvent(r,{skuToken:this.skuToken},n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t))}},gi=bi.postMapLoadEvent.bind(bi),Ci=new class extends mt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,r,n){if(!D.API_URL||!D.SESSION_PATH)return;const c=ht(D.API_URL+D.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${n||D.ACCESS_TOKEN||""}`);const u={url:ft(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Zd(u,p=>{this.pendingRequest=null,r(p),this.saveEventData(),this.processRequests(n)})}getSessionAPI(t,e,r,n){this.skuToken=e,this.errorCb=n,D.SESSION_PATH&&D.API_URL&&(r||D.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(_e)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t)}},mn=Ci.getSessionAPI.bind(Ci),_n=new Set,Yi="mapbox-tiles";let nn,Ts,Cu=500,Wl=50;function ka(){$.caches&&!nn&&(nn=$.caches.open(Yi))}function Hl(t){const e=t.indexOf("?");return e<0?t:t.slice(0,e)}let Ss=1/0;const Es={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Es);class za extends Error{constructor(e,r,n){r===401&&Pe(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Xl=Ut()?()=>self.worker&&self.worker.referrer:()=>($.location.protocol==="blob:"?$.parent:$).location.href,Rn=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(Xl())&&!/^\w+:/.test(r))){if($.fetch&&$.Request&&$.AbortController&&$.Request.prototype.hasOwnProperty("signal"))return function(n,c){const u=new $.AbortController,p=new $.Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:Xl(),signal:u.signal});let g=!1,v=!1;const w=(A=p.url).indexOf("sku=")>0&&Pe(A);var A;n.type==="json"&&p.headers.set("Accept","application/json");const C=(L,B,G)=>{if(v)return;if(L&&L.message!=="SecurityError"&&et(L),B&&G)return M(B);const q=Date.now();$.fetch(p).then(Q=>{if(Q.ok){const oe=w?Q.clone():null;return M(Q,oe,q)}return c(new za(Q.statusText,Q.status,n.url))}).catch(Q=>{Q.code!==20&&c(new Error(Q.message))})},M=(L,B,G)=>{(n.type==="arrayBuffer"?L.arrayBuffer():n.type==="json"?L.json():L.text()).then(q=>{v||(B&&G&&function(Q,oe,ce){if(ka(),!nn)return;const de={status:oe.status,statusText:oe.statusText,headers:new $.Headers};oe.headers.forEach((me,ke)=>de.headers.set(ke,me));const pe=di(oe.headers.get("Cache-Control")||"");pe["no-store"]||(pe["max-age"]&&de.headers.set("Expires",new Date(ce+1e3*pe["max-age"]).toUTCString()),new Date(de.headers.get("Expires")).getTime()-ce<42e4||function(me,ke){if(Ts===void 0)try{new Response(new ReadableStream),Ts=!0}catch{Ts=!1}Ts?ke(me.body):me.blob().then(ke)}(oe,me=>{const ke=new $.Response(me,de);ka(),nn&&nn.then(Ce=>Ce.put(Hl(Q.url),ke)).catch(Ce=>et(Ce.message))}))}(p,B,G),g=!0,c(null,q,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(q=>{v||c(new Error(q.message))})};return w?function(L,B){if(ka(),!nn)return B(null);const G=Hl(L.url);nn.then(q=>{q.match(G).then(Q=>{const oe=function(ce){if(!ce)return!1;const de=new Date(ce.headers.get("Expires")||0),pe=di(ce.headers.get("Cache-Control")||"");return de>Date.now()&&!pe["no-cache"]}(Q);q.delete(G),oe&&q.put(G,Q.clone()),B(null,Q,oe)}).catch(B)}).catch(B)}(p,C):C(null,null),{cancel:()=>{v=!0,g||u.abort()}}}(t,e);if(Ut()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(n,c){const u=new $.XMLHttpRequest;u.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const p in n.headers)u.setRequestHeader(p,n.headers[p]);return n.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=n.credentials==="include",u.onerror=()=>{c(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let p=u.response;if(n.type==="json")try{p=JSON.parse(u.response)}catch(g){return c(g)}c(null,p,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else c(new za(u.statusText,u.status,n.url))},u.send(n.body),{cancel:()=>u.abort()}}(t,e)},Pa=function(t,e){return Rn(Gt(t,{type:"arrayBuffer"}),e)},Zn=function(t,e){return Rn(Gt(t,{method:"POST"}),e)},Zd=function(t,e){return Rn(Gt(t,{method:"GET"}),e)};function Mu(t){const e=$.document.createElement("a");return e.href=t,e.protocol===$.document.location.protocol&&e.host===$.document.location.host}const Jo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Qo,Da;Qo=[],Da=0;const Iu=function(t,e){if(O.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Da>=D.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Qo.push(u),u}Da++;let r=!1;const n=()=>{if(!r)for(r=!0,Da--;Qo.length&&Da<D.MAX_PARALLEL_IMAGE_REQUESTS;){const u=Qo.shift(),{requestParameters:p,callback:g,cancelled:v}=u;v||(u.cancel=Iu(p,g).cancel)}},c=Pa(t,(u,p,g,v)=>{n(),u?e(u):p&&($.createImageBitmap?function(w,A){const C=new $.Blob([new Uint8Array(w)],{type:"image/png"});$.createImageBitmap(C).then(M=>{A(null,M)}).catch(M=>{A(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(w,A)=>e(w,A,g,v)):function(w,A){const C=new $.Image,M=$.URL;C.onload=()=>{A(null,C),M.revokeObjectURL(C.src),C.onload=null,$.requestAnimationFrame(()=>{C.src=Jo})},C.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new $.Blob([new Uint8Array(w)],{type:"image/png"});C.src=w.byteLength?M.createObjectURL(L):Jo}(p,(w,A)=>e(w,A,g,v)))});return{cancel:()=>{c.cancel(),n()}}};function ku(t,e,r){r[t]&&r[t].indexOf(e)!==-1||(r[t]=r[t]||[],r[t].push(e))}function As(t,e,r){if(r&&r[t]){const n=r[t].indexOf(e);n!==-1&&r[t].splice(n,1)}}class go{constructor(e,r={}){Gt(this,r),this.type=e}}class Cs extends go{constructor(e,r={}){super("error",Gt({error:e},r))}}class yo{on(e,r){return this._listeners=this._listeners||{},ku(e,r,this._listeners),this}off(e,r){return As(e,r,this._listeners),As(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},ku(e,r,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,r){typeof e=="string"&&(e=new go(e,r||{}));const n=e.type;if(this.listens(n)){e.target=this;const c=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const g of c)g.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const g of u)As(n,g,this._oneTimeListeners),g.call(this,e);const p=this._eventedParent;p&&(Gt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof Cs&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Ee=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class it{constructor(e,r,n,c){this.message=(e?`${e}: `:"")+n,c&&(this.identifier=c),r!=null&&r.__line__&&(this.line=r.__line__)}}function zu(t){const e=t.value;return e?[new it(t.key,e,"constants have been deprecated as of v8")]:[]}function vo(t,...e){for(const r of e)for(const n in r)t[n]=r[n];return t}function Ji(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function eo(t){if(Array.isArray(t))return t.map(eo);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const r in t)e[r]=eo(t[r]);return e}return Ji(t)}class qn extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Ms{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[n,c]of r)this.bindings[n]=c}concat(e){return new Ms(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const xo={kind:"null"},tt={kind:"number"},Zt={kind:"string"},Bt={kind:"boolean"},Wn={kind:"color"},ea={kind:"object"},Ot={kind:"value"},La={kind:"collator"},bo={kind:"formatted"},Ra={kind:"resolvedImage"};function gn(t,e){return{kind:"array",itemType:t,N:e}}function Wi(t){if(t.kind==="array"){const e=Wi(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const qd=[xo,tt,Zt,Bt,Wn,bo,ea,gn(Ot),Ra];function Zr(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Zr(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const r of qd)if(!Zr(r,e))return null}}return`Expected ${Wi(t)} but found ${Wi(e)} instead.`}function Is(t,e){return e.some(r=>r.kind===t.kind)}function ta(t,e){return e.some(r=>r==="null"?t===null:r==="array"?Array.isArray(t):r==="object"?t&&!Array.isArray(t)&&typeof t=="object":r===typeof t)}function ia(t){var e={exports:{}};return t(e,e.exports),e.exports}var ra=ia(function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(g){return(g=Math.round(g))<0?0:g>255?255:g}function c(g){return n(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function u(g){return(v=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:v>1?1:v;var v}function p(g,v,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?g+(v-g)*w*6:2*w<1?v:3*w<2?g+(v-g)*(2/3-w)*6:g}try{e.parseCSSColor=function(g){var v,w=g.replace(/ /g,"").toLowerCase();if(w in r)return r[w].slice();if(w[0]==="#")return w.length===4?(v=parseInt(w.substr(1),16))>=0&&v<=4095?[(3840&v)>>4|(3840&v)>>8,240&v|(240&v)>>4,15&v|(15&v)<<4,1]:null:w.length===7&&(v=parseInt(w.substr(1),16))>=0&&v<=16777215?[(16711680&v)>>16,(65280&v)>>8,255&v,1]:null;var A=w.indexOf("("),C=w.indexOf(")");if(A!==-1&&C+1===w.length){var M=w.substr(0,A),L=w.substr(A+1,C-(A+1)).split(","),B=1;switch(M){case"rgba":if(L.length!==4)return null;B=u(L.pop());case"rgb":return L.length!==3?null:[c(L[0]),c(L[1]),c(L[2]),B];case"hsla":if(L.length!==4)return null;B=u(L.pop());case"hsl":if(L.length!==3)return null;var G=(parseFloat(L[0])%360+360)%360/360,q=u(L[1]),Q=u(L[2]),oe=Q<=.5?Q*(q+1):Q+q-Q*q,ce=2*Q-oe;return[n(255*p(ce,oe,G+1/3)),n(255*p(ce,oe,G)),n(255*p(ce,oe,G-1/3)),B];default:return null}}return null}}catch{}});class ii{constructor(e,r,n,c=1){this.r=e,this.g=r,this.b=n,this.a=c}static parse(e){if(!e)return;if(e instanceof ii)return e;if(typeof e!="string")return;const r=ra.parseCSSColor(e);return r?new ii(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,n,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(n)},${c})`}toArray(){const{r:e,g:r,b:n,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*r/c,255*n/c,c]}}ii.black=new ii(0,0,0,1),ii.white=new ii(1,1,1,1),ii.transparent=new ii(0,0,0,0),ii.red=new ii(1,0,0,1),ii.blue=new ii(0,0,1,1);class ks{constructor(e,r,n){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Kl{constructor(e,r,n,c,u){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=n,this.fontStack=c,this.textColor=u}}class Pt{constructor(e){this.sections=e}static fromString(e){return new Pt([new Kl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Pt?e:Pt.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const n={};r.fontStack&&(n["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(n["font-scale"]=r.scale),r.textColor&&(n["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(n)}return e}}class yn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new yn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Pu(t,e,r,n){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[t,e,r,n]:[t,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function zs(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof ii||t instanceof ks||t instanceof Pt||t instanceof yn)return!0;if(Array.isArray(t)){for(const e of t)if(!zs(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!zs(t[e]))return!1;return!0}return!1}function rr(t){if(t===null)return xo;if(typeof t=="string")return Zt;if(typeof t=="boolean")return Bt;if(typeof t=="number")return tt;if(t instanceof ii)return Wn;if(t instanceof ks)return La;if(t instanceof Pt)return bo;if(t instanceof yn)return Ra;if(Array.isArray(t)){const e=t.length;let r;for(const n of t){const c=rr(n);if(r){if(r===c)continue;r=Ot;break}r=c}return gn(r||Ot,e)}return ea}function Ba(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof ii||t instanceof Pt||t instanceof yn?t.toString():JSON.stringify(t)}class wo{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!zs(e[1]))return r.error("invalid value");const n=e[1];let c=rr(n);const u=r.expectedType;return c.kind!=="array"||c.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(c=u),new wo(c,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ii?["rgba"].concat(this.value.toArray()):this.value instanceof Pt?this.value.serialize():this.value}}class br{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ps={string:Zt,number:tt,boolean:Bt,object:ea};class vn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let n,c=1;const u=e[0];if(u==="array"){let g,v;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in Ps)||w==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);g=Ps[w],c++}else g=Ot;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);v=e[2],c++}n=gn(g,v)}else n=Ps[u];const p=[];for(;c<e.length;c++){const g=r.parse(e[c],c,Ot);if(!g)return null;p.push(g)}return new vn(n,p)}evaluate(e){for(let r=0;r<this.args.length;r++){const n=this.args[r].evaluate(e);if(!Zr(this.type,rr(n)))return n;if(r===this.args.length-1)throw new br(`Expected value to be of type ${Wi(this.type)}, but found ${Wi(rr(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){r.push(n.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&r.push(c)}}return r.concat(this.args.map(n=>n.serialize()))}}class Hn{constructor(e){this.type=bo,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return r.error("First argument must be an image or text section.");const c=[];let u=!1;for(let p=1;p<=e.length-1;++p){const g=e[p];if(u&&typeof g=="object"&&!Array.isArray(g)){u=!1;let v=null;if(g["font-scale"]&&(v=r.parse(g["font-scale"],1,tt),!v))return null;let w=null;if(g["text-font"]&&(w=r.parse(g["text-font"],1,gn(Zt)),!w))return null;let A=null;if(g["text-color"]&&(A=r.parse(g["text-color"],1,Wn),!A))return null;const C=c[c.length-1];C.scale=v,C.font=w,C.textColor=A}else{const v=r.parse(e[p],1,Ot);if(!v)return null;const w=v.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,c.push({content:v,scale:null,font:null,textColor:null})}}return new Hn(c)}evaluate(e){return new Pt(this.sections.map(r=>{const n=r.content.evaluate(e);return rr(n)===Ra?new Kl("",n,null,null,null):new Kl(Ba(n),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const n={};r.scale&&(n["font-scale"]=r.scale.serialize()),r.font&&(n["text-font"]=r.font.serialize()),r.textColor&&(n["text-color"]=r.textColor.serialize()),e.push(n)}return e}}class Oo{constructor(e){this.type=Ra,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const n=r.parse(e[1],1,Zt);return n?new Oo(n):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),n=yn.fromString(r);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(r)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Wd={"to-boolean":Bt,"to-color":Wn,"to-number":tt,"to-string":Zt};class Xn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[0];if((n==="to-boolean"||n==="to-string")&&e.length!==2)return r.error("Expected one argument.");const c=Wd[n],u=[];for(let p=1;p<e.length;p++){const g=r.parse(e[p],p,Ot);if(!g)return null;u.push(g)}return new Xn(c,u)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,n;for(const c of this.args){if(r=c.evaluate(e),n=null,r instanceof ii)return r;if(typeof r=="string"){const u=e.parseColor(r);if(u)return u}else if(Array.isArray(r)&&(n=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Pu(r[0],r[1],r[2],r[3]),!n))return new ii(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new br(n||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const n of this.args){if(r=n.evaluate(e),r===null)return 0;const c=Number(r);if(!isNaN(c))return c}throw new br(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Pt.fromString(Ba(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?yn.fromString(Ba(this.args[0].evaluate(e))):Ba(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Hn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Oo(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Du=["Unknown","Point","LineString","Polygon"];class Lu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Du[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:n,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*r-e[0])+this.featureDistanceData.bearing[1]*(c*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=ii.parse(e)),r}}class on{constructor(e,r,n,c){this.name=e,this.type=r,this._evaluate=n,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const n=e[0],c=on.definitions[n];if(!c)return r.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(c)?c[0]:c.type,p=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,g=p.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let v=null;for(const[w,A]of g){v=new Rs(r.registry,r.path,null,r.scope);const C=[];let M=!1;for(let L=1;L<e.length;L++){const B=e[L],G=Array.isArray(w)?w[L-1]:w.type,q=v.parse(B,1+C.length,G);if(!q){M=!0;break}C.push(q)}if(!M)if(Array.isArray(w)&&w.length!==C.length)v.error(`Expected ${w.length} arguments, but found ${C.length} instead.`);else{for(let L=0;L<C.length;L++){const B=Array.isArray(w)?w[L]:w.type,G=C[L];v.concat(L+1).checkSubtype(B,G.type)}if(v.errors.length===0)return new on(n,u,A,C)}}if(g.length===1)r.errors.push(...v.errors);else{const w=(g.length?g:p).map(([C])=>{return M=C,Array.isArray(M)?`(${M.map(Wi).join(", ")})`:`(${Wi(M.type)}...)`;var M}).join(" | "),A=[];for(let C=1;C<e.length;C++){const M=r.parse(e[C],1+A.length);if(!M)return null;A.push(Wi(M.type))}r.error(`Expected arguments of type ${w}, but found (${A.join(", ")}) instead.`)}return null}static register(e,r){on.definitions=r;for(const n in r)e[n]=on}}class Oa{constructor(e,r,n){this.type=La,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return r.error("Collator options argument must be an object.");const c=r.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,Bt);if(!c)return null;const u=r.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,Bt);if(!u)return null;let p=null;return n.locale&&(p=r.parse(n.locale,1,Zt),!p)?null:new Oa(c,u,p)}evaluate(e){return new ks(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const To=8192;function Ds(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Fa(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Ru(t,e){const r=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(r*c*To),Math.round(n*c*To)]}function Bu(t,e,r){const n=t[0]-e[0],c=t[1]-e[1],u=t[0]-r[0],p=t[1]-r[1];return n*p-u*c==0&&n*u<=0&&c*p<=0}function Yl(t,e){let r=!1;for(let p=0,g=e.length;p<g;p++){const v=e[p];for(let w=0,A=v.length;w<A-1;w++){if(Bu(t,v[w],v[w+1]))return!1;(c=v[w])[1]>(n=t)[1]!=(u=v[w+1])[1]>n[1]&&n[0]<(u[0]-c[0])*(n[1]-c[1])/(u[1]-c[1])+c[0]&&(r=!r)}}var n,c,u;return r}function Ou(t,e){for(let r=0;r<e.length;r++)if(Yl(t,e[r]))return!0;return!1}function Jl(t,e,r,n){const c=n[0]-r[0],u=n[1]-r[1],p=(t[0]-r[0])*u-c*(t[1]-r[1]),g=(e[0]-r[0])*u-c*(e[1]-r[1]);return p>0&&g<0||p<0&&g>0}function Hd(t,e,r){for(const w of r)for(let A=0;A<w.length-1;++A)if((g=[(p=w[A+1])[0]-(u=w[A])[0],p[1]-u[1]])[0]*(v=[(c=e)[0]-(n=t)[0],c[1]-n[1]])[1]-g[1]*v[0]!=0&&Jl(n,c,u,p)&&Jl(u,p,n,c))return!0;var n,c,u,p,g,v;return!1}function Fu(t,e){for(let r=0;r<t.length;++r)if(!Yl(t[r],e))return!1;for(let r=0;r<t.length-1;++r)if(Hd(t[r],t[r+1],e))return!1;return!0}function Xd(t,e){for(let r=0;r<e.length;r++)if(Fu(t,e[r]))return!0;return!1}function Ql(t,e,r){const n=[];for(let c=0;c<t.length;c++){const u=[];for(let p=0;p<t[c].length;p++){const g=Ru(t[c][p],r);Ds(e,g),u.push(g)}n.push(u)}return n}function Uu(t,e,r){const n=[];for(let c=0;c<t.length;c++){const u=Ql(t[c],e,r);n.push(u)}return n}function ec(t,e,r,n){if(t[0]<r[0]||t[0]>r[2]){const c=.5*n;let u=t[0]-r[0]>c?-n:r[0]-t[0]>c?n:0;u===0&&(u=t[0]-r[2]>c?-n:r[2]-t[0]>c?n:0),t[0]+=u}Ds(e,t)}function Vu(t,e,r,n){const c=Math.pow(2,n.z)*To,u=[n.x*To,n.y*To],p=[];for(const g of t)for(const v of g){const w=[v.x+u[0],v.y+u[1]];ec(w,e,r,c),p.push(w)}return p}function Nu(t,e,r,n){const c=Math.pow(2,n.z)*To,u=[n.x*To,n.y*To],p=[];for(const v of t){const w=[];for(const A of v){const C=[A.x+u[0],A.y+u[1]];Ds(e,C),w.push(C)}p.push(w)}if(e[2]-e[0]<=c/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const v of p)for(const w of v)ec(w,e,r,c)}var g;return p}class Fo{constructor(e,r){this.type=Bt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(zs(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let c=0;c<n.features.length;++c){const u=n.features[c].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Fo(n,n.features[c].geometry)}else if(n.type==="Feature"){const c=n.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Fo(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new Fo(n,n)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,n){const c=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(n.type==="Polygon"){const g=Ql(n.coordinates,u,p),v=Vu(r.geometry(),c,u,p);if(!Fa(c,u))return!1;for(const w of v)if(!Yl(w,g))return!1}if(n.type==="MultiPolygon"){const g=Uu(n.coordinates,u,p),v=Vu(r.geometry(),c,u,p);if(!Fa(c,u))return!1;for(const w of v)if(!Ou(w,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,n){const c=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=r.canonicalID();if(n.type==="Polygon"){const g=Ql(n.coordinates,u,p),v=Nu(r.geometry(),c,u,p);if(!Fa(c,u))return!1;for(const w of v)if(!Fu(w,g))return!1}if(n.type==="MultiPolygon"){const g=Uu(n.coordinates,u,p),v=Nu(r.geometry(),c,u,p);if(!Fa(c,u))return!1;for(const w of v)if(!Xd(w,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function na(t){if(t instanceof on&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Fo)return!1;let e=!0;return t.eachChild(r=>{e&&!na(r)&&(e=!1)}),e}function Ua(t){if(t instanceof on&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(r=>{e&&!Ua(r)&&(e=!1)}),e}function Va(t,e){if(t instanceof on&&e.indexOf(t.name)>=0)return!1;let r=!0;return t.eachChild(n=>{r&&!Va(n,e)&&(r=!1)}),r}class Ls{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const n=e[1];return r.scope.has(n)?new Ls(n,r.scope.get(n)):r.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Rs{constructor(e,r=[],n,c=new Ms,u=[]){this.registry=e,this.path=r,this.key=r.map(p=>`[${p}]`).join(""),this.scope=c,this.errors=u,this.expectedType=n}parse(e,r,n,c,u={}){return r?this.concat(r,n,c)._parse(e,u):this._parse(e,u)}_parse(e,r){function n(c,u,p){return p==="assert"?new vn(u,[c]):p==="coerce"?new Xn(u,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const u=this.registry[c];if(u){let p=u.parse(e,this);if(!p)return null;if(this.expectedType){const g=this.expectedType,v=p.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||v.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(g,v))return null}else p=n(p,g,r.typeAnnotation||"coerce");else p=n(p,g,r.typeAnnotation||"assert")}if(!(p instanceof wo)&&p.type.kind!=="resolvedImage"&&Bs(p)){const g=new Lu;try{p=new wo(p.type,p.evaluate(g))}catch(v){return this.error(v.message),null}}return p}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,n){const c=typeof e=="number"?this.path.concat(e):this.path,u=n?this.scope.concat(n):this.scope;return new Rs(this.registry,c,r||null,u,this.errors)}error(e,...r){const n=`${this.key}${r.map(c=>`[${c}]`).join("")}`;this.errors.push(new qn(n,e))}checkSubtype(e,r){const n=Zr(e,r);return n&&this.error(n),n}}function Bs(t){if(t instanceof Ls)return Bs(t.boundExpression);if(t instanceof on&&t.name==="error"||t instanceof Oa||t instanceof Fo)return!1;const e=t instanceof Xn||t instanceof vn;let r=!0;return t.eachChild(n=>{r=e?r&&Bs(n):r&&n instanceof wo}),!!r&&na(t)&&Va(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Na(t,e){const r=t.length-1;let n,c,u=0,p=r,g=0;for(;u<=p;)if(g=Math.floor((u+p)/2),n=t[g],c=t[g+1],n<=e){if(g===r||e<c)return g;u=g+1}else{if(!(n>e))throw new br("Input is not a number.");p=g-1}return 0}class ja{constructor(e,r,n){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[c,u]of n)this.labels.push(c),this.outputs.push(u)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const n=r.parse(e[1],1,tt);if(!n)return null;const c=[];let u=null;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);for(let p=1;p<e.length;p+=2){const g=p===1?-1/0:e[p],v=e[p+1],w=p,A=p+1;if(typeof g!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(c.length&&c[c.length-1][0]>=g)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const C=r.parse(v,A,u);if(!C)return null;u=u||C.type,c.push([g,C])}return new ja(u,n,c)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return n[0].evaluate(e);const u=r.length;return c>=r[u-1]?n[u-1].evaluate(e):n[Na(r,c)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}function _i(t,e,r){return t*(1-r)+e*r}var Os=Object.freeze({__proto__:null,number:_i,color:function(t,e,r){return new ii(_i(t.r,e.r,r),_i(t.g,e.g,r),_i(t.b,e.b,r),_i(t.a,e.a,r))},array:function(t,e,r){return t.map((n,c)=>_i(n,e[c],r))}});const ju=.95047,Ga=1.08883,tc=4/29,Fs=6/29,Gu=3*Fs*Fs,Kd=Math.PI/180,Yd=180/Math.PI;function Us(t){return t>.008856451679035631?Math.pow(t,1/3):t/Gu+tc}function Vs(t){return t>Fs?t*t*t:Gu*(t-tc)}function Ns(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function $a(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function $u(t){const e=$a(t.r),r=$a(t.g),n=$a(t.b),c=Us((.4124564*e+.3575761*r+.1804375*n)/ju),u=Us((.2126729*e+.7151522*r+.072175*n)/1);return{l:116*u-16,a:500*(c-u),b:200*(u-Us((.0193339*e+.119192*r+.9503041*n)/Ga)),alpha:t.a}}function Zu(t){let e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*Vs(e),r=ju*Vs(r),n=Ga*Vs(n),new ii(Ns(3.2404542*r-1.5371385*e-.4985314*n),Ns(-.969266*r+1.8760108*e+.041556*n),Ns(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}function Jd(t,e,r){const n=e-t;return t+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const Za={forward:$u,reverse:Zu,interpolate:function(t,e,r){return{l:_i(t.l,e.l,r),a:_i(t.a,e.a,r),b:_i(t.b,e.b,r),alpha:_i(t.alpha,e.alpha,r)}}},qa={forward:function(t){const{l:e,a:r,b:n}=$u(t),c=Math.atan2(n,r)*Yd;return{h:c<0?c+360:c,c:Math.sqrt(r*r+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Kd,r=t.c;return Zu({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:Jd(t.h,e.h,r),c:_i(t.c,e.c,r),l:_i(t.l,e.l,r),alpha:_i(t.alpha,e.alpha,r)}}};var qu=Object.freeze({__proto__:null,lab:Za,hcl:qa});class qr{constructor(e,r,n,c,u){this.type=e,this.operator=r,this.interpolation=n,this.input=c,this.labels=[],this.outputs=[];for(const[p,g]of u)this.labels.push(p),this.outputs.push(g)}static interpolationFactor(e,r,n,c){let u=0;if(e.name==="exponential")u=js(r,e.base,n,c);else if(e.name==="linear")u=js(r,1,n,c);else if(e.name==="cubic-bezier"){const p=e.controlPoints;u=new U(p[0],p[1],p[2],p[3]).solve(js(r,1,n,c))}return u}static parse(e,r){let[n,c,u,...p]=e;if(!Array.isArray(c)||c.length===0)return r.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const w=c[1];if(typeof w!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:w}}else{if(c[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const w=c.slice(1);if(w.length!==4||w.some(A=>typeof A!="number"||A<0||A>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(u=r.parse(u,2,tt),!u)return null;const g=[];let v=null;n==="interpolate-hcl"||n==="interpolate-lab"?v=Wn:r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType);for(let w=0;w<p.length;w+=2){const A=p[w],C=p[w+1],M=w+3,L=w+4;if(typeof A!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(g.length&&g[g.length-1][0]>=A)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const B=r.parse(C,L,v);if(!B)return null;v=v||B.type,g.push([A,B])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new qr(v,n,c,u,g):r.error(`Type ${Wi(v)} is not interpolatable.`)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return n[0].evaluate(e);const u=r.length;if(c>=r[u-1])return n[u-1].evaluate(e);const p=Na(r,c),g=qr.interpolationFactor(this.interpolation,c,r[p],r[p+1]),v=n[p].evaluate(e),w=n[p+1].evaluate(e);return this.operator==="interpolate"?Os[this.type.kind.toLowerCase()](v,w,g):this.operator==="interpolate-hcl"?qa.reverse(qa.interpolate(qa.forward(v),qa.forward(w),g)):Za.reverse(Za.interpolate(Za.forward(v),Za.forward(w),g))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)r.push(this.labels[n],this.outputs[n].serialize());return r}}function js(t,e,r,n){const c=n-r,u=t-r;return c===0?0:e===1?u/c:(Math.pow(e,u)-1)/(Math.pow(e,c)-1)}class Uo{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let n=null;const c=r.expectedType;c&&c.kind!=="value"&&(n=c);const u=[];for(const g of e.slice(1)){const v=r.parse(g,1+u.length,n,void 0,{typeAnnotation:"omit"});if(!v)return null;n=n||v.type,u.push(v)}const p=c&&u.some(g=>Zr(c,g.type));return new Uo(p?Ot:n,u)}evaluate(e){let r,n=null,c=0;for(const u of this.args){if(c++,n=u.evaluate(e),n&&n instanceof yn&&!n.available&&(r||(r=n),n=null,c===this.args.length))return r;if(n!==null)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Gs{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let u=1;u<e.length-1;u+=2){const p=e[u];if(typeof p!="string")return r.error(`Expected string, but found ${typeof p} instead.`,u);if(/[^a-zA-Z0-9_]/.test(p))return r.error("Variable names must contain only alphanumeric characters or '_'.",u);const g=r.parse(e[u+1],u+1);if(!g)return null;n.push([p,g])}const c=r.parse(e[e.length-1],e.length-1,r.expectedType,n);return c?new Gs(n,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,n]of this.bindings)e.push(r,n.serialize());return e.push(this.result.serialize()),e}}class ic{constructor(e,r,n){this.type=e,this.index=r,this.input=n}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,tt),c=r.parse(e[2],2,gn(r.expectedType||Ot));return n&&c?new ic(c.type.itemType,n,c):null}evaluate(e){const r=this.index.evaluate(e),n=this.input.evaluate(e);if(r<0)throw new br(`Array index out of bounds: ${r} < 0.`);if(r>=n.length)throw new br(`Array index out of bounds: ${r} > ${n.length-1}.`);if(r!==Math.floor(r))throw new br(`Array index must be an integer, but found ${r} instead.`);return n[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class rc{constructor(e,r){this.type=Bt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Ot),c=r.parse(e[2],2,Ot);return n&&c?Is(n.type,[Bt,Zt,tt,xo,Ot])?new rc(n,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(n.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!ta(r,["boolean","string","number","null"]))throw new br(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(rr(r))} instead.`);if(!ta(n,["string","array"]))throw new br(`Expected second argument to be of type array or string, but found ${Wi(rr(n))} instead.`);return n.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Bn{constructor(e,r,n){this.type=tt,this.needle=e,this.haystack=r,this.fromIndex=n}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Ot),c=r.parse(e[2],2,Ot);if(!n||!c)return null;if(!Is(n.type,[Bt,Zt,tt,xo,Ot]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(n.type)} instead`);if(e.length===4){const u=r.parse(e[3],3,tt);return u?new Bn(n,c,u):null}return new Bn(n,c)}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!ta(r,["boolean","string","number","null"]))throw new br(`Expected first argument to be of type boolean, string, number or null, but found ${Wi(rr(r))} instead.`);if(!ta(n,["string","array"]))throw new br(`Expected second argument to be of type array or string, but found ${Wi(rr(n))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return n.indexOf(r,c)}return n.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class $s{constructor(e,r,n,c,u,p){this.inputType=e,this.type=r,this.input=n,this.cases=c,this.outputs=u,this.otherwise=p}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let n,c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const u={},p=[];for(let w=2;w<e.length-1;w+=2){let A=e[w];const C=e[w+1];Array.isArray(A)||(A=[A]);const M=r.concat(w);if(A.length===0)return M.error("Expected at least one branch label.");for(const B of A){if(typeof B!="number"&&typeof B!="string")return M.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return M.error("Numeric branch labels must be integer values.");if(n){if(M.checkSubtype(n,rr(B)))return null}else n=rr(B);if(u[String(B)]!==void 0)return M.error("Branch labels must be unique.");u[String(B)]=p.length}const L=r.parse(C,w,c);if(!L)return null;c=c||L.type,p.push(L)}const g=r.parse(e[1],1,Ot);if(!g)return null;const v=r.parse(e[e.length-1],e.length-1,c);return v?g.type.kind!=="value"&&r.concat(1).checkSubtype(n,g.type)?null:new $s(n,c,g,u,p,v):null}evaluate(e){const r=this.input.evaluate(e);return(rr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),n=[],c={};for(const p of r){const g=c[this.cases[p]];g===void 0?(c[this.cases[p]]=n.length,n.push([this.cases[p],[p]])):n[g][1].push(p)}const u=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,g]of n)e.push(g.length===1?u(g[0]):g.map(u)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class So{constructor(e,r,n){this.type=e,this.branches=r,this.otherwise=n}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let n;r.expectedType&&r.expectedType.kind!=="value"&&(n=r.expectedType);const c=[];for(let p=1;p<e.length-1;p+=2){const g=r.parse(e[p],p,Bt);if(!g)return null;const v=r.parse(e[p+1],p+1,n);if(!v)return null;c.push([g,v]),n=n||v.type}const u=r.parse(e[e.length-1],e.length-1,n);return u?new So(n,c,u):null}evaluate(e){for(const[r,n]of this.branches)if(r.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,n]of this.branches)e(r),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Wa{constructor(e,r,n,c){this.type=e,this.input=r,this.beginIndex=n,this.endIndex=c}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Ot),c=r.parse(e[2],2,tt);if(!n||!c)return null;if(!Is(n.type,[gn(Ot),Zt,Ot]))return r.error(`Expected first argument to be of type array or string, but found ${Wi(n.type)} instead`);if(e.length===4){const u=r.parse(e[3],3,tt);return u?new Wa(n.type,n,c,u):null}return new Wa(n.type,n,c)}evaluate(e){const r=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!ta(r,["string","array"]))throw new br(`Expected first argument to be of type array or string, but found ${Wi(rr(r))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return r.slice(n,c)}return r.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Wu(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Zs(t,e,r,n){return n.compare(e,r)===0}function Eo(t,e,r){const n=t!=="=="&&t!=="!=";return class Cv{constructor(u,p,g){this.type=Bt,this.lhs=u,this.rhs=p,this.collator=g,this.hasUntypedArgument=u.type.kind==="value"||p.type.kind==="value"}static parse(u,p){if(u.length!==3&&u.length!==4)return p.error("Expected two or three arguments.");const g=u[0];let v=p.parse(u[1],1,Ot);if(!v)return null;if(!Wu(g,v.type))return p.concat(1).error(`"${g}" comparisons are not supported for type '${Wi(v.type)}'.`);let w=p.parse(u[2],2,Ot);if(!w)return null;if(!Wu(g,w.type))return p.concat(2).error(`"${g}" comparisons are not supported for type '${Wi(w.type)}'.`);if(v.type.kind!==w.type.kind&&v.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${Wi(v.type)}' and '${Wi(w.type)}'.`);n&&(v.type.kind==="value"&&w.type.kind!=="value"?v=new vn(w.type,[v]):v.type.kind!=="value"&&w.type.kind==="value"&&(w=new vn(v.type,[w])));let A=null;if(u.length===4){if(v.type.kind!=="string"&&w.type.kind!=="string"&&v.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(A=p.parse(u[3],3,La),!A)return null}return new Cv(v,w,A)}evaluate(u){const p=this.lhs.evaluate(u),g=this.rhs.evaluate(u);if(n&&this.hasUntypedArgument){const v=rr(p),w=rr(g);if(v.kind!==w.kind||v.kind!=="string"&&v.kind!=="number")throw new br(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${v.kind}, ${w.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const v=rr(p),w=rr(g);if(v.kind!=="string"||w.kind!=="string")return e(u,p,g)}return this.collator?r(u,p,g,this.collator.evaluate(u)):e(u,p,g)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[t];return this.eachChild(p=>{u.push(p.serialize())}),u}}}const Hu=Eo("==",function(t,e,r){return e===r},Zs),nc=Eo("!=",function(t,e,r){return e!==r},function(t,e,r,n){return!Zs(0,e,r,n)}),oc=Eo("<",function(t,e,r){return e<r},function(t,e,r,n){return n.compare(e,r)<0}),Xu=Eo(">",function(t,e,r){return e>r},function(t,e,r,n){return n.compare(e,r)>0}),ac=Eo("<=",function(t,e,r){return e<=r},function(t,e,r,n){return n.compare(e,r)<=0}),Ku=Eo(">=",function(t,e,r){return e>=r},function(t,e,r,n){return n.compare(e,r)>=0});class qs{constructor(e,r,n,c,u){this.type=Zt,this.number=e,this.locale=r,this.currency=n,this.minFractionDigits=c,this.maxFractionDigits=u}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const n=r.parse(e[1],1,tt);if(!n)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let u=null;if(c.locale&&(u=r.parse(c.locale,1,Zt),!u))return null;let p=null;if(c.currency&&(p=r.parse(c.currency,1,Zt),!p))return null;let g=null;if(c["min-fraction-digits"]&&(g=r.parse(c["min-fraction-digits"],1,tt),!g))return null;let v=null;return c["max-fraction-digits"]&&(v=r.parse(c["max-fraction-digits"],1,tt),!v)?null:new qs(n,u,p,g,v)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ws{constructor(e){this.type=tt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=r.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Wi(n.type)} instead.`):new Ws(n):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new br(`Expected value to be of type string or array, but found ${Wi(rr(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const On={"==":Hu,"!=":nc,">":Xu,"<":oc,">=":Ku,"<=":ac,array:vn,at:ic,boolean:vn,case:So,coalesce:Uo,collator:Oa,format:Hn,image:Oo,in:rc,"index-of":Bn,interpolate:qr,"interpolate-hcl":qr,"interpolate-lab":qr,length:Ws,let:Gs,literal:wo,match:$s,number:vn,"number-format":qs,object:vn,slice:Wa,step:ja,string:vn,"to-boolean":Xn,"to-color":Xn,"to-number":Xn,"to-string":Xn,var:Ls,within:Fo};function sc(t,[e,r,n,c]){e=e.evaluate(t),r=r.evaluate(t),n=n.evaluate(t);const u=c?c.evaluate(t):1,p=Pu(e,r,n,u);if(p)throw new br(p);return new ii(e/255*u,r/255*u,n/255*u,u)}function lc(t,e){return t in e}function Ha(t,e){const r=e[t];return r===void 0?null:r}function Ao(t){return{type:t}}function Yu(t){return{result:"success",value:t}}function to(t){return{result:"error",value:t}}function oa(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Ju(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function cc(t){return!!t.expression&&t.expression.interpolated}function si(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Hs(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Xs(t){return t}function Xa(t,e){const r=e.type==="color",n=t.stops&&typeof t.stops[0][0]=="object",c=n||!(n||t.property!==void 0),u=t.type||(cc(e)?"exponential":"interval");if(r&&((t=vo({},t)).stops&&(t.stops=t.stops.map(w=>[w[0],ii.parse(w[1])])),t.default=ii.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!qu[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let p,g,v;if(u==="exponential")p=Qu;else if(u==="interval")p=Qd;else if(u==="categorical"){p=Ks,g=Object.create(null);for(const w of t.stops)g[w[0]]=w[1];v=typeof t.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);p=ef}if(n){const w={},A=[];for(let L=0;L<t.stops.length;L++){const B=t.stops[L],G=B[0].zoom;w[G]===void 0&&(w[G]={zoom:G,type:t.type,property:t.property,default:t.default,stops:[]},A.push(G)),w[G].stops.push([B[0].value,B[1]])}const C=[];for(const L of A)C.push([w[L].zoom,Xa(w[L],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:qr.interpolationFactor.bind(void 0,M),zoomStops:C.map(L=>L[0]),evaluate:({zoom:L},B)=>Qu({stops:C,base:t.base},e,L).evaluate(L,B)}}if(c){const w=u==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:qr.interpolationFactor.bind(void 0,w),zoomStops:t.stops.map(A=>A[0]),evaluate:({zoom:A})=>p(t,e,A,g,v)}}return{kind:"source",evaluate(w,A){const C=A&&A.properties?A.properties[t.property]:void 0;return C===void 0?Ir(t.default,e.default):p(t,e,C,g,v)}}}function Ir(t,e,r){return t!==void 0?t:e!==void 0?e:r!==void 0?r:void 0}function Ks(t,e,r,n,c){return Ir(typeof r===c?n[r]:void 0,t.default,e.default)}function Qd(t,e,r){if(si(r)!=="number")return Ir(t.default,e.default);const n=t.stops.length;if(n===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];const c=Na(t.stops.map(u=>u[0]),r);return t.stops[c][1]}function Qu(t,e,r){const n=t.base!==void 0?t.base:1;if(si(r)!=="number")return Ir(t.default,e.default);const c=t.stops.length;if(c===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[c-1][0])return t.stops[c-1][1];const u=Na(t.stops.map(A=>A[0]),r),p=function(A,C,M,L){const B=L-M,G=A-M;return B===0?0:C===1?G/B:(Math.pow(C,G)-1)/(Math.pow(C,B)-1)}(r,n,t.stops[u][0],t.stops[u+1][0]),g=t.stops[u][1],v=t.stops[u+1][1];let w=Os[e.type]||Xs;if(t.colorSpace&&t.colorSpace!=="rgb"){const A=qu[t.colorSpace];w=(C,M)=>A.reverse(A.interpolate(A.forward(C),A.forward(M),p))}return typeof g.evaluate=="function"?{evaluate(...A){const C=g.evaluate.apply(void 0,A),M=v.evaluate.apply(void 0,A);if(C!==void 0&&M!==void 0)return w(C,M,p)}}:w(g,v,p)}function ef(t,e,r){return e.type==="color"?r=ii.parse(r):e.type==="formatted"?r=Pt.fromString(r.toString()):e.type==="resolvedImage"?r=yn.fromString(r.toString()):si(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),Ir(r,t.default,e.default)}on.register(On,{error:[{kind:"error"},[Zt],(t,[e])=>{throw new br(e.evaluate(t))}],typeof:[Zt,[Ot],(t,[e])=>Wi(rr(e.evaluate(t)))],"to-rgba":[gn(tt,4),[Wn],(t,[e])=>e.evaluate(t).toArray()],rgb:[Wn,[tt,tt,tt],sc],rgba:[Wn,[tt,tt,tt,tt],sc],has:{type:Bt,overloads:[[[Zt],(t,[e])=>lc(e.evaluate(t),t.properties())],[[Zt,ea],(t,[e,r])=>lc(e.evaluate(t),r.evaluate(t))]]},get:{type:Ot,overloads:[[[Zt],(t,[e])=>Ha(e.evaluate(t),t.properties())],[[Zt,ea],(t,[e,r])=>Ha(e.evaluate(t),r.evaluate(t))]]},"feature-state":[Ot,[Zt],(t,[e])=>Ha(e.evaluate(t),t.featureState||{})],properties:[ea,[],t=>t.properties()],"geometry-type":[Zt,[],t=>t.geometryType()],id:[Ot,[],t=>t.id()],zoom:[tt,[],t=>t.globals.zoom],pitch:[tt,[],t=>t.globals.pitch||0],"distance-from-center":[tt,[],t=>t.distanceFromCenter()],"heatmap-density":[tt,[],t=>t.globals.heatmapDensity||0],"line-progress":[tt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[tt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Ot,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[tt,Ao(tt),(t,e)=>{let r=0;for(const n of e)r+=n.evaluate(t);return r}],"*":[tt,Ao(tt),(t,e)=>{let r=1;for(const n of e)r*=n.evaluate(t);return r}],"-":{type:tt,overloads:[[[tt,tt],(t,[e,r])=>e.evaluate(t)-r.evaluate(t)],[[tt],(t,[e])=>-e.evaluate(t)]]},"/":[tt,[tt,tt],(t,[e,r])=>e.evaluate(t)/r.evaluate(t)],"%":[tt,[tt,tt],(t,[e,r])=>e.evaluate(t)%r.evaluate(t)],ln2:[tt,[],()=>Math.LN2],pi:[tt,[],()=>Math.PI],e:[tt,[],()=>Math.E],"^":[tt,[tt,tt],(t,[e,r])=>Math.pow(e.evaluate(t),r.evaluate(t))],sqrt:[tt,[tt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[tt,[tt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[tt,[tt],(t,[e])=>Math.log(e.evaluate(t))],log2:[tt,[tt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[tt,[tt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[tt,[tt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[tt,[tt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[tt,[tt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[tt,[tt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[tt,[tt],(t,[e])=>Math.atan(e.evaluate(t))],min:[tt,Ao(tt),(t,e)=>Math.min(...e.map(r=>r.evaluate(t)))],max:[tt,Ao(tt),(t,e)=>Math.max(...e.map(r=>r.evaluate(t)))],abs:[tt,[tt],(t,[e])=>Math.abs(e.evaluate(t))],round:[tt,[tt],(t,[e])=>{const r=e.evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[tt,[tt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[tt,[tt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Bt,[Zt,Ot],(t,[e,r])=>t.properties()[e.value]===r.value],"filter-id-==":[Bt,[Ot],(t,[e])=>t.id()===e.value],"filter-type-==":[Bt,[Zt],(t,[e])=>t.geometryType()===e.value],"filter-<":[Bt,[Zt,Ot],(t,[e,r])=>{const n=t.properties()[e.value],c=r.value;return typeof n==typeof c&&n<c}],"filter-id-<":[Bt,[Ot],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r<n}],"filter->":[Bt,[Zt,Ot],(t,[e,r])=>{const n=t.properties()[e.value],c=r.value;return typeof n==typeof c&&n>c}],"filter-id->":[Bt,[Ot],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r>n}],"filter-<=":[Bt,[Zt,Ot],(t,[e,r])=>{const n=t.properties()[e.value],c=r.value;return typeof n==typeof c&&n<=c}],"filter-id-<=":[Bt,[Ot],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r<=n}],"filter->=":[Bt,[Zt,Ot],(t,[e,r])=>{const n=t.properties()[e.value],c=r.value;return typeof n==typeof c&&n>=c}],"filter-id->=":[Bt,[Ot],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r>=n}],"filter-has":[Bt,[Ot],(t,[e])=>e.value in t.properties()],"filter-has-id":[Bt,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Bt,[gn(Zt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Bt,[gn(Ot)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Bt,[Zt,gn(Ot)],(t,[e,r])=>r.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Bt,[Zt,gn(Ot)],(t,[e,r])=>function(n,c,u,p){for(;u<=p;){const g=u+p>>1;if(c[g]===n)return!0;c[g]>n?p=g-1:u=g+1}return!1}(t.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Bt,overloads:[[[Bt,Bt],(t,[e,r])=>e.evaluate(t)&&r.evaluate(t)],[Ao(Bt),(t,e)=>{for(const r of e)if(!r.evaluate(t))return!1;return!0}]]},any:{type:Bt,overloads:[[[Bt,Bt],(t,[e,r])=>e.evaluate(t)||r.evaluate(t)],[Ao(Bt),(t,e)=>{for(const r of e)if(r.evaluate(t))return!0;return!1}]]},"!":[Bt,[Bt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Bt,[Zt],(t,[e])=>{const r=t.globals&&t.globals.isSupportedScript;return!r||r(e.evaluate(t))}],upcase:[Zt,[Zt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Zt,[Zt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Zt,Ao(Ot),(t,e)=>e.map(r=>Ba(r.evaluate(t))).join("")],"resolved-locale":[Zt,[La],(t,[e])=>e.evaluate(t).resolvedLocale()]});class uc{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new Lu,this._defaultValue=r?function(n){return n.type==="color"&&Hs(n.default)?new ii(0,0,0,0):n.type==="color"?ii.parse(n.default)||null:n.default===void 0?null:n.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,n,c,u,p,g,v){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=n,this._evaluator.canonical=c,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,n,c,u,p,g,v){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=n||null,this._evaluator.canonical=c,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=v||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new br(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console!="undefined"&&console.warn(w.message)),this._defaultValue}}}function aa(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in On}function Ka(t,e){const r=new Rs(On,[],e?function(c){const u={color:Wn,string:Zt,number:tt,enum:Zt,boolean:Bt,formatted:bo,resolvedImage:Ra};return c.type==="array"?gn(u[c.value]||Ot,c.length):u[c.type]}(e):void 0),n=r.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?Yu(new uc(n,e)):to(r.errors)}class Ya{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Ua(r.expression)}evaluateWithoutErrorHandling(e,r,n,c,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,c,u,p)}evaluate(e,r,n,c,u,p){return this._styleExpression.evaluate(e,r,n,c,u,p)}}class hc{constructor(e,r,n,c){this.kind=e,this.zoomStops=n,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Ua(r.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,r,n,c,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,c,u,p)}evaluate(e,r,n,c,u,p){return this._styleExpression.evaluate(e,r,n,c,u,p)}interpolationFactor(e,r,n){return this.interpolationType?qr.interpolationFactor(this.interpolationType,e,r,n):0}}function eh(t,e){if((t=Ka(t,e)).result==="error")return t;const r=t.value.expression,n=na(r);if(!n&&!oa(e))return to([new qn("","data expressions not supported")]);const c=Va(r,["zoom","pitch","distance-from-center"]);if(!c&&!Ju(e))return to([new qn("","zoom expressions not supported")]);const u=Ys(r);return u||c?u instanceof qn?to([u]):u instanceof qr&&!cc(e)?to([new qn("",'"interpolate" expressions cannot be used with this property')]):Yu(u?new hc(n?"camera":"composite",t.value,u.labels,u instanceof qr?u.interpolation:void 0):new Ya(n?"constant":"source",t.value)):to([new qn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class sa{constructor(e,r){this._parameters=e,this._specification=r,vo(this,Xa(this._parameters,this._specification))}static deserialize(e){return new sa(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ys(t){let e=null;if(t instanceof Gs)e=Ys(t.result);else if(t instanceof Uo){for(const r of t.args)if(e=Ys(r),e)break}else(t instanceof ja||t instanceof qr)&&t.input instanceof on&&t.input.name==="zoom"&&(e=t);return e instanceof qn||t.eachChild(r=>{const n=Ys(r);n instanceof qn?e=n:!e&&n?e=new qn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new qn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function xn(t){const e=t.key,r=t.value,n=t.valueSpec||{},c=t.objectElementValidators||{},u=t.style,p=t.styleSpec;let g=[];const v=si(r);if(v!=="object")return[new it(e,r,`object expected, ${v} found`)];for(const w in r){const A=w.split(".")[0],C=n[A]||n["*"];let M;if(c[A])M=c[A];else if(n[A])M=wr;else if(c["*"])M=c["*"];else{if(!n["*"]){g.push(new it(e,r[w],`unknown property "${w}"`));continue}M=wr}g=g.concat(M({key:(e&&`${e}.`)+w,value:r[w],valueSpec:C,style:u,styleSpec:p,object:r,objectKey:w},r))}for(const w in n)c[w]||n[w].required&&n[w].default===void 0&&r[w]===void 0&&g.push(new it(e,r,`missing required property "${w}"`));return g}function dc(t){const e=t.value,r=t.valueSpec,n=t.style,c=t.styleSpec,u=t.key,p=t.arrayElementValidator||wr;if(si(e)!=="array")return[new it(u,e,`array expected, ${si(e)} found`)];if(r.length&&e.length!==r.length)return[new it(u,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new it(u,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let g={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum};c.$version<7&&(g.function=r.function),si(r.value)==="object"&&(g=r.value);let v=[];for(let w=0;w<e.length;w++)v=v.concat(p({array:e,arrayIndex:w,value:e[w],valueSpec:g,style:n,styleSpec:c,key:`${u}[${w}]`}));return v}function th(t){const e=t.key,r=t.value,n=t.valueSpec;let c=si(r);if(c==="number"&&r!=r&&(c="NaN"),c!=="number")return[new it(e,r,`number expected, ${c} found`)];if("minimum"in n){let u=n.minimum;if(si(n.minimum)==="array"&&(u=n.minimum[t.arrayIndex]),r<u)return[new it(e,r,`${r} is less than the minimum value ${u}`)]}if("maximum"in n){let u=n.maximum;if(si(n.maximum)==="array"&&(u=n.maximum[t.arrayIndex]),r>u)return[new it(e,r,`${r} is greater than the maximum value ${u}`)]}return[]}function Js(t){const e=t.valueSpec,r=Ji(t.value.type);let n,c,u,p={};const g=r!=="categorical"&&t.value.property===void 0,v=!g,w=si(t.value.stops)==="array"&&si(t.value.stops[0])==="array"&&si(t.value.stops[0][0])==="object",A=xn({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(L){if(r==="identity")return[new it(L.key,L.value,'identity function may not have a "stops" property')];let B=[];const G=L.value;return B=B.concat(dc({key:L.key,value:G,valueSpec:L.valueSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:C})),si(G)==="array"&&G.length===0&&B.push(new it(L.key,G,"array must have at least one stop")),B},default:function(L){return wr({key:L.key,value:L.value,valueSpec:e,style:L.style,styleSpec:L.styleSpec})}}});return r==="identity"&&g&&A.push(new it(t.key,t.value,'missing required property "property"')),r==="identity"||t.value.stops||A.push(new it(t.key,t.value,'missing required property "stops"')),r==="exponential"&&t.valueSpec.expression&&!cc(t.valueSpec)&&A.push(new it(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(v&&!oa(t.valueSpec)?A.push(new it(t.key,t.value,"property functions not supported")):g&&!Ju(t.valueSpec)&&A.push(new it(t.key,t.value,"zoom functions not supported"))),r!=="categorical"&&!w||t.value.property!==void 0||A.push(new it(t.key,t.value,'"property" property is required')),A;function C(L){let B=[];const G=L.value,q=L.key;if(si(G)!=="array")return[new it(q,G,`array expected, ${si(G)} found`)];if(G.length!==2)return[new it(q,G,`array length 2 expected, length ${G.length} found`)];if(w){if(si(G[0])!=="object")return[new it(q,G,`object expected, ${si(G[0])} found`)];if(G[0].zoom===void 0)return[new it(q,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new it(q,G,"object stop key must have value")];if(u&&u>Ji(G[0].zoom))return[new it(q,G[0].zoom,"stop zoom values must appear in ascending order")];Ji(G[0].zoom)!==u&&(u=Ji(G[0].zoom),c=void 0,p={}),B=B.concat(xn({key:`${q}[0]`,value:G[0],valueSpec:{zoom:{}},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:th,value:M}}))}else B=B.concat(M({key:`${q}[0]`,value:G[0],valueSpec:{},style:L.style,styleSpec:L.styleSpec},G));return aa(eo(G[1]))?B.concat([new it(`${q}[1]`,G[1],"expressions are not allowed in function stops.")]):B.concat(wr({key:`${q}[1]`,value:G[1],valueSpec:e,style:L.style,styleSpec:L.styleSpec}))}function M(L,B){const G=si(L.value),q=Ji(L.value),Q=L.value!==null?L.value:B;if(n){if(G!==n)return[new it(L.key,Q,`${G} stop domain type must match previous stop domain type ${n}`)]}else n=G;if(G!=="number"&&G!=="string"&&G!=="boolean")return[new it(L.key,Q,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&r!=="categorical"){let oe=`number expected, ${G} found`;return oa(e)&&r===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new it(L.key,Q,oe)]}return r!=="categorical"||G!=="number"||isFinite(q)&&Math.floor(q)===q?r!=="categorical"&&G==="number"&&c!==void 0&&q<c?[new it(L.key,Q,"stop domain values must appear in ascending order")]:(c=q,r==="categorical"&&q in p?[new it(L.key,Q,"stop domain values must be unique")]:(p[q]=!0,[])):[new it(L.key,Q,`integer expected, found ${q}`)]}}function io(t){const e=(t.expressionContext==="property"?eh:Ka)(eo(t.value),t.valueSpec);if(e.result==="error")return e.value.map(n=>new it(`${t.key}${n.key}`,t.value,n.message));const r=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!r.outputDefined())return[new it(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Ua(r))return[new it(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return fc(r,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Va(r,["zoom","feature-state"]))return[new it(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!na(r))return[new it(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function fc(t,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const c of e.valueSpec.expression.parameters)r.delete(c);if(r.size===0)return[];const n=[];return t instanceof on&&r.has(t.name)?[new it(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(c=>{n.push(...fc(c,e))}),n)}function Qs(t){const e=t.key,r=t.value,n=t.valueSpec,c=[];return Array.isArray(n.values)?n.values.indexOf(Ji(r))===-1&&c.push(new it(e,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(n.values).indexOf(Ji(r))===-1&&c.push(new it(e,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function el(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!el(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function tl(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};el(t)||(t=rl(t));const r=t;let n=!0;try{n=function(w){if(!la(w))return w;let A=eo(w);return ih(A),A=il(A),A}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const c=Ee[`filter_${e}`],u=Ka(n,c);let p=null;if(u.result==="error")throw new Error(u.value.map(w=>`${w.key}: ${w.message}`).join(", "));p=(w,A,C)=>u.value.evaluate(w,A,{},C);let g=null,v=null;if(n!==r){const w=Ka(r,c);if(w.result==="error")throw new Error(w.value.map(A=>`${A.key}: ${A.message}`).join(", "));g=(A,C,M,L,B)=>w.value.evaluate(A,C,{},M,void 0,void 0,L,B),v=!na(w.value.expression)}return p=p,{filter:p,dynamicFilter:g||void 0,needGeometry:pc(n),needFeature:!!v}}function il(t){if(!Array.isArray(t))return t;const e=function(r){if(tf.has(r[0])){for(let n=1;n<r.length;n++)if(la(r[n]))return!0}return r}(t);return e===!0?e:e.map(r=>il(r))}function ih(t){let e=!1;const r=[];if(t[0]==="case"){for(let n=1;n<t.length-1;n+=2)e=e||la(t[n]),r.push(t[n+1]);r.push(t[t.length-1])}else if(t[0]==="match"){e=e||la(t[1]);for(let n=2;n<t.length-1;n+=2)r.push(t[n+1]);r.push(t[t.length-1])}else if(t[0]==="step"){e=e||la(t[1]);for(let n=1;n<t.length-1;n+=2)r.push(t[n+1])}e&&(t.length=0,t.push("any",...r));for(let n=1;n<t.length;n++)ih(t[n])}function la(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<t.length;r++)if(la(t[r]))return!0;return!1}const tf=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function rf(t,e){return t<e?-1:t>e?1:0}function pc(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(pc(t[e]))return!0;return!1}function rl(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?mc(t[1],t[2],"=="):e==="!="?nl(mc(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?mc(t[1],t[2],e):e==="any"?(r=t.slice(1),["any"].concat(r.map(rl))):e==="all"?["all"].concat(t.slice(1).map(rl)):e==="none"?["all"].concat(t.slice(1).map(rl).map(nl)):e==="in"?rh(t[1],t.slice(2)):e==="!in"?nl(rh(t[1],t.slice(2))):e==="has"?nh(t[1]):e==="!has"?nl(nh(t[1])):e!=="within"||t;var r}function mc(t,e,r){switch(t){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,t,e]}}function rh(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",t,["literal",e.sort(rf)]]:["filter-in-small",t,["literal",e]]}}function nh(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function nl(t){return["!",t]}function _c(t){if(el(eo(t.value))){const e=eo(t.layerType);return io(vo({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${e||"fill"}`]}))}return oh(t)}function oh(t){const e=t.value,r=t.key;if(si(e)!=="array")return[new it(r,e,`array expected, ${si(e)} found`)];const n=t.styleSpec;let c,u=[];if(e.length<1)return[new it(r,e,"filter array must have at least 1 element")];switch(u=u.concat(Qs({key:`${r}[0]`,value:e[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),Ji(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Ji(e[1])==="$type"&&u.push(new it(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&u.push(new it(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=si(e[1]),c!=="string"&&u.push(new it(`${r}[1]`,e[1],`string expected, ${c} found`)));for(let p=2;p<e.length;p++)c=si(e[p]),Ji(e[1])==="$type"?u=u.concat(Qs({key:`${r}[${p}]`,value:e[p],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&u.push(new it(`${r}[${p}]`,e[p],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)u=u.concat(oh({key:`${r}[${p}]`,value:e[p],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":c=si(e[1]),e.length!==2?u.push(new it(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&u.push(new it(`${r}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=si(e[1]),e.length!==2?u.push(new it(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&u.push(new it(`${r}[1]`,e[1],`object expected, ${c} found`))}return u}function Ja(t,e){const r=t.key,n=t.style,c=t.styleSpec,u=t.value,p=t.objectKey,g=c[`${e}_${t.layerType}`];if(!g)return[];const v=p.match(/^(.*)-transition$/);if(e==="paint"&&v&&g[v[1]]&&g[v[1]].transition)return wr({key:r,value:u,valueSpec:c.transition,style:n,styleSpec:c});const w=t.valueSpec||g[p];if(!w)return[new it(r,u,`unknown property "${p}"`)];let A;if(si(u)==="string"&&oa(w)&&!w.tokens&&(A=/^{([^}]+)}$/.exec(u)))return[new it(r,u,`"${p}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const C=[];return t.layerType==="symbol"&&(p==="text-field"&&n&&!n.glyphs&&C.push(new it(r,u,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&Hs(eo(u))&&Ji(u.type)==="identity"&&C.push(new it(r,u,'"text-font" does not support identity functions'))),C.concat(wr({key:t.key,value:u,valueSpec:w,style:n,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:p}))}function ah(t){return Ja(t,"paint")}function sh(t){return Ja(t,"layout")}function Qa(t){let e=[];const r=t.value,n=t.key,c=t.style,u=t.styleSpec;r.type||r.ref||e.push(new it(n,r,'either "type" or "ref" is required'));let p=Ji(r.type);const g=Ji(r.ref);if(r.id){const v=Ji(r.id);for(let w=0;w<t.arrayIndex;w++){const A=c.layers[w];Ji(A.id)===v&&e.push(new it(n,r.id,`duplicate layer id "${r.id}", previously used at line ${A.id.__line__}`))}}if("ref"in r){let v;["type","source","source-layer","filter","layout"].forEach(w=>{w in r&&e.push(new it(n,r[w],`"${w}" is prohibited for ref layers`))}),c.layers.forEach(w=>{Ji(w.id)===g&&(v=w)}),v?v.ref?e.push(new it(n,r.ref,"ref cannot reference another ref layer")):p=Ji(v.type):e.push(new it(n,r.ref,`ref layer "${g}" not found`))}else if(p!=="background"&&p!=="sky")if(r.source){const v=c.sources&&c.sources[r.source],w=v&&Ji(v.type);v?w==="vector"&&p==="raster"?e.push(new it(n,r.source,`layer "${r.id}" requires a raster source`)):w==="raster"&&p!=="raster"?e.push(new it(n,r.source,`layer "${r.id}" requires a vector source`)):w!=="vector"||r["source-layer"]?w==="raster-dem"&&p!=="hillshade"?e.push(new it(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!r.paint||!r.paint["line-gradient"]||w==="geojson"&&v.lineMetrics||e.push(new it(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new it(n,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new it(n,r.source,`source "${r.source}" not found`))}else e.push(new it(n,r,'missing required property "source"'));return e=e.concat(xn({key:n,value:r,valueSpec:u.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>wr({key:`${n}.type`,value:r.type,valueSpec:u.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"}),filter:v=>_c(vo({layerType:p},v)),layout:v=>xn({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":w=>sh(vo({layerType:p},w))}}),paint:v=>xn({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":w=>ah(vo({layerType:p},w))}})}})),e}function ca(t){const e=t.value,r=t.key,n=si(e);return n!=="string"?[new it(r,e,`string expected, ${n} found`)]:[]}const gc={promoteId:function({key:t,value:e}){if(si(e)==="string")return ca({key:t,value:e});{const r=[];for(const n in e)r.push(...ca({key:`${t}.${n}`,value:e[n]}));return r}}};function lh(t){const e=t.value,r=t.key,n=t.styleSpec,c=t.style;if(!e.type)return[new it(r,e,'"type" is required')];const u=Ji(e.type);let p;switch(u){case"vector":case"raster":case"raster-dem":return p=xn({key:r,value:e,valueSpec:n[`source_${u.replace("-","_")}`],style:t.style,styleSpec:n,objectElementValidators:gc}),p;case"geojson":if(p=xn({key:r,value:e,valueSpec:n.source_geojson,style:c,styleSpec:n,objectElementValidators:gc}),e.cluster)for(const g in e.clusterProperties){const[v,w]=e.clusterProperties[g],A=typeof v=="string"?[v,["accumulated"],["get",g]]:v;p.push(...io({key:`${r}.${g}.map`,value:w,expressionContext:"cluster-map"})),p.push(...io({key:`${r}.${g}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return p;case"video":return xn({key:r,value:e,valueSpec:n.source_video,style:c,styleSpec:n});case"image":return xn({key:r,value:e,valueSpec:n.source_image,style:c,styleSpec:n});case"canvas":return[new it(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qs({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,styleSpec:n})}}function yc(t){const e=t.value,r=t.styleSpec,n=r.light,c=t.style;let u=[];const p=si(e);if(e===void 0)return u;if(p!=="object")return u=u.concat([new it("light",e,`object expected, ${p} found`)]),u;for(const g in e){const v=g.match(/^(.*)-transition$/);u=u.concat(v&&n[v[1]]&&n[v[1]].transition?wr({key:g,value:e[g],valueSpec:r.transition,style:c,styleSpec:r}):n[g]?wr({key:g,value:e[g],valueSpec:n[g],style:c,styleSpec:r}):[new it(g,e[g],`unknown property "${g}"`)])}return u}function vc(t){const e=t.value,r=t.key,n=t.style,c=t.styleSpec,u=c.terrain;let p=[];const g=si(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new it("terrain",e,`object expected, ${g} found`)]),p;for(const v in e){const w=v.match(/^(.*)-transition$/);p=p.concat(w&&u[w[1]]&&u[w[1]].transition?wr({key:v,value:e[v],valueSpec:c.transition,style:n,styleSpec:c}):u[v]?wr({key:v,value:e[v],valueSpec:u[v],style:n,styleSpec:c}):[new it(v,e[v],`unknown property "${v}"`)])}if(e.source){const v=n.sources&&n.sources[e.source],w=v&&Ji(v.type);v?w!=="raster-dem"&&p.push(new it(r,e.source,`terrain cannot be used with a source of type ${w}, it only be used with a "raster-dem" source type`)):p.push(new it(r,e.source,`source "${e.source}" not found`))}else p.push(new it(r,e,'terrain is missing required property "source"'));return p}function xc(t){const e=t.value,r=t.style,n=t.styleSpec,c=n.fog;let u=[];const p=si(e);if(e===void 0)return u;if(p!=="object")return u=u.concat([new it("fog",e,`object expected, ${p} found`)]),u;for(const g in e){const v=g.match(/^(.*)-transition$/);u=u.concat(v&&c[v[1]]&&c[v[1]].transition?wr({key:g,value:e[g],valueSpec:n.transition,style:r,styleSpec:n}):c[g]?wr({key:g,value:e[g],valueSpec:c[g],style:r,styleSpec:n}):[new it(g,e[g],`unknown property "${g}"`)])}return u}const bc={"*":()=>[],array:dc,boolean:function(t){const e=t.value,r=t.key,n=si(e);return n!=="boolean"?[new it(r,e,`boolean expected, ${n} found`)]:[]},number:th,color:function(t){const e=t.key,r=t.value,n=si(r);return n!=="string"?[new it(e,r,`color expected, ${n} found`)]:ra.parseCSSColor(r)===null?[new it(e,r,`color expected, "${r}" found`)]:[]},constants:zu,enum:Qs,filter:_c,function:Js,layer:Qa,object:xn,source:lh,light:yc,terrain:vc,fog:xc,string:ca,formatted:function(t){return ca(t).length===0?[]:io(t)},resolvedImage:function(t){return ca(t).length===0?[]:io(t)},projection:function(t){const e=t.value,r=t.styleSpec,n=r.projection,c=t.style;let u=[];const p=si(e);if(p==="object")for(const g in e)u=u.concat(wr({key:g,value:e[g],valueSpec:n[g],style:c,styleSpec:r}));else p!=="string"&&(u=u.concat([new it("projection",e,`object or string expected, ${p} found`)]));return u}};function wr(t){const e=t.value,r=t.valueSpec,n=t.styleSpec;return r.expression&&Hs(Ji(e))?Js(t):r.expression&&aa(eo(e))?io(t):r.type&&bc[r.type]?bc[r.type](t):xn(vo({},t,{valueSpec:r.type?n[r.type]:r}))}function wc(t){const e=t.value,r=t.key,n=ca(t);return n.length||(e.indexOf("{fontstack}")===-1&&n.push(new it(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&n.push(new it(r,e,'"glyphs" url must include a "{range}" token'))),n}function ro(t,e=Ee){let r=[];return r=r.concat(wr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:wc,"*":()=>[]}})),t.constants&&(r=r.concat(zu({key:"constants",value:t.constants,style:t,styleSpec:e}))),ch(r)}function ch(t){return[].concat(t).sort((e,r)=>e.line-r.line)}function Fn(t){return function(...e){return ch(t.apply(this,e))}}ro.source=Fn(lh),ro.light=Fn(yc),ro.terrain=Fn(vc),ro.fog=Fn(xc),ro.layer=Fn(Qa),ro.filter=Fn(_c),ro.paintProperty=Fn(ah),ro.layoutProperty=Fn(sh);const ua=ro,ha=ua.light,nf=ua.fog,Tc=ua.paintProperty,of=ua.layoutProperty;function uh(t,e){let r=!1;if(e&&e.length)for(const n of e)t.fire(new Cs(new Error(n.message))),r=!0;return r}var es=Ur;function Ur(t,e,r){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(r=c[2]);for(var u=0;u<this.d*this.d;u++){var p=c[3+u],g=c[3+u+1];n.push(p===g?null:c.subarray(p,g))}var v=c[3+n.length+1];this.keys=c.subarray(c[3+n.length],v),this.bboxes=c.subarray(v),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var w=0;w<this.d*this.d;w++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var A=r/e*t;this.min=-A,this.max=t+A}Ur.prototype.insert=function(t,e,r,n,c){this._forEachCell(e,r,n,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(c)},Ur.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ur.prototype._insertCell=function(t,e,r,n,c,u){this.cells[c].push(u)},Ur.prototype.query=function(t,e,r,n,c){var u=this.min,p=this.max;if(t<=u&&e<=u&&p<=r&&p<=n&&!c)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(t,e,r,n,this._queryCell,g,{},c),g},Ur.prototype._queryCell=function(t,e,r,n,c,u,p,g){var v=this.cells[c];if(v!==null)for(var w=this.keys,A=this.bboxes,C=0;C<v.length;C++){var M=v[C];if(p[M]===void 0){var L=4*M;(g?g(A[L+0],A[L+1],A[L+2],A[L+3]):t<=A[L+2]&&e<=A[L+3]&&r>=A[L+0]&&n>=A[L+1])?(p[M]=!0,u.push(w[M])):p[M]=!1}}},Ur.prototype._forEachCell=function(t,e,r,n,c,u,p,g){for(var v=this._convertToCellCoord(t),w=this._convertToCellCoord(e),A=this._convertToCellCoord(r),C=this._convertToCellCoord(n),M=v;M<=A;M++)for(var L=w;L<=C;L++){var B=this.d*L+M;if((!g||g(this._convertFromCellCoord(M),this._convertFromCellCoord(L),this._convertFromCellCoord(M+1),this._convertFromCellCoord(L+1)))&&c.call(this,t,e,r,n,B,u,p,g))return}},Ur.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Ur.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Ur.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var c=new Int32Array(e+r+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var u=e,p=0;p<t.length;p++){var g=t[p];c[3+p]=u,c.set(g,u),u+=g.length}return c[3+t.length]=u,c.set(this.keys,u),c[3+t.length+1]=u+=this.keys.length,c.set(this.bboxes,u),u+=this.bboxes.length,c.buffer};const{ImageData:ts,ImageBitmap:da}=$,is={};function at(t,e,r={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),is[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}at("Object",Object),es.serialize=function(t,e){const r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},es.deserialize=function(t){return new es(t.buffer)},at("Grid",es),at("Color",ii),at("Error",Error),at("ResolvedImage",yn),at("StylePropertyFunction",sa),at("StyleExpression",uc,{omit:["_evaluator"]}),at("ZoomDependentExpression",hc),at("ZoomConstantExpression",Ya),at("CompoundExpression",on,{omit:["_evaluate"]});for(const t in On)On[t]._classRegistryKey||at(`Expression_${t}`,On[t]);function fa(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function hh(t){return da&&t instanceof da}function rs(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(fa(t)||hh(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const r=t;return e&&e.push(r.buffer),r}if(t instanceof ts)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const r=[];for(const n of t)r.push(rs(n,e));return r}if(typeof t=="object"){const r=t.constructor,n=r._classRegistryKey;if(!n)throw new Error("can't serialize object of unregistered class");const c=r.serialize?r.serialize(t,e):{};if(!r.serialize){for(const u in t){if(!t.hasOwnProperty(u)||is[n].omit.indexOf(u)>=0)continue;const p=t[u];c[u]=is[n].shallow.indexOf(u)>=0?p:rs(p,e)}t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(c.$name=n),c}throw new Error("can't serialize object of type "+typeof t)}function Co(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||fa(t)||hh(t)||ArrayBuffer.isView(t)||t instanceof ts)return t;if(Array.isArray(t))return t.map(Co);if(typeof t=="object"){const e=t.$name||"Object",{klass:r}=is[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(t);const n=Object.create(r.prototype);for(const c of Object.keys(t)){if(c==="$name")continue;const u=t[c];n[c]=is[e].shallow.indexOf(c)>=0?u:Co(u)}return n}throw new Error("can't deserialize object of type "+typeof t)}class h{constructor(){this.first=!0}update(e,r){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}const i=t=>t>=1536&&t<=1791,a=t=>t>=1872&&t<=1919,d=t=>t>=2208&&t<=2303,_=t=>t>=11904&&t<=12031,y=t=>t>=12032&&t<=12255,b=t=>t>=12272&&t<=12287,E=t=>t>=12288&&t<=12351,I=t=>t>=12352&&t<=12447,z=t=>t>=12448&&t<=12543,P=t=>t>=12544&&t<=12591,R=t=>t>=12704&&t<=12735,j=t=>t>=12736&&t<=12783,X=t=>t>=12784&&t<=12799,Z=t=>t>=12800&&t<=13055,K=t=>t>=13056&&t<=13311,ae=t=>t>=13312&&t<=19903,W=t=>t>=19968&&t<=40959,re=t=>t>=40960&&t<=42127,ne=t=>t>=42128&&t<=42191,te=t=>t>=44032&&t<=55215,ie=t=>t>=63744&&t<=64255,se=t=>t>=64336&&t<=65023,ge=t=>t>=65040&&t<=65055,Te=t=>t>=65072&&t<=65103,Ke=t=>t>=65104&&t<=65135,je=t=>t>=65136&&t<=65279,Ve=t=>t>=65280&&t<=65519;function Ae(t){for(const e of t)if(ze(e.charCodeAt(0)))return!0;return!1}function ve(t){for(const e of t)if(!Oe(e.charCodeAt(0)))return!1;return!0}function Oe(t){return!(i(t)||a(t)||d(t)||se(t)||je(t))}function ze(t){return!(t!==746&&t!==747&&(t<4352||!(R(t)||P(t)||Te(t)&&!(t>=65097&&t<=65103)||ie(t)||K(t)||_(t)||j(t)||!(!E(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||ae(t)||W(t)||Z(t)||(e=>e>=12592&&e<=12687)(t)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||te(t)||I(t)||b(t)||(e=>e>=12688&&e<=12703)(t)||y(t)||X(t)||z(t)&&t!==12540||!(!Ve(t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Ke(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||ge(t)||(e=>e>=19904&&e<=19967)(t)||re(t)||ne(t))))}function dt(t){return!(ze(t)||function(e){return!!((r=>r>=128&&r<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(r=>r>=8192&&r<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&e!==9251||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||E(e)||z(e)||(r=>r>=57344&&r<=63743)(e)||Te(e)||Ke(e)||Ve(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function yt(t){return t>=1424&&t<=2303||se(t)||je(t)}function Rt(t,e){return!(!e&&yt(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(r=>r>=6016&&r<=6143)(t))}function Xe(t){for(const e of t)if(yt(e.charCodeAt(0)))return!0;return!1}const _t="deferred",Mt="loading",yi="loaded";let Mi=null,St="unavailable",Vt=null;const Bi=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(St="error"),Mi&&Mi(t)};function ur(){Wr.fire(new go("pluginStateChange",{pluginStatus:St,pluginURL:Vt}))}const Wr=new yo,bn=function(){return St},Un=function(){if(St!==_t||!Vt)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");St=Mt,ur(),Vt&&Pa({url:Vt},t=>{t?Bi(t):(St=yi,ur())})},Qt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>St===yi||Qt.applyArabicShaping!=null,isLoading:()=>St===Mt,setState(t){St=t.pluginStatus,Vt=t.pluginURL},isParsed:()=>Qt.applyArabicShaping!=null&&Qt.processBidirectionalText!=null&&Qt.processStyledBidirectionalText!=null,getPluginURL:()=>Vt};class It{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new h,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,n){for(const c of r)if(!Rt(c.charCodeAt(0),n))return!1;return!0}(e,Qt.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*r}}}class qt{constructor(e,r){this.property=e,this.value=r,this.expression=function(n,c){if(Hs(n))return new sa(n,c);if(aa(n)){const u=eh(n,c);if(u.result==="error")throw new Error(u.value.map(p=>`${p.key}: ${p.message}`).join(", "));return u.value}{let u=n;return typeof n=="string"&&c.type==="color"&&(u=ii.parse(n)),{kind:"constant",evaluate:()=>u}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,n){return this.property.possiblyEvaluate(this,e,r,n)}}class Xi{constructor(e){this.property=e,this.value=new qt(e,void 0)}transitioned(e,r){return new Li(this.property,this.value,r,Gt({},e.transition,this.transition),e.now)}untransitioned(){return new Li(this.property,this.value,null,{},0)}}class an{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ne(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Xi(this._values[e].property)),this._values[e].value=new qt(this._values[e].property,r===null?void 0:Ne(r))}getTransition(e){return Ne(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Xi(this._values[e].property)),this._values[e].transition=Ne(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n);const c=this.getTransition(r);c!==void 0&&(e[`${r}-transition`]=c)}return e}transitioned(e,r){const n=new sn(this._properties);for(const c of Object.keys(this._values))n._values[c]=this._values[c].transitioned(e,r._values[c]);return n}untransitioned(){const e=new sn(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Li{constructor(e,r,n,c,u){const p=c.delay||0,g=c.duration||0;u=u||0,this.property=e,this.value=r,this.begin=u+p,this.end=this.begin+g,e.specification.transition&&(c.delay||c.duration)&&(this.prior=n)}possiblyEvaluate(e,r,n){const c=e.now||0,u=this.value.possiblyEvaluate(e,r,n),p=this.prior;if(p){if(c>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(c<this.begin)return p.possiblyEvaluate(e,r,n);{const g=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,r,n),u,Dr(g))}}return u}}class sn{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,n){const c=new Vo(this._properties);for(const u of Object.keys(this._values))c._values[u]=this._values[u].possiblyEvaluate(e,r,n);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ns{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Ne(this._values[e].value)}setValue(e,r){this._values[e]=new qt(this._values[e].property,r===null?void 0:Ne(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n)}return e}possiblyEvaluate(e,r,n){const c=new Vo(this._properties);for(const u of Object.keys(this._values))c._values[u]=this._values[u].possiblyEvaluate(e,r,n);return c}}class Hr{constructor(e,r,n){this.property=e,this.value=r,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,n,c){return this.property.evaluate(this.value,this.parameters,e,r,n,c)}}class Vo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class lt{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,n){const c=Os[this.specification.type];return c?c(e,r,n):e}}class gt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,n,c){return new Hr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},n,c)}:e.expression,r)}interpolate(e,r,n){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Hr(this,{kind:"constant",value:void 0},e.parameters);const c=Os[this.specification.type];return c?new Hr(this,{kind:"constant",value:c(e.value.value,r.value.value,n)},e.parameters):e}evaluate(e,r,n,c,u,p){return e.kind==="constant"?e.value:e.evaluate(r,n,c,u,p)}}class Tr extends gt{possiblyEvaluate(e,r,n,c){if(e.value===void 0)return new Hr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const u=e.expression.evaluate(r,null,{},n,c),p=e.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,g=this._calculate(p,p,p,r);return new Hr(this,{kind:"constant",value:g},r)}if(e.expression.kind==="camera"){const u=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new Hr(this,{kind:"constant",value:u},r)}return new Hr(this,e.expression,r)}evaluate(e,r,n,c,u,p){if(e.kind==="source"){const g=e.evaluate(r,n,c,u,p);return this._calculate(g,g,g,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},n,c),e.evaluate({zoom:Math.floor(r.zoom)},n,c),e.evaluate({zoom:Math.floor(r.zoom)+1},n,c),r):e.value}_calculate(e,r,n,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r,other:n}:{from:n,to:r,other:e}}interpolate(e){return e}}class No{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const u=e.expression.evaluate(r,null,{},n,c);return this._calculate(u,u,u,r)}return this._calculate(e.expression.evaluate(new It(Math.floor(r.zoom-1),r)),e.expression.evaluate(new It(Math.floor(r.zoom),r)),e.expression.evaluate(new It(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,n,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:n,to:r}}interpolate(e){return e}}class Mo{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,c){return!!e.expression.evaluate(r,null,{},n,c)}interpolate(){return!1}}class kr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const n=e[r];n.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new qt(n,void 0),u=this.defaultTransitionablePropertyValues[r]=new Xi(n);this.defaultTransitioningPropertyValues[r]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate({})}}}function vm(t,e){return 256*(t=Nt(Math.floor(t),0,255))+Nt(Math.floor(e),0,255)}at("DataDrivenProperty",gt),at("DataConstantProperty",lt),at("CrossFadedDataDrivenProperty",Tr),at("CrossFadedProperty",No),at("ColorRampProperty",Mo);const z0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Sc{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class nr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Hi(t,e=1){let r=0,n=0;return{members:t.map(c=>{const u=z0[c.type].BYTES_PER_ELEMENT,p=r=xm(r,Math.max(e,u)),g=c.components||1;return n=Math.max(n,u),r+=u*g,{name:c.name,type:c.type,components:g,offset:p}}),size:xm(r,Math.max(n,e)),alignment:e}}function xm(t,e){return Math.ceil(t/e)*e}class ol extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const c=2*e;return this.int16[c+0]=r,this.int16[c+1]=n,e}}ol.prototype.bytesPerElement=4,at("StructArrayLayout2i4",ol);class al extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,n,c)}emplace(e,r,n,c,u){const p=4*e;return this.int16[p+0]=r,this.int16[p+1]=n,this.int16[p+2]=c,this.int16[p+3]=u,e}}al.prototype.bytesPerElement=8,at("StructArrayLayout4i8",al);class af extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,c,u,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,n,c,u,p,g)}emplace(e,r,n,c,u,p,g,v){const w=6*e,A=12*e,C=3*e;return this.int16[w+0]=r,this.int16[w+1]=n,this.uint8[A+4]=c,this.uint8[A+5]=u,this.uint8[A+6]=p,this.uint8[A+7]=g,this.float32[C+2]=v,e}}af.prototype.bytesPerElement=12,at("StructArrayLayout2i4ub1f12",af);class sl extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,n)}emplace(e,r,n,c){const u=3*e;return this.float32[u+0]=r,this.float32[u+1]=n,this.float32[u+2]=c,e}}sl.prototype.bytesPerElement=12,at("StructArrayLayout3f12",sl);class pa extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,c,u,p,g,v,w,A){const C=this.length;return this.resize(C+1),this.emplace(C,e,r,n,c,u,p,g,v,w,A)}emplace(e,r,n,c,u,p,g,v,w,A,C){const M=10*e;return this.uint16[M+0]=r,this.uint16[M+1]=n,this.uint16[M+2]=c,this.uint16[M+3]=u,this.uint16[M+4]=p,this.uint16[M+5]=g,this.uint16[M+6]=v,this.uint16[M+7]=w,this.uint16[M+8]=A,this.uint16[M+9]=C,e}}pa.prototype.bytesPerElement=20,at("StructArrayLayout10ui20",pa);class dh extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,c,u,p,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,r,n,c,u,p,g,v)}emplace(e,r,n,c,u,p,g,v,w){const A=8*e;return this.uint16[A+0]=r,this.uint16[A+1]=n,this.uint16[A+2]=c,this.uint16[A+3]=u,this.uint16[A+4]=p,this.uint16[A+5]=g,this.uint16[A+6]=v,this.uint16[A+7]=w,e}}dh.prototype.bytesPerElement=16,at("StructArrayLayout8ui16",dh);class sf extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,c,u,p,g,v,w,A,C,M,L,B,G,q){const Q=this.length;return this.resize(Q+1),this.emplace(Q,e,r,n,c,u,p,g,v,w,A,C,M,L,B,G,q)}emplace(e,r,n,c,u,p,g,v,w,A,C,M,L,B,G,q,Q){const oe=16*e;return this.int16[oe+0]=r,this.int16[oe+1]=n,this.int16[oe+2]=c,this.int16[oe+3]=u,this.uint16[oe+4]=p,this.uint16[oe+5]=g,this.uint16[oe+6]=v,this.uint16[oe+7]=w,this.int16[oe+8]=A,this.int16[oe+9]=C,this.int16[oe+10]=M,this.int16[oe+11]=L,this.int16[oe+12]=B,this.int16[oe+13]=G,this.int16[oe+14]=q,this.int16[oe+15]=Q,e}}sf.prototype.bytesPerElement=32,at("StructArrayLayout4i4ui4i4i32",sf);class lf extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}lf.prototype.bytesPerElement=4,at("StructArrayLayout1ul4",lf);class cf extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,c,u,p,g,v,w,A,C,M,L){const B=this.length;return this.resize(B+1),this.emplace(B,e,r,n,c,u,p,g,v,w,A,C,M,L)}emplace(e,r,n,c,u,p,g,v,w,A,C,M,L,B){const G=20*e,q=10*e;return this.int16[G+0]=r,this.int16[G+1]=n,this.int16[G+2]=c,this.int16[G+3]=u,this.int16[G+4]=p,this.float32[q+3]=g,this.float32[q+4]=v,this.float32[q+5]=w,this.float32[q+6]=A,this.int16[G+14]=C,this.uint32[q+8]=M,this.uint16[G+18]=L,this.uint16[G+19]=B,e}}cf.prototype.bytesPerElement=40,at("StructArrayLayout5i4f1i1ul2ui40",cf);class fh extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,c,u,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,n,c,u,p,g)}emplace(e,r,n,c,u,p,g,v){const w=8*e;return this.int16[w+0]=r,this.int16[w+1]=n,this.int16[w+2]=c,this.int16[w+4]=u,this.int16[w+5]=p,this.int16[w+6]=g,this.int16[w+7]=v,e}}fh.prototype.bytesPerElement=16,at("StructArrayLayout3i2i2i16",fh);class uf extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,n,c,u)}emplace(e,r,n,c,u,p){const g=4*e,v=8*e;return this.float32[g+0]=r,this.float32[g+1]=n,this.float32[g+2]=c,this.int16[v+6]=u,this.int16[v+7]=p,e}}uf.prototype.bytesPerElement=16,at("StructArrayLayout2f1f2i16",uf);class hf extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,n,c)}emplace(e,r,n,c,u){const p=12*e,g=3*e;return this.uint8[p+0]=r,this.uint8[p+1]=n,this.float32[g+1]=c,this.float32[g+2]=u,e}}hf.prototype.bytesPerElement=12,at("StructArrayLayout2ub2f12",hf);class Vn extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,n)}emplace(e,r,n,c){const u=3*e;return this.uint16[u+0]=r,this.uint16[u+1]=n,this.uint16[u+2]=c,e}}Vn.prototype.bytesPerElement=6,at("StructArrayLayout3ui6",Vn);class df extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,n,c,u,p,g,v,w,A,C,M,L,B,G,q,Q,oe,ce,de,pe){const me=this.length;return this.resize(me+1),this.emplace(me,e,r,n,c,u,p,g,v,w,A,C,M,L,B,G,q,Q,oe,ce,de,pe)}emplace(e,r,n,c,u,p,g,v,w,A,C,M,L,B,G,q,Q,oe,ce,de,pe,me){const ke=30*e,Ce=15*e,Ye=60*e;return this.int16[ke+0]=r,this.int16[ke+1]=n,this.int16[ke+2]=c,this.float32[Ce+2]=u,this.float32[Ce+3]=p,this.uint16[ke+8]=g,this.uint16[ke+9]=v,this.uint32[Ce+5]=w,this.uint32[Ce+6]=A,this.uint32[Ce+7]=C,this.uint16[ke+16]=M,this.uint16[ke+17]=L,this.uint16[ke+18]=B,this.float32[Ce+10]=G,this.float32[Ce+11]=q,this.uint8[Ye+48]=Q,this.uint8[Ye+49]=oe,this.uint8[Ye+50]=ce,this.uint32[Ce+13]=de,this.int16[ke+28]=pe,this.uint8[Ye+58]=me,e}}df.prototype.bytesPerElement=60,at("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",df);class ff extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,n,c,u,p,g,v,w,A,C,M,L,B,G,q,Q,oe,ce,de,pe,me,ke,Ce,Ye,qe,Ie,We,Qe,Be){const nt=this.length;return this.resize(nt+1),this.emplace(nt,e,r,n,c,u,p,g,v,w,A,C,M,L,B,G,q,Q,oe,ce,de,pe,me,ke,Ce,Ye,qe,Ie,We,Qe,Be)}emplace(e,r,n,c,u,p,g,v,w,A,C,M,L,B,G,q,Q,oe,ce,de,pe,me,ke,Ce,Ye,qe,Ie,We,Qe,Be,nt){const ct=38*e,Kt=19*e;return this.int16[ct+0]=r,this.int16[ct+1]=n,this.int16[ct+2]=c,this.float32[Kt+2]=u,this.float32[Kt+3]=p,this.int16[ct+8]=g,this.int16[ct+9]=v,this.int16[ct+10]=w,this.int16[ct+11]=A,this.int16[ct+12]=C,this.int16[ct+13]=M,this.uint16[ct+14]=L,this.uint16[ct+15]=B,this.uint16[ct+16]=G,this.uint16[ct+17]=q,this.uint16[ct+18]=Q,this.uint16[ct+19]=oe,this.uint16[ct+20]=ce,this.uint16[ct+21]=de,this.uint16[ct+22]=pe,this.uint16[ct+23]=me,this.uint16[ct+24]=ke,this.uint16[ct+25]=Ce,this.uint16[ct+26]=Ye,this.uint16[ct+27]=qe,this.uint16[ct+28]=Ie,this.uint32[Kt+15]=We,this.float32[Kt+16]=Qe,this.float32[Kt+17]=Be,this.float32[Kt+18]=nt,e}}ff.prototype.bytesPerElement=76,at("StructArrayLayout3i2f6i15ui1ul3f76",ff);class ph extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}ph.prototype.bytesPerElement=4,at("StructArrayLayout1f4",ph);class pf extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,n)}emplace(e,r,n,c){const u=3*e;return this.int16[u+0]=r,this.int16[u+1]=n,this.int16[u+2]=c,e}}pf.prototype.bytesPerElement=6,at("StructArrayLayout3i6",pf);class Ec extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,c,u,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,n,c,u,p,g)}emplace(e,r,n,c,u,p,g,v){const w=7*e;return this.float32[w+0]=r,this.float32[w+1]=n,this.float32[w+2]=c,this.float32[w+3]=u,this.float32[w+4]=p,this.float32[w+5]=g,this.float32[w+6]=v,e}}Ec.prototype.bytesPerElement=28,at("StructArrayLayout7f28",Ec);class mf extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,n,c)}emplace(e,r,n,c,u){const p=6*e;return this.uint32[3*e+0]=r,this.uint16[p+2]=n,this.uint16[p+3]=c,this.uint16[p+4]=u,e}}mf.prototype.bytesPerElement=12,at("StructArrayLayout1ul3ui12",mf);class ma extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const c=2*e;return this.uint16[c+0]=r,this.uint16[c+1]=n,e}}ma.prototype.bytesPerElement=4,at("StructArrayLayout2ui4",ma);class mh extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}mh.prototype.bytesPerElement=2,at("StructArrayLayout1ui2",mh);class _h extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const c=2*e;return this.float32[c+0]=r,this.float32[c+1]=n,e}}_h.prototype.bytesPerElement=8,at("StructArrayLayout2f8",_h);class _f extends nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,n,c)}emplace(e,r,n,c,u){const p=4*e;return this.float32[p+0]=r,this.float32[p+1]=n,this.float32[p+2]=c,this.float32[p+3]=u,e}}_f.prototype.bytesPerElement=16,at("StructArrayLayout4f16",_f);class bm extends Sc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}bm.prototype.size=40;class gf extends cf{get(e){return new bm(this,e)}}at("CollisionBoxArray",gf);class wm extends Sc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}wm.prototype.size=60;class Tm extends df{get(e){return new wm(this,e)}}at("PlacedSymbolArray",Tm);class Sm extends Sc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Sm.prototype.size=76;class Em extends ff{get(e){return new Sm(this,e)}}at("SymbolInstanceArray",Em);class Am extends ph{getoffsetX(e){return this.float32[1*e+0]}}at("GlyphOffsetArray",Am);class Cm extends pf{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}at("SymbolLineVertexArray",Cm);class Mm extends Sc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Mm.prototype.size=12;class Im extends mf{get(e){return new Mm(this,e)}}at("FeatureIndexArray",Im);class km extends Sc{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}km.prototype.size=4;class zm extends ma{get(e){return new km(this,e)}}at("FillExtrusionCentroidArray",zm);const P0=Hi([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),D0=Hi([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Pm=ia(function(t){t.exports=function(e,r){var n,c,u,p,g,v,w,A;for(c=e.length-(n=3&e.length),u=r,g=3432918353,v=461845907,A=0;A<c;)w=255&e.charCodeAt(A)|(255&e.charCodeAt(++A))<<8|(255&e.charCodeAt(++A))<<16|(255&e.charCodeAt(++A))<<24,++A,u=27492+(65535&(p=5*(65535&(u=(u^=w=(65535&(w=(w=(65535&w)*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(w=0,n){case 3:w^=(255&e.charCodeAt(A+2))<<16;case 2:w^=(255&e.charCodeAt(A+1))<<8;case 1:u^=w=(65535&(w=(w=(65535&(w^=255&e.charCodeAt(A)))*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}}),L0=ia(function(t){t.exports=function(e,r){for(var n,c=e.length,u=r^c,p=0;c>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),c-=4,++p;switch(c){case 3:u^=(255&e.charCodeAt(p+2))<<16;case 2:u^=(255&e.charCodeAt(p+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(p)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}}),Ac=Pm,R0=L0;Ac.murmur3=Pm,Ac.murmur2=R0;class gh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,n,c){this.ids.push(Dm(e)),this.positions.push(r,n,c)}getPositions(e){const r=Dm(e);let n=0,c=this.ids.length-1;for(;n<c;){const p=n+c>>1;this.ids[p]>=r?c=p:n=p+1}const u=[];for(;this.ids[n]===r;)u.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return u}static serialize(e,r){const n=new Float64Array(e.ids),c=new Uint32Array(e.positions);return yf(n,c,0,n.length-1),r&&r.push(n.buffer,c.buffer),{ids:n,positions:c}}static deserialize(e){const r=new gh;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Dm(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Ac(String(t))}function yf(t,e,r,n){for(;r<n;){const c=t[r+n>>1];let u=r-1,p=n+1;for(;;){do u++;while(t[u]<c);do p--;while(t[p]>c);if(u>=p)break;yh(t,u,p),yh(e,3*u,3*p),yh(e,3*u+1,3*p+1),yh(e,3*u+2,3*p+2)}p-r<n-p?(yf(t,e,r,p),r=p+1):(yf(t,e,p+1,n),n=p)}}function yh(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}at("FeaturePositionMap",gh);class jo{constructor(e,r){this.gl=e.gl,this.location=r}}class vh extends jo{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Lm extends jo{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Rm extends jo{constructor(e,r){super(e,r),this.current=ii.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const B0=new Float32Array(16),O0=new Float32Array(9),F0=new Float32Array(4);function vf(t){return[vm(255*t.r,255*t.g),vm(255*t.b,255*t.a)]}class Cc{constructor(e,r,n){this.value=e,this.uniformNames=r.map(c=>`u_${c}`),this.type=n}setUniform(e,r,n){e.set(n.constantOr(this.value))}getBinding(e,r,n){return this.type==="color"?new Rm(e,r):new vh(e,r)}}class ll{constructor(e,r){this.uniformNames=r.map(n=>`u_${n}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tl.concat(r.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,r,n,c){const u=c==="u_pattern_to"||c==="u_dash_to"?this.patternTo:c==="u_pattern_from"||c==="u_dash_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;u&&e.set(u)}getBinding(e,r,n){return n==="u_pattern_from"||n==="u_pattern_to"||n==="u_dash_from"||n==="u_dash_to"?new Lm(e,r):new vh(e,r)}}class Go{constructor(e,r,n,c){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=r.map(u=>({name:`a_${u}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,r,n,c,u,p){const g=this.paintVertexArray.length,v=this.expression.evaluate(new It(0),r,{},u,c,p);this.paintVertexArray.resize(e),this._setPaintValue(g,e,v)}updatePaintArray(e,r,n,c,u){const p=this.expression.evaluate({zoom:0},n,c,void 0,u);this._setPaintValue(e,r,p)}_setPaintValue(e,r,n){if(this.type==="color"){const c=vf(n);for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class no{constructor(e,r,n,c,u,p){this.expression=e,this.uniformNames=r.map(g=>`u_${g}_t`),this.type=n,this.useIntegerZoom=c,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,r,n,c,u,p){const g=this.expression.evaluate(new It(this.zoom),r,{},u,c,p),v=this.expression.evaluate(new It(this.zoom+1),r,{},u,c,p),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,g,v)}updatePaintArray(e,r,n,c,u){const p=this.expression.evaluate({zoom:this.zoom},n,c,void 0,u),g=this.expression.evaluate({zoom:this.zoom+1},n,c,void 0,u);this._setPaintValue(e,r,p,g)}_setPaintValue(e,r,n,c){if(this.type==="color"){const u=vf(n),p=vf(c);for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,u[0],u[1],p[0],p[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,n,c);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const n=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=Nt(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,r,n){return new vh(e,r)}}class _a{constructor(e,r,n,c,u,p,g){this.expression=e,this.type=n,this.useIntegerZoom=c,this.zoom=u,this.layerId=g,this.paintVertexAttributes=(n==="array"?D0:P0).members;for(let v=0;v<r.length;++v);this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,r,n){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,r.patterns&&r.patterns[this.layerId],n)}updatePaintArray(e,r,n,c,u,p){this._setPaintValues(e,r,n.patterns&&n.patterns[this.layerId],p)}_setPaintValues(e,r,n,c){if(!c||!n)return;const{min:u,mid:p,max:g}=n,v=c[u],w=c[p],A=c[g];if(v&&w&&A)for(let C=e;C<r;C++)this._setPaintValue(this.zoomInPaintVertexArray,C,w,v),this._setPaintValue(this.zoomOutPaintVertexArray,C,w,A)}_setPaintValue(e,r,n,c){e.emplace(r,n.tl[0],n.tl[1],n.br[0],n.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],n.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class $o{constructor(e,r,n=()=>!0){this.binders={},this._buffers=[];const c=[];for(const u in e.paint._values){if(!n(u))continue;const p=e.paint.get(u);if(!(p instanceof Hr&&oa(p.property.specification)))continue;const g=V0(u,e.type),v=p.value,w=p.property.specification.type,A=p.property.useIntegerZoom,C=p.property.specification["property-type"],M=C==="cross-faded"||C==="cross-faded-data-driven",L=String(u)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(v.kind!=="constant"||L)if(v.kind==="source"||L||M){const B=Bm(u,w,"source");this.binders[u]=M?new _a(v,g,w,A,r,B,e.id):new Go(v,g,w,B),c.push(`/a_${u}`)}else{const B=Bm(u,w,"composite");this.binders[u]=new no(v,g,w,A,r,B),c.push(`/z_${u}`)}else this.binders[u]=M?new ll(v.value,g):new Cc(v.value,g,w),c.push(`/u_${u}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Go||r instanceof no?r.maxValue:0}populatePaintArrays(e,r,n,c,u,p){for(const g in this.binders){const v=this.binders[g];(v instanceof Go||v instanceof no||v instanceof _a)&&v.populatePaintArray(e,r,n,c,u,p)}}setConstantPatternPositions(e,r){for(const n in this.binders){const c=this.binders[n];c instanceof ll&&c.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,n,c,u,p){let g=!1;for(const v in e){const w=r.getPositions(v);for(const A of w){const C=n.feature(A.index);for(const M in this.binders){const L=this.binders[M];if((L instanceof Go||L instanceof no||L instanceof _a)&&L.expression.isStateDependent===!0){const B=c.paint.get(M);L.expression=B.value,L.updatePaintArray(A.start,A.end,C,e[v],u,p),g=!0}}}}return g}defines(){const e=[];for(const r in this.binders){const n=this.binders[r];(n instanceof Cc||n instanceof ll)&&e.push(...n.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof Go||n instanceof no||n instanceof _a)for(let c=0;c<n.paintVertexAttributes.length;c++)e.push(n.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof Cc||n instanceof ll||n instanceof no)for(const c of n.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const n=[];for(const c in this.binders){const u=this.binders[c];if(u instanceof Cc||u instanceof ll||u instanceof no){for(const p of u.uniformNames)if(r[p]){const g=u.getBinding(e,r[p],p);n.push({name:p,property:c,binding:g})}}}return n}setUniforms(e,r,n,c){for(const{name:u,property:p,binding:g}of r)this.binders[p].setUniform(g,c,n.get(p),u)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const n=this.binders[r];if(e&&n instanceof _a){const c=e.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(n instanceof Go||n instanceof no)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const r in this.binders){const n=this.binders[r];(n instanceof Go||n instanceof no||n instanceof _a)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Go||r instanceof no||r instanceof _a)&&r.destroy()}}}class os{constructor(e,r,n=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new $o(c,r,n);this.needsUpload=!1,this._featureMap=new gh,this._bufferOffset=0}populatePaintArrays(e,r,n,c,u,p,g){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,r,c,u,p,g);r.id!==void 0&&this._featureMap.add(r.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,n,c,u){for(const p of n)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,r,p,c,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const U0={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function V0(t,e){return U0[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const N0={"line-pattern":{source:pa,composite:pa},"fill-pattern":{source:pa,composite:pa},"fill-extrusion-pattern":{source:pa,composite:pa},"line-dasharray":{source:dh,composite:dh}},j0={color:{source:_h,composite:_f},number:{source:ph,composite:_h}};function Bm(t,e,r){const n=N0[t];return n&&n[r]||j0[e][r]}at("ConstantBinder",Cc),at("CrossFadedConstantBinder",ll),at("SourceExpressionBinder",Go),at("CrossFadedCompositeBinder",_a),at("CompositeExpressionBinder",no),at("ProgramConfiguration",$o,{omit:["_buffers"]}),at("ProgramConfigurationSet",os);const xh="-transition";class oo extends yo{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new ns(r.layout)),r.paint)){this._transitionablePaint=new an(r.paint);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Vo(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,n={}){r!=null&&this._validate(of,`layers.${this.id}.layout.${e}`,e,r,n)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return Ni(e,xh)?this._transitionablePaint.getTransition(e.slice(0,-xh.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,n={}){if(r!=null&&this._validate(Tc,`layers.${this.id}.paint.${e}`,e,r,n))return!1;if(Ni(e,xh))return this._transitionablePaint.setTransition(e.slice(0,-xh.length),r||void 0),!1;{const c=this._transitionablePaint._values[e],u=c.property.specification["property-type"]==="cross-faded-data-driven",p=c.value.isDataDriven(),g=c.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const v=this._transitionablePaint._values[e].value;return v.isDataDriven()||p||u||this._handleOverridablePaintPropertyUpdate(e,g,v)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Lr(e,(r,n)=>!(r===void 0||n==="layout"&&!Object.keys(r).length||n==="paint"&&!Object.keys(r).length))}_validate(e,r,n,c,u={}){return(!u||u.validate!==!1)&&uh(this,e.call(ua,{key:r,layerType:this.type,objectKey:n,value:c,styleSpec:Ee,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Hr&&oa(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=tl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const G0=Hi([{name:"a_pos",components:2,type:"Int16"}],4),{members:$0}=G0;class or{constructor(e=[]){this.segments=e}prepareSegment(e,r,n,c){let u=this.segments[this.segments.length-1];return e>or.MAX_VERTEX_ARRAY_LENGTH&&et(`Max vertices per segment is ${or.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>or.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==c)&&(u={vertexOffset:r.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},c!==void 0&&(u.sortKey=c),this.segments.push(u)),u}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,n,c){return new or([{vertexOffset:e,primitiveOffset:r,vertexLength:n,primitiveLength:c,vaos:{},sortKey:0}])}}or.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,at("SegmentVector",or);var jt=8192;class as{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Si?new Si(e.lng,e.lat):Si.convert(e),this}setSouthWest(e){return this._sw=e instanceof Si?new Si(e.lng,e.lat):Si.convert(e),this}extend(e){const r=this._sw,n=this._ne;let c,u;if(e instanceof Si)c=e,u=e;else{if(!(e instanceof as))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(as.convert(e)):this.extend(Si.convert(e)):this;if(c=e._sw,u=e._ne,!c||!u)return this}return r||n?(r.lng=Math.min(c.lng,r.lng),r.lat=Math.min(c.lat,r.lat),n.lng=Math.max(u.lng,n.lng),n.lat=Math.max(u.lat,n.lat)):(this._sw=new Si(c.lng,c.lat),this._ne=new Si(u.lng,u.lat)),this}getCenter(){return new Si((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Si(this.getWest(),this.getNorth())}getSouthEast(){return new Si(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:n}=Si.convert(e);let c=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&c}static convert(e){return!e||e instanceof as?e:new as(e)}}const Om=63710088e-1;class Si{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Si(xr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,n=this.lat*r,c=e.lat*r,u=Math.sin(n)*Math.sin(c)+Math.cos(n)*Math.cos(c)*Math.cos((e.lng-this.lng)*r);return Om*Math.acos(Math.min(u,1))}toBounds(e=0){const r=360*e/40075017,n=r/Math.cos(Math.PI/180*this.lat);return new as(new Si(this.lng-n,this.lat-r),new Si(this.lng+n,this.lat+r))}static convert(e){if(e instanceof Si)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Si(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Si(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Fm=2*Math.PI*Om;function Um(t){return Fm*Math.cos(t*Math.PI/180)}function cl(t){return(180+t)/360}function ul(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ao(t,e){return t/Um(e)}function Zo(t){return 360*t-180}function Kn(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Vm(t,e){return t*Um(Kn(e))}const Io=85.051129;class bh{constructor(e,r,n=0){this.x=+e,this.y=+r,this.z=+n}static fromLngLat(e,r=0){const n=Si.convert(e);return new bh(cl(n.lng),ul(n.lat),ao(r,n.lat))}toLngLat(){return new Si(Zo(this.x),Kn(this.y))}toAltitude(){return Vm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Fm*(e=Kn(this.y),1/Math.cos(e*Math.PI/180));var e}}function xf(t,e,r,n,c,u,p,g,v){const w=(e+n)/2,A=(r+c)/2,C=new F(w,A);g(C),function(M,L,B,G,q,Q){const oe=B-q,ce=G-Q;return Math.abs((G-L)*oe-(B-M)*ce)/Math.hypot(oe,ce)}(C.x,C.y,u.x,u.y,p.x,p.y)>=v?(xf(t,e,r,w,A,u,C,g,v),xf(t,w,A,n,c,C,p,g,v)):t.push(p)}function Z0(t,e,r){const n=[];let c,u,p;for(const g of t){const{x:v,y:w}=g;e(g),p?xf(n,c,u,v,w,p,g,e,r):n.push(g),c=v,u=w,p=g}return n}const bf=Math.pow(2,14)-1,Nm=-bf-1;function q0(t,e){const r=Math.round(t.x*e),n=Math.round(t.y*e);return t.x=Nt(r,Nm,bf),t.y=Nt(n,Nm,bf),(r<t.x||r>t.x+1||n<t.y||n>t.y+1)&&et("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function qo(t,e,r){const n=t.loadGeometry(),c=t.extent,u=jt/c;if(e&&r&&r.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:g,x:v,y:w,projection:A}=r,C=M=>{const L=Zo((e.x+M.x/c)/p),B=Kn((e.y+M.y/c)/p),G=A.project(L,B);M.x=(G.x*g-v)*c,M.y=(G.y*g-w)*c};for(let M=0;M<n.length;M++)if(t.type!==1)n[M]=Z0(n[M],C,1);else{const L=[];for(const B of n[M])B.x<0||B.x>=c||B.y<0||B.y>=c||(C(B),L.push(B));n[M]=L}}for(const p of n)for(const g of p)q0(g,u);return n}function ss(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?qo(t):[]}}function wh(t,e,r,n,c){t.emplaceBack(2*e+(n+1)/2,2*r+(c+1)/2)}class wf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ol,this.indexArray=new Vn,this.segments=new or,this.programConfigurations=new os(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,c){const u=this.layers[0],p=[];let g=null;u.type==="circle"&&(g=u.layout.get("circle-sort-key"));for(const{feature:v,id:w,index:A,sourceLayerIndex:C}of e){const M=this.layers[0]._featureFilter.needGeometry,L=ss(v,M);if(!this.layers[0]._featureFilter.filter(new It(this.zoom),L,n))continue;const B=g?g.evaluate(L,{},n):void 0,G={id:w,properties:v.properties,type:v.type,sourceLayerIndex:C,index:A,geometry:M?L.geometry:qo(v,n,c),patterns:{},sortKey:B};p.push(G)}g&&p.sort((v,w)=>v.sortKey-w.sortKey);for(const v of p){const{geometry:w,index:A,sourceLayerIndex:C}=v,M=e[A].feature;this.addFeature(v,w,A,r.availableImages,n),r.featureIndex.insert(M,w,A,C,this.index)}}update(e,r,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,n,c,u){for(const p of r)for(const g of p){const v=g.x,w=g.y;if(v<0||v>=jt||w<0||w>=jt)continue;const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),C=A.vertexLength;wh(this.layoutVertexArray,v,w,-1,-1),wh(this.layoutVertexArray,v,w,1,-1),wh(this.layoutVertexArray,v,w,1,1),wh(this.layoutVertexArray,v,w,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+3,C+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},c,u)}}function jm(t,e){for(let r=0;r<t.length;r++)if(hl(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(hl(t,e[r]))return!0;return!!Tf(t,e)}function W0(t,e,r){return!!hl(t,e)||!!Sf(e,t,r)}function Gm(t,e){if(t.length===1)return Zm(e,t[0]);for(let r=0;r<e.length;r++){const n=e[r];for(let c=0;c<n.length;c++)if(hl(t,n[c]))return!0}for(let r=0;r<t.length;r++)if(Zm(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(Tf(t,e[r]))return!0;return!1}function H0(t,e,r){if(t.length>1){if(Tf(t,e))return!0;for(let n=0;n<e.length;n++)if(Sf(e[n],t,r))return!0}for(let n=0;n<t.length;n++)if(Sf(t[n],e,r))return!0;return!1}function Tf(t,e){if(t.length===0||e.length===0)return!1;for(let r=0;r<t.length-1;r++){const n=t[r],c=t[r+1];for(let u=0;u<e.length-1;u++)if(X0(n,c,e[u],e[u+1]))return!0}return!1}function X0(t,e,r,n){return zt(t,r,n)!==zt(e,r,n)&&zt(t,e,r)!==zt(t,e,n)}function Sf(t,e,r){const n=r*r;if(e.length===1)return t.distSqr(e[0])<n;for(let c=1;c<e.length;c++)if($m(t,e[c-1],e[c])<n)return!0;return!1}function $m(t,e,r){const n=e.distSqr(r);if(n===0)return t.distSqr(e);const c=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/n;return t.distSqr(c<0?e:c>1?r:r.sub(e)._mult(c)._add(e))}function Zm(t,e){let r,n,c,u=!1;for(let p=0;p<t.length;p++){r=t[p];for(let g=0,v=r.length-1;g<r.length;v=g++)n=r[g],c=r[v],n.y>e.y!=c.y>e.y&&e.x<(c.x-n.x)*(e.y-n.y)/(c.y-n.y)+n.x&&(u=!u)}return u}function hl(t,e){let r=!1;for(let n=0,c=t.length-1;n<t.length;c=n++){const u=t[n],p=t[c];u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(r=!r)}return r}function qm(t,e,r,n,c){for(const p of t)if(e<=p.x&&r<=p.y&&n>=p.x&&c>=p.y)return!0;const u=[new F(e,r),new F(e,c),new F(n,c),new F(n,r)];if(t.length>2){for(const p of u)if(hl(t,p))return!0}for(let p=0;p<t.length-1;p++)if(K0(t[p],t[p+1],u))return!0;return!1}function K0(t,e,r){const n=r[0],c=r[2];if(t.x<n.x&&e.x<n.x||t.x>c.x&&e.x>c.x||t.y<n.y&&e.y<n.y||t.y>c.y&&e.y>c.y)return!1;const u=zt(t,e,r[0]);return u!==zt(t,e,r[1])||u!==zt(t,e,r[2])||u!==zt(t,e,r[3])}function dl(t,e,r){const n=e.paint.get(t).value;return n.kind==="constant"?n.value:r.programConfigurations.get(e.id).getMaxValue(t)}function Th(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Wm(t,e,r,n,c){if(!e[0]&&!e[1])return t;const u=F.convert(e)._mult(c);r==="viewport"&&u._rotate(-n);const p=[];for(let g=0;g<t.length;g++)p.push(t[g].sub(u));return p}function Hm(t,e,r,n){const c=F.convert(t)._mult(n);return e==="viewport"&&c._rotate(-r),c}at("CircleBucket",wf,{omit:["layers"]});const Y0=new kr({"circle-sort-key":new gt(Ee.layout_circle["circle-sort-key"])});var J0={paint:new kr({"circle-radius":new gt(Ee.paint_circle["circle-radius"]),"circle-color":new gt(Ee.paint_circle["circle-color"]),"circle-blur":new gt(Ee.paint_circle["circle-blur"]),"circle-opacity":new gt(Ee.paint_circle["circle-opacity"]),"circle-translate":new lt(Ee.paint_circle["circle-translate"]),"circle-translate-anchor":new lt(Ee.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new lt(Ee.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new lt(Ee.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new gt(Ee.paint_circle["circle-stroke-width"]),"circle-stroke-color":new gt(Ee.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new gt(Ee.paint_circle["circle-stroke-opacity"])}),layout:Y0};class Ef{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,n,c){const u=Math.pow(2,n),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(v=>{const w=mr([],v,e),A=1/w[3]/r*u;return function(C,M,L){return C[0]=M[0]*L[0],C[1]=M[1]*L[1],C[2]=M[2]*L[2],C[3]=M[3]*L[3],C}(w,w,[A,A,c?1/w[3]:A,A])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(v=>{const w=kt([],Di([],yr([],p[v[0]],p[v[1]]),yr([],p[v[2]],p[v[1]]))),A=-ui(w,p[v[1]]);return w.concat(A)});return new Ef(p,g)}}class so{constructor(e,r){this.min=e,this.max=r,this.center=Vi([],wt([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],n=Je(this.min),c=Je(this.max);for(let u=0;u<r.length;u++)n[u]=r[u]?this.min[u]:this.center[u],c[u]=r[u]?this.center[u]:this.max[u];return c[2]=this.max[2],new so(n,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let n=!0;for(let c=0;c<e.planes.length;c++){const u=e.planes[c];let p=0;for(let g=0;g<r.length;g++)p+=ui(u,r[g])+u[3]>=0;if(p===0)return 0;p!==r.length&&(n=!1)}if(n)return 2;for(let c=0;c<3;c++){let u=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let g=0;g<e.points.length;g++){const v=e.points[g][c]-this.min[c];u=Math.min(u,v),p=Math.max(p,v)}if(p<0||u>this.max[c]-this.min[c])return 0}return 1}}function Xm(t,e,r,n,c,u,p,g,v){if(u&&t.queryGeometry.isAboveHorizon)return!1;u&&(v*=t.pixelToTileUnitsFactor);for(const w of e)for(const A of w){const C=A.add(g),M=c&&r.elevation?r.elevation.exaggeration()*c.getElevationAt(C.x,C.y,!0):0,L=u?C:Q0(C,M,n),B=u?t.tilespaceRays.map(q=>tx(q,M)):t.queryGeometry.screenGeometry,G=mr([],[A.x,A.y,M,1],n);if(!p&&u?v*=G[3]/r.cameraToCenterDistance:p&&!u&&(v*=r.cameraToCenterDistance/G[3]),W0(B,L,v))return!0}return!1}function Q0(t,e,r){const n=mr([],[t.x,t.y,e,1],r);return new F(n[0]/n[3],n[1]/n[3])}const Km=st(0,0,0),ex=st(0,0,1);function tx(t,e){const r=Re();return Km[2]=e,t.intersectsPlane(Km,ex,r),new F(r[0],r[1])}class Ym extends wf{}function Af(t,{width:e,height:r},n,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*r*n)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*r*n);return t.width=e,t.height=r,t.data=c,t}function Jm(t,{width:e,height:r},n){if(e===t.width&&r===t.height)return;const c=Af({},{width:e,height:r},n);Cf(t,c,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,r)},n),t.width=e,t.height=r,t.data=c.data}function Cf(t,e,r,n,c,u){if(c.width===0||c.height===0)return e;if(c.width>t.width||c.height>t.height||r.x>t.width-c.width||r.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||n.x>e.width-c.width||n.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const p=t.data,g=e.data;for(let v=0;v<c.height;v++){const w=((r.y+v)*t.width+r.x)*u,A=((n.y+v)*e.width+n.x)*u;for(let C=0;C<c.width*u;C++)g[A+C]=p[w+C]}return e}at("HeatmapBucket",Ym,{omit:["layers"]});class ga{constructor(e,r){Af(this,e,1,r)}resize(e){Jm(this,e,1)}clone(){return new ga({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,c,u){Cf(e,r,n,c,u,1)}}class Nn{constructor(e,r){Af(this,e,4,r)}resize(e){Jm(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Nn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,c,u){Cf(e,r,n,c,u,4)}}at("AlphaImage",ga),at("RGBAImage",Nn);var ix={paint:new kr({"heatmap-radius":new gt(Ee.paint_heatmap["heatmap-radius"]),"heatmap-weight":new gt(Ee.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new lt(Ee.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Mo(Ee.paint_heatmap["heatmap-color"]),"heatmap-opacity":new lt(Ee.paint_heatmap["heatmap-opacity"])})};function Mf(t){const e={},r=t.resolution||256,n=t.clips?t.clips.length:1,c=t.image||new Nn({width:r,height:n}),u=(p,g,v)=>{e[t.evaluationKey]=v;const w=t.expression.evaluate(e);c.data[p+g+0]=Math.floor(255*w.r/w.a),c.data[p+g+1]=Math.floor(255*w.g/w.a),c.data[p+g+2]=Math.floor(255*w.b/w.a),c.data[p+g+3]=Math.floor(255*w.a)};if(t.clips)for(let p=0,g=0;p<n;++p,g+=4*r)for(let v=0,w=0;v<r;v++,w+=4){const A=v/(r-1),{start:C,end:M}=t.clips[p];u(g,w,C*(1-A)+M*A)}else for(let p=0,g=0;p<r;p++,g+=4)u(0,g,p/(r-1));return c}var rx={paint:new kr({"hillshade-illumination-direction":new lt(Ee.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new lt(Ee.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new lt(Ee.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new lt(Ee.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new lt(Ee.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new lt(Ee.paint_hillshade["hillshade-accent-color"])})};const nx=Hi([{name:"a_pos",components:2,type:"Int16"}],4),{members:ox}=nx;var Sh=Eh,ax=Eh;function Eh(t,e,r){r=r||2;var n,c,u,p,g,v,w,A=e&&e.length,C=A?e[0]*r:t.length,M=Qm(t,0,C,r,!0),L=[];if(!M||M.next===M.prev)return L;if(A&&(M=function(G,q,Q,oe){var ce,de,pe,me=[];for(ce=0,de=q.length;ce<de;ce++)(pe=Qm(G,q[ce]*oe,ce<de-1?q[ce+1]*oe:G.length,oe,!1))===pe.next&&(pe.steiner=!0),me.push(px(pe));for(me.sort(hx),ce=0;ce<me.length;ce++)Q=ya(Q=dx(me[ce],Q),Q.next);return Q}(t,e,M,r)),t.length>80*r){n=u=t[0],c=p=t[1];for(var B=r;B<C;B+=r)(g=t[B])<n&&(n=g),(v=t[B+1])<c&&(c=v),g>u&&(u=g),v>p&&(p=v);w=(w=Math.max(u-n,p-c))!==0?1/w:0}return Mc(M,L,r,n,c,w),L}function Qm(t,e,r,n,c){var u,p;if(c===zf(t,e,r,n)>0)for(u=e;u<r;u+=n)p=i_(u,t[u],t[u+1],p);else for(u=r-n;u>=e;u-=n)p=i_(u,t[u],t[u+1],p);return p&&Ah(p,p.next)&&(kc(p),p=p.next),p}function ya(t,e){if(!t)return t;e||(e=t);var r,n=t;do if(r=!1,n.steiner||!Ah(n,n.next)&&ar(n.prev,n,n.next)!==0)n=n.next;else{if(kc(n),(n=e=n.prev)===n.next)break;r=!0}while(r||n!==e);return e}function Mc(t,e,r,n,c,u,p){if(t){!p&&u&&function(A,C,M,L){var B=A;do B.z===null&&(B.z=If(B.x,B.y,C,M,L)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==A);B.prevZ.nextZ=null,B.prevZ=null,function(G){var q,Q,oe,ce,de,pe,me,ke,Ce=1;do{for(Q=G,G=null,de=null,pe=0;Q;){for(pe++,oe=Q,me=0,q=0;q<Ce&&(me++,oe=oe.nextZ);q++);for(ke=Ce;me>0||ke>0&&oe;)me!==0&&(ke===0||!oe||Q.z<=oe.z)?(ce=Q,Q=Q.nextZ,me--):(ce=oe,oe=oe.nextZ,ke--),de?de.nextZ=ce:G=ce,ce.prevZ=de,de=ce;Q=oe}de.nextZ=null,Ce*=2}while(pe>1)}(B)}(t,n,c,u);for(var g,v,w=t;t.prev!==t.next;)if(g=t.prev,v=t.next,u?lx(t,n,c,u):sx(t))e.push(g.i/r),e.push(t.i/r),e.push(v.i/r),kc(t),t=v.next,w=v.next;else if((t=v)===w){p?p===1?Mc(t=cx(ya(t),e,r),e,r,n,c,u,2):p===2&&ux(t,e,r,n,c,u):Mc(ya(t),e,r,n,c,u,1);break}}}function sx(t){var e=t.prev,r=t,n=t.next;if(ar(e,r,n)>=0)return!1;for(var c=t.next.next;c!==t.prev;){if(fl(e.x,e.y,r.x,r.y,n.x,n.y,c.x,c.y)&&ar(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function lx(t,e,r,n){var c=t.prev,u=t,p=t.next;if(ar(c,u,p)>=0)return!1;for(var g=c.x>u.x?c.x>p.x?c.x:p.x:u.x>p.x?u.x:p.x,v=c.y>u.y?c.y>p.y?c.y:p.y:u.y>p.y?u.y:p.y,w=If(c.x<u.x?c.x<p.x?c.x:p.x:u.x<p.x?u.x:p.x,c.y<u.y?c.y<p.y?c.y:p.y:u.y<p.y?u.y:p.y,e,r,n),A=If(g,v,e,r,n),C=t.prevZ,M=t.nextZ;C&&C.z>=w&&M&&M.z<=A;){if(C!==t.prev&&C!==t.next&&fl(c.x,c.y,u.x,u.y,p.x,p.y,C.x,C.y)&&ar(C.prev,C,C.next)>=0||(C=C.prevZ,M!==t.prev&&M!==t.next&&fl(c.x,c.y,u.x,u.y,p.x,p.y,M.x,M.y)&&ar(M.prev,M,M.next)>=0))return!1;M=M.nextZ}for(;C&&C.z>=w;){if(C!==t.prev&&C!==t.next&&fl(c.x,c.y,u.x,u.y,p.x,p.y,C.x,C.y)&&ar(C.prev,C,C.next)>=0)return!1;C=C.prevZ}for(;M&&M.z<=A;){if(M!==t.prev&&M!==t.next&&fl(c.x,c.y,u.x,u.y,p.x,p.y,M.x,M.y)&&ar(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function cx(t,e,r){var n=t;do{var c=n.prev,u=n.next.next;!Ah(c,u)&&e_(c,n,n.next,u)&&Ic(c,u)&&Ic(u,c)&&(e.push(c.i/r),e.push(n.i/r),e.push(u.i/r),kc(n),kc(n.next),n=t=u),n=n.next}while(n!==t);return ya(n)}function ux(t,e,r,n,c,u){var p=t;do{for(var g=p.next.next;g!==p.prev;){if(p.i!==g.i&&mx(p,g)){var v=t_(p,g);return p=ya(p,p.next),v=ya(v,v.next),Mc(p,e,r,n,c,u),void Mc(v,e,r,n,c,u)}g=g.next}p=p.next}while(p!==t)}function hx(t,e){return t.x-e.x}function dx(t,e){var r=function(u,p){var g,v=p,w=u.x,A=u.y,C=-1/0;do{if(A<=v.y&&A>=v.next.y&&v.next.y!==v.y){var M=v.x+(A-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(M<=w&&M>C){if(C=M,M===w){if(A===v.y)return v;if(A===v.next.y)return v.next}g=v.x<v.next.x?v:v.next}}v=v.next}while(v!==p);if(!g)return null;if(w===C)return g;var L,B=g,G=g.x,q=g.y,Q=1/0;v=g;do w>=v.x&&v.x>=G&&w!==v.x&&fl(A<q?w:C,A,G,q,A<q?C:w,A,v.x,v.y)&&(L=Math.abs(A-v.y)/(w-v.x),Ic(v,u)&&(L<Q||L===Q&&(v.x>g.x||v.x===g.x&&fx(g,v)))&&(g=v,Q=L)),v=v.next;while(v!==B);return g}(t,e);if(!r)return e;var n=t_(r,t),c=ya(r,r.next);return ya(n,n.next),e===r?c:e}function fx(t,e){return ar(t.prev,t,e.prev)<0&&ar(e.next,t,t.next)<0}function If(t,e,r,n,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*c)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*c)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function px(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function fl(t,e,r,n,c,u,p,g){return(c-p)*(e-g)-(t-p)*(u-g)>=0&&(t-p)*(n-g)-(r-p)*(e-g)>=0&&(r-p)*(u-g)-(c-p)*(n-g)>=0}function mx(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(r,n){var c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==n.i&&c.next.i!==n.i&&e_(c,c.next,r,n))return!0;c=c.next}while(c!==r);return!1}(t,e)&&(Ic(t,e)&&Ic(e,t)&&function(r,n){var c=r,u=!1,p=(r.x+n.x)/2,g=(r.y+n.y)/2;do c.y>g!=c.next.y>g&&c.next.y!==c.y&&p<(c.next.x-c.x)*(g-c.y)/(c.next.y-c.y)+c.x&&(u=!u),c=c.next;while(c!==r);return u}(t,e)&&(ar(t.prev,t,e.prev)||ar(t,e.prev,e))||Ah(t,e)&&ar(t.prev,t,t.next)>0&&ar(e.prev,e,e.next)>0)}function ar(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Ah(t,e){return t.x===e.x&&t.y===e.y}function e_(t,e,r,n){var c=Mh(ar(t,e,r)),u=Mh(ar(t,e,n)),p=Mh(ar(r,n,t)),g=Mh(ar(r,n,e));return c!==u&&p!==g||!(c!==0||!Ch(t,r,e))||!(u!==0||!Ch(t,n,e))||!(p!==0||!Ch(r,t,n))||!(g!==0||!Ch(r,e,n))}function Ch(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Mh(t){return t>0?1:t<0?-1:0}function Ic(t,e){return ar(t.prev,t,t.next)<0?ar(t,e,t.next)>=0&&ar(t,t.prev,e)>=0:ar(t,e,t.prev)<0||ar(t,t.next,e)<0}function t_(t,e){var r=new kf(t.i,t.x,t.y),n=new kf(e.i,e.x,e.y),c=t.next,u=e.prev;return t.next=e,e.prev=t,r.next=c,c.prev=r,n.next=r,r.prev=n,u.next=n,n.prev=u,n}function i_(t,e,r,n){var c=new kf(t,e,r);return n?(c.next=n.next,c.prev=n,n.next.prev=c,n.next=c):(c.prev=c,c.next=c),c}function kc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function kf(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zf(t,e,r,n){for(var c=0,u=e,p=r-n;u<r;u+=n)c+=(t[p]-t[u])*(t[u+1]+t[p+1]),p=u;return c}function _x(t,e,r,n,c){r_(t,e,r||0,n||t.length-1,c||gx)}function r_(t,e,r,n,c){for(;n>r;){if(n-r>600){var u=n-r+1,p=e-r+1,g=Math.log(u),v=.5*Math.exp(2*g/3),w=.5*Math.sqrt(g*v*(u-v)/u)*(p-u/2<0?-1:1);r_(t,e,Math.max(r,Math.floor(e-p*v/u+w)),Math.min(n,Math.floor(e+(u-p)*v/u+w)),c)}var A=t[e],C=r,M=n;for(zc(t,r,e),c(t[n],A)>0&&zc(t,r,n);C<M;){for(zc(t,C,M),C++,M--;c(t[C],A)<0;)C++;for(;c(t[M],A)>0;)M--}c(t[r],A)===0?zc(t,r,M):zc(t,++M,n),M<=e&&(r=M+1),e<=M&&(n=M-1)}}function zc(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function gx(t,e){return t<e?-1:t>e?1:0}function Pf(t,e){const r=t.length;if(r<=1)return[t];const n=[];let c,u;for(let p=0;p<r;p++){const g=xi(t[p]);g!==0&&(t[p].area=Math.abs(g),u===void 0&&(u=g<0),u===g<0?(c&&n.push(c),c=[t[p]]):c.push(t[p]))}if(c&&n.push(c),e>1)for(let p=0;p<n.length;p++)n[p].length<=e||(_x(n[p],e,1,n[p].length-1,yx),n[p]=n[p].slice(0,e));return n}function yx(t,e){return e.area-t.area}function Df(t,e,r){const n=r.patternDependencies;let c=!1;for(const u of e){const p=u.paint.get(`${t}-pattern`);p.isConstant()||(c=!0);const g=p.constantOr(null);g&&(c=!0,n[g.to]=!0,n[g.from]=!0)}return c}function Lf(t,e,r,n,c){const u=c.patternDependencies;for(const p of e){const g=p.paint.get(`${t}-pattern`).value;if(g.kind!=="constant"){let v=g.evaluate({zoom:n-1},r,{},c.availableImages),w=g.evaluate({zoom:n},r,{},c.availableImages),A=g.evaluate({zoom:n+1},r,{},c.availableImages);v=v&&v.name?v.name:v,w=w&&w.name?w.name:w,A=A&&A.name?A.name:A,u[v]=!0,u[w]=!0,u[A]=!0,r.patterns[p.id]={min:v,mid:w,max:A}}}return r}Eh.deviation=function(t,e,r,n){var c=e&&e.length,u=Math.abs(zf(t,0,c?e[0]*r:t.length,r));if(c)for(var p=0,g=e.length;p<g;p++)u-=Math.abs(zf(t,e[p]*r,p<g-1?e[p+1]*r:t.length,r));var v=0;for(p=0;p<n.length;p+=3){var w=n[p]*r,A=n[p+1]*r,C=n[p+2]*r;v+=Math.abs((t[w]-t[C])*(t[A+1]-t[w+1])-(t[w]-t[A])*(t[C+1]-t[w+1]))}return u===0&&v===0?0:Math.abs((v-u)/u)},Eh.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,c=0;c<t.length;c++){for(var u=0;u<t[c].length;u++)for(var p=0;p<e;p++)r.vertices.push(t[c][u][p]);c>0&&r.holes.push(n+=t[c-1].length)}return r},Sh.default=ax;class Ih{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ol,this.indexArray=new Vn,this.indexArray2=new ma,this.programConfigurations=new os(e.layers,e.zoom),this.segments=new or,this.segments2=new or,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,c){this.hasPattern=Df("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:g,id:v,index:w,sourceLayerIndex:A}of e){const C=this.layers[0]._featureFilter.needGeometry,M=ss(g,C);if(!this.layers[0]._featureFilter.filter(new It(this.zoom),M,n))continue;const L=u?u.evaluate(M,{},n,r.availableImages):void 0,B={id:v,properties:g.properties,type:g.type,sourceLayerIndex:A,index:w,geometry:C?M.geometry:qo(g,n,c),patterns:{},sortKey:L};p.push(B)}u&&p.sort((g,v)=>g.sortKey-v.sortKey);for(const g of p){const{geometry:v,index:w,sourceLayerIndex:A}=g;if(this.hasPattern){const C=Lf("fill",this.layers,g,this.zoom,r);this.patternFeatures.push(C)}else this.addFeature(g,v,w,n,{},r.availableImages);r.featureIndex.insert(e[w].feature,v,w,A,this.index)}}update(e,r,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,c)}addFeatures(e,r,n,c){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,n,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ox),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,n,c,u,p=[]){for(const g of Pf(r,500)){let v=0;for(const B of g)v+=B.length;const w=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),A=w.vertexLength,C=[],M=[];for(const B of g){if(B.length===0)continue;B!==g[0]&&M.push(C.length/2);const G=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),q=G.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(q+B.length-1,q),C.push(B[0].x),C.push(B[0].y);for(let Q=1;Q<B.length;Q++)this.layoutVertexArray.emplaceBack(B[Q].x,B[Q].y),this.indexArray2.emplaceBack(q+Q-1,q+Q),C.push(B[Q].x),C.push(B[Q].y);G.vertexLength+=B.length,G.primitiveLength+=B.length}const L=Sh(C,M);for(let B=0;B<L.length;B+=3)this.indexArray.emplaceBack(A+L[B],A+L[B+1],A+L[B+2]);w.vertexLength+=v,w.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,p,c)}}at("FillBucket",Ih,{omit:["layers","patternFeatures"]});const vx=new kr({"fill-sort-key":new gt(Ee.layout_fill["fill-sort-key"])});var xx={paint:new kr({"fill-antialias":new lt(Ee.paint_fill["fill-antialias"]),"fill-opacity":new gt(Ee.paint_fill["fill-opacity"]),"fill-color":new gt(Ee.paint_fill["fill-color"]),"fill-outline-color":new gt(Ee.paint_fill["fill-outline-color"]),"fill-translate":new lt(Ee.paint_fill["fill-translate"]),"fill-translate-anchor":new lt(Ee.paint_fill["fill-translate-anchor"]),"fill-pattern":new Tr(Ee.paint_fill["fill-pattern"])}),layout:vx};const bx=Hi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),wx=Hi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Tx}=bx;var n_=pl;function pl(t,e,r,n,c){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=c,t.readFields(Sx,this,e)}function Sx(t,e,r){t==1?e.id=r.readVarint():t==2?function(n,c){for(var u=n.readVarint()+n.pos;n.pos<u;){var p=c._keys[n.readVarint()],g=c._values[n.readVarint()];c.properties[p]=g}}(r,e):t==3?e.type=r.readVarint():t==4&&(e._geometry=r.pos)}function Ex(t){for(var e,r,n=0,c=0,u=t.length,p=u-1;c<u;p=c++)n+=((r=t[p]).x-(e=t[c]).x)*(e.y+r.y);return n}pl.types=["Unknown","Point","LineString","Polygon"],pl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,c=0,u=0,p=0,g=[];t.pos<r;){if(c<=0){var v=t.readVarint();n=7&v,c=v>>3}if(c--,n===1||n===2)u+=t.readSVarint(),p+=t.readSVarint(),n===1&&(e&&g.push(e),e=[]),e.push(new F(u,p));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&g.push(e),g},pl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,c=0,u=0,p=1/0,g=-1/0,v=1/0,w=-1/0;t.pos<e;){if(n<=0){var A=t.readVarint();r=7&A,n=A>>3}if(n--,r===1||r===2)(c+=t.readSVarint())<p&&(p=c),c>g&&(g=c),(u+=t.readSVarint())<v&&(v=u),u>w&&(w=u);else if(r!==7)throw new Error("unknown command "+r)}return[p,v,g,w]},pl.prototype.toGeoJSON=function(t,e,r){var n,c,u=this.extent*Math.pow(2,r),p=this.extent*t,g=this.extent*e,v=this.loadGeometry(),w=pl.types[this.type];function A(L){for(var B=0;B<L.length;B++){var G=L[B];L[B]=[360*(G.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+g)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(n=0;n<v.length;n++)C[n]=v[n][0];A(v=C);break;case 2:for(n=0;n<v.length;n++)A(v[n]);break;case 3:for(v=function(L){var B=L.length;if(B<=1)return[L];for(var G,q,Q=[],oe=0;oe<B;oe++){var ce=Ex(L[oe]);ce!==0&&(q===void 0&&(q=ce<0),q===ce<0?(G&&Q.push(G),G=[L[oe]]):G.push(L[oe]))}return G&&Q.push(G),Q}(v),n=0;n<v.length;n++)for(c=0;c<v[n].length;c++)A(v[n][c])}v.length===1?v=v[0]:w="Multi"+w;var M={type:"Feature",geometry:{type:w,coordinates:v},properties:this.properties};return"id"in this&&(M.id=this.id),M};var o_=a_;function a_(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ax,this,e),this.length=this._features.length}function Ax(t,e,r){t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(function(n){for(var c=null,u=n.readVarint()+n.pos;n.pos<u;){var p=n.readVarint()>>3;c=p===1?n.readString():p===2?n.readFloat():p===3?n.readDouble():p===4?n.readVarint64():p===5?n.readVarint():p===6?n.readSVarint():p===7?n.readBoolean():null}return c}(r))}function Cx(t,e,r){if(t===3){var n=new o_(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}a_.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new n_(this._pbf,e,this.extent,this._keys,this._values)};var ls={VectorTile:function(t,e){this.layers=t.readFields(Cx,{},e)},VectorTileFeature:n_,VectorTileLayer:o_};const Mx=ls.VectorTileFeature.types,Ix=Math.pow(2,13);function Pc(t,e,r,n,c,u,p,g){t.emplaceBack((e<<1)+p,(r<<1)+u,(Math.floor(n*Ix)<<1)+c,Math.round(g))}class s_{constructor(){this.acc=new F(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new F(e.x,e.y),this.max=new F(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);let n=!!this.borders;const c=this.min,u=this.max;e.x<c.x?(c.x=e.x,n=!0):e.x>u.x&&(u.x=e.x,n=!0),e.y<c.y?(c.y=e.y,n=!0):e.y>u.y&&(u.y=e.y,n=!0),((e.x===0||e.x===jt)&&e.x===r.x)!=((e.y===0||e.y===jt)&&e.y===r.y)&&this.processBorderOverlap(e,r),n&&this.checkBorderIntersection(e,r)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,_i(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>jt!=e.x>jt&&this.addBorderIntersection(1,_i(r.y,e.y,(jt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,_i(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>jt!=e.y>jt&&this.addBorderIntersection(3,_i(r.x,e.x,(jt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];r<n[0]&&(n[0]=r),r>n[1]&&(n[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const n=e.x===0?0:1;this.addBorderIntersection(n,r.y),this.addBorderIntersection(n,e.y)}else{const n=e.y===0?2:3;this.addBorderIntersection(n,r.x),this.addBorderIntersection(n,e.x)}}centroid(){const e=this.polyCount.reduce((r,n)=>r+n.edges,0);return e!==0?this.acc.div(e)._round():new F(0,0)}span(){return new F(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class Rf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new al,this.centroidVertexArray=new zm,this.indexArray=new Vn,this.programConfigurations=new os(e.layers,e.zoom),this.segments=new or,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,n,c){this.features=[],this.hasPattern=Df("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(u){const p=Math.exp(Math.PI*(1-u.y/(1<<u.z)*2));return 80150034*p/(p*p+1)/jt/(1<<u.z)}(n);for(const{feature:u,id:p,index:g,sourceLayerIndex:v}of e){const w=this.layers[0]._featureFilter.needGeometry,A=ss(u,w);if(!this.layers[0]._featureFilter.filter(new It(this.zoom),A,n))continue;const C={id:p,sourceLayerIndex:v,index:g,geometry:w?A.geometry:qo(u,n,c),properties:u.properties,type:u.type,patterns:{}},M=this.layoutVertexArray.length;this.hasPattern?this.features.push(Lf("fill-extrusion",this.layers,C,this.zoom,r)):this.addFeature(C,C.geometry,g,n,{},r.availableImages),r.featureIndex.insert(u,C.geometry,g,v,this.index,M)}this.sortBorders()}addFeatures(e,r,n,c){for(const u of this.features){const{geometry:p}=u;this.addFeature(u,p,u.index,r,n,c)}this.sortBorders()}update(e,r,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Tx),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,wx.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,n,c,u,p){const g=this.enableTerrain?new s_:null;for(const w of Pf(r,500)){let A=0,C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(w.length===0||(v=w[0]).every(q=>q.x<=0)||v.every(q=>q.x>=jt)||v.every(q=>q.y<=0)||v.every(q=>q.y>=jt))continue;for(let q=0;q<w.length;q++){const Q=w[q];if(Q.length===0)continue;A+=Q.length;let oe=0;g&&g.startRing(Q[0]);for(let ce=0;ce<Q.length;ce++){const de=Q[ce];if(ce>=1){const pe=Q[ce-1];if(!kx(de,pe)){g&&g.append(de,pe),C.vertexLength+4>or.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const me=de.sub(pe)._perp(),ke=me.x/(Math.abs(me.x)+Math.abs(me.y)),Ce=me.y>0?1:0,Ye=pe.dist(de);oe+Ye>32768&&(oe=0),Pc(this.layoutVertexArray,de.x,de.y,ke,Ce,0,0,oe),Pc(this.layoutVertexArray,de.x,de.y,ke,Ce,0,1,oe),oe+=Ye,Pc(this.layoutVertexArray,pe.x,pe.y,ke,Ce,0,0,oe),Pc(this.layoutVertexArray,pe.x,pe.y,ke,Ce,0,1,oe);const qe=C.vertexLength;this.indexArray.emplaceBack(qe,qe+2,qe+1),this.indexArray.emplaceBack(qe+1,qe+2,qe+3),C.vertexLength+=4,C.primitiveLength+=2}}}}if(C.vertexLength+A>or.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray)),Mx[e.type]!=="Polygon")continue;const M=[],L=[],B=C.vertexLength;for(let q=0;q<w.length;q++){const Q=w[q];if(Q.length!==0){Q!==w[0]&&L.push(M.length/2);for(let oe=0;oe<Q.length;oe++){const ce=Q[oe];Pc(this.layoutVertexArray,ce.x,ce.y,0,0,1,1,0),M.push(ce.x),M.push(ce.y),g&&g.currentPolyCount.top++}}}const G=Sh(M,L);for(let q=0;q<G.length;q+=3)this.indexArray.emplaceBack(B+G[q],B+G[q+2],B+G[q+1]);C.primitiveLength+=G.length/3,C.vertexLength+=A}var v;if(g&&g.polyCount.length>0){if(g.borders){g.vertexArrayOffset=this.centroidVertexArray.length;const w=g.borders,A=this.featuresOnBorder.push(g)-1;for(let C=0;C<4;C++)w[C][0]!==Number.MAX_VALUE&&this.borders[C].push(A)}this.encodeCentroid(g.borders?void 0:g.centroid(),g)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,p,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,n)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}encodeCentroid(e,r,n=!0){let c,u;if(e)if(e.y!==0){const g=r.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(g.x/10)),u=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(g.y/10))}else c=Math.ceil(7*(e.x+450)),u=0;else c=0,u=+n;let p=n?this.centroidVertexArray.length:r.vertexArrayOffset;for(const g of r.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*g.edges+g.top);for(let v=0;v<2*g.edges;v++)this.centroidVertexArray.emplace(p++,0,u),this.centroidVertexArray.emplace(p++,c,u);for(let v=0;v<g.top;v++)this.centroidVertexArray.emplace(p++,c,u)}}}function kx(t,e){return t.x===e.x&&(t.x<0||t.x>jt)||t.y===e.y&&(t.y<0||t.y>jt)}at("FillExtrusionBucket",Rf,{omit:["layers","features"]}),at("PartMetadata",s_);var zx={paint:new kr({"fill-extrusion-opacity":new lt(Ee["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new gt(Ee["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new lt(Ee["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new lt(Ee["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Tr(Ee["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new gt(Ee["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new gt(Ee["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new lt(Ee["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Dc(t,e){return t.x*e.x+t.y*e.y}function l_(t,e){if(t.length===1){let r=0;const n=e[r++];let c;for(;!c||n.equals(c);)if(c=e[r++],!c)return 1/0;for(;r<e.length;r++){const u=e[r],p=t[0],g=c.sub(n),v=u.sub(n),w=p.sub(n),A=Dc(g,g),C=Dc(g,v),M=Dc(v,v),L=Dc(w,g),B=Dc(w,v),G=A*M-C*C,q=(M*L-C*B)/G,Q=(A*B-C*L)/G,oe=n.z*(1-q-Q)+c.z*q+u.z*Q;if(isFinite(oe))return oe}return 1/0}{let r=1/0;for(const n of e)r=Math.min(r,n.z);return r}}function c_(t){const e=new F(t[0],t[1]);return e.z=t[2],e}function Px(t,e,r,n,c,u,p,g){const v=p*c.getElevationAt(t,e,!0,!0),w=u[0]!==0,A=w?u[1]===0?p*(u[0]/7-450):p*function(C,M,L){const B=Math.floor(M[0]/8),G=Math.floor(M[1]/8),q=10*(M[0]-8*B),Q=10*(M[1]-8*G),oe=C.getElevationAt(B,G,!0,!0),ce=C.getMeterToDEM(L),de=Math.floor(.5*(q*ce-1)),pe=Math.floor(.5*(Q*ce-1)),me=C.tileCoordToPixel(B,G),ke=2*de+1,Ce=2*pe+1,Ye=function(nt,ct,Kt,ki,ei){return[nt.getElevationAtPixel(ct,Kt,!0),nt.getElevationAtPixel(ct+ei,Kt,!0),nt.getElevationAtPixel(ct,Kt+ei,!0),nt.getElevationAtPixel(ct+ki,Kt+ei,!0)]}(C,me.x-de,me.y-pe,ke,Ce),qe=Math.abs(Ye[0]-Ye[1]),Ie=Math.abs(Ye[2]-Ye[3]),We=Math.abs(Ye[0]-Ye[2])+Math.abs(Ye[1]-Ye[3]),Qe=Math.min(.25,.5*ce*(qe+Ie)/ke),Be=Math.min(.25,.5*ce*We/Ce);return oe+Math.max(Qe*q,Be*Q)}(c,u,g):v;return{base:v+(r===0)?-1:r,top:w?Math.max(A+n,v+r+2):v+n}}const Dx=Hi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Lx}=Dx,Rx=Hi([{name:"a_packed",components:3,type:"Float32"}]),{members:Bx}=Rx,Ox=ls.VectorTileFeature.types,Fx=Math.cos(Math.PI/180*37.5);class kh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new af,this.layoutVertexArray2=new sl,this.indexArray=new Vn,this.programConfigurations=new os(e.layers,e.zoom),this.segments=new or,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,c){this.hasPattern=Df("line",this.layers,r);const u=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:A,id:C,index:M,sourceLayerIndex:L}of e){const B=this.layers[0]._featureFilter.needGeometry,G=ss(A,B);if(!this.layers[0]._featureFilter.filter(new It(this.zoom),G,n))continue;const q=u?u.evaluate(G,{},n):void 0,Q={id:C,properties:A.properties,type:A.type,sourceLayerIndex:L,index:M,geometry:B?G.geometry:qo(A,n,c),patterns:{},sortKey:q};p.push(Q)}u&&p.sort((A,C)=>A.sortKey-C.sortKey);const{lineAtlas:g,featureIndex:v}=r,w=this.addConstantDashes(g);for(const A of p){const{geometry:C,index:M,sourceLayerIndex:L}=A;if(w&&this.addFeatureDashes(A,g),this.hasPattern){const B=Lf("line",this.layers,A,this.zoom,r);this.patternFeatures.push(B)}else this.addFeature(A,C,M,n,g.positions,r.availableImages);v.insert(e[M].feature,C,M,L,this.index)}}addConstantDashes(e){let r=!1;for(const n of this.layers){const c=n.paint.get("line-dasharray").value,u=n.layout.get("line-cap").value;if(c.kind!=="constant"||u.kind!=="constant")r=!0;else{const p=u.value,g=c.value;if(!g)continue;e.addDash(g.from,p),e.addDash(g.to,p),g.other&&e.addDash(g.other,p)}}return r}addFeatureDashes(e,r){const n=this.zoom;for(const c of this.layers){const u=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(u.kind==="constant"&&p.kind==="constant")continue;let g,v,w,A,C,M;if(u.kind==="constant"){const q=u.value;if(!q)continue;g=q.other||q.to,v=q.to,w=q.from}else g=u.evaluate({zoom:n-1},e),v=u.evaluate({zoom:n},e),w=u.evaluate({zoom:n+1},e);p.kind==="constant"?A=C=M=p.value:(A=p.evaluate({zoom:n-1},e),C=p.evaluate({zoom:n},e),M=p.evaluate({zoom:n+1},e)),r.addDash(g,A),r.addDash(v,C),r.addDash(w,M);const L=r.getKey(g,A),B=r.getKey(v,C),G=r.getKey(w,M);e.patterns[c.id]={min:L,mid:B,max:G}}}update(e,r,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,c)}addFeatures(e,r,n,c){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,n,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Bx)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lx),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,n,c,u,p){const g=this.layers[0].layout,v=g.get("line-join").evaluate(e,{}),w=g.get("line-cap").evaluate(e,{}),A=g.get("line-miter-limit"),C=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const M of r)this.addLine(M,e,v,w,A,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,p,c)}addLine(e,r,n,c,u,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<e.length-1;Q++)this.totalDistance+=e[Q].dist(e[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g=Ox[r.type]==="Polygon";let v=e.length;for(;v>=2&&e[v-1].equals(e[v-2]);)v--;let w=0;for(;w<v-1&&e[w].equals(e[w+1]);)w++;if(v<(g?3:2))return;n==="bevel"&&(u=1.05);const A=this.overscaling<=16?122880/(512*this.overscaling):0,C=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let M,L,B,G,q;this.e1=this.e2=-1,g&&(M=e[v-2],q=e[w].sub(M)._unit()._perp());for(let Q=w;Q<v;Q++){if(B=Q===v-1?g?e[w+1]:void 0:e[Q+1],B&&e[Q].equals(B))continue;q&&(G=q),M&&(L=M),M=e[Q],q=B?B.sub(M)._unit()._perp():G,G=G||q;let oe=G.add(q);oe.x===0&&oe.y===0||oe._unit();const ce=G.x*q.x+G.y*q.y,de=oe.x*q.x+oe.y*q.y,pe=de!==0?1/de:1/0,me=2*Math.sqrt(2-2*de),ke=de<Fx&&L&&B,Ce=G.x*q.y-G.y*q.x>0;if(ke&&Q>w){const Ie=M.dist(L);if(Ie>2*A){const We=M.sub(M.sub(L)._mult(A/Ie)._round());this.updateDistance(L,We),this.addCurrentVertex(We,G,0,0,C),L=We}}const Ye=L&&B;let qe=Ye?n:g?"butt":c;if(Ye&&qe==="round"&&(pe<p?qe="miter":pe<=2&&(qe="fakeround")),qe==="miter"&&pe>u&&(qe="bevel"),qe==="bevel"&&(pe>2&&(qe="flipbevel"),pe<u&&(qe="miter")),L&&this.updateDistance(L,M),qe==="miter")oe._mult(pe),this.addCurrentVertex(M,oe,0,0,C);else if(qe==="flipbevel"){if(pe>100)oe=q.mult(-1);else{const Ie=pe*G.add(q).mag()/G.sub(q).mag();oe._perp()._mult(Ie*(Ce?-1:1))}this.addCurrentVertex(M,oe,0,0,C),this.addCurrentVertex(M,oe.mult(-1),0,0,C)}else if(qe==="bevel"||qe==="fakeround"){const Ie=-Math.sqrt(pe*pe-1),We=Ce?Ie:0,Qe=Ce?0:Ie;if(L&&this.addCurrentVertex(M,G,We,Qe,C),qe==="fakeround"){const Be=Math.round(180*me/Math.PI/20);for(let nt=1;nt<Be;nt++){let ct=nt/Be;if(ct!==.5){const ki=ct-.5;ct+=ct*ki*(ct-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*ki*ki+(.848013+ce*(.215638*ce-1.06021)))}const Kt=q.sub(G)._mult(ct)._add(G)._unit()._mult(Ce?-1:1);this.addHalfVertex(M,Kt.x,Kt.y,!1,Ce,0,C)}}B&&this.addCurrentVertex(M,q,-We,-Qe,C)}else if(qe==="butt")this.addCurrentVertex(M,oe,0,0,C);else if(qe==="square"){const Ie=L?1:-1;L||this.addCurrentVertex(M,oe,Ie,Ie,C),this.addCurrentVertex(M,oe,0,0,C),L&&this.addCurrentVertex(M,oe,Ie,Ie,C)}else qe==="round"&&(L&&(this.addCurrentVertex(M,G,0,0,C),this.addCurrentVertex(M,G,1,1,C,!0)),B&&(this.addCurrentVertex(M,q,-1,-1,C,!0),this.addCurrentVertex(M,q,0,0,C)));if(ke&&Q<v-1){const Ie=M.dist(B);if(Ie>2*A){const We=M.add(B.sub(M)._mult(A/Ie)._round());this.updateDistance(M,We),this.addCurrentVertex(We,q,0,0,C),M=We}}}}addCurrentVertex(e,r,n,c,u,p=!1){const g=r.y*c-r.x,v=-r.y-r.x*c;this.addHalfVertex(e,r.x+r.y*n,r.y-r.x*n,p,!1,n,u),this.addHalfVertex(e,g,v,p,!0,-c,u)}addHalfVertex({x:e,y:r},n,c,u,p,g,v){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(r<<1)+(p?1:0),Math.round(63*n)+128,Math.round(63*c)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const w=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),v.primitiveLength++),p?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}at("LineBucket",kh,{omit:["layers","patternFeatures"]});const Ux=new kr({"line-cap":new gt(Ee.layout_line["line-cap"]),"line-join":new gt(Ee.layout_line["line-join"]),"line-miter-limit":new lt(Ee.layout_line["line-miter-limit"]),"line-round-limit":new lt(Ee.layout_line["line-round-limit"]),"line-sort-key":new gt(Ee.layout_line["line-sort-key"])});var u_={paint:new kr({"line-opacity":new gt(Ee.paint_line["line-opacity"]),"line-color":new gt(Ee.paint_line["line-color"]),"line-translate":new lt(Ee.paint_line["line-translate"]),"line-translate-anchor":new lt(Ee.paint_line["line-translate-anchor"]),"line-width":new gt(Ee.paint_line["line-width"]),"line-gap-width":new gt(Ee.paint_line["line-gap-width"]),"line-offset":new gt(Ee.paint_line["line-offset"]),"line-blur":new gt(Ee.paint_line["line-blur"]),"line-dasharray":new Tr(Ee.paint_line["line-dasharray"]),"line-pattern":new Tr(Ee.paint_line["line-pattern"]),"line-gradient":new Mo(Ee.paint_line["line-gradient"])}),layout:Ux};const h_=new class extends gt{possiblyEvaluate(t,e){return e=new It(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,r,n){return e=Gt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,r,n)}}(u_.paint.properties["line-width"].specification);function d_(t,e){return e>0?e+2*t:t}h_.useIntegerZoom=!0;const Vx=Hi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),Nx=Hi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Hi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const jx=Hi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Gx=Hi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Hi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const f_=Hi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$x=Hi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Hi([{name:"triangle",components:3,type:"Uint16"}]),Hi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Hi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Hi([{type:"Float32",name:"offsetX"}]),Hi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Rr=24;const ko=128;function Bf(t,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new It(t+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:c}=r;let u=0;for(;u<n.length&&n[u]<=t;)u++;u=Math.max(0,u-1);let p=u;for(;p<n.length&&n[p]<t+1;)p++;p=Math.min(n.length-1,p);const g=n[u],v=n[p];return r.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:v,interpolationType:c}:{kind:"camera",minZoom:g,maxZoom:v,minSize:r.evaluate(new It(g)),maxSize:r.evaluate(new It(v)),interpolationType:c}}}function zh(t,{uSize:e,uSizeT:r},{lowerSize:n,upperSize:c}){return t.kind==="source"?n/ko:t.kind==="composite"?_i(n/ko,c/ko,r):e}function ml(t,e){let r=0,n=0;if(t.kind==="constant")n=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:c,minZoom:u,maxZoom:p}=t,g=c?Nt(qr.interpolationFactor(c,e,u,p),0,1):0;t.kind==="camera"?n=_i(t.minSize,t.maxSize,g):r=g}return{uSizeT:r,uSize:n}}var Zx=Object.freeze({__proto__:null,getSizeData:Bf,evaluateSizeForFeature:zh,evaluateSizeForZoom:ml,SIZE_PACK_FACTOR:ko});function qx(t,e,r){return t.sections.forEach(n=>{n.text=function(c,u,p){const g=u.layout.get("text-transform").evaluate(p,{});return g==="uppercase"?c=c.toLocaleUpperCase():g==="lowercase"&&(c=c.toLocaleLowerCase()),Qt.applyArabicShaping&&(c=Qt.applyArabicShaping(c)),c}(n.text,e,r)}),t}const Lc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function Wx(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function Hx(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}var p_=function(t,e,r,n,c){var u,p,g=8*c-n-1,v=(1<<g)-1,w=v>>1,A=-7,C=r?c-1:0,M=r?-1:1,L=t[e+C];for(C+=M,u=L&(1<<-A)-1,L>>=-A,A+=g;A>0;u=256*u+t[e+C],C+=M,A-=8);for(p=u&(1<<-A)-1,u>>=-A,A+=n;A>0;p=256*p+t[e+C],C+=M,A-=8);if(u===0)u=1-w;else{if(u===v)return p?NaN:1/0*(L?-1:1);p+=Math.pow(2,n),u-=w}return(L?-1:1)*p*Math.pow(2,u-n)},m_=function(t,e,r,n,c,u){var p,g,v,w=8*u-c-1,A=(1<<w)-1,C=A>>1,M=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=n?0:u-1,B=n?1:-1,G=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,p=A):(p=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-p))<1&&(p--,v*=2),(e+=p+C>=1?M/v:M*Math.pow(2,1-C))*v>=2&&(p++,v/=2),p+C>=A?(g=0,p=A):p+C>=1?(g=(e*v-1)*Math.pow(2,c),p+=C):(g=e*Math.pow(2,C-1)*Math.pow(2,c),p=0));c>=8;t[r+L]=255&g,L+=B,g/=256,c-=8);for(p=p<<c|g,w+=c;w>0;t[r+L]=255&p,L+=B,p/=256,w-=8);t[r+L-B]|=128*G},Rc=Ii;function Ii(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ii.Varint=0,Ii.Fixed64=1,Ii.Bytes=2,Ii.Fixed32=5;var Of=4294967296,__=1/Of,g_=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Wo(t){return t.type===Ii.Bytes?t.readVarint()+t.pos:t.pos+1}function _l(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function y_(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var c=r.pos-1;c>=t;c--)r.buf[c+n]=r.buf[c]}function Xx(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function Kx(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function Yx(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function Jx(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function Qx(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function e1(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function t1(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function i1(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function r1(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function Ph(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function gl(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function v_(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function n1(t,e,r){e.glyphs=[],t===1&&r.readMessage(o1,e)}function o1(t,e,r){if(t===3){const{id:n,bitmap:c,width:u,height:p,left:g,top:v,advance:w}=r.readMessage(a1,{});e.glyphs.push({id:n,bitmap:new ga({width:u+6,height:p+6},c),metrics:{width:u,height:p,left:g,top:v,advance:w}})}else t===4?e.ascender=r.readSVarint():t===5&&(e.descender=r.readSVarint())}function a1(t,e,r){t===1?e.id=r.readVarint():t===2?e.bitmap=r.readBytes():t===3?e.width=r.readVarint():t===4?e.height=r.readVarint():t===5?e.left=r.readSVarint():t===6?e.top=r.readSVarint():t===7&&(e.advance=r.readVarint())}function Ff(t){let e=0,r=0;for(const p of t)e+=p.w*p.h,r=Math.max(r,p.w);t.sort((p,g)=>g.h-p.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let c=0,u=0;for(const p of t)for(let g=n.length-1;g>=0;g--){const v=n[g];if(!(p.w>v.w||p.h>v.h)){if(p.x=v.x,p.y=v.y,u=Math.max(u,p.y+p.h),c=Math.max(c,p.x+p.w),p.w===v.w&&p.h===v.h){const w=n.pop();g<n.length&&(n[g]=w)}else p.h===v.h?(v.x+=p.w,v.w-=p.w):p.w===v.w?(v.y+=p.h,v.h-=p.h):(n.push({x:v.x+p.w,y:v.y,w:v.w-p.w,h:p.h}),v.y+=p.h,v.h-=p.h);break}}return{w:c,h:u,fill:e/(c*u)||0}}Ii.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),c=n>>3,u=this.pos;this.type=7&n,t(c,e,this),this.pos===u&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Ph(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=v_(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Ph(this.buf,this.pos)+Ph(this.buf,this.pos+4)*Of;return this.pos+=8,t},readSFixed64:function(){var t=Ph(this.buf,this.pos)+v_(this.buf,this.pos+4)*Of;return this.pos+=8,t},readFloat:function(){var t=p_(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=p_(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(c,u,p){var g,v,w=p.buf;if(g=(112&(v=w[p.pos++]))>>4,v<128||(g|=(127&(v=w[p.pos++]))<<3,v<128)||(g|=(127&(v=w[p.pos++]))<<10,v<128)||(g|=(127&(v=w[p.pos++]))<<17,v<128)||(g|=(127&(v=w[p.pos++]))<<24,v<128)||(g|=(1&(v=w[p.pos++]))<<31,v<128))return _l(c,g,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&g_?function(r,n,c){return g_.decode(r.subarray(n,c))}(this.buf,e,t):function(r,n,c){for(var u="",p=n;p<c;){var g,v,w,A=r[p],C=null,M=A>239?4:A>223?3:A>191?2:1;if(p+M>c)break;M===1?A<128&&(C=A):M===2?(192&(g=r[p+1]))==128&&(C=(31&A)<<6|63&g)<=127&&(C=null):M===3?(v=r[p+2],(192&(g=r[p+1]))==128&&(192&v)==128&&((C=(15&A)<<12|(63&g)<<6|63&v)<=2047||C>=55296&&C<=57343)&&(C=null)):M===4&&(v=r[p+2],w=r[p+3],(192&(g=r[p+1]))==128&&(192&v)==128&&(192&w)==128&&((C=(15&A)<<18|(63&g)<<12|(63&v)<<6|63&w)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,M=1):C>65535&&(C-=65536,u+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),u+=String.fromCharCode(C),p+=M}return u}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Ii.Bytes)return t.push(this.readVarint(e));var r=Wo(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Ii.Bytes)return t.push(this.readSVarint());var e=Wo(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ii.Bytes)return t.push(this.readBoolean());var e=Wo(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ii.Bytes)return t.push(this.readFloat());var e=Wo(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ii.Bytes)return t.push(this.readDouble());var e=Wo(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ii.Bytes)return t.push(this.readFixed32());var e=Wo(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ii.Bytes)return t.push(this.readSFixed32());var e=Wo(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ii.Bytes)return t.push(this.readFixed64());var e=Wo(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ii.Bytes)return t.push(this.readSFixed64());var e=Wo(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Ii.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ii.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ii.Fixed32)this.pos+=4;else{if(e!==Ii.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),gl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),gl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),gl(this.buf,-1&t,this.pos),gl(this.buf,Math.floor(t*__),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),gl(this.buf,-1&t,this.pos),gl(this.buf,Math.floor(t*__),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,r){var n,c;if(e>=0?(n=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(u,p,g){g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,g.buf[g.pos]=127&(u>>>=7)}(n,0,r),function(u,p){var g=(7&u)<<4;p.buf[p.pos++]|=g|((u>>>=3)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u)))))}(c,r)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(n,c,u){for(var p,g,v=0;v<c.length;v++){if((p=c.charCodeAt(v))>55295&&p<57344){if(!g){p>56319||v+1===c.length?(n[u++]=239,n[u++]=191,n[u++]=189):g=p;continue}if(p<56320){n[u++]=239,n[u++]=191,n[u++]=189,g=p;continue}p=g-55296<<10|p-56320|65536,g=null}else g&&(n[u++]=239,n[u++]=191,n[u++]=189,g=null);p<128?n[u++]=p:(p<2048?n[u++]=p>>6|192:(p<65536?n[u++]=p>>12|224:(n[u++]=p>>18|240,n[u++]=p>>12&63|128),n[u++]=p>>6&63|128),n[u++]=63&p|128)}return u}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&y_(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),m_(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),m_(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&y_(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,Ii.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Xx,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Kx,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Qx,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Yx,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Jx,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,e1,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,t1,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,i1,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,r1,e)},writeBytesField:function(t,e){this.writeTag(t,Ii.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Ii.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Ii.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Ii.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Ii.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Ii.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Ii.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Ii.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Ii.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Ii.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Uf{constructor(e,{pixelRatio:r,version:n,stretchX:c,stretchY:u,content:p}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=c,this.stretchY=u,this.content=p,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class x_{constructor(e,r){const n={},c={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,n,u),this.addImages(r,c,u);const{w:p,h:g}=Ff(u),v=new Nn({width:p||1,height:g||1});for(const w in e){const A=e[w],C=n[w].paddedRect;Nn.copy(A.data,v,{x:0,y:0},{x:C.x+1,y:C.y+1},A.data)}for(const w in r){const A=r[w],C=c[w].paddedRect,M=C.x+1,L=C.y+1,B=A.data.width,G=A.data.height;Nn.copy(A.data,v,{x:0,y:0},{x:M,y:L},A.data),Nn.copy(A.data,v,{x:0,y:G-1},{x:M,y:L-1},{width:B,height:1}),Nn.copy(A.data,v,{x:0,y:0},{x:M,y:L+G},{width:B,height:1}),Nn.copy(A.data,v,{x:B-1,y:0},{x:M-1,y:L},{width:1,height:G}),Nn.copy(A.data,v,{x:0,y:0},{x:M+B,y:L},{width:1,height:G})}this.image=v,this.iconPositions=n,this.patternPositions=c}addImages(e,r,n){for(const c in e){const u=e[c],p={x:0,y:0,w:u.data.width+2,h:u.data.height+2};n.push(p),r[c]=new Uf(p,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),r),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),r)}patchUpdatedImage(e,r,n){if(!e||!r||e.version===r.version)return;e.version=r.version;const[c,u]=e.tl;n.update(r.data,void 0,{x:c,y:u})}}at("ImagePosition",Uf),at("ImageAtlas",x_);const jn={horizontal:1,vertical:2,horizontalOnly:3};class Bc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const n=new Bc;return n.scale=e||1,n.fontStack=r,n}static forImage(e){const r=new Bc;return r.imageName=e,r}}class yl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const n=new yl;for(let c=0;c<e.sections.length;c++){const u=e.sections[c];u.image?n.addImageSection(u):n.addTextSection(u,r)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,n){let c="";for(let u=0;u<r.length;u++){const p=r.charCodeAt(u+1)||null,g=r.charCodeAt(u-1)||null;c+=!n&&(p&&dt(p)&&!Lc[r[u+1]]||g&&dt(g)&&!Lc[r[u-1]])||!Lc[r[u]]?r[u]:Lc[r[u]]}return c}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&Dh[this.text.charCodeAt(n)];n++)e++;let r=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&Dh[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const n=new yl;return n.text=this.text.substring(e,r),n.sectionIndex=this.sectionIndex.slice(e,r),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Bc.forText(e.scale,e.fontStack||r));const n=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(n)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void et("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Bc.forImage(r)),this.sectionIndex.push(this.sections.length-1)):et("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Vf(t,e,r,n,c,u,p,g,v,w,A,C,M,L,B,G){const q=yl.fromFeature(t,c);let Q;C===jn.vertical&&q.verticalizePunctuation(M);const{processBidirectionalText:oe,processStyledBidirectionalText:ce}=Qt;if(oe&&q.sections.length===1){Q=[];const me=oe(q.toString(),Nf(q,w,u,e,n,L,B));for(const ke of me){const Ce=new yl;Ce.text=ke,Ce.sections=q.sections;for(let Ye=0;Ye<ke.length;Ye++)Ce.sectionIndex.push(0);Q.push(Ce)}}else if(ce){Q=[];const me=ce(q.text,q.sectionIndex,Nf(q,w,u,e,n,L,B));for(const ke of me){const Ce=new yl;Ce.text=ke[0],Ce.sectionIndex=ke[1],Ce.sections=q.sections,Q.push(Ce)}}else Q=function(me,ke){const Ce=[],Ye=me.text;let qe=0;for(const Ie of ke)Ce.push(me.substring(qe,Ie)),qe=Ie;return qe<Ye.length&&Ce.push(me.substring(qe,Ye.length)),Ce}(q,Nf(q,w,u,e,n,L,B));const de=[],pe={positionedLines:de,text:q.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(me,ke,Ce,Ye,qe,Ie,We,Qe,Be,nt,ct,Kt){let ki=0,ei=0,ti=0;const $e=Qe==="right"?1:Qe==="left"?0:.5;let li=!1;for(const ci of qe){const Wt=ci.getSections();for(const Gi of Wt){if(Gi.imageName)continue;const lr=ke[Gi.fontStack];if(lr&&(li=lr.ascender!==void 0&&lr.descender!==void 0,!li))break}if(!li)break}let ri=0;for(const ci of qe){ci.trim();const Wt=ci.getMaxScale(),Gi=(Wt-1)*Rr,lr={positionedGlyphs:[],lineOffset:0};me.positionedLines[ri]=lr;const Qi=lr.positionedGlyphs;let hr=0;if(!ci.length()){ei+=Ie,++ri;continue}let Br=0,cn=0;for(let Oi=0;Oi<ci.length();Oi++){const Er=ci.getSection(Oi),Jn=ci.getSectionIndex(Oi),zr=ci.getCharCode(Oi);let Ei=Er.scale,Ar=null,$i=null,Nr=null,gr=Rr,jr=0;const Xr=!(Be===jn.horizontal||!ct&&!ze(zr)||ct&&(Dh[zr]||(sr=zr,i(sr)||a(sr)||d(sr)||se(sr)||je(sr))));if(Er.imageName){const Kr=Ye[Er.imageName];if(!Kr)continue;Nr=Er.imageName,me.iconsInText=me.iconsInText||!0,$i=Kr.paddedRect;const Cr=Kr.displaySize;Ei=Ei*Rr/Kt,Ar={width:Cr[0],height:Cr[1],left:1,top:-3,advance:Xr?Cr[1]:Cr[0],localGlyph:!1},jr=li?-Ar.height*Ei:Wt*Rr-17-Cr[1]*Ei,gr=Ar.advance;const co=(Xr?Cr[0]:Cr[1])*Ei-Rr*Wt;co>0&&co>hr&&(hr=co)}else{const Kr=Ce[Er.fontStack];if(!Kr)continue;Kr[zr]&&($i=Kr[zr]);const Cr=ke[Er.fontStack];if(!Cr)continue;const co=Cr.glyphs[zr];if(!co)continue;if(Ar=co.metrics,gr=zr!==8203?Rr:0,li){const Sl=Cr.ascender!==void 0?Math.abs(Cr.ascender):0,Gc=Cr.descender!==void 0?Math.abs(Cr.descender):0,$c=(Sl+Gc)*Ei;Br<$c&&(Br=$c,cn=(Sl-Gc)/2*Ei),jr=-Sl*Ei}else jr=(Wt-Ei)*Rr-17}Xr?(me.verticalizable=!0,Qi.push({glyph:zr,imageName:Nr,x:ki,y:ei+jr,vertical:Xr,scale:Ei,localGlyph:Ar.localGlyph,fontStack:Er.fontStack,sectionIndex:Jn,metrics:Ar,rect:$i}),ki+=gr*Ei+nt):(Qi.push({glyph:zr,imageName:Nr,x:ki,y:ei+jr,vertical:Xr,scale:Ei,localGlyph:Ar.localGlyph,fontStack:Er.fontStack,sectionIndex:Jn,metrics:Ar,rect:$i}),ki+=Ar.advance*Ei+nt)}Qi.length!==0&&(ti=Math.max(ki-nt,ti),li?E_(Qi,$e,hr,cn,Ie*Wt/2):E_(Qi,$e,hr,0,Ie/2)),ki=0;const un=Ie*Wt+hr;lr.lineOffset=Math.max(hr,Gi),ei+=un,++ri}var sr;const Ki=ei,{horizontalAlign:Sr,verticalAlign:Vr}=jf(We);(function(ci,Wt,Gi,lr,Qi,hr){const Br=(Wt-Gi)*Qi,cn=-hr*lr;for(const un of ci)for(const Oi of un.positionedGlyphs)Oi.x+=Br,Oi.y+=cn})(me.positionedLines,$e,Sr,Vr,ti,Ki),me.top+=-Vr*Ki,me.bottom=me.top+Ki,me.left+=-Sr*ti,me.right=me.left+ti,me.hasBaseline=li}(pe,e,r,n,Q,p,g,v,C,w,M,G),!function(me){for(const ke of me)if(ke.positionedGlyphs.length!==0)return!1;return!0}(de)&&pe}const Dh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},s1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function b_(t,e,r,n,c,u){if(e.imageName){const p=n[e.imageName];return p?p.displaySize[0]*e.scale*Rr/u+c:0}{const p=r[e.fontStack],g=p&&p.glyphs[t];return g?g.metrics.advance*e.scale+c:0}}function w_(t,e,r,n){const c=Math.pow(t-e,2);return n?t<e?c/2:2*c:c+Math.abs(r)*r}function l1(t,e,r){let n=0;return t===10&&(n-=1e4),r&&(n+=150),t!==40&&t!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function T_(t,e,r,n,c,u){let p=null,g=w_(e,r,c,u);for(const v of n){const w=w_(e-v.x,r,c,u)+v.badness;w<=g&&(p=v,g=w)}return{index:t,x:e,priorBreak:p,badness:g}}function S_(t){return t?S_(t.priorBreak).concat(t.index):[]}function Nf(t,e,r,n,c,u,p){if(u!=="point")return[];if(!t)return[];const g=[],v=function(M,L,B,G,q,Q){let oe=0;for(let ce=0;ce<M.length();ce++){const de=M.getSection(ce);oe+=b_(M.getCharCode(ce),de,G,q,L,Q)}return oe/Math.max(1,Math.ceil(oe/B))}(t,e,r,n,c,p),w=t.text.indexOf("\u200B")>=0;let A=0;for(let M=0;M<t.length();M++){const L=t.getSection(M),B=t.getCharCode(M);if(Dh[B]||(A+=b_(B,L,n,c,e,p)),M<t.length()-1){const G=!((C=B)<11904||!(R(C)||P(C)||Te(C)||ie(C)||K(C)||_(C)||j(C)||E(C)||ae(C)||W(C)||Z(C)||Ve(C)||I(C)||b(C)||y(C)||X(C)||z(C)||ge(C)||ne(C)||re(C)));(s1[B]||G||L.imageName)&&g.push(T_(M+1,A,v,g,l1(B,t.getCharCode(M+1),G&&w),!1))}}var C;return S_(T_(t.length(),A,v,g,0,!0))}function jf(t){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function E_(t,e,r,n,c){if(!(e||r||n||c))return;const u=t.length-1,p=t[u],g=(p.x+p.metrics.advance*p.scale)*e;for(let v=0;v<=u;v++)t[v].x-=g,t[v].y+=r+n+c}function c1(t,e,r){const{horizontalAlign:n,verticalAlign:c}=jf(r),u=e[0]-t.displaySize[0]*n,p=e[1]-t.displaySize[1]*c;return{image:t,top:p,bottom:p+t.displaySize[1],left:u,right:u+t.displaySize[0]}}function A_(t,e,r,n,c,u){const p=t.image;let g;if(p.content){const q=p.content,Q=p.pixelRatio||1;g=[q[0]/Q,q[1]/Q,p.displaySize[0]-q[2]/Q,p.displaySize[1]-q[3]/Q]}const v=e.left*u,w=e.right*u;let A,C,M,L;r==="width"||r==="both"?(L=c[0]+v-n[3],C=c[0]+w+n[1]):(L=c[0]+(v+w-p.displaySize[0])/2,C=L+p.displaySize[0]);const B=e.top*u,G=e.bottom*u;return r==="height"||r==="both"?(A=c[1]+B-n[0],M=c[1]+G+n[2]):(A=c[1]+(B+G-p.displaySize[1])/2,M=A+p.displaySize[1]),{image:p,top:A,right:C,bottom:M,left:L,collisionPadding:g}}class Ho extends F{constructor(e,r,n,c,u){super(e,r),this.angle=c,this.z=n,u!==void 0&&(this.segment=u)}clone(){return new Ho(this.x,this.y,this.z,this.angle,this.segment)}}function C_(t,e,r,n,c){if(e.segment===void 0)return!0;let u=e,p=e.segment+1,g=0;for(;g>-r/2;){if(p--,p<0)return!1;g-=t[p].dist(u),u=t[p]}g+=t[p].dist(t[p+1]),p++;const v=[];let w=0;for(;g<r/2;){const A=t[p],C=t[p+1];if(!C)return!1;let M=t[p-1].angleTo(A)-A.angleTo(C);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:g,angleDelta:M}),w+=M;g-v[0].distance>n;)w-=v.shift().angleDelta;if(w>c)return!1;p++,g+=A.dist(C)}return!0}function M_(t){let e=0;for(let r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function I_(t,e,r){return t?.6*e*r:0}function k_(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function u1(t,e,r,n,c,u){const p=I_(r,c,u),g=k_(r,n)*u;let v=0;const w=M_(t)/2;for(let A=0;A<t.length-1;A++){const C=t[A],M=t[A+1],L=C.dist(M);if(v+L>w){const B=(w-v)/L,G=_i(C.x,M.x,B),q=_i(C.y,M.y,B),Q=new Ho(G,q,0,M.angleTo(C),A);return!p||C_(t,Q,g,p,e)?Q:void 0}v+=L}}function h1(t,e,r,n,c,u,p,g,v){const w=I_(n,u,p),A=k_(n,c),C=A*p,M=t[0].x===0||t[0].x===v||t[0].y===0||t[0].y===v;return e-C<e/4&&(e=C+e/4),z_(t,M?e/2*g%e:(A/2+2*u)*p*g%e,e,w,r,C,M,!1,v)}function z_(t,e,r,n,c,u,p,g,v){const w=u/2,A=M_(t);let C=0,M=e-r,L=[];for(let B=0;B<t.length-1;B++){const G=t[B],q=t[B+1],Q=G.dist(q),oe=q.angleTo(G);for(;M+r<C+Q;){M+=r;const ce=(M-C)/Q,de=_i(G.x,q.x,ce),pe=_i(G.y,q.y,ce);if(de>=0&&de<v&&pe>=0&&pe<v&&M-w>=0&&M+w<=A){const me=new Ho(de,pe,0,oe,B);me._round(),n&&!C_(t,me,u,n,c)||L.push(me)}}C+=Q}return g||L.length||p||(L=z_(t,C/2,r,n,c,u,p,!0,v)),L}function P_(t,e,r,n,c){const u=[];for(let p=0;p<t.length;p++){const g=t[p];let v;for(let w=0;w<g.length-1;w++){let A=g[w],C=g[w+1];A.x<e&&C.x<e||(A.x<e?A=new F(e,A.y+(e-A.x)/(C.x-A.x)*(C.y-A.y))._round():C.x<e&&(C=new F(e,A.y+(e-A.x)/(C.x-A.x)*(C.y-A.y))._round()),A.y<r&&C.y<r||(A.y<r?A=new F(A.x+(r-A.y)/(C.y-A.y)*(C.x-A.x),r)._round():C.y<r&&(C=new F(A.x+(r-A.y)/(C.y-A.y)*(C.x-A.x),r)._round()),A.x>=n&&C.x>=n||(A.x>=n?A=new F(n,A.y+(n-A.x)/(C.x-A.x)*(C.y-A.y))._round():C.x>=n&&(C=new F(n,A.y+(n-A.x)/(C.x-A.x)*(C.y-A.y))._round()),A.y>=c&&C.y>=c||(A.y>=c?A=new F(A.x+(c-A.y)/(C.y-A.y)*(C.x-A.x),c)._round():C.y>=c&&(C=new F(A.x+(c-A.y)/(C.y-A.y)*(C.x-A.x),c)._round()),v&&A.equals(v[v.length-1])||(v=[A],u.push(v)),v.push(C)))))}}return u}at("Anchor",Ho);const Oc=1e20;function D_(t,e,r,n,c,u,p,g,v){for(let w=e;w<e+n;w++)L_(t,r*u+w,u,c,p,g,v);for(let w=r;w<r+c;w++)L_(t,w*u+e,1,n,p,g,v)}function L_(t,e,r,n,c,u,p){u[0]=0,p[0]=-Oc,p[1]=Oc,c[0]=t[e];for(let g=1,v=0,w=0;g<n;g++){c[g]=t[e+g*r];const A=g*g;do{const C=u[v];w=(c[g]-c[C]+A-C*C)/(g-C)/2}while(w<=p[v]&&--v>-1);v++,u[v]=g,p[v]=w,p[v+1]=Oc}for(let g=0,v=0;g<n;g++){for(;p[v+1]<g;)v++;const w=u[v],A=g-w;t[e+g*r]=c[w]+A*A}}const Gf={none:0,ideographs:1,all:2};class vl{constructor(e,r,n){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const n=[];for(const c in e)for(const u of e[c])n.push({stack:c,id:u});Fr(n,({stack:c,id:u},p)=>{let g=this.entries[c];g||(g=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=g.glyphs[u];if(v!==void 0)return void p(null,{stack:c,id:u,glyph:v});if(v=this._tinySDF(g,c,u),v)return g.glyphs[u]=v,void p(null,{stack:c,id:u,glyph:v});const w=Math.floor(u/256);if(256*w>65535)return void p(new Error("glyphs > 65535 not supported"));if(g.ranges[w])return void p(null,{stack:c,id:u,glyph:v});let A=g.requests[w];A||(A=g.requests[w]=[],vl.loadGlyphRange(c,w,this.url,this.requestManager,(C,M)=>{if(M){g.ascender=M.ascender,g.descender=M.descender;for(const L in M.glyphs)this._doesCharSupportLocalGlyph(+L)||(g.glyphs[+L]=M.glyphs[+L]);g.ranges[w]=!0}for(const L of A)L(C,M);delete g.requests[w]})),A.push((C,M)=>{C?p(C):M&&p(null,{stack:c,id:u,glyph:M.glyphs[u]||null})})},(c,u)=>{if(c)r(c);else if(u){const p={};for(const{stack:g,id:v,glyph:w}of u)p[g]===void 0&&(p[g]={}),p[g].glyphs===void 0&&(p[g].glyphs={}),p[g].glyphs[v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},p[g].ascender=this.entries[g].ascender,p[g].descender=this.entries[g].descender;r(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Gf.none&&(this.localGlyphMode===Gf.all?!!this.localFontFamily:!!this.localFontFamily&&(W(e)||te(e)||I(e)||z(e))||E(e))}_tinySDF(e,r,n){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(n))return;let u=e.tinySDF;if(!u){let G="400";/bold/i.test(r)?G="900":/medium/i.test(r)?G="500":/light/i.test(r)&&(G="200"),u=e.tinySDF=new vl.TinySDF({fontFamily:c,fontWeight:G,fontSize:48,buffer:6,radius:16}),u.fontWeight=G}if(this.localGlyphs[u.fontWeight][n])return this.localGlyphs[u.fontWeight][n];const p=String.fromCharCode(n),{data:g,width:v,height:w,glyphWidth:A,glyphHeight:C,glyphLeft:M,glyphTop:L,glyphAdvance:B}=u.draw(p);return this.localGlyphs[u.fontWeight][n]={id:n,bitmap:new ga({width:v,height:w},g),metrics:{width:A/2,height:C/2,left:M/2,top:L/2-27,advance:B/2,localGlyph:!0}}}}function R_(t,e,r,n){const c=[],u=t.image,p=u.pixelRatio,g=u.paddedRect.w-2,v=u.paddedRect.h-2,w=t.right-t.left,A=t.bottom-t.top,C=u.stretchX||[[0,g]],M=u.stretchY||[[0,v]],L=(Ie,We)=>Ie+We[1]-We[0],B=C.reduce(L,0),G=M.reduce(L,0),q=g-B,Q=v-G;let oe=0,ce=B,de=0,pe=G,me=0,ke=q,Ce=0,Ye=Q;if(u.content&&n){const Ie=u.content;oe=Lh(C,0,Ie[0]),de=Lh(M,0,Ie[1]),ce=Lh(C,Ie[0],Ie[2]),pe=Lh(M,Ie[1],Ie[3]),me=Ie[0]-oe,Ce=Ie[1]-de,ke=Ie[2]-Ie[0]-ce,Ye=Ie[3]-Ie[1]-pe}const qe=(Ie,We,Qe,Be)=>{const nt=Rh(Ie.stretch-oe,ce,w,t.left),ct=Bh(Ie.fixed-me,ke,Ie.stretch,B),Kt=Rh(We.stretch-de,pe,A,t.top),ki=Bh(We.fixed-Ce,Ye,We.stretch,G),ei=Rh(Qe.stretch-oe,ce,w,t.left),ti=Bh(Qe.fixed-me,ke,Qe.stretch,B),$e=Rh(Be.stretch-de,pe,A,t.top),li=Bh(Be.fixed-Ce,Ye,Be.stretch,G),ri=new F(nt,Kt),sr=new F(ei,Kt),Ki=new F(ei,$e),Sr=new F(nt,$e),Vr=new F(ct/p,ki/p),ci=new F(ti/p,li/p),Wt=e*Math.PI/180;if(Wt){const Qi=Math.sin(Wt),hr=Math.cos(Wt),Br=[hr,-Qi,Qi,hr];ri._matMult(Br),sr._matMult(Br),Sr._matMult(Br),Ki._matMult(Br)}const Gi=Ie.stretch+Ie.fixed,lr=We.stretch+We.fixed;return{tl:ri,tr:sr,bl:Sr,br:Ki,tex:{x:u.paddedRect.x+1+Gi,y:u.paddedRect.y+1+lr,w:Qe.stretch+Qe.fixed-Gi,h:Be.stretch+Be.fixed-lr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vr,pixelOffsetBR:ci,minFontScaleX:ke/p/w,minFontScaleY:Ye/p/A,isSDF:r}};if(n&&(u.stretchX||u.stretchY)){const Ie=B_(C,q,B),We=B_(M,Q,G);for(let Qe=0;Qe<Ie.length-1;Qe++){const Be=Ie[Qe],nt=Ie[Qe+1];for(let ct=0;ct<We.length-1;ct++)c.push(qe(Be,We[ct],nt,We[ct+1]))}}else c.push(qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:v+1}));return c}function Lh(t,e,r){let n=0;for(const c of t)n+=Math.max(e,Math.min(r,c[1]))-Math.max(e,Math.min(r,c[0]));return n}function B_(t,e,r){const n=[{fixed:-1,stretch:0}];for(const[c,u]of t){const p=n[n.length-1];n.push({fixed:c-p.stretch,stretch:p.stretch}),n.push({fixed:c-p.stretch,stretch:p.stretch+(u-c)})}return n.push({fixed:e+1,stretch:r}),n}function Rh(t,e,r,n){return t/e*r+n}function Bh(t,e,r,n){return t-e*r/n}function d1(t,e,r,n){const c=e+t.positionedLines[n].lineOffset;return n===0?r+c/2:r+(c+(e+t.positionedLines[n-1].lineOffset))/2}vl.loadGlyphRange=function(t,e,r,n,c){const u=256*e,p=u+255,g=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${u}-${p}`),Es.Glyphs);Pa(g,(v,w)=>{if(v)c(v);else if(w){const A={},C=function(M){return new Rc(M).readFields(n1,{})}(w);for(const M of C.glyphs)A[M.id]=M;c(null,{glyphs:A,ascender:C.ascender,descender:C.descender})}})},vl.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:r=8,cutoff:n=.25,fontFamily:c="sans-serif",fontWeight:u="normal",fontStyle:p="normal"}){this.buffer=e,this.cutoff=n,this.radius=r;const g=this.size=t+4*e,v=this._createCanvas(g),w=this.ctx=v.getContext("2d",{willReadFrequently:!0});w.font=`${p} ${u} ${t}px ${c}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:c,actualBoundingBoxRight:u}=this.ctx.measureText(t),p=Math.floor(r),g=Math.min(this.size-this.buffer,Math.ceil(u-c)),v=Math.min(this.size-this.buffer,Math.ceil(r)+Math.ceil(n)),w=g+2*this.buffer,A=v+2*this.buffer,C=w*A,M=new Uint8ClampedArray(C),L={data:M,width:w,height:A,glyphWidth:g,glyphHeight:v,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(g===0||v===0)return L;const{ctx:B,buffer:G,gridInner:q,gridOuter:Q}=this;B.clearRect(G,G,g,v),B.fillText(t,G,G+p+1);const oe=B.getImageData(G,G,g,v);Q.fill(Oc,0,C),q.fill(0,0,C);for(let ce=0;ce<v;ce++)for(let de=0;de<g;de++){const pe=oe.data[4*(ce*g+de)+3]/255;if(pe===0)continue;const me=(ce+G)*w+de+G;if(pe===1)Q[me]=0,q[me]=Oc;else{const ke=.5-pe;Q[me]=ke>0?ke*ke:0,q[me]=ke<0?ke*ke:0}}D_(Q,0,0,w,A,w,this.f,this.v,this.z),D_(q,G,G,g,v,w,this.f,this.v,this.z);for(let ce=0;ce<C;ce++){const de=Math.sqrt(Q[ce])-Math.sqrt(q[ce]);M[ce]=Math.round(255-255*(de/this.radius+this.cutoff))}return L}};class f1{constructor(e=[],r=p1){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:n}=this,c=r[e];for(;e>0;){const u=e-1>>1,p=r[u];if(n(c,p)>=0)break;r[e]=p,e=u}r[e]=c}_down(e){const{data:r,compare:n}=this,c=this.length>>1,u=r[e];for(;e<c;){let p=1+(e<<1),g=r[p];const v=p+1;if(v<this.length&&n(r[v],g)<0&&(p=v,g=r[v]),n(g,u)>=0)break;r[e]=g,e=p}r[e]=u}}function p1(t,e){return t<e?-1:t>e?1:0}function m1(t,e=1,r=!1){let n=1/0,c=1/0,u=-1/0,p=-1/0;const g=t[0];for(let L=0;L<g.length;L++){const B=g[L];(!L||B.x<n)&&(n=B.x),(!L||B.y<c)&&(c=B.y),(!L||B.x>u)&&(u=B.x),(!L||B.y>p)&&(p=B.y)}const v=Math.min(u-n,p-c);let w=v/2;const A=new f1([],_1);if(v===0)return new F(n,c);for(let L=n;L<u;L+=v)for(let B=c;B<p;B+=v)A.push(new xl(L+w,B+w,w,t));let C=function(L){let B=0,G=0,q=0;const Q=L[0];for(let oe=0,ce=Q.length,de=ce-1;oe<ce;de=oe++){const pe=Q[oe],me=Q[de],ke=pe.x*me.y-me.x*pe.y;G+=(pe.x+me.x)*ke,q+=(pe.y+me.y)*ke,B+=3*ke}return new xl(G/B,q/B,0,L)}(t),M=A.length;for(;A.length;){const L=A.pop();(L.d>C.d||!C.d)&&(C=L,r&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,M)),L.max-C.d<=e||(w=L.h/2,A.push(new xl(L.p.x-w,L.p.y-w,w,t)),A.push(new xl(L.p.x+w,L.p.y-w,w,t)),A.push(new xl(L.p.x-w,L.p.y+w,w,t)),A.push(new xl(L.p.x+w,L.p.y+w,w,t)),M+=4)}return r&&(console.log(`num probes: ${M}`),console.log(`best distance: ${C.d}`)),C.p}function _1(t,e){return e.max-t.max}function xl(t,e,r,n){this.p=new F(t,e),this.h=r,this.d=function(c,u){let p=!1,g=1/0;for(let v=0;v<u.length;v++){const w=u[v];for(let A=0,C=w.length,M=C-1;A<C;M=A++){const L=w[A],B=w[M];L.y>c.y!=B.y>c.y&&c.x<(B.x-L.x)*(c.y-L.y)/(B.y-L.y)+L.x&&(p=!p),g=Math.min(g,$m(c,L,B))}}return(p?1:-1)*Math.sqrt(g)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const $f=Number.POSITIVE_INFINITY,g1=Math.sqrt(2);function O_(t,e){return e[1]!==$f?function(r,n,c){let u=0,p=0;switch(n=Math.abs(n),c=Math.abs(c),r){case"top-right":case"top-left":case"top":p=c-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-c}switch(r){case"top-right":case"bottom-right":case"right":u=-n;break;case"top-left":case"bottom-left":case"left":u=n}return[u,p]}(t,e[0],e[1]):function(r,n){let c=0,u=0;n<0&&(n=0);const p=n/g1;switch(r){case"top-right":case"top-left":u=p-7;break;case"bottom-right":case"bottom-left":u=7-p;break;case"bottom":u=7-n;break;case"top":u=n-7}switch(r){case"top-right":case"bottom-right":c=-p;break;case"top-left":case"bottom-left":c=p;break;case"left":c=n;break;case"right":c=-n}return[c,u]}(t,e[0])}function y1(t,e,r,n,c,u,p,g,v,w){t.createArrays(),t.tilePixelRatio=jt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const A=t.layers[0].layout,C=t.layers[0]._unevaluatedLayout._values,M={};if(t.textSizeData.kind==="composite"){const{minZoom:G,maxZoom:q}=t.textSizeData;M.compositeTextSizes=[C["text-size"].possiblyEvaluate(new It(G),g),C["text-size"].possiblyEvaluate(new It(q),g)]}if(t.iconSizeData.kind==="composite"){const{minZoom:G,maxZoom:q}=t.iconSizeData;M.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new It(G),g),C["icon-size"].possiblyEvaluate(new It(q),g)]}M.layoutTextSize=C["text-size"].possiblyEvaluate(new It(v+1),g),M.layoutIconSize=C["icon-size"].possiblyEvaluate(new It(v+1),g),M.textMaxSize=C["text-size"].possiblyEvaluate(new It(18),g);const L=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",B=A.get("text-size");for(const G of t.features){const q=A.get("text-font").evaluate(G,{},g).join(","),Q=B.evaluate(G,{},g),oe=M.layoutTextSize.evaluate(G,{},g),ce=(M.layoutIconSize.evaluate(G,{},g),{horizontal:{},vertical:void 0}),de=G.text;let pe,me=[0,0];if(de){const Ye=de.toString(),qe=A.get("text-letter-spacing").evaluate(G,{},g)*Rr,Ie=A.get("text-line-height").evaluate(G,{},g)*Rr,We=ve(Ye)?qe:0,Qe=A.get("text-anchor").evaluate(G,{},g),Be=A.get("text-variable-anchor");if(!Be){const ti=A.get("text-radial-offset").evaluate(G,{},g);me=ti?O_(Qe,[ti*Rr,$f]):A.get("text-offset").evaluate(G,{},g).map($e=>$e*Rr)}let nt=L?"center":A.get("text-justify").evaluate(G,{},g);const ct=A.get("symbol-placement"),Kt=ct==="point",ki=ct==="point"?A.get("text-max-width").evaluate(G,{},g)*Rr:0,ei=ti=>{t.allowVerticalPlacement&&Ae(Ye)&&(ce.vertical=Vf(de,e,r,c,q,ki,Ie,Qe,ti,We,me,jn.vertical,!0,ct,oe,Q))};if(!L&&Be){const ti=nt==="auto"?Be.map(li=>Zf(li)):[nt];let $e=!1;for(let li=0;li<ti.length;li++){const ri=ti[li];if(!ce.horizontal[ri])if($e)ce.horizontal[ri]=ce.horizontal[0];else{const sr=Vf(de,e,r,c,q,ki,Ie,"center",ri,We,me,jn.horizontal,!1,ct,oe,Q);sr&&(ce.horizontal[ri]=sr,$e=sr.positionedLines.length===1)}}ei("left")}else{if(nt==="auto"&&(nt=Zf(Qe)),Kt||A.get("text-writing-mode").indexOf("horizontal")>=0||!Ae(Ye)){const ti=Vf(de,e,r,c,q,ki,Ie,Qe,nt,We,me,jn.horizontal,!1,ct,oe,Q);ti&&(ce.horizontal[nt]=ti)}ei(ct==="point"?"left":nt)}}let ke=!1;if(G.icon&&G.icon.name){const Ye=n[G.icon.name];Ye&&(pe=c1(c[G.icon.name],A.get("icon-offset").evaluate(G,{},g),A.get("icon-anchor").evaluate(G,{},g)),ke=Ye.sdf,t.sdfIcons===void 0?t.sdfIcons=Ye.sdf:t.sdfIcons!==Ye.sdf&&et("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ye.pixelRatio!==t.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Ce=U_(ce.horizontal)||ce.vertical;t.iconsInText||(t.iconsInText=!!Ce&&Ce.iconsInText),(Ce||pe)&&v1(t,G,ce,pe,n,M,oe,0,me,ke,p,g,w)}u&&t.generateCollisionDebugBuffers(v,t.collisionBoxArray)}function Zf(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function v1(t,e,r,n,c,u,p,g,v,w,A,C,M){let L=u.textMaxSize.evaluate(e,{},C);L===void 0&&(L=p);const B=t.layers[0].layout,G=B.get("icon-offset").evaluate(e,{},C),q=U_(r.horizontal)||r.vertical,Q=p/24,oe=t.tilePixelRatio*L/24,ce=t.tilePixelRatio*B.get("symbol-spacing"),de=B.get("text-padding")*t.tilePixelRatio,pe=B.get("icon-padding")*t.tilePixelRatio,me=Et(B.get("text-max-angle")),ke=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Ce=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Ye=B.get("symbol-placement"),qe=ce/2,Ie=B.get("icon-text-fit");let We;n&&Ie!=="none"&&(t.allowVerticalPlacement&&r.vertical&&(We=A_(n,r.vertical,Ie,B.get("icon-text-fit-padding"),G,Q)),q&&(n=A_(n,q,Ie,B.get("icon-text-fit-padding"),G,Q)));const Qe=(Be,nt,ct)=>{if(nt.x<0||nt.x>=jt||nt.y<0||nt.y>=jt)return;const{x:Kt,y:ki,z:ei}=M.projectTilePoint(nt.x,nt.y,ct),ti=new Ho(Kt,ki,ei,0,void 0);(function($e,li,ri,sr,Ki,Sr,Vr,ci,Wt,Gi,lr,Qi,hr,Br,cn,un,Oi,Er,Jn,zr,Ei,Ar,$i,Nr,gr){const jr=$e.addToLineVertexArray(li,sr);let Xr,Kr,Cr,co,Sl,Gc,$c,xg=0,bg=0,wg=0,Tg=0,up=-1,hp=-1;const Lo={};let Sg=Ac(""),dp=0,fp=0;if(Wt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[dp,fp]=Wt.layout.get("text-offset").evaluate(Ei,{},gr).map(Sn=>Sn*Rr):(dp=Wt.layout.get("text-radial-offset").evaluate(Ei,{},gr)*Rr,fp=$f),$e.allowVerticalPlacement&&Ki.vertical){const Sn=Ki.vertical;if(cn)Gc=qf(Sn),ci&&($c=qf(ci));else{const En=Wt.layout.get("text-rotate").evaluate(Ei,{},gr)+90;Cr=Oh(Gi,ri,li,lr,Qi,hr,Sn,Br,En,un),ci&&(co=Oh(Gi,ri,li,lr,Qi,hr,ci,Er,En))}}if(Sr){const Sn=Wt.layout.get("icon-rotate").evaluate(Ei,{},gr),En=Wt.layout.get("icon-text-fit")!=="none",Zc=R_(Sr,Sn,$i,En),mp=ci?R_(ci,Sn,$i,En):void 0;Kr=Oh(Gi,ri,li,lr,Qi,hr,Sr,Er,Sn),xg=4*Zc.length;const Eg=$e.iconSizeData;let ds=null;Eg.kind==="source"?(ds=[ko*Wt.layout.get("icon-size").evaluate(Ei,{},gr)],ds[0]>va&&et(`${$e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Eg.kind==="composite"&&(ds=[ko*Ar.compositeIconSizes[0].evaluate(Ei,{},gr),ko*Ar.compositeIconSizes[1].evaluate(Ei,{},gr)],(ds[0]>va||ds[1]>va)&&et(`${$e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),$e.addSymbols($e.icon,Zc,ds,zr,Jn,Ei,!1,ri,li,jr.lineStartIndex,jr.lineLength,-1,Nr,gr),up=$e.icon.placedSymbolArray.length-1,mp&&(bg=4*mp.length,$e.addSymbols($e.icon,mp,ds,zr,Jn,Ei,jn.vertical,ri,li,jr.lineStartIndex,jr.lineLength,-1,Nr,gr),hp=$e.icon.placedSymbolArray.length-1)}for(const Sn in Ki.horizontal){const En=Ki.horizontal[Sn];Xr||(Sg=Ac(En.text),cn?Sl=qf(En):Xr=Oh(Gi,ri,li,lr,Qi,hr,En,Br,Wt.layout.get("text-rotate").evaluate(Ei,{},gr),un));const Zc=En.positionedLines.length===1;if(wg+=F_($e,ri,li,En,Vr,Wt,cn,Ei,un,jr,Ki.vertical?jn.horizontal:jn.horizontalOnly,Zc?Object.keys(Ki.horizontal):[Sn],Lo,up,Ar,Nr,gr),Zc)break}Ki.vertical&&(Tg+=F_($e,ri,li,Ki.vertical,Vr,Wt,cn,Ei,un,jr,jn.vertical,["vertical"],Lo,hp,Ar,Nr,gr));let Sa=-1;const pp=(Sn,En)=>Sn?Math.max(Sn,En):En;Sa=pp(Sl,Sa),Sa=pp(Gc,Sa),Sa=pp($c,Sa);const H1=Sa>-1?1:0;$e.glyphOffsetArray.length>=xa.MAX_GLYPHS&&et("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ei.sortKey!==void 0&&$e.addToSortKeyRanges($e.symbolInstances.length,Ei.sortKey),$e.symbolInstances.emplaceBack(ri.x,ri.y,ri.z,li.x,li.y,Lo.right>=0?Lo.right:-1,Lo.center>=0?Lo.center:-1,Lo.left>=0?Lo.left:-1,Lo.vertical>=0?Lo.vertical:-1,up,hp,Sg,Xr!==void 0?Xr:$e.collisionBoxArray.length,Xr!==void 0?Xr+1:$e.collisionBoxArray.length,Cr!==void 0?Cr:$e.collisionBoxArray.length,Cr!==void 0?Cr+1:$e.collisionBoxArray.length,Kr!==void 0?Kr:$e.collisionBoxArray.length,Kr!==void 0?Kr+1:$e.collisionBoxArray.length,co||$e.collisionBoxArray.length,co?co+1:$e.collisionBoxArray.length,lr,wg,Tg,xg,bg,H1,0,dp,fp,Sa)})(t,nt,ti,Be,r,n,c,We,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,de,ke,v,0,pe,Ce,G,e,u,w,A,C)};if(Ye==="line")for(const Be of P_(e.geometry,0,0,jt,jt)){const nt=h1(Be,ce,me,r.vertical||q,n,24,oe,t.overscaling,jt);for(const ct of nt){const Kt=q;Kt&&x1(t,Kt.text,qe,ct)||Qe(Be,ct,C)}}else if(Ye==="line-center"){for(const Be of e.geometry)if(Be.length>1){const nt=u1(Be,me,r.vertical||q,n,24,oe);nt&&Qe(Be,nt,C)}}else if(e.type==="Polygon")for(const Be of Pf(e.geometry,0)){const nt=m1(Be,16);Qe(Be[0],new Ho(nt.x,nt.y,0,0,void 0),C)}else if(e.type==="LineString")for(const Be of e.geometry)Qe(Be,new Ho(Be[0].x,Be[0].y,0,0,void 0),C);else if(e.type==="Point")for(const Be of e.geometry)for(const nt of Be)Qe([nt],new Ho(nt.x,nt.y,0,0,void 0),C)}const va=32640;function F_(t,e,r,n,c,u,p,g,v,w,A,C,M,L,B,G,q){const Q=function(de,pe,me,ke,Ce,Ye,qe,Ie){const We=[];if(pe.positionedLines.length===0)return We;const Qe=ke.layout.get("text-rotate").evaluate(Ye,{})*Math.PI/180,Be=function(ei){const ti=ei[0],$e=ei[1],li=ti*$e;return li>0?[ti,-$e]:li<0?[-ti,$e]:ti===0?[$e,ti]:[$e,-ti]}(me);let nt=Math.abs(pe.top-pe.bottom);for(const ei of pe.positionedLines)nt-=ei.lineOffset;const ct=pe.positionedLines.length,Kt=nt/ct;let ki=pe.top-me[1];for(let ei=0;ei<ct;++ei){const ti=pe.positionedLines[ei];ki=d1(pe,Kt,ki,ei);for(const $e of ti.positionedGlyphs){if(!$e.rect)continue;const li=$e.rect||{};let ri=4,sr=!0,Ki=1,Sr=0;if($e.imageName){const $i=qe[$e.imageName];if(!$i)continue;if($i.sdf){et("SDF images are not supported in formatted text and will be ignored.");continue}sr=!1,Ki=$i.pixelRatio,ri=1/Ki}const Vr=(Ce||Ie)&&$e.vertical,ci=$e.metrics.advance*$e.scale/2,Wt=$e.metrics,Gi=$e.rect;if(Gi===null)continue;Ie&&pe.verticalizable&&(Sr=$e.imageName?ci-$e.metrics.width*$e.scale/2:0);const lr=Ce?[$e.x+ci,$e.y]:[0,0];let Qi=[0,0],hr=[0,0],Br=!1;Ce||(Vr?(hr=[$e.x+ci+Be[0],$e.y+Be[1]-Sr],Br=!0):Qi=[$e.x+ci+me[0],$e.y+me[1]-Sr]);const cn=Gi.w*$e.scale/(Ki*($e.localGlyph?2:1)),un=Gi.h*$e.scale/(Ki*($e.localGlyph?2:1));let Oi,Er,Jn,zr;if(Vr){const $i=$e.y-ki,Nr=new F(-ci,ci-$i),gr=-Math.PI/2,jr=new F(...hr);Oi=new F(-ci+Qi[0],Qi[1]),Oi._rotateAround(gr,Nr)._add(jr),Oi.x+=-$i+ci,Oi.y-=(Wt.left-ri)*$e.scale;const Xr=$e.imageName?Wt.advance*$e.scale:Rr*$e.scale,Kr=String.fromCharCode($e.glyph);Wx(Kr)?Oi.x+=(1-ri)*$e.scale:Hx(Kr)?Oi.x+=Xr-Wt.height*$e.scale+(-ri-1)*$e.scale:Oi.x+=$e.imageName||Wt.width+2*ri===Gi.w&&Wt.height+2*ri===Gi.h?(Xr-un)/2:(Xr-(Wt.height+2*ri)*$e.scale)/2,Er=new F(Oi.x,Oi.y-cn),Jn=new F(Oi.x+un,Oi.y),zr=new F(Oi.x+un,Oi.y-cn)}else{const $i=(Wt.left-ri)*$e.scale-ci+Qi[0],Nr=(-Wt.top-ri)*$e.scale+Qi[1],gr=$i+cn,jr=Nr+un;Oi=new F($i,Nr),Er=new F(gr,Nr),Jn=new F($i,jr),zr=new F(gr,jr)}if(Qe){let $i;$i=Ce?new F(0,0):Br?new F(Be[0],Be[1]):new F(me[0],me[1]),Oi._rotateAround(Qe,$i),Er._rotateAround(Qe,$i),Jn._rotateAround(Qe,$i),zr._rotateAround(Qe,$i)}const Ei=new F(0,0),Ar=new F(0,0);We.push({tl:Oi,tr:Er,bl:Jn,br:zr,tex:li,writingMode:pe.writingMode,glyphOffset:lr,sectionIndex:$e.sectionIndex,isSDF:sr,pixelOffsetTL:Ei,pixelOffsetBR:Ar,minFontScaleX:0,minFontScaleY:0})}}return We}(0,n,v,u,p,g,c,t.allowVerticalPlacement),oe=t.textSizeData;let ce=null;oe.kind==="source"?(ce=[ko*u.layout.get("text-size").evaluate(g,{},q)],ce[0]>va&&et(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):oe.kind==="composite"&&(ce=[ko*B.compositeTextSizes[0].evaluate(g,{},q),ko*B.compositeTextSizes[1].evaluate(g,{},q)],(ce[0]>va||ce[1]>va)&&et(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,Q,ce,v,p,g,A,e,r,w.lineStartIndex,w.lineLength,L,G,q);for(const de of C)M[de]=t.text.placedSymbolArray.length-1;return 4*Q.length}function U_(t){for(const e in t)return t[e];return null}function Oh(t,e,r,n,c,u,p,g,v,w){let A=p.top,C=p.bottom,M=p.left,L=p.right;const B=p.collisionPadding;if(B&&(M-=B[0],A-=B[1],L+=B[2],C+=B[3]),v){const G=new F(M,A),q=new F(L,A),Q=new F(M,C),oe=new F(L,C),ce=Et(v);let de=new F(0,0);w&&(de=new F(w[0],w[1])),G._rotateAround(ce,de),q._rotateAround(ce,de),Q._rotateAround(ce,de),oe._rotateAround(ce,de),M=Math.min(G.x,q.x,Q.x,oe.x),L=Math.max(G.x,q.x,Q.x,oe.x),A=Math.min(G.y,q.y,Q.y,oe.y),C=Math.max(G.y,q.y,Q.y,oe.y)}return t.emplaceBack(e.x,e.y,e.z,r.x,r.y,M,A,L,C,g,n,c,u),t.length-1}function qf(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function x1(t,e,r,n){const c=t.compareText;if(e in c){const u=c[e];for(let p=u.length-1;p>=0;p--)if(n.dist(u[p])<r)return!0}else c[e]=[];return c[e].push(n),!1}const b1=ls.VectorTileFeature.types,w1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Fh(t,e,r,n,c,u,p,g,v,w,A,C,M,L,B,G){const q=A?Math.min(va,Math.round(A[0])):0,Q=A?Math.min(va,Math.round(A[1])):0;t.emplaceBack(e,r,Math.round(32*p),Math.round(32*g),v,w,(q<<1)+(C?1:0),Q,16*M,16*L,256*B,256*G,n,c,u,0)}function Wf(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r)}function T1(t){for(const e of t.sections)if(Xe(e.text))return!0;return!1}class Hf{constructor(e){this.layoutVertexArray=new sf,this.indexArray=new Vn,this.programConfigurations=e,this.segments=new or,this.dynamicLayoutVertexArray=new sl,this.opacityVertexArray=new lf,this.placedSymbolArray=new Tm}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,n,c){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vx.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Nx.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,w1,!0),this.opacityVertexBuffer.itemSize=1),(n||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}at("SymbolBuffers",Hf);class Xf{constructor(e,r,n){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new n,this.segments=new or,this.collisionVertexArray=new hf,this.collisionVertexArrayExt=new sl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,jx.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Gx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}at("CollisionBuffers",Xf);class xa{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ge([]),this.placementViewportMatrix=Ge([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bf(this.zoom,r["text-size"]),this.iconSizeData=Bf(this.zoom,r["icon-size"]);const n=this.layers[0].layout,c=n.get("symbol-sort-key"),u=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(p=>jn[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID}createArrays(){this.text=new Hf(new os(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Hf(new os(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Am,this.lineVertexArray=new Cm,this.symbolInstances=new Em}calculateGlyphDependencies(e,r,n,c,u){for(let p=0;p<e.length;p++)if(r[e.charCodeAt(p)]=!0,c&&u){const g=Lc[e.charAt(p)];g&&(r[g.charCodeAt(0)]=!0)}}populate(e,r,n,c){const u=this.layers[0],p=u.layout,g=p.get("text-font"),v=p.get("text-field"),w=p.get("icon-image"),A=(v.value.kind!=="constant"||v.value.value instanceof Pt&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),C=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,M=p.get("symbol-sort-key");if(this.features=[],!A&&!C)return;const L=r.iconDependencies,B=r.glyphDependencies,G=r.availableImages,q=new It(this.zoom);for(const{feature:Q,id:oe,index:ce,sourceLayerIndex:de}of e){const pe=u._featureFilter.needGeometry,me=ss(Q,pe);if(!u._featureFilter.filter(q,me,n))continue;let ke,Ce;if(pe||(me.geometry=qo(Q,n,c)),A){const qe=u.getValueAndResolveTokens("text-field",me,n,G),Ie=Pt.factory(qe);T1(Ie)&&(this.hasRTLText=!0),(!this.hasRTLText||bn()==="unavailable"||this.hasRTLText&&Qt.isParsed())&&(ke=qx(Ie,u,me))}if(C){const qe=u.getValueAndResolveTokens("icon-image",me,n,G);Ce=qe instanceof yn?qe:yn.fromString(qe)}if(!ke&&!Ce)continue;const Ye=this.sortFeaturesByKey?M.evaluate(me,{},n):void 0;if(this.features.push({id:oe,text:ke,icon:Ce,index:ce,sourceLayerIndex:de,geometry:me.geometry,properties:Q.properties,type:b1[Q.type],sortKey:Ye}),Ce&&(L[Ce.name]=!0),ke){const qe=g.evaluate(me,{},n).join(","),Ie=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(jn.vertical)>=0;for(const We of ke.sections)if(We.image)L[We.image.name]=!0;else{const Qe=Ae(ke.toString()),Be=We.fontStack||qe,nt=B[Be]=B[Be]||{};this.calculateGlyphDependencies(We.text,nt,Ie,this.allowVerticalPlacement,Qe)}}}p.get("symbol-placement")==="line"&&(this.features=function(Q){const oe={},ce={},de=[];let pe=0;function me(qe){de.push(Q[qe]),pe++}function ke(qe,Ie,We){const Qe=ce[qe];return delete ce[qe],ce[Ie]=Qe,de[Qe].geometry[0].pop(),de[Qe].geometry[0]=de[Qe].geometry[0].concat(We[0]),Qe}function Ce(qe,Ie,We){const Qe=oe[Ie];return delete oe[Ie],oe[qe]=Qe,de[Qe].geometry[0].shift(),de[Qe].geometry[0]=We[0].concat(de[Qe].geometry[0]),Qe}function Ye(qe,Ie,We){const Qe=We?Ie[0][Ie[0].length-1]:Ie[0][0];return`${qe}:${Qe.x}:${Qe.y}`}for(let qe=0;qe<Q.length;qe++){const Ie=Q[qe],We=Ie.geometry,Qe=Ie.text?Ie.text.toString():null;if(!Qe){me(qe);continue}const Be=Ye(Qe,We),nt=Ye(Qe,We,!0);if(Be in ce&&nt in oe&&ce[Be]!==oe[nt]){const ct=Ce(Be,nt,We),Kt=ke(Be,nt,de[ct].geometry);delete oe[Be],delete ce[nt],ce[Ye(Qe,de[Kt].geometry,!0)]=Kt,de[ct].geometry=null}else Be in ce?ke(Be,nt,We):nt in oe?Ce(Be,nt,We):(me(qe),oe[Be]=pe-1,ce[nt]=pe-1)}return de.filter(qe=>qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Q,oe)=>Q.sortKey-oe.sortKey)}update(e,r,n,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,n,c),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,n,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const n=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(r[e.segment+1]),u=e.dist(r[e.segment]);const p={};for(let g=e.segment+1;g<r.length;g++)p[g]={x:r[g].x,y:r[g].y,tileUnitDistanceFromAnchor:c},g<r.length-1&&(c+=r[g+1].dist(r[g]));for(let g=e.segment||0;g>=0;g--)p[g]={x:r[g].x,y:r[g].y,tileUnitDistanceFromAnchor:u},g>0&&(u+=r[g-1].dist(r[g]));for(let g=0;g<r.length;g++){const v=p[g];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,r,n,c,u,p,g,v,w,A,C,M,L,B){const G=e.indexArray,q=e.layoutVertexArray,Q=e.segments.prepareSegment(4*r.length,q,G,this.canOverlap?p.sortKey:void 0),oe=this.glyphOffsetArray.length,ce=Q.vertexLength,de=this.allowVerticalPlacement&&g===jn.vertical?Math.PI/2:0,pe=p.text&&p.text.sections;for(let me=0;me<r.length;me++){const{tl:ke,tr:Ce,bl:Ye,br:qe,tex:Ie,pixelOffsetTL:We,pixelOffsetBR:Qe,minFontScaleX:Be,minFontScaleY:nt,glyphOffset:ct,isSDF:Kt,sectionIndex:ki}=r[me],ei=Q.vertexLength,ti=ct[1];Fh(q,v.x,v.y,v.z,w.x,w.y,ke.x,ti+ke.y,Ie.x,Ie.y,n,Kt,We.x,We.y,Be,nt),Fh(q,v.x,v.y,v.z,w.x,w.y,Ce.x,ti+Ce.y,Ie.x+Ie.w,Ie.y,n,Kt,Qe.x,We.y,Be,nt),Fh(q,v.x,v.y,v.z,w.x,w.y,Ye.x,ti+Ye.y,Ie.x,Ie.y+Ie.h,n,Kt,We.x,Qe.y,Be,nt),Fh(q,v.x,v.y,v.z,w.x,w.y,qe.x,ti+qe.y,Ie.x+Ie.w,Ie.y+Ie.h,n,Kt,Qe.x,Qe.y,Be,nt),Wf(e.dynamicLayoutVertexArray,v,de),G.emplaceBack(ei,ei+1,ei+2),G.emplaceBack(ei+1,ei+2,ei+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ct[0]),me!==r.length-1&&ki===r[me+1].sectionIndex||e.programConfigurations.populatePaintArrays(q.length,p,p.index,{},L,B,pe&&pe[ki])}e.placedSymbolArray.emplaceBack(v.x,v.y,v.z,w.x,w.y,oe,this.glyphOffsetArray.length-oe,ce,A,C,w.segment,n?n[0]:0,n?n[1]:0,c[0],c[1],g,0,!1,0,M,0)}_commitLayoutVertex(e,r,n,c,u,p,g){e.emplaceBack(r,n,c,u,p,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,r,n,c,u,p,g){const v=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),w=v.vertexLength,A=g.tileAnchorX,C=g.tileAnchorY;for(let L=0;L<4;L++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,c,u,p,A,C,new F(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,c,u,p,A,C,new F(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,c,u,p,A,C,new F(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,c,u,p,A,C,new F(e.x1,e.y2)),v.vertexLength+=4;const M=n.indexArray;M.emplaceBack(w,w+1),M.emplaceBack(w+1,w+2),M.emplaceBack(w+2,w+3),M.emplaceBack(w+3,w),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,n,c,u,p){for(let g=c;g<u;g++){const v=n.get(g),w=this.getSymbolInstanceTextSize(e,p,r,g);this._addCollisionDebugVertices(v,w,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,r,n,c,u,p){for(let g=c;g<u;g++){const v=n.get(g),w=this.getSymbolInstanceIconSize(e,r,g);this._addCollisionDebugVertices(v,w,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Xf(fh,f_.members,ma),this.iconCollisionBox=new Xf(fh,f_.members,ma);const n=ml(this.iconSizeData,e),c=ml(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(c,e,r,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(c,e,r,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(n,e,r,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(n,e,r,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,r,n,c){const u=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:c),p=zh(this.textSizeData,e,u)/Rr;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,r,n){const c=this.icon.placedSymbolArray.get(n),u=zh(this.iconSizeData,e,c);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,r,n){e.emplaceBack(r,-n,-n),e.emplaceBack(r,n,-n),e.emplaceBack(r,n,n),e.emplaceBack(r,-n,n)}_updateTextDebugCollisionBoxes(e,r,n,c,u,p){for(let g=c;g<u;g++){const v=n.get(g),w=this.getSymbolInstanceTextSize(e,p,r,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,v.padding)}}_updateIconDebugCollisionBoxes(e,r,n,c,u){for(let p=c;p<u;p++){const g=n.get(p),v=this.getSymbolInstanceIconSize(e,r,p);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,v,g.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=ml(this.iconSizeData,e),c=ml(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(c,e,r,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(c,e,r,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(n,e,r,p.iconBoxStartIndex,p.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,e,r,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,n,c,u,p,g,v,w){const A={};for(let C=r;C<n;C++){const M=e.get(C);A.textBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},A.textFeatureIndex=M.featureIndex;break}for(let C=c;C<u;C++){const M=e.get(C);A.verticalTextBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},A.verticalTextFeatureIndex=M.featureIndex;break}for(let C=p;C<g;C++){const M=e.get(C);A.iconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},A.iconFeatureIndex=M.featureIndex;break}for(let C=v;C<w;C++){const M=e.get(C);A.verticalIconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,padding:M.padding,projectedAnchorX:M.projectedAnchorX,projectedAnchorY:M.projectedAnchorY,projectedAnchorZ:M.projectedAnchorZ,tileAnchorX:M.tileAnchorX,tileAnchorY:M.tileAnchorY},A.verticalIconFeatureIndex=M.featureIndex;break}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const n=e.placedSymbolArray.get(r),c=n.vertexStartIndex+4*n.numGlyphs;for(let u=n.vertexStartIndex;u<c;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),n=Math.cos(e),c=[],u=[],p=[];for(let g=0;g<this.symbolInstances.length;++g){p.push(g);const v=this.symbolInstances.get(g);c.push(0|Math.round(r*v.tileAnchorX+n*v.tileAnchorY)),u.push(v.featureIndex)}return p.sort((g,v)=>c[g]-c[v]||u[v]-u[g]),p}addToSortKeyRanges(e,r){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===r?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const n=this.symbolInstances.get(r);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((c,u,p)=>{c>=0&&p.indexOf(c)===u&&this.addIndicesForPlacedSymbol(this.text,c)}),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}at("SymbolBucket",xa,{omit:["layers","collisionBoxArray","features","compareText"]}),xa.MAX_GLYPHS=65535,xa.addDynamicAttributes=Wf;const S1=new kr({"symbol-placement":new lt(Ee.layout_symbol["symbol-placement"]),"symbol-spacing":new lt(Ee.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new lt(Ee.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new gt(Ee.layout_symbol["symbol-sort-key"]),"symbol-z-order":new lt(Ee.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new lt(Ee.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new lt(Ee.layout_symbol["icon-ignore-placement"]),"icon-optional":new lt(Ee.layout_symbol["icon-optional"]),"icon-rotation-alignment":new lt(Ee.layout_symbol["icon-rotation-alignment"]),"icon-size":new gt(Ee.layout_symbol["icon-size"]),"icon-text-fit":new lt(Ee.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new lt(Ee.layout_symbol["icon-text-fit-padding"]),"icon-image":new gt(Ee.layout_symbol["icon-image"]),"icon-rotate":new gt(Ee.layout_symbol["icon-rotate"]),"icon-padding":new lt(Ee.layout_symbol["icon-padding"]),"icon-keep-upright":new lt(Ee.layout_symbol["icon-keep-upright"]),"icon-offset":new gt(Ee.layout_symbol["icon-offset"]),"icon-anchor":new gt(Ee.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new lt(Ee.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new lt(Ee.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new lt(Ee.layout_symbol["text-rotation-alignment"]),"text-field":new gt(Ee.layout_symbol["text-field"]),"text-font":new gt(Ee.layout_symbol["text-font"]),"text-size":new gt(Ee.layout_symbol["text-size"]),"text-max-width":new gt(Ee.layout_symbol["text-max-width"]),"text-line-height":new gt(Ee.layout_symbol["text-line-height"]),"text-letter-spacing":new gt(Ee.layout_symbol["text-letter-spacing"]),"text-justify":new gt(Ee.layout_symbol["text-justify"]),"text-radial-offset":new gt(Ee.layout_symbol["text-radial-offset"]),"text-variable-anchor":new lt(Ee.layout_symbol["text-variable-anchor"]),"text-anchor":new gt(Ee.layout_symbol["text-anchor"]),"text-max-angle":new lt(Ee.layout_symbol["text-max-angle"]),"text-writing-mode":new lt(Ee.layout_symbol["text-writing-mode"]),"text-rotate":new gt(Ee.layout_symbol["text-rotate"]),"text-padding":new lt(Ee.layout_symbol["text-padding"]),"text-keep-upright":new lt(Ee.layout_symbol["text-keep-upright"]),"text-transform":new gt(Ee.layout_symbol["text-transform"]),"text-offset":new gt(Ee.layout_symbol["text-offset"]),"text-allow-overlap":new lt(Ee.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new lt(Ee.layout_symbol["text-ignore-placement"]),"text-optional":new lt(Ee.layout_symbol["text-optional"])});var Kf={paint:new kr({"icon-opacity":new gt(Ee.paint_symbol["icon-opacity"]),"icon-color":new gt(Ee.paint_symbol["icon-color"]),"icon-halo-color":new gt(Ee.paint_symbol["icon-halo-color"]),"icon-halo-width":new gt(Ee.paint_symbol["icon-halo-width"]),"icon-halo-blur":new gt(Ee.paint_symbol["icon-halo-blur"]),"icon-translate":new lt(Ee.paint_symbol["icon-translate"]),"icon-translate-anchor":new lt(Ee.paint_symbol["icon-translate-anchor"]),"text-opacity":new gt(Ee.paint_symbol["text-opacity"]),"text-color":new gt(Ee.paint_symbol["text-color"],{runtimeType:Wn,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new gt(Ee.paint_symbol["text-halo-color"]),"text-halo-width":new gt(Ee.paint_symbol["text-halo-width"]),"text-halo-blur":new gt(Ee.paint_symbol["text-halo-blur"]),"text-translate":new lt(Ee.paint_symbol["text-translate"]),"text-translate-anchor":new lt(Ee.paint_symbol["text-translate-anchor"])}),layout:S1};class V_{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:xo,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}at("FormatSectionOverride",V_,{omit:["defaultValue"]});class Uh extends oo{constructor(e){super(e,Kf)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const c=[];for(const u of n)c.indexOf(u)<0&&c.push(u);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,n,c){const u=this.layout.get(e).evaluate(r,{},n,c),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||aa(p.value)||!u?u:function(g,v){return v.replace(/{([^{}]+)}/g,(w,A)=>A in g?String(g[A]):"")}(r.properties,u)}createBucket(e){return new xa(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Kf.paint.overridableProperties){if(!Uh.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),n=new V_(r),c=new uc(n,r.property.specification);let u=null;u=r.value.kind==="constant"||r.value.kind==="source"?new Ya("source",c):new hc("composite",c,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new Hr(r.property,u,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,n){return!(!this.layout||r.isDataDriven()||n.isDataDriven())&&Uh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const n=e.get("text-field"),c=Kf.paint.properties[r];let u=!1;const p=g=>{for(const v of g)if(c.overrides&&c.overrides.hasOverride(v))return void(u=!0)};if(n.value.kind==="constant"&&n.value.value instanceof Pt)p(n.value.value.sections);else if(n.value.kind==="source"){const g=w=>{u||(w instanceof wo&&rr(w.value)===bo?p(w.value.sections):w instanceof Hn?p(w.sections):w.eachChild(g))},v=n.value;v._styleExpression&&g(v._styleExpression.expression)}return u}getProgramConfiguration(e){return new $o(this,e)}}var E1={paint:new kr({"background-color":new lt(Ee.paint_background["background-color"]),"background-pattern":new No(Ee.paint_background["background-pattern"]),"background-opacity":new lt(Ee.paint_background["background-opacity"])})},A1={paint:new kr({"raster-opacity":new lt(Ee.paint_raster["raster-opacity"]),"raster-hue-rotate":new lt(Ee.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new lt(Ee.paint_raster["raster-brightness-min"]),"raster-brightness-max":new lt(Ee.paint_raster["raster-brightness-max"]),"raster-saturation":new lt(Ee.paint_raster["raster-saturation"]),"raster-contrast":new lt(Ee.paint_raster["raster-contrast"]),"raster-resampling":new lt(Ee.paint_raster["raster-resampling"]),"raster-fade-duration":new lt(Ee.paint_raster["raster-fade-duration"])})};class C1 extends oo{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var M1={paint:new kr({"sky-type":new lt(Ee.paint_sky["sky-type"]),"sky-atmosphere-sun":new lt(Ee.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new lt(Ee.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new lt(Ee.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new lt(Ee.paint_sky["sky-gradient-radius"]),"sky-gradient":new Mo(Ee.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new lt(Ee.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new lt(Ee.paint_sky["sky-atmosphere-color"]),"sky-opacity":new lt(Ee.paint_sky["sky-opacity"])})};function Yf(t,e,r){const n=st(0,0,1),c=$n(Pn());return function(u,p,g){g*=.5;var v=p[0],w=p[1],A=p[2],C=p[3],M=Math.sin(g),L=Math.cos(g);u[0]=v*L-A*M,u[1]=w*L+C*M,u[2]=A*L+v*M,u[3]=C*L-w*M}(c,c,r?-Et(t)+Math.PI:Et(t)),Dn(c,c,-Et(e)),hi(n,n,c),kt(n,n)}const I1={circle:class extends oo{constructor(t){super(t,J0)}createBucket(t){return new wf(t)}queryRadius(t){const e=t;return dl("circle-radius",this,e)+dl("circle-stroke-width",this,e)+Th(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,r,n,c,u,p,g){const v=Hm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Xm(t,n,u,p,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",v,w)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new $o(this,t)}},heatmap:class extends oo{createBucket(t){return new Ym(t)}constructor(t){super(t,ix),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Mf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return dl("heatmap-radius",this,t)}queryIntersectsFeature(t,e,r,n,c,u,p,g){const v=this.paint.get("heatmap-radius").evaluate(e,r);return Xm(t,n,u,p,g,!0,!0,new F(0,0),v)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new $o(this,t)}},hillshade:class extends oo{constructor(t){super(t,rx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(t){return new $o(this,t)}},fill:class extends oo{constructor(t){super(t,xx)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(t){return new $o(this,t)}recalculate(t,e){super.recalculate(t,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Ih(t)}queryRadius(){return Th(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,r,n,c,u){return!t.queryGeometry.isAboveHorizon&&Gm(Wm(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends oo{constructor(t){super(t,zx)}createBucket(t){return new Rf(t)}queryRadius(){return Th(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new $o(this,t)}queryIntersectsFeature(t,e,r,n,c,u,p,g,v){const w=Hm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(e,r),C=this.paint.get("fill-extrusion-base").evaluate(e,r),M=[0,0],L=g&&u.elevation,B=u.elevation?u.elevation.exaggeration():1;if(L){const Q=t.tile.getBucket(this).centroidVertexArray,oe=v+1;if(oe<Q.length){const ce=Q.get(oe);M[0]=ce.a_centroid_pos0,M[1]=ce.a_centroid_pos1}}if(M[0]===0&&M[1]===1)return!1;const G=function(Q,oe,ce,de,pe,me,ke,Ce,Ye){return me?function(qe,Ie,We,Qe,Be,nt,ct,Kt,ki){const ei=[],ti=[],$e=[0,0,0,1];for(const li of qe){const ri=[],sr=[];for(const Ki of li){const Sr=Ki.x+Qe.x,Vr=Ki.y+Qe.y,ci=Px(Sr,Vr,Ie,We,nt,ct,Kt,ki);$e[0]=Sr,$e[1]=Vr,$e[2]=ci.base,$e[3]=1,mr($e,$e,Be),$e[3]=Math.max($e[3],1e-5);const Wt=c_([$e[0]/$e[3],$e[1]/$e[3],$e[2]/$e[3]]);$e[0]=Sr,$e[1]=Vr,$e[2]=ci.top,$e[3]=1,mr($e,$e,Be),$e[3]=Math.max($e[3],1e-5);const Gi=c_([$e[0]/$e[3],$e[1]/$e[3],$e[2]/$e[3]]);ri.push(Wt),sr.push(Gi)}ei.push(ri),ti.push(sr)}return[ei,ti]}(Q,oe,ce,de,pe,me,ke,Ce,Ye):function(qe,Ie,We,Qe,Be){const nt=[],ct=[],Kt=Be[8]*Ie,ki=Be[9]*Ie,ei=Be[10]*Ie,ti=Be[11]*Ie,$e=Be[8]*We,li=Be[9]*We,ri=Be[10]*We,sr=Be[11]*We;for(const Ki of qe){const Sr=[],Vr=[];for(const ci of Ki){const Wt=ci.x+Qe.x,Gi=ci.y+Qe.y,lr=Be[0]*Wt+Be[4]*Gi+Be[12],Qi=Be[1]*Wt+Be[5]*Gi+Be[13],hr=Be[2]*Wt+Be[6]*Gi+Be[14],Br=Be[3]*Wt+Be[7]*Gi+Be[15],cn=lr+Kt,un=Qi+ki,Oi=hr+ei,Er=Math.max(Br+ti,1e-5),Jn=lr+$e,zr=Qi+li,Ei=hr+ri,Ar=Math.max(Br+sr,1e-5),$i=new F(cn/Er,un/Er);$i.z=Oi/Er,Sr.push($i);const Nr=new F(Jn/Ar,zr/Ar);Nr.z=Ei/Ar,Vr.push(Nr)}nt.push(Sr),ct.push(Vr)}return[nt,ct]}(Q,oe,ce,de,pe)}(n,C,A,w,p,L?g:null,M,B,u.center.lat),q=t.queryGeometry;return function(Q,oe,ce){let de=1/0;Gm(ce,oe)&&(de=l_(ce,oe[0]));for(let pe=0;pe<oe.length;pe++){const me=oe[pe],ke=Q[pe];for(let Ce=0;Ce<me.length-1;Ce++){const Ye=me[Ce],qe=[Ye,me[Ce+1],ke[Ce+1],ke[Ce],Ye];jm(ce,qe)&&(de=Math.min(de,l_(ce,qe)))}}return de!==1/0&&de}(G[0],G[1],q.isPointQuery()?q.screenBounds:q.screenGeometry)}},line:class extends oo{constructor(t){super(t,u_),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ja,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=h_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new kh(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new $o(this,t)}queryRadius(t){const e=t,r=d_(dl("line-width",this,e),dl("line-gap-width",this,e)),n=dl("line-offset",this,e);return r/2+Math.abs(n)+Th(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,r,n,c,u){if(t.queryGeometry.isAboveHorizon)return!1;const p=Wm(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),g=t.pixelToTileUnitsFactor/2*d_(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),v=this.paint.get("line-offset").evaluate(e,r);return v&&(n=function(w,A){const C=[],M=new F(0,0);for(let L=0;L<w.length;L++){const B=w[L],G=[];for(let q=0;q<B.length;q++){const Q=B[q-1],oe=B[q],ce=B[q+1],de=q===0?M:oe.sub(Q)._unit()._perp(),pe=q===B.length-1?M:ce.sub(oe)._unit()._perp(),me=de._add(pe)._unit();me._mult(1/(me.x*pe.x+me.y*pe.y)),G.push(me._mult(A)._add(oe))}C.push(G)}return C}(n,v*t.pixelToTileUnitsFactor)),function(w,A,C){for(let M=0;M<A.length;M++){const L=A[M];if(w.length>=3){for(let B=0;B<L.length;B++)if(hl(w,L[B]))return!0}if(H0(w,L,C))return!0}return!1}(p,n,g)}isTileClipped(){return!0}},symbol:Uh,background:class extends oo{constructor(t){super(t,E1)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends oo{constructor(t){super(t,A1)}getProgramIds(){return["raster"]}},sky:class extends oo{constructor(t){super(t,M1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Mf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(t,e){const r=this.paint.get("sky-type");if(r==="atmosphere"){const n=this.paint.get("sky-atmosphere-sun"),c=!n,u=t.style.light,p=u.properties.get("position");return c&&u.properties.get("anchor")==="viewport"&&et("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?Yf(p.azimuthal,90-p.polar,e):Yf(n[0],90-n[1],e)}if(r==="gradient"){const n=this.paint.get("sky-gradient-center");return Yf(n[0],90-n[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}},{HTMLImageElement:N_,HTMLCanvasElement:j_,HTMLVideoElement:G_,ImageData:$_,ImageBitmap:Vh}=$;class Nh{constructor(e,r,n,c){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(r,c)}update(e,r,n){const{width:c,height:u}=e,{context:p}=this,{gl:g}=p;if(g.bindTexture(g.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!r||r.premultiply!==!1)),n||this.size&&this.size[0]===c&&this.size[1]===u){const{x:v,y:w}=n||{x:0,y:0};e instanceof N_||e instanceof j_||e instanceof G_||e instanceof $_||Vh&&e instanceof Vh?g.texSubImage2D(g.TEXTURE_2D,0,v,w,g.RGBA,g.UNSIGNED_BYTE,e):g.texSubImage2D(g.TEXTURE_2D,0,v,w,c,u,g.RGBA,g.UNSIGNED_BYTE,e.data)}else this.size=[c,u],e instanceof N_||e instanceof j_||e instanceof G_||e instanceof $_||Vh&&e instanceof Vh?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,g.UNSIGNED_BYTE,e):g.texImage2D(g.TEXTURE_2D,0,this.format,c,u,0,this.format,g.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,r){const{context:n}=this,{gl:c}=n;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,r),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Jf{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new ga({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const n=this.getKey(e,r);return this.positions[n]}trim(){const e=this.width,r=this.height=xt(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,n){const c=[];let u=e.length%2==1?-e[e.length-1]*n:0,p=e[0]*n,g=!0;c.push({left:u,right:p,isDash:g,zeroLength:e[0]===0});let v=e[0];for(let w=1;w<e.length;w++){g=!g;const A=e[w];u=v*n,v+=A,p=v*n,c.push({left:u,right:p,isDash:g,zeroLength:A===0})}return c}addRoundDash(e,r,n){const c=r/2;for(let u=-n;u<=n;u++){const p=this.width*(this.nextRow+n+u);let g=0,v=e[g];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++g]);const A=Math.abs(w-v.left),C=Math.abs(w-v.right),M=Math.min(A,C);let L;const B=u/n*(c+1);if(v.isDash){const G=c-Math.abs(B);L=Math.sqrt(M*M+G*G)}else L=c-Math.sqrt(M*M+B*B);this.image.data[p+w]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,r){for(let v=e.length-1;v>=0;--v){const w=e[v],A=e[v+1];w.zeroLength?e.splice(v,1):A&&A.isDash===w.isDash&&(A.left=w.left,e.splice(v,1))}const n=e[0],c=e[e.length-1];n.isDash===c.isDash&&(n.left=c.left-this.width,c.right=n.right+this.width);const u=this.width*this.nextRow;let p=0,g=e[p];for(let v=0;v<this.width;v++){v/g.right>1&&(g=e[++p]);const w=Math.abs(v-g.left),A=Math.abs(v-g.right),C=Math.min(w,A);this.image.data[u+v]=Math.max(0,Math.min(255,(g.isDash?C:-C)+r+128))}}addDash(e,r){const n=this.getKey(e,r);if(this.positions[n])return this.positions[n];const c=r==="round",u=c?7:0,p=2*u+1;if(this.nextRow+p>this.height)return et("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let A=0;A<e.length;A++)e[A]<0&&(et("Negative value is found in line dasharray, replacing values with 0"),e[A]=0),g+=e[A];if(g!==0){const A=this.width/g,C=this.getDashRanges(e,this.width,A);c?this.addRoundDash(C,A,u):this.addRegularDash(C,r==="square"?.5*A:0)}const v=this.nextRow+u;this.nextRow+=p;const w={tl:[v,u],br:[g,0]};return this.positions[n]=w,w}}at("LineAtlas",Jf);class k1{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const z1=$.performance;function Z_(t){const e=t?t.url.toString():void 0;return z1.getEntriesByName(e)}class P1{constructor(){this.tasks={},this.taskQueue=[],Xt(["process"],this),this.invoker=new k1(this.process),this.nextId=0}add(e,r){const n=this.nextId++,c=function({type:u,isSymbolTile:p,zoom:g}){return g=g||0,u==="message"?0:u!=="maybePrepare"||p?u!=="parseTile"||p?u==="parseTile"&&p?300-g:u==="maybePrepare"&&p?400-g:500:200-g:100-g}(r);if(c===0){Ut();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:r,priority:c,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){Ut();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let c=0;c<this.taskQueue.length;c++){const u=this.tasks[this.taskQueue[c]];u.priority<r&&(r=u.priority,e=c)}if(e===null)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}function q_(t,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class jh{constructor(e,r,n){this.z=e,this.x=r,this.y=n,this.key=Fc(0,e,e,r,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const n=function(u,p,g){var v=q_(256*u,256*(p=Math.pow(2,g)-p-1),g),w=q_(256*(u+1),256*(p+1),g);return v[0]+","+v[1]+","+w[0]+","+w[1]}(this.x,this.y,this.z),c=function(u,p,g){let v,w="";for(let A=u;A>0;A--)v=1<<A-1,w+=(p&v?1:0)+(g&v?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Qf{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Fc(e,r.z,r.z,r.x,r.y)}}class ln{constructor(e,r,n,c,u){this.overscaledZ=e,this.wrap=r,this.canonical=new jh(n,+c,+u),this.key=r===0&&e===n?this.canonical.key:Fc(r,e,n,c,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new ln(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ln(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Fc(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return Fc(this.wrap*+r,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new ln(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,n=2*this.canonical.x,c=2*this.canonical.y;return[new ln(r,this.wrap,r,n,c),new ln(r,this.wrap,r,n+1,c),new ln(r,this.wrap,r,n,c+1),new ln(r,this.wrap,r,n+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ln(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ln(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Qf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Fc(t,e,r,n,c){const u=1<<Math.min(r,22);let p=u*(c%u)+n%u;return t&&r<22&&(p+=u*u*((t<0?-2*t-1:2*t)%(1<<2*(22-r)))),16*(32*p+r)+(e-r)}at("CanonicalTileID",jh),at("OverscaledTileID",ln,{omit:["projMatrix"]});class bl{constructor(e,r,n){this.func=e,this.mask=r,this.range=n}}bl.ReadOnly=!1,bl.ReadWrite=!0,bl.disabled=new bl(519,bl.ReadOnly,[0,1]);const ep=7680;class tp{constructor(e,r,n,c,u,p){this.test=e,this.ref=r,this.mask=n,this.fail=c,this.depthFail=u,this.pass=p}}tp.disabled=new tp({func:519,mask:0},0,0,ep,ep,ep);class zo{constructor(e,r,n){this.blendFunction=e,this.blendColor=r,this.mask=n}}zo.Replace=[1,0],zo.disabled=new zo(zo.Replace,ii.transparent,[!1,!1,!1,!1]),zo.unblended=new zo(zo.Replace,ii.transparent,[!0,!0,!0,!0]),zo.alphaBlended=new zo([1,771],ii.transparent,[!0,!0,!0,!0]);const ip=1029,rp=2305;class lo{constructor(e,r,n){this.enable=e,this.mode=r,this.frontFace=n}}lo.disabled=new lo(!1,ip,rp),lo.backCCW=new lo(!0,ip,rp),lo.backCW=new lo(!0,ip,2304),lo.frontCW=new lo(!0,1028,2304),lo.frontCCW=new lo(!0,1028,rp);class W_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const n=e[r];this._stringToNumber[n]=r,this._numberToString[r]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class H_{constructor(e,r,n,c,u){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=n,e._y=c,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class D1{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,n){const c=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},Gt(this.stateChanges[e][c],n),this.deletedStates[e]===null){this.deletedStates[e]={};for(const u in this.state[e])u!==c&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const u in this.state[e][c])n[u]||(this.deletedStates[e][c][u]=null)}else for(const u in n)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][u]===null&&delete this.deletedStates[e][c][u]}removeFeatureState(e,r,n){if(this.deletedStates[e]===null)return;const c=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&r!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][n]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(n in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][n]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,r){const n=String(r),c=Gt({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const u=this.deletedStates[e][r];if(u===null)return{};for(const p in u)delete c[p]}return c}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const n={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const u={};for(const p in this.stateChanges[c])this.state[c][p]||(this.state[c][p]={}),Gt(this.state[c][p],this.stateChanges[c][p]),u[p]=this.state[c][p];n[c]=u}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const u={};if(this.deletedStates[c]===null)for(const p in this.state[c])u[p]={},this.state[c][p]={};else for(const p in this.deletedStates[c]){if(this.deletedStates[c][p]===null)this.state[c][p]={};else for(const g of Object.keys(this.deletedStates[c][p]))delete this.state[c][p][g];u[p]=this.state[c][p]}n[c]=n[c]||{},Gt(n[c],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(const c in e)e[c].setFeatureState(n,r)}}class X_{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const n=this.toIdx(e,r);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function K_(t,e,r,n){let c=0,u=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(n[p])<1e-15){if(r[p]<t[p]||r[p]>e[p])return null}else{const g=1/n[p];let v=(t[p]-r[p])*g,w=(e[p]-r[p])*g;if(v>w){const A=v;v=w,w=A}if(v>c&&(c=v),w<u&&(u=w),c>u)return null}return c}function Y_(t,e,r,n,c,u,p,g,v,w,A){const C=n-t,M=c-e,L=u-r,B=p-t,G=g-e,q=v-r,Q=A[1]*q-A[2]*G,oe=A[2]*B-A[0]*q,ce=A[0]*G-A[1]*B,de=C*Q+M*oe+L*ce;if(Math.abs(de)<1e-15)return null;const pe=1/de,me=w[0]-t,ke=w[1]-e,Ce=w[2]-r,Ye=(me*Q+ke*oe+Ce*ce)*pe;if(Ye<0||Ye>1)return null;const qe=ke*L-Ce*M,Ie=Ce*C-me*L,We=me*M-ke*C,Qe=(A[0]*qe+A[1]*Ie+A[2]*We)*pe;return Qe<0||Ye+Qe>1?null:(B*qe+G*Ie+q*We)*pe}function J_(t,e,r){return(t-e)/(r-e)}function Q_(t,e,r,n,c,u,p,g,v){const w=1<<r,A=u-n,C=p-c,M=(t+1)/w*A+n,L=(e+0)/w*C+c,B=(e+1)/w*C+c;g[0]=(t+0)/w*A+n,g[1]=L,v[0]=M,v[1]=B}class eg{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(u){const p=Math.ceil(Math.log2(u.dim/8)),g=[];let v=Math.ceil(Math.pow(2,p));const w=1/v,A=(L,B,G,q,Q)=>{const oe=q?1:0,ce=(L+1)*G-oe,de=B*G,pe=(B+1)*G-oe;Q[0]=L*G,Q[1]=de,Q[2]=ce,Q[3]=pe};let C=new X_(v);const M=[];for(let L=0;L<v*v;L++){A(L%v,Math.floor(L/v),w,!1,M);const B=ba(M[0],M[1],u),G=ba(M[2],M[1],u),q=ba(M[2],M[3],u),Q=ba(M[0],M[3],u);C.minimums.push(Math.min(B,G,q,Q)),C.maximums.push(Math.max(B,G,q,Q)),C.leaves.push(1)}for(g.push(C),v/=2;v>=1;v/=2){const L=g[g.length-1];C=new X_(v);for(let B=0;B<v*v;B++){A(B%v,Math.floor(B/v),2,!0,M);const G=L.getElevation(M[0],M[1]),q=L.getElevation(M[2],M[1]),Q=L.getElevation(M[2],M[3]),oe=L.getElevation(M[0],M[3]),ce=L.isLeaf(M[0],M[1]),de=L.isLeaf(M[2],M[1]),pe=L.isLeaf(M[2],M[3]),me=L.isLeaf(M[0],M[3]),ke=Math.min(G.min,q.min,Q.min,oe.min),Ce=Math.max(G.max,q.max,Q.max,oe.max),Ye=ce&&de&&pe&&me;C.maximums.push(Ce),C.minimums.push(ke),C.leaves.push(Ce-ke<=5&&Ye?1:0)}g.push(C)}return g}(this.dem),n=r.length-1,c=r[n];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(r,0,0,n,0)}raycastRoot(e,r,n,c,u,p,g=1){return K_([e,r,-100],[n,c,this.maximums[0]*g],u,p)}raycast(e,r,n,c,u,p,g=1){if(!this.nodeCount)return null;const v=this.raycastRoot(e,r,n,c,u,p,g);if(v==null)return null;const w=[],A=[],C=[],M=[],L=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:B,t:G,nodex:q,nodey:Q,depth:oe}=L.pop();if(this.leaves[B]){Q_(q,Q,oe,e,r,n,c,C,M);const de=1<<oe,pe=(q+0)/de,me=(q+1)/de,ke=(Q+0)/de,Ce=(Q+1)/de,Ye=ba(pe,ke,this.dem)*g,qe=ba(me,ke,this.dem)*g,Ie=ba(me,Ce,this.dem)*g,We=ba(pe,Ce,this.dem)*g,Qe=Y_(C[0],C[1],Ye,M[0],C[1],qe,M[0],M[1],Ie,u,p),Be=Y_(M[0],M[1],Ie,C[0],M[1],We,C[0],C[1],Ye,u,p),nt=Math.min(Qe!==null?Qe:Number.MAX_VALUE,Be!==null?Be:Number.MAX_VALUE);if(nt!==Number.MAX_VALUE)return nt;{const ct=Dt([],u,p,G);if(tg(Ye,qe,We,Ie,J_(ct[0],C[0],M[0]),J_(ct[1],C[1],M[1]))>=ct[2])return G}continue}let ce=0;for(let de=0;de<this._siblingOffset.length;de++){Q_((q<<1)+this._siblingOffset[de][0],(Q<<1)+this._siblingOffset[de][1],oe+1,e,r,n,c,C,M),C[2]=-100,M[2]=this.maximums[this.childOffsets[B]+de]*g;const pe=K_(C,M,u,p);if(pe!=null){const me=pe;w[de]=me;let ke=!1;for(let Ce=0;Ce<ce&&!ke;Ce++)me>=w[A[Ce]]&&(A.splice(Ce,0,de),ke=!0);ke||(A[ce]=de),ce++}}for(let de=0;de<ce;de++){const pe=A[de];L.push({idx:this.childOffsets[B]+pe,t:w[pe],nodex:(q<<1)+this._siblingOffset[pe][0],nodey:(Q<<1)+this._siblingOffset[pe][1],depth:oe+1})}}return null}_addNode(e,r,n){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,n,c,u){if(e[c].isLeaf(r,n)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const p=c-1,g=e[p];let v,w=0;for(let A=0;A<this._siblingOffset.length;A++){const C=2*r+this._siblingOffset[A][0],M=2*n+this._siblingOffset[A][1],L=g.getElevation(C,M),B=g.isLeaf(C,M),G=this._addNode(L.min,L.max,B);B&&(w|=1<<A),v||(v=G)}for(let A=0;A<this._siblingOffset.length;A++)w&1<<A||this._construct(e,2*r+this._siblingOffset[A][0],2*n+this._siblingOffset[A][1],p,v+A)}}function tg(t,e,r,n,c,u){return _i(_i(t,r,u),_i(e,n,u),c)}function ba(t,e,r){const n=r.dim,c=Nt(t*n-.5,0,n-1),u=Nt(e*n-.5,0,n-1),p=Math.floor(c),g=Math.floor(u),v=Math.min(p+1,n-1),w=Math.min(g+1,n-1);return tg(r.get(p,g),r.get(v,g),r.get(p,w),r.get(v,w),c-p,u-g)}const ig={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Gh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,n,c=!1,u=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return et(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const p=this.dim=r.height-2;if(this.data=new Uint32Array(r.data.buffer),this.encoding=n||"mapbox",this.borderReady=c,!c){for(let g=0;g<p;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(p,g)]=this.data[this._idx(p-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,p)]=this.data[this._idx(g,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)],u&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new eg(this)}get(e,r,n=!1){const c=new Uint8Array(this.data.buffer);n&&(e=Nt(e,-1,this.dim),r=Nt(r,-1,this.dim));const u=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[u],c[u+1],c[u+2])}static getUnpackVector(e){return ig[e]}get unpackVector(){return ig[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,n){return(256*e*256+256*r+n)/10-1e4}_unpackTerrarium(e,r,n){return 256*e+r+n/256-32768}static pack(e,r){const n=[0,0,0,0],c=Gh.getUnpackVector(r);let u=Math.floor((e+c[3])/c[2]);return n[2]=u%256,u=Math.floor(u/256),n[1]=u%256,u=Math.floor(u/256),n[0]=u,n}getPixels(){return new Nn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,u=r*this.dim+this.dim,p=n*this.dim,g=n*this.dim+this.dim;switch(r){case-1:c=u-1;break;case 1:u=c+1}switch(n){case-1:p=g-1;break;case 1:g=p+1}const v=-r*this.dim,w=-n*this.dim;for(let A=p;A<g;A++)for(let C=c;C<u;C++)this.data[this._idx(C,A)]=e.data[this._idx(C+v,A+w)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}at("DEMData",Gh),at("DemMinMaxQuadTree",eg,{omit:["dem"]});class L1{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,n){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const u={value:r,timeout:void 0};if(n!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},n)),this.data[c].push(u),this.order.push(c),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const n=e.wrapped().key,c=r===void 0?0:this.data[n].indexOf(r),u=this.data[n][c];return this.data[n].splice(c,1),u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(u.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const n in this.data)for(const c of this.data[n])e(c.value)||r.push(c);for(const n of r)this.remove(n.value.tileID,n)}}class cs extends yo{constructor(e,r,n){super(),this.id=e,this._onlySymbols=n,r.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new L1(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new D1}onAdd(e){this.map=e,this._minTileCacheSize=e?e._minTileCacheSize:null,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const n=this._tiles[r];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return _r(this._tiles).map(e=>e.tileID).sort(rg).map(e=>e.key)}getRenderableIds(e){const r=[];for(const n in this._tiles)this._isIdRenderable(+n,e)&&r.push(this._tiles[n]);return e?r.sort((n,c)=>{const u=n.tileID,p=c.tileID,g=new F(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),v=new F(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-p.overscaledZ||v.y-g.y||v.x-g.x}).map(n=>n.tileID.key):r.map(n=>n.tileID).sort(rg).map(n=>n.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const n=this._tiles[e];n&&(n.state!=="loading"&&(n.state=r),this._loadTile(n,this._tileLoaded.bind(this,n,e,r)))}_tileLoaded(e,r,n,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new Cs(c,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=ji.now(),n==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new go("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let c=0;c<r.length;c++){const u=r[c];if(e.neighboringTiles&&e.neighboringTiles[u]){const p=this.getTileByID(u);n(e,p),n(p,e)}}function n(c,u){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let p=u.tileID.canonical.x-c.tileID.canonical.x;const g=u.tileID.canonical.y-c.tileID.canonical.y,v=Math.pow(2,c.tileID.canonical.z),w=u.tileID.key;p===0&&g===0||Math.abs(g)>1||(Math.abs(p)>1&&(Math.abs(p+v)===1?p+=v:Math.abs(p-v)===1&&(p-=v)),u.dem&&c.dem&&(c.dem.backfillBorder(u.dem,p,g),c.neighboringTiles&&c.neighboringTiles[w]&&(c.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,n,c){for(const u in this._tiles){let p=this._tiles[u];if(c[u]||!p.hasData()||p.tileID.overscaledZ<=r||p.tileID.overscaledZ>n)continue;let g=p.tileID;for(;p&&p.tileID.overscaledZ>r+1;){const w=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[w.key],p&&p.hasData()&&(g=w)}let v=g;for(;v.overscaledZ>r;)if(v=v.scaledTo(v.overscaledZ-1),e[v.key]){c[g.key]=g;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=r?n:null}for(let n=e.overscaledZ-1;n>=r;n--){const c=e.scaledTo(n),u=this._getLoadedTile(c);if(u)return u}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const n=Math.ceil(e.width/r)+1,c=Math.ceil(e.height/r)+1,u=Math.floor(n*c*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(g)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const n={};for(const c in this._tiles){const u=this._tiles[c];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+r),n[u.tileID.key]=u}this._tiles=n;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,r,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;let c;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(g=>new ln(g.canonical.z,g.wrap,g.canonical.z,g.canonical.x,g.canonical.y)):(c=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(g=>this._source.hasTile(g)))):c=[];const u=this._updateRetainedTiles(c);if(ng(this._source.type)&&c.length!==0){const g={},v={},w=Object.keys(u);for(const C of w){const M=u[C],L=this._tiles[C];if(!L||L.fadeEndTime&&L.fadeEndTime<=ji.now())continue;const B=this.findLoadedParent(M,Math.max(M.overscaledZ-cs.maxOverzooming,this._source.minzoom));B&&(this._addTile(B.tileID),g[B.tileID.key]=B.tileID),v[C]=M}const A=c[c.length-1].overscaledZ;for(const C in this._tiles){const M=this._tiles[C];if(u[C]||!M.hasData())continue;let L=M.tileID;for(;L.overscaledZ>A;){L=L.scaledTo(L.overscaledZ-1);const B=this._tiles[L.key];if(B&&B.hasData()&&v[L.key]){u[C]=M.tileID;break}}}for(const C in g)u[C]||(this._coveredTiles[C]=!0,u[C]=g[C])}for(const g in u)this._tiles[g].clearFadeHold();const p=function(g,v){const w=[];for(const A in g)A in v||w.push(A);return w}(this._tiles,u);for(const g of p){const v=this._tiles[g];v.hasSymbolBuckets&&!v.holdingForFade()?v.setHoldDuration(this.map._fadeDuration):v.hasSymbolBuckets&&!v.symbolFadeFinished()||this._removeTile(+g)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const n={},c=e.reduce((w,A)=>Math.min(w,A.overscaledZ),1/0),u=e[0].overscaledZ,p=Math.max(u-cs.maxOverzooming,this._source.minzoom),g=Math.max(u+cs.maxUnderzooming,this._source.minzoom),v={};for(const w of e){const A=this._addTile(w);r[w.key]=w,A.hasData()||c<this._source.maxzoom&&(v[w.key]=w)}this._retainLoadedChildren(v,c,g,r);for(const w of e){let A=this._tiles[w.key];if(A.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const M=w.children(this._source.maxzoom)[0],L=this.getTile(M);if(L&&L.hasData()){r[M.key]=M;continue}}else{const M=w.children(this._source.maxzoom);if(r[M[0].key]&&r[M[1].key]&&r[M[2].key]&&r[M[3].key])continue}let C=A.wasRequested();for(let M=w.overscaledZ-1;M>=p;--M){const L=w.scaledTo(M);if(n[L.key]||(n[L.key]=!0,A=this.getTile(L),!A&&C&&(A=this._addTile(L)),A&&(r[L.key]=L,C=A.wasRequested(),A.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let n,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){n=this._loadedParentTiles[c.key];break}r.push(c.key);const u=c.scaledTo(c.overscaledZ-1);if(n=this._getLoadedTile(u),n)break;c=u}for(const u of r)this._loadedParentTiles[u]=n}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const n=Boolean(r);if(!n){const c=this.map?this.map.painter:null,u=this._source.type==="raster"||this._source.type==="raster-dem";r=new op(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,u),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,n||this._source.fire(new go("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=r.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,r,n){const c=[],u=this.transform;if(!u)return c;for(const p in this._tiles){const g=this._tiles[p];if(n&&g.clearQueryDebugViz(),g.holdingForFade())continue;const v=e.containsTile(g,u,r);v&&c.push(v)}return c}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(n=>this._tiles[n].tileID);for(const n of r)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(ng(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=ji.now())return!0}return!1}setFeatureState(e,r,n){this._state.updateState(e=e||"_geojsonTileLayer",r,n)}removeFeatureState(e,r,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,n)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,n){const c=this._tiles[e];c&&c.setDependencies(r,n)}reloadTilesForDependencies(e,r){for(const n in this._tiles)this._tiles[n].hasDependency(e,r)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,r))}_preloadTiles(e,r){const n=new Map,c=Array.isArray(e)?e:[e],u=this.map.painter.terrain,p=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(const w of c){const A=w.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const C of A)n.set(C.key,C);this.usedForTerrain&&w.updateElevation(!1)}const g=Array.from(n.values()),v=this._source.type==="raster"||this._source.type==="raster-dem";Fr(g,(w,A)=>{const C=new op(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,v);this._loadTile(C,M=>{this._source.type==="raster-dem"&&C.dem&&this._backfillDEM(C),A(M,C)})},r)}}function rg(t,e){const r=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-r||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function ng(t){return t==="raster"||t==="image"||t==="video"}cs.maxOverzooming=10,cs.maxUnderzooming=3;class $h{constructor(e,r,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=n}static create(e,r,n){const c=n||e.findDEMTileFor(r);if(!c||!c.dem)return;const u=c.dem,p=c.tileID,g=1<<r.canonical.z-p.canonical.z;return new $h(c,c.tileSize/jt/g,[(r.canonical.x/g-p.canonical.x)*u.dim,(r.canonical.y/g-p.canonical.y)*u.dim])}tileCoordToPixel(e,r){const n=r*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(n);return new F(c,u)}getElevationAt(e,r,n,c){const u=e*this._scale+this._offset[0],p=r*this._scale+this._offset[1],g=Math.floor(u),v=Math.floor(p),w=this._dem;return c=!!c,n?_i(_i(w.get(g,v,c),w.get(g,v+1,c),p-v),_i(w.get(g+1,v,c),w.get(g+1,v+1,c),p-v),u-g):w.get(g,v,c)}getElevationAtPixel(e,r,n){return this._dem.get(e,r,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ao(1,e)*this._dem.stride}}class og{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new es(jt,16,0),this.featureIndexArray=new Im,this.promoteId=r}insert(e,r,n,c,u,p=0){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,c,u,p);const v=this.grid;for(let w=0;w<r.length;w++){const A=r[w],C=[1/0,1/0,-1/0,-1/0];for(let M=0;M<A.length;M++){const L=A[M];C[0]=Math.min(C[0],L.x),C[1]=Math.min(C[1],L.y),C[2]=Math.max(C[2],L.x),C[3]=Math.max(C[3],L.y)}C[0]<jt&&C[1]<jt&&C[2]>=0&&C[3]>=0&&v.insert(g,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ls.VectorTile(new Rc(this.rawTileData)).layers,this.sourceLayerCoder=new W_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,n,c){this.loadVTLayers();const u=e.params||{},p=tl(u.filter),g=e.tileResult,v=e.transform,w=g.bufferedTilespaceBounds,A=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(B,G,q,Q)=>qm(g.bufferedTilespaceGeometry,B,G,q,Q));A.sort(R1);let C=null;v.elevation&&A.length>0&&(C=$h.create(v.elevation,this.tileID));const M={};let L;for(let B=0;B<A.length;B++){const G=A[B];if(G===L)continue;L=G;const q=this.featureIndexArray.get(G);let Q=null;this.loadMatchingFeature(M,q,p,u.layers,u.availableImages,r,n,c,(oe,ce,de,pe=0)=>(Q||(Q=qo(oe,this.tileID.canonical,e.tileTransform)),ce.queryIntersectsFeature(g,oe,de,Q,this.z,e.transform,e.pixelPosMatrix,C,pe)))}return M}loadMatchingFeature(e,r,n,c,u,p,g,v,w){const{featureIndex:A,bucketIndex:C,sourceLayerIndex:M,layoutVertexArrayOffset:L}=r,B=this.bucketLayerIDs[C];if(c&&!function(oe,ce){for(let de=0;de<oe.length;de++)if(ce.indexOf(oe[de])>=0)return!0;return!1}(c,B))return;const G=this.sourceLayerCoder.decode(M),q=this.vtLayers[G].feature(A);if(n.needGeometry){const oe=ss(q,!0);if(!n.filter(new It(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!n.filter(new It(this.tileID.overscaledZ),q))return;const Q=this.getId(q,G);for(let oe=0;oe<B.length;oe++){const ce=B[oe];if(c&&c.indexOf(ce)<0)continue;const de=p[ce];if(!de)continue;let pe={};Q!==void 0&&v&&(pe=v.getState(de.sourceLayer||"_geojsonTileLayer",Q));const me=Gt({},g[ce]);me.paint=ag(me.paint,de.paint,q,pe,u),me.layout=ag(me.layout,de.layout,q,pe,u);const ke=!w||w(q,de,pe,L);if(!ke)continue;const Ce=new H_(q,this.z,this.x,this.y,Q);Ce.layer=me;let Ye=e[ce];Ye===void 0&&(Ye=e[ce]=[]),Ye.push({featureIndex:A,feature:Ce,intersectionZ:ke})}}lookupSymbolFeatures(e,r,n,c,u,p,g,v){const w={};this.loadVTLayers();const A=tl(u);for(const C of e)this.loadMatchingFeature(w,{bucketIndex:n,sourceLayerIndex:c,featureIndex:C,layoutVertexArrayOffset:0},A,p,g,v,r);return w}loadFeature(e){const{featureIndex:r,sourceLayerIndex:n}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(n),u=this.vtFeatures[c];if(u[r])return u[r];const p=this.vtLayers[c].feature(r);return u[r]=p,p}hasLayer(e){for(const r of this.bucketLayerIDs)for(const n of r)if(e===n)return!0;return!1}getId(e,r){let n=e.id;return this.promoteId&&(n=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof n=="boolean"&&(n=Number(n))),n}}function ag(t,e,r,n,c){return ir(t,(u,p)=>{const g=e instanceof Vo?e.get(p):null;return g&&g.evaluate?g.evaluate(r,n,c):g})}function R1(t,e){return e-t}at("FeatureIndex",og,{omit:["rawTileData","sourceLayerCoder"]});var B1=Hi([{name:"a_pos",type:"Int16",components:2}]);const Yn=32,Po=33,wa=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,r=0,n=0,c=0,u=0,p=0,g=0;for(1&e?c=u=p=Yn:r=n=g=Yn;(e>>=1)>1;){const w=r+c>>1,A=n+u>>1;1&e?(c=r,u=n,r=p,n=g):(r=c,n=u,c=p,u=g),p=w,g=A}const v=4*t;wa[v+0]=r,wa[v+1]=n,wa[v+2]=c,wa[v+3]=u}const Do=new Uint16Array(2178),Ta=new Uint8Array(1089),Zh=new Uint16Array(1089);function sg(t){return t===0?-.03125:t===32?.03125:0}var np=Hi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const lg={type:2,extent:jt,loadGeometry:()=>[[new F(0,0),new F(8193,0),new F(8193,8193),new F(0,8193),new F(0,0)]]};class op{constructor(e,r,n,c,u){this.tileID=e,this.uid=He(),this.uses=0,this.tileSize=r,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<ji.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=wl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,u){const p={};if(!u)return p;for(const g of c){const v=g.layerIds.map(w=>u.getLayer(w)).filter(Boolean);if(v.length!==0){g.layers=v,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(w=>v.filter(A=>A.id===w)[0]));for(const w of v)p[w.id]=g}}return p}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const u=this.buckets[c];if(u instanceof xa){if(this.hasSymbolBuckets=!0,!n)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const u=this.buckets[c];if(u instanceof xa&&u.hasRTLText){this.hasRTLText=!0,Qt.isLoading()||Qt.isLoaded()||bn()!=="deferred"||Un();break}}this.queryPadding=0;for(const c in this.buckets){const u=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(c).queryRadius(u))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new gf}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const n in this.buckets){const c=this.buckets[n];c.uploadPending()&&c.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Nh(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Nh(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Nh(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,n,c,u,p,g,v){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:g,transform:p,params:u,tileTransform:this.tileTransform},e,r,n):{}}querySourceFeatures(e,r){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const c=n.loadVTLayers(),u=r?r.sourceLayer:"",p=c._geojsonTileLayer||c[u];if(!p)return;const g=tl(r&&r.filter),{z:v,x:w,y:A}=this.tileID.canonical,C={z:v,x:w,y:A};for(let M=0;M<p.length;M++){const L=p.feature(M);if(g.needGeometry){const q=ss(L,!0);if(!g.filter(new It(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!g.filter(new It(this.tileID.overscaledZ),L))continue;const B=n.getId(L,u),G=new H_(L,v,w,A,B);G.tile=C,e.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const n=di(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const n=Date.now();let c=!1;if(this.expirationTime>n)c=!1;else if(r)if(this.expirationTime<r)c=!0;else{const u=this.expirationTime-r;u?this.expirationTime=n+Math.max(u,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const n=this.latestFeatureIndex.loadVTLayers(),c=r.style.listImages();for(const u in this.buckets){if(!r.style.hasLayer(u))continue;const p=this.buckets[u],g=p.layers[0].sourceLayer||"_geojsonTileLayer",v=n[g],w=e[g];if(!v||!w||Object.keys(w).length===0)continue;if(p.update(w,v,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),p instanceof kh||p instanceof Ih){const C=r.style._getSourceCache(p.layers[0].source);r._terrain&&r._terrain.enabled&&C&&p.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(C.id,this.tileID)}const A=r&&r.style&&r.style.getLayer(u);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ji.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ji.now()+e}setDependencies(e,r){const n={};for(const c of r)n[c]=!0;this.dependencies[e]=n}hasDependency(e,r){for(const n of e){const c=this.dependencies[n];if(c){for(const u of r)if(c[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const n=qo(lg,this.tileID.canonical,this.tileTransform)[0],c=new ol,u=new mh;for(let p=0;p<n.length;p++){const{x:g,y:v}=n[p];c.emplaceBack(g,v),u.emplaceBack(p)}u.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(c,np.members),this._tileDebugSegments=or.simpleSegment(0,0,c.length,u.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const n=qo(lg,this.tileID.canonical,this.tileTransform)[0];let c,u;if(this.isRaster){const p=function(g,v){const w=wl(g,v),A=Math.pow(2,g.z);for(let q=0;q<Po;q++)for(let Q=0;Q<Po;Q++){const oe=Zo((g.x+(Q+sg(Q))/Yn)/A),ce=Kn((g.y+(q+sg(q))/Yn)/A),de=v.project(oe,ce),pe=q*Po+Q;Do[2*pe+0]=Math.round((de.x*w.scale-w.x)*jt),Do[2*pe+1]=Math.round((de.y*w.scale-w.y)*jt)}Ta.fill(0),Zh.fill(0);for(let q=2045;q>=0;q--){const Q=4*q,oe=wa[Q+0],ce=wa[Q+1],de=wa[Q+2],pe=wa[Q+3],me=oe+de>>1,ke=ce+pe>>1,Ce=me+ke-ce,Ye=ke+oe-me,qe=ce*Po+oe,Ie=pe*Po+de,We=ke*Po+me,Qe=Math.hypot((Do[2*qe+0]+Do[2*Ie+0])/2-Do[2*We+0],(Do[2*qe+1]+Do[2*Ie+1])/2-Do[2*We+1])>=16;if(Ta[We]=Ta[We]||(Qe?1:0),q<1022){const Be=(ce+Ye>>1)*Po+(oe+Ce>>1),nt=(pe+Ye>>1)*Po+(de+Ce>>1);Ta[We]=Ta[We]||Ta[Be]||Ta[nt]}}const C=new al,M=new Vn;let L=0;function B(q,Q){const oe=Q*Po+q;return Zh[oe]===0&&(C.emplaceBack(Do[2*oe+0],Do[2*oe+1],q*jt/Yn,Q*jt/Yn),Zh[oe]=++L),Zh[oe]-1}function G(q,Q,oe,ce,de,pe){const me=q+oe>>1,ke=Q+ce>>1;if(Math.abs(q-de)+Math.abs(Q-pe)>1&&Ta[ke*Po+me])G(de,pe,q,Q,me,ke),G(oe,ce,de,pe,me,ke);else{const Ce=B(q,Q),Ye=B(oe,ce),qe=B(de,pe);M.emplaceBack(Ce,Ye,qe)}}return G(0,0,Yn,Yn,Yn,0),G(Yn,Yn,0,0,0,Yn),{vertices:C,indices:M}}(this.tileID.canonical,r);c=p.vertices,u=p.indices}else{c=new al,u=new Vn;for(const{x:g,y:v}of n)c.emplaceBack(g,v,0,0);const p=Sh(c.int16,void 0,4);for(let g=0;g<p.length;g+=3)u.emplaceBack(p[g],p[g+1],p[g+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,np.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(u),this._tileBoundsSegments=or.simpleSegment(0,0,c.length,u.length)}}const O1=Hi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),F1=Hi([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:cg}=O1;function us(t,e){const r=t.fovAboveCenter,n=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-n)/Math.cos(t._pitch),u=Math.sin(r)*c/Math.sin(Math.max(Math.PI/2-t._pitch-r,.01)),p=Math.sin(t._pitch)*u+c;return Math.min(1.01*p,c*(1/t._horizonShift))}const ap=jt/Math.PI/2,wn=-ap,Tn=ap,U1=[new so([wn,wn,wn],[Tn,Tn,Tn]),new so([wn,wn,wn],[0,0,Tn]),new so([0,wn,wn],[Tn,0,Tn]),new so([wn,0,wn],[0,Tn,Tn]),new so([0,0,wn],[Tn,Tn,Tn])];function qh(t){if(t.z<=1)return U1[t.z+2*t.y+t.x];const[e,r]=ug(t),n=[Wh(e[0],e[1]),Wh(e[0],r[1]),Wh(r[0],e[1]),Wh(r[0],r[1])],c=[Tn,Tn,Tn],u=[wn,wn,wn];for(const p of n)c[0]=Math.min(c[0],p[0]),c[1]=Math.min(c[1],p[1]),c[2]=Math.min(c[2],p[2]),u[0]=Math.max(u[0],p[0]),u[1]=Math.max(u[1],p[1]),u[2]=Math.max(u[2],p[2]);return new so(c,u)}function ug(t){const e=Math.pow(2,t.z),r=t.x/e,n=(t.x+1)/e,c=(t.y+1)/e;return[[Kn(t.y/e),Zo(r)],[Kn(c),Zo(n)]]}function sp(t,e,r,n){return r=Et(r),n||(n=ap),[t*Math.sin(r)*n,-e*n,t*Math.cos(r)*n]}function Wh(t,e,r){return sp(Math.cos(Et(t)),Math.sin(Et(t)),e,r)}function hg(t){return 16383/Math.max(...yr([],t.max,t.min))}function dg(t){const e=Ge(new Float64Array(16)),r=1/hg(t);return we(e,e,t.min),Le(e,e,[r,r,r]),e}function fg(t,e,r){const n=e/(2*Math.PI),c=function(p){const g=jt/(2*Math.PI);return p/(2*Math.PI)/g}(e);if(!r){const p=Nt(t.center.lat,-85.051129,Io);r=[cl(t.center.lng)*e,ul(p)*e]}const u=Ge(new Float64Array(16));return we(u,u,[r[0],r[1],-n]),Le(u,u,[c,c,c]),Ze(u,u,Et(-t._center.lat)),xe(u,u,Et(-t._center.lng)),u}class lp{constructor(e){const r=this._createGridIndices();this.gridIndexBuffer=e.createIndexBuffer(r,!0),this.gridSegments=or.simpleSegment(0,0,4225,8192);const n=this._createPoleTriangleIndices();this.poleIndexBuffer=e.createIndexBuffer(n,!0),this.poleSegments=or.simpleSegment(0,0,66,64);const c=new Ec;c.emplaceBack(-1,1,1,0,0,0,0),c.emplaceBack(1,1,1,0,0,1,0),c.emplaceBack(1,-1,1,0,0,1,1),c.emplaceBack(-1,-1,1,0,0,0,1);const u=new Vn;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.atmosphereVertexBuffer=e.createVertexBuffer(c,F1.members),this.atmosphereIndexBuffer=e.createIndexBuffer(u),this.atmosphereSegments=or.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(e,r,n){const c=new Ec,u=r/Math.PI/2;c.emplaceBack(0,-u,0,0,0,.5,n?0:1);const p=360/e,g=Math.cos(Et(85)),v=Math.sin(Et(85));for(let A=0;A<=64;A++){const C=A/64,M=sp(g,v,0*(1-(w=C))+p*w,u);c.emplaceBack(M[0],M[1],M[2],0,0,C,n?0:1)}var w;return c}_createPoleTriangleIndices(){const e=new Vn;for(let r=0;r<=64;r++)e.emplaceBack(0,r+1,r+2);return e}static createGridVertices(e){const r=Math.pow(2,e.z),n=(v,w,A)=>v*(1-A)+w*A,[c,u]=ug(e),p=new Ec,g=function(v){const w=Ge(new Float64Array(16)),A=hg(v);var C,M;return Le(w,w,[A,A,A]),we(w,w,((C=[])[0]=-(M=v.min)[0],C[1]=-M[1],C[2]=-M[2],C)),w}(qh(e));p.reserve(4096);for(let v=0;v<65;v++){const w=n(c[0],u[0],v/64),A=ul(w),C=A*r-e.y,M=Math.sin(Et(w)),L=Math.cos(Et(w));for(let B=0;B<65;B++){const G=B/64,q=n(c[1],u[1],G),Q=sp(L,M,q);At(Q,Q,g);const oe=cl(q);p.emplaceBack(Q[0],Q[1],Q[2],oe,A,G,C)}}return p}_createGridIndices(){const e=new Vn,r=(n,c)=>{const u=65*c+n;e.emplaceBack(u+1,u,u+65),e.emplaceBack(u+65,u+65+1,u+1)};for(let n=0;n<64;n++)for(let c=0;c<64;c++)r(c,n);return e}getWirefameBuffer(e){if(!this.wireframeSegments){const r=this._createWireframeGrid();this.wireframeIndexBuffer=e.createIndexBuffer(r),this.wireframeSegments=or.simpleSegment(0,0,4096,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const e=new ma,r=(n,c)=>{const u=65*c+n;e.emplaceBack(u,u+1),e.emplaceBack(u,u+65),e.emplaceBack(u,u+65+1)};for(let n=0;n<64;n++)for(let c=0;c<64;c++)r(c,n);return e}}function wl(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const r=Math.pow(2,-t.z),n=t.x*r,c=(t.x+1)*r,u=t.y*r,p=(t.y+1)*r,g=Zo(n),v=Zo(c),w=Kn(u),A=Kn(p),C=e.project(g,w),M=e.project(v,w),L=e.project(v,A),B=e.project(g,A);let G=Math.min(C.x,M.x,L.x,B.x),q=Math.min(C.y,M.y,L.y,B.y),Q=Math.max(C.x,M.x,L.x,B.x),oe=Math.max(C.y,M.y,L.y,B.y);const ce=r/16;function de(me,ke,Ce,Ye,qe,Ie){const We=(Ce+qe)/2,Qe=(Ye+Ie)/2,Be=e.project(Zo(We),Kn(Qe)),nt=Math.max(0,G-Be.x,q-Be.y,Be.x-Q,Be.y-oe);G=Math.min(G,Be.x),Q=Math.max(Q,Be.x),q=Math.min(q,Be.y),oe=Math.max(oe,Be.y),nt>ce&&(de(me,Be,Ce,Ye,We,Qe),de(Be,ke,We,Qe,qe,Ie))}de(C,M,n,u,c,u),de(M,L,c,u,c,p),de(L,B,c,p,n,p),de(B,C,n,p,n,u),G-=ce,q-=ce,Q+=ce,oe+=ce;const pe=1/Math.max(Q-G,oe-q);return{scale:pe,x:G*pe,y:q*pe,x2:Q*pe,y2:oe*pe,projection:e}}class pg{constructor(e){const r={},n=[];for(const g in e){const v=e[g],w=r[g]={};for(const A in v.glyphs){const C=v.glyphs[+A];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const M=C.metrics.localGlyph?2:1,L={x:0,y:0,w:C.bitmap.width+2*M,h:C.bitmap.height+2*M};n.push(L),w[A]=L}}const{w:c,h:u}=Ff(n),p=new ga({width:c||1,height:u||1});for(const g in e){const v=e[g];for(const w in v.glyphs){const A=v.glyphs[+w];if(!A||A.bitmap.width===0||A.bitmap.height===0)continue;const C=r[g][w],M=A.metrics.localGlyph?2:1;ga.copy(A.bitmap,p,{x:0,y:0},{x:C.x+M,y:C.y+M},A.bitmap)}}this.image=p,this.positions=r}}at("GlyphAtlas",pg);class V1{constructor(e){this.tileID=new ln(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=wl(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,n,c,u){this.status="parsing",this.data=e,this.collisionBoxArray=new gf;const p=new W_(Object.keys(e.layers).sort()),g=new og(this.tileID,this.promoteId);g.bucketLayerIDs=[];const v={},w=new Jf(256,256),A={featureIndex:g,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:n},C=r.familiesBySource[this.source];for(const pe in C){const me=e.layers[pe];if(!me)continue;let ke=!1,Ce=!1;for(const Ie of C[pe])Ie[0].type==="symbol"?ke=!0:Ce=!0;if(this.isSymbolTile===!0&&!ke||this.isSymbolTile===!1&&!Ce)continue;me.version===1&&et(`Vector tile source "${this.source}" layer "${pe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ye=p.encode(pe),qe=[];for(let Ie=0;Ie<me.length;Ie++){const We=me.feature(Ie),Qe=g.getId(We,pe);qe.push({feature:We,id:Qe,index:Ie,sourceLayerIndex:Ye})}for(const Ie of C[pe]){const We=Ie[0];this.isSymbolTile!==void 0&&We.type==="symbol"!==this.isSymbolTile||We.minzoom&&this.zoom<Math.floor(We.minzoom)||We.maxzoom&&this.zoom>=We.maxzoom||We.visibility!=="none"&&(cp(Ie,this.zoom,n),(v[We.id]=We.createBucket({index:g.bucketLayerIDs.length,layers:Ie,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ye,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:n})).populate(qe,A,this.tileID.canonical,this.tileTransform),g.bucketLayerIDs.push(Ie.map(Qe=>Qe.id)))}}let M,L,B,G;w.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Q=ir(A.glyphDependencies,pe=>Object.keys(pe).map(Number));Object.keys(Q).length?c.send("getGlyphs",{uid:this.uid,stacks:Q},(pe,me)=>{M||(M=pe,L=me,de.call(this))},void 0,!1,q):L={};const oe=Object.keys(A.iconDependencies);oe.length?c.send("getImages",{icons:oe,source:this.source,tileID:this.tileID,type:"icons"},(pe,me)=>{M||(M=pe,B=me,de.call(this))},void 0,!1,q):B={};const ce=Object.keys(A.patternDependencies);function de(){if(M)return u(M);if(L&&B&&G){const pe=new pg(L),me=new x_(B,G);for(const ke in v){const Ce=v[ke];Ce instanceof xa?(cp(Ce.layers,this.zoom,n),y1(Ce,L,pe.positions,B,me.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection),Ce.projection=this.projection.name):Ce.hasPattern&&(Ce instanceof kh||Ce instanceof Ih||Ce instanceof Rf)&&(cp(Ce.layers,this.zoom,n),Ce.addFeatures(A,this.tileID.canonical,me.patternPositions,n))}this.status="done",u(null,{buckets:_r(v).filter(ke=>!ke.isEmpty()),featureIndex:g,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pe.image,lineAtlas:w,imageAtlas:me,glyphMap:this.returnDependencies?L:null,iconMap:this.returnDependencies?B:null,glyphPositions:this.returnDependencies?pe.positions:null})}}ce.length?c.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"patterns"},(pe,me)=>{M||(M=pe,G=me,de.call(this))},void 0,!1,q):G={},de.call(this)}}function cp(t,e,r){const n=new It(e);for(const c of t)c.recalculate(n,r)}class mg{constructor(e){this.entries={},this.scheduler=e}request(e,r,n,c){const u=this.entries[e]=this.entries[e]||{callbacks:[]};if(u.result){const[p,g]=u.result;return this.scheduler?this.scheduler.add(()=>{c(p,g)},r):c(p,g),()=>{}}return u.callbacks.push(c),u.cancel||(u.cancel=n((p,g)=>{u.result=[p,g];for(const v of u.callbacks)this.scheduler?this.scheduler.add(()=>{v(p,g)},r):v(p,g);setTimeout(()=>delete this.entries[e],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(p=>p!==c),u.callbacks.length||(u.cancel(),delete this.entries[e]))}}}function _g(t,e,r){const n=JSON.stringify(t.request);return t.data&&(this.deduped.entries[n]={result:[null,t.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{const u=Pa(t.request,(p,g,v,w)=>{p?c(p):g&&c(null,{vectorTile:r?void 0:new ls.VectorTile(new Rc(g)),rawData:g,cacheControl:v,expires:w})});return()=>{u.cancel(),c()}},e)}const N1=Ge(new Float64Array(16));class hs{constructor(e,r){this._tr=e,this._worldSize=r}createInversionMatrix(){return N1}createTileMatrix(e){let r,n,c;const u=e.canonical,p=Ge(new Float64Array(16)),g=this._tr.projection;if(g.isReprojectedInTileSpace){const v=wl(u,g);r=1,n=v.x+e.wrap*v.scale,c=v.y,Le(p,p,[r/v.scale,r/v.scale,this._tr.pixelsPerMeter/this._worldSize])}else r=this._worldSize/this._tr.zoomScale(u.z),n=(u.x+Math.pow(2,u.z)*e.wrap)*r,c=u.y*r;return we(p,p,[n,c,0]),Le(p,p,[r/jt,r/jt,1]),p}pointCoordinate(e,r,n){const c=this._tr.horizonLineFromTop(!1),u=new F(e,Math.max(c,r));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(u,n))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var j1={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Ln(this.parallels,this.constants.parallels))return;const t=Math.sin(Et(this.parallels[0])),e=(t+Math.sin(Et(this.parallels[1])))/2,r=1+t*(2*e-t),n=Math.sqrt(r)/e;this.constants={n:e,c:r,r0:n,parallels:this.parallels}},project(t,e){this.initializeConstants();const r=Et(t-this.center[0]),n=Et(e),{n:c,c:u,r0:p}=this.constants,g=Math.sqrt(u-2*c*Math.sin(n))/c;return{x:g*Math.sin(r*c),y:g*Math.cos(r*c)-p,z:0}},unproject(t,e){this.initializeConstants();const{n:r,c:n,r0:c}=this.constants,u=c+e;let p=Math.atan2(t,Math.abs(u))*Math.sign(u);u*r<0&&(p-=Math.PI*Math.sign(t)*Math.sign(u));const g=Et(this.center[0])*r;p=xr(p,-Math.PI-g,Math.PI-g);const v=Zi(p/r)+this.center[0],w=Math.asin(Nt((n-(t*t+u*u)*r*r)/(2*r),-1,1)),A=Nt(Zi(w),-85.051129,Io);return new Si(v,A)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>ao(1,t)*e,farthestPixelDistance(t){return us(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new hs(t,e)};const Uc=1.340264,Vc=-.081106,Nc=893e-6,jc=.003796,Hh=Math.sqrt(3)/2;var G1={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const r=Math.asin(Hh*Math.sin(e)),n=r*r,c=n*n*n;return{x:.5*(t*Math.cos(r)/(Hh*(Uc+3*Vc*n+c*(7*Nc+9*jc*n)))/Math.PI+.5),y:1-.5*(r*(Uc+Vc*n+c*(Nc+jc*n))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,n=r*r,c=n*n*n;for(let w,A,C,M=0;M<12&&(A=r*(Uc+Vc*n+c*(Nc+jc*n))-e,C=Uc+3*Vc*n+c*(7*Nc+9*jc*n),w=A/C,r=Nt(r-w,-Math.PI/3,Math.PI/3),n=r*r,c=n*n*n,!(Math.abs(w)<1e-12));++M);const u=Hh*t*(Uc+3*Vc*n+c*(7*Nc+9*jc*n))/Math.cos(r),p=Math.asin(Math.sin(r)/Hh),g=Nt(180*u/Math.PI,-180,180),v=Nt(180*p/Math.PI,-85.051129,Io);return new Si(g,v)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>ao(1,t)*e,farthestPixelDistance(t){return us(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new hs(t,e)},$1={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(t,e)=>({x:.5+t/360,y:.5-e/360,z:0}),unproject(t,e){const r=360*(t-.5),n=Nt(360*(.5-e),-85.051129,Io);return new Si(r,n)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>ao(1,t)*e,farthestPixelDistance(t){return us(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new hs(t,e)};const Tl=Math.PI/2;function Xh(t){return Math.tan((Tl+t)/2)}var Z1={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Ln(this.parallels,this.constants.parallels))return;const t=Et(this.parallels[0]),e=Et(this.parallels[1]),r=Math.cos(t),n=t===e?Math.sin(t):Math.log(r/Math.cos(e))/Math.log(Xh(e)/Xh(t)),c=r*Math.pow(Xh(t),n)/n;this.constants={n,f:c,parallels:this.parallels}},project(t,e){this.initializeConstants(),e=Et(e),t=Et(t-this.center[0]);const r=1e-6,{n,f:c}=this.constants;c>0?e<-Tl+r&&(e=-Tl+r):e>Tl-r&&(e=Tl-r);const u=c/Math.pow(Xh(e),n),p=u*Math.sin(n*t),g=c-u*Math.cos(n*t);return{x:.5*(p/Math.PI+.5),y:1-.5*(g/Math.PI+.5),z:0}},unproject(t,e){this.initializeConstants(),t=(2*t-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:r,f:n}=this.constants,c=n-e,u=Math.sign(c),p=Math.sign(r)*Math.sqrt(t*t+c*c);let g=Math.atan2(t,Math.abs(c))*u;c*r<0&&(g-=Math.PI*Math.sign(t)*u);const v=Nt(Zi(g/r)+this.center[0],-180,180),w=Nt(Zi(2*Math.atan(Math.pow(n/p,1/r))-Tl),-85.051129,Io);return new Si(v,w)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>ao(1,t)*e,farthestPixelDistance(t){return us(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new hs(t,e)},q1={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(t,e)=>({x:cl(t),y:ul(e),z:0}),unproject(t,e){const r=Zo(t),n=Kn(e);return new Si(r,n)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>ao(1,t)*e,farthestPixelDistance(t){return us(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new hs(t,e)};const gg=Et(Io);var W1={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(t,e){const r=(e=Et(e))*e,n=r*r;return{x:.5*((t=Et(t))*(.8707-.131979*r+n*(n*(.003971*r-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+r*(.015085+n*(.028874*r-.044475-.005916*n)))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,n=25,c=0,u=r*r;do{u=r*r;const v=u*u;c=(r*(1.007226+u*(.015085+v*(.028874*u-.044475-.005916*v)))-e)/(1.007226+u*(.045255+v*(.259866*u-.311325-.005916*11*v))),r=Nt(r-c,-gg,gg)}while(Math.abs(c)>1e-6&&--n>0);u=r*r;const p=Nt(Zi(t/(.8707+u*(u*(u*u*u*(.003971-.001529*u)-.013791)-.131979))),-180,180),g=Zi(r);return new Si(p,g)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>ao(1,t)*e,farthestPixelDistance(t){return us(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new hs(t,e)};const yg=Et(Io),vg={albers:j1,equalEarth:G1,equirectangular:$1,lambertConformalConic:Z1,mercator:q1,naturalEarth:W1,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=Et(e),t=Et(t);const r=Math.cos(e),n=2/Math.PI,c=Math.acos(r*Math.cos(t/2)),u=Math.sin(c)/c,p=.5*(t*n+2*r*Math.sin(t/2)/u)||0,g=.5*(e+Math.sin(e)/u)||0;return{x:.5*(p/Math.PI+.5),y:1-.5*(g/Math.PI+1),z:0}},unproject(t,e){let r=t=(2*t-.5)*Math.PI,n=e=(2*(1-e)-1)*Math.PI,c=25;const u=1e-6;let p=0,g=0;do{const v=Math.cos(n),w=Math.sin(n),A=2*w*v,C=w*w,M=v*v,L=Math.cos(r/2),B=Math.sin(r/2),G=2*L*B,q=B*B,Q=1-M*L*L,oe=Q?1/Q:0,ce=Q?Math.acos(v*L)*Math.sqrt(1/Q):0,de=.5*(2*ce*v*B+2*r/Math.PI)-t,pe=.5*(ce*w+n)-e,me=.5*oe*(M*q+ce*v*L*C)+1/Math.PI,ke=oe*(G*A/4-ce*w*B),Ce=.125*oe*(A*B-ce*w*M*G),Ye=.5*oe*(C*L+ce*q*v)+.5,qe=ke*Ce-Ye*me;p=(pe*ke-de*Ye)/qe,g=(de*Ce-pe*me)/qe,r=Nt(r-p,-Math.PI,Math.PI),n=Nt(n-g,-yg,yg)}while((Math.abs(p)>u||Math.abs(g)>u)&&--c>0);return new Si(Zi(r),Zi(n))},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>ao(1,t)*e,farthestPixelDistance(t){return us(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new hs(t,e)}};o.ARRAY_TYPE=be,o.AUTH_ERR_MSG=_e,o.Aabb=so,o.Actor=class{constructor(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},Xt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ut()?t:$,this.scheduler=new P1}send(t,e,r,n,c=!1,u){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=u,this.callbacks[p]=r);const g=qi(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:t,hasCallback:!!r,targetMapId:n,mustQueue:c,sourceMapId:this.mapId,data:rs(e,g)},g),{cancel:()=>{r&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(t){const e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const n=this.cancelCallbacks[r];delete this.cancelCallbacks[r],n&&n.cancel()}else if(e.mustQueue||Ut()){const n=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),n&&n.metadata||{type:"message"})}else this.processTask(r,e)}processTask(t,e){if(e.type==="<response>"){const r=this.callbacks[t];delete this.callbacks[t],r&&(e.error?r(Co(e.error)):r(null,Co(e.data)))}else{const r=qi(this.globalScope)?void 0:[],n=e.hasCallback?(u,p)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:u?rs(u):null,data:rs(p,r)},r)}:u=>{},c=Co(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,n);else if(this.parent.getWorkerSource){const u=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,u[0],c.source)[u[1]](c,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=jh,o.Color=ii,o.ColorMode=zo,o.CullFaceMode=lo,o.DEMData=Gh,o.DataConstantProperty=lt,o.DedupedRequest=mg,o.DepthMode=bl,o.EXTENT=jt,o.Elevation=class{getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,r=!0){e==null&&(e=null);const n=this._source();if(!n||t.y<0||t.y>1)return e;const c=n.getSource().maxzoom,u=1<<c,p=Math.floor(t.x),g=t.x-p,v=new ln(c,p,c,Math.floor(g*u),Math.floor(t.y*u)),w=this.findDEMTileFor(v);if(!w||!w.dem)return e;const A=w.dem,C=1<<w.tileID.canonical.z,M=(g*C-w.tileID.canonical.x)*A.dim,L=(t.y*C-w.tileID.canonical.y)*A.dim,B=Math.floor(M),G=Math.floor(L);return(r?this.exaggeration():1)*_i(_i(A.get(B,G),A.get(B,G+1),L-G),_i(A.get(B+1,G),A.get(B+1,G+1),L-G),M-B)}getAtTileOffset(t,e,r){const n=1<<t.canonical.z;return this.getAtPointOrZero(new bh(t.wrap+(t.canonical.x+e/jt)/n,(t.canonical.y+r/jt)/n))}getAtTileOffsetFunc(t,e){return r=>{const n=this.getAtTileOffset(t,r.x,r.y),c=e.upVector(t.canonical,r.x,r.y);return Vi(c,c,n*e.upVectorScale(t.canonical)),c}}getForTilePoints(t,e,r,n){const c=$h.create(this,t,n);return!!c&&(e.forEach(u=>{u[2]=this.exaggeration()*c.getElevationAt(u[0],u[1],r)}),!0)}getMinMaxForTile(t){const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const r=e.dem.tree,n=e.tileID,c=1<<t.canonical.z-n.canonical.z;let u=t.canonical.x/c-n.canonical.x,p=t.canonical.y/c-n.canonical.y,g=0;for(let v=0;v<t.canonical.z-n.canonical.z&&!r.leaves[g];v++){u*=2,p*=2;const w=2*Math.floor(p)+Math.floor(u);g=r.childOffsets[g]+w,u%=1,p%=1}return{min:this.exaggeration()*r.minimums[g],max:this.exaggeration()*r.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=Cs,o.EvaluationParameters=It,o.Event=go,o.Evented=yo,o.Frustum=Ef,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GlobeSharedBuffers=lp,o.GlyphManager=vl,o.ImagePosition=Uf,o.LineAtlas=Jf,o.LngLat=Si,o.LngLatBounds=as,o.LocalGlyphMode=Gf,o.MAX_MERCATOR_LATITUDE=Io,o.MercatorCoordinate=bh,o.ONE_EM=Rr,o.OverscaledTileID=ln,o.Properties=kr,o.RGBAImage=Nn,o.Ray=class{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,r){const n=ui(e,this.dir);if(Math.abs(n)<1e-6)return!1;const c=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1]+(t[2]-this.pos[2])*e[2])/n;return r[0]=this.pos[0]+this.dir[0]*c,r[1]=this.pos[1]+this.dir[1]*c,r[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(t,e,r){if(function(M,L){var B=M[0],G=M[1],q=M[2],Q=L[0],oe=L[1],ce=L[2];return Math.abs(B-Q)<=ye*Math.max(1,Math.abs(B),Math.abs(Q))&&Math.abs(G-oe)<=ye*Math.max(1,Math.abs(G),Math.abs(oe))&&Math.abs(q-ce)<=ye*Math.max(1,Math.abs(q),Math.abs(ce))}(this.pos,t)||e===0)return r[0]=r[1]=r[2]=0,!1;const[n,c,u]=this.dir,p=this.pos[0]-t[0],g=this.pos[1]-t[1],v=this.pos[2]-t[2],w=n*n+c*c+u*u,A=2*(p*n+g*c+v*u),C=A*A-4*w*(p*p+g*g+v*v-e*e);if(C<0){const M=Math.max(-A/2,0),L=p+n*M,B=g+c*M,G=v+u*M,q=Math.hypot(L,B,G);return r[0]=L*e/q,r[1]=B*e/q,r[2]=G*e/q,!1}{const M=(-A-Math.sqrt(C))/(2*w);if(M<0){const L=Math.hypot(p,g,v);return r[0]=p*e/L,r[1]=g*e/L,r[2]=v*e/L,!1}return r[0]=p+n*M,r[1]=g+c*M,r[2]=v+u*M,!0}}},o.RequestManager=class{constructor(t,e,r){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ue,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Me(t))return t;const r=ht(t);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Me(t))return t;const r=ht(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(t,e){if(!Me(t))return t;const r=ht(t);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)}normalizeSpriteURL(t,e,r,n){const c=ht(t);return Me(t)?(c.path=`/styles/v1${c.path}/sprite${e}${r}`,this._makeAPIURL(c,this._customAccessToken||n)):(c.path+=`${e}${r}`,ft(c))}normalizeTileURL(t,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Me(t))return t;const n=ht(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&n.authority!=="raster"&&r===512?"@2x":""}${O.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${D.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${D.TILE_URL_VERSION}${n.path}`);const c=this._customAccessToken||function(u){for(const p of u){const g=p.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(n.params)||D.ACCESS_TOKEN;return D.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,c)}canonicalizeTileURL(t,e){const r=ht(t);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${D.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${D.TILE_URL_VERSION}/`,"")}`;let c=r.params;return e&&(c=c.filter(u=>!u.match(/^access_token=/))),c.length&&(n+=`?${c.join("&")}`),n}canonicalizeTileset(t,e){const r=!!e&&Me(e),n=[];for(const c of t.tiles||[])Pe(c)?n.push(this.canonicalizeTileURL(c,r)):n.push(c);return n}_makeAPIURL(t,e){const r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=ht(D.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,t.protocol==="http"){const c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if(n.path!=="/"&&(t.path=`${n.path}${t.path}`),!D.REQUIRE_ACCESS_TOKEN)return ft(t);if(e=e||D.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter(c=>c.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),ft(t)}},o.ResourceType=Es,o.SegmentVector=or,o.SourceCache=cs,o.StencilMode=tp,o.StructArrayLayout1ui2=mh,o.StructArrayLayout2f1f2i16=uf,o.StructArrayLayout2i4=ol,o.StructArrayLayout2ui4=ma,o.StructArrayLayout3f12=sl,o.StructArrayLayout3ui6=Vn,o.StructArrayLayout4i8=al,o.Texture=Nh,o.Tile=op,o.Transitionable=an,o.Uniform1f=vh,o.Uniform1i=class extends jo{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},o.Uniform2f=class extends jo{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},o.Uniform3f=class extends jo{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},o.Uniform4f=Lm,o.UniformColor=Rm,o.UniformMatrix2f=class extends jo{constructor(t,e){super(t,e),this.current=F0}set(t){for(let e=0;e<4;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}},o.UniformMatrix3f=class extends jo{constructor(t,e){super(t,e),this.current=O0}set(t){for(let e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},o.UniformMatrix4f=class extends jo{constructor(t,e){super(t,e),this.current=B0}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},o.UnwrappedTileID=Qf,o.ValidationError=it,o.VectorTileWorkerSource=class extends yo{constructor(t,e,r,n,c){super(),this.actor=t,this.layerIndex=e,this.availableImages=r,this.loadVectorData=c||_g,this.loading={},this.loaded={},this.deduped=new mg(t.scheduler),this.isSpriteLoaded=n,this.scheduler=t.scheduler}loadTile(t,e){const r=t.uid,n=t&&t.request,c=n&&n.collectResourceTiming,u=this.loading[r]=new V1(t);u.abort=this.loadVectorData(t,(p,g)=>{const v=!this.loading[r];if(delete this.loading[r],v||p||!g)return u.status="done",v||(this.loaded[r]=u),e(p);const w=g.rawData,A={};g.expires&&(A.expires=g.expires),g.cacheControl&&(A.cacheControl=g.cacheControl),u.vectorTile=g.vectorTile||new ls.VectorTile(new Rc(w));const C=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(M,L)=>{if(M||!L)return e(M);const B={};if(c){const G=Z_(n);G.length>0&&(B.resourceTiming=JSON.parse(JSON.stringify(G)))}e(null,Gt({rawTileData:w.slice(0)},L,A,B))})};this.isSpriteLoaded?C():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(C,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):C()}),this.loaded=this.loaded||{},this.loaded[r]=u})}reloadTile(t,e){const r=this.loaded,n=t.uid,c=this;if(r&&r[n]){const u=r[n];u.showCollisionBoxes=t.showCollisionBoxes,u.enableTerrain=!!t.enableTerrain,u.projection=t.projection;const p=(g,v)=>{const w=u.reloadCallback;w&&(delete u.reloadCallback,u.parse(u.vectorTile,c.layerIndex,this.availableImages,c.actor,w)),e(g,v)};u.status==="parsing"?u.reloadCallback=p:u.status==="done"&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}}abortTile(t,e){const r=t.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),e()}removeTile(t,e){const r=this.loaded,n=t.uid;r&&r[n]&&delete r[n],e()}},o.WritingMode=jn,o.ZoomHistory=h,o.add=wt,o.addDynamicAttributes=Wf,o.adjoint=function(t,e){var r=e[0],n=e[1],c=e[2],u=e[3],p=e[4],g=e[5],v=e[6],w=e[7],A=e[8];return t[0]=p*A-g*w,t[1]=c*w-n*A,t[2]=n*g-c*p,t[3]=g*v-u*A,t[4]=r*A-c*v,t[5]=c*u-r*g,t[6]=u*w-p*v,t[7]=n*v-r*w,t[8]=r*p-n*u,t},o.asyncAll=Fr,o.bezier=$r,o.bindAll=Xt,o.boundsAttributes=np,o.bufferConvexPolygon=function(t,e){const r=[];for(let n=0;n<t.length;n++){const c=xr(n-1,-1,t.length-1),u=xr(n+1,-1,t.length-1),p=t[n],g=t[u],v=t[c].sub(p).unit(),w=g.sub(p).unit(),A=w.angleWithSep(v.x,v.y),C=v.add(w).unit().mult(-1*e/Math.sin(A/2));r.push(p.add(C))}return r},o.cacheEntryPossiblyAdded=function(t){Ss++,Ss>Wl&&(t.getActor().send("enforceCacheSizeLimit",Cu),Ss=0)},o.calculateGlobeMatrix=fg,o.calculateGlobeMercatorMatrix=function(t){const e=t.worldSize,r=Nt(t.center.lat,-85.051129,Io),n=new F(cl(t.center.lng)*e,ul(r)*e),c=ao(1,t.center.lat)*e,u=t.pixelsPerMeter,p=e/(c/t.pixelsPerMeter),g=Ge(new Float64Array(16));return we(g,g,[n.x,n.y,0]),Le(g,g,[p,p,u]),g},o.clamp=Nt,o.clearTileCache=function(t){const e=$.caches.delete(Yi);t&&e.catch(t).then(()=>t())},o.clipLine=P_,o.clone=function(t){var e=new be(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},o.clone$1=Ne,o.collisionCircleLayout=$x,o.config=D,o.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},o.create=function(){var t=new be(16);return be!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},o.create$1=Ue,o.createExpression=Ka,o.createLayout=Hi,o.createStyleLayer=function(t){return t.type==="custom"?new C1(t):new I1[t.type](t)},o.cross=Di,o.degToRad=Et,o.div=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},o.dot=ui,o.ease=pn,o.easeCubicInOut=Dr,o.emitValidationErrors=uh,o.endsWith=Ni,o.enforceCacheSizeLimit=function(t){ka(),nn&&nn.then(e=>{e.keys().then(r=>{for(let n=0;n<r.length-t;n++)e.delete(r[n])})})},o.evaluateSizeForFeature=zh,o.evaluateSizeForZoom=ml,o.evaluateVariableOffset=O_,o.evented=Wr,o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},o.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},o.exported=ji,o.exported$1=O,o.extend=Gt,o.extend$1=vo,o.filterObject=Lr,o.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},o.fromQuat=function(t,e){var r=e[0],n=e[1],c=e[2],u=e[3],p=r+r,g=n+n,v=c+c,w=r*p,A=n*p,C=n*g,M=c*p,L=c*g,B=c*v,G=u*p,q=u*g,Q=u*v;return t[0]=1-C-B,t[1]=A+Q,t[2]=M-q,t[3]=0,t[4]=A-Q,t[5]=1-w-B,t[6]=L+G,t[7]=0,t[8]=M+q,t[9]=L-G,t[10]=1-w-C,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return vr[e]},o.getAABBPointSquareDist=function(t,e,r){let n=0;for(let c=0;c<2;++c){const u=r?r[c]:0;t[c]>u&&(n+=(t[c]-u)*(t[c]-u)),e[c]<u&&(n+=(u-e[c])*(u-e[c]))}return n},o.getAnchorAlignment=jf,o.getAnchorJustification=Zf,o.getBounds=function(t){let e=1/0,r=1/0,n=-1/0,c=-1/0;for(const u of t)e=Math.min(e,u.x),r=Math.min(r,u.y),n=Math.max(n,u.x),c=Math.max(c,u.y);return{min:new F(e,r),max:new F(n,c)}},o.getColumn=function(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]},o.getImage=Iu,o.getJSON=function(t,e){return Rn(Gt(t,{type:"json"}),e)},o.getMapSessionAPI=mn,o.getPerformanceMeasurement=Z_,o.getProjection=function(t){const e=vg[t.name];if(!e)throw new Error(`Invalid projection name: ${t.name}`);return e.conic?function(r,n){if(n.parallels&&Math.abs(n.parallels[0]+n.parallels[1])<.01){let c=function(u){const p=Math.max(.01,Math.cos(Et(u))),g=1/(2*Math.max(Math.PI*p,1/p));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(v,w){const A=Et(v)*p,C=Math.sin(Et(w))/p;return{x:A*g+.5,y:-C*g+.5,z:0}},unproject(v,w){const A=-(w-.5)/g,C=Nt(Zi((v-.5)/g)/p,-180,180),M=Math.asin(Nt(A*p,-1,1)),L=Nt(Zi(M),-85.051129,Io);return new Si(C,L)}}}(n.parallels[0]);if(n.name==="lambertConformalConic"){const{project:u,unproject:p}=vg.mercator;c={wrap:!0,supportsWorldCopies:!0,project:u,unproject:p}}return Gt({},r,n,c)}return Gt({},r,n)}(e,t):e},o.getRTLTextPluginStatus=bn,o.getReferrer=Xl,o.getTilePoint=function(t,{x:e,y:r},n=0){return new F(((e-n)*t.scale-t.x)*jt,(r*t.scale-t.y)*jt)},o.getTileVec3=function(t,e,r=0){return st(((e.x-r)*t.scale-t.x)*jt,(e.y*t.scale-t.y)*jt,Vm(e.z,e.y))},o.getVideo=function(t,e){const r=$.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let n=0;n<t.length;n++){const c=$.document.createElement("source");Mu(t[n])||(r.crossOrigin="Anonymous"),c.src=t[n],r.appendChild(c)}return{cancel:()=>{}}},o.globeBuffersForTileMesh=function(t,e,r,n){const c=t.context,u=t.transform;let p=e.globeGridBuffer,g=e.globePoleBuffer;if(!p){const v=lp.createGridVertices(r.canonical);p=e.globeGridBuffer=c.createVertexBuffer(v,cg,!1)}if(!g){const v=lp.createPoleTriangleVertices(n,u.tileSize*n,r.canonical.y===0);g=e.globePoleBuffer=c.createVertexBuffer(v,cg,!1)}return[p,g]},o.globeDenormalizeECEF=dg,o.globeMatrixForTile=function(t,e){const r=dg(qh(t)),n=((c=new Float64Array(16))[0]=(u=e)[0],c[1]=u[1],c[2]=u[2],c[3]=u[3],c[4]=u[4],c[5]=u[5],c[6]=u[6],c[7]=u[7],c[8]=u[8],c[9]=u[9],c[10]=u[10],c[11]=u[11],c[12]=u[12],c[13]=u[13],c[14]=u[14],c[15]=u[15],c);var c,u;return Se(n,n,r),n},o.globePoleMatrixForTile=function(t,e,r){const n=Ge(new Float64Array(16)),c=Math.pow(2,t.z),u=(t.x-c/2)/c*Math.PI*2,p=r.point,g=r.worldSize/(r.tileSize*c);return we(n,n,[p.x,p.y,-r.worldSize/Math.PI/2]),Le(n,n,[g,g,g]),Ze(n,n,Et(-r._center.lat)),xe(n,n,Et(-r._center.lng)),xe(n,n,u),e&&Le(n,n,[1,-1,1]),n},o.globeTileBounds=qh,o.globeToMercatorTransition=function(t){return Mr(5,6,t)},o.identity=Ge,o.identity$1=$n,o.invert=function(t,e){var r=e[0],n=e[1],c=e[2],u=e[3],p=e[4],g=e[5],v=e[6],w=e[7],A=e[8],C=e[9],M=e[10],L=e[11],B=e[12],G=e[13],q=e[14],Q=e[15],oe=r*g-n*p,ce=r*v-c*p,de=r*w-u*p,pe=n*v-c*g,me=n*w-u*g,ke=c*w-u*v,Ce=A*G-C*B,Ye=A*q-M*B,qe=A*Q-L*B,Ie=C*q-M*G,We=C*Q-L*G,Qe=M*Q-L*q,Be=oe*Qe-ce*We+de*Ie+pe*qe-me*Ye+ke*Ce;return Be?(t[0]=(g*Qe-v*We+w*Ie)*(Be=1/Be),t[1]=(c*We-n*Qe-u*Ie)*Be,t[2]=(G*ke-q*me+Q*pe)*Be,t[3]=(M*me-C*ke-L*pe)*Be,t[4]=(v*qe-p*Qe-w*Ye)*Be,t[5]=(r*Qe-c*qe+u*Ye)*Be,t[6]=(q*de-B*ke-Q*ce)*Be,t[7]=(A*ke-M*de+L*ce)*Be,t[8]=(p*We-g*qe+w*Ce)*Be,t[9]=(n*qe-r*We-u*Ce)*Be,t[10]=(B*me-G*de+Q*oe)*Be,t[11]=(C*de-A*me-L*oe)*Be,t[12]=(g*Ye-p*Ie-v*Ce)*Be,t[13]=(r*Ie-n*Ye+c*Ce)*Be,t[14]=(G*ce-B*pe-q*oe)*Be,t[15]=(A*pe-C*ce+M*oe)*Be,t):null},o.isMapAuthenticated=function(t){return _n.has(t)},o.isMapboxURL=Me,o.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!qi(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=Kn,o.len=tn,o.length=ot,o.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},o.loadVectorTile=_g,o.makeRequest=Rn,o.mercatorXfromLng=cl,o.mercatorYfromLat=ul,o.mercatorZfromAltitude=ao,o.mul=Se,o.mul$1=Gn,o.multiply=function(t,e,r){var n=e[0],c=e[1],u=e[2],p=e[3],g=e[4],v=e[5],w=e[6],A=e[7],C=e[8],M=r[0],L=r[1],B=r[2],G=r[3],q=r[4],Q=r[5],oe=r[6],ce=r[7],de=r[8];return t[0]=M*n+L*p+B*w,t[1]=M*c+L*g+B*A,t[2]=M*u+L*v+B*C,t[3]=G*n+q*p+Q*w,t[4]=G*c+q*g+Q*A,t[5]=G*u+q*v+Q*C,t[6]=oe*n+ce*p+de*w,t[7]=oe*c+ce*g+de*A,t[8]=oe*u+ce*v+de*C,t},o.multiply$1=S,o.multiply$2=vi,o.nextPowerOfTwo=xt,o.normalize=kt,o.normalize$1=function(t,e){var r=e[0],n=e[1],c=e[2],u=e[3],p=r*r+n*n+c*c+u*u;return p>0&&(p=1/Math.sqrt(p)),t[0]=r*p,t[1]=n*p,t[2]=c*p,t[3]=u*p,t},o.number=_i,o.ortho=function(t,e,r,n,c,u,p){var g=1/(e-r),v=1/(n-c),w=1/(u-p);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*v,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+r)*g,t[13]=(c+n)*v,t[14]=(p+u)*w,t[15]=1,t},o.pbf=Rc,o.perspective=function(t,e,r,n,c){var u,p=1/Math.tan(e/2);return t[0]=p/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=(c+n)*(u=1/(n-c)),t[14]=2*c*n*u):(t[10]=-1,t[14]=-2*n),t},o.pick=function(t,e){const r={};for(let n=0;n<e.length;n++){const c=e[n];c in t&&(r[c]=t[c])}return r},o.plugin=Qt,o.pointGeometry=F,o.polygonIntersectsBox=qm,o.polygonIntersectsPolygon=jm,o.polygonizeBounds=function(t,e,r=0,n=!0){const c=new F(r,r),u=t.sub(c),p=e.add(c),g=[u,new F(p.x,u.y),p,new F(u.x,p.y)];return n&&g.push(u),g},o.posAttributes=B1,o.postMapLoadEvent=gi,o.postTurnstileEvent=mi,o.potpack=Ff,o.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.radToDeg=Zi,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(t){return t({pluginStatus:St,pluginURL:Vt}),Wr.on("pluginStateChange",t),t},o.removeAuthState=function(t){_n.delete(t)},o.renderColorRamp=Mf,o.rotateX=Ze,o.rotateX$1=Dn,o.rotateY=xe,o.rotateZ=function(t,e,r){var n=Math.sin(r),c=Math.cos(r),u=e[0],p=e[1],g=e[2],v=e[3],w=e[4],A=e[5],C=e[6],M=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*c+w*n,t[1]=p*c+A*n,t[2]=g*c+C*n,t[3]=v*c+M*n,t[4]=w*c-u*n,t[5]=A*c-p*n,t[6]=C*c-g*n,t[7]=M*c-v*n,t},o.rotateZ$1=function(t,e,r){r*=.5;var n=e[0],c=e[1],u=e[2],p=e[3],g=Math.sin(r),v=Math.cos(r);return t[0]=n*v+c*g,t[1]=c*v-n*g,t[2]=u*v+p*g,t[3]=p*v-u*g,t},o.scale=Le,o.scale$1=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},o.scale$2=Vi,o.scaleAndAdd=Dt,o.setCacheLimits=function(t,e){Cu=t,Wl=e},o.setColumn=function(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},o.setRTLTextPlugin=function(t,e,r=!1){if(St===_t||St===Mt||St===yi)throw new Error("setRTLTextPlugin cannot be called multiple times.");Vt=ji.resolveURL(t),St=_t,Mi=e,ur(),r||Un()},o.smoothstep=Mr,o.spec=Ee,o.storeAuthState=function(t,e){e?_n.add(t):_n.delete(t)},o.sub=yr,o.subtract=ai,o.symbolSize=Zx,o.tileAABB=function(t,e,r,n,c,u,p,g,v){if(v.name==="globe"){const L=qh(new Qf(u,new jh(r,n,c)).canonical).getCorners(),B=Number.MAX_VALUE,G=[-B,-B,-B],q=[B,B,B],Q=fg(t,e);for(let oe=0;oe<L.length;oe++)At(L[oe],L[oe],Q),A=q,C=L[oe],(w=q)[0]=Math.min(A[0],C[0]),w[1]=Math.min(A[1],C[1]),w[2]=Math.min(A[2],C[2]),Ft(G,G,L[oe]);return new so(q,G)}var w,A,C;const M=wl({z:r,x:n,y:c},v);return new so([(u+M.x/M.scale)*e,e*(M.y/M.scale),p],[(u+M.x2/M.scale)*e,e*(M.y2/M.scale),g])},o.tileTransform=wl,o.transformMat3=function(t,e,r){var n=e[0],c=e[1],u=e[2];return t[0]=n*r[0]+c*r[3]+u*r[6],t[1]=n*r[1]+c*r[4]+u*r[7],t[2]=n*r[2]+c*r[5]+u*r[8],t},o.transformMat4=At,o.transformMat4$1=mr,o.transformQuat=hi,o.translate=we,o.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},o.triggerPluginCompletionEvent=Bi,o.uniqueId=He,o.validateCustomStyleLayer=function(t){const e=[],r=t.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFog=nf,o.validateLight=ha,o.validateStyle=ua,o.values=_r,o.vectorTile=ls,o.version=N,o.warnOnce=et,o.window=$,o.wrap=xr}),T(["./shared"],function(o){function N(J){const D=typeof J;if(D==="number"||D==="boolean"||D==="string"||J==null)return JSON.stringify(J);if(Array.isArray(J)){let ee="[";for(const le of J)ee+=`${N(le)},`;return`${ee}]`}const O=Object.keys(J).sort();let H="{";for(let ee=0;ee<O.length;ee++)H+=`${JSON.stringify(O[ee])}:${N(J[O[ee]])},`;return`${H}}`}function U(J){let D="";for(const O of o.refProperties)D+=`/${N(J[O])}`;return D}class V{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,O){for(const ee of D)this._layerConfigs[ee.id]=ee,(this._layers[ee.id]=o.createStyleLayer(ee)).compileFilter(),this.keyCache[ee.id]&&delete this.keyCache[ee.id];for(const ee of O)delete this.keyCache[ee],delete this._layerConfigs[ee],delete this._layers[ee];this.familiesBySource={};const H=function(ee,le){const he={};for(let ue=0;ue<ee.length;ue++){const _e=le&&le[ee[ue].id]||U(ee[ue]);le&&(le[ee[ue].id]=_e);let Me=he[_e];Me||(Me=he[_e]=[]),Me.push(ee[ue])}const fe=[];for(const ue in he)fe.push(he[ue]);return fe}(o.values(this._layerConfigs),this.keyCache);for(const ee of H){const le=ee.map(Pe=>this._layers[Pe.id]),he=le[0];if(he.visibility==="none")continue;const fe=he.source||"";let ue=this.familiesBySource[fe];ue||(ue=this.familiesBySource[fe]={});const _e=he.sourceLayer||"_geojsonTileLayer";let Me=ue[_e];Me||(Me=ue[_e]=[]),Me.push(le)}}}const{ImageBitmap:F}=o.window;class Y{loadTile(D,O){const{uid:H,encoding:ee,rawImageData:le,padding:he,buildQuadTree:fe}=D,ue=F&&le instanceof F?this.getImageData(le,he):le;O(null,new o.DEMData(H,ue,ee,he<1,fe))}getImageData(D,O){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(D.width,D.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=D.width,this.offscreenCanvas.height=D.height,this.offscreenCanvasContext.drawImage(D,0,0,D.width,D.height);const H=this.offscreenCanvasContext.getImageData(-O,-O,D.width+2*O,D.height+2*O);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:H.width,height:H.height},H.data)}}var $=function J(D,O){var H,ee=D&&D.type;if(ee==="FeatureCollection")for(H=0;H<D.features.length;H++)J(D.features[H],O);else if(ee==="GeometryCollection")for(H=0;H<D.geometries.length;H++)J(D.geometries[H],O);else if(ee==="Feature")J(D.geometry,O);else if(ee==="Polygon")ye(D.coordinates,O);else if(ee==="MultiPolygon")for(H=0;H<D.coordinates.length;H++)ye(D.coordinates[H],O);return D};function ye(J,D){if(J.length!==0){be(J[0],D);for(var O=1;O<J.length;O++)be(J[O],!D)}}function be(J,D){for(var O=0,H=0,ee=0,le=J.length,he=le-1;ee<le;he=ee++){var fe=(J[ee][0]-J[he][0])*(J[he][1]+J[ee][1]),ue=O+fe;H+=Math.abs(O)>=Math.abs(fe)?O-ue+fe:fe-ue+O,O=ue}O+H>=0!=!!D&&J.reverse()}const Ue=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ge{constructor(D){this._feature=D,this.extent=o.EXTENT,this.type=D.type,this.properties=D.tags,"id"in D&&!isNaN(D.id)&&(this.id=parseInt(D.id,10))}loadGeometry(){if(this._feature.type===1){const D=[];for(const O of this._feature.geometry)D.push([new o.pointGeometry(O[0],O[1])]);return D}{const D=[];for(const O of this._feature.geometry){const H=[];for(const ee of O)H.push(new o.pointGeometry(ee[0],ee[1]));D.push(H)}return D}}toGeoJSON(D,O,H){return Ue.call(this,D,O,H)}}class S{constructor(D){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=D.length,this._features=D}feature(D){return new Ge(this._features[D])}}var we=o.vectorTile.VectorTileFeature,Le=Ze;function Ze(J,D){this.options=D||{},this.features=J,this.length=J.length}function xe(J,D){this.id=typeof J.id=="number"?J.id:void 0,this.type=J.type,this.rawGeometry=J.type===1?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=D||4096}Ze.prototype.feature=function(J){return new xe(this.features[J],this.options.extent)},xe.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var D=0;D<J.length;D++){for(var O=J[D],H=[],ee=0;ee<O.length;ee++)H.push(new o.pointGeometry(O[ee][0],O[ee][1]));this.geometry.push(H)}return this.geometry},xe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,D=1/0,O=-1/0,H=1/0,ee=-1/0,le=0;le<J.length;le++)for(var he=J[le],fe=0;fe<he.length;fe++){var ue=he[fe];D=Math.min(D,ue.x),O=Math.max(O,ue.x),H=Math.min(H,ue.y),ee=Math.max(ee,ue.y)}return[D,H,O,ee]},xe.prototype.toGeoJSON=we.prototype.toGeoJSON;var Se=Je,Re=Le;function Je(J){var D=new o.pbf;return function(O,H){for(var ee in O.layers)H.writeMessage(3,ot,O.layers[ee])}(J,D),D.finish()}function ot(J,D){var O;D.writeVarintField(15,J.version||1),D.writeStringField(1,J.name||""),D.writeVarintField(5,J.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(O=0;O<J.length;O++)H.feature=J.feature(O),D.writeMessage(2,st,H);var ee=H.keys;for(O=0;O<ee.length;O++)D.writeStringField(3,ee[O]);var le=H.values;for(O=0;O<le.length;O++)D.writeMessage(4,Vi,le[O])}function st(J,D){var O=J.feature;O.id!==void 0&&D.writeVarintField(1,O.id),D.writeMessage(2,wt,J),D.writeVarintField(3,O.type),D.writeMessage(4,Ft,O)}function wt(J,D){var O=J.feature,H=J.keys,ee=J.values,le=J.keycache,he=J.valuecache;for(var fe in O.properties){var ue=O.properties[fe],_e=le[fe];if(ue!==null){_e===void 0&&(H.push(fe),le[fe]=_e=H.length-1),D.writeVarint(_e);var Me=typeof ue;Me!=="string"&&Me!=="boolean"&&Me!=="number"&&(ue=JSON.stringify(ue));var Pe=Me+":"+ue,Fe=he[Pe];Fe===void 0&&(ee.push(ue),he[Pe]=Fe=ee.length-1),D.writeVarint(Fe)}}}function ai(J,D){return(D<<3)+(7&J)}function vi(J){return J<<1^J>>31}function Ft(J,D){for(var O=J.loadGeometry(),H=J.type,ee=0,le=0,he=O.length,fe=0;fe<he;fe++){var ue=O[fe],_e=1;H===1&&(_e=ue.length),D.writeVarint(ai(1,_e));for(var Me=H===3?ue.length-1:ue.length,Pe=0;Pe<Me;Pe++){Pe===1&&H!==1&&D.writeVarint(ai(2,Me-1));var Fe=ue[Pe].x-ee,ht=ue[Pe].y-le;D.writeVarint(vi(Fe)),D.writeVarint(vi(ht)),ee+=Fe,le+=ht}H===3&&D.writeVarint(ai(7,1))}}function Vi(J,D){var O=typeof J;O==="string"?D.writeStringField(1,J):O==="boolean"?D.writeBooleanField(7,J):O==="number"&&(J%1!=0?D.writeDoubleField(3,J):J<0?D.writeSVarintField(6,J):D.writeVarintField(5,J))}function Dt(J,D,O,H,ee,le){if(ee-H<=O)return;const he=H+ee>>1;kt(J,D,he,H,ee,le%2),Dt(J,D,O,H,he-1,le+1),Dt(J,D,O,he+1,ee,le+1)}function kt(J,D,O,H,ee,le){for(;ee>H;){if(ee-H>600){const _e=ee-H+1,Me=O-H+1,Pe=Math.log(_e),Fe=.5*Math.exp(2*Pe/3),ht=.5*Math.sqrt(Pe*Fe*(_e-Fe)/_e)*(Me-_e/2<0?-1:1);kt(J,D,O,Math.max(H,Math.floor(O-Me*Fe/_e+ht)),Math.min(ee,Math.floor(O+(_e-Me)*Fe/_e+ht)),le)}const he=D[2*O+le];let fe=H,ue=ee;for(ui(J,D,H,O),D[2*ee+le]>he&&ui(J,D,H,ee);fe<ue;){for(ui(J,D,fe,ue),fe++,ue--;D[2*fe+le]<he;)fe++;for(;D[2*ue+le]>he;)ue--}D[2*H+le]===he?ui(J,D,H,ue):(ue++,ui(J,D,ue,ee)),ue<=O&&(H=ue+1),O<=ue&&(ee=ue-1)}}function ui(J,D,O,H){Di(J,O,H),Di(D,2*O,2*H),Di(D,2*O+1,2*H+1)}function Di(J,D,O){const H=J[D];J[D]=J[O],J[O]=H}function At(J,D,O,H){const ee=J-O,le=D-H;return ee*ee+le*le}Se.fromVectorTileJs=Je,Se.fromGeojsonVt=function(J,D){D=D||{};var O={};for(var H in J)O[H]=new Le(J[H].features,D),O[H].name=H,O[H].version=D.version,O[H].extent=D.extent;return Je({layers:O})},Se.GeoJSONWrapper=Re;const hi=J=>J[0],cr=J=>J[1];class yr{constructor(D,O=hi,H=cr,ee=64,le=Float64Array){this.nodeSize=ee,this.points=D;const he=D.length<65536?Uint16Array:Uint32Array,fe=this.ids=new he(D.length),ue=this.coords=new le(2*D.length);for(let _e=0;_e<D.length;_e++)fe[_e]=_e,ue[2*_e]=O(D[_e]),ue[2*_e+1]=H(D[_e]);Dt(fe,ue,ee,0,fe.length-1,0)}range(D,O,H,ee){return function(le,he,fe,ue,_e,Me,Pe){const Fe=[0,le.length-1,0],ht=[];let ft,pt;for(;Fe.length;){const mt=Fe.pop(),Lt=Fe.pop(),mi=Fe.pop();if(Lt-mi<=Pe){for(let Ci=mi;Ci<=Lt;Ci++)ft=he[2*Ci],pt=he[2*Ci+1],ft>=fe&&ft<=_e&&pt>=ue&&pt<=Me&&ht.push(le[Ci]);continue}const bi=Math.floor((mi+Lt)/2);ft=he[2*bi],pt=he[2*bi+1],ft>=fe&&ft<=_e&&pt>=ue&&pt<=Me&&ht.push(le[bi]);const gi=(mt+1)%2;(mt===0?fe<=ft:ue<=pt)&&(Fe.push(mi),Fe.push(bi-1),Fe.push(gi)),(mt===0?_e>=ft:Me>=pt)&&(Fe.push(bi+1),Fe.push(Lt),Fe.push(gi))}return ht}(this.ids,this.coords,D,O,H,ee,this.nodeSize)}within(D,O,H){return function(ee,le,he,fe,ue,_e){const Me=[0,ee.length-1,0],Pe=[],Fe=ue*ue;for(;Me.length;){const ht=Me.pop(),ft=Me.pop(),pt=Me.pop();if(ft-pt<=_e){for(let gi=pt;gi<=ft;gi++)At(le[2*gi],le[2*gi+1],he,fe)<=Fe&&Pe.push(ee[gi]);continue}const mt=Math.floor((pt+ft)/2),Lt=le[2*mt],mi=le[2*mt+1];At(Lt,mi,he,fe)<=Fe&&Pe.push(ee[mt]);const bi=(ht+1)%2;(ht===0?he-ue<=Lt:fe-ue<=mi)&&(Me.push(pt),Me.push(mt-1),Me.push(bi)),(ht===0?he+ue>=Lt:fe+ue>=mi)&&(Me.push(mt+1),Me.push(ft),Me.push(bi))}return Pe}(this.ids,this.coords,D,O,H,this.nodeSize)}}const Gn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:J=>J},tn=Math.fround||(mr=new Float32Array(1),J=>(mr[0]=+J,mr[0]));var mr;class Pn{constructor(D){this.options=vr(Object.create(Gn),D),this.trees=new Array(this.options.maxZoom+1)}load(D){const{log:O,minZoom:H,maxZoom:ee,nodeSize:le}=this.options;O&&console.time("total time");const he=`prepare ${D.length} points`;O&&console.time(he),this.points=D;let fe=[];for(let ue=0;ue<D.length;ue++)D[ue].geometry&&fe.push(Dn(D[ue],ue));this.trees[ee+1]=new yr(fe,Dr,$r,le,Float32Array),O&&console.timeEnd(he);for(let ue=ee;ue>=H;ue--){const _e=+Date.now();fe=this._cluster(fe,ue),this.trees[ue]=new yr(fe,Dr,$r,le,Float32Array),O&&console.log("z%d: %d clusters in %dms",ue,fe.length,+Date.now()-_e)}return O&&console.timeEnd("total time"),this}getClusters(D,O){let H=((D[0]+180)%360+360)%360-180;const ee=Math.max(-90,Math.min(90,D[1]));let le=D[2]===180?180:((D[2]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)H=-180,le=180;else if(H>le){const Me=this.getClusters([H,ee,180,he],O),Pe=this.getClusters([-180,ee,le,he],O);return Me.concat(Pe)}const fe=this.trees[this._limitZoom(O)],ue=fe.range(Or(H),Et(he),Or(le),Et(ee)),_e=[];for(const Me of ue){const Pe=fe.points[Me];_e.push(Pe.numPoints?Ln(Pe):this.points[Pe.index])}return _e}getChildren(D){const O=this._getOriginId(D),H=this._getOriginZoom(D),ee="No cluster with the specified id.",le=this.trees[H];if(!le)throw new Error(ee);const he=le.points[O];if(!he)throw new Error(ee);const fe=this.options.radius/(this.options.extent*Math.pow(2,H-1)),ue=le.within(he.x,he.y,fe),_e=[];for(const Me of ue){const Pe=le.points[Me];Pe.parentId===D&&_e.push(Pe.numPoints?Ln(Pe):this.points[Pe.index])}if(_e.length===0)throw new Error(ee);return _e}getLeaves(D,O,H){const ee=[];return this._appendLeaves(ee,D,O=O||10,H=H||0,0),ee}getTile(D,O,H){const ee=this.trees[this._limitZoom(D)],le=Math.pow(2,D),{extent:he,radius:fe}=this.options,ue=fe/he,_e=(H-ue)/le,Me=(H+1+ue)/le,Pe={features:[]};return this._addTileFeatures(ee.range((O-ue)/le,_e,(O+1+ue)/le,Me),ee.points,O,H,le,Pe),O===0&&this._addTileFeatures(ee.range(1-ue/le,_e,1,Me),ee.points,le,H,le,Pe),O===le-1&&this._addTileFeatures(ee.range(0,_e,ue/le,Me),ee.points,-1,H,le,Pe),Pe.features.length?Pe:null}getClusterExpansionZoom(D){let O=this._getOriginZoom(D)-1;for(;O<=this.options.maxZoom;){const H=this.getChildren(D);if(O++,H.length!==1)break;D=H[0].properties.cluster_id}return O}_appendLeaves(D,O,H,ee,le){const he=this.getChildren(O);for(const fe of he){const ue=fe.properties;if(ue&&ue.cluster?le+ue.point_count<=ee?le+=ue.point_count:le=this._appendLeaves(D,ue.cluster_id,H,ee,le):le<ee?le++:D.push(fe),D.length===H)break}return le}_addTileFeatures(D,O,H,ee,le,he){for(const fe of D){const ue=O[fe],_e=ue.numPoints;let Me,Pe,Fe;if(_e)Me=tr(ue),Pe=ue.x,Fe=ue.y;else{const pt=this.points[ue.index];Me=pt.properties,Pe=Or(pt.geometry.coordinates[0]),Fe=Et(pt.geometry.coordinates[1])}const ht={type:1,geometry:[[Math.round(this.options.extent*(Pe*le-H)),Math.round(this.options.extent*(Fe*le-ee))]],tags:Me};let ft;_e?ft=ue.id:this.options.generateId?ft=ue.index:this.points[ue.index].id&&(ft=this.points[ue.index].id),ft!==void 0&&(ht.id=ft),he.features.push(ht)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(+D,this.options.maxZoom+1))}_cluster(D,O){const H=[],{radius:ee,extent:le,reduce:he,minPoints:fe}=this.options,ue=ee/(le*Math.pow(2,O));for(let _e=0;_e<D.length;_e++){const Me=D[_e];if(Me.zoom<=O)continue;Me.zoom=O;const Pe=this.trees[O+1],Fe=Pe.within(Me.x,Me.y,ue),ht=Me.numPoints||1;let ft=ht;for(const pt of Fe){const mt=Pe.points[pt];mt.zoom>O&&(ft+=mt.numPoints||1)}if(ft>ht&&ft>=fe){let pt=Me.x*ht,mt=Me.y*ht,Lt=he&&ht>1?this._map(Me,!0):null;const mi=(_e<<5)+(O+1)+this.points.length;for(const bi of Fe){const gi=Pe.points[bi];if(gi.zoom<=O)continue;gi.zoom=O;const Ci=gi.numPoints||1;pt+=gi.x*Ci,mt+=gi.y*Ci,gi.parentId=mi,he&&(Lt||(Lt=this._map(Me,!0)),he(Lt,this._map(gi)))}Me.parentId=mi,H.push($n(pt/ft,mt/ft,mi,ft,Lt))}else if(H.push(Me),ft>1)for(const pt of Fe){const mt=Pe.points[pt];mt.zoom<=O||(mt.zoom=O,H.push(mt))}}return H}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,O){if(D.numPoints)return O?vr({},D.properties):D.properties;const H=this.points[D.index].properties,ee=this.options.map(H);return O&&ee===H?vr({},ee):ee}}function $n(J,D,O,H,ee){return{x:tn(J),y:tn(D),zoom:1/0,id:O,parentId:-1,numPoints:H,properties:ee}}function Dn(J,D){const[O,H]=J.geometry.coordinates;return{x:tn(Or(O)),y:tn(Et(H)),zoom:1/0,index:D,parentId:-1}}function Ln(J){return{type:"Feature",id:J.id,properties:tr(J),geometry:{type:"Point",coordinates:[(D=J.x,360*(D-.5)),Zi(J.y)]}};var D}function tr(J){const D=J.numPoints,O=D>=1e4?`${Math.round(D/1e3)}k`:D>=1e3?Math.round(D/100)/10+"k":D;return vr(vr({},J.properties),{cluster:!0,cluster_id:J.id,point_count:D,point_count_abbreviated:O})}function Or(J){return J/360+.5}function Et(J){const D=Math.sin(J*Math.PI/180),O=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return O<0?0:O>1?1:O}function Zi(J){const D=(180-360*J)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function vr(J,D){for(const O in D)J[O]=D[O];return J}function Dr(J){return J.x}function $r(J){return J.y}function pn(J,D,O,H){for(var ee,le=H,he=O-D>>1,fe=O-D,ue=J[D],_e=J[D+1],Me=J[O],Pe=J[O+1],Fe=D+3;Fe<O;Fe+=3){var ht=Nt(J[Fe],J[Fe+1],ue,_e,Me,Pe);if(ht>le)ee=Fe,le=ht;else if(ht===le){var ft=Math.abs(Fe-he);ft<fe&&(ee=Fe,fe=ft)}}le>H&&(ee-D>3&&pn(J,D,ee,H),J[ee+2]=le,O-ee>3&&pn(J,ee,O,H))}function Nt(J,D,O,H,ee,le){var he=ee-O,fe=le-H;if(he!==0||fe!==0){var ue=((J-O)*he+(D-H)*fe)/(he*he+fe*fe);ue>1?(O=ee,H=le):ue>0&&(O+=he*ue,H+=fe*ue)}return(he=J-O)*he+(fe=D-H)*fe}function Mr(J,D,O,H){var ee={id:J===void 0?null:J,type:D,geometry:O,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(le){var he=le.geometry,fe=le.type;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")xr(le,he);else if(fe==="Polygon"||fe==="MultiLineString")for(var ue=0;ue<he.length;ue++)xr(le,he[ue]);else if(fe==="MultiPolygon")for(ue=0;ue<he.length;ue++)for(var _e=0;_e<he[ue].length;_e++)xr(le,he[ue][_e])}(ee),ee}function xr(J,D){for(var O=0;O<D.length;O+=3)J.minX=Math.min(J.minX,D[O]),J.minY=Math.min(J.minY,D[O+1]),J.maxX=Math.max(J.maxX,D[O]),J.maxY=Math.max(J.maxY,D[O+1])}function Fr(J,D,O,H){if(D.geometry){var ee=D.geometry.coordinates,le=D.geometry.type,he=Math.pow(O.tolerance/((1<<O.maxZoom)*O.extent),2),fe=[],ue=D.id;if(O.promoteId?ue=D.properties[O.promoteId]:O.generateId&&(ue=H||0),le==="Point")_r(ee,fe);else if(le==="MultiPoint")for(var _e=0;_e<ee.length;_e++)_r(ee[_e],fe);else if(le==="LineString")Gt(ee,fe,he,!1);else if(le==="MultiLineString"){if(O.lineMetrics){for(_e=0;_e<ee.length;_e++)Gt(ee[_e],fe=[],he,!1),J.push(Mr(ue,"LineString",fe,D.properties));return}Ai(ee,fe,he,!1)}else if(le==="Polygon")Ai(ee,fe,he,!0);else{if(le!=="MultiPolygon"){if(le==="GeometryCollection"){for(_e=0;_e<D.geometry.geometries.length;_e++)Fr(J,{id:ue,geometry:D.geometry.geometries[_e],properties:D.properties},O,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_e=0;_e<ee.length;_e++){var Me=[];Ai(ee[_e],Me,he,!0),fe.push(Me)}}J.push(Mr(ue,le,fe,D.properties))}}function _r(J,D){D.push(He(J[0])),D.push(rt(J[1])),D.push(0)}function Gt(J,D,O,H){for(var ee,le,he=0,fe=0;fe<J.length;fe++){var ue=He(J[fe][0]),_e=rt(J[fe][1]);D.push(ue),D.push(_e),D.push(0),fe>0&&(he+=H?(ee*_e-ue*le)/2:Math.sqrt(Math.pow(ue-ee,2)+Math.pow(_e-le,2))),ee=ue,le=_e}var Me=D.length-3;D[2]=1,pn(D,0,Me,O),D[Me+2]=1,D.size=Math.abs(he),D.start=0,D.end=D.size}function Ai(J,D,O,H){for(var ee=0;ee<J.length;ee++){var le=[];Gt(J[ee],le,O,H),D.push(le)}}function He(J){return J/360+.5}function rt(J){var D=Math.sin(J*Math.PI/180),O=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return O<0?0:O>1?1:O}function xt(J,D,O,H,ee,le,he,fe){if(H/=D,le>=(O/=D)&&he<H)return J;if(he<O||le>=H)return null;for(var ue=[],_e=0;_e<J.length;_e++){var Me=J[_e],Pe=Me.geometry,Fe=Me.type,ht=ee===0?Me.minX:Me.minY,ft=ee===0?Me.maxX:Me.maxY;if(ht>=O&&ft<H)ue.push(Me);else if(!(ft<O||ht>=H)){var pt=[];if(Fe==="Point"||Fe==="MultiPoint")Ht(Pe,pt,O,H,ee);else if(Fe==="LineString")Xt(Pe,pt,O,H,ee,!1,fe.lineMetrics);else if(Fe==="MultiLineString")ir(Pe,pt,O,H,ee,!1);else if(Fe==="Polygon")ir(Pe,pt,O,H,ee,!0);else if(Fe==="MultiPolygon")for(var mt=0;mt<Pe.length;mt++){var Lt=[];ir(Pe[mt],Lt,O,H,ee,!0),Lt.length&&pt.push(Lt)}if(pt.length){if(fe.lineMetrics&&Fe==="LineString"){for(mt=0;mt<pt.length;mt++)ue.push(Mr(Me.id,Fe,pt[mt],Me.tags));continue}Fe!=="LineString"&&Fe!=="MultiLineString"||(pt.length===1?(Fe="LineString",pt=pt[0]):Fe="MultiLineString"),Fe!=="Point"&&Fe!=="MultiPoint"||(Fe=pt.length===3?"Point":"MultiPoint"),ue.push(Mr(Me.id,Fe,pt,Me.tags))}}}return ue.length?ue:null}function Ht(J,D,O,H,ee){for(var le=0;le<J.length;le+=3){var he=J[le+ee];he>=O&&he<=H&&(D.push(J[le]),D.push(J[le+1]),D.push(J[le+2]))}}function Xt(J,D,O,H,ee,le,he){for(var fe,ue,_e=Ni(J),Me=ee===0?Ne:bt,Pe=J.start,Fe=0;Fe<J.length-3;Fe+=3){var ht=J[Fe],ft=J[Fe+1],pt=J[Fe+2],mt=J[Fe+3],Lt=J[Fe+4],mi=ee===0?ht:ft,bi=ee===0?mt:Lt,gi=!1;he&&(fe=Math.sqrt(Math.pow(ht-mt,2)+Math.pow(ft-Lt,2))),mi<O?bi>O&&(ue=Me(_e,ht,ft,mt,Lt,O),he&&(_e.start=Pe+fe*ue)):mi>H?bi<H&&(ue=Me(_e,ht,ft,mt,Lt,H),he&&(_e.start=Pe+fe*ue)):Lr(_e,ht,ft,pt),bi<O&&mi>=O&&(ue=Me(_e,ht,ft,mt,Lt,O),gi=!0),bi>H&&mi<=H&&(ue=Me(_e,ht,ft,mt,Lt,H),gi=!0),!le&&gi&&(he&&(_e.end=Pe+fe*ue),D.push(_e),_e=Ni(J)),he&&(Pe+=fe)}var Ci=J.length-3;ht=J[Ci],ft=J[Ci+1],pt=J[Ci+2],(mi=ee===0?ht:ft)>=O&&mi<=H&&Lr(_e,ht,ft,pt),Ci=_e.length-3,le&&Ci>=3&&(_e[Ci]!==_e[0]||_e[Ci+1]!==_e[1])&&Lr(_e,_e[0],_e[1],_e[2]),_e.length&&D.push(_e)}function Ni(J){var D=[];return D.size=J.size,D.start=J.start,D.end=J.end,D}function ir(J,D,O,H,ee,le){for(var he=0;he<J.length;he++)Xt(J[he],D,O,H,ee,le,!1)}function Lr(J,D,O,H){J.push(D),J.push(O),J.push(H)}function Ne(J,D,O,H,ee,le){var he=(le-D)/(H-D);return J.push(le),J.push(O+(ee-O)*he),J.push(1),he}function bt(J,D,O,H,ee,le){var he=(le-O)/(ee-O);return J.push(D+(H-D)*he),J.push(le),J.push(1),he}function et(J,D){for(var O=[],H=0;H<J.length;H++){var ee,le=J[H],he=le.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")ee=zt(le.geometry,D);else if(he==="MultiLineString"||he==="Polygon"){ee=[];for(var fe=0;fe<le.geometry.length;fe++)ee.push(zt(le.geometry[fe],D))}else if(he==="MultiPolygon")for(ee=[],fe=0;fe<le.geometry.length;fe++){for(var ue=[],_e=0;_e<le.geometry[fe].length;_e++)ue.push(zt(le.geometry[fe][_e],D));ee.push(ue)}O.push(Mr(le.id,he,ee,le.tags))}return O}function zt(J,D){var O=[];O.size=J.size,J.start!==void 0&&(O.start=J.start,O.end=J.end);for(var H=0;H<J.length;H+=3)O.push(J[H]+D,J[H+1],J[H+2]);return O}function xi(J,D){if(J.transformed)return J;var O,H,ee,le=1<<J.z,he=J.x,fe=J.y;for(O=0;O<J.features.length;O++){var ue=J.features[O],_e=ue.geometry,Me=ue.type;if(ue.geometry=[],Me===1)for(H=0;H<_e.length;H+=2)ue.geometry.push(Ut(_e[H],_e[H+1],D,le,he,fe));else for(H=0;H<_e.length;H++){var Pe=[];for(ee=0;ee<_e[H].length;ee+=2)Pe.push(Ut(_e[H][ee],_e[H][ee+1],D,le,he,fe));ue.geometry.push(Pe)}}return J.transformed=!0,J}function Ut(J,D,O,H,ee,le){return[Math.round(O*(J*H-ee)),Math.round(O*(D*H-le))]}function di(J,D,O,H,ee){for(var le=D===ee.maxZoom?0:ee.tolerance/((1<<D)*ee.extent),he={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:O,y:H,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},fe=0;fe<J.length;fe++){he.numFeatures++,fi(he,J[fe],le,ee);var ue=J[fe].minX,_e=J[fe].minY,Me=J[fe].maxX,Pe=J[fe].maxY;ue<he.minX&&(he.minX=ue),_e<he.minY&&(he.minY=_e),Me>he.maxX&&(he.maxX=Me),Pe>he.maxY&&(he.maxY=Pe)}return he}function fi(J,D,O,H){var ee=D.geometry,le=D.type,he=[];if(le==="Point"||le==="MultiPoint")for(var fe=0;fe<ee.length;fe+=3)he.push(ee[fe]),he.push(ee[fe+1]),J.numPoints++,J.numSimplified++;else if(le==="LineString")pi(he,ee,J,O,!1,!1);else if(le==="MultiLineString"||le==="Polygon")for(fe=0;fe<ee.length;fe++)pi(he,ee[fe],J,O,le==="Polygon",fe===0);else if(le==="MultiPolygon")for(var ue=0;ue<ee.length;ue++){var _e=ee[ue];for(fe=0;fe<_e.length;fe++)pi(he,_e[fe],J,O,!0,fe===0)}if(he.length){var Me=D.tags||null;if(le==="LineString"&&H.lineMetrics){for(var Pe in Me={},D.tags)Me[Pe]=D.tags[Pe];Me.mapbox_clip_start=ee.start/ee.size,Me.mapbox_clip_end=ee.end/ee.size}var Fe={geometry:he,type:le==="Polygon"||le==="MultiPolygon"?3:le==="LineString"||le==="MultiLineString"?2:1,tags:Me};D.id!==null&&(Fe.id=D.id),J.features.push(Fe)}}function pi(J,D,O,H,ee,le){var he=H*H;if(H>0&&D.size<(ee?he:H))O.numPoints+=D.length/3;else{for(var fe=[],ue=0;ue<D.length;ue+=3)(H===0||D[ue+2]>he)&&(O.numSimplified++,fe.push(D[ue]),fe.push(D[ue+1])),O.numPoints++;ee&&function(_e,Me){for(var Pe=0,Fe=0,ht=_e.length,ft=ht-2;Fe<ht;ft=Fe,Fe+=2)Pe+=(_e[Fe]-_e[ft])*(_e[Fe+1]+_e[ft+1]);if(Pe>0===Me)for(Fe=0,ht=_e.length;Fe<ht/2;Fe+=2){var pt=_e[Fe],mt=_e[Fe+1];_e[Fe]=_e[ht-2-Fe],_e[Fe+1]=_e[ht-1-Fe],_e[ht-2-Fe]=pt,_e[ht-1-Fe]=mt}}(fe,le),J.push(fe)}}function Ct(J,D){var O=(D=this.options=function(ee,le){for(var he in le)ee[he]=le[he];return ee}(Object.create(this.options),D)).debug;if(O&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var H=function(ee,le){var he=[];if(ee.type==="FeatureCollection")for(var fe=0;fe<ee.features.length;fe++)Fr(he,ee.features[fe],le,fe);else Fr(he,ee.type==="Feature"?ee:{geometry:ee},le);return he}(J,D);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(H=function(ee,le){var he=le.buffer/le.extent,fe=ee,ue=xt(ee,1,-1-he,he,0,-1,2,le),_e=xt(ee,1,1-he,2+he,0,-1,2,le);return(ue||_e)&&(fe=xt(ee,1,-he,1+he,0,-1,2,le)||[],ue&&(fe=et(ue,1).concat(fe)),_e&&(fe=fe.concat(et(_e,-1)))),fe}(H,D)).length&&this.splitTile(H,0,0,0),O&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function $t(J,D,O){return 32*((1<<J)*O+D)+J}function qi(J,D){const O=J.tileID.canonical;if(!this._geoJSONIndex)return D(null,null);const H=this._geoJSONIndex.getTile(O.z,O.x,O.y);if(!H)return D(null,null);const ee=new S(H.features);let le=Se(ee);le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),D(null,{vectorTile:ee,rawData:le.buffer})}Ct.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ct.prototype.splitTile=function(J,D,O,H,ee,le,he){for(var fe=[J,D,O,H],ue=this.options,_e=ue.debug;fe.length;){H=fe.pop(),O=fe.pop(),D=fe.pop(),J=fe.pop();var Me=1<<D,Pe=$t(D,O,H),Fe=this.tiles[Pe];if(!Fe&&(_e>1&&console.time("creation"),Fe=this.tiles[Pe]=di(J,D,O,H,ue),this.tileCoords.push({z:D,x:O,y:H}),_e)){_e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,O,H,Fe.numFeatures,Fe.numPoints,Fe.numSimplified),console.timeEnd("creation"));var ht="z"+D;this.stats[ht]=(this.stats[ht]||0)+1,this.total++}if(Fe.source=J,ee){if(D===ue.maxZoom||D===ee)continue;var ft=1<<ee-D;if(O!==Math.floor(le/ft)||H!==Math.floor(he/ft))continue}else if(D===ue.indexMaxZoom||Fe.numPoints<=ue.indexMaxPoints)continue;if(Fe.source=null,J.length!==0){_e>1&&console.time("clipping");var pt,mt,Lt,mi,bi,gi,Ci=.5*ue.buffer/ue.extent,mn=.5-Ci,_n=.5+Ci,Yi=1+Ci;pt=mt=Lt=mi=null,bi=xt(J,Me,O-Ci,O+_n,0,Fe.minX,Fe.maxX,ue),gi=xt(J,Me,O+mn,O+Yi,0,Fe.minX,Fe.maxX,ue),J=null,bi&&(pt=xt(bi,Me,H-Ci,H+_n,1,Fe.minY,Fe.maxY,ue),mt=xt(bi,Me,H+mn,H+Yi,1,Fe.minY,Fe.maxY,ue),bi=null),gi&&(Lt=xt(gi,Me,H-Ci,H+_n,1,Fe.minY,Fe.maxY,ue),mi=xt(gi,Me,H+mn,H+Yi,1,Fe.minY,Fe.maxY,ue),gi=null),_e>1&&console.timeEnd("clipping"),fe.push(pt||[],D+1,2*O,2*H),fe.push(mt||[],D+1,2*O,2*H+1),fe.push(Lt||[],D+1,2*O+1,2*H),fe.push(mi||[],D+1,2*O+1,2*H+1)}}},Ct.prototype.getTile=function(J,D,O){var H=this.options,ee=H.extent,le=H.debug;if(J<0||J>24)return null;var he=1<<J,fe=$t(J,D=(D%he+he)%he,O);if(this.tiles[fe])return xi(this.tiles[fe],ee);le>1&&console.log("drilling down to z%d-%d-%d",J,D,O);for(var ue,_e=J,Me=D,Pe=O;!ue&&_e>0;)_e--,Me=Math.floor(Me/2),Pe=Math.floor(Pe/2),ue=this.tiles[$t(_e,Me,Pe)];return ue&&ue.source?(le>1&&console.log("found parent tile z%d-%d-%d",_e,Me,Pe),le>1&&console.time("drilling down"),this.splitTile(ue.source,_e,Me,Pe,J,D,O),le>1&&console.timeEnd("drilling down"),this.tiles[fe]?xi(this.tiles[fe],ee):null):null};class rn extends o.VectorTileWorkerSource{constructor(D,O,H,ee,le){super(D,O,H,ee,qi),le&&(this.loadGeoJSON=le)}loadData(D,O){const H=D&&D.request,ee=H&&H.collectResourceTiming;this.loadGeoJSON(D,(le,he)=>{if(le||!he)return O(le);if(typeof he!="object")return O(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));{$(he,!0);try{if(D.filter){const ue=o.createExpression(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ue.result==="error")throw new Error(ue.value.map(Me=>`${Me.key}: ${Me.message}`).join(", "));const _e=he.features.filter(Me=>ue.value.evaluate({zoom:0},Me));he={type:"FeatureCollection",features:_e}}this._geoJSONIndex=D.cluster?new Pn(function({superclusterOptions:ue,clusterProperties:_e}){if(!_e||!ue)return ue;const Me={},Pe={},Fe={accumulated:null,zoom:0},ht={properties:null},ft=Object.keys(_e);for(const pt of ft){const[mt,Lt]=_e[pt],mi=o.createExpression(Lt),bi=o.createExpression(typeof mt=="string"?[mt,["accumulated"],["get",pt]]:mt);Me[pt]=mi.value,Pe[pt]=bi.value}return ue.map=pt=>{ht.properties=pt;const mt={};for(const Lt of ft)mt[Lt]=Me[Lt].evaluate(Fe,ht);return mt},ue.reduce=(pt,mt)=>{ht.properties=mt;for(const Lt of ft)Fe.accumulated=pt[Lt],pt[Lt]=Pe[Lt].evaluate(Fe,ht)},ue}(D)).load(he.features):function(ue,_e){return new Ct(ue,_e)}(he,D.geojsonVtOptions)}catch(ue){return O(ue)}this.loaded={};const fe={};if(ee){const ue=o.getPerformanceMeasurement(H);ue&&(fe.resourceTiming={},fe.resourceTiming[D.source]=JSON.parse(JSON.stringify(ue)))}O(null,fe)}})}reloadTile(D,O){const H=this.loaded;return H&&H[D.uid]?super.reloadTile(D,O):this.loadTile(D,O)}loadGeoJSON(D,O){if(D.request)o.getJSON(D.request,O);else{if(typeof D.data!="string")return O(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));try{return O(null,JSON.parse(D.data))}catch{return O(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(D,O){try{O(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(H){O(H)}}getClusterChildren(D,O){try{O(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(H){O(H)}}getClusterLeaves(D,O){try{O(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(H){O(H)}}}class ji{constructor(D){this.self=D,this.actor=new o.Actor(D,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:rn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(O,H)=>{if(this.workerSourceTypes[O])throw new Error(`Worker source with name "${O}" already registered.`);this.workerSourceTypes[O]=H},this.self.registerRTLTextPlugin=O=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=O.applyArabicShaping,o.plugin.processBidirectionalText=O.processBidirectionalText,o.plugin.processStyledBidirectionalText=O.processStyledBidirectionalText}}clearCaches(D,O,H){delete this.layerIndexes[D],delete this.availableImages[D],delete this.workerSources[D],delete this.demWorkerSources[D],H()}checkIfReady(D,O,H){H()}setReferrer(D,O){this.referrer=O}spriteLoaded(D,O){this.isSpriteLoaded[D]=O;for(const H in this.workerSources[D]){const ee=this.workerSources[D][H];for(const le in ee)ee[le]instanceof o.VectorTileWorkerSource&&(ee[le].isSpriteLoaded=O,ee[le].fire(new o.Event("isSpriteLoaded")))}}setImages(D,O,H){this.availableImages[D]=O;for(const ee in this.workerSources[D]){const le=this.workerSources[D][ee];for(const he in le)le[he].availableImages=O}H()}enableTerrain(D,O,H){this.terrain=O,H()}setProjection(D,O){this.projections[D]=o.getProjection(O)}setLayers(D,O,H){this.getLayerIndex(D).replace(O),H()}updateLayers(D,O,H){this.getLayerIndex(D).update(O.layers,O.removedIds),H()}loadTile(D,O,H){const ee=this.enableTerrain?o.extend({enableTerrain:this.terrain},O):O;ee.projection=this.projections[D]||this.defaultProjection,this.getWorkerSource(D,O.type,O.source).loadTile(ee,H)}loadDEMTile(D,O,H){const ee=this.enableTerrain?o.extend({buildQuadTree:this.terrain},O):O;this.getDEMWorkerSource(D,O.source).loadTile(ee,H)}reloadTile(D,O,H){const ee=this.enableTerrain?o.extend({enableTerrain:this.terrain},O):O;ee.projection=this.projections[D]||this.defaultProjection,this.getWorkerSource(D,O.type,O.source).reloadTile(ee,H)}abortTile(D,O,H){this.getWorkerSource(D,O.type,O.source).abortTile(O,H)}removeTile(D,O,H){this.getWorkerSource(D,O.type,O.source).removeTile(O,H)}removeSource(D,O,H){if(!this.workerSources[D]||!this.workerSources[D][O.type]||!this.workerSources[D][O.type][O.source])return;const ee=this.workerSources[D][O.type][O.source];delete this.workerSources[D][O.type][O.source],ee.removeSource!==void 0?ee.removeSource(O,H):H()}loadWorkerSource(D,O,H){try{this.self.importScripts(O.url),H()}catch(ee){H(ee.toString())}}syncRTLPluginState(D,O,H){try{o.plugin.setState(O);const ee=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ee!=null){this.self.importScripts(ee);const le=o.plugin.isParsed();H(le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ee}`),le)}}catch(ee){H(ee.toString())}}getAvailableImages(D){let O=this.availableImages[D];return O||(O=[]),O}getLayerIndex(D){let O=this.layerIndexes[D];return O||(O=this.layerIndexes[D]=new V),O}getWorkerSource(D,O,H){return this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][O]||(this.workerSources[D][O]={}),this.workerSources[D][O][H]||(this.workerSources[D][O][H]=new this.workerSourceTypes[O]({send:(ee,le,he,fe,ue,_e)=>{this.actor.send(ee,le,he,D,ue,_e)},scheduler:this.actor.scheduler},this.getLayerIndex(D),this.getAvailableImages(D),this.isSpriteLoaded[D])),this.workerSources[D][O][H]}getDEMWorkerSource(D,O){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][O]||(this.demWorkerSources[D][O]=new Y),this.demWorkerSources[D][O]}enforceCacheSizeLimit(D,O){o.enforceCacheSizeLimit(O)}getWorkerPerformanceMetrics(D,O,H){H(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ji(self)),ji}),T(["./shared"],function(o){var N=U;function U(h){return!function(i){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,_,y=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(y);try{_=new Worker(b),d=!0}catch{d=!1}return _&&_.terminate(),URL.revokeObjectURL(b),d}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var d=document.createElement("canvas");d.width=d.height=1;var _=d.getContext("2d");if(!_)return!1;var y=_.getImageData(0,0,1,1);return y&&y.width===d.width}()?(V[a=i&&i.failIfMajorPerformanceCaveat]===void 0&&(V[a]=function(d){var _,y=function(b){var E=document.createElement("canvas"),I=Object.create(U.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=b,E.getContext("webgl",I)||E.getContext("experimental-webgl",I)}(d);if(!y)return!1;try{_=y.createShader(y.VERTEX_SHADER)}catch{return!1}return!(!_||y.isContextLost())&&(y.shaderSource(_,"void main() {}"),y.compileShader(_),y.getShaderParameter(_,y.COMPILE_STATUS)===!0)}(a)),V[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var a}(h)}var V={};function F(h,i){var a=i[0],d=i[1],_=i[2],y=i[3],b=a*y-_*d;return b?(h[0]=y*(b=1/b),h[1]=-d*b,h[2]=-_*b,h[3]=a*b,h):null}function Y(h,i){if(Array.isArray(h)){if(!Array.isArray(i)||h.length!==i.length)return!1;for(let a=0;a<h.length;a++)if(!Y(h[a],i[a]))return!1;return!0}if(typeof h=="object"&&h!==null&&i!==null){if(typeof i!="object"||Object.keys(h).length!==Object.keys(i).length)return!1;for(const a in h)if(!Y(h[a],i[a]))return!1;return!0}return h===i}U.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const $={create:function(h,i,a){const d=o.window.document.createElement(h);return i!==void 0&&(d.className=i),a&&a.appendChild(d),d},createSVG:function(h,i,a){const d=o.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const _ of Object.keys(i))d.setAttributeNS(null,_,i[_]);return a&&a.appendChild(d),d}},ye=o.window.document&&o.window.document.documentElement.style,be=ye&&ye.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ue;$.disableDrag=function(){ye&&be&&(Ue=ye[be],ye[be]="none")},$.enableDrag=function(){ye&&be&&(ye[be]=Ue)};const Ge=function(h){h.preventDefault(),h.stopPropagation(),o.window.removeEventListener("click",Ge,!0)};function S(h,i,a){const d=h.offsetWidth===i.width?1:h.offsetWidth/i.width;return new o.pointGeometry((a.clientX-i.left)*d,(a.clientY-i.top)*d)}function we(h){const{userImage:i}=h;return!!(i&&i.render&&i.render())&&(h.data.replace(new Uint8Array(i.data.buffer)),!0)}$.suppressClick=function(){o.window.addEventListener("click",Ge,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",Ge,!0)},0)},$.mousePos=function(h,i){const a=h.getBoundingClientRect();return S(h,a,i)},$.touchPos=function(h,i){const a=h.getBoundingClientRect(),d=[];for(let _=0;_<i.length;_++)d.push(S(h,a,i[_]));return d},$.mouseButton=function(h){return o.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button};class Le extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:a,callback:d}of this.requestors)this._notify(a,d);this.requestors=[]}}getImage(i){return this.images[i]}addImage(i,a){this._validate(i,a)&&(this.images[i]=a)}_validate(i,a){let d=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new o.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),d=!1),d}_validateStretch(i,a){if(!i)return!0;let d=0;for(const _ of i){if(_[0]<d||_[1]<_[0]||a<_[1])return!1;d=_[1]}return!0}_validateContent(i,a){return!(i&&(i.length!==4||i[0]<0||a.data.width<i[0]||i[1]<0||a.data.height<i[1]||i[2]<0||a.data.width<i[2]||i[3]<0||a.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,a){a.version=this.images[i].version+1,this.images[i]=a,this.updatedImages[i]=!0}removeImage(i){const a=this.images[i];delete this.images[i],delete this.patterns[i],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,a){let d=!0;if(!this.isLoaded())for(const _ of i)this.images[_]||(d=!1);this.isLoaded()||d?this._notify(i,a):this.requestors.push({ids:i,callback:a})}_notify(i,a){const d={};for(const _ of i){this.images[_]||this.fire(new o.Event("styleimagemissing",{id:_}));const y=this.images[_];y?d[_]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:Boolean(y.userImage&&y.userImage.render)}:o.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,d)}getPixelSize(){const{width:i,height:a}=this.atlasImage;return{width:i,height:a}}getPattern(i){const a=this.patterns[i],d=this.getImage(i);if(!d)return null;if(a&&a.position.version===d.version)return a.position;if(a)a.position.version=d.version;else{const _={w:d.data.width+2,h:d.data.height+2,x:0,y:0},y=new o.ImagePosition(_,d);this.patterns[i]={bin:_,position:y}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const a=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(i,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const y in this.patterns)i.push(this.patterns[y].bin);const{w:a,h:d}=o.potpack(i),_=this.atlasImage;_.resize({width:a||1,height:d||1});for(const y in this.patterns){const{bin:b}=this.patterns[y],E=b.x+1,I=b.y+1,z=this.images[y].data,P=z.width,R=z.height;o.RGBAImage.copy(z,_,{x:0,y:0},{x:E,y:I},{width:P,height:R}),o.RGBAImage.copy(z,_,{x:0,y:R-1},{x:E,y:I-1},{width:P,height:1}),o.RGBAImage.copy(z,_,{x:0,y:0},{x:E,y:I+R},{width:P,height:1}),o.RGBAImage.copy(z,_,{x:P-1,y:0},{x:E-1,y:I},{width:1,height:R}),o.RGBAImage.copy(z,_,{x:0,y:0},{x:E+P,y:I},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const a of i){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const d=this.images[a];we(d)&&this.updateImage(a,d)}}}const Ze=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(h,i){return function([a,d,_]){const y=o.degToRad(d+90),b=o.degToRad(_);return{x:a*Math.cos(y)*Math.sin(b),y:a*Math.sin(y)*Math.sin(b),z:a*Math.cos(b),azimuthal:d,polar:_}}(h.expression.evaluate(i))}interpolate(h,i,a){return{x:o.number(h.x,i.x,a),y:o.number(h.y,i.y,a),z:o.number(h.z,i.z,a),azimuthal:o.number(h.azimuthal,i.azimuthal,a),polar:o.number(h.polar,i.polar,a)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),xe="-transition";class Se extends o.Evented{constructor(i){super(),this._transitionable=new o.Transitionable(Ze),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,a={}){if(!this._validate(o.validateLight,i,a))for(const d in i){const _=i[d];o.endsWith(d,xe)?this._transitionable.setTransition(d.slice(0,-xe.length),_):this._transitionable.setValue(d,_)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,d){return(!d||d.validate!==!1)&&o.emitValidationErrors(this,i.call(o.validateStyle,o.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Re=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),Je="-transition";class ot extends o.Evented{constructor(i,a){super(),this._transitionable=new o.Transitionable(Re),this.set(i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(i){for(const a in i){const d=i[a];o.endsWith(a,Je)?this._transitionable.setTransition(a.slice(0,-Je.length),d):this._transitionable.setValue(a,d)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}}function st(h,i,a,d){const _=o.smoothstep(45,65,a),[y,b]=wt(h,d),E=o.length(i);let I=1-Math.min(1,Math.exp((E-y)/(b-y)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*_*h.alpha}function wt(h,i){const a=.5/Math.tan(.5*i);return[h.range[0]+a,h.range[1]+a]}const ai=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"])}),vi="-transition";class Ft extends o.Evented{constructor(i,a){super(),this._transitionable=new o.Transitionable(ai),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=a}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,a={}){if(!this._validate(o.validateFog,i,a))for(const d in i){const _=i[d];o.endsWith(d,vi)?this._transitionable.setTransition(d.slice(0,-vi.length),_):this._transitionable.setValue(d,_)}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return o.smoothstep(45,65,i)*a.a}getOpacityAtLatLng(i,a){return this._transform.projection.supportsFog?function(d,_,y){const b=o.MercatorCoordinate.fromLngLat(_),E=y.elevation?y.elevation.getAtPointOrZero(b):0,I=[b.x,b.y,E];return o.transformMat4(I,I,y.mercatorFogMatrix),st(d,I,y.pitch,y._fov)}(this.state,i,a):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?wt(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,d){return(!d||d.validate!==!1)&&o.emitValidationErrors(this,i.call(o.validateStyle,o.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Vi{constructor(i,a){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const d=this.workerPool.acquire(this.id);for(let _=0;_<d.length;_++){const y=new Vi.Actor(d[_],a,this.id);y.name=`Worker ${_}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,a,d){o.asyncAll(this.actors,(_,y)=>{_.send(i,a,y)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Dt(h,i,a){return i*(o.EXTENT/(h.tileSize*Math.pow(2,a-h.tileID.overscaledZ)))}Vi.Actor=o.Actor;class kt{constructor(i,a,d){this.context=i;const _=i.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(d),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ui={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Di{constructor(i,a,d,_){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=_,this.context=i;const y=i.gl;this.buffer=y.createBuffer(),i.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,a){for(let d=0;d<this.attributes.length;d++){const _=a.attributes[this.attributes[d].name];_!==void 0&&i.enableVertexAttribArray(_)}}setVertexAttribPointers(i,a,d){for(let _=0;_<this.attributes.length;_++){const y=this.attributes[_],b=a.attributes[y.name];b!==void 0&&i.vertexAttribPointer(b,y.components,i[ui[y.type]],!1,this.itemSize,y.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class At{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class hi extends At{getDefault(){return o.Color.transparent}set(i){const a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class cr extends At{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class yr extends At{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Gn extends At{getDefault(){return[!0,!0,!0,!0]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class tn extends At{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class mr extends At{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Pn extends At{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const a=this.current;(i.func!==a.func||i.ref!==a.ref||i.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class $n extends At{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Dn extends At{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=i,this.dirty=!1}}class Ln extends At{getDefault(){return[0,1]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class tr extends At{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=i,this.dirty=!1}}class Or extends At{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Et extends At{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.BLEND):a.disable(a.BLEND),this.current=i,this.dirty=!1}}class Zi extends At{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class vr extends At{getDefault(){return o.Color.transparent}set(i){const a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Dr extends At{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class $r extends At{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=i,this.dirty=!1}}class pn extends At{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Nt extends At{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class Mr extends At{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class xr extends At{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Fr extends At{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class _r extends At{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Gt extends At{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ai extends At{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class He extends At{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class rt extends At{getDefault(){return null}set(i){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class xt extends At{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class Ht extends At{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Xt extends At{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Ni extends At{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class ir extends At{constructor(i,a){super(i),this.context=i,this.parent=a}getDefault(){return null}}class Lr extends ir{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Ne extends ir{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class bt extends Ne{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class et{constructor(i,a,d,_){this.context=i,this.width=a,this.height=d;const y=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new Lr(i,y),_&&(this.depthAttachment=new Ne(i,y))}destroy(){const i=this.context.gl,a=this.colorAttachment.get();if(a&&i.deleteTexture(a),this.depthAttachment){const d=this.depthAttachment.get();d&&i.deleteRenderbuffer(d)}i.deleteFramebuffer(this.framebuffer)}}class zt{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new hi(this),this.clearDepth=new cr(this),this.clearStencil=new yr(this),this.colorMask=new Gn(this),this.depthMask=new tn(this),this.stencilMask=new mr(this),this.stencilFunc=new Pn(this),this.stencilOp=new $n(this),this.stencilTest=new Dn(this),this.depthRange=new Ln(this),this.depthTest=new tr(this),this.depthFunc=new Or(this),this.blend=new Et(this),this.blendFunc=new Zi(this),this.blendColor=new vr(this),this.blendEquation=new Dr(this),this.cullFace=new $r(this),this.cullFaceSide=new pn(this),this.frontFace=new Nt(this),this.program=new Mr(this),this.activeTexture=new xr(this),this.viewport=new Fr(this),this.bindFramebuffer=new _r(this),this.bindRenderbuffer=new Gt(this),this.bindTexture=new Ai(this),this.bindVertexBuffer=new He(this),this.bindElementBuffer=new rt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new xt(this),this.pixelStoreUnpack=new Ht(this),this.pixelStoreUnpackPremultiplyAlpha=new Xt(this),this.pixelStoreUnpackFlipY=new Ni(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,a){return new kt(this,i,a)}createVertexBuffer(i,a,d){return new Di(this,i,a,d)}createRenderbuffer(i,a,d){const _=this.gl,y=_.createRenderbuffer();return this.bindRenderbuffer.set(y),_.renderbufferStorage(_.RENDERBUFFER,i,a,d),this.bindRenderbuffer.set(null),y}createFramebuffer(i,a,d){return new et(this,i,a,d)}clear({color:i,depth:a,stencil:d}){const _=this.gl;let y=0;i&&(y|=_.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(y|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),d!==void 0&&(y|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),_.clear(y)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){Y(i.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class xi{constructor(i,a,d,_){this.screenBounds=i,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(y=>_.pointCoordinate3D(y)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(i,a){let d,_;if(i instanceof o.pointGeometry||typeof i[0]=="number"){const y=o.pointGeometry.convert(i);d=[o.pointGeometry.convert(i)],_=a.isPointAboveHorizon(y)}else{const y=o.pointGeometry.convert(i[0]),b=o.pointGeometry.convert(i[1]);d=[y,b],_=o.polygonizeBounds(y,b).every(E=>a.isPointAboveHorizon(E))}return new xi(d,a.getCameraPoint(),_,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],_=o.polygonizeBounds(a,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<d.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?_[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(_[3]=this.cameraPoint)),o.bufferConvexPolygon(_,i)}containsTile(i,a,d){const _=i.queryPadding+1,y=i.tileID.wrap,b=d?this._bufferedCameraMercator(_,a).map(Z=>o.getTilePoint(i.tileTransform,Z,y)):this._bufferedScreenMercator(_,a).map(Z=>o.getTilePoint(i.tileTransform,Z,y)),E=this.screenGeometryMercator.map(Z=>o.getTileVec3(i.tileTransform,Z,y)),I=E.map(Z=>new o.pointGeometry(Z[0],Z[1])),z=a.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),P=o.getTileVec3(i.tileTransform,z,y),R=E.map(Z=>{const K=o.sub(Z,Z,P);return o.normalize(K,K),new o.Ray(P,K)}),j=Dt(i,1,a.zoom);if(o.polygonIntersectsBox(b,0,0,o.EXTENT,o.EXTENT))return{queryGeometry:this,tilespaceGeometry:I,tilespaceRays:R,bufferedTilespaceGeometry:b,bufferedTilespaceBounds:(X=o.getBounds(b),X.min.x=o.clamp(X.min.x,0,o.EXTENT),X.min.y=o.clamp(X.min.y,0,o.EXTENT),X.max.x=o.clamp(X.max.x,0,o.EXTENT),X.max.y=o.clamp(X.max.y,0,o.EXTENT),X),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:j};var X}_bufferedScreenMercator(i,a){const d=Ut(i);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{const _=this.bufferedScreenGeometry(i).map(y=>a.pointCoordinate3D(y));return this._screenRaycastCache[d]=_,_}}_bufferedCameraMercator(i,a){const d=Ut(i);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{const _=this.bufferedCameraGeometry(i).map(y=>a.pointCoordinate3D(y));return this._cameraRaycastCache[d]=_,_}}}function Ut(h){return 100*h|0}function di(h,i,a){const d=function(_,y){if(_)return a(_);if(y){const b=o.pick(o.extend(y,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(b.vectorLayers=y.vector_layers,b.vectorLayerIds=b.vectorLayers.map(E=>E.id)),b.tiles=i.canonicalizeTileset(b,h.url),a(null,b)}};return h.url?o.getJSON(i.transformRequest(i.normalizeSourceURL(h.url),o.ResourceType.Source),d):o.exported.frame(()=>d(null,h))}class fi{constructor(i,a,d){this.bounds=o.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=a||0,this.maxzoom=d||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const a=Math.pow(2,i.z),d=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*a),_=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*a),y=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*a),b=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*a);return i.x>=d&&i.x<y&&i.y>=_&&i.y<b}}class pi extends o.Evented{constructor(i,a,d,_){super(),this.id=i,this.dispatcher=d,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},a),o.extend(this,o.pick(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=di(this._options,this.map._requestManager,(i,a)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new o.ErrorEvent(i)):a&&(o.extend(this,a),a.bounds&&(this.tileBounds=new fi(a.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(a.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,a){const d=o.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);i.request=o.getImage(this.map._requestManager.transformRequest(_,o.ResourceType.Tile),(y,b,E,I)=>{if(delete i.request,i.aborted)i.state="unloaded",a(null);else if(y)i.state="errored",a(y);else if(b){this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:E,expires:I});const z=this.map.painter.context,P=z.gl;i.texture=this.map.painter.getTileTexture(b.width),i.texture?i.texture.update(b,{useMipmap:!0}):(i.texture=new o.Texture(z,b,P.RGBA,{useMipmap:!0}),i.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE),z.extTextureFilterAnisotropic&&P.texParameterf(P.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax)),i.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),a(null)}})}abortTile(i,a){i.request&&(i.request.cancel(),delete i.request),a()}unloadTile(i,a){i.texture&&this.map.painter.saveTileTexture(i.texture),a()}hasTransition(){return!1}}let Ct;function $t(h,i,a,d,_,y,b,E){const I=[h,a,_,i,d,y,1,1,1],z=[b,E,1],P=o.adjoint([],I),[R,j,X]=o.transformMat3(z,z,o.transpose(P,P));return o.multiply(I,[R,0,0,0,j,0,0,0,X],I)}class qi extends o.Evented{constructor(i,a,d,_){super(),this.id=i,this.dispatcher=d,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=a}load(i,a){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(d,_)=>{this._loaded=!0,d?this.fire(new o.ErrorEvent(d)):_&&(this.image=o.exported.getImageData(_),this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),a&&a(),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this.options.url=i.url,this.load(i.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}setCoordinates(i){this.coordinates=i,delete this._boundsArray;const a=i.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(d){let _=1/0,y=1/0,b=-1/0,E=-1/0;for(const R of d)_=Math.min(_,R.x),y=Math.min(y,R.y),b=Math.max(b,R.x),E=Math.max(E,R.y);const I=Math.max(b-_,E-y),z=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),P=Math.pow(2,z);return new o.CanonicalTileID(z,Math.floor((_+b)/2*P),Math.floor((y+E)/2*P))}(a),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const i=o.tileTransform(this.tileID,this.map.transform.projection),[a,d,_,y]=this.coordinates.map(b=>{const E=i.projection.project(b[0],b[1]);return o.getTilePoint(i,E)._round()});return this.perspectiveTransform=function(b,E,I,z,P,R,j,X,Z,K){const ae=$t(0,0,b,0,0,E,b,E),W=$t(I,z,P,R,j,X,Z,K);return o.multiply(W,o.adjoint(ae,ae),W),[W[6]/W[8]*b/o.EXTENT,W[7]/W[8]*E/o.EXTENT]}(this.width,this.height,a.x,a.y,d.x,d.y,y.x,y.y,_.x,_.y),this._boundsArray=new o.StructArrayLayout4i8,this._boundsArray.emplaceBack(a.x,a.y,0,0),this._boundsArray.emplaceBack(d.x,d.y,o.EXTENT,0),this._boundsArray.emplaceBack(y.x,y.y,0,o.EXTENT),this._boundsArray.emplaceBack(_.x,_.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,a=i.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new o.Texture(i,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}loadTile(i,a){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},a(null)):(i.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const rn={vector:class extends o.Evented{constructor(h,i,a,d){if(super(),this.id=h,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(i,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=di(this._options,this.map._requestManager,(h,i)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new o.ErrorEvent(h)):i&&(o.extend(this,i),i.bounds&&(this.tileBounds=new fi(i.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(i.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}onAdd(h){this.map=h,this.load()}setSourceProperty(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h();const i=this.map.style._getSourceCaches(this.id);for(const a of i)a.clearTiles();this.load()}setTiles(h){return this.setSourceProperty(()=>{this._options.tiles=h}),this}setUrl(h){return this.setSourceProperty(()=>{this.url=h,this._options.url=h}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(h,i){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(a,o.ResourceType.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:h.isSymbolTile};if(d.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired")h.state==="loading"?h.reloadCallback=i:h.request=h.actor.send("reloadTile",d,_.bind(this));else if(h.actor=this._tileWorkers[a]=this._tileWorkers[a]||this.dispatcher.getActor(),this.dispatcher.ready)h.request=h.actor.send("loadTile",d,_.bind(this),void 0,!0);else{const y=o.loadVectorTile.call({deduped:this._deduped},d,(b,E)=>{b||!E?_.call(this,b):(d.data={cacheControl:E.cacheControl,expires:E.expires,rawData:E.rawData.slice(0)},h.actor&&h.actor.send("loadTile",d,_.bind(this),void 0,!0))},!0);h.request={cancel:y}}function _(y,b){return delete h.request,h.aborted?i(null):y&&y.status!==404?i(y):(b&&b.resourceTiming&&(h.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&b&&h.setExpiryData(b),h.loadVectorData(b,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id})}unloadTile(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:pi,"raster-dem":class extends pi{constructor(h,i,a,d){super(h,i,a,d),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(h,i){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(_,y){_&&(h.state="errored",i(_)),y&&(h.dem=y,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",i(null))}h.request=o.getImage(this.map._requestManager.transformRequest(a,o.ResourceType.Tile),function(_,y,b,E){if(delete h.request,h.aborted)h.state="unloaded",i(null);else if(_)h.state="errored",i(_);else if(y){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:b,expires:E});const I=o.window.ImageBitmap&&y instanceof o.window.ImageBitmap&&(Ct==null&&(Ct=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),Ct),z=1-(y.width-o.prevPowerOfTwo(y.width))/2;z<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const P=I?y:o.exported.getImageData(y,z),R={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:P,encoding:this.encoding,padding:z};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",R,d.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const i=h.canonical,a=Math.pow(2,i.z),d=(i.x-1+a)%a,_=i.x===0?h.wrap-1:h.wrap,y=(i.x+1+a)%a,b=i.x+1===a?h.wrap+1:h.wrap,E={};return E[new o.OverscaledTileID(h.overscaledZ,_,i.z,d,i.y).key]={backfilled:!1},E[new o.OverscaledTileID(h.overscaledZ,b,i.z,y,i.y).key]={backfilled:!1},i.y>0&&(E[new o.OverscaledTileID(h.overscaledZ,_,i.z,d,i.y-1).key]={backfilled:!1},E[new o.OverscaledTileID(h.overscaledZ,h.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},E[new o.OverscaledTileID(h.overscaledZ,b,i.z,y,i.y-1).key]={backfilled:!1}),i.y+1<a&&(E[new o.OverscaledTileID(h.overscaledZ,_,i.z,d,i.y+1).key]={backfilled:!1},E[new o.OverscaledTileID(h.overscaledZ,h.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},E[new o.OverscaledTileID(h.overscaledZ,b,i.z,y,i.y+1).key]={backfilled:!1}),E}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends o.Evented{constructor(h,i,a,d){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(d),this._data=i.data,this._options=o.extend({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const _=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*_,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*_,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:o.EXTENT,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*_,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},i),this}getClusterChildren(h,i){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},i),this}getClusterLeaves(h,i,a,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:i,offset:a},d),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=o.extend({},this.workerOptions),i=this._data;typeof i=="string"?(h.request=this.map._requestManager.transformRequest(o.exported.resolveURL(i),o.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(a,d)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new o.ErrorEvent(a));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&d&&d.resourceTiming&&d.resourceTiming[this.id]&&(_.resourceTiming=d.resourceTiming[this.id]),this.fire(new o.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,i){const a=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(a,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(d,_)=>(delete h.request,h.unloadVectorData(),h.aborted?i(null):d?i(d):(h.loadVectorData(_,this.map.painter,a==="reloadTile"),i(null))),void 0,a==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends qi{constructor(h,i,a,d){super(h,i,a,d),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const i of h.urls)this.urls.push(this.map._requestManager.transformRequest(i,o.ResourceType.Source).url);o.getVideo(this.urls,(i,a)=>{this._loaded=!0,i?this.fire(new o.ErrorEvent(i)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const i=this.video.seekable;h<i.start(0)||h>i.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,i=h.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(h,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2));for(const a in this.tiles){const d=this.tiles[a];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:qi,canvas:class extends qi{constructor(h,i,a,d){super(h,i,a,d),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(y=>typeof y!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context,a=i.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(i,this.canvas,a.RGBA,{premultiply:!0});for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}}},ji=function(h,i,a,d){const _=new rn[i.type](h,i,a,d);if(_.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${_.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],_),_};function J(h,i){const a=o.identity([]);return o.scale(a,a,[.5*h.width,.5*-h.height,1]),o.translate(a,a,[1,-1,0]),o.multiply$1(a,a,h.calculateProjMatrix(i.toUnwrapped()))}function D(h,i,a,d,_,y,b,E=!1){const I=h.tilesIn(d,b,E);I.sort(H);const z=[];for(const R of I)z.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(i,a,h._state,R,_,y,J(h.transform,R.tile.tileID),E)});const P=function(R){const j={},X={};for(const Z of R){const K=Z.queryResults,ae=Z.wrappedTileID,W=X[ae]=X[ae]||{};for(const re in K){const ne=K[re],te=W[re]=W[re]||{},ie=j[re]=j[re]||[];for(const se of ne)te[se.featureIndex]||(te[se.featureIndex]=!0,ie.push(se))}}return j}(z);for(const R in P)P[R].forEach(j=>{const X=j.feature,Z=h.getFeatureState(X.layer["source-layer"],X.id);X.source=X.layer.source,X.layer["source-layer"]&&(X.sourceLayer=X.layer["source-layer"]),X.state=Z});return P}function O(h,i){const a=h.getRenderableIds().map(y=>h.getTileByID(y)),d=[],_={};for(let y=0;y<a.length;y++){const b=a[y],E=b.tileID.canonical.key;_[E]||(_[E]=!0,b.querySourceFeatures(d,i))}return d}function H(h,i){const a=h.tileID,d=i.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}function ee(){return Co.workerClass!=null?new Co.workerClass:new o.window.Worker(Co.workerUrl)}const le="mapboxgl_preloaded_worker_pool";class he{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<he.workerCount;)this.workers.push(new ee);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[le]}numActive(){return Object.keys(this.active).length}}let fe;function ue(){return fe||(fe=new he),fe}function _e(h,i){const a={};for(const d in h)d!=="ref"&&(a[d]=h[d]);return o.refProperties.forEach(d=>{d in i&&(a[d]=i[d])}),a}function Me(h){h=h.slice();const i=Object.create(null);for(let a=0;a<h.length;a++)i[h[a].id]=h[a];for(let a=0;a<h.length;a++)"ref"in h[a]&&(h[a]=_e(h[a],i[h[a].ref]));return h}he.workerCount=2;const Pe={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Fe(h,i,a){a.push({command:Pe.addSource,args:[h,i[h]]})}function ht(h,i,a){i.push({command:Pe.removeSource,args:[h]}),a[h]=!0}function ft(h,i,a,d){ht(h,a,d),Fe(h,i,a)}function pt(h,i,a){let d;for(d in h[a])if(h[a].hasOwnProperty(d)&&d!=="data"&&!Y(h[a][d],i[a][d]))return!1;for(d in i[a])if(i[a].hasOwnProperty(d)&&d!=="data"&&!Y(h[a][d],i[a][d]))return!1;return!0}function mt(h,i,a,d,_,y){let b;for(b in i=i||{},h=h||{})h.hasOwnProperty(b)&&(Y(h[b],i[b])||a.push({command:y,args:[d,b,i[b],_]}));for(b in i)i.hasOwnProperty(b)&&!h.hasOwnProperty(b)&&(Y(h[b],i[b])||a.push({command:y,args:[d,b,i[b],_]}))}function Lt(h){return h.id}function mi(h,i){return h[i.id]=i,h}class bi{constructor(i,a){this.reset(i,a)}reset(i,a){this.points=i||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=o.clamp(i,0,1);let a=1,d=this._distances[a];const _=i*this.paddedLength+this.padding;for(;d<_&&a<this._distances.length;)d=this._distances[++a];const y=a-1,b=this._distances[y],E=d-b,I=E>0?(_-b)/E:0;return this.points[y].mult(1-I).add(this.points[a].mult(I))}}class gi{constructor(i,a,d){const _=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(i/d),this.yCellCount=Math.ceil(a/d);for(let b=0;b<this.xCellCount*this.yCellCount;b++)_.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=a,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,a,d,_,y){this._forEachCell(a,d,_,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(y)}insertCircle(i,a,d,_){this._forEachCell(a-_,d-_,a+_,d+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(a),this.circles.push(d),this.circles.push(_)}_insertBoxCell(i,a,d,_,y,b){this.boxCells[y].push(b)}_insertCircleCell(i,a,d,_,y,b){this.circleCells[y].push(b)}_query(i,a,d,_,y,b){if(d<0||i>this.width||_<0||a>this.height)return!y&&[];const E=[];if(i<=0&&a<=0&&this.width<=d&&this.height<=_){if(y)return!0;for(let I=0;I<this.boxKeys.length;I++)E.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const z=this.circles[3*I],P=this.circles[3*I+1],R=this.circles[3*I+2];E.push({key:this.circleKeys[I],x1:z-R,y1:P-R,x2:z+R,y2:P+R})}return b?E.filter(b):E}return this._forEachCell(i,a,d,_,this._queryCell,E,{hitTest:y,seenUids:{box:{},circle:{}}},b),y?E.length>0:E}_queryCircle(i,a,d,_,y){const b=i-d,E=i+d,I=a-d,z=a+d;if(E<0||b>this.width||z<0||I>this.height)return!_&&[];const P=[];return this._forEachCell(b,I,E,z,this._queryCellCircle,P,{hitTest:_,circle:{x:i,y:a,radius:d},seenUids:{box:{},circle:{}}},y),_?P.length>0:P}query(i,a,d,_,y){return this._query(i,a,d,_,!1,y)}hitTest(i,a,d,_,y){return this._query(i,a,d,_,!0,y)}hitTestCircle(i,a,d,_){return this._queryCircle(i,a,d,!0,_)}_queryCell(i,a,d,_,y,b,E,I){const z=E.seenUids,P=this.boxCells[y];if(P!==null){const j=this.bboxes;for(const X of P)if(!z.box[X]){z.box[X]=!0;const Z=4*X;if(i<=j[Z+2]&&a<=j[Z+3]&&d>=j[Z+0]&&_>=j[Z+1]&&(!I||I(this.boxKeys[X]))){if(E.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[X],x1:j[Z],y1:j[Z+1],x2:j[Z+2],y2:j[Z+3]})}}}const R=this.circleCells[y];if(R!==null){const j=this.circles;for(const X of R)if(!z.circle[X]){z.circle[X]=!0;const Z=3*X;if(this._circleAndRectCollide(j[Z],j[Z+1],j[Z+2],i,a,d,_)&&(!I||I(this.circleKeys[X]))){if(E.hitTest)return b.push(!0),!0;{const K=j[Z],ae=j[Z+1],W=j[Z+2];b.push({key:this.circleKeys[X],x1:K-W,y1:ae-W,x2:K+W,y2:ae+W})}}}}}_queryCellCircle(i,a,d,_,y,b,E,I){const z=E.circle,P=E.seenUids,R=this.boxCells[y];if(R!==null){const X=this.bboxes;for(const Z of R)if(!P.box[Z]){P.box[Z]=!0;const K=4*Z;if(this._circleAndRectCollide(z.x,z.y,z.radius,X[K+0],X[K+1],X[K+2],X[K+3])&&(!I||I(this.boxKeys[Z])))return b.push(!0),!0}}const j=this.circleCells[y];if(j!==null){const X=this.circles;for(const Z of j)if(!P.circle[Z]){P.circle[Z]=!0;const K=3*Z;if(this._circlesCollide(X[K],X[K+1],X[K+2],z.x,z.y,z.radius)&&(!I||I(this.circleKeys[Z])))return b.push(!0),!0}}}_forEachCell(i,a,d,_,y,b,E,I){const z=this._convertToXCellCoord(i),P=this._convertToYCellCoord(a),R=this._convertToXCellCoord(d),j=this._convertToYCellCoord(_);for(let X=z;X<=R;X++)for(let Z=P;Z<=j;Z++)if(y.call(this,i,a,d,_,this.xCellCount*Z+X,b,E,I))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,a,d,_,y,b){const E=_-i,I=y-a,z=d+b;return z*z>E*E+I*I}_circleAndRectCollide(i,a,d,_,y,b,E){const I=(b-_)/2,z=Math.abs(i-(_+I));if(z>I+d)return!1;const P=(E-y)/2,R=Math.abs(a-(y+P));if(R>P+d)return!1;if(z<=I||R<=P)return!0;const j=z-I,X=R-P;return j*j+X*X<=d*d}}const Ci=Math.tan(85*Math.PI/180);function mn(h,i,a,d,_,y){let b=o.create();if(a){if(_.projection.name==="globe")b=o.calculateGlobeMatrix(_,_.worldSize/_._projectionScaler,[0,0]),o.multiply$1(b,b,o.globeDenormalizeECEF(o.globeTileBounds(i)));else{const E=F([],y);b[0]=E[0],b[1]=E[1],b[4]=E[2],b[5]=E[3]}d||o.rotateZ(b,b,_.angle)}else o.multiply$1(b,_.labelPlaneMatrix,h);return b}function _n(h,i,a,d,_,y){if(a){if(_.projection.name==="globe"){const b=mn(h,i,a,d,_,y);return o.invert(b,b),o.multiply$1(b,h,b),b}{const b=o.clone(h),E=o.identity([]);return E[0]=y[0],E[1]=y[1],E[4]=y[2],E[5]=y[3],o.multiply$1(b,b,E),d||o.rotateZ(b,b,-_.angle),b}}return _.glCoordMatrix}function Yi(h,i,a=0){const d=[h.x,h.y,a,1];a?o.transformMat4$1(d,d,i):Pa(d,d,i);const _=d[3];return{point:new o.pointGeometry(d[0]/_,d[1]/_),signedDistanceFromCamera:_}}function nn(h,i){return Math.min(.5+h/i*.5,1.5)}function Ts(h,i){const a=h[0]/h[3],d=h[1]/h[3];return a>=-i[0]&&a<=i[0]&&d>=-i[1]&&d<=i[1]}function Cu(h,i,a,d,_,y,b,E,I,z){const P=a.transform,R=d?h.textSizeData:h.iconSizeData,j=o.evaluateSizeForZoom(R,a.transform.zoom),X=[256/a.width*2+1,256/a.height*2+1],Z=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;Z.clear();const K=h.lineVertexArray,ae=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,W=a.transform.width/a.transform.height;let re=!1;for(let ne=0;ne<ae.length;ne++){const te=ae.get(ne);if(te.writingMode!==o.WritingMode.vertical||re||ne!==0&&ae.get(ne-1).writingMode===o.WritingMode.horizontal||(re=!0),te.hidden||te.writingMode===o.WritingMode.vertical&&!re){Rn(te.numGlyphs,Z);continue}re=!1;const ie=new o.pointGeometry(te.tileAnchorX,te.tileAnchorY),se=I?I(ie):[0,0,0],ge=P.projection.projectTilePoint(ie.x,ie.y,z.canonical),Te=[ge.x+se[0],ge.y+se[1],ge.z+se[2]],Ke=[...Te,1];if(o.transformMat4$1(Ke,Ke,i),!Ts(Ke,X)){Rn(te.numGlyphs,Z);continue}const je=nn(a.transform.cameraToCenterDistance,Ke[3]),Ve=o.evaluateSizeForFeature(R,j,te),Ae=b?Ve/je:Ve*je,ve=Yi(new o.pointGeometry(Te[0],Te[1]),_,Te[2]);if(ve.signedDistanceFromCamera<=0){Rn(te.numGlyphs,Z);continue}let Oe={};const ze=b?null:I,dt=Hl(te,Ae,!1,E,i,_,y,h.glyphOffsetArray,K,Z,ve.point,ie,Oe,W,ze,P.projection,z);re=dt.useVertical,ze&&dt.needsFlipping&&(Oe={}),(dt.notEnoughRoom||re||dt.needsFlipping&&Hl(te,Ae,!0,E,i,_,y,h.glyphOffsetArray,K,Z,ve.point,ie,Oe,W,ze,P.projection,z).notEnoughRoom)&&Rn(te.numGlyphs,Z)}d?h.text.dynamicLayoutVertexBuffer.updateData(Z):h.icon.dynamicLayoutVertexBuffer.updateData(Z)}function Wl(h,i,a,d,_,y,b,E,I,z,P,R,j,X,Z){const K=E.glyphStartIndex+E.numGlyphs,ae=E.lineStartIndex,W=E.lineStartIndex+E.lineLength,re=i.getoffsetX(E.glyphStartIndex),ne=i.getoffsetX(K-1),te=za(h*re,a,d,_,y,b,E.segment,ae,W,I,z,P,R,j,!0,X,Z);if(!te)return null;const ie=za(h*ne,a,d,_,y,b,E.segment,ae,W,I,z,P,R,j,!0,X,Z);return ie?{first:te,last:ie}:null}function ka(h,i,a,d){return h.writingMode===o.WritingMode.horizontal&&Math.abs(a.y-i.y)>Math.abs(a.x-i.x)*d?{useVertical:!0}:h.writingMode===o.WritingMode.vertical?i.y<a.y?{needsFlipping:!0}:null:h.flipState!==0&&function(_,y,b){const E=(y.x-_.x)*b;return E===0||Math.abs((y.y-_.y)/E)>Ci}(i,a,d)?h.flipState===1?{needsFlipping:!0}:null:i.x>a.x?{needsFlipping:!0}:null}function Hl(h,i,a,d,_,y,b,E,I,z,P,R,j,X,Z,K,ae){const W=i/24,re=h.lineOffsetX*W,ne=h.lineOffsetY*W;let te;if(h.numGlyphs>1){const ie=h.glyphStartIndex+h.numGlyphs,se=h.lineStartIndex,ge=h.lineStartIndex+h.lineLength,Te=Wl(W,E,re,ne,a,P,R,h,I,y,j,Z,!1,K,ae);if(!Te)return{notEnoughRoom:!0};const Ke=Yi(Te.first.point,b).point,je=Yi(Te.last.point,b).point;if(d&&!a){const Ve=ka(h,Ke,je,X);if(h.flipState=Ve&&Ve.needsFlipping?1:2,Ve)return Ve}te=[Te.first];for(let Ve=h.glyphStartIndex+1;Ve<ie-1;Ve++)te.push(za(W*E.getoffsetX(Ve),re,ne,a,P,R,h.segment,se,ge,I,y,j,Z,!1,!1,K,ae));te.push(Te.last)}else{if(d&&!a){const se=Yi(R,_).point,ge=h.lineStartIndex+h.segment+1,Te=new o.pointGeometry(I.getx(ge),I.gety(ge)),Ke=Yi(Te,_),je=ka(h,se,Ke.signedDistanceFromCamera>0?Ke.point:Es(R,Te,se,1,_,void 0,K,ae.canonical),X);if(h.flipState=je&&je.needsFlipping?1:2,je)return je}const ie=za(W*E.getoffsetX(h.glyphStartIndex),re,ne,a,P,R,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,I,y,j,Z,!1,!1,K,ae);if(!ie)return{notEnoughRoom:!0};te=[ie]}for(const ie of te)o.addDynamicAttributes(z,ie.point,ie.angle);return{}}function Ss(h,i,a,d,_){const y=d.projectTilePoint(h.x,h.y,i);if(!_)return Yi(y,a,y.z);const b=_(h);return Yi(new o.pointGeometry(y.x+b[0],y.y+b[1]),a,y.z+b[2])}function Es(h,i,a,d,_,y,b,E){const I=Ss(h.add(h.sub(i)._unit()),E,_,b,y).point,z=a.sub(I);return a.add(z._mult(d/z.mag()))}function za(h,i,a,d,_,y,b,E,I,z,P,R,j,X,Z,K,ae){const W=d?h-i:h+i;let re=W>0?1:-1,ne=0;d&&(re*=-1,ne=Math.PI),re<0&&(ne+=Math.PI);let te=re>0?E+b:E+b+1,ie=_,se=_,ge=0,Te=0;const Ke=Math.abs(W),je=[],Ve=[];let Ae=y;const ve=()=>{const Xe=te-re;return ge===0?y:new o.pointGeometry(z.getx(Xe),z.gety(Xe))},Oe=()=>Es(ve(),Ae,se,Ke-ge+1,P,j,K,ae.canonical);for(;ge+Te<=Ke;){if(te+=re,te<E||te>=I)return null;if(se=ie,je.push(ie),X&&Ve.push(Ae||ve()),ie=R[te],ie===void 0){Ae=new o.pointGeometry(z.getx(te),z.gety(te));const Xe=Ss(Ae,ae.canonical,P,K,j);ie=Xe.signedDistanceFromCamera>0?R[te]=Xe.point:Oe()}else Ae=null;ge+=Te,Te=se.dist(ie)}Z&&j&&(Ae=Ae||new o.pointGeometry(z.getx(te),z.gety(te)),R[te]=ie=R[te]===void 0?ie:Oe(),Te=se.dist(ie));const ze=(Ke-ge)/Te,dt=ie.sub(se),yt=dt.mult(ze)._add(se);a&&yt._add(dt._unit()._perp()._mult(a*re));const Rt=ne+Math.atan2(ie.y-se.y,ie.x-se.x);return je.push(yt),X&&(Ae=Ae||new o.pointGeometry(z.getx(te),z.gety(te)),Ve.push(function(Xe,_t,Mt){const yi=1-Mt;return new o.pointGeometry(Xe.x*yi+_t.x*Mt,Xe.y*yi+_t.y*Mt)}(Ve.length>0?Ve[Ve.length-1]:Ae,Ae,ze))),{point:yt,angle:Rt,path:je,tilePath:Ve}}const Xl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Rn(h,i){for(let a=0;a<h;a++){const d=i.length;i.resize(d+4),i.float32.set(Xl,3*d)}}function Pa(h,i,a){const d=i[0],_=i[1];return h[0]=a[0]*d+a[4]*_+a[12],h[1]=a[1]*d+a[5]*_+a[13],h[3]=a[3]*d+a[7]*_+a[15],h}const Zn=100;class Zd{constructor(i,a,d=new gi(i.width+200,i.height+200,25),_=new gi(i.width+200,i.height+200,25)){this.transform=i,this.grid=d,this.ignoredGrid=_,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Zn,this.screenBottomBoundary=i.height+Zn,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=a}placeCollisionBox(i,a,d,_,y,b,E){let I=a.projectedAnchorX,z=a.projectedAnchorY,P=a.projectedAnchorZ;const R=a.elevation,j=a.tileID;if(R&&j){const te=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),ie=te.upVector(j.canonical,a.tileAnchorX,a.tileAnchorY),se=te.upVectorScale(j.canonical);I+=ie[0]*R*se,z+=ie[1]*R*se,P+=ie[2]*R*se}const X=this.projectAndGetPerspectiveRatio(b,I,z,P,a.tileID),Z=y*X.perspectiveRatio,K=(a.x1*i+d.x-a.padding)*Z+X.point.x,ae=(a.y1*i+d.y-a.padding)*Z+X.point.y,W=(a.x2*i+d.x+a.padding)*Z+X.point.x,re=(a.y2*i+d.y+a.padding)*Z+X.point.y,ne=X.perspectiveRatio<=.55||X.aboveHorizon;return!this.isInsideGrid(K,ae,W,re)||!_&&this.grid.hitTest(K,ae,W,re,E)||ne?{box:[],offscreen:!1}:{box:[K,ae,W,re],offscreen:this.isOffscreen(K,ae,W,re)}}placeCollisionCircles(i,a,d,_,y,b,E,I,z,P,R,j,X,Z){const K=[],ae=this.transform.elevation,W=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),re=ae?ae.getAtTileOffsetFunc(Z,W):ze=>[0,0,0],ne=new o.pointGeometry(a.tileAnchorX,a.tileAnchorY),te=this.transform.projection.projectTilePoint(a.tileAnchorX,a.tileAnchorY,Z.canonical),ie=re(ne),se=[te.x+ie[0],te.y+ie[1],te.z+ie[2]],ge=this.projectAndGetPerspectiveRatio(b,se[0],se[1],se[2],Z),{perspectiveRatio:Te}=ge,Ke=(P?y/Te:y*Te)/o.ONE_EM,je=Yi(new o.pointGeometry(se[0],se[1]),E,se[2]).point,Ve=ge.signedDistanceFromCamera>0?Wl(Ke,_,a.lineOffsetX*Ke,a.lineOffsetY*Ke,!1,je,ne,a,d,E,{},ae&&!P?re:null,P&&!!ae,this.transform.projection,Z):null;let Ae=!1,ve=!1,Oe=!0;if(Ve&&!ge.aboveHorizon){const ze=.5*j*Te+X,dt=new o.pointGeometry(-100,-100),yt=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Rt=new bi,Xe=Ve.first,_t=Ve.last;let Mt=[];for(let St=Xe.path.length-1;St>=1;St--)Mt.push(Xe.path[St]);for(let St=1;St<_t.path.length;St++)Mt.push(_t.path[St]);const yi=2.5*ze;if(I){const St=Mt.map(ae?(Vt,Bi)=>{const ur=re(Bi<Xe.path.length-1?Xe.tilePath[Xe.path.length-1-Bi]:_t.tilePath[Bi-Xe.path.length+2]);return Yi(Vt,I,ur[2])}:Vt=>Yi(Vt,I));Mt=St.some(Vt=>Vt.signedDistanceFromCamera<=0)?[]:St.map(Vt=>Vt.point)}let Mi=[];if(Mt.length>0){const St=Mt[0].clone(),Vt=Mt[0].clone();for(let Bi=1;Bi<Mt.length;Bi++)St.x=Math.min(St.x,Mt[Bi].x),St.y=Math.min(St.y,Mt[Bi].y),Vt.x=Math.max(Vt.x,Mt[Bi].x),Vt.y=Math.max(Vt.y,Mt[Bi].y);Mi=St.x>=dt.x&&Vt.x<=yt.x&&St.y>=dt.y&&Vt.y<=yt.y?[Mt]:Vt.x<dt.x||St.x>yt.x||Vt.y<dt.y||St.y>yt.y?[]:o.clipLine([Mt],dt.x,dt.y,yt.x,yt.y)}for(const St of Mi){Rt.reset(St,.25*ze);let Vt=0;Vt=Rt.length<=.5*ze?1:Math.ceil(Rt.paddedLength/yi)+1;for(let Bi=0;Bi<Vt;Bi++){const ur=Bi/Math.max(Vt-1,1),Wr=Rt.lerp(ur),bn=Wr.x+Zn,Un=Wr.y+Zn;K.push(bn,Un,ze,0);const Qt=bn-ze,It=Un-ze,qt=bn+ze,Xi=Un+ze;if(Oe=Oe&&this.isOffscreen(Qt,It,qt,Xi),ve=ve||this.isInsideGrid(Qt,It,qt,Xi),!i&&this.grid.hitTestCircle(bn,Un,ze,R)&&(Ae=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Ae}}}}return{circles:!z&&Ae||!ve?[]:K,offscreen:Oe,collisionDetected:Ae}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let d=1/0,_=1/0,y=-1/0,b=-1/0;for(const P of i){const R=new o.pointGeometry(P.x+Zn,P.y+Zn);d=Math.min(d,R.x),_=Math.min(_,R.y),y=Math.max(y,R.x),b=Math.max(b,R.y),a.push(R)}const E=this.grid.query(d,_,y,b).concat(this.ignoredGrid.query(d,_,y,b)),I={},z={};for(const P of E){const R=P.key;if(I[R.bucketInstanceId]===void 0&&(I[R.bucketInstanceId]={}),I[R.bucketInstanceId][R.featureIndex])continue;const j=[new o.pointGeometry(P.x1,P.y1),new o.pointGeometry(P.x2,P.y1),new o.pointGeometry(P.x2,P.y2),new o.pointGeometry(P.x1,P.y2)];o.polygonIntersectsPolygon(a,j)&&(I[R.bucketInstanceId][R.featureIndex]=!0,z[R.bucketInstanceId]===void 0&&(z[R.bucketInstanceId]=[]),z[R.bucketInstanceId].push(R.featureIndex))}return z}insertCollisionBox(i,a,d,_,y){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:y},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,a,d,_,y){const b=a?this.ignoredGrid:this.grid,E={bucketInstanceId:d,featureIndex:_,collisionGroupID:y};for(let I=0;I<i.length;I+=4)b.insertCircle(E,i[I],i[I+1],i[I+2])}projectAndGetPerspectiveRatio(i,a,d,_,y){const b=[a,d,_||0,1];let E=!1;if(_||this.transform.pitch>0){o.transformMat4$1(b,b,i);let I=!1;this.fogState&&y&&(I=function(z,P,R,j,X,Z){const K=Z.calculateFogTileMatrix(X),ae=[P,R,j];return o.transformMat4(ae,ae,K),st(z,ae,Z.pitch,Z._fov)}(this.fogState,a,d,_||0,y.toUnwrapped(),this.transform)>.9),E=b[2]>b[3]||I}else Pa(b,b,i);return{point:new o.pointGeometry((b[0]/b[3]+1)/2*this.transform.width+Zn,(-b[1]/b[3]+1)/2*this.transform.height+Zn),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/b[3]*.5,1.5),signedDistanceFromCamera:b[3],aboveHorizon:E}}isOffscreen(i,a,d,_){return d<Zn||i>=this.screenRightBoundary||_<Zn||a>this.screenBottomBoundary}isInsideGrid(i,a,d,_){return d>=0&&i<this.gridRightBoundary&&_>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const i=o.identity([]);return o.translate(i,i,[-100,-100,0]),i}}class Mu{constructor(i,a,d,_){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?a:-a))):_&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Jo{constructor(i,a,d,_,y,b=!1){this.text=new Mu(i?i.text:null,a,d,y),this.icon=new Mu(i?i.icon:null,a,_,y),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Qo{constructor(i,a,d,_=!1){this.text=i,this.icon=a,this.skipFade=d,this.clipped=_}}class Da{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Iu{constructor(i,a,d,_,y){this.bucketInstanceId=i,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=_,this.tileID=y}}class ku{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const a=++this.maxGroupID;this.collisionGroups[i]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[i]}}function As(h,i,a,d,_){const{horizontalAlign:y,verticalAlign:b}=o.getAnchorAlignment(h),E=-(y-.5)*i,I=-(b-.5)*a,z=o.evaluateVariableOffset(h,d);return new o.pointGeometry(E+z[0]*_,I+z[1]*_)}function go(h,i,a,d,_){const y=new o.pointGeometry(h,i);return a&&y._rotate(d?_:-_),y}class Cs{constructor(i,a,d,_,y){this.transform=i.clone(),this.collisionIndex=new Zd(this.transform,y),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new ku(d),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,a,d,_){const y=d.getBucket(a),b=d.latestFeatureIndex;if(!y||!b||a.id!==y.layerIds[0])return;const E=y.layers[0].layout,I=d.collisionBoxArray,z=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),P=d.tileSize/o.EXTENT,R=d.tileID.toUnwrapped(),j=this.transform.calculateProjMatrix(R),X=E.get("text-pitch-alignment")==="map",Z=E.get("text-rotation-alignment")==="map";a.compileFilter();const K=a.dynamicFilter(),ae=a.dynamicFilterNeedsFeature(),W=this.transform.calculatePixelsToTileUnitsMatrix(d),re=mn(j,d.tileID.canonical,X,Z,this.transform,W);let ne=null;if(X){const se=_n(j,d.tileID.canonical,X,Z,this.transform,W);ne=o.multiply$1([],this.transform.labelPlaneMatrix,se)}let te=null;K&&d.latestFeatureIndex&&(te={unwrappedTileID:R,dynamicFilter:K,dynamicFilterNeedsFeature:ae,featureIndex:d.latestFeatureIndex}),this.retainedQueryData[y.bucketInstanceId]=new Iu(y.bucketInstanceId,b,y.sourceLayerIndex,y.index,d.tileID);const ie={bucket:y,layout:E,posMatrix:j,textLabelPlaneMatrix:re,labelToScreenMatrix:ne,clippingData:te,scale:z,textPixelRatio:P,holdingForFade:d.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(y.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(_)for(const se of y.sortKeyRanges){const{sortKey:ge,symbolInstanceStart:Te,symbolInstanceEnd:Ke}=se;i.push({sortKey:ge,symbolInstanceStart:Te,symbolInstanceEnd:Ke,parameters:ie})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(i,a,d,_,y,b,E,I,z,P,R,j,X,Z,K,ae,W,re){const ne=[j.textOffset0,j.textOffset1],te=As(i,d,_,ne,y),ie=this.collisionIndex.placeCollisionBox(y,a,go(te.x,te.y,b,E,this.transform.angle),R,I,z,P.predicate);if((!ae||this.collisionIndex.placeCollisionBox(Z.getSymbolInstanceIconSize(re,this.transform.zoom,X),ae,go(te.x,te.y,b,E,this.transform.angle),R,I,z,P.predicate).box.length!==0)&&ie.box.length>0){let se;return this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(se=this.prevPlacement.variableOffsets[j.crossTileID].anchor),this.variableOffsets[j.crossTileID]={textOffset:ne,width:d,height:_,anchor:i,textScale:y,prevAnchor:se},this.markUsedJustification(Z,i,j,K),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,K,j),this.placedOrientations[j.crossTileID]=K),{shift:te,placedGlyphBoxes:ie}}}placeLayerBucketPart(i,a,d,_){const{bucket:y,layout:b,posMatrix:E,textLabelPlaneMatrix:I,labelToScreenMatrix:z,clippingData:P,textPixelRatio:R,holdingForFade:j,collisionBoxArray:X,partiallyEvaluatedTextSize:Z,partiallyEvaluatedIconSize:K,collisionGroup:ae}=i.parameters,W=b.get("text-optional"),re=b.get("icon-optional"),ne=b.get("text-allow-overlap"),te=b.get("icon-allow-overlap"),ie=b.get("text-rotation-alignment")==="map",se=b.get("text-pitch-alignment")==="map",ge=b.get("icon-text-fit")!=="none",Te=b.get("symbol-z-order")==="viewport-y",Ke=ne&&(te||!y.hasIconData()||re),je=te&&(ne||!y.hasTextData()||W);!y.collisionArrays&&X&&y.deserializeCollisionBoxes(X),d&&_&&y.updateCollisionDebugBuffers(this.transform.zoom,X);const Ve=(Ae,ve,Oe)=>{if(P){const Qt={zoom:this.transform.zoom,pitch:this.transform.pitch};let It=null;if(P.dynamicFilterNeedsFeature){const qt=this.retainedQueryData[y.bucketInstanceId];It=P.featureIndex.loadFeature({featureIndex:Ae.featureIndex,bucketIndex:qt.bucketIndex,sourceLayerIndex:qt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,P.dynamicFilter)(Qt,It,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new o.pointGeometry(Ae.tileAnchorX,Ae.tileAnchorY),this.transform.calculateDistanceTileData(P.unwrappedTileID)))return this.placements[Ae.crossTileID]=new Qo(!1,!1,!1,!0),void(a[Ae.crossTileID]=!0)}if(a[Ae.crossTileID])return;if(j)return void(this.placements[Ae.crossTileID]=new Qo(!1,!1,!1));let ze=!1,dt=!1,yt=!0,Rt=null,Xe={box:null,offscreen:null},_t={box:null,offscreen:null},Mt=null,yi=null,Mi=null,St=0,Vt=0,Bi=0;Oe.textFeatureIndex?St=Oe.textFeatureIndex:Ae.useRuntimeCollisionCircles&&(St=Ae.featureIndex),Oe.verticalTextFeatureIndex&&(Vt=Oe.verticalTextFeatureIndex);const ur=Qt=>{Qt.tileID=this.retainedQueryData[y.bucketInstanceId].tileID,(this.transform.elevation||Qt.elevation)&&(Qt.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[y.bucketInstanceId].tileID,Qt.tileAnchorX,Qt.tileAnchorY):0)},Wr=Oe.textBox;if(Wr){ur(Wr);const Qt=qt=>{let Xi=o.WritingMode.horizontal;if(y.allowVerticalPlacement&&!qt&&this.prevPlacement){const an=this.prevPlacement.placedOrientations[Ae.crossTileID];an&&(this.placedOrientations[Ae.crossTileID]=an,Xi=an,this.markUsedOrientation(y,Xi,Ae))}return Xi},It=(qt,Xi)=>{if(y.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&Oe.verticalTextBox){for(const an of y.writingModes)if(an===o.WritingMode.vertical?(Xe=Xi(),_t=Xe):Xe=qt(),Xe&&Xe.box&&Xe.box.length)break}else Xe=qt()};if(b.get("text-variable-anchor")){let qt=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ae.crossTileID]){const Li=this.prevPlacement.variableOffsets[Ae.crossTileID];qt.indexOf(Li.anchor)>0&&(qt=qt.filter(sn=>sn!==Li.anchor),qt.unshift(Li.anchor))}const Xi=(Li,sn,ns)=>{const Hr=y.getSymbolInstanceTextSize(Z,Ae,this.transform.zoom,ve),Vo=(Li.x2-Li.x1)*Hr+2*Li.padding,lt=(Li.y2-Li.y1)*Hr+2*Li.padding,gt=ge&&!te?sn:null;gt&&ur(gt);let Tr={box:[],offscreen:!1};const No=ne?2*qt.length:qt.length;for(let Mo=0;Mo<No;++Mo){const kr=this.attemptAnchorPlacement(qt[Mo%qt.length],Li,Vo,lt,Hr,ie,se,R,E,ae,Mo>=qt.length,Ae,ve,y,ns,gt,Z,K);if(kr&&(Tr=kr.placedGlyphBoxes,Tr&&Tr.box&&Tr.box.length)){ze=!0,Rt=kr.shift;break}}return Tr};It(()=>Xi(Wr,Oe.iconBox,o.WritingMode.horizontal),()=>{const Li=Oe.verticalTextBox;return Li&&ur(Li),y.allowVerticalPlacement&&!(Xe&&Xe.box&&Xe.box.length)&&Ae.numVerticalGlyphVertices>0&&Li?Xi(Li,Oe.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),Xe&&(ze=Xe.box,yt=Xe.offscreen);const an=Qt(Xe&&Xe.box);if(!ze&&this.prevPlacement){const Li=this.prevPlacement.variableOffsets[Ae.crossTileID];Li&&(this.variableOffsets[Ae.crossTileID]=Li,this.markUsedJustification(y,Li.anchor,Ae,an))}}else{const qt=(Xi,an)=>{const Li=y.getSymbolInstanceTextSize(Z,Ae,this.transform.zoom,ve),sn=this.collisionIndex.placeCollisionBox(Li,Xi,new o.pointGeometry(0,0),ne,R,E,ae.predicate);return sn&&sn.box&&sn.box.length&&(this.markUsedOrientation(y,an,Ae),this.placedOrientations[Ae.crossTileID]=an),sn};It(()=>qt(Wr,o.WritingMode.horizontal),()=>{const Xi=Oe.verticalTextBox;return y.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&Xi?(ur(Xi),qt(Xi,o.WritingMode.vertical)):{box:null,offscreen:null}}),Qt(Xe&&Xe.box&&Xe.box.length)}}if(Mt=Xe,ze=Mt&&Mt.box&&Mt.box.length>0,yt=Mt&&Mt.offscreen,Ae.useRuntimeCollisionCircles){const Qt=y.text.placedSymbolArray.get(Ae.centerJustifiedTextSymbolIndex>=0?Ae.centerJustifiedTextSymbolIndex:Ae.verticalPlacedTextSymbolIndex),It=o.evaluateSizeForFeature(y.textSizeData,Z,Qt),qt=b.get("text-padding");yi=this.collisionIndex.placeCollisionCircles(ne,Qt,y.lineVertexArray,y.glyphOffsetArray,It,E,I,z,d,se,ae.predicate,Ae.collisionCircleDiameter*It/o.ONE_EM,qt,this.retainedQueryData[y.bucketInstanceId].tileID),ze=ne||yi.circles.length>0&&!yi.collisionDetected,yt=yt&&yi.offscreen}if(Oe.iconFeatureIndex&&(Bi=Oe.iconFeatureIndex),Oe.iconBox){const Qt=It=>{ur(It);const qt=ge&&Rt?go(Rt.x,Rt.y,ie,se,this.transform.angle):new o.pointGeometry(0,0),Xi=y.getSymbolInstanceIconSize(K,this.transform.zoom,ve);return this.collisionIndex.placeCollisionBox(Xi,It,qt,te,R,E,ae.predicate)};_t&&_t.box&&_t.box.length&&Oe.verticalIconBox?(Mi=Qt(Oe.verticalIconBox),dt=Mi.box.length>0):(Mi=Qt(Oe.iconBox),dt=Mi.box.length>0),yt=yt&&Mi.offscreen}const bn=W||Ae.numHorizontalGlyphVertices===0&&Ae.numVerticalGlyphVertices===0,Un=re||Ae.numIconVertices===0;if(bn||Un?Un?bn||(dt=dt&&ze):ze=dt&&ze:dt=ze=dt&&ze,ze&&Mt&&Mt.box&&this.collisionIndex.insertCollisionBox(Mt.box,b.get("text-ignore-placement"),y.bucketInstanceId,_t&&_t.box&&Vt?Vt:St,ae.ID),dt&&Mi&&this.collisionIndex.insertCollisionBox(Mi.box,b.get("icon-ignore-placement"),y.bucketInstanceId,Bi,ae.ID),yi&&(ze&&this.collisionIndex.insertCollisionCircles(yi.circles,b.get("text-ignore-placement"),y.bucketInstanceId,St,ae.ID),d)){const Qt=y.bucketInstanceId;let It=this.collisionCircleArrays[Qt];It===void 0&&(It=this.collisionCircleArrays[Qt]=new Da);for(let qt=0;qt<yi.circles.length;qt+=4)It.circles.push(yi.circles[qt+0]),It.circles.push(yi.circles[qt+1]),It.circles.push(yi.circles[qt+2]),It.circles.push(yi.collisionDetected?1:0)}this.placements[Ae.crossTileID]=new Qo(ze||Ke,dt||je,yt||y.justReloaded),a[Ae.crossTileID]=!0};if(Te){const Ae=y.getSortedSymbolIndexes(this.transform.angle);for(let ve=Ae.length-1;ve>=0;--ve){const Oe=Ae[ve];Ve(y.symbolInstances.get(Oe),Oe,y.collisionArrays[Oe])}}else for(let Ae=i.symbolInstanceStart;Ae<i.symbolInstanceEnd;Ae++)Ve(y.symbolInstances.get(Ae),Ae,y.collisionArrays[Ae]);if(d&&y.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[y.bucketInstanceId];o.invert(Ae.invProjMatrix,E),Ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(i,a,d,_){let y;y=_===o.WritingMode.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(a)];const b=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const E of b)E>=0&&(i.text.placedSymbolArray.get(E).crossTileID=y>=0&&E!==y?0:d.crossTileID)}markUsedOrientation(i,a,d){const _=a===o.WritingMode.horizontal||a===o.WritingMode.horizontalOnly?a:0,y=a===o.WritingMode.vertical?a:0,b=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const E of b)i.text.placedSymbolArray.get(E).placedOrientation=_;d.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const _=a?a.symbolFadeChange(i):1,y=a?a.opacities:{},b=a?a.variableOffsets:{},E=a?a.placedOrientations:{};for(const I in this.placements){const z=this.placements[I],P=y[I];P?(this.opacities[I]=new Jo(P,_,z.text,z.icon,null,z.clipped),d=d||z.text!==P.text.placed||z.icon!==P.icon.placed):(this.opacities[I]=new Jo(null,_,z.text,z.icon,z.skipFade,z.clipped),d=d||z.text||z.icon)}for(const I in y){const z=y[I];if(!this.opacities[I]){const P=new Jo(z,_,!1,!1);P.isHidden()||(this.opacities[I]=P,d=d||z.text.placed||z.icon.placed)}}for(const I in b)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=b[I]);for(const I in E)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=E[I]);d?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:i)}updateLayerOpacities(i,a){const d={};for(const _ of a){const y=_.getBucket(i);y&&_.latestFeatureIndex&&i.id===y.layerIds[0]&&this.updateBucketOpacities(y,d,_.collisionBoxArray)}}updateBucketOpacities(i,a,d){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const _=i.layers[0].layout,y=!!i.layers[0].dynamicFilter(),b=new Jo(null,0,!1,!1,!0),E=_.get("text-allow-overlap"),I=_.get("icon-allow-overlap"),z=_.get("text-variable-anchor"),P=_.get("text-rotation-alignment")==="map",R=_.get("text-pitch-alignment")==="map",j=_.get("icon-text-fit")!=="none",X=new Jo(null,0,E&&(I||!i.hasIconData()||_.get("icon-optional")),I&&(E||!i.hasTextData()||_.get("text-optional")),!0);!i.collisionArrays&&d&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(d);const Z=(ae,W,re)=>{for(let ne=0;ne<W/4;ne++)ae.opacityVertexArray.emplaceBack(re)};let K=0;for(let ae=0;ae<i.symbolInstances.length;ae++){const W=i.symbolInstances.get(ae),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:ne,crossTileID:te}=W;let ie=this.opacities[te];a[te]?ie=b:ie||(ie=X,this.opacities[te]=ie),a[te]=!0;const se=re>0||ne>0,ge=W.numIconVertices>0,Te=this.placedOrientations[W.crossTileID],Ke=Te===o.WritingMode.vertical,je=Te===o.WritingMode.horizontal||Te===o.WritingMode.horizontalOnly;if(!se&&!ge||ie.isHidden()||K++,se){const Ve=Ms(ie.text);Z(i.text,re,Ke?xo:Ve),Z(i.text,ne,je?xo:Ve);const Ae=ie.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(ze=>{ze>=0&&(i.text.placedSymbolArray.get(ze).hidden=Ae||Ke?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=Ae||je?1:0);const ve=this.variableOffsets[W.crossTileID];ve&&this.markUsedJustification(i,ve.anchor,W,Te);const Oe=this.placedOrientations[W.crossTileID];Oe&&(this.markUsedJustification(i,"left",W,Oe),this.markUsedOrientation(i,Oe,W))}if(ge){const Ve=Ms(ie.icon);W.placedIconSymbolIndex>=0&&(Z(i.icon,W.numIconVertices,Ke?xo:Ve),i.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=ie.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(Z(i.icon,W.numVerticalIconVertices,je?xo:Ve),i.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=ie.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Ve=i.collisionArrays[ae];if(Ve){let Ae=new o.pointGeometry(0,0),ve=!0;if(Ve.textBox||Ve.verticalTextBox){if(z){const ze=this.variableOffsets[te];ze?(Ae=As(ze.anchor,ze.width,ze.height,ze.textOffset,ze.textScale),P&&Ae._rotate(R?this.transform.angle:-this.transform.angle)):ve=!1}y&&(ve=!ie.clipped),Ve.textBox&&yo(i.textCollisionBox.collisionVertexArray,ie.text.placed,!ve||Ke,Ae.x,Ae.y),Ve.verticalTextBox&&yo(i.textCollisionBox.collisionVertexArray,ie.text.placed,!ve||je,Ae.x,Ae.y)}const Oe=ve&&Boolean(!je&&Ve.verticalIconBox);Ve.iconBox&&yo(i.iconCollisionBox.collisionVertexArray,ie.icon.placed,Oe,j?Ae.x:0,j?Ae.y:0),Ve.verticalIconBox&&yo(i.iconCollisionBox.collisionVertexArray,ie.icon.placed,!Oe,j?Ae.x:0,j?Ae.y:0)}}}if(i.fullyClipped=K===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ae.invProjMatrix,i.placementViewportMatrix=ae.viewportMatrix,i.collisionCircleArray=ae.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,a){const d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>i}setStale(){this.stale=!0}}function yo(h,i,a,d,_){h.emplaceBack(i?1:0,a?1:0,d||0,_||0),h.emplaceBack(i?1:0,a?1:0,d||0,_||0),h.emplaceBack(i?1:0,a?1:0,d||0,_||0),h.emplaceBack(i?1:0,a?1:0,d||0,_||0)}const Ee=Math.pow(2,25),it=Math.pow(2,24),zu=Math.pow(2,17),vo=Math.pow(2,16),Ji=Math.pow(2,9),eo=Math.pow(2,8),qn=Math.pow(2,1);function Ms(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const i=h.placed?1:0,a=Math.floor(127*h.opacity);return a*Ee+i*it+a*zu+i*vo+a*Ji+i*eo+a*qn+i}const xo=0;class tt{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,a,d,_,y){const b=this._bucketParts;for(;this._currentTileIndex<i.length;)if(a.getBucketParts(b,_,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((E,I)=>E.sortKey-I.sortKey));this._currentPartIndex<b.length;){const E=b[this._currentPartIndex];if(a.placeLayerBucketPart(E,this._seenCrossTileIDs,d,E.symbolInstanceStart===0),this._currentPartIndex++,y())return!0}return!1}}class Zt{constructor(i,a,d,_,y,b,E,I){this.placement=new Cs(i,y,b,E,I),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(i,a,d){const _=o.exported.now(),y=()=>{const b=o.exported.now()-_;return!this._forceFullPlacement&&b>2};for(;this._currentPlacementIndex>=0;){const b=a[i[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=E)&&(!b.maxzoom||b.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new tt(b)),this._inProgressLayer.continuePlacement(d[b.source],this.placement,this._showCollisionBoxes,b,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Bt=512/o.EXTENT/2;class Wn{constructor(i,a,d){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=d;for(let _=0;_<a.length;_++){const y=a.get(_),b=y.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:y.crossTileID,coord:this.getScaledCoordinates(y,i)})}}getScaledCoordinates(i,a){const d=Bt/Math.pow(2,a.canonical.z-this.tileID.canonical.z);return{x:Math.floor((a.canonical.x*o.EXTENT+i.tileAnchorX)*d),y:Math.floor((a.canonical.y*o.EXTENT+i.tileAnchorY)*d)}}findMatches(i,a,d){const _=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let y=0;y<i.length;y++){const b=i.get(y);if(b.crossTileID)continue;const E=this.indexedSymbolInstances[b.key];if(!E)continue;const I=this.getScaledCoordinates(b,a);for(const z of E)if(Math.abs(z.coord.x-I.x)<=_&&Math.abs(z.coord.y-I.y)<=_&&!d[z.crossTileID]){d[z.crossTileID]=!0,b.crossTileID=z.crossTileID;break}}}}class ea{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ot{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const a=Math.round((i-this.lng)/360);if(a!==0)for(const d in this.indexes){const _=this.indexes[d],y={};for(const b in _){const E=_[b];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+a),y[E.tileID.key]=E}this.indexes[d]=y}this.lng=i}addBucket(i,a,d){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let y=0;y<a.symbolInstances.length;y++)a.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const _=this.usedCrossTileIDs[i.overscaledZ];for(const y in this.indexes){const b=this.indexes[y];if(Number(y)>i.overscaledZ)for(const E in b){const I=b[E];I.tileID.isChildOf(i)&&I.findMatches(a.symbolInstances,i,_)}else{const E=b[i.scaledTo(Number(y)).key];E&&E.findMatches(a.symbolInstances,i,_)}}for(let y=0;y<a.symbolInstances.length;y++){const b=a.symbolInstances.get(y);b.crossTileID||(b.crossTileID=d.generate(),_[b.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Wn(i,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(i,a){for(const d in a.indexedSymbolInstances)for(const _ of a.indexedSymbolInstances[d])delete this.usedCrossTileIDs[i][_.crossTileID]}removeStaleBuckets(i){let a=!1;for(const d in this.indexes){const _=this.indexes[d];for(const y in _)i[_[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,_[y]),delete _[y],a=!0)}return a}}class La{constructor(){this.layerIndexes={},this.crossTileIDs=new ea,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,a,d,_){let y=this.layerIndexes[i.id];y===void 0&&(y=this.layerIndexes[i.id]=new Ot);let b=!1;const E={};_.name!=="globe"&&y.handleWrapJump(d);for(const I of a){const z=I.getBucket(i);z&&i.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(I.tileID,z,this.crossTileIDs)&&(b=!0),E[z.bucketInstanceId]=!0)}return y.removeStaleBuckets(E)&&(b=!0),b}pruneUnusedLayers(i){const a={};i.forEach(d=>{a[d]=!0});for(const d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}const bo=(h,i)=>o.emitValidationErrors(h,i&&i.filter(a=>a.identifier!=="source.canvas")),Ra=o.pick(Pe,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),gn=o.pick(Pe,["setCenter","setZoom","setBearing","setPitch"]),Wi=function(){const h={},i=o.spec.$version;for(const a in o.spec.$root){const d=o.spec.$root[a];if(d.required){let _=null;_=a==="version"?i:d.type==="array"?[]:{},_!=null&&(h[a]=_)}}return h}(),qd={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Zr extends o.Evented{constructor(i,a={}){super(),this.map=i,this.dispatcher=new Vi(ue(),this),this.imageManager=new Le,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(i._requestManager,a.localFontFamily?o.LocalGlyphMode.all:a.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,a.localFontFamily||a.localIdeographFontFamily),this.lineAtlas=new o.LineAtlas(256,512),this.crossTileSymbolIndex=new La,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const d=this;this._rtlTextPluginCallback=Zr.registerForPluginStateChange(_=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(y,b)=>{if(o.triggerPluginCompletionEvent(y),b&&b.every(E=>E))for(const E in d._sourceCaches){const I=d._sourceCaches[E],z=I.getSource().type;z!=="vector"&&z!=="geojson"||I.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const y=this.getSource(_.sourceId);if(y&&y.vectorLayerIds)for(const b in this._layers){const E=this._layers[b];E.source===y.id&&this._validateLayer(E)}})}loadURL(i,a={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const d=typeof a.validate=="boolean"?a.validate:!o.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,a.accessToken);const _=this.map._requestManager.transformRequest(i,o.ResourceType.Style);this._request=o.getJSON(_,(y,b)=>{this._request=null,y?this.fire(new o.ErrorEvent(y)):b&&this._load(b,d)})}loadJSON(i,a={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(i,a.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(Wi,!1)}_updateLayerCount(i,a){const d=a?1:-1;i.is3D()&&(this._num3DLayers+=d),i.type==="circle"&&(this._numCircleLayers+=d),i.type==="symbol"&&(this._numSymbolLayers+=d)}_load(i,a){if(a&&bo(this,o.validateStyle(i)))return;this._loaded=!0,this.stylesheet=i,this.updateProjection();for(const _ in i.sources)this.addSource(_,i.sources[_],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const d=Me(this.stylesheet.layers);this._order=d.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of d)_=o.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Se(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&this.terrain.drapeRenderMode===0}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const i=this.map.transform.projection,a=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),d=this.map.transform.projection;if(this._loaded&&(d.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),a){if(d.isReprojectedInTileSpace||i.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(i){this._spriteRequest=function(a,d,_){let y,b,E;const I=o.exported.devicePixelRatio>1?"@2x":"";let z=o.getJSON(d.transformRequest(d.normalizeSpriteURL(a,I,".json"),o.ResourceType.SpriteJSON),(j,X)=>{z=null,E||(E=j,y=X,R())}),P=o.getImage(d.transformRequest(d.normalizeSpriteURL(a,I,".png"),o.ResourceType.SpriteImage),(j,X)=>{P=null,E||(E=j,b=X,R())});function R(){if(E)_(E);else if(y&&b){const j=o.exported.getImageData(b),X={};for(const Z in y){const{width:K,height:ae,x:W,y:re,sdf:ne,pixelRatio:te,stretchX:ie,stretchY:se,content:ge}=y[Z],Te=new o.RGBAImage({width:K,height:ae});o.RGBAImage.copy(j,Te,{x:W,y:re},{x:0,y:0},{width:K,height:ae}),X[Z]={data:Te,pixelRatio:te,sdf:ne,stretchX:ie,stretchY:se,content:ge}}_(null,X)}}return{cancel(){z&&(z.cancel(),z=null),P&&(P.cancel(),P=null)}}}(i,this.map._requestManager,(a,d)=>{if(this._spriteRequest=null,a)this.fire(new o.ErrorEvent(a));else if(d)for(const _ in d)this.imageManager.addImage(_,d[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(i){const a=this.getSource(i.source);if(!a)return;const d=i.sourceLayer;d&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(d)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${d}" does not exist on source "${a.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const a=[];for(const d of i){const _=this._layers[d];_.type!=="custom"&&a.push(_.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&qd[i.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const a=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(_.length||y.length)&&this._updateWorkerLayers(_,y);for(const b in this._updatedSources){const E=this._updatedSources[b];E==="reload"?this._reloadSource(b):E==="clear"&&this._clearSource(b)}this._updateTilesForChangedImages();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const d={};for(const _ in this._sourceCaches){const y=this._sourceCaches[_];d[_]=y.used,y.used=!1}for(const _ of this._order){const y=this._layers[_];if(y.recalculate(i,this._availableImages),!y.isHidden(i.zoom)){const E=this._getLayerSourceCache(y);E&&(E.used=!0)}const b=this.map.painter;if(b){const E=y.getProgramIds();if(!E)continue;const I=y.getProgramConfiguration(i.zoom);for(const z of E)b.useProgram(z,I)}}for(const _ in d){const y=this._sourceCaches[_];d[_]!==y.used&&y.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:y.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),a&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),bo(this,o.validateStyle(i)))return!1;(i=o.clone$1(i)).layers=Me(i.layers);const a=function(_,y){if(!_)return[{command:Pe.setStyle,args:[y]}];let b=[];try{if(!Y(_.version,y.version))return[{command:Pe.setStyle,args:[y]}];Y(_.center,y.center)||b.push({command:Pe.setCenter,args:[y.center]}),Y(_.zoom,y.zoom)||b.push({command:Pe.setZoom,args:[y.zoom]}),Y(_.bearing,y.bearing)||b.push({command:Pe.setBearing,args:[y.bearing]}),Y(_.pitch,y.pitch)||b.push({command:Pe.setPitch,args:[y.pitch]}),Y(_.sprite,y.sprite)||b.push({command:Pe.setSprite,args:[y.sprite]}),Y(_.glyphs,y.glyphs)||b.push({command:Pe.setGlyphs,args:[y.glyphs]}),Y(_.transition,y.transition)||b.push({command:Pe.setTransition,args:[y.transition]}),Y(_.light,y.light)||b.push({command:Pe.setLight,args:[y.light]}),Y(_.fog,y.fog)||b.push({command:Pe.setFog,args:[y.fog]}),Y(_.projection,y.projection)||b.push({command:Pe.setProjection,args:[y.projection]});const E={},I=[];(function(R,j,X,Z){let K;for(K in j=j||{},R=R||{})R.hasOwnProperty(K)&&(j.hasOwnProperty(K)||ht(K,X,Z));for(K in j)j.hasOwnProperty(K)&&(R.hasOwnProperty(K)?Y(R[K],j[K])||(R[K].type==="geojson"&&j[K].type==="geojson"&&pt(R,j,K)?X.push({command:Pe.setGeoJSONSourceData,args:[K,j[K].data]}):ft(K,j,X,Z)):Fe(K,j,X))})(_.sources,y.sources,I,E);const z=[];_.layers&&_.layers.forEach(R=>{E[R.source]?b.push({command:Pe.removeLayer,args:[R.id]}):z.push(R)});let P=_.terrain;P&&E[P.source]&&(b.push({command:Pe.setTerrain,args:[void 0]}),P=void 0),b=b.concat(I),Y(P,y.terrain)||b.push({command:Pe.setTerrain,args:[y.terrain]}),function(R,j,X){j=j||[];const Z=(R=R||[]).map(Lt),K=j.map(Lt),ae=R.reduce(mi,{}),W=j.reduce(mi,{}),re=Z.slice(),ne=Object.create(null);let te,ie,se,ge,Te,Ke,je;for(te=0,ie=0;te<Z.length;te++)se=Z[te],W.hasOwnProperty(se)?ie++:(X.push({command:Pe.removeLayer,args:[se]}),re.splice(re.indexOf(se,ie),1));for(te=0,ie=0;te<K.length;te++)se=K[K.length-1-te],re[re.length-1-te]!==se&&(ae.hasOwnProperty(se)?(X.push({command:Pe.removeLayer,args:[se]}),re.splice(re.lastIndexOf(se,re.length-ie),1)):ie++,Ke=re[re.length-te],X.push({command:Pe.addLayer,args:[W[se],Ke]}),re.splice(re.length-te,0,se),ne[se]=!0);for(te=0;te<K.length;te++)if(se=K[te],ge=ae[se],Te=W[se],!ne[se]&&!Y(ge,Te))if(Y(ge.source,Te.source)&&Y(ge["source-layer"],Te["source-layer"])&&Y(ge.type,Te.type)){for(je in mt(ge.layout,Te.layout,X,se,null,Pe.setLayoutProperty),mt(ge.paint,Te.paint,X,se,null,Pe.setPaintProperty),Y(ge.filter,Te.filter)||X.push({command:Pe.setFilter,args:[se,Te.filter]}),Y(ge.minzoom,Te.minzoom)&&Y(ge.maxzoom,Te.maxzoom)||X.push({command:Pe.setLayerZoomRange,args:[se,Te.minzoom,Te.maxzoom]}),ge)ge.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&(je.indexOf("paint.")===0?mt(ge[je],Te[je],X,se,je.slice(6),Pe.setPaintProperty):Y(ge[je],Te[je])||X.push({command:Pe.setLayerProperty,args:[se,je,Te[je]]}));for(je in Te)Te.hasOwnProperty(je)&&!ge.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&(je.indexOf("paint.")===0?mt(ge[je],Te[je],X,se,je.slice(6),Pe.setPaintProperty):Y(ge[je],Te[je])||X.push({command:Pe.setLayerProperty,args:[se,je,Te[je]]}))}else X.push({command:Pe.removeLayer,args:[se]}),Ke=re[re.lastIndexOf(se)+1],X.push({command:Pe.addLayer,args:[Te,Ke]})}(z,y.layers,b)}catch(E){console.warn("Unable to compute style diff:",E),b=[{command:Pe.setStyle,args:[y]}]}return b}(this.serialize(),i).filter(_=>!(_.command in gn));if(a.length===0)return!1;const d=a.filter(_=>!(_.command in Ra));if(d.length>0)throw new Error(`Unimplemented: ${d.map(_=>_.command).join(", ")}.`);return a.forEach(_=>{_.command!=="setTransition"&&this[_.command].apply(this,_.args)}),this.stylesheet=i,this.updateProjection(),!0}addImage(i,a){if(this.getImage(i))return this.fire(new o.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(i,a),this._afterImageUpdated(i)}updateImage(i,a){this.imageManager.updateImage(i,a)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new o.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,a,d={}){if(this._checkLoaded(),this.getSource(i)!==void 0)throw new Error("There is already a source with this ID");if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(o.validateStyle.source,`sources.${i}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const _=ji(i,a,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:i}));const y=b=>{const E=(b?"symbol:":"other:")+i,I=this._sourceCaches[E]=new o.SourceCache(E,_,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[i]=I,I.style=this,I.onAdd(this.map)};y(!1),a.type!=="vector"&&a.type!=="geojson"||y(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const a=this.getSource(i);if(a===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===i)return this.fire(new o.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new o.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const d=this._getSourceCaches(i);for(const _ of d)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,a){this._checkLoaded(),this.getSource(i).setData(a),this._changed=!0}getSource(i){const a=this._getSourceCache(i);return a&&a.getSource()}addLayer(i,a,d={}){this._checkLoaded();const _=i.id;if(this.getLayer(_))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let y;if(i.type==="custom"){if(bo(this,o.validateCustomStyleLayer(i)))return;y=o.createStyleLayer(i)}else{if(typeof i.source=="object"&&(this.addSource(_,i.source),i=o.clone$1(i),i=o.extend(i,{source:_})),this._validate(o.validateStyle.layer,`layers.${_}`,i,{arrayIndex:-1},d))return;y=o.createStyleLayer(i),this._validateLayer(y),y.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0)}const b=a?this._order.indexOf(a):this._order.length;if(a&&b===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`)));this._order.splice(b,0,_),this._layerOrderChanged=!0,this._layers[_]=y;const E=this._getLayerSourceCache(y);if(this._removedLayers[_]&&y.source&&E&&y.type!=="custom"){const I=this._removedLayers[_];delete this._removedLayers[_],I.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",E.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,a){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===a)return;const d=this._order.indexOf(i);this._order.splice(d,1);const _=a?this._order.indexOf(a):this._order.length;a&&_===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`))):(this._order.splice(_,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const a=this._layers[i];if(!a)return void this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));a.setEventedParent(null),this._updateLayerCount(a,!1);const d=this._order.indexOf(i);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=a,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],a.onRemove&&a.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const a in this._layers)if(this._layers[a].type===i)return!0;return!1}setLayerZoomRange(i,a,d){this._checkLoaded();const _=this.getLayer(i);_?_.minzoom===a&&_.maxzoom===d||(a!=null&&(_.minzoom=a),d!=null&&(_.maxzoom=d),this._updateLayer(_)):this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,a,d={}){this._checkLoaded();const _=this.getLayer(i);if(_){if(!Y(_.filter,a))return a==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(o.validateStyle.filter,`layers.${_.id}.filter`,a,{layerType:_.type},d)||(_.filter=o.clone$1(a),this._updateLayer(_)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){return o.clone$1(this.getLayer(i).filter)}setLayoutProperty(i,a,d,_={}){this._checkLoaded();const y=this.getLayer(i);y?Y(y.getLayoutProperty(a),d)||(y.setLayoutProperty(a,d,_),this._updateLayer(y)):this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,a){const d=this.getLayer(i);if(d)return d.getLayoutProperty(a);this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,a,d,_={}){this._checkLoaded();const y=this.getLayer(i);y?Y(y.getPaintProperty(a),d)||(y.setPaintProperty(a,d,_)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,a){return this.getLayer(i).getPaintProperty(a)}setFeatureState(i,a){this._checkLoaded();const d=i.source,_=i.sourceLayer,y=this.getSource(d);if(y===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const b=y.type;if(b==="geojson"&&_)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!_)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const E=this._getSourceCaches(d);for(const I of E)I.setFeatureState(_,i.id,a)}removeFeatureState(i,a){this._checkLoaded();const d=i.source,_=this.getSource(d);if(_===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const y=_.type,b=y==="vector"?i.sourceLayer:void 0;if(y==="vector"&&!b)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const E=this._getSourceCaches(d);for(const I of E)I.removeFeatureState(b,i.id,a)}getFeatureState(i){this._checkLoaded();const a=i.source,d=i.sourceLayer,_=this.getSource(a);if(_!==void 0){if(_.type!=="vector"||d)return i.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(a)[0].getFeatureState(d,i.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const a in this._sourceCaches){const d=this._sourceCaches[a].getSource();i[d.id]||(i[d.id]=d.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},a=>a!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0;const a=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&a&&a.getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",a.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const a=b=>this._layers[b].type==="fill-extrusion",d={},_=[];for(let b=this._order.length-1;b>=0;b--){const E=this._order[b];if(a(E)){d[E]=b;for(const I of i){const z=I[E];if(z)for(const P of z)_.push(P)}}}_.sort((b,E)=>E.intersectionZ-b.intersectionZ);const y=[];for(let b=this._order.length-1;b>=0;b--){const E=this._order[b];if(a(E))for(let I=_.length-1;I>=0;I--){const z=_[I].feature;if(d[z.layer.id]<b)break;y.push(z),_.pop()}else for(const I of i){const z=I[E];if(z)for(const P of z)y.push(P.feature)}}return y}queryRenderedFeatures(i,a,d){a&&a.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",a.filter,null,a);const _={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const I of a.layers){const z=this._layers[I];if(!z)return this.fire(new o.ErrorEvent(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];_[z.source]=!0}}const y=[];a.availableImages=this._availableImages;const b=a&&a.layers?a.layers.some(I=>{const z=this.getLayer(I);return z&&z.is3D()}):this.has3DLayers(),E=xi.createFromScreenPoints(i,d);for(const I in this._sourceCaches){const z=this._sourceCaches[I].getSource().id;a.layers&&!_[z]||y.push(D(this._sourceCaches[I],this._layers,this._serializedLayers,E,a,d,b,!!this.map._showQueryGeometry))}return this.placement&&y.push(function(I,z,P,R,j,X,Z){const K={},ae=X.queryRenderedSymbols(R),W=[];for(const re of Object.keys(ae).map(Number))W.push(Z[re]);W.sort(H);for(const re of W){const ne=re.featureIndex.lookupSymbolFeatures(ae[re.bucketInstanceId],z,re.bucketIndex,re.sourceLayerIndex,j.filter,j.layers,j.availableImages,I);for(const te in ne){const ie=K[te]=K[te]||[],se=ne[te];se.sort((ge,Te)=>{const Ke=re.featureSortOrder;if(Ke){const je=Ke.indexOf(ge.featureIndex);return Ke.indexOf(Te.featureIndex)-je}return Te.featureIndex-ge.featureIndex});for(const ge of se)ie.push(ge)}}for(const re in K)K[re].forEach(ne=>{const te=ne.feature,ie=P(I[re]).getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=ie});return K}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),E.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(i,a){a&&a.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",a.filter,null,a);const d=this._getSourceCaches(i);let _=[];for(const y of d)_=_.concat(O(y,a));return _}addSourceType(i,a,d){return Zr.getSourceType(i)?d(new Error(`A source type called "${i}" already exists.`)):(Zr.setSourceType(i,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:a.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(i,a={}){this._checkLoaded();const d=this.light.getLight();let _=!1;for(const b in i)if(!Y(i[b],d[b])){_=!0;break}if(!_)return;const y={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,a),this.light.updateTransitions(y)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,a=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(a===1){if(typeof i.source=="object"){const d="terrain-dem-src";this.addSource(d,i.source),i=o.clone$1(i),i=o.extend(i,{source:d})}if(this._validate(o.validateStyle.terrain,"terrain",i))return}if(!this.terrain||this.terrain&&a!==this.terrain.drapeRenderMode)this._createTerrain(i,a);else{const d=this.terrain,_=d.get();for(const y in i)if(!Y(i[y],_[y])){d.set(i),this.stylesheet.terrain=i;const b={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(b);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const a=this.fog=new Ft(i,this.map.transform);this.stylesheet.fog=i;const d={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};a.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog,d=a.get();for(const _ in i)if(!Y(i[_],d[_])){a.set(i),this.stylesheet.fog=i;const y={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};a.updateTransitions(y);break}}else this._createFog(i);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(d=>this.isLayerDraped(this._layers[d])),a=this._order.filter(d=>!this.isLayerDraped(this._layers[d]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...a)}_createTerrain(i,a){const d=this.terrain=new ot(i,a);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const _={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(_)}_force3DLayerUpdate(){for(const i in this._layers){const a=this._layers[i];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const a=this._layers[i];a.type==="symbol"&&this._updateLayer(a)}}_validate(i,a,d,_,y={}){return(!y||y.validate!==!1)&&bo(this,i.call(o.validateStyle,o.extend({key:a,style:this.serialize(),value:d,styleSpec:o.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const a=this._getSourceCaches(i);for(const d of a)d.clearTiles()}_reloadSource(i){const a=this._getSourceCaches(i);for(const d of a)d.resume(),d.reload()}_updateSources(i){for(const a in this._sourceCaches)this._sourceCaches[a].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const a=this._sourceCaches[i];a.resume(),a.reload()}}_updatePlacement(i,a,d,_,y=!1){let b=!1,E=!1;const I={};for(const z of this._order){const P=this._layers[z];if(P.type!=="symbol")continue;if(!I[P.source]){const j=this._getLayerSourceCache(P);if(!j)continue;I[P.source]=j.getRenderableIds(!0).map(X=>j.getTileByID(X)).sort((X,Z)=>Z.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(Z.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(P,I[P.source],i.center.lng,i.projection);b=b||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),y=y||this._layerOrderChanged||d===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(y||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),i.zoom))&&(this.pauseablePlacement=new Zt(i,this._order,y,a,d,_,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),E=!0),b&&this.pauseablePlacement.placement.setStale()),E||b)for(const z of this._order){const P=this._layers[z];P.type==="symbol"&&this.placement.updateLayerOpacities(P,I[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,a,d){this.imageManager.getImages(a.icons,d),this._updateTilesForChangedImages();const _=y=>{y&&y.setDependencies(a.tileID.key,a.type,a.icons)};_(this._otherSourceCaches[a.source]),_(this._symbolSourceCaches[a.source])}getGlyphs(i,a,d){this.glyphManager.getGlyphs(a.stacks,d)}getResource(i,a,d){return o.makeRequest(a,d)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const a=[];return this._otherSourceCaches[i]&&a.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&a.push(this._symbolSourceCaches[i]),a}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Zr.getSourceType=function(h){return rn[h]},Zr.setSourceType=function(h,i){rn[h]=i},Zr.registerForPluginStateChange=o.registerForPluginStateChange;var Is=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,ta="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let ia={},ra={};ia=Pt("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),ra=Pt(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const ii=Pt(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
return mix(globe,mercator,t);
#else
return globe;
#endif
}
#ifdef PROJECTION_GLOBE_VIEW
mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),ks=Is;var Kl={background:Pt(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Pt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Pt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Pt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Pt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Pt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Pt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Pt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Pt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Pt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Pt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Pt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Pt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Pt(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Pt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Pt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Pt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Pt(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Pt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Pt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Pt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Pt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Pt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Pt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:Pt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Pt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ta),skyboxGradient:Pt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ta),skyboxCapture:Pt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Pt(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:Pt(`uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)
discard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function Pt(h,i,a){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,y=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),b=h.match(_),E=i.match(_),I=Is.match(_);let z=E?E.concat(b):b;a||(ia.staticUniforms&&(z=ia.staticUniforms.concat(z)),ra.staticUniforms&&(z=ra.staticUniforms.concat(z))),z&&(z=z.concat(I));const P={};return{fragmentSource:h=h.replace(d,(R,j,X,Z,K)=>(P[K]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_${K}
varying ${X} ${Z} ${K};
#else
uniform ${X} ${Z} u_${K};
#endif
`:`
#ifdef HAS_UNIFORM_u_${K}
    ${X} ${Z} ${K} = u_${K};
#endif
`)),vertexSource:i=i.replace(d,(R,j,X,Z,K)=>{const ae=Z==="float"?"vec2":"vec4",W=K.match(/color/)?"color":ae;return P[K]?j==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
attribute ${X} ${ae} a_${K};
varying ${X} ${Z} ${K};
#else
uniform ${X} ${Z} u_${K};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = a_${K};
#else
    ${X} ${Z} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = unpack_mix_${W}(a_${K}, u_${K}_t);
#else
    ${X} ${Z} ${K} = u_${K};
#endif
`:j==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
attribute ${X} ${ae} a_${K};
#else
uniform ${X} ${Z} u_${K};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${X} ${Z} ${K} = a_${K};
#else
    ${X} ${Z} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${X} ${Z} ${K} = unpack_mix_${W}(a_${K}, u_${K}_t);
#else
    ${X} ${Z} ${K} = u_${K};
#endif
`}),staticAttributes:y,staticUniforms:z}}class yn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,a,d,_,y,b,E,I){this.context=i;let z=this.boundPaintVertexBuffers.length!==_.length;for(let P=0;!z&&P<_.length;P++)this.boundPaintVertexBuffers[P]!==_[P]&&(z=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===a&&this.boundLayoutVertexBuffer===d&&!z&&this.boundIndexBuffer===y&&this.boundVertexOffset===b&&this.boundDynamicVertexBuffer===E&&this.boundDynamicVertexBuffer2===I?(i.bindVertexArrayOES.set(this.vao),E&&E.bind(),y&&y.dynamicDraw&&y.bind(),I&&I.bind()):this.freshBind(a,d,_,y,b,E,I)}freshBind(i,a,d,_,y,b,E){let I;const z=i.numAttributes,P=this.context,R=P.gl;if(P.extVertexArrayObject)this.vao&&this.destroy(),this.vao=P.extVertexArrayObject.createVertexArrayOES(),P.bindVertexArrayOES.set(this.vao),I=0,this.boundProgram=i,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=_,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=E;else{I=P.currentNumAttributes||0;for(let j=z;j<I;j++)R.disableVertexAttribArray(j)}a.enableAttributes(R,i);for(const j of d)j.enableAttributes(R,i);b&&b.enableAttributes(R,i),E&&E.enableAttributes(R,i),a.bind(),a.setVertexAttribPointers(R,i,y);for(const j of d)j.bind(),j.setVertexAttribPointers(R,i,y);b&&(b.bind(),b.setVertexAttribPointers(R,i,y)),_&&_.bind(),E&&(E.bind(),E.setVertexAttribPointers(R,i,y)),P.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Pu(h,i){const a=Math.pow(2,i.canonical.z),d=i.canonical.y;return[new o.MercatorCoordinate(0,d/a).toLngLat().lat,new o.MercatorCoordinate(0,(d+1)/a).toLngLat().lat]}function zs(h,i,a,d,_,y,b){const E=h.context,I=E.gl,z=a.fbo;if(!z)return;h.prepareDrawTile(i);const P=h.useProgram("hillshade");E.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,z.colorAttachment.get());const R=((K,ae,W,re)=>{const ne=W.paint.get("hillshade-shadow-color"),te=W.paint.get("hillshade-highlight-color"),ie=W.paint.get("hillshade-accent-color");let se=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(se-=K.transform.angle);const ge=!K.options.moving;return{u_matrix:re||K.transform.calculateProjMatrix(ae.tileID.toUnwrapped(),ge),u_image:0,u_latrange:Pu(0,ae.tileID),u_light:[W.paint.get("hillshade-exaggeration"),se],u_shadow:ne,u_highlight:te,u_accent:ie}})(h,a,d,h.terrain?i.projMatrix:null);h.prepareDrawProgram(E,P,i.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:X,tileBoundsSegments:Z}=h.getTileBoundsBuffers(a);P.draw(E,I.TRIANGLES,_,y,b,o.CullFaceMode.disabled,R,d.id,j,X,Z)}function rr(h,i,a){if(!i.needsDEMTextureUpload)return;const d=h.context,_=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||h.getTileTexture(a.stride);const y=a.getPixels();i.demTexture?i.demTexture.update(y,{premultiply:!1}):i.demTexture=new o.Texture(d,y,_.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function Ba(h,i,a,d,_,y){const b=h.context,E=b.gl;if(!i.dem)return;const I=i.dem;if(b.activeTexture.set(E.TEXTURE1),rr(h,i,I),!i.demTexture)return;i.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const z=I.dim;b.activeTexture.set(E.TEXTURE0);let P=i.fbo;if(!P){const Z=new o.Texture(b,{width:z,height:z,data:null},E.RGBA);Z.bind(E.LINEAR,E.CLAMP_TO_EDGE),P=i.fbo=b.createFramebuffer(z,z,!0),P.colorAttachment.set(Z.texture)}b.bindFramebuffer.set(P.framebuffer),b.viewport.set([0,0,z,z]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:j,tileBoundsSegments:X}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(b,E.TRIANGLES,d,_,y,o.CullFaceMode.disabled,((Z,K)=>{const ae=K.stride,W=o.create();return o.ortho(W,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(W,W,[0,-o.EXTENT,0]),{u_matrix:W,u_image:1,u_dimension:[ae,ae],u_zoom:Z.overscaledZ,u_unpack:K.unpackVector}})(i.tileID,I),a.id,R,j,X),i.needsHillshadePrepare=!1}const wo=(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_image0:new o.Uniform1i(h,i.u_image0),u_skirt_height:new o.Uniform1f(h,i.u_skirt_height)}),br=(h,i)=>({u_matrix:h,u_image0:0,u_skirt_height:i}),Ps=(h,i,a,d,_)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:i,u_merc_matrix:a,u_zoom_transition:d,u_merc_center:_,u_image0:0});function vn(h,i){return h!=null&&i!=null&&!(!h.hasData()||!i.hasData())&&h.demTexture!=null&&i.demTexture!=null&&h.tileID.key!==i.tileID.key}const Hn=new class{constructor(){this.operations={}}newMorphing(h,i,a,d,_){if(h in this.operations){const y=this.operations[h];y.to.tileID.key!==a.tileID.key&&(y.queued=a)}else this.operations[h]={startTime:d,phase:0,duration:_,from:i,to:a,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const i=this.operations[h];return{from:i.from,to:i.to,phase:i.phase}}update(h){for(const i in this.operations){const a=this.operations[i];for(a.phase=(h-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,h)){delete this.operations[i];break}}}_nextOp(h,i){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=i,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Oo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Wd(h,i){const a=1<<h.z;return!i&&(h.x===0||h.x===a-1)||h.y===0||h.y===a-1}const Xn=h=>({u_matrix:h});function Du(h,i,a,d,_){if(_>0){const y=o.exported.now(),b=(y-h.timeAdded)/_,E=i?(y-i.timeAdded)/_:-1,I=a.getSource(),z=d.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),P=!i||Math.abs(i.tileID.overscaledZ-z)>Math.abs(h.tileID.overscaledZ-z),R=P&&h.refreshedUponExpiration?1:o.clamp(P?b:1-E,0,1);return h.refreshedUponExpiration&&b>=1&&(h.refreshedUponExpiration=!1),i?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}class Lu extends o.SourceCache{constructor(i){const a={type:"raster-dem",maxzoom:i.transform.maxZoom},d=new Vi(ue(),null),_=ji("mock-dem",a,d,i.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,a){i.state="loaded",a(null)}}class on extends o.SourceCache{constructor(i){const a=ji("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new Vi(ue(),null),i.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,a,d){if(i.freezeTileCoverage)return;this.transform=i;const _=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,b)=>{if(y[b.key]="",!this._tiles[b.key]){const E=new o.Tile(b,this._source.tileSize*b.overscaleFactor(),i.tileZoom);E.state="loaded",this._tiles[b.key]=E}return y},{});for(const y in this._tiles)y in _||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(i){const a=this.proxyCachedFBO[i];if(a!==void 0){const d=Object.values(a);this.renderCachePool.push(...d),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Oa extends o.OverscaledTileID{constructor(i,a,d){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=a,this.projMatrix=d}}class To extends o.Elevation{constructor(i,a){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,_,y]=function(I){const z=new o.StructArrayLayout4i8,P=new o.StructArrayLayout3ui6,R=131;z.reserve(17161),P.reserve(33800);const j=o.EXTENT/128,X=o.EXTENT+j/2,Z=X+j;for(let ae=-j;ae<Z;ae+=j)for(let W=-j;W<Z;W+=j){const re=W<0||W>X||ae<0||ae>X?24575:0,ne=o.clamp(Math.round(W),0,o.EXTENT),te=o.clamp(Math.round(ae),0,o.EXTENT);z.emplaceBack(ne+re,te,ne,te)}const K=(ae,W)=>{const re=W*R+ae;P.emplaceBack(re+1,re,re+R),P.emplaceBack(re+R,re+R+1,re+1)};for(let ae=1;ae<129;ae++)for(let W=1;W<129;W++)K(W,ae);return[0,129].forEach(ae=>{for(let W=0;W<130;W++)K(W,ae),K(ae,W)}),[z,P,32768]}(),b=i.context;this.gridBuffer=b.createVertexBuffer(d,o.boundsAttributes.members),this.gridIndexBuffer=b.createIndexBuffer(_),this.gridSegments=o.SegmentVector.simpleSegment(0,0,d.length,_.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,d.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new on(a.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,0,o.EXTENT,0,o.EXTENT,0,1);const E=b.gl;this._overlapStencilMode=new o.StencilMode({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Lu(a.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency()}update(i,a,d){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const _=i.terrain.properties;this.sourceCache=i.terrain.drapeRenderMode===0?this._mockSourceCache:i._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const y=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const b=this.getScaledDemTileSize();this.sourceCache.update(a,b,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,y(),this._initializing=!0),y(),a.updateElevation(!d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||i.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=a.getIds().map(I=>{const z=a.getTileByID(I).tileID;return z.projMatrix=d.calculateProjMatrix(z.toUnwrapped()),z});(function(I,z){const P=z.transform.pointCoordinate(z.transform.getCameraPoint()),R=new o.pointGeometry(P.x,P.y);I.sort((j,X)=>{if(X.overscaledZ-j.overscaledZ)return X.overscaledZ-j.overscaledZ;const Z=new o.pointGeometry(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),K=new o.pointGeometry(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),ae=R.mult(1<<j.canonical.z);return ae.x-=.5,ae.y-=.5,ae.distSqr(Z)-ae.distSqr(K)})})(_,this.painter),this._previousZoom=d.zoom;const y=this.proxyToSource||{};this.proxyToSource={},_.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const b=this._style._sourceCaches;for(const I in b){const z=b[I];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,i[I],y),z.usedForTerrain))continue;const P=i[I];z.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[a.id]=_.map(I=>new Oa(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const E={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const z=this.terrainTileForTile[I.key];if(!z)continue;const P=z.tileID.key;P in E||(this._visibleDemTiles.push(z),E[P]=P)}}_assignTerrainTiles(i){this._initializing||i.forEach(a=>{if(this.terrainTileForTile[a.key])return;const d=this._findTileCoveringTileID(a,this.sourceCache);d&&(this.terrainTileForTile[a.key]=d)})}_prepareDEMTextures(){const i=this.painter.context,a=i.gl;for(const d in this.terrainTileForTile){const _=this.terrainTileForTile[d],y=_.dem;!y||_.demTexture&&!_.needsDEMTextureUpload||(i.activeTexture.set(a.TEXTURE1),rr(this.painter,_,y))}}_prepareDemTileUniforms(i,a,d,_){if(!a||a.demTexture==null)return!1;const y=i.tileID.canonical,b=Math.pow(2,a.tileID.canonical.z-y.z),E=_||"";return d[`u_dem_tl${E}`]=[y.x*b%1,y.y*b%1],d[`u_dem_scale${E}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,a=i.gl;if(!this._emptyDepthBufferTexture){const d={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new o.Texture(i,d,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const a=this._visibleDemTiles.reduce((d,_)=>{if(!_.dem)return d;const y=_.dem.tree.minimums[0];return y>0&&i++,d+y},0);return i?a/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,a=i.gl;i.activeTexture.set(a.TEXTURE2);const d=this._getLoadedAreaMinimum(),_={width:1,height:1,data:new Uint8Array(o.DEMData.pack(d,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(_,{premultiply:!1}):y=this._emptyDEMTexture=new o.Texture(i,_,a.RGBA,{premultiply:!1}),y}setupElevationDraw(i,a,d){const _=this.painter.context,y=_.gl,b=(E=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(E),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var E;b.u_dem_size=this.sourceCache.getSource().tileSize,b.u_exaggeration=this.exaggeration();const I=this.painter.transform,z=I.projection.createTileTransform(I,I.worldSize),P=i.tileID.canonical;b.u_tile_tl_up=z.upVector(P,0,0),b.u_tile_tr_up=z.upVector(P,o.EXTENT,0),b.u_tile_br_up=z.upVector(P,o.EXTENT,o.EXTENT),b.u_tile_bl_up=z.upVector(P,0,o.EXTENT),b.u_tile_up_scale=z.upVectorScale(P);let R=null,j=null,X=1;if(d&&d.morphing&&this._useVertexMorphing){const Z=d.morphing.srcDemTile,K=d.morphing.dstDemTile;X=d.morphing.phase,Z&&K&&(this._prepareDemTileUniforms(i,Z,b,"_prev")&&(j=Z),this._prepareDemTileUniforms(i,K,b)&&(R=K))}if(j&&R?(_.activeTexture.set(y.TEXTURE2),R.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),_.activeTexture.set(y.TEXTURE4),j.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),b.u_dem_lerp=X):(R=this.terrainTileForTile[i.tileID.key],_.activeTexture.set(y.TEXTURE2),(this._prepareDemTileUniforms(i,R,b)?R.demTexture:this.emptyDEMTexture).bind(y.NEAREST,y.CLAMP_TO_EDGE)),_.activeTexture.set(y.TEXTURE3),d&&d.useDepthForOcclusion?(this._depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),b.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),b.u_depth_size_inv=[1,1]),d&&d.useMeterToDem&&R){const Z=(1<<R.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=Z}d&&d.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),a.setTerrainUniformValues(_,b)}renderToBackBuffer(i){const a=this.painter,d=this.painter.context;i.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),this.renderingToTexture=!1,function(_,y,b,E,I){if(_.transform.projection.name==="globe")(function(z,P,R,j,X){const Z=z.context,K=Z.gl;let ae,W;const re=z.options.showTerrainWireframe?2:0,ne=(Ve,Ae)=>{if(W===Ve)return;const ve=[];Ae&&ve.push(Oo[re]),ve.push(Oo[Ve]),ve.push("PROJECTION_GLOBE_VIEW"),ae=z.useProgram("globeRaster",null,ve),W=Ve},te=z.colorModeForRenderPass(),ie=new o.DepthMode(K.LEQUAL,o.DepthMode.ReadWrite,z.depthRangeFor3D);Hn.update(X);const se=z.transform,ge=o.calculateGlobeMatrix(se,se.worldSize),Te=o.calculateGlobeMercatorMatrix(se),Ke=[o.mercatorXfromLng(se.center.lng),o.mercatorYfromLat(se.center.lat)],je=z.globeSharedBuffers;(re?[!1,!0]:[!1]).forEach(Ve=>{W=-1;const Ae=Ve?K.LINES:K.TRIANGLES;for(const ve of j){const Oe=R.getTile(ve),ze=Math.pow(2,ve.canonical.z),[dt,yt]=o.globeBuffersForTileMesh(z,Oe,ve,ze),Rt=o.StencilMode.disabled,Xe=P.prevTerrainTileForTile[ve.key],_t=P.terrainTileForTile[ve.key];vn(Xe,_t)&&Hn.newMorphing(ve.key,Xe,_t,X,250),Z.activeTexture.set(K.TEXTURE0),Oe.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const Mt=Hn.getMorphValuesForProxy(ve.key),yi=Mt?1:0,Mi={};Mt&&o.extend$1(Mi,{morphing:{srcDemTile:Mt.from,dstDemTile:Mt.to,phase:o.easeCubicInOut(Mt.phase)}});const St=o.globeMatrixForTile(ve.canonical,ge),Vt=Ps(se.projMatrix,St,Te,o.globeToMercatorTransition(se.zoom),Ke);if(ne(yi,Ve),P.setupElevationDraw(Oe,ae,Mi),z.prepareDrawProgram(Z,ae,ve.toUnwrapped()),je){const[Bi,ur]=Ve?je.getWirefameBuffer(z.context):[je.gridIndexBuffer,je.gridSegments];ae.draw(Z,Ae,ie,Rt,te,o.CullFaceMode.backCCW,Vt,"globe_raster",dt,Bi,ur)}if(!Ve){const Bi=[ve.canonical.y===0?o.globePoleMatrixForTile(ve.canonical,!1,se):null,ve.canonical.y===ze-1?o.globePoleMatrixForTile(ve.canonical,!0,se):null];for(const ur of Bi){if(!ur)continue;const Wr=Ps(se.projMatrix,ur,ur,0,Ke);je&&ae.draw(Z,Ae,ie,Rt,te,o.CullFaceMode.disabled,Wr,"globe_pole_raster",yt,je.poleIndexBuffer,je.poleSegments)}}}})})(_,y,b,E,I);else{const z=_.context,P=z.gl;let R,j;const X=_.options.showTerrainWireframe?2:0,Z=(ne,te)=>{if(j===ne)return;const ie=[Oo[ne]];te&&ie.push(Oo[X]),R=_.useProgram("terrainRaster",null,ie),j=ne},K=_.colorModeForRenderPass(),ae=new o.DepthMode(P.LEQUAL,o.DepthMode.ReadWrite,_.depthRangeFor3D);Hn.update(I);const W=_.transform,re=6*Math.pow(1.5,22-W.zoom)*y.exaggeration();(X?[!1,!0]:[!1]).forEach(ne=>{j=-1;const te=ne?P.LINES:P.TRIANGLES,[ie,se]=ne?y.getWirefameBuffer():[y.gridIndexBuffer,y.gridSegments];for(const ge of E){const Te=b.getTile(ge),Ke=o.StencilMode.disabled,je=y.prevTerrainTileForTile[ge.key],Ve=y.terrainTileForTile[ge.key];vn(je,Ve)&&Hn.newMorphing(ge.key,je,Ve,I,250),z.activeTexture.set(P.TEXTURE0),Te.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);const Ae=Hn.getMorphValuesForProxy(ge.key),ve=Ae?1:0;let Oe;Ae&&(Oe={morphing:{srcDemTile:Ae.from,dstDemTile:Ae.to,phase:o.easeCubicInOut(Ae.phase)}});const ze=br(ge.projMatrix,Wd(ge.canonical,W.renderWorldCopies)?re/10:re);Z(ve,ne),y.setupElevationDraw(Te,R,Oe),_.prepareDrawProgram(z,R,ge.toUnwrapped()),R.draw(z,te,ae,Ke,K,o.CullFaceMode.backCCW,ze,"terrain_raster",y.gridBuffer,ie,se)}})}}(a,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const a=this.painter,d=this.painter.context,_=this.proxySourceCache,y=this.proxiedCoords[_.id],b=this._drapedRenderBatches.shift(),E=[],I=a.style.order;let z=0;for(const P of y){const R=_.getTileByID(P.proxyTileKey),j=_.proxyCachedFBO[P.key]?_.proxyCachedFBO[P.key][i]:void 0,X=j!==void 0?_.renderCache[j]:this.pool[z++],Z=j!==void 0;if(R.texture=X.tex,Z&&!X.dirty){E.push(R.tileID);continue}let K;d.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(d.clear({color:o.Color.transparent,stencil:0}),X.dirty=!1);for(let ae=b.start;ae<=b.end;++ae){const W=a.style._layers[I[ae]];if(W.isHidden(a.transform.zoom))continue;const re=a.style._getLayerSourceCache(W),ne=re?this.proxyToSource[P.key][re.id]:[P];if(!ne)continue;const te=ne;d.viewport.set([0,0,X.fb.width,X.fb.height]),K!==(re?re.id:null)&&(this._setupStencil(X,ne,W,re),K=re?re.id:null),a.renderLayer(a,re,W,te)}this.renderedToTile?(X.dirty=!0,E.push(R.tileID)):Z||--z,z===5&&(z=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),b.end+1}postRender(){}renderCacheEfficiency(i){const a=i.order.length;if(a===0)return{efficiency:100};let d,_=0,y=0,b=!1;for(let E=0;E<a;++E){const I=i._layers[i.order[E]];this._style.isLayerDraped(I)?(b&&++_,++y):b||(b=!0,d=I.id)}return y===0?{efficiency:100}:{efficiency:100*(1-_/y),firstUndrapedLayer:d}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{i=Math.min(i,a.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,a,d){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const b=y.tileID,E=Math.pow(2,b.overscaledZ),{x:I,y:z}=b.canonical,P=I/E,R=(I+1)/E,j=z/E,X=(z+1)/E;return{minx:P,miny:j,maxx:R,maxy:X,t:y.dem.tree.raycastRoot(P,j,R,X,i,a,d),tile:y}});_.sort((y,b)=>(y.t!==null?y.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const y of _){if(y.t==null)return null;const b=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,i,a,d);if(b!=null)return b}return null}_createFBO(){const i=this.painter.context,a=i.gl,d=this.drapeBufferSize;i.activeTexture.set(a.TEXTURE0);const _=new o.Texture(i,{width:d[0],height:d[1],data:null},a.RGBA);_.bind(a.LINEAR,a.CLAMP_TO_EDGE);const y=i.createFramebuffer(d[0],d[1],!1);return y.colorAttachment.set(_.texture),y.depthAttachment=new bt(i,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&a.texParameterf(a.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:y,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const a=this._style._layers[i],d=a.isHidden(this.painter.transform.zoom),_=a.getCrossfadeParameters(),y=!!_&&_.t!==1,b=a.hasTransition();return a.type!=="custom"&&!d&&(y||b)})}_clearRasterFadeFromRenderCache(){let i=!1;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a]._source instanceof pi){i=!0;break}if(i)for(let a=0;a<this._style.order.length;++a){const d=this._style._layers[this._style.order[a]],_=d.isHidden(this.painter.transform.zoom),y=this._style._getLayerSourceCache(d);if(d.type!=="raster"||_||!y)continue;const b=d.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const I=this.proxyToSource[E.key][y.id];if(I)for(const z of I){const P=Du(y.getTile(z),y.findLoadedParent(z,0),y,this.painter.transform,b);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(y.id,z)}}}}_setupDrapedRenderBatches(){const i=this._style.order,a=i.length;if(a===0)return;const d=[];let _,y=0,b=this._style._layers[i[y]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++y<a;)b=this._style._layers[i[y]];for(;y<a;++y){const E=this._style._layers[i[y]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?_===void 0&&(_=y):_!==void 0&&(d.push({start:_,end:y-1}),_=void 0))}_!==void 0&&d.push({start:_,end:y-1}),this._drapedRenderBatches=d}_setupRenderCache(i){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const b=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let E=0;E<b.length;++E){const I=Object.values(b[E]);a.renderCachePool.push(...I)}}return}this._clearRasterFadeFromRenderCache();const d=this.proxyCoords,_=this._tilesDirty;for(let b=d.length-1;b>=0;b--){const E=d[b];if(a.getTileByID(E.key),a.proxyCachedFBO[E.key]!==void 0){const I=i[E.key],z=this.proxyToSource[E.key];let P=0;for(const R in z){const j=z[R],X=I[R];if(!X||X.length!==j.length||j.some((Z,K)=>Z!==X[K]||_[R]&&_[R].hasOwnProperty(Z.key))){P=-1;break}++P}for(const R in a.proxyCachedFBO[E.key])a.renderCache[a.proxyCachedFBO[E.key][R]].dirty=P<0||P!==Object.values(I).length}}const y=[...this._drapedRenderBatches];y.sort((b,E)=>E.end-E.start-(b.end-b.start));for(const b of y)for(const E of d){if(a.proxyCachedFBO[E.key])continue;let I=a.renderCachePool.pop();I===void 0&&a.renderCache.length<50&&(I=a.renderCache.length,a.renderCache.push(this._createFBO())),I!==void 0&&(a.proxyCachedFBO[E.key]={},a.proxyCachedFBO[E.key][b.start]=I,a.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(i,a,d,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,b=y.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let E;if(d.isTileClipped())E=a.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(i,a){const d=this.painter,_=this.painter.context,y=_.gl;d._tileClippingMaskIDs={},_.setColorMode(o.ColorMode.disabled),_.setDepthMode(o.DepthMode.disabled);const b=d.useProgram("clippingMask");for(const E of i){const I=d._tileClippingMaskIDs[E.key]=--a;b.draw(_,y.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:y.ALWAYS,mask:0},I,255,y.KEEP,y.KEEP,y.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Xn(E.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(i){const a=this.painter.transform;if(i.x<0||i.x>a.width||i.y<0||i.y>a.height)return null;const d=[i.x,i.y,1,1];o.transformMat4$1(d,d,a.pixelMatrixInverse),o.scale$1(d,d,1/d[3]),d[0]/=a.worldSize,d[1]/=a.worldSize;const _=a._camera.position,y=o.mercatorZfromAltitude(1,a.center.lat),b=[_[0],_[1],_[2]/y,0],E=o.subtract([],d.slice(0,3),b);o.normalize(E,E);const I=this.raycast(b,E,this._exaggeration);return I!==null&&I?(o.scaleAndAdd(b,b,E,I),b[3]=b[2],b[2]*=y,b):null}drawDepth(){const i=this.painter,a=i.context,d=this.proxySourceCache,_=Math.ceil(i.width),y=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===y||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const b=a.gl,E=a.createFramebuffer(_,y,!0);a.activeTexture.set(b.TEXTURE0);const I=new o.Texture(a,{width:_,height:y,data:null},b.RGBA);I.bind(b.NEAREST,b.CLAMP_TO_EDGE),E.colorAttachment.set(I.texture);const z=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,_,y);E.depthAttachment.set(z),this._depthFBO=E,this._depthTexture=I}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,_,y]),function(b,E,I,z){if(b.transform.projection.name==="globe")return;const P=b.context,R=P.gl;P.clear({depth:1});const j=b.useProgram("terrainDepth"),X=new o.DepthMode(R.LESS,o.DepthMode.ReadWrite,b.depthRangeFor3D);for(const Z of z){const K=I.getTile(Z),ae=br(Z.projMatrix,0);E.setupElevationDraw(K,j),j.draw(P,R.TRIANGLES,X,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,ae,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(i,this,d,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,a,d){if(i.getSource()instanceof qi)return this._setupProxiedCoordsForImageSource(i,a,d);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const _=this.proxiedCoords[i.id]=[],y=this.proxyCoords;for(let E=0;E<y.length;E++){const I=y[E],z=this._findTileCoveringTileID(I,i);if(z){const P=this._createProxiedId(I,z,d[I.key]&&d[I.key][i.id]);_.push(P),this.proxyToSource[I.key][i.id]=[P]}}let b=!1;for(let E=0;E<a.length;E++){const I=i.getTile(a[E]);if(!I||!I.hasData())continue;const z=this._findTileCoveringTileID(I.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==I.tileID.canonical.z){const P=this.proxyToSource[z.tileID.key][i.id],R=this._createProxiedId(z.tileID,I,d[z.tileID.key]&&d[z.tileID.key][i.id]);P?P.splice(P.length-1,0,R):this.proxyToSource[z.tileID.key][i.id]=[R],_.push(R),b=!0}}this._sourceTilesOverlap[i.id]=b}_setupProxiedCoordsForImageSource(i,a,d){if(!i.getSource().loaded())return;const _=this.proxiedCoords[i.id]=[],y=this.proxyCoords,b=i.getSource(),E=new o.pointGeometry(b.tileID.x,b.tileID.y)._div(1<<b.tileID.z),I=b.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((P,R)=>(P.min.x=Math.min(P.min.x,R.x-E.x),P.min.y=Math.min(P.min.y,R.y-E.y),P.max.x=Math.max(P.max.x,R.x-E.x),P.max.y=Math.max(P.max.y,R.y-E.y),P),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(P,R)=>{const j=P.wrap+P.canonical.x/(1<<P.canonical.z),X=P.canonical.y/(1<<P.canonical.z),Z=o.EXTENT/(1<<P.canonical.z),K=R.wrap+R.canonical.x/(1<<R.canonical.z),ae=R.canonical.y/(1<<R.canonical.z);return j+Z<K+I.min.x||j>K+I.max.x||X+Z<ae+I.min.y||X>ae+I.max.y};for(let P=0;P<y.length;P++){const R=y[P];for(let j=0;j<a.length;j++){const X=i.getTile(a[j]);if(!X||!X.hasData()||z(R,X.tileID))continue;const Z=this._createProxiedId(R,X,d[R.key]&&d[R.key][i.id]),K=this.proxyToSource[R.key][i.id];K?K.push(Z):this.proxyToSource[R.key][i.id]=[Z],_.push(Z)}}}_createProxiedId(i,a,d){let _=this.orthoMatrix;if(d){const y=d.find(b=>b.key===a.tileID.key);if(y)return y}if(a.tileID.key!==i.key){const y=i.canonical.z-a.tileID.canonical.z;let b,E,I;_=o.create();const z=a.tileID.wrap-i.wrap<<i.overscaledZ;y>0?(b=o.EXTENT>>y,E=b*((a.tileID.canonical.x<<y)-i.canonical.x+z),I=b*((a.tileID.canonical.y<<y)-i.canonical.y)):(b=o.EXTENT<<-y,E=o.EXTENT*(a.tileID.canonical.x-(i.canonical.x+z<<-y)),I=o.EXTENT*(a.tileID.canonical.y-(i.canonical.y<<-y))),o.ortho(_,0,b,0,b,0,1),o.translate(_,_,[E,I,0])}return new Oa(a.tileID,i.key,_)}_findTileCoveringTileID(i,a){let d=a.getTile(i);if(d&&d.hasData())return d;const _=this._findCoveringTileCache[a.id],y=_[i.key];if(d=y?a.getTileByID(y):null,d&&d.hasData()||y===null)return d;let b=d?d.tileID:i,E=b.overscaledZ;const I=a.getSource().minzoom,z=[];if(!y){const R=a.getSource().maxzoom;if(i.canonical.z>=R){const j=i.canonical.z-R;a.getSource().reparseOverscaled?(E=Math.max(i.canonical.z+2,a.transform.tileZoom),b=new o.OverscaledTileID(E,i.wrap,R,i.canonical.x>>j,i.canonical.y>>j)):j!==0&&(E=R,b=new o.OverscaledTileID(E,i.wrap,R,i.canonical.x>>j,i.canonical.y>>j))}b.key!==i.key&&(z.push(b.key),d=a.getTile(b))}const P=R=>{z.forEach(j=>{_[j]=R}),z.length=0};for(E-=1;E>=I&&(!d||!d.hasData());E--){d&&P(d.tileID.key);const R=b.calculateScaledKey(E);if(d=a.getTileByID(R),d&&d.hasData())break;const j=_[R];if(j===null)break;j===void 0?z.push(R):d=a.getTileByID(j)}return P(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(i){this.renderedToTile=!0}_clearRenderCacheForTile(i,a){let d=this._tilesDirty[i];d||(d=this._tilesDirty[i]={}),d[a.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(a){let d,_,y;const b=new o.StructArrayLayout2ui4,E=131;for(_=1;_<129;_++){for(d=1;d<129;d++)y=_*E+d,b.emplaceBack(y,y+1),b.emplaceBack(y,y+E),b.emplaceBack(y+1,y+E),_===128&&b.emplaceBack(y+E,y+E+1);b.emplaceBack(y+1,y+1+E)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Ds(h){const i=[];for(let a=0;a<h.length;a++){if(h[a]===null)continue;const d=h[a].split(" ");i.push(d.pop())}return i}class Fa{static cacheKey(i,a,d){let _=`${i}${d?d.cacheKey:""}`;for(const y of a)_+=`/${y}`;return _}constructor(i,a,d,_,y,b){const E=i.gl;this.program=E.createProgram();const I=Ds(d.staticAttributes),z=_?_.getBinderAttributes():[],P=I.concat(z),R=d.staticUniforms?Ds(d.staticUniforms):[],j=_?_.getBinderUniforms():[],X=R.concat(j),Z=[];for(const ie of X)Z.indexOf(ie)<0&&Z.push(ie);let K=_?_.defines():[];K=K.concat(b.map(ie=>`#define ${ie}`));const ae=K.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,ks,ii.fragmentSource,ra.fragmentSource,d.fragmentSource).join(`
`),W=K.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,ks,ii.vertexSource,ra.vertexSource,ia.vertexSource,d.vertexSource).join(`
`),re=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(re,ae),E.compileShader(re),E.attachShader(this.program,re);const ne=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(ne,W),E.compileShader(ne),E.attachShader(this.program,ne),this.attributes={};const te={};this.numAttributes=P.length;for(let ie=0;ie<this.numAttributes;ie++)P[ie]&&(E.bindAttribLocation(this.program,ie,P[ie]),this.attributes[P[ie]]=ie);E.linkProgram(this.program),E.deleteShader(ne),E.deleteShader(re);for(let ie=0;ie<Z.length;ie++){const se=Z[ie];if(se&&!te[se]){const ge=E.getUniformLocation(this.program,se);ge&&(te[se]=ge)}}this.fixedUniforms=y(i,te),this.binderUniforms=_?_.getUniforms(i,te):[],b.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((ie,se)=>({u_dem:new o.Uniform1i(ie,se.u_dem),u_dem_prev:new o.Uniform1i(ie,se.u_dem_prev),u_dem_unpack:new o.Uniform4f(ie,se.u_dem_unpack),u_dem_tl:new o.Uniform2f(ie,se.u_dem_tl),u_dem_scale:new o.Uniform1f(ie,se.u_dem_scale),u_dem_tl_prev:new o.Uniform2f(ie,se.u_dem_tl_prev),u_dem_scale_prev:new o.Uniform1f(ie,se.u_dem_scale_prev),u_dem_size:new o.Uniform1f(ie,se.u_dem_size),u_dem_lerp:new o.Uniform1f(ie,se.u_dem_lerp),u_exaggeration:new o.Uniform1f(ie,se.u_exaggeration),u_depth:new o.Uniform1i(ie,se.u_depth),u_depth_size_inv:new o.Uniform2f(ie,se.u_depth_size_inv),u_meter_to_dem:new o.Uniform1f(ie,se.u_meter_to_dem),u_label_plane_matrix_inv:new o.UniformMatrix4f(ie,se.u_label_plane_matrix_inv),u_tile_tl_up:new o.Uniform3f(ie,se.u_tile_tl_up),u_tile_tr_up:new o.Uniform3f(ie,se.u_tile_tr_up),u_tile_br_up:new o.Uniform3f(ie,se.u_tile_br_up),u_tile_bl_up:new o.Uniform3f(ie,se.u_tile_bl_up),u_tile_up_scale:new o.Uniform1f(ie,se.u_tile_up_scale)}))(i,te)),b.indexOf("FOG")!==-1&&(this.fogUniforms=((ie,se)=>({u_fog_matrix:new o.UniformMatrix4f(ie,se.u_fog_matrix),u_fog_range:new o.Uniform2f(ie,se.u_fog_range),u_fog_color:new o.Uniform4f(ie,se.u_fog_color),u_fog_horizon_blend:new o.Uniform1f(ie,se.u_fog_horizon_blend),u_fog_temporal_offset:new o.Uniform1f(ie,se.u_fog_temporal_offset)}))(i,te))}setTerrainUniformValues(i,a){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const _ in a)d[_].set(a[_])}}setFogUniformValues(i,a){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const _ in a)d[_].location&&d[_].set(a[_])}}draw(i,a,d,_,y,b,E,I,z,P,R,j,X,Z,K,ae){const W=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(d),i.setStencilMode(_),i.setColorMode(y),i.setCullFace(b);for(const ne of Object.keys(this.fixedUniforms))this.fixedUniforms[ne].set(E[ne]);Z&&Z.setUniforms(i,this.binderUniforms,j,{zoom:X});const re={[W.LINES]:2,[W.TRIANGLES]:3,[W.LINE_STRIP]:1}[a];for(const ne of R.get()){const te=ne.vaos||(ne.vaos={});(te[I]||(te[I]=new yn)).bind(i,this,z,Z?Z.getPaintVertexBuffers():[],P,ne.vertexOffset,K,ae),W.drawElements(a,ne.primitiveLength*re,W.UNSIGNED_SHORT,ne.primitiveOffset*re*2)}}}function Ru(h,i,a){const d=1/Dt(a,1,i.transform.tileZoom),_=Math.pow(2,a.tileID.overscaledZ),y=a.tileSize*Math.pow(2,i.transform.tileZoom)/_,b=y*(a.tileID.canonical.x+a.tileID.wrap*_),E=y*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[d,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E]}}const Bu=(h,i,a,d)=>{const _=i.style.light,y=_.properties.get("position"),b=[y.x,y.y,y.z],E=o.create$1();_.properties.get("anchor")==="viewport"&&(o.fromRotation(E,-i.transform.angle),o.transformMat3(b,b,E));const I=_.properties.get("color");return{u_matrix:h,u_lightpos:b,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+a,u_opacity:d}},Yl=(h,i,a,d,_,y,b)=>o.extend(Bu(h,i,a,d),Ru(y,i,b),{u_height_factor:-Math.pow(2,_.overscaledZ)/b.tileSize/8}),Ou=h=>({u_matrix:h}),Jl=(h,i,a,d)=>o.extend(Ou(h),Ru(a,i,d)),Hd=(h,i)=>({u_matrix:h,u_world:i}),Fu=(h,i,a,d,_)=>o.extend(Jl(h,i,a,d),{u_world:_}),Xd=(h,i,a,d)=>{const _=h.transform;let y;return y=d.paint.get("circle-pitch-alignment")==="map"?_.calculatePixelsToTileUnitsMatrix(a):new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]),{u_camera_to_center_distance:_.cameraToCenterDistance,u_matrix:h.translatePosMatrix(i.projMatrix,a,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:y}},Ql=h=>{const i=[];return h.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),h.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i},Uu=(h,i,a)=>{const d=o.EXTENT/a.tileSize;return{u_matrix:h,u_camera_to_center_distance:i.cameraToCenterDistance,u_extrude_scale:[i.pixelsToGLUnits[0]/d,i.pixelsToGLUnits[1]/d]}},ec=(h,i,a=1)=>({u_matrix:h,u_color:i,u_overlay:0,u_overlay_scale:a}),Vu=(h,i,a,d)=>({u_matrix:h,u_extrude_scale:Dt(i,1,a),u_intensity:d}),Nu=(h,i,a,d,_,y)=>{const b=h.transform,E=b.calculatePixelsToTileUnitsMatrix(i),I={u_matrix:Ua(h,i,a,_),u_pixels_to_tile_units:E,u_device_pixel_ratio:o.exported.devicePixelRatio,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Va(a)){const z=na(i,h.transform);I.u_texsize=i.lineAtlasTexture.size,I.u_scale=[z,d.fromScale,d.toScale],I.u_mix=d.t}return I},Fo=(h,i,a,d,_)=>{const y=h.transform,b=na(i,y);return{u_matrix:Ua(h,i,a,_),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:y.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:o.exported.devicePixelRatio,u_image:0,u_scale:[b,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function na(h,i){return 1/Dt(h,1,i.tileZoom)}function Ua(h,i,a,d){return h.translatePosMatrix(d||i.tileID.projMatrix,i,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}function Va(h){const i=h.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}const Ls=(h,i,a,d,_,y)=>{return{u_matrix:h,u_tl_parent:i,u_scale_parent:a,u_fade_t:d.mix,u_opacity:d.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(E=_.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(b=_.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Rs(_.paint.get("raster-hue-rotate")),u_perspective_transform:y};var b,E};function Rs(h){h*=Math.PI/180;const i=Math.sin(h),a=Math.cos(h);return[(2*a+1)/3,(-Math.sqrt(3)*i-a+1)/3,(Math.sqrt(3)*i-a+1)/3]}const Bs=(h,i,a,d,_,y,b,E,I,z,P,R,j,X)=>{const Z=_.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:Z.width/Z.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:b,u_coord_matrix:E,u_is_text:+I,u_pitch_with_map:+d,u_texsize:z,u_tile_id:P,u_zoom_transition:R,u_inv_rot_matrix:j,u_merc_center:X,u_texture:0}},Na=(h,i,a,d,_,y,b,E,I,z,P,R,j,X,Z)=>{const{cameraToCenterDistance:K,_pitch:ae}=_.transform;return o.extend(Bs(h,i,a,d,_,y,b,E,I,z,R,j,X,Z),{u_gamma_scale:d?K*Math.cos(_.terrain?0:ae):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+P})},ja=(h,i,a,d,_,y,b,E,I,z,P,R,j,X)=>o.extend(Na(h,i,a,d,_,y,b,E,!0,I,!0,P,R,j,X),{u_texsize_icon:z,u_texture_icon:1}),_i=(h,i,a)=>({u_matrix:h,u_opacity:i,u_color:a}),Os=(h,i,a,d,_,y)=>o.extend(function(b,E,I,z){const P=I.imageManager.getPattern(b.from.toString()),R=I.imageManager.getPattern(b.to.toString()),{width:j,height:X}=I.imageManager.getPixelSize(),Z=Math.pow(2,z.tileID.overscaledZ),K=z.tileSize*Math.pow(2,I.transform.tileZoom)/Z,ae=K*(z.tileID.canonical.x+z.tileID.wrap*Z),W=K*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[j,X],u_mix:E.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/Dt(z,1,I.transform.tileZoom),u_pixel_coord_upper:[ae>>16,W>>16],u_pixel_coord_lower:[65535&ae,65535&W]}}(d,y,a,_),{u_matrix:h,u_opacity:i}),ju={fillExtrusion:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_lightpos:new o.Uniform3f(h,i.u_lightpos),u_lightintensity:new o.Uniform1f(h,i.u_lightintensity),u_lightcolor:new o.Uniform3f(h,i.u_lightcolor),u_vertical_gradient:new o.Uniform1f(h,i.u_vertical_gradient),u_opacity:new o.Uniform1f(h,i.u_opacity)}),fillExtrusionPattern:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_lightpos:new o.Uniform3f(h,i.u_lightpos),u_lightintensity:new o.Uniform1f(h,i.u_lightintensity),u_lightcolor:new o.Uniform3f(h,i.u_lightcolor),u_vertical_gradient:new o.Uniform1f(h,i.u_vertical_gradient),u_height_factor:new o.Uniform1f(h,i.u_height_factor),u_image:new o.Uniform1i(h,i.u_image),u_texsize:new o.Uniform2f(h,i.u_texsize),u_pixel_coord_upper:new o.Uniform2f(h,i.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(h,i.u_pixel_coord_lower),u_scale:new o.Uniform3f(h,i.u_scale),u_fade:new o.Uniform1f(h,i.u_fade),u_opacity:new o.Uniform1f(h,i.u_opacity)}),fill:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix)}),fillPattern:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_image:new o.Uniform1i(h,i.u_image),u_texsize:new o.Uniform2f(h,i.u_texsize),u_pixel_coord_upper:new o.Uniform2f(h,i.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(h,i.u_pixel_coord_lower),u_scale:new o.Uniform3f(h,i.u_scale),u_fade:new o.Uniform1f(h,i.u_fade)}),fillOutline:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_world:new o.Uniform2f(h,i.u_world)}),fillOutlinePattern:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_world:new o.Uniform2f(h,i.u_world),u_image:new o.Uniform1i(h,i.u_image),u_texsize:new o.Uniform2f(h,i.u_texsize),u_pixel_coord_upper:new o.Uniform2f(h,i.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(h,i.u_pixel_coord_lower),u_scale:new o.Uniform3f(h,i.u_scale),u_fade:new o.Uniform1f(h,i.u_fade)}),circle:(h,i)=>({u_camera_to_center_distance:new o.Uniform1f(h,i.u_camera_to_center_distance),u_extrude_scale:new o.UniformMatrix2f(h,i.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(h,i.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(h,i.u_matrix)}),collisionBox:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_camera_to_center_distance:new o.Uniform1f(h,i.u_camera_to_center_distance),u_extrude_scale:new o.Uniform2f(h,i.u_extrude_scale)}),collisionCircle:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_inv_matrix:new o.UniformMatrix4f(h,i.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(h,i.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(h,i.u_viewport_size)}),debug:(h,i)=>({u_color:new o.UniformColor(h,i.u_color),u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_overlay:new o.Uniform1i(h,i.u_overlay),u_overlay_scale:new o.Uniform1f(h,i.u_overlay_scale)}),clippingMask:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix)}),heatmap:(h,i)=>({u_extrude_scale:new o.Uniform1f(h,i.u_extrude_scale),u_intensity:new o.Uniform1f(h,i.u_intensity),u_matrix:new o.UniformMatrix4f(h,i.u_matrix)}),heatmapTexture:(h,i)=>({u_image:new o.Uniform1i(h,i.u_image),u_color_ramp:new o.Uniform1i(h,i.u_color_ramp),u_opacity:new o.Uniform1f(h,i.u_opacity)}),hillshade:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_image:new o.Uniform1i(h,i.u_image),u_latrange:new o.Uniform2f(h,i.u_latrange),u_light:new o.Uniform2f(h,i.u_light),u_shadow:new o.UniformColor(h,i.u_shadow),u_highlight:new o.UniformColor(h,i.u_highlight),u_accent:new o.UniformColor(h,i.u_accent)}),hillshadePrepare:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_image:new o.Uniform1i(h,i.u_image),u_dimension:new o.Uniform2f(h,i.u_dimension),u_zoom:new o.Uniform1f(h,i.u_zoom),u_unpack:new o.Uniform4f(h,i.u_unpack)}),line:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_pixels_to_tile_units:new o.UniformMatrix2f(h,i.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(h,i.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(h,i.u_units_to_pixels),u_dash_image:new o.Uniform1i(h,i.u_dash_image),u_gradient_image:new o.Uniform1i(h,i.u_gradient_image),u_image_height:new o.Uniform1f(h,i.u_image_height),u_texsize:new o.Uniform2f(h,i.u_texsize),u_scale:new o.Uniform3f(h,i.u_scale),u_mix:new o.Uniform1f(h,i.u_mix),u_alpha_discard_threshold:new o.Uniform1f(h,i.u_alpha_discard_threshold)}),linePattern:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_texsize:new o.Uniform2f(h,i.u_texsize),u_pixels_to_tile_units:new o.UniformMatrix2f(h,i.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(h,i.u_device_pixel_ratio),u_image:new o.Uniform1i(h,i.u_image),u_units_to_pixels:new o.Uniform2f(h,i.u_units_to_pixels),u_scale:new o.Uniform3f(h,i.u_scale),u_fade:new o.Uniform1f(h,i.u_fade),u_alpha_discard_threshold:new o.Uniform1f(h,i.u_alpha_discard_threshold)}),raster:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_tl_parent:new o.Uniform2f(h,i.u_tl_parent),u_scale_parent:new o.Uniform1f(h,i.u_scale_parent),u_fade_t:new o.Uniform1f(h,i.u_fade_t),u_opacity:new o.Uniform1f(h,i.u_opacity),u_image0:new o.Uniform1i(h,i.u_image0),u_image1:new o.Uniform1i(h,i.u_image1),u_brightness_low:new o.Uniform1f(h,i.u_brightness_low),u_brightness_high:new o.Uniform1f(h,i.u_brightness_high),u_saturation_factor:new o.Uniform1f(h,i.u_saturation_factor),u_contrast_factor:new o.Uniform1f(h,i.u_contrast_factor),u_spin_weights:new o.Uniform3f(h,i.u_spin_weights),u_perspective_transform:new o.Uniform2f(h,i.u_perspective_transform)}),symbolIcon:(h,i)=>({u_is_size_zoom_constant:new o.Uniform1i(h,i.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(h,i.u_is_size_feature_constant),u_size_t:new o.Uniform1f(h,i.u_size_t),u_size:new o.Uniform1f(h,i.u_size),u_camera_to_center_distance:new o.Uniform1f(h,i.u_camera_to_center_distance),u_pitch:new o.Uniform1f(h,i.u_pitch),u_rotate_symbol:new o.Uniform1i(h,i.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(h,i.u_aspect_ratio),u_fade_change:new o.Uniform1f(h,i.u_fade_change),u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(h,i.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(h,i.u_coord_matrix),u_is_text:new o.Uniform1i(h,i.u_is_text),u_pitch_with_map:new o.Uniform1i(h,i.u_pitch_with_map),u_texsize:new o.Uniform2f(h,i.u_texsize),u_tile_id:new o.Uniform3f(h,i.u_tile_id),u_zoom_transition:new o.Uniform1f(h,i.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(h,i.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(h,i.u_merc_center),u_texture:new o.Uniform1i(h,i.u_texture)}),symbolSDF:(h,i)=>({u_is_size_zoom_constant:new o.Uniform1i(h,i.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(h,i.u_is_size_feature_constant),u_size_t:new o.Uniform1f(h,i.u_size_t),u_size:new o.Uniform1f(h,i.u_size),u_camera_to_center_distance:new o.Uniform1f(h,i.u_camera_to_center_distance),u_pitch:new o.Uniform1f(h,i.u_pitch),u_rotate_symbol:new o.Uniform1i(h,i.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(h,i.u_aspect_ratio),u_fade_change:new o.Uniform1f(h,i.u_fade_change),u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(h,i.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(h,i.u_coord_matrix),u_is_text:new o.Uniform1i(h,i.u_is_text),u_pitch_with_map:new o.Uniform1i(h,i.u_pitch_with_map),u_texsize:new o.Uniform2f(h,i.u_texsize),u_texture:new o.Uniform1i(h,i.u_texture),u_gamma_scale:new o.Uniform1f(h,i.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(h,i.u_device_pixel_ratio),u_tile_id:new o.Uniform3f(h,i.u_tile_id),u_zoom_transition:new o.Uniform1f(h,i.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(h,i.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(h,i.u_merc_center),u_is_halo:new o.Uniform1i(h,i.u_is_halo)}),symbolTextAndIcon:(h,i)=>({u_is_size_zoom_constant:new o.Uniform1i(h,i.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(h,i.u_is_size_feature_constant),u_size_t:new o.Uniform1f(h,i.u_size_t),u_size:new o.Uniform1f(h,i.u_size),u_camera_to_center_distance:new o.Uniform1f(h,i.u_camera_to_center_distance),u_pitch:new o.Uniform1f(h,i.u_pitch),u_rotate_symbol:new o.Uniform1i(h,i.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(h,i.u_aspect_ratio),u_fade_change:new o.Uniform1f(h,i.u_fade_change),u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(h,i.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(h,i.u_coord_matrix),u_is_text:new o.Uniform1i(h,i.u_is_text),u_pitch_with_map:new o.Uniform1i(h,i.u_pitch_with_map),u_texsize:new o.Uniform2f(h,i.u_texsize),u_texsize_icon:new o.Uniform2f(h,i.u_texsize_icon),u_texture:new o.Uniform1i(h,i.u_texture),u_texture_icon:new o.Uniform1i(h,i.u_texture_icon),u_gamma_scale:new o.Uniform1f(h,i.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(h,i.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(h,i.u_is_halo)}),background:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_opacity:new o.Uniform1f(h,i.u_opacity),u_color:new o.UniformColor(h,i.u_color)}),backgroundPattern:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_opacity:new o.Uniform1f(h,i.u_opacity),u_image:new o.Uniform1i(h,i.u_image),u_pattern_tl_a:new o.Uniform2f(h,i.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(h,i.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(h,i.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(h,i.u_pattern_br_b),u_texsize:new o.Uniform2f(h,i.u_texsize),u_mix:new o.Uniform1f(h,i.u_mix),u_pattern_size_a:new o.Uniform2f(h,i.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(h,i.u_pattern_size_b),u_scale_a:new o.Uniform1f(h,i.u_scale_a),u_scale_b:new o.Uniform1f(h,i.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(h,i.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(h,i.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(h,i.u_tile_units_to_pixels)}),terrainRaster:wo,terrainDepth:wo,skybox:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_sun_direction:new o.Uniform3f(h,i.u_sun_direction),u_cubemap:new o.Uniform1i(h,i.u_cubemap),u_opacity:new o.Uniform1f(h,i.u_opacity),u_temporal_offset:new o.Uniform1f(h,i.u_temporal_offset)}),skyboxGradient:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_color_ramp:new o.Uniform1i(h,i.u_color_ramp),u_center_direction:new o.Uniform3f(h,i.u_center_direction),u_radius:new o.Uniform1f(h,i.u_radius),u_opacity:new o.Uniform1f(h,i.u_opacity),u_temporal_offset:new o.Uniform1f(h,i.u_temporal_offset)}),skyboxCapture:(h,i)=>({u_matrix_3f:new o.UniformMatrix3f(h,i.u_matrix_3f),u_sun_direction:new o.Uniform3f(h,i.u_sun_direction),u_sun_intensity:new o.Uniform1f(h,i.u_sun_intensity),u_color_tint_r:new o.Uniform4f(h,i.u_color_tint_r),u_color_tint_m:new o.Uniform4f(h,i.u_color_tint_m),u_luminance:new o.Uniform1f(h,i.u_luminance)}),globeRaster:(h,i)=>({u_proj_matrix:new o.UniformMatrix4f(h,i.u_proj_matrix),u_globe_matrix:new o.UniformMatrix4f(h,i.u_globe_matrix),u_merc_matrix:new o.UniformMatrix4f(h,i.u_merc_matrix),u_zoom_transition:new o.Uniform1f(h,i.u_zoom_transition),u_merc_center:new o.Uniform2f(h,i.u_merc_center),u_image0:new o.Uniform1i(h,i.u_image0)}),globeAtmosphere:(h,i)=>({u_center:new o.Uniform2f(h,i.u_center),u_radius:new o.Uniform1f(h,i.u_radius),u_screen_size:new o.Uniform2f(h,i.u_screen_size),u_pixel_ratio:new o.Uniform1f(h,i.u_pixel_ratio),u_opacity:new o.Uniform1f(h,i.u_opacity),u_fadeout_range:new o.Uniform1f(h,i.u_fadeout_range),u_start_color:new o.Uniform3f(h,i.u_start_color),u_end_color:new o.Uniform3f(h,i.u_end_color)})};let Ga;function tc(h,i,a,d,_,y,b){const E=h.context,I=E.gl,z=h.useProgram("collisionBox"),P=[];let R=0,j=0;for(let ne=0;ne<d.length;ne++){const te=d[ne],ie=i.getTile(te),se=ie.getBucket(a);if(!se)continue;let ge=te.projMatrix;_[0]===0&&_[1]===0||(ge=h.translatePosMatrix(te.projMatrix,ie,_,y));const Te=b?se.textCollisionBox:se.iconCollisionBox,Ke=se.collisionCircleArray;if(Ke.length>0){const je=o.create(),Ve=ge;o.mul(je,se.placementInvProjMatrix,h.transform.glCoordMatrix),o.mul(je,je,se.placementViewportMatrix),P.push({circleArray:Ke,circleOffset:j,transform:Ve,invTransform:je}),R+=Ke.length/4,j=R}Te&&(h.terrain&&h.terrain.setupElevationDraw(ie,z),z.draw(E,I.LINES,o.DepthMode.disabled,o.StencilMode.disabled,h.colorModeForRenderPass(),o.CullFaceMode.disabled,Uu(ge,h.transform,ie),a.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,null,h.transform.zoom,null,Te.collisionVertexBuffer,Te.collisionVertexBufferExt))}if(!b||!P.length)return;const X=h.useProgram("collisionCircle"),Z=new o.StructArrayLayout2f1f2i16;Z.resize(4*R),Z._trim();let K=0;for(const ne of P)for(let te=0;te<ne.circleArray.length/4;te++){const ie=4*te,se=ne.circleArray[ie+0],ge=ne.circleArray[ie+1],Te=ne.circleArray[ie+2],Ke=ne.circleArray[ie+3];Z.emplace(K++,se,ge,Te,Ke,0),Z.emplace(K++,se,ge,Te,Ke,1),Z.emplace(K++,se,ge,Te,Ke,2),Z.emplace(K++,se,ge,Te,Ke,3)}(!Ga||Ga.length<2*R)&&(Ga=function(ne){const te=2*ne,ie=new o.StructArrayLayout3ui6;ie.resize(te),ie._trim();for(let se=0;se<te;se++){const ge=6*se;ie.uint16[ge+0]=4*se+0,ie.uint16[ge+1]=4*se+1,ie.uint16[ge+2]=4*se+2,ie.uint16[ge+3]=4*se+2,ie.uint16[ge+4]=4*se+3,ie.uint16[ge+5]=4*se+0}return ie}(R));const ae=E.createIndexBuffer(Ga,!0),W=E.createVertexBuffer(Z,o.collisionCircleLayout.members,!0);for(const ne of P){const te={u_matrix:ne.transform,u_inv_matrix:ne.invTransform,u_camera_to_center_distance:(re=h.transform).cameraToCenterDistance,u_viewport_size:[re.width,re.height]};X.draw(E,I.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,h.colorModeForRenderPass(),o.CullFaceMode.disabled,te,a.id,W,ae,o.SegmentVector.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,h.transform.zoom,null,null,null)}var re;W.destroy(),ae.destroy()}const Fs=o.identity(new Float32Array(16));function Gu(h,i,a,d,_,y){const{horizontalAlign:b,verticalAlign:E}=o.getAnchorAlignment(h),I=-(b-.5)*i,z=-(E-.5)*a,P=o.evaluateVariableOffset(h,d);return new o.pointGeometry((I/_+P[0])*y,(z/_+P[1])*y)}function Kd(h,i,a,d,_,y,b,E,I,z,P,R){const j=h.text.placedSymbolArray,X=h.text.dynamicLayoutVertexArray,Z=h.icon.dynamicLayoutVertexArray,K={},ae=E.projMatrix,W=y.elevation,re=W?W.getAtTileOffsetFunc(E,R):ne=>[0,0,0];X.clear();for(let ne=0;ne<j.length;ne++){const te=j.get(ne),ie=h.allowVerticalPlacement&&!te.placedOrientation,se=te.hidden||!te.crossTileID||ie?null:d[te.crossTileID];if(se){const ge=new o.pointGeometry(te.tileAnchorX,te.tileAnchorY),Te=re(ge),Ke=Yi(ge,a?ae:b,Te[2]),je=nn(y.cameraToCenterDistance,Ke.signedDistanceFromCamera);let Ve=_.evaluateSizeForFeature(h.textSizeData,z,te)*je/o.ONE_EM;a&&(Ve*=h.tilePixelRatio/I);const{width:Ae,height:ve,anchor:Oe,textOffset:ze,textScale:dt}=se,yt=Gu(Oe,Ae,ve,ze,dt,Ve),Rt=a?Yi(ge.add(yt),b,Te[2]).point:Ke.point.add(i?yt.rotate(-y.angle):yt),Xe=h.allowVerticalPlacement&&te.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let _t=0;_t<te.numGlyphs;_t++)o.addDynamicAttributes(X,Rt,Xe);P&&te.associatedIconIndex>=0&&(K[te.associatedIconIndex]={shiftedAnchor:Rt,angle:Xe})}else Rn(te.numGlyphs,X)}if(P){Z.clear();const ne=h.icon.placedSymbolArray;for(let te=0;te<ne.length;te++){const ie=ne.get(te);if(ie.hidden)Rn(ie.numGlyphs,Z);else{const se=K[te];if(se)for(let ge=0;ge<ie.numGlyphs;ge++)o.addDynamicAttributes(Z,se.shiftedAnchor,se.angle);else Rn(ie.numGlyphs,Z)}}h.icon.dynamicLayoutVertexBuffer.updateData(Z)}h.text.dynamicLayoutVertexBuffer.updateData(X)}function Yd(h,i,a){return a.iconsInText&&i?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Us(h,i,a,d,_,y,b,E,I,z,P,R){const j=h.context,X=j.gl,Z=h.transform,K=Z.projection.createTileTransform(Z,Z.worldSize),ae=E==="map",W=I==="map",re=ae&&a.layout.get("symbol-placement")!=="point",ne=ae&&!W&&!re,te=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ie=!1;const se=h.depthModeForSublayer(0,o.DepthMode.ReadOnly),ge=[o.mercatorXfromLng(Z.center.lng),o.mercatorYfromLat(Z.center.lat)],Te=a.layout.get("text-variable-anchor"),Ke=Z.projection.name==="globe",je=Ke?o.globeToMercatorTransition(Z.zoom):0,Ve=[],Ae=[];h.terrain&&W&&Ae.push("PITCH_WITH_MAP_TERRAIN"),Ke&&Ae.push("PROJECTION_GLOBE_VIEW"),re&&Ae.push("PROJECTED_POS_ON_VIEWPORT");for(const ve of d){const Oe=i.getTile(ve),ze=Oe.getBucket(a);if(!ze||ze.projection!==Z.projection.name)continue;const dt=_?ze.text:ze.icon;if(!dt||ze.fullyClipped||!dt.segments.get().length)continue;const yt=dt.programConfigurations.get(a.id),Rt=_||ze.sdfIcons,Xe=_?ze.textSizeData:ze.iconSizeData,_t=W||Z.pitch!==0,Mt=h.useProgram(Yd(Rt,_,ze),yt,Ae),yi=o.evaluateSizeForZoom(Xe,Z.zoom),Mi=[ve.canonical.x,ve.canonical.y,1<<ve.canonical.z];let St,Vt,Bi,ur,Wr=[0,0],bn=null;if(_){if(Vt=Oe.glyphAtlasTexture,Bi=X.LINEAR,St=Oe.glyphAtlasTexture.size,ze.iconsInText){Wr=Oe.imageAtlasTexture.size,bn=Oe.imageAtlasTexture;const Tr=Xe.kind==="composite"||Xe.kind==="camera";ur=_t||h.options.rotating||h.options.zooming||Tr?X.LINEAR:X.NEAREST}}else{const Tr=a.layout.get("icon-size").constantOr(0)!==1||ze.iconsNeedLinear;Vt=Oe.imageAtlasTexture,Bi=Rt||h.options.rotating||h.options.zooming||Tr||_t?X.LINEAR:X.NEAREST,St=Oe.imageAtlasTexture.size}const Un=h.transform.calculatePixelsToTileUnitsMatrix(Oe),Qt=mn(ve.projMatrix,Oe.tileID.canonical,W,ae,h.transform,Un),It=h.terrain&&W&&re?o.invert(new Float32Array(16),Qt):Fs,qt=_n(ve.projMatrix,Oe.tileID.canonical,W,ae,h.transform,Un),Xi=Te&&ze.hasTextData(),an=a.layout.get("icon-text-fit")!=="none"&&Xi&&ze.hasIconData();if(re){const Tr=Z.elevation,No=Tr?Tr.getAtTileOffsetFunc(ve,K):Mo=>[0,0,0];Cu(ze,ve.projMatrix,h,_,Qt,qt,W,z,No,ve)}const Li=h.translatePosMatrix(ve.projMatrix,Oe,y,b),sn=re||_&&Te||an?Fs:Qt,ns=h.translatePosMatrix(qt,Oe,y,b,!0),Hr=Rt&&a.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Vo;const lt=K.createInversionMatrix(ve.toUnwrapped());Vo=Rt?ze.iconsInText?ja(Xe.kind,yi,ne,W,h,Li,sn,ns,St,Wr,Mi,je,lt,ge):Na(Xe.kind,yi,ne,W,h,Li,sn,ns,_,St,!0,Mi,je,lt,ge):Bs(Xe.kind,yi,ne,W,h,Li,sn,ns,_,St,Mi,je,lt,ge);const gt={program:Mt,buffers:dt,uniformValues:Vo,atlasTexture:Vt,atlasTextureIcon:bn,atlasInterpolation:Bi,atlasInterpolationIcon:ur,isSDF:Rt,hasHalo:Hr,tile:Oe,labelPlaneMatrixInv:It};if(te&&ze.canOverlap){ie=!0;const Tr=dt.segments.get();for(const No of Tr)Ve.push({segments:new o.SegmentVector([No]),sortKey:No.sortKey,state:gt})}else Ve.push({segments:dt.segments,sortKey:0,state:gt})}ie&&Ve.sort((ve,Oe)=>ve.sortKey-Oe.sortKey);for(const ve of Ve){const Oe=ve.state;if(h.terrain&&h.terrain.setupElevationDraw(Oe.tile,Oe.program,{useDepthForOcclusion:!Ke,labelPlaneMatrixInv:Oe.labelPlaneMatrixInv}),j.activeTexture.set(X.TEXTURE0),Oe.atlasTexture.bind(Oe.atlasInterpolation,X.CLAMP_TO_EDGE),Oe.atlasTextureIcon&&(j.activeTexture.set(X.TEXTURE1),Oe.atlasTextureIcon&&Oe.atlasTextureIcon.bind(Oe.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),Oe.isSDF){const ze=Oe.uniformValues;Oe.hasHalo&&(ze.u_is_halo=1,Vs(Oe.buffers,ve.segments,a,h,Oe.program,se,P,R,ze)),ze.u_is_halo=0}Vs(Oe.buffers,ve.segments,a,h,Oe.program,se,P,R,Oe.uniformValues)}}function Vs(h,i,a,d,_,y,b,E,I){const z=d.context;_.draw(z,z.gl.TRIANGLES,y,b,E,o.CullFaceMode.disabled,I,a.id,h.layoutVertexBuffer,h.indexBuffer,i,a.paint,d.transform.zoom,h.programConfigurations.get(a.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Ns(h,i,a,d,_,y,b){const E=h.context.gl,I=a.paint.get("fill-pattern"),z=I&&I.constantOr(1),P=a.getCrossfadeParameters();let R,j,X,Z,K;b?(j=z&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=E.LINES):(j=z?"fillPattern":"fill",R=E.TRIANGLES);for(const ae of d){const W=i.getTile(ae);if(z&&!W.patternsLoaded())continue;const re=W.getBucket(a);if(!re)continue;h.prepareDrawTile(ae);const ne=re.programConfigurations.get(a.id),te=h.useProgram(j,ne);z&&(h.context.activeTexture.set(E.TEXTURE0),W.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ne.updatePaintBuffers(P));const ie=I.constantOr(null);if(ie&&W.imageAtlas){const ge=W.imageAtlas,Te=ge.patternPositions[ie.to.toString()],Ke=ge.patternPositions[ie.from.toString()];Te&&Ke&&ne.setConstantPatternPositions(Te,Ke)}const se=h.translatePosMatrix(ae.projMatrix,W,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(b){Z=re.indexBuffer2,K=re.segments2;const ge=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];X=j==="fillOutlinePattern"&&z?Fu(se,h,P,W,ge):Hd(se,ge)}else Z=re.indexBuffer,K=re.segments,X=z?Jl(se,h,P,W):Ou(se);h.prepareDrawProgram(h.context,te,ae.toUnwrapped()),te.draw(h.context,R,_,h.stencilModeForClipping(ae),y,o.CullFaceMode.disabled,X,a.id,re.layoutVertexBuffer,Z,K,a.paint,h.transform.zoom,ne)}}function $a(h,i,a,d,_,y,b){const E=h.context,I=E.gl,z=a.paint.get("fill-extrusion-pattern"),P=z.constantOr(1),R=a.getCrossfadeParameters(),j=a.paint.get("fill-extrusion-opacity");for(const X of d){const Z=i.getTile(X),K=Z.getBucket(a);if(!K)continue;const ae=K.programConfigurations.get(a.id),W=h.useProgram(P?"fillExtrusionPattern":"fillExtrusion",ae);if(h.terrain){const se=h.terrain;if(!K.enableTerrain)continue;if(se.setupElevationDraw(Z,W,{useMeterToDem:!0}),$u(E,i,X,K,a,se),!K.centroidVertexBuffer){const ge=W.attributes.a_centroid_pos;ge!==void 0&&I.vertexAttrib2f(ge,0,0)}}P&&(h.context.activeTexture.set(I.TEXTURE0),Z.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ae.updatePaintBuffers(R));const re=z.constantOr(null);if(re&&Z.imageAtlas){const se=Z.imageAtlas,ge=se.patternPositions[re.to.toString()],Te=se.patternPositions[re.from.toString()];ge&&Te&&ae.setConstantPatternPositions(ge,Te)}const ne=h.translatePosMatrix(X.projMatrix,Z,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),te=a.paint.get("fill-extrusion-vertical-gradient"),ie=P?Yl(ne,h,te,j,X,R,Z):Bu(ne,h,te,j);h.prepareDrawProgram(E,W,X.toUnwrapped()),W.draw(E,E.gl.TRIANGLES,_,y,b,o.CullFaceMode.backCCW,ie,a.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,a.paint,h.transform.zoom,ae,h.terrain?K.centroidVertexBuffer:null)}}function $u(h,i,a,d,_,y){const b=[W=>{let re=W.canonical.x-1,ne=W.wrap;return re<0&&(re=(1<<W.canonical.z)-1,ne--),new o.OverscaledTileID(W.overscaledZ,ne,W.canonical.z,re,W.canonical.y)},W=>{let re=W.canonical.x+1,ne=W.wrap;return re===1<<W.canonical.z&&(re=0,ne++),new o.OverscaledTileID(W.overscaledZ,ne,W.canonical.z,re,W.canonical.y)},W=>new o.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,(W.canonical.y===0?1<<W.canonical.z:W.canonical.y)-1),W=>new o.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y===(1<<W.canonical.z)-1?0:W.canonical.y+1)],E=W=>{const re=i.getSource().maxzoom,ne=ge=>{const Te=i.getTileByID(ge);if(Te&&Te.hasData())return Te.getBucket(_)};let te,ie,se;return(W.overscaledZ===W.canonical.z||W.overscaledZ>=re)&&(te=ne(W.key)),W.overscaledZ>=re&&(ie=ne(W.calculateScaledKey(W.overscaledZ+1))),W.overscaledZ>re&&(se=ne(W.calculateScaledKey(W.overscaledZ-1))),te||ie||se},I=[0,0,0],z=(W,re)=>(I[0]=Math.min(W.min.y,re.min.y),I[1]=Math.max(W.max.y,re.max.y),I[2]=o.EXTENT-re.min.x>W.max.x?re.min.x-o.EXTENT:W.max.x,I),P=(W,re)=>(I[0]=Math.min(W.min.x,re.min.x),I[1]=Math.max(W.max.x,re.max.x),I[2]=o.EXTENT-re.min.y>W.max.y?re.min.y-o.EXTENT:W.max.y,I),R=[(W,re)=>z(W,re),(W,re)=>z(re,W),(W,re)=>P(W,re),(W,re)=>P(re,W)],j=new o.pointGeometry(0,0);let X,Z,K;const ae=(W,re,ne,te,ie)=>{const se=[[te?ne:W,te?W:ne,0],[te?ne:re,te?re:ne,0]],ge=ie<0?o.EXTENT+ie:ie,Te=[te?ge:(W+re)/2,te?(W+re)/2:ge,0];return ne===0&&ie<0||ne!==0&&ie>0?y.getForTilePoints(K,[Te],!0,Z):se.push(Te),y.getForTilePoints(a,se,!0,X),Math.max(se[0][2],se[1][2],Te[2])/y.exaggeration()};for(let W=0;W<4;W++){const re=d.borders[W];if(re.length===0&&(d.borderDone[W]=!0),d.borderDone[W])continue;const ne=K=b[W](a),te=E(ne);if(!te||!te.enableTerrain||(Z=y.findDEMTileFor(ne),!Z||!Z.dem))continue;if(!X){const Te=y.findDEMTileFor(a);if(!Te||!Te.dem)return;X=Te}const ie=(W<2?1:5)-W,se=te.borders[ie];let ge=0;for(let Te=0;Te<re.length;Te++){const Ke=d.featuresOnBorder[re[Te]],je=Ke.borders[W];let Ve;for(;ge<se.length&&(Ve=te.featuresOnBorder[se[ge]],!(Ve.borders[ie][1]>je[0]+3));)te.borderDone[ie]||te.encodeCentroid(void 0,Ve,!1),ge++;if(Ve&&ge<se.length){const Ae=ge;let ve=0;for(;!(Ve.borders[ie][0]>je[1]-3)&&(ve++,++ge!==se.length);)Ve=te.featuresOnBorder[se[ge]];if(Ve=te.featuresOnBorder[se[Ae]],Ke.intersectsCount()>1||Ve.intersectsCount()>1||ve!==1){ve!==1&&(ge=Ae),d.encodeCentroid(void 0,Ke,!1),te.borderDone[ie]||te.encodeCentroid(void 0,Ve,!1);continue}const Oe=R[W](Ke,Ve),ze=W%2?o.EXTENT-1:0;j.x=ae(Oe[0],Math.min(o.EXTENT-1,Oe[1]),ze,W<2,Oe[2]),j.y=0,d.encodeCentroid(j,Ke,!1),te.borderDone[ie]||te.encodeCentroid(j,Ve,!1)}else d.encodeCentroid(void 0,Ke,!1)}d.borderDone[W]=d.needsCentroidUpdate=!0,te.borderDone[ie]||(te.borderDone[ie]=te.needsCentroidUpdate=!0)}(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(h)}const Zu=new o.Color(1,0,0,1),Jd=new o.Color(0,1,0,1),Za=new o.Color(0,0,1,1),qa=new o.Color(1,0,1,1),qu=new o.Color(0,1,1,1);function qr(h,i,a,d){Uo(h,0,i+a/2,h.transform.width,a,d)}function js(h,i,a,d){Uo(h,i-a/2,0,a,h.transform.height,d)}function Uo(h,i,a,d,_,y){const b=h.context,E=b.gl;E.enable(E.SCISSOR_TEST),E.scissor(i*o.exported.devicePixelRatio,a*o.exported.devicePixelRatio,d*o.exported.devicePixelRatio,_*o.exported.devicePixelRatio),b.clear({color:y}),E.disable(E.SCISSOR_TEST)}function Gs(h,i,a){const d=h.context,_=d.gl,y=a.projMatrix,b=h.useProgram("debug"),E=i.getTileByID(a.key);h.terrain&&h.terrain.setupElevationDraw(E,b);const I=o.DepthMode.disabled,z=o.StencilMode.disabled,P=h.colorModeForRenderPass(),R="$debug";d.activeTexture.set(_.TEXTURE0),h.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),E._makeDebugTileBoundsBuffers(h.context,h.transform.projection);const j=E._tileDebugBuffer||h.debugBuffer,X=E._tileDebugIndexBuffer||h.debugIndexBuffer,Z=E._tileDebugSegments||h.debugSegments;b.draw(d,_.LINE_STRIP,I,z,P,o.CullFaceMode.disabled,ec(y,o.Color.red),R,j,X,Z);const K=E.latestRawTileData,ae=Math.floor((K&&K.byteLength||0)/1024),W=i.getTile(a).tileSize,re=512/Math.min(W,512)*(a.overscaledZ/h.transform.zoom)*.5;let ne=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(ne+=` => ${a.overscaledZ}`),function(te,ie){te.initDebugOverlayCanvas();const se=te.debugOverlayCanvas,ge=te.context.gl,Te=te.debugOverlayCanvas.getContext("2d");Te.clearRect(0,0,se.width,se.height),Te.shadowColor="white",Te.shadowBlur=2,Te.lineWidth=1.5,Te.strokeStyle="white",Te.textBaseline="top",Te.font="bold 36px Open Sans, sans-serif",Te.fillText(ie,5,5),Te.strokeText(ie,5,5),te.debugOverlayTexture.update(se),te.debugOverlayTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)}(h,`${ne} ${ae}kb`),b.draw(d,_.TRIANGLES,I,z,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,ec(y,o.Color.transparent,re),R,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments)}const ic=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:rc}=ic;function Bn(h,i,a,d){h.emplaceBack(i,a,d)}class $s{constructor(i){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,Bn(this.vertexArray,-1,-1,1),Bn(this.vertexArray,1,-1,1),Bn(this.vertexArray,-1,1,1),Bn(this.vertexArray,1,1,1),Bn(this.vertexArray,-1,-1,-1),Bn(this.vertexArray,1,-1,-1),Bn(this.vertexArray,-1,1,-1),Bn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,rc),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function So(h,i,a,d,_,y){const b=h.gl,E=i.paint.get("sky-atmosphere-color"),I=i.paint.get("sky-atmosphere-halo-color"),z=i.paint.get("sky-atmosphere-sun-intensity"),P=((R,j,X,Z,K)=>({u_matrix_3f:R,u_sun_direction:j,u_sun_intensity:X,u_color_tint_r:[Z.r,Z.g,Z.b,Z.a],u_color_tint_m:[K.r,K.g,K.b,K.a],u_luminance:5e-5}))(o.fromMat4([],d),_,z,E,I);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+y,i.skyboxTexture,0),a.draw(h,b.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,P,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Wa={symbol:function(h,i,a,d,_){if(h.renderPass!=="translucent")return;const y=o.StencilMode.disabled,b=h.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(E,I,z,P,R,j,X){const Z=I.transform,K=R==="map",ae=j==="map",W=Z.projection.createTileTransform(Z,Z.worldSize);for(const re of E){const ne=P.getTile(re),te=ne.getBucket(z);if(!te||te.projection!==Z.projection.name||!te.text||!te.text.segments.get().length)continue;const ie=o.evaluateSizeForZoom(te.textSizeData,Z.zoom),se=I.transform.calculatePixelsToTileUnitsMatrix(ne),ge=mn(re.projMatrix,ne.tileID.canonical,ae,K,I.transform,se),Te=z.layout.get("icon-text-fit")!=="none"&&te.hasIconData();if(ie){const Ke=Math.pow(2,Z.zoom-ne.tileID.overscaledZ);Kd(te,K,ae,X,o.symbolSize,Z,ge,re,Ke,ie,Te,W)}}}(d,h,a,i,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),_),a.paint.get("icon-opacity").constantOr(1)!==0&&Us(h,i,a,d,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),y,b),a.paint.get("text-opacity").constantOr(1)!==0&&Us(h,i,a,d,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),y,b),i.map.showCollisionBoxes&&(tc(h,i,a,d,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),tc(h,i,a,d,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(h,i,a,d){if(h.renderPass!=="translucent")return;const _=a.paint.get("circle-opacity"),y=a.paint.get("circle-stroke-width"),b=a.paint.get("circle-stroke-opacity"),E=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)===0&&(y.constantOr(1)===0||b.constantOr(1)===0))return;const I=h.context,z=I.gl,P=h.depthModeForSublayer(0,o.DepthMode.ReadOnly),R=o.StencilMode.disabled,j=h.colorModeForRenderPass(),X=[];for(let K=0;K<d.length;K++){const ae=d[K],W=i.getTile(ae),re=W.getBucket(a);if(!re)continue;const ne=re.programConfigurations.get(a.id),te=Ql(a),ie={programConfiguration:ne,program:h.useProgram("circle",ne,te),layoutVertexBuffer:re.layoutVertexBuffer,indexBuffer:re.indexBuffer,uniformValues:Xd(h,ae,W,a),tile:W};if(E){const se=re.segments.get();for(const ge of se)X.push({segments:new o.SegmentVector([ge]),sortKey:ge.sortKey,state:ie})}else X.push({segments:re.segments,sortKey:0,state:ie})}E&&X.sort((K,ae)=>K.sortKey-ae.sortKey);const Z={useDepthForOcclusion:h.transform.projection.name!=="globe"};for(const K of X){const{programConfiguration:ae,program:W,layoutVertexBuffer:re,indexBuffer:ne,uniformValues:te,tile:ie}=K.state,se=K.segments;h.terrain&&h.terrain.setupElevationDraw(ie,W,Z),h.prepareDrawProgram(I,W,ie.tileID.toUnwrapped()),W.draw(I,z.TRIANGLES,P,R,j,o.CullFaceMode.disabled,te,a.id,re,ne,se,a.paint,h.transform.zoom,ae)}},heatmap:function(h,i,a,d){if(a.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const _=h.context,y=_.gl,b=o.StencilMode.disabled,E=new o.ColorMode([y.ONE,y.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(I,z,P){const R=I.gl;I.activeTexture.set(R.TEXTURE1),I.viewport.set([0,0,z.width/4,z.height/4]);let j=P.heatmapFbo;if(j)R.bindTexture(R.TEXTURE_2D,j.colorAttachment.get()),I.bindFramebuffer.set(j.framebuffer);else{const X=R.createTexture();R.bindTexture(R.TEXTURE_2D,X),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MIN_FILTER,R.LINEAR),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MAG_FILTER,R.LINEAR),j=P.heatmapFbo=I.createFramebuffer(z.width/4,z.height/4,!1),function(Z,K,ae,W){const re=Z.gl;re.texImage2D(re.TEXTURE_2D,0,re.RGBA,K.width/4,K.height/4,0,re.RGBA,Z.extRenderToTextureHalfFloat?Z.extTextureHalfFloat.HALF_FLOAT_OES:re.UNSIGNED_BYTE,null),W.colorAttachment.set(ae)}(I,z,X,j)}})(_,h,a),_.clear({color:o.Color.transparent});for(let I=0;I<d.length;I++){const z=d[I];if(i.hasRenderableParent(z))continue;const P=i.getTile(z),R=P.getBucket(a);if(!R)continue;const j=R.programConfigurations.get(a.id),X=h.useProgram("heatmap",j),{zoom:Z}=h.transform;h.terrain&&h.terrain.setupElevationDraw(P,X),h.prepareDrawProgram(_,X,z.toUnwrapped()),X.draw(_,y.TRIANGLES,o.DepthMode.disabled,b,E,o.CullFaceMode.disabled,Vu(z.projMatrix,P,Z,a.paint.get("heatmap-intensity")),a.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,a.paint,h.transform.zoom,j)}_.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(_,y){const b=_.context,E=b.gl,I=y.heatmapFbo;if(!I)return;b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,I.colorAttachment.get()),b.activeTexture.set(E.TEXTURE1);let z=y.colorRampTexture;z||(z=y.colorRampTexture=new o.Texture(b,y.colorRamp,E.RGBA)),z.bind(E.LINEAR,E.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(b,E.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,_.colorModeForRenderPass(),o.CullFaceMode.disabled,((P,R,j,X)=>({u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}))(0,y),y.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,y.paint,_.transform.zoom)}(h,a))},line:function(h,i,a,d){if(h.renderPass!=="translucent")return;const _=a.paint.get("line-opacity"),y=a.paint.get("line-width");if(_.constantOr(1)===0||y.constantOr(1)===0)return;const b=h.depthModeForSublayer(0,o.DepthMode.ReadOnly),E=h.colorModeForRenderPass(),I=a.paint.get("line-dasharray"),z=I.constantOr(1),P=a.layout.get("line-cap"),R=a.paint.get("line-pattern"),j=R.constantOr(1),X=a.paint.get("line-gradient"),Z=a.getCrossfadeParameters(),K=j?"linePattern":"line",ae=h.context,W=ae.gl,re=(te=>{const ie=[];Va(te)&&ie.push("RENDER_LINE_DASH"),te.paint.get("line-gradient")&&ie.push("RENDER_LINE_GRADIENT");const se=te.paint.get("line-pattern").constantOr(1),ge=te.paint.get("line-opacity").constantOr(1)!==1;return!se&&ge&&ie.push("RENDER_LINE_ALPHA_DISCARD"),ie})(a);let ne=re.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(ne=!1);for(const te of d){const ie=i.getTile(te);if(j&&!ie.patternsLoaded())continue;const se=ie.getBucket(a);if(!se)continue;h.prepareDrawTile(te);const ge=se.programConfigurations.get(a.id),Te=h.useProgram(K,ge,re),Ke=R.constantOr(null);if(Ke&&ie.imageAtlas){const ze=ie.imageAtlas,dt=ze.patternPositions[Ke.to.toString()],yt=ze.patternPositions[Ke.from.toString()];dt&&yt&&ge.setConstantPatternPositions(dt,yt)}const je=I.constantOr(null),Ve=P.constantOr(null);if(!j&&je&&Ve&&ie.lineAtlas){const ze=ie.lineAtlas,dt=ze.getDash(je.to,Ve),yt=ze.getDash(je.from,Ve);dt&&yt&&ge.setConstantPatternPositions(dt,yt)}const Ae=h.terrain?te.projMatrix:null,ve=j?Fo(h,ie,a,Z,Ae):Nu(h,ie,a,Z,Ae,se.lineClipsArray.length);if(X){const ze=se.gradients[a.id];let dt=ze.texture;if(a.gradientVersion!==ze.version){let yt=256;if(a.stepInterpolant){const Rt=i.getSource().maxzoom,Xe=te.canonical.z===Rt?Math.ceil(1<<h.transform.maxZoom-te.canonical.z):1;yt=o.clamp(o.nextPowerOfTwo(se.maxLineLength/o.EXTENT*1024*Xe),256,ae.maxTextureSize)}ze.gradient=o.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:yt,image:ze.gradient||void 0,clips:se.lineClipsArray}),ze.texture?ze.texture.update(ze.gradient):ze.texture=new o.Texture(ae,ze.gradient,W.RGBA),ze.version=a.gradientVersion,dt=ze.texture}ae.activeTexture.set(W.TEXTURE1),dt.bind(a.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}z&&(ae.activeTexture.set(W.TEXTURE0),ie.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),ge.updatePaintBuffers(Z)),j&&(ae.activeTexture.set(W.TEXTURE0),ie.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),ge.updatePaintBuffers(Z)),h.prepareDrawProgram(ae,Te,te.toUnwrapped());const Oe=ze=>{Te.draw(ae,W.TRIANGLES,b,ze,E,o.CullFaceMode.disabled,ve,a.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,a.paint,h.transform.zoom,ge,se.layoutVertexBuffer2)};if(ne){const ze=h.stencilModeForClipping(te).ref;ze===0&&h.terrain&&ae.clear({stencil:0});const dt={func:W.EQUAL,mask:255};ve.u_alpha_discard_threshold=.8,Oe(new o.StencilMode(dt,ze,255,W.KEEP,W.KEEP,W.INVERT)),ve.u_alpha_discard_threshold=0,Oe(new o.StencilMode(dt,ze,255,W.KEEP,W.KEEP,W.KEEP))}else Oe(h.stencilModeForClipping(te))}ne&&(h.resetStencilClippingMasks(),h.terrain&&ae.clear({stencil:0}))},fill:function(h,i,a,d){const _=a.paint.get("fill-color"),y=a.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const b=h.colorModeForRenderPass(),E=a.paint.get("fill-pattern"),I=h.opaquePassEnabledForLayer()&&!E.constantOr(1)&&_.constantOr(o.Color.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===I){const z=h.depthModeForSublayer(1,h.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);Ns(h,i,a,d,z,b,!1)}if(h.renderPass==="translucent"&&a.paint.get("fill-antialias")){const z=h.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);Ns(h,i,a,d,z,b,!0)}},"fill-extrusion":function(h,i,a,d){const _=a.paint.get("fill-extrusion-opacity");if(_!==0&&h.renderPass==="translucent"){const y=new o.DepthMode(h.context.gl.LEQUAL,o.DepthMode.ReadWrite,h.depthRangeFor3D);if(_!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))$a(h,i,a,d,y,o.StencilMode.disabled,o.ColorMode.disabled),$a(h,i,a,d,y,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const b=h.colorModeForRenderPass();$a(h,i,a,d,y,o.StencilMode.disabled,b)}}},hillshade:function(h,i,a,d){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const _=h.context,y=h.depthModeForSublayer(0,o.DepthMode.ReadOnly),b=h.colorModeForRenderPass(),E=h.terrain&&h.terrain.renderingToTexture,[I,z]=h.renderPass!=="translucent"||E?[{},d]:h.stencilConfigForOverlap(d);for(const P of z){const R=i.getTile(P);if(R.needsHillshadePrepare&&h.renderPass==="offscreen")Ba(h,R,a,y,o.StencilMode.disabled,b);else if(h.renderPass==="translucent"){const j=E&&h.terrain?h.terrain.stencilModeForRTTOverlap(P):I[P.overscaledZ];zs(h,P,R,a,y,j,b)}}_.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,i,a,d,_,y){if(h.renderPass!=="translucent"||a.paint.get("raster-opacity")===0||!d.length)return;const b=h.context,E=b.gl,I=i.getSource(),z=h.useProgram("raster"),P=h.colorModeForRenderPass(),R=h.terrain&&h.terrain.renderingToTexture,[j,X]=I instanceof qi||R?[{},d]:h.stencilConfigForOverlap(d),Z=X[X.length-1].overscaledZ,K=!h.options.moving;for(const ae of X){const W=R?o.DepthMode.disabled:h.depthModeForSublayer(ae.overscaledZ-Z,a.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,E.LESS),re=ae.toUnwrapped(),ne=i.getTile(ae);if(R&&(!ne||!ne.hasData()))continue;const te=R?ae.projMatrix:h.transform.calculateProjMatrix(re,K),ie=h.terrain&&R?h.terrain.stencilModeForRTTOverlap(ae):j[ae.overscaledZ],se=y?0:a.paint.get("raster-fade-duration");ne.registerFadeDuration(se);const ge=i.findLoadedParent(ae,0),Te=Du(ne,ge,i,h.transform,se);let Ke,je;h.terrain&&h.terrain.prepareDrawTile(ae);const Ve=a.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;b.activeTexture.set(E.TEXTURE0),ne.texture.bind(Ve,E.CLAMP_TO_EDGE),b.activeTexture.set(E.TEXTURE1),ge?(ge.texture.bind(Ve,E.CLAMP_TO_EDGE),Ke=Math.pow(2,ge.tileID.overscaledZ-ne.tileID.overscaledZ),je=[ne.tileID.canonical.x*Ke%1,ne.tileID.canonical.y*Ke%1]):ne.texture.bind(Ve,E.CLAMP_TO_EDGE);const Ae=Ls(te,je||[0,0],Ke||1,Te,a,I instanceof qi?I.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(b,z,re),I instanceof qi)z.draw(b,E.TRIANGLES,W,o.StencilMode.disabled,P,o.CullFaceMode.disabled,Ae,a.id,I.boundsBuffer,h.quadTriangleIndexBuffer,I.boundsSegments);else{const{tileBoundsBuffer:ve,tileBoundsIndexBuffer:Oe,tileBoundsSegments:ze}=h.getTileBoundsBuffers(ne);z.draw(b,E.TRIANGLES,W,ie,P,o.CullFaceMode.disabled,Ae,a.id,ve,Oe,ze)}}h.resetStencilClippingMasks()},background:function(h,i,a,d){const _=a.paint.get("background-color"),y=a.paint.get("background-opacity");if(y===0)return;const b=h.context,E=b.gl,I=h.transform,z=I.tileSize,P=a.paint.get("background-pattern");if(h.isPatternMissing(P))return;const R=!P&&_.a===1&&y===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==R)return;const j=o.StencilMode.disabled,X=h.depthModeForSublayer(0,R==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),Z=h.colorModeForRenderPass(),K=h.useProgram(P?"backgroundPattern":"background");let ae,W=d;W||(ae=h.getBackgroundTiles(),W=Object.values(ae).map(ne=>ne.tileID)),P&&(b.activeTexture.set(E.TEXTURE0),h.imageManager.bind(h.context));const re=a.getCrossfadeParameters();for(const ne of W){const te=ne.toUnwrapped(),ie=d?ne.projMatrix:h.transform.calculateProjMatrix(te);h.prepareDrawTile(ne);const se=i?i.getTile(ne):ae?ae[ne.key]:new o.Tile(ne,z,I.zoom,h),ge=P?Os(ie,y,h,P,{tileID:ne,tileSize:z},re):_i(ie,y,_);h.prepareDrawProgram(b,K,te);const{tileBoundsBuffer:Te,tileBoundsIndexBuffer:Ke,tileBoundsSegments:je}=h.getTileBoundsBuffers(se);K.draw(b,E.TRIANGLES,X,j,Z,o.CullFaceMode.disabled,ge,a.id,Te,Ke,je)}},sky:function(h,i,a){const d=h.transform,_=d.projection.name==="mercator"||d.projection.name==="globe"?1:o.smoothstep(7,8,d.zoom),y=a.paint.get("sky-opacity")*_;if(y===0)return;const b=h.context,E=a.paint.get("sky-type"),I=new o.DepthMode(b.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),z=h.frameCounter/1e3%1;E==="atmosphere"?h.renderPass==="offscreen"?a.needsSkyboxCapture(h)&&(function(P,R,j,X){const Z=P.context,K=Z.gl;let ae=R.skyboxFbo;if(!ae){ae=R.skyboxFbo=Z.createFramebuffer(32,32,!1),R.skyboxGeometry=new $s(Z),R.skyboxTexture=Z.gl.createTexture(),K.bindTexture(K.TEXTURE_CUBE_MAP,R.skyboxTexture),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR);for(let te=0;te<6;++te)K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,K.RGBA,32,32,0,K.RGBA,K.UNSIGNED_BYTE,null)}Z.bindFramebuffer.set(ae.framebuffer),Z.viewport.set([0,0,32,32]);const W=R.getCenter(P,!0),re=P.useProgram("skyboxCapture"),ne=new Float64Array(16);o.identity(ne),o.rotateY(ne,ne,.5*-Math.PI),So(Z,R,re,ne,W,0),o.identity(ne),o.rotateY(ne,ne,.5*Math.PI),So(Z,R,re,ne,W,1),o.identity(ne),o.rotateX(ne,ne,.5*-Math.PI),So(Z,R,re,ne,W,2),o.identity(ne),o.rotateX(ne,ne,.5*Math.PI),So(Z,R,re,ne,W,3),o.identity(ne),So(Z,R,re,ne,W,4),o.identity(ne),o.rotateY(ne,ne,Math.PI),So(Z,R,re,ne,W,5),Z.viewport.set([0,0,P.width,P.height])}(h,a),a.markSkyboxValid(h)):h.renderPass==="sky"&&function(P,R,j,X,Z){const K=P.context,ae=K.gl,W=P.transform,re=P.useProgram("skybox");K.activeTexture.set(ae.TEXTURE0),ae.bindTexture(ae.TEXTURE_CUBE_MAP,R.skyboxTexture);const ne=((te,ie,se,ge,Te)=>({u_matrix:te,u_sun_direction:ie,u_cubemap:0,u_opacity:ge,u_temporal_offset:Te}))(W.skyboxMatrix,R.getCenter(P,!1),0,X,Z);P.prepareDrawProgram(K,re),re.draw(K,ae.TRIANGLES,j,o.StencilMode.disabled,P.colorModeForRenderPass(),o.CullFaceMode.backCW,ne,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(h,a,I,y,z):E==="gradient"&&h.renderPass==="sky"&&function(P,R,j,X,Z){const K=P.context,ae=K.gl,W=P.transform,re=P.useProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new $s(K)),K.activeTexture.set(ae.TEXTURE0);let ne=R.colorRampTexture;ne||(ne=R.colorRampTexture=new o.Texture(K,R.colorRamp,ae.RGBA)),ne.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const te=((ie,se,ge,Te,Ke)=>({u_matrix:ie,u_color_ramp:0,u_center_direction:se,u_radius:o.degToRad(ge),u_opacity:Te,u_temporal_offset:Ke}))(W.skyboxMatrix,R.getCenter(P,!1),R.paint.get("sky-gradient-radius"),X,Z);P.prepareDrawProgram(K,re),re.draw(K,ae.TRIANGLES,j,o.StencilMode.disabled,P.colorModeForRenderPass(),o.CullFaceMode.backCW,te,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(h,a,I,y,z)},debug:function(h,i,a){for(let d=0;d<a.length;d++)Gs(h,i,a[d])},custom:function(h,i,a){const d=h.context,_=a.implementation;if(h.transform.projection.unsupportedLayers&&h.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(h.renderPass==="offscreen"){const y=_.prerender;y&&(h.setCustomLayerDefaults(),d.setColorMode(h.colorModeForRenderPass()),y.call(_,d.gl,h.transform.customLayerMatrix()),d.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),d.setColorMode(h.colorModeForRenderPass()),d.setStencilMode(o.StencilMode.disabled);const y=_.renderingMode==="3d"?new o.DepthMode(h.context.gl.LEQUAL,o.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,o.DepthMode.ReadOnly);d.setDepthMode(y),_.render(d.gl,h.transform.customLayerMatrix()),d.setDirty(),h.setBaseState(),d.bindFramebuffer.set(null)}}};class Wu{constructor(i,a){this.context=new zt(i),this.transform=a,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new La,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,a){const d=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new To(this,i));const _=this._terrain;this.transform.elevation=d?_:null,_.update(i,this.transform,a)}_updateFog(i){const a=i.fog;if(!a||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,_]=a.getFovAdjustedRange(this.transform._fov);if(d>_)return void(this.transform.fogCullDistSq=null);const y=d+.78*(_-d);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,a){if(this.width=i*o.exported.devicePixelRatio,this.height=a*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._layers[d].resize()}setup(){const i=this.context,a=new o.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(o.EXTENT,0),a.emplaceBack(0,o.EXTENT),a.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(a,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const d=new o.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(o.EXTENT,0),d.emplaceBack(0,o.EXTENT),d.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=i.createVertexBuffer(d,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const _=new o.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(_,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const y=new o.StructArrayLayout4i8;y.emplaceBack(0,0,0,0),y.emplaceBack(o.EXTENT,0,o.EXTENT,0),y.emplaceBack(0,o.EXTENT,0,o.EXTENT),y.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(y,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const b=new o.StructArrayLayout3ui6;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(b);const E=new o.StructArrayLayout1ui2;for(const z of[0,1,3,2,0])E.emplaceBack(z);this.debugIndexBuffer=i.createIndexBuffer(E),this.emptyTexture=new o.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA),this.identityMat=o.create();const I=this.context.gl;this.stencilClearMode=new o.StencilMode({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(o.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,a=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,a.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Xn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,a,d){if(!a||this.currentStencilSource===a.id||!i.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const I of d)if(this._tileClippingMaskIDs[I.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=a.id;const _=this.context,y=_.gl;this.nextStencilID+d.length>256&&this.clearStencil(),_.setColorMode(o.ColorMode.disabled),_.setDepthMode(o.DepthMode.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of d){const I=a.getTile(E),z=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:R,tileBoundsSegments:j}=this.getTileBoundsBuffers(I);b.draw(_,y.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:y.ALWAYS,mask:0},z,255,y.KEEP,y.KEEP,y.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Xn(E.projMatrix),"$clipping",P,R,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,a=this.context.gl;return new o.StencilMode({func:a.NOTEQUAL,mask:255},i,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const a=this.context.gl;return new o.StencilMode({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(i){const a=this.context.gl,d=i.sort((b,E)=>E.overscaledZ-b.overscaledZ),_=d[d.length-1].overscaledZ,y=d[0].overscaledZ-_+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const b={};for(let E=0;E<y;E++)b[E+_]=new o.StencilMode({func:a.GEQUAL,mask:255},E+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=y,[b,d]}return[{[_]:o.StencilMode.disabled},d]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([i.CONSTANT_COLOR,i.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(i,a,d){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new o.DepthMode(d||this.context.gl.LEQUAL,a,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,a){this.style=i,this.options=a,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const d=this.style.order,_=this.style._sourceCaches;for(const z in _){const P=_[z];P.used&&P.prepare(this.context)}const y={},b={},E={};for(const z in _){const P=_[z];y[z]=P.getVisibleCoordinates(),b[z]=y[z].slice().reverse(),E[z]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<d.length;z++)if(this.style._layers[d[z]].is3D()){this.opaquePassCutoff=z;break}if(this.terrain&&(this.terrain.updateTileBinding(E),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const z of d){const P=this.style._layers[z],R=i._getLayerSourceCache(P);if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const j=R?b[R.id]:void 0;(P.type==="custom"||P.isSky()||j&&j.length)&&this.renderLayer(this,R,P,j)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let I=o.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(I=this.style.fog.properties.get("color")),this.context.clear({color:a.showOverdrawInspector?o.Color.black:I,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[d[this.currentLayer]],P=i._getLayerSourceCache(z);if(z.isSky())continue;const R=P?b[P.id]:void 0;this._renderTileClippingMasks(z,P,R),this.renderLayer(this,P,z,R)}if(this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const z=this.style._layers[d[this.currentLayer]],P=i._getLayerSourceCache(z);z.isSky()&&this.renderLayer(this,P,z,P?b[P.id]:void 0)}for(this.transform.projection.name==="globe"&&function(z){const P=z.context,R=P.gl,j=z.transform,X=new o.DepthMode(R.LEQUAL,o.DepthMode.ReadOnly,[0,1]),Z=z.useProgram("globeAtmosphere"),K=j._camera.getWorldToCamera(j.worldSize,1),ae=j._camera.getCameraToClipPerspective(j._fov,j.width/j.height,j._nearZ,j._farZ),W=o.mul([],K,o.calculateGlobeMatrix(j,j.worldSize)),re=o.mul([],j.labelPlaneMatrix,ae),ne=o.transformMat4([],[0,0,0],W),te=o.add([],ne,[j.worldSize/Math.PI/2,0,0]),ie=o.transformMat4([],ne,re),se=o.transformMat4([],te,re),ge=o.length(o.sub([],se,ie)),Te=1-o.globeToMercatorTransition(j.zoom),Ke={u_center:ie,u_radius:ge,u_screen_size:[j.width,j.height],u_pixel_ratio:o.exported.devicePixelRatio,u_opacity:Te,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};z.prepareDrawProgram(P,Z);const je=z.globeSharedBuffers;je&&Z.draw(P,R.TRIANGLES,X,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,Ke,"skybox",je.atmosphereVertexBuffer,je.atmosphereIndexBuffer,je.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;){const z=this.style._layers[d[this.currentLayer]],P=i._getLayerSourceCache(z);if(z.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(z)){if(z.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const R=P?(z.type==="symbol"?E:b)[P.id]:void 0;this._renderTileClippingMasks(z,P,P?y[P.id]:void 0),this.renderLayer(this,P,z,R),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let z=null;o.values(this.style._layers).forEach(P=>{const R=i._getLayerSourceCache(P);R&&!P.isHidden(this.transform.zoom)&&(!z||z.getSource().maxzoom<R.getSource().maxzoom)&&(z=R)}),z&&this.options.showTileBoundaries&&Wa.debug(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const P=z.transform.padding;qr(z,z.transform.height-(P.top||0),3,Zu),qr(z,P.bottom||0,3,Jd),js(z,P.left||0,3,Za),js(z,z.transform.width-(P.right||0),3,qa);const R=z.transform.centerPoint;(function(j,X,Z,K){Uo(j,X-1,Z-10,2,20,K),Uo(j,X-10,Z-1,20,2,K)})(z,R.x,z.transform.height-R.y,qu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,a,d,_){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||_&&_.length)&&(this.id=d.id,this.gpuTimingStart(d),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(d.type)||Wa[d.type](i,a,d,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let d=this.gpuTimers[i.id];d||(d=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),d.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,d.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}queryGpuTimers(i){const a={};for(const d in i){const _=i[d],y=this.context.extTimerQuery,b=y.getQueryObjectEXT(_.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(_.query),a[d]=b}return a}translatePosMatrix(i,a,d,_,y){if(!d[0]&&!d[1])return i;const b=y?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(b){const z=Math.sin(b),P=Math.cos(b);d=[d[0]*P-d[1]*z,d[0]*z+d[1]*P]}const E=[y?d[0]:Dt(a,d[0],this.transform.zoom),y?d[1]:Dt(a,d[1],this.transform.zoom),0],I=new Float32Array(16);return o.translate(I,i,E),I}saveTileTexture(i){const a=this._tileTextures[i.size[0]];a?a.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const a=this._tileTextures[i];return a&&a.length>0?a.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const a=this.imageManager.getPattern(i.from.toString()),d=this.imageManager.getPattern(i.to.toString());return!a||!d}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,a=this.style&&this.style.fog,d=[];return this.terrain&&!this.terrain.renderingToTexture&&d.push("TERRAIN"),a&&!i&&a.getOpacity(this.transform.pitch)!==0&&d.push("FOG"),i&&d.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&d.push("OVERDRAW_INSPECTOR"),d}useProgram(i,a,d){this.cache=this.cache||{};const _=d||[],y=this.currentGlobalDefines().concat(_),b=Fa.cacheKey(i,y,a);return this.cache[b]||(this.cache[b]=new Fa(this.context,i,Kl[i],a,ju[i],y)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(i){this.terrain&&this.terrain.prepareDrawTile(i)}prepareDrawProgram(i,a,d){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const y=_.getOpacity(this.transform.pitch);y!==0&&a.setFogUniformValues(i,((b,E,I,z)=>{const P=E.properties.get("color"),R=b.frameCounter/1e3%1,j=[P.r/P.a,P.g/P.a,P.b/P.a,z];return{u_fog_matrix:I?b.transform.calculateFogTileMatrix(I):b.identityMat,u_fog_range:E.getFovAdjustedRange(b.transform._fov),u_fog_color:j,u_fog_horizon_blend:E.properties.get("horizon-blend"),u_fog_temporal_offset:R}})(this,_,d,y))}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const i=this.context.gl,a=i.createTexture();return i.bindTexture(i.TEXTURE_2D,a),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,a=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const _ of d)a[_.key]=i[_.key]||new o.Tile(_,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}}class Zs{constructor(i=0,a=0,d=0,_=0){if(isNaN(i)||i<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=a,this.left=d,this.right=_}interpolate(i,a,d){return a.top!=null&&i.top!=null&&(this.top=o.number(i.top,a.top,d)),a.bottom!=null&&i.bottom!=null&&(this.bottom=o.number(i.bottom,a.bottom,d)),a.left!=null&&i.left!=null&&(this.left=o.number(i.left,a.left,d)),a.right!=null&&i.right!=null&&(this.right=o.number(i.right,a.right,d)),this}getCenter(i,a){const d=o.clamp((this.left+i-this.right)/2,0,i),_=o.clamp((this.top+a-this.bottom)/2,0,a);return new o.pointGeometry(d,_)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Zs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Eo(h,i){const a=o.getColumn(h,3);o.fromQuat(h,i),o.setColumn(h,3,a)}function Hu(h,i){o.setColumn(h,3,[i[0],i[1],i[2],1])}function nc(h,i){const a=o.identity$1([]);return o.rotateZ$1(a,a,-i),o.rotateX$1(a,a,-h),a}function oc(h,i){const a=[h[0],h[1],0],d=[i[0],i[1],0];if(o.length(a)>=1e-15){const b=o.normalize([],a);o.scale$2(d,b,o.dot(d,b)),i[0]=d[0],i[1]=d[1]}const _=o.cross([],i,h);if(o.len(_)<1e-15)return null;const y=Math.atan2(-_[1],_[0]);return nc(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),y)}class Xu{constructor(i,a){this.position=i,this.orientation=a}get position(){return this._position}set position(i){this._position=this._renderWorldCopies?function(a){if(!a)return;const d=Array.isArray(a)?new o.MercatorCoordinate(a[0],a[1],a[2]):a;return d.x=o.wrap(d.x,0,1),d}(i):i}lookAtPoint(i,a){if(this.orientation=null,!this.position)return;const d=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(i)):0,_=this.position,y=o.MercatorCoordinate.fromLngLat(i,d),b=[y.x-_.x,y.y-_.y,y.z-_.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=oc(b,a)}setPitchBearing(i,a){this.orientation=nc(o.degToRad(i),o.degToRad(-a))}}class ac{constructor(i,a){this._transform=o.identity([]),this._orientation=o.identity$1([]),a&&(this._orientation=a,Eo(this._transform,this._orientation)),i&&Hu(this._transform,i)}get mercatorPosition(){const i=this.position;return new o.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=o.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){Hu(this._transform,i)}get orientation(){return this._orientation}set orientation(i){this._orientation=i,Eo(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,a){this._orientation=nc(i,a),Eo(this._transform,this._orientation)}forward(){const i=o.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=o.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=o.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,a){const d=new Float64Array(16);return o.invert(d,this.getWorldToCamera(i,a)),d}getWorldToCameraPosition(i,a,d){const _=this.position;o.scale$2(_,_,-i);const y=new Float64Array(16);return o.fromScaling(y,[d,d,d]),o.translate(y,y,_),y[10]*=a,y}getWorldToCamera(i,a){const d=new Float64Array(16),_=new Float64Array(4),y=this.position;return o.conjugate(_,this._orientation),o.scale$2(y,y,-i),o.fromQuat(d,_),o.translate(d,d,y),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=a,d[9]*=a,d[10]*=a,d[11]*=a,d}getCameraToClipPerspective(i,a,d,_){const y=new Float64Array(16);return o.perspective(y,i,a,d,_),y}getDistanceToElevation(i){const a=i===0?0:o.mercatorZfromAltitude(i,this.position[1]),d=this.forward();return(a-this.position[2])/d[2]}clone(){return new ac([...this.position],[...this.orientation])}}function Ku(h,i){const a=Ws(h),d=function(y,b,E,I,z){const P=new o.LngLat(E.lng-180*On,E.lat),R=new o.LngLat(E.lng+180*On,E.lat),j=y.project(P.lng,P.lat),X=y.project(R.lng,R.lat),Z=-Math.atan2(X.y-j.y,X.x-j.x),K=o.MercatorCoordinate.fromLngLat(E);K.y=o.clamp(K.y,-.999975,.999975);const ae=K.toLngLat(),W=y.project(ae.lng,ae.lat),re=o.MercatorCoordinate.fromLngLat(ae);re.x+=On;const ne=re.toLngLat(),te=y.project(ne.lng,ne.lat),ie=lc(te.x-W.x,te.y-W.y,Z),se=o.MercatorCoordinate.fromLngLat(ae);se.y+=On;const ge=se.toLngLat(),Te=y.project(ge.lng,ge.lat),Ke=lc(Te.x-W.x,Te.y-W.y,Z),je=Math.abs(ie.x)/Math.abs(Ke.y),Ve=o.identity([]);o.rotateZ(Ve,Ve,-Z*(1-(z?0:I)));const Ae=o.identity([]);return o.scale(Ae,Ae,[1,1-(1-je)*I,1]),Ae[4]=-Ke.x/Ke.y*I,o.rotateZ(Ae,Ae,Z),o.multiply$1(Ae,Ve,Ae),Ae}(h.projection,0,h.center,a,i),_=qs(h);return o.scale(d,d,[_,_,1]),d}function qs(h){const i=h.projection,a=Ws(h),d=sc(i,h.center),_=sc(i,o.LngLat.convert(i.center));return Math.pow(2,d*a+(1-a)*_)}function Ws(h){const i=h.projection.range;if(!i)return 0;const a=Math.max(h.width,h.height),d=Math.log(a/1024)/Math.LN2;return o.smoothstep(i[0]+d,i[1]+d,h.zoom)}const On=1/4e4;function sc(h,i){const a=o.clamp(i.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),d=new o.LngLat(i.lng-180*On,a),_=new o.LngLat(i.lng+180*On,a),y=h.project(d.lng,a),b=h.project(_.lng,a),E=o.MercatorCoordinate.fromLngLat(d),I=o.MercatorCoordinate.fromLngLat(_),z=b.x-y.x,P=b.y-y.y,R=I.x-E.x,j=I.y-E.y,X=Math.sqrt((R*R+j*j)/(z*z+P*P));return Math.log(X)/Math.LN2}function lc(h,i,a){const d=Math.cos(a),_=Math.sin(a);return{x:h*d-i*_,y:h*_+i*d}}class Ha{constructor(i,a,d,_,y){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=i||0,this._maxZoom=a||22,this._minPitch=d==null?0:d,this._maxPitch=_==null?60:_,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Zs,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ac,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const i=new Ha(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.setProjection(this.getProjection()),i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i.tileSize=this.tileSize,i.setMaxBounds(this.getMaxBounds()),i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._cameraZoom=this._cameraZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,i?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(i){this._terrainEnabled()&&this._cameraZoom==null&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),i&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(i){i==null&&(i={name:"mercator"}),this.projectionOptions=i;const a=this.projection?this.getProjection():void 0;return this.projection=o.getProjection(i),!Y(a,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const a=-i*Math.PI/180;var d;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(d=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d),function(_,y,b){var E=y[0],I=y[1],z=y[2],P=y[3],R=Math.sin(b),j=Math.cos(b);_[0]=E*j+z*R,_[1]=I*j+P*R,_[2]=E*-R+z*j,_[3]=I*-R+P*j}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const a=o.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(i){const a=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return i===-1?(this._cameraZoom=null,!1):(this._centerAltitude=i,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let _=0,y=0;for(let b=0;b<a.length;b++){const E=new o.pointGeometry(a[b][0]*this.width,d+a[b][1]*(this.height-d)),I=i.pointCoordinate(E);if(!I)continue;const z=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);_+=I[3]*z,y+=z}return y===0?NaN:_/y}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._cameraZoom==null||!this._elevation)return;const i=this._cameraZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*a,_=this._mercatorZfromZoom(i),y=this._mercatorZfromZoom(this._maxZoom),b=Math.max(_-d,y);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let d;d=i.z<this._camera.position[2]?[a.x,a.y,a.z]:[i.x,i.y,i.z];const _=o.length(o.sub([],this._camera.position,d));return o.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let a=!1;if(i.orientation&&!o.exactEquals(i.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(i.orientation)),i.position){const d=[i.position.x,i.position.y,i.position.z];o.exactEquals$1(d,this._camera.position)||(this._setCameraPosition(d),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,a=new Xu;return a.position=new o.MercatorCoordinate(i[0],i[1],i[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(i){if(!o.length$1(i))return!1;o.normalize$1(i,i);const a=o.transformQuat([],[0,0,-1],i),d=o.transformQuat([],[0,-1,0],i);if(d[2]<0)return!1;const _=oc(a,d);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(i){const a=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;i[2]=o.clamp(i[2],_/d,_/a),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,a,d){this._unmodified=!1,this._edgeInsets.interpolate(i,a,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const a=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(i){const a=[new o.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const d=this.pointCoordinate(new o.pointGeometry(0,0)),_=this.pointCoordinate(new o.pointGeometry(this.width,0)),y=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),b=this.pointCoordinate(new o.pointGeometry(0,this.height)),E=Math.floor(Math.min(d.x,_.x,y.x,b.x)),I=Math.floor(Math.max(d.x,_.x,y.x,b.x)),z=1;for(let P=E-z;P<=I+z;P++)P!==0&&a.push(new o.UnwrappedTileID(P,i))}return a}coveringTiles(i){let a=this.coveringZoomLevel(i);const d=a,_=this.elevation&&!i.isTerrainDEM,y=this.projection.name==="mercator";if(i.minzoom!==void 0&&a<i.minzoom)return[];i.maxzoom!==void 0&&a>i.maxzoom&&(a=i.maxzoom);const b=this.locationCoordinate(this.center),E=1<<a,I=[E*b.x,E*b.y,0],z=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,this.projection.name!=="globe"),P=this.pointCoordinate(this.getCameraPoint()),R=E*o.mercatorZfromAltitude(1,this.center.lat),j=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),X=[E*P.x,E*P.y,j],Z=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),K=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?a:0,ae=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,W=i.isTerrainDEM?-ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,re=this.projection.isReprojectedInTileSpace?qs(this):1,ne=ve=>{const ze=new o.MercatorCoordinate(ve.x+25e-6,ve.y,ve.z),dt=new o.MercatorCoordinate(ve.x,ve.y+25e-6,ve.z),yt=ve.toLngLat(),Rt=ze.toLngLat(),Xe=dt.toLngLat(),_t=this.locationCoordinate(yt),Mt=this.locationCoordinate(Rt),yi=this.locationCoordinate(Xe),Mi=Math.hypot(Mt.x-_t.x,Mt.y-_t.y),St=Math.hypot(yi.x-_t.x,yi.y-_t.y);return Math.sqrt(Mi*St)*re/25e-6},te=ve=>{const Oe=ae,ze=W;return{aabb:o.tileAABB(this,E,0,0,0,ve,ze,Oe,this.projection),zoom:0,x:0,y:0,minZ:ze,maxZ:Oe,wrap:ve,fullyVisible:!1}},ie=[];let se=[];const ge=a,Te=i.reparseOverscaled?d:a,Ke=ve=>ve*ve,je=Ke((j-this._centerAltitude)*R),Ve=ve=>{if(!this._elevation||!ve.tileID||!y)return;const Oe=this._elevation.getMinMaxForTile(ve.tileID),ze=ve.aabb;Oe?(ze.min[2]=Oe.min,ze.max[2]=Oe.max,ze.center[2]=(ze.min[2]+ze.max[2])/2):(ve.shouldSplit=Ae(ve),ve.shouldSplit||(ze.min[2]=ze.max[2]=ze.center[2]=this._centerAltitude))},Ae=ve=>{if(ve.zoom<K)return!0;if(ve.zoom===ge)return!1;if(ve.shouldSplit!=null)return ve.shouldSplit;const Oe=ve.aabb.distanceX(X),ze=ve.aabb.distanceY(X);let dt=je;_&&(dt=Ke(ve.aabb.distanceZ(X)*R));let yt=1;if(this.projection.isReprojectedInTileSpace&&d<=5){const Xe=Math.pow(2,ve.zoom),_t=ne(new o.MercatorCoordinate((ve.x+.5)/Xe,(ve.y+.5)/Xe));yt=_t>.85?1:_t}const Rt=Oe*Oe+ze*ze+dt;return Rt<Ke((1<<ge-ve.zoom)*Z*yt*((Xe,_t)=>{if(_t*Ke(.707)<Xe)return 1;const Mt=Math.sqrt(_t/Xe);return Mt/(1.4144271570014144+(Math.pow(1.1,Mt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(dt,je),Rt))};if(this.renderWorldCopies)for(let ve=1;ve<=3;ve++)ie.push(te(-ve)),ie.push(te(ve));for(ie.push(te(0));ie.length>0;){const ve=ie.pop(),Oe=ve.x,ze=ve.y;let dt=ve.fullyVisible;if(!dt){const yt=ve.aabb.intersects(z);if(yt===0)continue;dt=yt===2}if(ve.zoom!==ge&&Ae(ve))for(let yt=0;yt<4;yt++){const Rt=(Oe<<1)+yt%2,Xe=(ze<<1)+(yt>>1),_t={aabb:y?ve.aabb.quadrant(yt):o.tileAABB(this,E,ve.zoom+1,Rt,Xe,ve.wrap,ve.minZ,ve.maxZ,this.projection),zoom:ve.zoom+1,x:Rt,y:Xe,wrap:ve.wrap,fullyVisible:dt,tileID:void 0,shouldSplit:void 0,minZ:ve.minZ,maxZ:ve.maxZ};_&&(_t.tileID=new o.OverscaledTileID(ve.zoom+1===ge?Te:ve.zoom+1,ve.wrap,ve.zoom+1,Rt,Xe),Ve(_t)),ie.push(_t)}else{const yt=ve.zoom===ge?Te:ve.zoom;if(i.minzoom&&i.minzoom>yt)continue;const Rt=I[0]-(.5+Oe+(ve.wrap<<ve.zoom))*(1<<a-ve.zoom),Xe=I[1]-.5-ze,_t=ve.tileID?ve.tileID:new o.OverscaledTileID(yt,ve.wrap,ve.zoom,Oe,ze);se.push({tileID:_t,distanceSq:Rt*Rt+Xe*Xe})}}if(this.fogCullDistSq){const ve=this.fogCullDistSq,Oe=this.horizonLineFromTop();se=se.filter(ze=>{const dt=[0,0,0,1],yt=[o.EXTENT,o.EXTENT,0,1],Rt=this.calculateFogTileMatrix(ze.tileID.toUnwrapped());o.transformMat4$1(dt,dt,Rt),o.transformMat4$1(yt,yt,Rt);const Xe=o.getAABBPointSquareDist(dt,yt);if(Xe===0)return!0;let _t=!1;const Mt=this._elevation;if(Mt&&Xe>ve&&Oe!==0){const yi=this.calculateProjMatrix(ze.tileID.toUnwrapped());let Mi;i.isTerrainDEM||(Mi=Mt.getMinMaxForTile(ze.tileID)),Mi||(Mi={min:W,max:ae});const St=o.furthestTileCorner(this.rotation),Vt=[St[0]*o.EXTENT,St[1]*o.EXTENT,Mi.max];o.transformMat4(Vt,Vt,yi),_t=(1-Vt[1])*this.height*.5<Oe}return Xe<ve||_t})}return se.sort((ve,Oe)=>ve.distanceSq-Oe.distanceSq).map(ve=>ve.tileID)}resize(i,a){this.width=i,this.height=a,this.pixelsToGLUnits=[2/i,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const a=o.clamp(i.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),d=this.projection.project(i.lng,a);return new o.pointGeometry(d.x*this.worldSize,d.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(i,a){const d=this.pointCoordinate(a),_=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(i);this.setLocation(new o.MercatorCoordinate(y.x-(d.x-_.x),y.y-(d.y-_.y)))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this._coordinatePoint(this.locationCoordinate(i),!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,a){const d=a?o.mercatorZfromAltitude(a,i.lat):void 0,_=this.projection.project(i.lng,i.lat);return new o.MercatorCoordinate(_.x,_.y,d)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,a){const d=a!=null?a:this._centerAltitude,_=[i.x,i.y,0,1],y=[i.x,i.y,1,1];o.transformMat4$1(_,_,this.pixelMatrixInverse),o.transformMat4$1(y,y,this.pixelMatrixInverse);const b=y[3];o.scale$1(_,_,1/_[3]),o.scale$1(y,y,1/b);const E=_[2],I=y[2];return{p0:_,p1:y,t:E===I?0:(d-E)/(I-E)}}screenPointToMercatorRay(i){const a=[i.x,i.y,0,1],d=[i.x,i.y,1,1];return o.transformMat4$1(a,a,this.pixelMatrixInverse),o.transformMat4$1(d,d,this.pixelMatrixInverse),o.scale$1(a,a,1/a[3]),o.scale$1(d,d,1/d[3]),a[2]=o.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,d[2]=o.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,o.scale$1(a,a,1/this.worldSize),o.scale$1(d,d,1/this.worldSize),new o.Ray([a[0],a[1],a[2]],o.normalize([],o.sub([],d,a)))}rayIntersectionCoordinate(i){const{p0:a,p1:d,t:_}=i,y=o.mercatorZfromAltitude(a[2],this._center.lat),b=o.mercatorZfromAltitude(d[2],this._center.lat);return new o.MercatorCoordinate(o.number(a[0],d[0],_)/this.worldSize,o.number(a[1],d[1],_)/this.worldSize,o.number(y,b,_))}pointCoordinate(i,a=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(i.x,i.y,a)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);const a=this.elevation;let d=this.elevation.pointCoordinate(i);if(d)return new o.MercatorCoordinate(d[0],d[1],d[2]);let _=0,y=this.horizonLineFromTop();if(i.y>y)return this.pointCoordinate(i);const b=.02*y,E=i.clone();for(let I=0;I<10&&y-_>b;I++){E.y=o.number(_,y,.66);const z=a.pointCoordinate(E);z?(y=E.y,d=z):_=E.y}return d?new o.MercatorCoordinate(d[0],d[1],d[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){if(this.elevation)return!this.elevation.pointCoordinate(i);{const a=this.horizonLineFromTop();return i.y<a}}_coordinatePoint(i,a){const d=a&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,_=[i.x*this.worldSize,i.y*this.worldSize,d+i.toAltitude(),1];return o.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new o.pointGeometry(_[0]/_[3],_[1]/_[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(i,a){const d=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),_=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),y=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),b=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let E=this.pointCoordinate(d,i),I=this.pointCoordinate(_,i);const z=this.pointCoordinate(y,a),P=this.pointCoordinate(b,a),R=(j,X)=>(X.y-j.y)/(X.x-j.x);return E.y>1&&I.y>=0?E=new o.MercatorCoordinate((1-P.y)/R(P,E)+P.x,1):E.y<0&&I.y<=1&&(E=new o.MercatorCoordinate(-P.y/R(P,E)+P.x,0)),I.y>1&&E.y>=0?I=new o.MercatorCoordinate((1-z.y)/R(z,I)+z.x,1):I.y<0&&E.y<=1&&(I=new o.MercatorCoordinate(-z.y/R(z,I)+z.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(E)).extend(this.coordinateLocation(I)).extend(this.coordinateLocation(P)).extend(this.coordinateLocation(z))}_getBounds3D(){const i=this.elevation;if(!i.visibleDemTiles.length)return this._getBounds(0,0);const a=i.visibleDemTiles.reduce((d,_)=>{if(_.dem){const y=_.dem.tree;d.min=Math.min(d.min,y.minimums[0]),d.max=Math.max(d.max,y.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBounds(a.min*i.exaggeration(),a.max*i.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(i=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,d=this.height/2-a*(1-this._horizonShift);return i?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,a){return this.projection.createTileTransform(this,a).createTileMatrix(i)}calculateDistanceTileData(i){const a=i.key,d=this._distanceTileDataCache;if(d[a])return d[a];const _=i.canonical,y=1/this.height,b=this.cameraWorldSize/this.zoomScale(_.z),E=(_.x+Math.pow(2,_.z)*i.wrap)*b,I=_.y*b,z=this.point,P=this.angle,R=Math.sin(-P),j=-Math.cos(-P);return d[a]={bearing:[R,j],center:[(z.x-E)*y,(z.y-I)*y],scale:b/o.EXTENT*y},d[a]}calculateFogTileMatrix(i){const a=i.key,d=this._fogTileMatrixCache;if(d[a])return d[a];const _=this.calculatePosMatrix(i,this.cameraWorldSize);return o.multiply$1(_,this.worldToFogMatrix,_),d[a]=new Float32Array(_),d[a]}calculateProjMatrix(i,a=!1){const d=i.key,_=a?this._alignedProjMatrixCache:this._projMatrixCache;if(_[d])return _[d];const y=this.calculatePosMatrix(i,this.worldSize);return o.multiply$1(y,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:a?this.alignedProjMatrix:this.projMatrix,y),_[d]=new Float32Array(y),_[d]}calculatePixelsToTileUnitsMatrix(i){const a=i.tileID.key,d=this._pixelsToTileUnitsCache;if(d[a])return d[a];const _=function(y,b){const{scale:E}=y.tileTransform,I=E*o.EXTENT/(y.tileSize*Math.pow(2,b.zoom-y.tileID.overscaledZ+y.tileID.canonical.z));return z=new Float32Array(4),j=(P=b.inverseAdjustmentMatrix)[1],X=P[2],Z=P[3],ae=(R=[I,I])[1],z[0]=P[0]*(K=R[0]),z[1]=j*K,z[2]=X*ae,z[3]=Z*ae,z;var z,P,R,j,X,Z,K,ae}(i,this);return d[a]=_,d[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const a=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),_=this._camera.forward(),y=o.mercatorZfromAltitude(1,this._center.lat);d[2]/=y,_[2]/=y,o.normalize(_,_);const b=i.raycast(d,_,i.exaggeration());if(b){const E=o.scaleAndAdd([],d,_,b),I=new o.MercatorCoordinate(E[0],E[1],o.mercatorZfromAltitude(E[2],o.latFromMercatorY(E[1]))),z=(I.z+o.length([I.x-d[0],I.y-d[1],I.z-d[2]*y]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(z),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const a=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),_=i.getAtPointOrZero(new o.MercatorCoordinate(...d)),y=this._minimumHeightOverTerrain()*Math.cos(o.degToRad(this._maxPitch)),b=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*_;if(b<y){const E=this.locationCoordinate(this._center,this._centerAltitude),I=[E.x-d[0],E.y-d[1],E.z-d[2]],z=o.length(I);I[2]-=(y-b)/this._projectionScaler;const P=o.length(I);if(P===0)return;o.scale$2(I,I,z/P*this._projectionScaler),this._camera.position=[E.x-I[0],E.y-I[1],E.z*this._projectionScaler-I[2]],this._camera.orientation=oc(I,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const R=this.center;return R.lat=o.clamp(R.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(R.lng=o.clamp(R.lng,this.minLng,this.maxLng)),this.center=R,void(this._constraining=!1)}const i=this._unmodified,{x:a,y:d}=this.point;let _=0,y=a,b=d;const E=this.width/2,I=this.height/2,z=this.worldMinY*this.scale,P=this.worldMaxY*this.scale;if(d-I<z&&(b=z+I),d+I>P&&(b=P-I),P-z<this.height&&(_=Math.max(_,this.height/(P-z)),b=(P+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const R=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,X=this.worldSize/2-(R+j)/2;y=(a+X+this.worldSize)%this.worldSize-X,y-E<R&&(y=R+E),y+E>j&&(y=j-E),j-R<this.width&&(_=Math.max(_,this.width/(j-R)),y=(j+R)/2)}y===a&&b===d||(this.center=this.unproject(new o.pointGeometry(y,b))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCameraAltitude(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this._fov/2,a=this.centerOffset,d=this.pixelsPerMeter;this._projectionScaler=d/(o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(i)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?d:1),y=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);y[8]=2*-a.x/this.width,y[9]=2*a.y/this.height;let b=o.mul([],y,_);if(this.projection.isReprojectedInTileSpace){const te=this.locationCoordinate(this.center),ie=o.identity([]);o.translate(ie,ie,[te.x*this.worldSize,te.y*this.worldSize,0]),o.multiply$1(ie,ie,Ku(this)),o.translate(ie,ie,[-te.x*this.worldSize,-te.y*this.worldSize,0]),o.multiply$1(b,b,ie),this.inverseAdjustmentMatrix=function(se){const ge=Ku(se,!0);return F([],[ge[0],ge[1],ge[4],ge[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],b,[this.worldSize,this.worldSize,this.worldSize/d,1]),this.projMatrix=b,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const E=new Float32Array(16);o.identity(E),o.scale(E,E,[1,-1,1]),o.rotateX(E,E,this._pitch),o.rotateZ(E,E,this.angle);const I=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;I[8]=2*-a.x/this.width,I[9]=2*(a.y+z)/this.height,this.skyboxMatrix=o.multiply$1(E,I,E);const P=this.point,R=P.x,j=P.y,X=this.width%2/2,Z=this.height%2/2,K=Math.cos(this.angle),ae=Math.sin(this.angle),W=R-Math.round(R)+K*X+ae*Z,re=j-Math.round(j)+K*Z+ae*X,ne=new Float64Array(b);if(o.translate(ne,ne,[W>.5?W-1:W,re>.5?re-1:re,0]),this.alignedProjMatrix=ne,b=o.create(),o.scale(b,b,[this.width/2,-this.height/2,1]),o.translate(b,b,[1,-1,0]),this.labelPlaneMatrix=b,b=o.create(),o.scale(b,b,[1,-1,1]),o.translate(b,b,[-1,-1,0]),o.scale(b,b,[2/this.width,2/this.height,1]),this.glCoordMatrix=b,this.pixelMatrix=o.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},b=o.invert(new Float64Array(16),this.pixelMatrix),!b)throw new Error("failed to invert matrix");this.pixelMatrixInverse=b,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSize,a=this.cameraPixelsPerMeter,d=this._camera.position,_=1/this.height,y=[i,i,a];o.scale$2(y,y,_),o.scale$2(d,d,-1),o.multiply$2(d,d,y);const b=o.create();o.translate(b,b,d),o.scale(b,b,y),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,a,_)}_computeCameraPosition(i){const a=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),_=this.point,y=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*a-i/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-d[0]*y,_.y/this.worldSize-d[1]*y,i/this.worldSize*this._centerAltitude-d[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=i[2];let _=1;d>0&&(_=Math.min((a-this._camera.position[2])/d,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,i,_),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,a=this._camera.forward(),{pitch:d,bearing:_}=this._camera.getPitchBearing(),y=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),E=Math.max((i[2]-y)/Math.cos(d),b),I=this._zoomFromMercatorZ(E);o.scaleAndAdd(i,i,a,E),this._pitch=o.clamp(d,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(_,-Math.PI,Math.PI),this._setZoom(o.clamp(I,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new o.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((this._cameraZoom!=null?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(i,a){const d=Math.min(i.x,a.x),_=Math.max(i.x,a.x),y=Math.min(i.y,a.y),b=Math.max(i.y,a.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new o.pointGeometry(d,y),new o.pointGeometry(_,b),new o.pointGeometry(d,b),new o.pointGeometry(_,y)],I=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const P of E){const R=this.pointRayIntersection(P);if(R.t<0)return!0;const j=this.rayIntersectionCoordinate(R);if(j.x<I||j.y<0||j.x>z||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(i,a){const d=o.length(o.sub([],this._camera.position,i)),_=this._zoomFromMercatorZ(d)+a;return d-this._mercatorZfromZoom(_)}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,i))}}function Ao(h,i){let a=!1,d=null;const _=()=>{d=null,a&&(h(),d=setTimeout(_,i),a=!1)};return()=>(a=!0,d||_(),d)}class Yu{constructor(i){this._hashName=i&&encodeURIComponent(i),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ao(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,o.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return o.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const a=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,_=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,_),b=Math.round(a.lng*y)/y,E=Math.round(a.lat*y)/y,I=this._map.getBearing(),z=this._map.getPitch();let P="";if(P+=i?`/${b}/${E}/${d}`:`${d}/${E}/${b}`,(I||z)&&(P+="/"+Math.round(10*I)/10),z&&(P+=`/${Math.round(z)}`),this._hashName){const R=this._hashName;let j=!1;const X=o.window.location.hash.slice(1).split("&").map(Z=>{const K=Z.split("=")[0];return K===R?(j=!0,`${K}=${P}`):Z}).filter(Z=>Z);return j||X.push(`${R}=${P}`),`#${X.join("&")}`}return`#${P}`}_getCurrentHash(){const i=o.window.location.hash.replace("#","");if(this._hashName){let a;return i.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(a=d)}),(a&&a[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._getCurrentHash();if(i.length>=3&&!i.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:a,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,i)}}const to={linearity:.3,easing:o.bezier(0,0,.3,1)},oa=o.extend({deceleration:2500,maxSpeed:1400},to),Ju=o.extend({deceleration:20,maxSpeed:1400},to),cc=o.extend({deceleration:1e3,maxSpeed:360},to),si=o.extend({deceleration:1e3,maxSpeed:90},to);class Hs{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,a=o.exported.now();for(;i.length>0&&a-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)a.zoom+=y.zoomDelta||0,a.bearing+=y.bearingDelta||0,a.pitch+=y.pitchDelta||0,y.panDelta&&a.pan._add(y.panDelta),y.around&&(a.around=y.around),y.pinchAround&&(a.pinchAround=y.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(a.pan.mag()){const y=Xa(a.pan.mag(),d,o.extend({},oa,i||{}));_.offset=a.pan.mult(y.amount/a.pan.mag()),_.center=this._map.transform.center,Xs(_,y)}if(a.zoom){const y=Xa(a.zoom,d,Ju);_.zoom=this._map.transform.zoom+y.amount,Xs(_,y)}if(a.bearing){const y=Xa(a.bearing,d,cc);_.bearing=this._map.transform.bearing+o.clamp(y.amount,-179,179),Xs(_,y)}if(a.pitch){const y=Xa(a.pitch,d,si);_.pitch=this._map.transform.pitch+y.amount,Xs(_,y)}if(_.zoom||_.bearing){const y=a.pinchAround===void 0?a.around:a.pinchAround;_.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),o.extend(_,{noMoveStart:!0})}}function Xs(h,i){(!h.duration||h.duration<i.duration)&&(h.duration=i.duration,h.easing=i.easing)}function Xa(h,i,a){const{maxSpeed:d,linearity:_,deceleration:y}=a,b=o.clamp(h*_/(i/1e3),-d,d),E=Math.abs(b)/(y*_);return{easing:a.easing,duration:1e3*E,amount:b*(E/2)}}class Ir extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,d,_={}){const y=$.mousePos(a.getCanvasContainer(),d),b=a.unproject(y);super(i,o.extend({point:y,lngLat:b,originalEvent:d},_)),this._defaultPrevented=!1,this.target=a}}class Ks extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,d){const _=i==="touchend"?d.changedTouches:d.touches,y=$.touchPos(a.getCanvasContainer(),_),b=y.map(I=>a.unproject(I)),E=y.reduce((I,z,P,R)=>I.add(z.div(R.length)),new o.pointGeometry(0,0));super(i,{points:y,point:E,lngLats:b,lngLat:a.unproject(E),originalEvent:d}),this._defaultPrevented=!1}}class Qd extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,d){super(i,{originalEvent:d}),this._defaultPrevented=!1}}class Qu{constructor(i,a){this._map=i,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new Qd(i.type,this._map,i))}mousedown(i,a){return this._mousedownPos=a,this._firePreventable(new Ir(i.type,this._map,i))}mouseup(i){this._map.fire(new Ir(i.type,this._map,i))}preclick(i){const a=o.extend({},i);a.type="preclick",this._map.fire(new Ir(a.type,this._map,a))}click(i,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Ir(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Ir(i.type,this._map,i))}mouseover(i){this._map.fire(new Ir(i.type,this._map,i))}mouseout(i){this._map.fire(new Ir(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Ks(i.type,this._map,i))}touchmove(i){this._map.fire(new Ks(i.type,this._map,i))}touchend(i){this._map.fire(new Ks(i.type,this._map,i))}touchcancel(i){this._map.fire(new Ks(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ef{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(i){this._map.fire(new Ir(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ir("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Ir(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class uc{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,a){this.isEnabled()&&i.shiftKey&&i.button===0&&($.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(i,a){if(!this._active)return;const d=a;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=d,this._box||(this._box=$.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const y=Math.min(_.x,d.x),b=Math.max(_.x,d.x),E=Math.min(_.y,d.y),I=Math.max(_.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${E}px)`,this._box.style.width=b-y+"px",this._box.style.height=I-E+"px")})}mouseupWindow(i,a){if(!this._active||i.button!==0)return;const d=this._startPos,_=a;if(this.reset(),$.suppressClick(),d.x!==_.x||d.y!==_.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:y=>y.fitScreenCoordinates(d,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),$.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,a){return this._map.fire(new o.Event(i,{originalEvent:a}))}}function aa(h,i){const a={};for(let d=0;d<h.length;d++)a[h[d].identifier]=i[d];return a}class Ka{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),d.length===this.numTouches&&(this.centroid=function(_){const y=new o.pointGeometry(0,0);for(const b of _)y._add(b);return y.div(_.length)}(a),this.touches=aa(d,a)))}touchmove(i,a,d){if(this.aborted||!this.centroid)return;const _=aa(d,a);for(const y in this.touches){const b=this.touches[y],E=_[y];(!E||E.dist(b)>30)&&(this.aborted=!0)}}touchend(i,a,d){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Ya{constructor(i){this.singleTap=new Ka(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,a,d){this.singleTap.touchstart(i,a,d)}touchmove(i,a,d){this.singleTap.touchmove(i,a,d)}touchend(i,a,d){const _=this.singleTap.touchend(i,a,d);if(_){const y=i.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(_)<30;if(y&&b||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class hc{constructor(){this._zoomIn=new Ya({numTouches:1,numTaps:2}),this._zoomOut=new Ya({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,a,d){this._zoomIn.touchstart(i,a,d),this._zoomOut.touchstart(i,a,d)}touchmove(i,a,d){this._zoomIn.touchmove(i,a,d),this._zoomOut.touchmove(i,a,d)}touchend(i,a,d){const _=this._zoomIn.touchend(i,a,d),y=this._zoomOut.touchend(i,a,d);return _?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(_)},{originalEvent:i})}):y?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(y)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const eh={0:1,2:2};class sa{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(i,a){return!1}_move(i,a){return{}}mousedown(i,a){if(this._lastPoint)return;const d=$.mouseButton(i);this._correctButton(i,d)&&(this._lastPoint=a,this._eventButton=d)}mousemoveWindow(i,a){const d=this._lastPoint;if(d){if(i.preventDefault(),function(_,y){const b=eh[y];return _.buttons===void 0||(_.buttons&b)!==b}(i,this._eventButton))this.reset();else if(this._moved||!(a.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(d,a)}}mouseupWindow(i){this._lastPoint&&$.mouseButton(i)===this._eventButton&&(this._moved&&$.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ys extends sa{mousedown(i,a){super.mousedown(i,a),this._lastPoint&&(this._active=!0)}_correctButton(i,a){return a===0&&!i.ctrlKey}_move(i,a){return{around:a,panDelta:a.sub(i)}}}class xn extends sa{_correctButton(i,a){return a===0&&i.ctrlKey||a===2}_move(i,a){const d=.8*(a.x-i.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(i){i.preventDefault()}}class dc extends sa{_correctButton(i,a){return a===0&&i.ctrlKey||a===2}_move(i,a){const d=-.5*(a.y-i.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(i){i.preventDefault()}}class th{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(i,a,d){return this._calculateTransform(i,a,d)}touchmove(i,a,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.preventDefault(),this._calculateTransform(i,a,d)}}touchend(i,a,d){this._calculateTransform(i,a,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,a,d){d.length>0&&(this._active=!0);const _=aa(d,a),y=new o.pointGeometry(0,0),b=new o.pointGeometry(0,0);let E=0;for(const z in _){const P=_[z],R=this._touches[z];R&&(y._add(P),b._add(P.sub(R)),E++,_[z]=P)}if(this._touches=_,E<this._minTouches||!b.mag())return;const I=b.div(E);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(E),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=$.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Js{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(i){}_move(i,a,d){return{}}touchstart(i,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(i,a,d){if(!this._firstTwoTouches)return;i.preventDefault();const[_,y]=this._firstTwoTouches,b=io(d,a,_),E=io(d,a,y);if(!b||!E)return;const I=this._aroundCenter?null:b.add(E).div(2);return this._move([b,E],I,i)}touchend(i,a,d){if(!this._firstTwoTouches)return;const[_,y]=this._firstTwoTouches,b=io(d,a,_),E=io(d,a,y);b&&E||(this._active&&$.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function io(h,i,a){for(let d=0;d<h.length;d++)if(h[d].identifier===a)return i[d]}function fc(h,i){return Math.log(h/i)/Math.LN2}class Qs extends Js{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,a){const d=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(fc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fc(this._distance,d),pinchAround:a}}}function el(h,i){return 180*h.angleWith(i)/Math.PI}class tl extends Js{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,a){const d=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:el(this._vector,d),pinchAround:a}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const a=25/(Math.PI*this._minDiameter)*360,d=el(i,this._startVector);return Math.abs(d)<a}}function il(h){return Math.abs(h.y)>Math.abs(h.x)}class ih extends Js{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(i){this._lastPoints=i,il(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,a,d){const _=i[0].sub(this._lastPoints[0]),y=i[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&d.touches.length<3)&&(this._valid=this.gestureBeginsVertically(_,y,d.timeStamp),this._valid))return this._lastPoints=i,this._active=!0,{pitchDelta:(_.y+y.y)/2*-.5}}gestureBeginsVertically(i,a,d){if(this._valid!==void 0)return this._valid;const _=i.mag()>=2,y=a.mag()>=2;if(!_&&!y)return;if(!_||!y)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const b=i.y>0==a.y>0;return il(i)&&il(a)&&b}}const la={panStep:100,bearingStep:15,pitchStep:10};class tf{constructor(){const i=la;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let a=0,d=0,_=0,y=0,b=0;switch(i.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:i.shiftKey?d=-1:(i.preventDefault(),y=-1);break;case 39:i.shiftKey?d=1:(i.preventDefault(),y=1);break;case 38:i.shiftKey?_=1:(i.preventDefault(),b=-1);break;case 40:i.shiftKey?_=-1:(i.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(d=0,_=0),{cameraAnimation:E=>{const I=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:rf,zoom:a?Math.round(I)+a*(i.shiftKey?2:1):I,bearing:E.getBearing()+d*this._bearingStep,pitch:E.getPitch()+_*this._pitchStep,offset:[-y*this._panStep,-b*this._panStep],center:E.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function rf(h){return h*(2-h)}const pc=4.000244140625;class rl{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=i.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const d=o.exported.now(),_=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,a!==0&&a%pc==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(_*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),i.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=i,this._delta-=a,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=$.mousePos(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform,a=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>pc?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&z!==0&&(z=1/z);const P=a(),R=Math.pow(2,P),j=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):R;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(j*z))),this._type==="wheel"&&(this._startZoom=a(),this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a(),_=this._startZoom,y=this._easing;let b,E=!1;if(this._type==="wheel"&&_&&y){const I=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),z=y(I);b=o.number(_,d,z),I<1?this._frameId||(this._frameId=!0):E=!0}else b=d,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:b-a(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let a=o.ease;if(this._prevEase){const d=this._prevEase,_=(o.exported.now()-d.start)/d.duration,y=d.easing(_+.01)-d.easing(_),b=.27/Math.sqrt(y*y+1e-4)*.01,E=Math.sqrt(.0729-b*b);a=o.bezier(b,E,.25,1)}return this._prevEase={start:o.exported.now(),duration:i,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=$.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!o.window.document.fullscreenElement||!!o.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class mc{constructor(i,a){this._clickZoom=i,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class rh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,a){return i.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(i.shiftKey?-1:1),around:d.unproject(a)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nh{constructor(){this._tap=new Ya({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(i,a,d){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=a[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(i,a,d))}touchmove(i,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const _=a[0],y=_.y-this._swipePoint.y;return this._swipePoint=_,i.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(i,a,d)}touchend(i,a,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(i,a,d)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nl{constructor(i,a,d){this._el=i,this._mousePan=a,this._touchPan=d}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class _c{constructor(i,a,d){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=a,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class oh{constructor(i,a,d,_){this._el=i,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ja=h=>h.zoom||h.drag||h.pitch||h.rotate;class ah extends o.Event{}class sh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,a){const d=o.sub([],a,i);this.radius=o.length(d[2]<0?o.div([],d,this.constants):[d[0],d[1],0])}projectRay(i){o.div(i,i,this.constants),o.normalize(i,i),o.mul$1(i,i,this.constants);const a=o.scale$2([],i,this.radius);if(a[2]>0){const d=o.scale$2([],[0,0,1],o.dot(a,[0,0,1])),_=o.scale$2([],o.normalize([],[a[0],a[1],0]),this.radius),y=o.add([],a,o.scale$2([],o.sub([],o.add([],_,d),a),2));a[0]=y[0],a[1]=y[1]}return a}}function Qa(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class ca{constructor(i,a){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Hs(i),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new sh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),o.bindAll(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[_,y,b]of this._listeners)_.addEventListener(y,_===o.window.document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[i,a,d]of this._listeners)i.removeEventListener(a,i===o.window.document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(i){const a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new Qu(a,i));const _=a.boxZoom=new uc(a,i);this._add("boxZoom",_);const y=new hc,b=new rh;a.doubleClickZoom=new mc(b,y),this._add("tapZoom",y),this._add("clickZoom",b);const E=new nh;this._add("tapDragZoom",E);const I=a.touchPitch=new ih(a);this._add("touchPitch",I);const z=new xn(i),P=new dc(i);a.dragRotate=new _c(i,z,P),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);const R=new Ys(i),j=new th(a,i);a.dragPan=new nl(d,R,j),this._add("mousePan",R),this._add("touchPan",j,["touchZoom","touchRotate"]);const X=new tl,Z=new Qs;a.touchZoomRotate=new oh(d,Z,X,E),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ef(a));const K=a.scrollZoom=new rl(a,this);this._add("scrollZoom",K,["mousePan"]);const ae=a.keyboard=new tf;this._add("keyboard",ae);for(const W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[W]&&a[W].enable(i[W])}_add(i,a,d){this._handlers.push({handlerName:i,handler:a,allowed:d}),this._handlersById[i]=a}stop(i){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Ja(this._eventsInProgress))||this.isZooming()}_blockedByActive(i,a,d){for(const _ in i)if(_!==d&&(!a||a.indexOf(_)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const a=[];for(const d of i)this._el.contains(d.target)&&a.push(d);return a}handleEvent(i,a){this._updatingCamera=!0;const d=i.type==="renderFrame",_=d?void 0:i,y={needsRenderFrame:!1},b={},E={},I=i.touches?this._getMapTouches(i.touches):void 0,z=I?$.touchPos(this._el,I):d?void 0:$.mousePos(this._el,i);for(const{handlerName:j,handler:X,allowed:Z}of this._handlers){if(!X.isEnabled())continue;let K;this._blockedByActive(E,Z,j)?X.reset():X[a||i.type]&&(K=X[a||i.type](i,z,I),this.mergeHandlerResult(y,b,K,j,_),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||X.isActive())&&(E[j]=X)}const P={};for(const j in this._previousActiveHandlers)E[j]||(P[j]=_);this._previousActiveHandlers=E,(Object.keys(P).length||Qa(y))&&(this._changes.push([y,b,P]),this._triggerRenderFrame()),(Object.keys(E).length||Qa(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=y;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(i,a,d,_,y){if(!d)return;o.extend(i,d);const b={handlerName:_,originalEvent:d.originalEvent||y};d.zoomDelta!==void 0&&(a.zoom=b),d.panDelta!==void 0&&(a.drag=b),d.pitchDelta!==void 0&&(a.pitch=b),d.bearingDelta!==void 0&&(a.rotate=b)}_applyChanges(){const i={},a={},d={};for(const[_,y,b]of this._changes)_.panDelta&&(i.panDelta=(i.panDelta||new o.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(i.around=_.around),_.aroundCoord!==void 0&&(i.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(i.pinchAround=_.pinchAround),_.noInertia&&(i.noInertia=_.noInertia),o.extend(a,y),o.extend(d,b);this._updateMapTransform(i,a,d),this._changes=[]}_updateMapTransform(i,a,d){const _=this._map,y=_.transform,b=re=>[re.x,re.y,re.z];if((re=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!Qa(i)){const re=y.zoom;y.cameraElevationReference="sea",y.recenterOnTerrain(),y.cameraElevationReference="ground",re!==y.zoom&&this._map._update(!0)}if(!Qa(i))return this._fireEvents(a,d,!0);let{panDelta:E,zoomDelta:I,bearingDelta:z,pitchDelta:P,around:R,aroundCoord:j,pinchAround:X}=i;X!==void 0&&(R=X),(re=>a.drag&&!this._eventsInProgress.drag)()&&R&&(this._dragOrigin=b(y.pointCoordinate3D(R)),this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",_._stop(!0),R=R||_.transform.centerPoint,z&&(y.bearing+=z),P&&(y.pitch+=P),y._updateCameraState();const Z=[0,0,0];if(E){const re=y.pointCoordinate(R),ne=y.pointCoordinate(R.sub(E));re&&ne&&(Z[0]=ne.x-re.x,Z[1]=ne.y-re.y)}const K=y.zoom,ae=[0,0,0];if(I){const re=b(j||y.pointCoordinate3D(R)),ne={dir:o.normalize([],o.sub([],re,y._camera.position))};if(ne.dir[2]<0){const te=y.zoomDeltaToMovement(re,I);o.scale$2(ae,ne.dir,te)}}const W=o.add(Z,Z,ae);y._translateCameraConstrained(W),I&&Math.abs(y.zoom-K)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(a,d,!0)}_fireEvents(i,a,d){const _=Ja(this._eventsInProgress),y=Ja(i),b={};for(const P in i){const{originalEvent:R}=i[P];this._eventsInProgress[P]||(b[`${P}start`]=R),this._eventsInProgress[P]=i[P]}!_&&y&&this._fireEvent("movestart",y.originalEvent);for(const P in b)this._fireEvent(P,b[P]);y&&this._fireEvent("move",y.originalEvent);for(const P in i){const{originalEvent:R}=i[P];this._fireEvent(P,R)}const E={};let I;for(const P in this._eventsInProgress){const{handlerName:R,originalEvent:j}=this._eventsInProgress[P];this._handlersById[R].isActive()||(delete this._eventsInProgress[P],I=a[R]||j,E[`${P}end`]=I)}for(const P in E)this._fireEvent(P,E[P]);const z=Ja(this._eventsInProgress);if(d&&(_||y)&&!z){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;P?(R(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:I})):(this._map.fire(new o.Event("moveend",{originalEvent:I})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,a){this._map.fire(new o.Event(i,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new ah("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const gc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class lh extends o.Evented{constructor(i,a){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=a.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,a){return this.jumpTo({center:i},a)}panBy(i,a,d){return i=o.pointGeometry.convert(i).mult(-1),this.panTo(this.transform.center,o.extend({offset:i},a),d)}panTo(i,a,d){return this.easeTo(o.extend({center:i},a),d)}getZoom(){return this.transform.zoom}setZoom(i,a){return this.jumpTo({zoom:i},a),this}zoomTo(i,a,d){return this.easeTo(o.extend({zoom:i},a),d)}zoomIn(i,a){return this.zoomTo(this.getZoom()+1,i,a),this}zoomOut(i,a){return this.zoomTo(this.getZoom()-1,i,a),this}getBearing(){return this.transform.bearing}setBearing(i,a){return this.jumpTo({bearing:i},a),this}getPadding(){return this.transform.padding}setPadding(i,a){return this.jumpTo({padding:i},a),this}rotateTo(i,a,d){return this.easeTo(o.extend({bearing:i},a),d)}resetNorth(i,a){return this.rotateTo(0,o.extend({duration:1e3},i),a),this}resetNorthPitch(i,a){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},i),a),this}snapToNorth(i,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,a):this}getPitch(){return this.transform.pitch}setPitch(i,a){return this.jumpTo({pitch:i},a),this}cameraForBounds(i,a){i=o.LngLatBounds.convert(i);const d=a&&a.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),d,a)}_extendCameraOptions(i){const a={top:0,bottom:0,right:0,left:0};if(typeof(i=o.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=="number"){const d=i.padding;i.padding={top:d,bottom:d,right:d,left:d}}return i.padding=o.extend(a,i.padding),i}_cameraForBoxAndBearing(i,a,d,_){const y=this._extendCameraOptions(_),b=this.transform,E=b.padding,I=b.project(o.LngLat.convert(i)),z=b.project(o.LngLat.convert(a)),P=I.rotate(-o.degToRad(d)),R=z.rotate(-o.degToRad(d)),j=new o.pointGeometry(Math.max(P.x,R.x),Math.max(P.y,R.y)),X=new o.pointGeometry(Math.min(P.x,R.x),Math.min(P.y,R.y)),Z=j.sub(X),K=(b.width-(E.left+E.right+y.padding.left+y.padding.right))/Z.x,ae=(b.height-(E.top+E.bottom+y.padding.top+y.padding.bottom))/Z.y;if(ae<0||K<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const W=Math.min(b.scaleZoom(b.scale*Math.min(K,ae)),y.maxZoom),re=typeof y.offset.x=="number"?new o.pointGeometry(y.offset.x,y.offset.y):o.pointGeometry.convert(y.offset),ne=new o.pointGeometry((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(d*Math.PI/180),te=re.add(ne).mult(b.scale/b.zoomScale(W));return{center:b.unproject(I.add(z).div(2).sub(te)),zoom:W,bearing:d}}_cameraForBox(i,a,d,_,y){const b=this._extendCameraOptions(y);d=d||0,_=_||0,i=o.LngLat.convert(i),a=o.LngLat.convert(a);const E=this.transform.clone();E.padding=b.padding;const I=this.getFreeCameraOptions(),z=new o.LngLat(.5*(i.lng+a.lng),.5*(i.lat+a.lat)),P=.5*(d+_);if(E._camera.position[2]<o.mercatorZfromAltitude(P,z.lat))return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");I.lookAtPoint(z),E.setFreeCameraOptions(I);const R=o.MercatorCoordinate.fromLngLat(i),j=o.MercatorCoordinate.fromLngLat(a),X=E.pointRayIntersection(E.centerPoint,P),Z=[(K=E.rayIntersectionCoordinate(X)).x,K.y,K.z];var K;const ae=E.screenPointToMercatorRay(E.centerPoint),W=E.projection.name!=="globe";let re,ne=0;do{const te=Math.floor(E.zoom),ie=1<<te,se=Math.min(ie*R.x,ie*j.x),ge=Math.min(ie*R.y,ie*j.y),Te=Math.max(ie*R.x,ie*j.x),Ke=Math.max(ie*R.y,ie*j.y),je=new o.Aabb([se,ge,d],[Te,Ke,_]),Ve=o.Frustum.fromInvProjectionMatrix(E.invProjMatrix,E.worldSize,te,W);if(je.intersects(Ve)!==2){re&&(E._camera.position=o.scaleAndAdd([],E._camera.position,ae.dir,-re),E._updateStateFromCamera());break}const Ae=o.sub([],E._camera.position,Z);re=.5*o.length(Ae),E._camera.position=o.scaleAndAdd([],E._camera.position,ae.dir,re);try{E._updateStateFromCamera()}catch{return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ne<10);return{center:E.center,zoom:E.zoom,bearing:E.bearing,pitch:E.pitch}}fitBounds(i,a,d){return this._fitInternal(this.cameraForBounds(i,a),a,d)}_raycastElevationBox(i,a){const d=this.transform.elevation;if(!d)return;const _=new o.pointGeometry(i.x,a.y),y=new o.pointGeometry(a.x,i.y),b=d.pointCoordinate(i);if(!b)return;const E=d.pointCoordinate(a);if(!E)return;const I=d.pointCoordinate(_);if(!I)return;const z=d.pointCoordinate(y);if(!z)return;const P=new o.MercatorCoordinate(b[0],b[1]).toLngLat(),R=new o.MercatorCoordinate(E[0],E[1]).toLngLat(),j=new o.MercatorCoordinate(I[0],I[1]).toLngLat(),X=new o.MercatorCoordinate(z[0],z[1]).toLngLat(),Z=Math.min(P.lng,Math.min(R.lng,Math.min(j.lng,X.lng))),K=Math.min(P.lat,Math.min(R.lat,Math.min(j.lat,X.lat))),ae=Math.max(P.lng,Math.max(R.lng,Math.max(j.lng,X.lng))),W=Math.max(P.lat,Math.max(R.lat,Math.max(j.lat,X.lat))),re=Math.min(b[3],Math.min(E[3],Math.min(I[3],z[3]))),ne=Math.max(b[3],Math.max(E[3],Math.max(I[3],z[3])));return{minLngLat:new o.LngLat(Z,K),maxLngLat:new o.LngLat(ae,W),minAltitude:re,maxAltitude:ne}}fitScreenCoordinates(i,a,d,_,y){let b,E,I,z;const P=o.pointGeometry.convert(i),R=o.pointGeometry.convert(a),j=this._raycastElevationBox(P,R);if(j)b=j.minLngLat,E=j.maxLngLat,I=j.minAltitude,z=j.maxAltitude;else{if(this.transform.anyCornerOffEdge(P,R))return this;b=this.transform.pointLocation(P),E=this.transform.pointLocation(R)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(i)),this.transform.pointLocation(o.pointGeometry.convert(a)),d,_):this._cameraForBox(b,E,I,z,_),_,y)}_fitInternal(i,a,d){return i?(delete(a=o.extend(i,a)).padding,a.linear?this.easeTo(a,d):this.flyTo(a,d)):this}jumpTo(i,a){this.stop();const d=i.preloadOnly?this.transform.clone():this.transform;let _=!1,y=!1,b=!1;return"zoom"in i&&d.zoom!==+i.zoom&&(_=!0,d.zoom=+i.zoom),i.center!==void 0&&(d.center=o.LngLat.convert(i.center)),"bearing"in i&&d.bearing!==+i.bearing&&(y=!0,d.bearing=+i.bearing),"pitch"in i&&d.pitch!==+i.pitch&&(b=!0,d.pitch=+i.pitch),i.padding==null||d.isPaddingEqual(i.padding)||(d.padding=i.padding),i.preloadOnly?(this._preloadTiles(d),this):(this.fire(new o.Event("movestart",a)).fire(new o.Event("move",a)),_&&this.fire(new o.Event("zoomstart",a)).fire(new o.Event("zoom",a)).fire(new o.Event("zoomend",a)),y&&this.fire(new o.Event("rotatestart",a)).fire(new o.Event("rotate",a)).fire(new o.Event("rotateend",a)),b&&this.fire(new o.Event("pitchstart",a)).fire(new o.Event("pitch",a)).fire(new o.Event("pitchend",a)),this.fire(new o.Event("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(gc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,a){const d=this.transform;if(!d.projection.supportsFreeCamera)return void o.warnOnce(gc);this.stop();const _=d.zoom,y=d.pitch,b=d.bearing;d.setFreeCameraOptions(i);const E=_!==d.zoom,I=y!==d.pitch,z=b!==d.bearing;return this.fire(new o.Event("movestart",a)).fire(new o.Event("move",a)),E&&this.fire(new o.Event("zoomstart",a)).fire(new o.Event("zoom",a)).fire(new o.Event("zoomend",a)),z&&this.fire(new o.Event("rotatestart",a)).fire(new o.Event("rotate",a)).fire(new o.Event("rotateend",a)),I&&this.fire(new o.Event("pitchstart",a)).fire(new o.Event("pitch",a)).fire(new o.Event("pitchend",a)),this.fire(new o.Event("moveend",a)),this}easeTo(i,a){this._stop(!1,i.easeId),((i=o.extend({offset:[0,0],duration:500,easing:o.ease},i)).animate===!1||!i.essential&&o.exported.prefersReducedMotion)&&(i.duration=0);const d=this.transform,_=this.getZoom(),y=this.getBearing(),b=this.getPitch(),E=this.getPadding(),I="zoom"in i?+i.zoom:_,z="bearing"in i?this._normalizeBearing(i.bearing,y):y,P="pitch"in i?+i.pitch:b,R="padding"in i?i.padding:d.padding,j=o.pointGeometry.convert(i.offset);let X=d.centerPoint.add(j);const Z=d.projection.name==="globe"?d.pointCoordinate(X).toLngLat():d.pointLocation(X),K=o.LngLat.convert(i.center||Z);this._normalizeCenter(K);const ae=d.project(Z),W=d.project(K).sub(ae),re=d.zoomScale(I-_);let ne,te;i.around&&(ne=o.LngLat.convert(i.around),te=d.locationPoint(ne));const ie=this._zooming||I!==_,se=this._rotating||y!==z,ge=this._pitching||P!==b,Te=!d.isPaddingEqual(R),Ke=Ve=>Ae=>{if(ie&&(Ve.zoom=o.number(_,I,Ae)),se&&(Ve.bearing=o.number(y,z,Ae)),ge&&(Ve.pitch=o.number(b,P,Ae)),Te&&(Ve.interpolatePadding(E,R,Ae),X=Ve.centerPoint.add(j)),ne)Ve.setLocationAtPoint(ne,te);else{const ve=Ve.zoomScale(Ve.zoom-_),Oe=I>_?Math.min(2,re):Math.max(.5,re),ze=Math.pow(Oe,1-Ae),dt=Ve.unproject(ae.add(W.mult(Ae*ze)).mult(ve));Ve.setLocationAtPoint(Ve.renderWorldCopies?dt.wrap():dt,X)}return i.preloadOnly||this._fireMoveEvents(a),Ve};if(i.preloadOnly){const Ve=this._emulate(Ke,i.duration,d);return this._preloadTiles(Ve),this}const je={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ie,this._rotating=se,this._pitching=ge,this._padding=Te,this._easeId=i.easeId,this._prepareEase(a,i.noMoveStart,je),this._ease(Ke(d),Ve=>{d.recenterOnTerrain(),this._afterEase(a,Ve)},i),this}_prepareEase(i,a,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",a||d.moving||this.fire(new o.Event("movestart",i)),this._zooming&&!d.zooming&&this.fire(new o.Event("zoomstart",i)),this._rotating&&!d.rotating&&this.fire(new o.Event("rotatestart",i)),this._pitching&&!d.pitching&&this.fire(new o.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new o.Event("move",i)),this._zooming&&this.fire(new o.Event("zoom",i)),this._rotating&&this.fire(new o.Event("rotate",i)),this._pitching&&this.fire(new o.Event("pitch",i))}_afterEase(i,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId,this.transform.cameraElevationReference="ground";const d=this._zooming,_=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new o.Event("zoomend",i)),_&&this.fire(new o.Event("rotateend",i)),y&&this.fire(new o.Event("pitchend",i)),this.fire(new o.Event("moveend",i))}flyTo(i,a){if(!i.essential&&o.exported.prefersReducedMotion){const Xe=o.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Xe,a)}this.stop(),i=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},i);const d=this.transform,_=this.getZoom(),y=this.getBearing(),b=this.getPitch(),E=this.getPadding(),I="zoom"in i?o.clamp(+i.zoom,d.minZoom,d.maxZoom):_,z="bearing"in i?this._normalizeBearing(i.bearing,y):y,P="pitch"in i?+i.pitch:b,R="padding"in i?i.padding:d.padding,j=d.zoomScale(I-_),X=o.pointGeometry.convert(i.offset);let Z=d.centerPoint.add(X);const K=d.pointLocation(Z),ae=o.LngLat.convert(i.center||K);this._normalizeCenter(ae);const W=d.project(K),re=d.project(ae).sub(W);let ne=i.curve;const te=Math.max(d.width,d.height),ie=te/j,se=re.mag();if("minZoom"in i){const Xe=o.clamp(Math.min(i.minZoom,_,I),d.minZoom,d.maxZoom),_t=te/d.zoomScale(Xe-_);ne=Math.sqrt(_t/se*2)}const ge=ne*ne;function Te(Xe){const _t=(ie*ie-te*te+(Xe?-1:1)*ge*ge*se*se)/(2*(Xe?ie:te)*ge*se);return Math.log(Math.sqrt(_t*_t+1)-_t)}function Ke(Xe){return(Math.exp(Xe)-Math.exp(-Xe))/2}function je(Xe){return(Math.exp(Xe)+Math.exp(-Xe))/2}const Ve=Te(0);let Ae=function(Xe){return je(Ve)/je(Ve+ne*Xe)},ve=function(Xe){return te*((je(Ve)*(Ke(_t=Ve+ne*Xe)/je(_t))-Ke(Ve))/ge)/se;var _t},Oe=(Te(1)-Ve)/ne;if(Math.abs(se)<1e-6||!isFinite(Oe)){if(Math.abs(te-ie)<1e-6)return this.easeTo(i,a);const Xe=ie<te?-1:1;Oe=Math.abs(Math.log(ie/te))/ne,ve=function(){return 0},Ae=function(_t){return Math.exp(Xe*ne*_t)}}i.duration="duration"in i?+i.duration:1e3*Oe/("screenSpeed"in i?+i.screenSpeed/ne:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const ze=y!==z,dt=P!==b,yt=!d.isPaddingEqual(R),Rt=Xe=>_t=>{const Mt=_t*Oe,yi=1/Ae(Mt);Xe.zoom=_t===1?I:_+Xe.scaleZoom(yi),ze&&(Xe.bearing=o.number(y,z,_t)),dt&&(Xe.pitch=o.number(b,P,_t)),yt&&(Xe.interpolatePadding(E,R,_t),Z=Xe.centerPoint.add(X));const Mi=_t===1?ae:Xe.unproject(W.add(re.mult(ve(Mt))).mult(yi));return Xe.setLocationAtPoint(Xe.renderWorldCopies?Mi.wrap():Mi,Z),Xe._updateCenterElevation(),i.preloadOnly||this._fireMoveEvents(a),Xe};if(i.preloadOnly){const Xe=this._emulate(Rt,i.duration,d);return this._preloadTiles(Xe),this}return this._zooming=!0,this._rotating=ze,this._pitching=dt,this._padding=yt,this._prepareEase(a,!1),this._ease(Rt(d),()=>this._afterEase(a),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,a)}if(!i){const d=this.handlers;d&&d.stop(!1)}return this}_ease(i,a,d){d.animate===!1||d.duration===0?(i(1),a()):(this._easeStart=o.exported.now(),this._easeOptions=d,this._onEaseFrame=i,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,a){i=o.wrap(i,-180,180);const d=Math.abs(i-a);return Math.abs(i-360-a)<d&&(i-=360),Math.abs(i+360-a)<d&&(i+=360),i}_normalizeCenter(i){const a=this.transform;if(!a.renderWorldCopies||a.maxBounds)return;const d=i.lng-a.center.lng;i.lng+=d>180?-360:d<-180?360:0}_emulate(i,a,d){const _=Math.ceil(15*a/1e3),y=[],b=i(d.clone());for(let E=0;E<=_;E++){const I=b(E/_);y.push(I.clone())}return y}}class yc{constructor(i={}){this.options=i,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const a=this.options&&this.options.compact;return this._map=i,this._container=$.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=$.create("button","mapboxgl-ctrl-attrib-button",this._container),$.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=$.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,a){const d=this._map._getUIString(`AttributionControl.${a}`);i.setAttribute("aria-label",d),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",d)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(i){const d=a.reduce((_,y,b)=>(y.value&&(_+=`${y.key}=${y.value}${b<a.length-1?"&":""}`),_),"?");i.href=`${o.config.FEEDBACK_URL}/${d}${this._map._hash?this._map._hash.getHashString(!0):""}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const a=this._map.style._sourceCaches;for(const _ in a){const y=a[_];if(y.used){const b=y.getSource();b.attribution&&i.indexOf(b.attribution)<0&&i.push(b.attribution)}}i.sort((_,y)=>_.length-y.length),i=i.filter((_,y)=>{for(let b=y+1;b<i.length;b++)if(i[b].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const d=i.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,i.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class vc{constructor(){o.bindAll(["_updateLogo"],this),o.bindAll(["_updateCompact"],this)}onAdd(i){this._map=i,this._container=$.create("div","mapboxgl-ctrl");const a=$.create("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const a in i){const d=i[a].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const a=i[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class xc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const a=++this._id;return this._queue.push({callback:i,id:a,cancelled:!1}),a}remove(i){const a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(const _ of d)if(_.id===i)return void(_.cancelled=!0)}run(i=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const d of a)if(!d.cancelled&&(d.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function bc(h,i,a){if(h=new o.LngLat(h.lng,h.lat),i){const d=new o.LngLat(h.lng-360,h.lat),_=new o.LngLat(h.lng+360,h.lat),y=360*Math.ceil(Math.abs(h.lng-a.center.lng)/360),b=a.locationPoint(h).distSqr(i),E=i.x<0||i.y<0||i.x>a.width||i.y>a.height;a.locationPoint(d).distSqr(i)<b&&(E||Math.abs(d.lng-a.center.lng)<y)?h=d:a.locationPoint(_).distSqr(i)<b&&(E||Math.abs(_.lng-a.center.lng)<y)&&(h=_)}for(;Math.abs(h.lng-a.center.lng)>180;){const d=a.locationPoint(h);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;h.lng>a.center.lng?h.lng-=360:h.lng+=360}return h}const wr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class wc extends o.Evented{constructor(i,a){if(super(),(i instanceof o.window.HTMLElement||a)&&(i=o.extend({element:i},a)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),i&&i.element)this._element=i.element,this._offset=o.pointGeometry.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=$.create("div");const _=41,y=27,b=$.createSVG("svg",{display:"block",height:_*this._scale+"px",width:y*this._scale+"px",viewBox:`0 0 ${y} ${_}`},this._element),E=$.createSVG("radialGradient",{id:"shadowGradient"},$.createSVG("defs",{},b));$.createSVG("stop",{offset:"10%","stop-opacity":.4},E),$.createSVG("stop",{offset:"100%","stop-opacity":.05},E),$.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},b),$.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},b),$.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},b),$.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},b),this._offset=o.pointGeometry.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const d=this._element.classList;for(const _ in wr)d.remove(`mapboxgl-marker-anchor-${_}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=o.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const a=i.code,d=i.charCode||i.keyCode;a!=="Space"&&a!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(i){const a=i.originalEvent.target,d=this._element;this._popup&&(a===d||d.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const i=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(i))return void this._clearFadeTimer();const a=this._map.unproject(i);let d=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const y=this._map.getFreeCameraOptions();if(y.position){const b=y.position.toLngLat();d=b.distanceTo(a)<.9*b.distanceTo(this._lngLat)}}const _=(1-this._map._queryFogOpacity(a))*(d?.2:1);this._element.style.opacity=`${_}`,this._popup&&this._popup._setOpacity(`${_}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(i){const a=this._map.transform;return!!i&&i.x>=0&&i.x<a.width&&i.y>=0&&i.y<a.height}_updateDOM(){const i=this._pos||new o.pointGeometry(0,0),a=this._calculatePitch(),d=this._calculateRotation();this._element.style.transform=`${wr[this._anchor]} translate(${i.x}px, ${i.y}px) rotateX(${a}deg) rotateZ(${d}deg)`}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(i){o.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=bc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),i===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const i=this._map.transform,a=this._offset.mult(this._scale);return this._rotationAlignment==="map"&&a._rotate(i.angle),this._pitchAlignment==="map"&&(a.y*=Math.cos(i._pitch)),a}getOffset(){return this._offset}setOffset(i){return this._offset=o.pointGeometry.convert(i),this._update(),this}_onMove(i){if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(i){this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class ro{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const a=o.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,a,d){this._start=this.getValue(a),this._end=i,this._startTime=a,this._endTime=a+d}}const ch={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:Fn,HTMLElement:ua,ImageBitmap:ha}=o.window,nf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Tc(h){h.parentNode&&h.parentNode.removeChild(h)}const of={showCompass:!0,showZoom:!0,visualizePitch:!1};class uh{constructor(i,a,d=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new xn({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,d&&(this.mousePitch=new dc({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(i,a){this.mouseRotate.mousedown(i,a),this.mousePitch&&this.mousePitch.mousedown(i,a),$.disableDrag()}move(i,a){const d=this.map,_=this.mouseRotate.mousemoveWindow(i,a);if(_&&_.bearingDelta&&d.setBearing(d.getBearing()+_.bearingDelta),this.mousePitch){const y=this.mousePitch.mousemoveWindow(i,a);y&&y.pitchDelta&&d.setPitch(d.getPitch()+y.pitchDelta)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){$.enableDrag(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(o.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),$.mousePos(this.element,i)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,$.mousePos(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=$.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=$.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const es={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Ur,ts=0,da=!1;const is={maxWidth:100,unit:"metric"};function at(h,i,a){const d=a&&a.maxWidth||100,_=h._containerHeight/2,y=h.unproject([0,_]),b=h.unproject([d,_]),E=y.distanceTo(b);if(a&&a.unit==="imperial"){const I=3.2808*E;I>5280?fa(i,d,I/5280,h._getUIString("ScaleControl.Miles"),h):fa(i,d,I,h._getUIString("ScaleControl.Feet"),h)}else a&&a.unit==="nautical"?fa(i,d,E/1852,h._getUIString("ScaleControl.NauticalMiles"),h):E>=1e3?fa(i,d,E/1e3,h._getUIString("ScaleControl.Kilometers"),h):fa(i,d,E,h._getUIString("ScaleControl.Meters"),h)}function fa(h,i,a,d,_){const y=function(E){const I=Math.pow(10,`${Math.floor(E)}`.length-1);let z=E/I;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:function(P){const R=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*R)/R}(z),I*z}(a),b=y/a;_._requestDomTask(()=>{h.style.width=i*b+"px",h.innerHTML=`${y}&nbsp;${d}`})}const hh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},rs=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Co={version:o.version,supported:N,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends lh{constructor(h){if((h=o.extend({},nf,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(h.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ha(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._renderTaskQueue=new xc,this._domRenderTaskQueue=new xc,this._controls=[],this._markers=[],this._mapId=o.uniqueId(),this._locale=o.extend({},ch,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new ro(0),this._requestManager=new o.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,typeof h.container=="string"){if(this._container=o.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof ua))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new ca(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new Yu(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,o.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new yc({customAttribution:h.customAttribution})),this._logoControl=new vc,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new o.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new o.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(h,i){if(i===void 0&&(i=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=h.onAdd(this);this._controls.push(h);const d=this._controlPositions[i];return i.indexOf("bottom")!==-1?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(h);return i>-1&&this._controls.splice(i,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new o.Event("movestart",h)).fire(new o.Event("move",h)),this.fire(new o.Event("resize",h)),i&&this.fire(new o.Event("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(o.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h==null?85:h)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}getProjection(){return this.transform.getProjection()}setProjection(h){return this._lazyInitEmptyStyle(),typeof h=="string"&&(h={name:h}),this._runtimeProjection=h,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(h){return this.transform.locationPoint3D(o.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(o.pointGeometry.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(h,i,a){if(h==="mouseenter"||h==="mouseover"){let d=!1;const _=b=>{const E=i.filter(z=>this.getLayer(z)),I=E.length?this.queryRenderedFeatures(b.point,{layers:E}):[];I.length?d||(d=!0,a.call(this,new Ir(h,this,b.originalEvent,{features:I}))):d=!1},y=()=>{d=!1};return{layers:new Set(i),listener:a,delegates:{mousemove:_,mouseout:y}}}if(h==="mouseleave"||h==="mouseout"){let d=!1;const _=b=>{const E=i.filter(I=>this.getLayer(I));(E.length?this.queryRenderedFeatures(b.point,{layers:E}):[]).length?d=!0:d&&(d=!1,a.call(this,new Ir(h,this,b.originalEvent)))},y=b=>{d&&(d=!1,a.call(this,new Ir(h,this,b.originalEvent)))};return{layers:new Set(i),listener:a,delegates:{mousemove:_,mouseout:y}}}{const d=_=>{const y=i.filter(E=>this.getLayer(E)),b=y.length?this.queryRenderedFeatures(_.point,{layers:y}):[];b.length&&(_.features=b,a.call(this,_),delete _.features)};return{layers:new Set(i),listener:a,delegates:{[h]:d}}}}on(h,i,a){if(a===void 0)return super.on(h,i);Array.isArray(i)||(i=[i]);const d=this._createDelegatedListener(h,i,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return this}once(h,i,a){if(a===void 0)return super.once(h,i);Array.isArray(i)||(i=[i]);const d=this._createDelegatedListener(h,i,a);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(h,i,a){if(a===void 0)return super.off(h,i);i=new Set(Array.isArray(i)?i:[i]);const d=(y,b)=>{if(y.size!==b.size)return!1;for(const E of y)if(!b.has(E))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[h]:void 0;return _&&(y=>{for(let b=0;b<y.length;b++){const E=y[b];if(E.listener===a&&d(E.layers,i)){for(const I in E.delegates)this.off(I,E.delegates[I]);return y.splice(b,1),this}}})(_),this}queryRenderedFeatures(h,i){return this.style?(i!==void 0||h===void 0||h instanceof o.pointGeometry||Array.isArray(h)||(i=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(h,i){return this.style.querySourceFeatures(h,i)}queryTerrainElevation(h,i){const a=this.transform.elevation;return a?(i=o.extend({},{exaggerated:!0},i),a.getAtPoint(o.MercatorCoordinate.fromLngLat(h),null,i.exaggerated)):null}setStyle(h,i){return(i=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(h,i))}_getUIString(h){const i=this._locale[h];if(i==null)throw new Error(`Missing UI string '${h}'`);return i}_updateStyle(h,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),h&&(this.style=new Zr(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Zr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,i){if(typeof h=="string"){const a=this._requestManager.normalizeStyleURL(h),d=this._requestManager.transformRequest(a,o.ResourceType.Style);o.getJSON(d,(_,y)=>{_?this.fire(new o.ErrorEvent(_)):y&&this._updateDiff(y,i)})}else typeof h=="object"&&this._updateDiff(h,i)}_updateDiff(h,i){try{this.style.setState(h)&&this._update(!0)}catch(a){o.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(h,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(h,i){return this._lazyInitEmptyStyle(),this.style.addSource(h,i),this._update(!0)}isSourceLoaded(h){const i=this.style&&this.style._getSourceCaches(h);if(i.length!==0)return i.every(a=>a.loaded());this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${h}'`)))}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const i in h){const a=h[i]._tiles;for(const d in a){const _=a[d];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(h,i,a){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,i,a)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,i,{pixelRatio:a=1,sdf:d=!1,stretchX:_,stretchY:y,content:b}={}){if(this._lazyInitEmptyStyle(),i instanceof Fn||ha&&i instanceof ha){const{width:E,height:I,data:z}=o.exported.getImageData(i);this.style.addImage(h,{data:new o.RGBAImage({width:E,height:I},z),pixelRatio:a,stretchX:_,stretchY:y,content:b,sdf:d,version:0})}else{if(i.width===void 0||i.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:I,data:z}=i,P=i;this.style.addImage(h,{data:new o.RGBAImage({width:E,height:I},new Uint8Array(z)),pixelRatio:a,stretchX:_,stretchY:y,content:b,sdf:d,version:0,userImage:P}),P.onAdd&&P.onAdd(this,h)}}}updateImage(h,i){const a=this.style.getImage(h);if(!a)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=i instanceof Fn||ha&&i instanceof ha?o.exported.getImageData(i):i,{width:_,height:y,data:b}=d;return _===void 0||y===void 0?this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):_!==a.data.width||y!==a.data.height?this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(a.data.replace(b,!(i instanceof Fn||ha&&i instanceof ha)),void this.style.updateImage(h,a))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,i){o.getImage(this._requestManager.transformRequest(h,o.ResourceType.Image),(a,d)=>{i(a,d instanceof Fn?o.exported.getImageData(d):d)})}listImages(){return this.style.listImages()}addLayer(h,i){return this._lazyInitEmptyStyle(),this.style.addLayer(h,i),this._update(!0)}moveLayer(h,i){return this.style.moveLayer(h,i),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,i,a){return this.style.setLayerZoomRange(h,i,a),this._update(!0)}setFilter(h,i,a={}){return this.style.setFilter(h,i,a),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,i,a,d={}){return this.style.setPaintProperty(h,i,a,d),this._update(!0)}getPaintProperty(h,i){return this.style.getPaintProperty(h,i)}setLayoutProperty(h,i,a,d={}){return this.style.setLayoutProperty(h,i,a,d),this._update(!0)}getLayoutProperty(h,i){return this.style.getLayoutProperty(h,i)}setLight(h,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){this.transform.projection.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(h),this.transform):0}setFeatureState(h,i){return this.style.setFeatureState(h,i),this._update()}removeFeatureState(h,i){return this.style.removeFeatureState(h,i),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let a,d=this._container;for(;d&&!a;){const _=o.window.getComputedStyle(d).transform;_&&_!=="none"&&(a=_.match(/matrix.*\((.+)\)/)[1].split(", ")),d=d.parentElement}a?(this._containerWidth=a[0]&&a[0]!=="0"?Math.abs(h/a[0]):h,this._containerHeight=a[3]&&a[3]!=="0"?Math.abs(i/a[3]):i):(this._containerWidth=h,this._containerHeight=i)}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=$.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=$.create("div","mapboxgl-canvas-container",h);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=$.create("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=$.create("div","mapboxgl-control-container",h),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{d[_]=$.create("div",`mapboxgl-ctrl-${_}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,i){const a=o.exported.devicePixelRatio||1;this._canvas.width=a*Math.ceil(h),this._canvas.height=a*Math.ceil(i),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${i}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const i=this._markers.indexOf(h);i!==-1&&this._markers.splice(i,1)}_setupPainter(){const h=o.extend({},N.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);i?(o.storeAuthState(i,!0),this.painter=new Wu(i,this.transform),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(i)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let i;const a=this.painter.context.extTimerQuery,d=o.exported.now();this.listens("gpu-timing-frame")&&(i=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,i));let _=this._updateAverageElevation(d);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjection();let y=!1;const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,z=this.transform.pitch,P=o.exported.now();this.style.zoomHistory.update(I,P);const R=new o.EvaluationParameters(I,{now:P,fadeDuration:b,pitch:z,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),j=R.crossFadingFactor();j===1&&j===this._crossFadingFactor||(y=!0,this._crossFadingFactor=j),this.style.update(R)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const I=o.exported.now()-d;a.endQueryEXT(a.TIME_ELAPSED_EXT,i),setTimeout(()=>{const z=a.getQueryObjectEXT(i,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(i),this.fire(new o.Event("gpu-timing-frame",{cpuTime:I,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(I);this.fire(new o.Event("gpu-timing-layer",{layerTimes:z}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(E||this._repaint)this.triggerRepaint();else{const I=!this.isMoving()&&this.loaded();if(I&&(_=this._updateAverageElevation(d,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const h of this._markers)h._update()}_updateAverageElevation(h,i=!1){const a=d=>(this.transform.averageElevation=d,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);if((i||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const d=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();isNaN(_)?_=0:this._averageElevationLastSampledAt=h;const y=Math.abs(d-_);if(y>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(_),a(_);this._averageElevation.easeTo(_,h,300)}else if(y>1e-4)return this._averageElevation.jumpTo(_),a(_)}return!!this._averageElevation.isEasing(h)&&a(this._averageElevation.getValue(h))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===o.AUTH_ERR_MSG||h.status===401)){const i=this.painter.context.gl;o.storeAuthState(i,!1),this._logoControl instanceof vc&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const a=this.painter.context.gl,d=a.createFramebuffer();function _(y){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,y,0);const b=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,b),b}return a.bindFramebuffer(a.FRAMEBUFFER,d),this._canvasPixelComparison(_(h),i.canvasCopies.map(_),i.timeStamps)}_canvasPixelComparison(h,i,a){let d=a[1]-a[0];const _=h.length/4;for(let y=0;y<i.length;y++){const b=i[y];let E=0;for(let I=0;I<b.length;I+=4)b[I]===h[I]&&b[I+1]===h[I+1]&&b[I+2]===h[I+2]&&b[I+3]===h[I+3]&&(E+=1);d+=(a[y+2]-a[y+1])*(1-E/_)}return d}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),Tc(this._canvasContainer),Tc(this._controlContainer),Tc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=o.exported.frame(i=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(i)}))}_preloadTiles(h){const i=this.style&&Object.values(this.style._sourceCaches)||[];return o.asyncAll(i,(a,d)=>a._preloadTiles(h,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}_setCacheLimits(h,i){o.setCacheLimits(h,i)}get version(){return o.version}},NavigationControl:class{constructor(h){this.options=o.extend({},of,h),this._container=$.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),$.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),$.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=$.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const h=this._map.getZoom(),i=h===this._map.getMaxZoom(),a=h===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())}_rotateCompassArrow(){const h=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=h)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new uh(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,i){const a=$.create("button",h,this._container);return a.type="button",a.addEventListener("click",i),a}_setButtonTitle(h,i){const a=this._map._getUIString(`NavigationControl.${i}`);h.setAttribute("aria-label",a),h.firstElementChild&&h.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends o.Evented{constructor(h){super(),this.options=o.extend({},es,h),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Ao(this._updateMarkerRotation,20)}onAdd(h){var i;return this._map=h,this._container=$.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,Ur!==void 0?i(Ur):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(a=>{Ur=a.state!=="denied",i(Ur)}):(Ur=!!o.window.navigator.geolocation,i(Ur)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,ts=0,da=!1}_isOutOfMapMaxBounds(h){const i=this._map.getMaxBounds(),a=h.coords;return i&&(a.longitude<i.getWest()||a.longitude>i.getEast()||a.latitude<i.getSouth()||a.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",h)),this._finish()}}_updateCamera(h){const i=new o.LngLat(h.coords.longitude,h.coords.latitude),a=h.coords.accuracy,d=this._map.getBearing(),_=o.extend({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(a),_,{geolocateSource:!0})}_updateMarker(h){if(h){const i=new o.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map._containerHeight/2,i=this._map.unproject([0,h]),a=this._map.unproject([100,h]),d=i.distanceTo(a)/100,_=Math.ceil(2*this._accuracy/d);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&da)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=$.create("button","mapboxgl-ctrl-geolocate",this._container),$.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$.create("div","mapboxgl-user-location"),this._dotElement.appendChild($.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild($.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new wc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=$.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new wc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ts--,da=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ts++,ts>1?(h={maximumAge:6e5,timeout:0},da=!0):(h=this.options.positionOptions,da=!1),this._geolocationWatchID=o.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else o.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&h()}).catch(console.error):h()}_clearWatch(){o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:yc,ScaleControl:class{constructor(h){this.options=o.extend({},is,h),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){at(this._map,this._container,this.options)}onAdd(h){return this._map=h,this._container=$.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(h){this.options.unit=h,at(this._map,this._container,this.options)}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof o.window.HTMLElement?this._container=h.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=$.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=$.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);$.create("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden",!0),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(h){super(),this.options=o.extend(Object.create(hh),h),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=o.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(o.window.document.createTextNode(h))}setHTML(h){const i=o.window.document.createDocumentFragment(),a=o.window.document.createElement("body");let d;for(a.innerHTML=h;d=a.firstChild,d;)i.appendChild(d);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=$.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._container&&this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._container&&this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let i;return this._classList.delete(h)?i=!1:(this._classList.add(h),i=!0),this._container&&this._updateClassList(),i}_createCloseButton(){this.options.closeButton&&(this._closeButton=$.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(h){this._update(h.point)}_onMouseMove(h){this._update(h.point)}_onDrag(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const i=this._pos,a=this._container.offsetWidth,d=this._container.offsetHeight;let _;return _=i.y+h.bottom.y<d?["top"]:i.y>this._map.transform.height-d?["bottom"]:[],i.x<a/2?_.push("left"):i.x>this._map.transform.width-a/2&&_.push("right"),_.length===0?"bottom":_.join("-")}_updateClassList(){const h=[...this._classList];h.push("mapboxgl-popup"),this._anchor&&h.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&h.push("mapboxgl-popup-track-pointer"),this._container.className=h.join(" ")}_update(h){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=$.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=$.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=bc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h){const i=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),a=function(y){if(y||(y=new o.pointGeometry(0,0)),typeof y=="number"){const b=Math.round(Math.sqrt(.5*Math.pow(y,2)));return{center:new o.pointGeometry(0,0),top:new o.pointGeometry(0,y),"top-left":new o.pointGeometry(b,b),"top-right":new o.pointGeometry(-b,b),bottom:new o.pointGeometry(0,-y),"bottom-left":new o.pointGeometry(b,-b),"bottom-right":new o.pointGeometry(-b,-b),left:new o.pointGeometry(y,0),right:new o.pointGeometry(-y,0)}}if(y instanceof o.pointGeometry||Array.isArray(y)){const b=o.pointGeometry.convert(y);return{center:b,top:b,"top-left":b,"top-right":b,bottom:b,"bottom-left":b,"bottom-right":b,left:b,right:b}}return{center:o.pointGeometry.convert(y.center||[0,0]),top:o.pointGeometry.convert(y.top||[0,0]),"top-left":o.pointGeometry.convert(y["top-left"]||[0,0]),"top-right":o.pointGeometry.convert(y["top-right"]||[0,0]),bottom:o.pointGeometry.convert(y.bottom||[0,0]),"bottom-left":o.pointGeometry.convert(y["bottom-left"]||[0,0]),"bottom-right":o.pointGeometry.convert(y["bottom-right"]||[0,0]),left:o.pointGeometry.convert(y.left||[0,0]),right:o.pointGeometry.convert(y.right||[0,0])}}(this.options.offset),d=this._anchor=this._getAnchor(a),_=i.add(a[d]).round();this._map._requestDomTask(()=>{this._container&&d&&(this._container.style.transform=`${wr[d]} translate(${_.x}px,${_.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(rs);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._content&&(this._content.style.opacity=h),this._tip&&(this._tip.style.opacity=h)}},Marker:wc,Style:Zr,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:Xu,Evented:o.Evented,config:o.config,prewarm:function(){ue().acquire(le)},clearPrewarmedResources:function(){const h=fe;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(le),fe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(h){o.config.ACCESS_TOKEN=h},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(h){o.config.API_URL=h},get workerCount(){return he.workerCount},set workerCount(h){he.workerCount=h},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){o.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){o.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Co});var k=x;return k})})(am);var Mv=am.exports,zb=eb({__proto__:null,default:Mv},[am.exports]);const Pb=Ud(null);function Hg(l){return{longitude:l.center.lng,latitude:l.center.lat,zoom:l.zoom,pitch:l.pitch,bearing:l.bearing,padding:l.padding}}function Xg(l,s){const f=s.viewState||s;let m=!1;if("longitude"in f&&"latitude"in f){const x=l.center;l.center=new x.constructor(f.longitude,f.latitude),m=m||x!==l.center}if("zoom"in f){const x=l.zoom;l.zoom=f.zoom,m=m||x!==l.zoom}if("bearing"in f){const x=l.bearing;l.bearing=f.bearing,m=m||x!==l.bearing}if("pitch"in f){const x=l.pitch;l.pitch=f.pitch,m=m||x!==l.pitch}return f.padding&&!l.isPaddingEqual(f.padding)&&(m=!0,l.padding=f.padding),m}const Db=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Kg(l){if(!l)return null;if(typeof l=="string"||("toJS"in l&&(l=l.toJS()),!l.layers))return l;const s={};for(const m of l.layers)s[m.id]=m;const f=l.layers.map(m=>{const x=s[m.ref];let T=null;if("interactive"in m&&(T=wi({},m),delete T.interactive),x){T=T||wi({},m),delete T.ref;for(const k of Db)k in x&&(T[k]=x[k])}return T||m});return dr(wi({},l),{layers:f})}function Lb(l,s){const f=Array.isArray(l)?l[0]:l?l.x:0,m=Array.isArray(l)?l[1]:l?l.y:0,x=Array.isArray(s)?s[0]:s?s.x:0,T=Array.isArray(s)?s[1]:s?s.y:0;return f===x&&m===T}function Qn(l,s){if(l===s)return!0;if(!l||!s)return!1;if(Array.isArray(l)){if(!Array.isArray(s)||l.length!==s.length)return!1;for(let f=0;f<l.length;f++)if(!Qn(l[f],s[f]))return!1;return!0}else if(Array.isArray(s))return!1;if(typeof l=="object"&&typeof s=="object"){const f=Object.keys(l),m=Object.keys(s);if(f.length!==m.length)return!1;for(const x of f)if(!s.hasOwnProperty(x)||!Qn(l[x],s[x]))return!1;return!0}return!1}const Yg={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},_p={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Jg={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Rb=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Bb=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Ol{constructor(s,f,m){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=x=>{const T=this.props[Jg[x.type]];T&&T(x)},this._onPointerEvent=x=>{(x.type==="mousemove"||x.type==="mouseout")&&this._updateHover(x);const T=this.props[Yg[x.type]];if(T){if(this.props.interactiveLayerIds&&x.type!=="mouseover"&&x.type!=="mouseout"){const k=this._hoveredFeatures||this._map.queryRenderedFeatures(x.point,{layers:this.props.interactiveLayerIds});if(!k.length)return;x.features=k}T(x),delete x.features}},this._onCameraEvent=x=>{if(!this._internalUpdate){const T=this.props[_p[x.type]];T&&T(x)}x.type in this._deferredEvents&&(this._deferredEvents[x.type]=!1)},this._MapClass=s,this.props=f,this._initialize(m)}get map(){return this._map}get transform(){return this._renderTransform}setProps(s){const f=this.props;this.props=s;const m=this._updateSettings(s,f);m&&(this._renderTransform=this._map.transform.clone());const x=this._updateSize(s),T=this._updateViewState(s,!0);this._updateStyle(s,f),this._updateStyleComponents(s,f),this._updateHandlers(s,f),(m||x||T&&!this._map.isMoving())&&this.redraw()}static reuse(s,f){const m=Ol.savedMaps.pop();if(!m)return null;const x=m.map,T=x.getContainer();for(f.className=T.className;T.childNodes.length>0;)f.appendChild(T.childNodes[0]);return x._container=f,s.initialViewState&&m._updateViewState(s.initialViewState,!1),x.resize(),m.setProps(dr(wi({},s),{styleDiffing:!1})),x.isStyleLoaded()?x.fire("load"):x.once("styledata",()=>x.fire("load")),m}_initialize(s){const{props:f}=this,m=dr(wi(wi({},f),f.initialViewState),{accessToken:f.mapboxAccessToken||Ob()||null,container:s,style:Kg(f.mapStyle)}),x=m.initialViewState||m.viewState||m;if(Object.assign(m,{center:[x.longitude||0,x.latitude||0],zoom:x.zoom||0,pitch:x.pitch||0,bearing:x.bearing||0}),f.gl){const U=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=U,f.gl)}const T=new this._MapClass(m);x.padding&&T.setPadding(x.padding),f.cursor&&(T.getCanvas().style.cursor=f.cursor),this._renderTransform=T.transform.clone();const k=T._render;T._render=U=>{this._inRender=!0,k.call(T,U),this._inRender=!1};const o=T._renderTaskQueue.run;T._renderTaskQueue.run=U=>{o.call(T._renderTaskQueue,U),this._onBeforeRepaint()},T.on("render",()=>this._onAfterRepaint());const N=T.fire;T.fire=this._fireEvent.bind(this,N),T.on("resize",()=>{this._renderTransform.resize(T.transform.width,T.transform.height)}),T.on("styledata",()=>this._updateStyleComponents(this.props,{})),T.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const U in Yg)T.on(U,this._onPointerEvent);for(const U in _p)T.on(U,this._onCameraEvent);for(const U in Jg)T.on(U,this._onEvent);this._map=T}recycle(){Ol.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const s=this._map;!this._inRender&&s.style&&(s._frame&&(s._frame.cancel(),s._frame=null),s._render())}_updateSize(s){const{viewState:f}=s;if(f){const m=this._map;if(f.width!==m.transform.width||f.height!==m.transform.height)return m.resize(),!0}return!1}_updateViewState(s,f){if(this._internalUpdate)return!1;const m=this._map,x=this._renderTransform,{zoom:T,pitch:k,bearing:o}=x,N=Xg(x,wi(wi({},Hg(m.transform)),s));if(N&&f){const U=this._deferredEvents;U.move=!0,U.zoom||(U.zoom=T!==x.zoom),U.rotate||(U.rotate=o!==x.bearing),U.pitch||(U.pitch=k!==x.pitch)}return m.isMoving()||Xg(m.transform,s),N}_updateSettings(s,f){const m=this._map;let x=!1;for(const T of Rb)T in s&&!Qn(s[T],f[T])&&(x=!0,m[`set${T[0].toUpperCase()}${T.slice(1)}`](s[T]));return x}_updateStyle(s,f){if(s.cursor!==f.cursor&&(this._map.getCanvas().style.cursor=s.cursor),s.mapStyle!==f.mapStyle){const m={diff:s.styleDiffing};return"localIdeographFontFamily"in s&&(m.localIdeographFontFamily=s.localIdeographFontFamily),this._map.setStyle(Kg(s.mapStyle),m),!0}return!1}_updateStyleComponents(s,f){const m=this._map;let x=!1;return m.style.loaded()&&("light"in s&&!Qn(s.light,f.light)&&(x=!0,m.setLight(s.light)),"fog"in s&&!Qn(s.fog,f.fog)&&(x=!0,m.setFog(s.fog)),"terrain"in s&&!Qn(s.terrain,f.terrain)&&(!s.terrain||m.getSource(s.terrain.source))&&(x=!0,m.setTerrain(s.terrain),this._renderTransform.elevation=m.transform.elevation)),x}_updateHandlers(s,f){const m=this._map;let x=!1;for(const T of Bb){const k=s[T];Qn(k,f[T])||(x=!0,k?m[T].enable(k):m[T].disable())}return x}_updateHover(s){var x;const{props:f}=this;if(f.interactiveLayerIds&&(f.onMouseMove||f.onMouseEnter||f.onMouseLeave)){const T=s.type,k=((x=this._hoveredFeatures)==null?void 0:x.length)>0;let o;if(T==="mousemove")try{o=this._map.queryRenderedFeatures(s.point,{layers:f.interactiveLayerIds})}catch{o=[]}else o=[];const N=o.length>0;!N&&k&&(s.type="mouseleave",this._onPointerEvent(s)),this._hoveredFeatures=o,N&&!k&&(s.type="mouseenter",this._onPointerEvent(s)),s.type=T}else this._hoveredFeatures=null}_fireEvent(s,f,m){const x=this._map,T=x.transform,k=typeof f=="string"?f:f.type;return k==="move"&&this._updateViewState(this.props,!1),k in _p&&(typeof f=="object"&&(f.viewState=Hg(T)),this._map.isMoving())?(x.transform=this._renderTransform,s.call(x,f,m),x.transform=T,x):(s.call(x,f,m),x)}_onBeforeRepaint(){const s=this._map;this._internalUpdate=!0;for(const m in this._deferredEvents)this._deferredEvents[m]&&s.fire(m);this._internalUpdate=!1;const f=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=f}}}Ol.savedMaps=[];function Ob(){let l=null;if(typeof location!="undefined"){const s=/access_token=([^&\/]*)/.exec(location.search);l=s&&s[1]}try{l=l||{}.MapboxAccessToken}catch{}try{l=l||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return l}const Fb=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Ub(l,s){if(!l)return null;const f=l.map,m={getMap:()=>f,getCenter:()=>l.transform.center,getZoom:()=>l.transform.zoom,getBearing:()=>l.transform.bearing,getPitch:()=>l.transform.pitch,getPadding:()=>l.transform.padding,getBounds:()=>l.transform.getBounds(),project:x=>l.transform.locationPoint(s.LngLat.convert(x)),unproject:x=>l.transform.pointLocation(s.Point.convert(x))};for(const x of Vb(f))!(x in m)&&!Fb.includes(x)&&(m[x]=f[x].bind(f));return m}function Vb(l){const s=new Set;let f=l;for(;f;){for(const m of Object.getOwnPropertyNames(f))m[0]!=="_"&&typeof l[m]=="function"&&m!=="fire"&&m!=="setEventedParent"&&s.add(m);f=Object.getPrototypeOf(f)}return Array.from(s)}const Nb=typeof document!="undefined"?xs:Jt,jb=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function Gb(l,s){for(const f of jb)f in s&&(l[f]=s[f]);s.RTLTextPlugin&&l.getRTLTextPluginStatus&&l.getRTLTextPluginStatus()==="unavailable"&&l.setRTLTextPlugin(s.RTLTextPlugin,f=>{f&&console.error(f)},!1)}const jl=Ud(null),$b={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:l=>console.error(l.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},Ad=Su((l,s)=>{const f=bs(Pb),[m,x]=Ri(null),T=vt(),{current:k}=vt({mapLib:null,map:null});Jt(()=>{const N=l.mapLib;let U=!0,V;return Promise.resolve(N||Promise.resolve().then(function(){return zb})).then(F=>{if(!!U){if(F.Map||(F=F.default),!F||!F.Map)throw new Error("Invalid mapLib");if(F.supported(l))Gb(F,l),l.reuseMaps&&(V=Ol.reuse(l,T.current)),V||(V=new Ol(F.Map,l,T.current)),k.map=Ub(V,F),k.mapLib=F,x(V),f==null||f.onMapMount(k.map,l.id);else throw new Error("Map is not supported by this browser")}}).catch(F=>{l.onError({type:"error",target:null,originalEvent:null,error:F})}),()=>{U=!1,V&&(f==null||f.onMapUnmount(l.id),l.reuseMaps?V.recycle():V.destroy())}},[]),Nb(()=>{m&&m.setProps(l)}),Nl(s,()=>k.map,[m]);const o=Gr(()=>wi({position:"relative",width:"100%",height:"100%"},l.style),[l.style]);return Mn("div",{id:l.id,ref:T,style:o},m&&Mn(jl.Provider,{value:k},l.children))});Ad.displayName="Map";Ad.defaultProps=$b;const Zb=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function ws(l,s){if(!l||!s)return;const f=l.style;for(const m in s){const x=s[m];Number.isFinite(x)&&!Zb.test(m)?f[m]=`${x}px`:f[m]=x}}const qb={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function Iv(l){const{map:s,mapLib:f}=bs(jl),m=vt({props:l});m.current.props=l;const x=Gr(()=>{let T=!1;om.forEach(l.children,N=>{N&&(T=!0)});const k=dr(wi({},l),{element:T?document.createElement("div"):null}),o=new f.Marker(k).setLngLat([l.longitude,l.latitude]);return o.getElement().addEventListener("click",N=>{var U,V;(V=(U=m.current.props).onClick)==null||V.call(U,{type:"click",target:o,originalEvent:N})}),o.on("dragstart",N=>{var V,F;const U=N;U.lngLat=x.getLngLat(),(F=(V=m.current.props).onDragStart)==null||F.call(V,U)}),o.on("drag",N=>{var V,F;const U=N;U.lngLat=x.getLngLat(),(F=(V=m.current.props).onDrag)==null||F.call(V,U)}),o.on("dragend",N=>{var V,F;const U=N;U.lngLat=x.getLngLat(),(F=(V=m.current.props).onDragEnd)==null||F.call(V,U)}),o},[]);return Jt(()=>(x.addTo(s.getMap()),()=>{x.remove()}),[]),Jt(()=>{ws(x.getElement(),l.style)},[l.style]),(x.getLngLat().lng!==l.longitude||x.getLngLat().lat!==l.latitude)&&x.setLngLat([l.longitude,l.latitude]),l.offset&&!Lb(x.getOffset(),l.offset)&&x.setOffset(l.offset),x.isDraggable()!==l.draggable&&x.setDraggable(l.draggable),x.getRotation()!==l.rotation&&x.setRotation(l.rotation),x.getRotationAlignment()!==l.rotationAlignment&&x.setRotationAlignment(l.rotationAlignment),x.getPitchAlignment()!==l.pitchAlignment&&x.setPitchAlignment(l.pitchAlignment),x.getPopup()!==l.popup&&x.setPopup(l.popup),Vd(l.children,x.getElement())}Iv.defaultProps=qb;var gp=Ia(Iv);function Qg(l){return new Set(l?l.trim().split(/\s+/):[])}function Wb(l){const{map:s,mapLib:f}=bs(jl),m=Gr(()=>document.createElement("div"),[]),x=vt({props:l});x.current.props=l;const T=Gr(()=>{const k=wi({},l),o=new f.Popup(k).setLngLat([l.longitude,l.latitude]);return o.on("open",N=>{var U,V;(V=(U=x.current.props).onOpen)==null||V.call(U,N)}),o.on("close",N=>{var U,V;(V=(U=x.current.props).onClose)==null||V.call(U,N)}),o},[]);if(Jt(()=>(T.setDOMContent(m).addTo(s.getMap()),()=>{T.isOpen()&&T.remove()}),[]),Jt(()=>{ws(T.getElement(),l.style)},[l.style]),T.isOpen()&&((T.getLngLat().lng!==l.longitude||T.getLngLat().lat!==l.latitude)&&T.setLngLat([l.longitude,l.latitude]),l.offset&&!Qn(T.options.offset,l.offset)&&T.setOffset(l.offset),(T.options.anchor!==l.anchor||T.options.maxWidth!==l.maxWidth)&&(T.options.anchor=l.anchor,T.setMaxWidth(l.maxWidth)),T.options.className!==l.className)){const k=Qg(T.options.className),o=Qg(l.className);for(const N of k)o.has(N)||T.removeClassName(N);for(const N of o)k.has(N)||T.addClassName(N);T.options.className=l.className}return Vd(l.children,m)}var Hb=Ia(Wb);function Eu(l,s,f){const m=bs(jl),x=Gr(()=>l(m),[]);return Jt(()=>{var k;const{map:T}=m;return T.hasControl(x)||T.addControl(x,(k=f||s)==null?void 0:k.position),()=>{typeof s=="function"&&s(m),T.hasControl(x)&&T.removeControl(x)}},[]),x}function Xb(l){const s=Eu(({mapLib:f})=>new f.AttributionControl(l),{position:l.position});return Jt(()=>{ws(s._container,l.style)},[l.style]),null}var Kb=Ia(Xb);function Yb(l){const s=Eu(({mapLib:f})=>new f.FullscreenControl({container:l.containerId&&document.getElementById(l.containerId)}),{position:l.position});return Jt(()=>{ws(s._controlContainer,l.style)},[l.style]),null}Ia(Yb);const kv=Su((l,s)=>{const f=vt({props:l}),m=Eu(({mapLib:x})=>{const T=new x.GeolocateControl(l);return T.on("geolocate",k=>{var o,N;(N=(o=f.current.props).onGeolocate)==null||N.call(o,k)}),T.on("error",k=>{var o,N;(N=(o=f.current.props).onError)==null||N.call(o,k)}),T.on("outofmaxbounds",k=>{var o,N;(N=(o=f.current.props).onOutOfMaxBounds)==null||N.call(o,k)}),T.on("trackuserlocationstart",k=>{var o,N;(N=(o=f.current.props).onTrackUserLocationStart)==null||N.call(o,k)}),T.on("trackuserlocationend",k=>{var o,N;(N=(o=f.current.props).onTrackUserLocationEnd)==null||N.call(o,k)}),T},{position:l.position});return f.current.props=l,Nl(s,()=>({trigger:()=>m.trigger()}),[]),Jt(()=>{ws(m._container,l.style)},[l.style]),null});kv.displayName="GeolocateControl";var Jb=Ia(kv);function Qb(l){const s=Eu(({mapLib:f})=>new f.NavigationControl(l),{position:l.position});return Jt(()=>{ws(s._container,l.style)},[l.style]),null}var ey=Ia(Qb);const ew={unit:"metric",maxWidth:100};function zv(l){const s=Eu(({mapLib:f})=>new f.ScaleControl(l),{position:l.position});return(s.options.unit!==l.unit||s.options.maxWidth!==l.maxWidth)&&(s.options.maxWidth=l.maxWidth,s.setUnit(l.unit)),Jt(()=>{ws(s._container,l.style)},[l.style]),null}zv.defaultProps=ew;Ia(zv);function Cd(l,s){if(!l)throw new Error(s)}let tw=0;function iw(l,s,f){if(l.style&&l.style._loaded){const m=wi({},f);return delete m.id,delete m.children,l.addSource(s,m),l.getSource(s)}return null}function rw(l,s,f){Cd(s.id===f.id,"source id changed"),Cd(s.type===f.type,"source type changed");let m="",x=0;for(const k in s)k!=="children"&&k!=="id"&&!Qn(f[k],s[k])&&(m=k,x++);if(!x)return;const T=s.type;if(T==="geojson")l.setData(s.data);else if(T==="image")l.updateImage({url:s.url,coordinates:s.coordinates});else if((T==="canvas"||T==="video")&&x===1&&m==="coordinates")l.setCoordinates(s.coordinates);else if(T==="vector"&&"setUrl"in l)switch(m){case"url":l.setUrl(s.url);break;case"tiles":l.setTiles(s.tiles);break}else console.warn(`Unable to update <Source> prop: ${m}`)}function ty(l){const s=bs(jl).map.getMap(),f=vt(l),[,m]=Ri(0),x=Gr(()=>l.id||`jsx-source-${tw++}`,[]);Jt(()=>{if(s){const k=()=>m(o=>o+1);return s.on("styledata",k),k(),()=>{s.off("styledata",k),setTimeout(()=>{s.style&&s.style._loaded&&s.getSource(x)&&s.removeSource(x)},0)}}},[s]);let T=s&&s.style&&s.getSource(x);return T?rw(T,l,f.current):T=iw(s,x,l),f.current=l,T&&om.map(l.children,k=>k&&Av(k,{source:x}))||null}function nw(l,s,f,m){if(Cd(f.id===m.id,"layer id changed"),Cd(f.type===m.type,"layer type changed"),f.type==="custom"||m.type==="custom")return;const{layout:x={},paint:T={},filter:k,minzoom:o,maxzoom:N,beforeId:U}=f;if(U!==m.beforeId&&l.moveLayer(s,U),x!==m.layout){const V=m.layout||{};for(const F in x)Qn(x[F],V[F])||l.setLayoutProperty(s,F,x[F]);for(const F in V)x.hasOwnProperty(F)||l.setLayoutProperty(s,F,void 0)}if(T!==m.paint){const V=m.paint||{};for(const F in T)Qn(T[F],V[F])||l.setPaintProperty(s,F,T[F]);for(const F in V)T.hasOwnProperty(F)||l.setPaintProperty(s,F,void 0)}Qn(k,m.filter)||l.setFilter(s,k),(o!==m.minzoom||N!==m.maxzoom)&&l.setLayerZoomRange(s,o,N)}function ow(l,s,f){if(l.style&&l.style._loaded&&l.getSource(f.source)){const m=dr(wi({},f),{id:s});delete m.beforeId,l.addLayer(m,f.beforeId)}}let aw=0;function iy(l){const s=bs(jl).map.getMap(),f=vt(l),[,m]=Ri(0),x=Gr(()=>l.id||`jsx-layer-${aw++}`,[]);if(Jt(()=>{if(s){const k=()=>m(o=>o+1);return s.on("styledata",k),k(),()=>{s.off("styledata",k),s.style&&s.style._loaded&&s.removeLayer(x)}}},[s]),s&&s.style&&s.getLayer(x))try{nw(s,x,l,f.current)}catch(k){console.warn(k)}else ow(s,x,l);return f.current=l,null}var sw=function(s){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},x=void 0,T=void 0,k=void 0,o=[];return function(){var V=lw(f),F=new Date().getTime(),Y=!x||F-x>V;x=F;for(var $=arguments.length,ye=Array($),be=0;be<$;be++)ye[be]=arguments[be];if(Y&&m.leading)return m.accumulate?Promise.resolve(s.call(this,[ye])).then(function(Ge){return Ge[0]}):Promise.resolve(s.call.apply(s,[this].concat(ye)));if(T?clearTimeout(k):T=cw(),o.push(ye),k=setTimeout(N.bind(this),V),m.accumulate){var Ue=o.length-1;return T.promise.then(function(Ge){return Ge[Ue]})}return T.promise};function N(){var U=T;clearTimeout(k),Promise.resolve(m.accumulate?s.call(this,o):s.apply(this,o[o.length-1])).then(U.resolve,U.reject),o=[],T=null}};function lw(l){return typeof l=="function"?l():l}function cw(){var l={};return l.promise=new Promise(function(s,f){l.resolve=s,l.reject=f}),l}function uw(l){var s=null,f=null,m=new Promise(function(x,T){s=x,f=T});return l&&l.then(function(x){s&&s(x)},function(x){f&&f(x)}),{promise:m,resolve:function(x){s&&s(x)},reject:function(x){f&&f(x)},cancel:function(){s=null,f=null}}}function hw(l){var s=null,f=function(){for(var m=[],x=0;x<arguments.length;x++)m[x]=arguments[x];s&&s();var T=l.apply(void 0,m),k=uw(T),o=k.promise,N=k.cancel;return s=N,o};return f}/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Lp=function(){return Lp=Object.assign||function(s){for(var f,m=1,x=arguments.length;m<x;m++){f=arguments[m];for(var T in f)Object.prototype.hasOwnProperty.call(f,T)&&(s[T]=f[T])}return s},Lp.apply(this,arguments)},dw={key:function(){for(var l=[],s=0;s<arguments.length;s++)l[s]=arguments[s];return null},onlyResolvesLast:!0},fw=function(){function l(s){this.config=s,this.debounceSingleton=null,this.debounceCache={}}return l.prototype._createDebouncedFunction=function(){var s=sw(this.config.func,this.config.wait,this.config.options);return this.config.options.onlyResolvesLast&&(s=hw(s)),{func:s}},l.prototype.getDebouncedFunction=function(s){var f,m=(f=this.config.options).key.apply(f,s);return m===null||typeof m=="undefined"?(this.debounceSingleton||(this.debounceSingleton=this._createDebouncedFunction()),this.debounceSingleton):(this.debounceCache[m]||(this.debounceCache[m]=this._createDebouncedFunction()),this.debounceCache[m])},l}();function pw(l,s,f){var m=Lp({},dw,f),x=new fw({func:l,wait:s,options:m}),T=function(){for(var k=[],o=0;o<arguments.length;o++)k[o]=arguments[o];var N=x.getDebouncedFunction(k).func;return N.apply(void 0,k)};return T}var mw=_w()?xs:Jt;function _w(){return!!(typeof window!="undefined"&&window.document&&window.document.createElement)}function gw(){var l=Ri(Object.create(null)),s=l[1];return Yt(function(){s(Object.create(null))},[])}var yw=function(s){var f=s.children,m=s.type,x=m===void 0?"reach-portal":m,T=vt(null),k=vt(null),o=gw();return mw(function(){if(!!T.current){var N=T.current.ownerDocument;return k.current=N==null?void 0:N.createElement(x),N.body.appendChild(k.current),o(),function(){k.current&&k.current.ownerDocument&&k.current.ownerDocument.body.removeChild(k.current)}}},[x,o]),k.current?Vd(f,k.current):Mn("span",{ref:T})};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ut=function(){return ut=Object.assign||function(s){for(var f,m=1,x=arguments.length;m<x;m++){f=arguments[m];for(var T in f)Object.prototype.hasOwnProperty.call(f,T)&&(s[T]=f[T])}return s},ut.apply(this,arguments)};function sm(l,s){var f={};for(var m in l)Object.prototype.hasOwnProperty.call(l,m)&&s.indexOf(m)<0&&(f[m]=l[m]);if(l!=null&&typeof Object.getOwnPropertySymbols=="function")for(var x=0,m=Object.getOwnPropertySymbols(l);x<m.length;x++)s.indexOf(m[x])<0&&Object.prototype.propertyIsEnumerable.call(l,m[x])&&(f[m[x]]=l[m[x]]);return f}function Ti(l){var s=typeof Symbol=="function"&&Symbol.iterator,f=s&&l[s],m=0;if(f)return f.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&m>=l.length&&(l=void 0),{value:l&&l[m++],done:!l}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function Pi(l,s){var f=typeof Symbol=="function"&&l[Symbol.iterator];if(!f)return l;var m=f.call(l),x,T=[],k;try{for(;(s===void 0||s-- >0)&&!(x=m.next()).done;)T.push(x.value)}catch(o){k={error:o}}finally{try{x&&!x.done&&(f=m.return)&&f.call(m)}finally{if(k)throw k.error}}return T}function fr(l,s,f){if(f||arguments.length===2)for(var m=0,x=s.length,T;m<x;m++)(T||!(m in s))&&(T||(T=Array.prototype.slice.call(s,0,m)),T[m]=s[m]);return l.concat(T||Array.prototype.slice.call(s))}var Ui;(function(l){l.Start="xstate.start",l.Stop="xstate.stop",l.Raise="xstate.raise",l.Send="xstate.send",l.Cancel="xstate.cancel",l.NullEvent="",l.Assign="xstate.assign",l.After="xstate.after",l.DoneState="done.state",l.DoneInvoke="done.invoke",l.Log="xstate.log",l.Init="xstate.init",l.Invoke="xstate.invoke",l.ErrorExecution="error.execution",l.ErrorCommunication="error.communication",l.ErrorPlatform="error.platform",l.ErrorCustom="xstate.error",l.Update="xstate.update",l.Pure="xstate.pure",l.Choose="xstate.choose"})(Ui||(Ui={}));var yu;(function(l){l.Parent="#_parent",l.Internal="#_internal"})(yu||(yu={}));var Rp=Ui.Start,lm=Ui.Stop,Nd=Ui.Raise,jd=Ui.Send,Pv=Ui.Cancel,vw=Ui.NullEvent,Bp=Ui.Assign;Ui.After;Ui.DoneState;var Dv=Ui.Log,xw=Ui.Init,Op=Ui.Invoke;Ui.ErrorExecution;var ry=Ui.ErrorPlatform,bw=Ui.ErrorCustom,Lv=Ui.Update,ww=Ui.Choose,Tw=Ui.Pure,Rv=".",ny={},Fp="xstate.guard",Sw="",qc=!0,Kh;function cm(l,s,f){f===void 0&&(f=Rv);var m=au(l,f),x=au(s,f);return zi(x)?zi(m)?x===m:!1:zi(m)?m in x:Object.keys(m).every(function(T){return T in x?cm(m[T],x[T]):!1})}function Bv(l){try{return zi(l)||typeof l=="number"?"".concat(l):l.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function Up(l,s){try{return Gl(l)?l:l.toString().split(s)}catch{throw new Error("'".concat(l,"' is not a valid state path."))}}function Ew(l){return typeof l=="object"&&"value"in l&&"context"in l&&"event"in l&&"_event"in l}function au(l,s){if(Ew(l))return l.value;if(Gl(l))return Md(l);if(typeof l!="string")return l;var f=Up(l,s);return Md(f)}function Md(l){if(l.length===1)return l[0];for(var s={},f=s,m=0;m<l.length-1;m++)m===l.length-2?f[l[m]]=l[m+1]:(f[l[m]]={},f=f[l[m]]);return s}function eu(l,s){for(var f={},m=Object.keys(l),x=0;x<m.length;x++){var T=m[x];f[T]=s(l[T],T,l,x)}return f}function oy(l,s,f){var m,x,T={};try{for(var k=Ti(Object.keys(l)),o=k.next();!o.done;o=k.next()){var N=o.value,U=l[N];!f(U)||(T[N]=s(U,N,l))}}catch(V){m={error:V}}finally{try{o&&!o.done&&(x=k.return)&&x.call(k)}finally{if(m)throw m.error}}return T}var Aw=function(l){return function(s){var f,m,x=s;try{for(var T=Ti(l),k=T.next();!k.done;k=T.next()){var o=k.value;x=x[o]}}catch(N){f={error:N}}finally{try{k&&!k.done&&(m=T.return)&&m.call(T)}finally{if(f)throw f.error}}return x}};function Cw(l,s){return function(f){var m,x,T=f;try{for(var k=Ti(l),o=k.next();!o.done;o=k.next()){var N=o.value;T=T[s][N]}}catch(U){m={error:U}}finally{try{o&&!o.done&&(x=k.return)&&x.call(k)}finally{if(m)throw m.error}}return T}}function gd(l){if(!l)return[[]];if(zi(l))return[[l]];var s=er(Object.keys(l).map(function(f){var m=l[f];return typeof m!="string"&&(!m||!Object.keys(m).length)?[[f]]:gd(l[f]).map(function(x){return[f].concat(x)})}));return s}function er(l){var s;return(s=[]).concat.apply(s,fr([],Pi(l),!1))}function Ov(l){return Gl(l)?l:[l]}function uo(l){return l===void 0?[]:Ov(l)}function Id(l,s,f){var m,x;if(Fi(l))return l(s,f.data);var T={};try{for(var k=Ti(Object.keys(l)),o=k.next();!o.done;o=k.next()){var N=o.value,U=l[N];Fi(U)?T[N]=U(s,f.data):T[N]=U}}catch(V){m={error:V}}finally{try{o&&!o.done&&(x=k.return)&&x.call(k)}finally{if(m)throw m.error}}return T}function Mw(l){return/^(done|error)\./.test(l)}function ay(l){return!!(l instanceof Promise||l!==null&&(Fi(l)||typeof l=="object")&&Fi(l.then))}function Iw(l){return l!==null&&typeof l=="object"&&"transition"in l&&typeof l.transition=="function"}function Fv(l,s){var f,m,x=Pi([[],[]],2),T=x[0],k=x[1];try{for(var o=Ti(l),N=o.next();!N.done;N=o.next()){var U=N.value;s(U)?T.push(U):k.push(U)}}catch(V){f={error:V}}finally{try{N&&!N.done&&(m=o.return)&&m.call(o)}finally{if(f)throw f.error}}return[T,k]}function Uv(l,s){return eu(l.states,function(f,m){if(!!f){var x=(zi(s)?void 0:s[m])||(f?f.current:void 0);if(!!x)return{current:x,states:Uv(f,x)}}})}function kw(l,s){return{current:s,states:Uv(l,s)}}function sy(l,s,f,m){var x=l&&f.reduce(function(T,k){var o,N,U=k.assignment,V={state:m,action:k,_event:s},F={};if(Fi(U))F=U(T,s.data,V);else try{for(var Y=Ti(Object.keys(U)),$=Y.next();!$.done;$=Y.next()){var ye=$.value,be=U[ye];F[ye]=Fi(be)?be(T,s.data,V):be}}catch(Ue){o={error:Ue}}finally{try{$&&!$.done&&(N=Y.return)&&N.call(Y)}finally{if(o)throw o.error}}return Object.assign({},T,F)},l);return x}var su=function(){};function Gl(l){return Array.isArray(l)}function Fi(l){return typeof l=="function"}function zi(l){return typeof l=="string"}function Vv(l,s){if(!!l)return zi(l)?{type:Fp,name:l,predicate:s?s[l]:void 0}:Fi(l)?{type:Fp,name:l.name,predicate:l}:l}function zw(l){try{return"subscribe"in l&&Fi(l.subscribe)}catch{return!1}}var Aa=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();Kh={},Kh[Aa]=function(){return this},Kh[Symbol.observable]=function(){return this};function vs(l){return!!l&&"__xstatenode"in l}function Pw(l){return!!l&&typeof l.send=="function"}function um(l,s){return zi(l)||typeof l=="number"?ut({type:l},s):l}function en(l,s){if(!zi(l)&&"$$type"in l&&l.$$type==="scxml")return l;var f=um(l);return ut({name:f.type,data:f,$$type:"scxml",type:"external"},s)}function El(l,s){var f=Ov(s).map(function(m){return typeof m=="undefined"||typeof m=="string"||vs(m)?{target:m,event:l}:ut(ut({},m),{event:l})});return f}function Dw(l){if(!(l===void 0||l===Sw))return uo(l)}function Nv(l,s,f,m,x){var T=l.options.guards,k={state:x,cond:s,_event:m};if(s.type===Fp)return((T==null?void 0:T[s.name])||s.predicate)(f,m.data,k);var o=T==null?void 0:T[s.type];if(!o)throw new Error("Guard '".concat(s.type,"' is not implemented on machine '").concat(l.id,"'."));return o(f,m.data,k)}function jv(l){return typeof l=="string"?{type:l}:l}function Vp(l,s,f){if(typeof l=="object")return l;var m=function(){};return{next:l,error:s||m,complete:f||m}}function Yh(l,s){return"".concat(l,":invocation[").concat(s,"]")}var kd=en({type:xw});function Np(l,s){return s&&s[l]||void 0}function vu(l,s){var f;if(zi(l)||typeof l=="number"){var m=Np(l,s);Fi(m)?f={type:l,exec:m}:m?f=m:f={type:l,exec:void 0}}else if(Fi(l))f={type:l.name||l.toString(),exec:l};else{var m=Np(l.type,s);if(Fi(m))f=ut(ut({},l),{exec:m});else if(m){var x=m.type||l.type;f=ut(ut(ut({},m),l),{type:x})}else f=l}return f}var zd=function(l,s){if(!l)return[];var f=Gl(l)?l:[l];return f.map(function(m){return vu(m,s)})};function hm(l){var s=vu(l);return ut(ut({id:zi(l)?l:s.id},s),{type:s.type})}function Lw(l){return zi(l)?{type:Nd,event:l}:Gv(l,{to:yu.Internal})}function Rw(l){return{type:Nd,_event:en(l.event)}}function Gv(l,s){return{to:s?s.to:void 0,type:jd,event:Fi(l)?l:um(l),delay:s?s.delay:void 0,id:s&&s.id!==void 0?s.id:Fi(l)?l.name:Bv(l)}}function Bw(l,s,f,m){var x={_event:f},T=en(Fi(l.event)?l.event(s,f.data,x):l.event),k;if(zi(l.delay)){var o=m&&m[l.delay];k=Fi(o)?o(s,f.data,x):o}else k=Fi(l.delay)?l.delay(s,f.data,x):l.delay;var N=Fi(l.to)?l.to(s,f.data,x):l.to;return ut(ut({},l),{to:N,_event:T,event:T.data,delay:k})}var Ow=function(l,s,f){return ut(ut({},l),{value:zi(l.expr)?l.expr:l.expr(s,f.data,{_event:f})})},Fw=function(l){return{type:Pv,sendId:l}};function Uw(l){var s=hm(l);return{type:Ui.Start,activity:s,exec:void 0}}function Vw(l){var s=Fi(l)?l:hm(l);return{type:Ui.Stop,activity:s,exec:void 0}}function Nw(l,s,f){var m=Fi(l.activity)?l.activity(s,f.data):l.activity,x=typeof m=="string"?{id:m}:m,T={type:Ui.Stop,activity:x};return T}var jw=function(l){return{type:Bp,assignment:l}};function Gw(l,s){var f=s?"#".concat(s):"";return"".concat(Ui.After,"(").concat(l,")").concat(f)}function Jh(l,s){var f="".concat(Ui.DoneState,".").concat(l),m={type:f,data:s};return m.toString=function(){return f},m}function yd(l,s){var f="".concat(Ui.DoneInvoke,".").concat(l),m={type:f,data:s};return m.toString=function(){return f},m}function tu(l,s){var f="".concat(Ui.ErrorPlatform,".").concat(l),m={type:f,data:s};return m.toString=function(){return f},m}function jp(l,s,f,m,x,T){T===void 0&&(T=!1);var k=Pi(T?[[],x]:Fv(x,function(Y){return Y.type===Bp}),2),o=k[0],N=k[1],U=o.length?sy(f,m,o,s):f,V=T?[f]:void 0,F=er(N.map(function(Y){var $;switch(Y.type){case Nd:return Rw(Y);case jd:var ye=Bw(Y,U,m,l.options.delays);return ye;case Dv:return Ow(Y,U,m);case ww:{var be=Y,Ue=($=be.conds.find(function(ot){var st=Vv(ot.cond,l.options.guards);return!st||Nv(l,st,U,m,s)}))===null||$===void 0?void 0:$.actions;if(!Ue)return[];var Ge=Pi(jp(l,s,U,m,zd(uo(Ue),l.options.actions),T),2),S=Ge[0],we=Ge[1];return U=we,V==null||V.push(U),S}case Tw:{var Ue=Y.get(U,m.data);if(!Ue)return[];var Le=Pi(jp(l,s,U,m,zd(uo(Ue),l.options.actions),T),2),Ze=Le[0],xe=Le[1];return U=xe,V==null||V.push(U),Ze}case lm:return Nw(Y,U,m);case Bp:{U=sy(U,m,[Y],s),V==null||V.push(U);break}default:var Se=vu(Y,l.options.actions),Re=Se.exec;if(Re&&V){var Je=V.length-1;Se=ut(ut({},Se),{exec:function(ot){for(var st=[],wt=1;wt<arguments.length;wt++)st[wt-1]=arguments[wt];Re.apply(void 0,fr([V[Je]],Pi(st),!1))}})}return Se}}).filter(function(Y){return!!Y}));return[F,U]}var iu=function(l,s){var f=s(l);return f};function $v(l){var s;return s={id:l,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:l}}},s[Aa]=function(){return this},s}function $w(l,s,f,m){var x,T=jv(l.src),k=(x=s==null?void 0:s.options.services)===null||x===void 0?void 0:x[T.type],o=l.data?Id(l.data,f,m):void 0,N=k?Zw(k,l.id,o):$v(l.id);return N.meta=l,N}function Zw(l,s,f){var m=$v(s);if(m.deferred=!0,vs(l)){var x=m.state=iu(void 0,function(){return(f?l.withContext(f):l).initialState});m.getSnapshot=function(){return x}}return m}function qw(l){try{return typeof l.send=="function"}catch{return!1}}function Ww(l){return qw(l)&&"id"in l}function Hw(l){var s;return ut((s={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},s[Aa]=function(){return this},s),l)}var Pd=function(l){return l.type==="atomic"||l.type==="final"};function Fl(l){return Object.keys(l.states).map(function(s){return l.states[s]})}function Zv(l){var s=[l];return Pd(l)?s:s.concat(er(Fl(l).map(Zv)))}function kl(l,s){var f,m,x,T,k,o,N,U,V=new Set(l),F=Gp(V),Y=new Set(s);try{for(var $=Ti(Y),ye=$.next();!ye.done;ye=$.next())for(var be=ye.value,Ue=be.parent;Ue&&!Y.has(Ue);)Y.add(Ue),Ue=Ue.parent}catch(Je){f={error:Je}}finally{try{ye&&!ye.done&&(m=$.return)&&m.call($)}finally{if(f)throw f.error}}var Ge=Gp(Y);try{for(var S=Ti(Y),we=S.next();!we.done;we=S.next()){var be=we.value;if(be.type==="compound"&&(!Ge.get(be)||!Ge.get(be).length))F.get(be)?F.get(be).forEach(function(ot){return Y.add(ot)}):be.initialStateNodes.forEach(function(ot){return Y.add(ot)});else if(be.type==="parallel")try{for(var Le=(k=void 0,Ti(Fl(be))),Ze=Le.next();!Ze.done;Ze=Le.next()){var xe=Ze.value;xe.type!=="history"&&(Y.has(xe)||(Y.add(xe),F.get(xe)?F.get(xe).forEach(function(ot){return Y.add(ot)}):xe.initialStateNodes.forEach(function(ot){return Y.add(ot)})))}}catch(ot){k={error:ot}}finally{try{Ze&&!Ze.done&&(o=Le.return)&&o.call(Le)}finally{if(k)throw k.error}}}}catch(Je){x={error:Je}}finally{try{we&&!we.done&&(T=S.return)&&T.call(S)}finally{if(x)throw x.error}}try{for(var Se=Ti(Y),Re=Se.next();!Re.done;Re=Se.next())for(var be=Re.value,Ue=be.parent;Ue&&!Y.has(Ue);)Y.add(Ue),Ue=Ue.parent}catch(Je){N={error:Je}}finally{try{Re&&!Re.done&&(U=Se.return)&&U.call(Se)}finally{if(N)throw N.error}}return Y}function qv(l,s){var f=s.get(l);if(!f)return{};if(l.type==="compound"){var m=f[0];if(m){if(Pd(m))return m.key}else return{}}var x={};return f.forEach(function(T){x[T.key]=qv(T,s)}),x}function Gp(l){var s,f,m=new Map;try{for(var x=Ti(l),T=x.next();!T.done;T=x.next()){var k=T.value;m.has(k)||m.set(k,[]),k.parent&&(m.has(k.parent)||m.set(k.parent,[]),m.get(k.parent).push(k))}}catch(o){s={error:o}}finally{try{T&&!T.done&&(f=x.return)&&f.call(x)}finally{if(s)throw s.error}}return m}function Xw(l,s){var f=kl([l],s);return qv(l,Gp(f))}function vd(l,s){return Array.isArray(l)?l.some(function(f){return f===s}):l instanceof Set?l.has(s):!1}function Kw(l){return fr([],Pi(new Set(er(fr([],Pi(l.map(function(s){return s.ownEvents})),!1)))),!1)}function lu(l,s){return s.type==="compound"?Fl(s).some(function(f){return f.type==="final"&&vd(l,f)}):s.type==="parallel"?Fl(s).every(function(f){return lu(l,f)}):!1}function Yw(l){return l===void 0&&(l=[]),l.reduce(function(s,f){return f.meta!==void 0&&(s[f.id]=f.meta),s},{})}function ly(l){return new Set(er(l.map(function(s){return s.tags})))}function Wv(l,s){if(l===s)return!0;if(l===void 0||s===void 0)return!1;if(zi(l)||zi(s))return l===s;var f=Object.keys(l),m=Object.keys(s);return f.length===m.length&&f.every(function(x){return Wv(l[x],s[x])})}function Jw(l){return typeof l!="object"||l===null?!1:"value"in l&&"_event"in l}function Qw(l,s){var f=l.exec,m=ut(ut({},l),{exec:f!==void 0?function(){return f(s.context,s.event,{action:l,state:s,_event:s._event})}:void 0});return m}var ho=function(){function l(s){var f=this,m;this.actions=[],this.activities=ny,this.meta={},this.events=[],this.value=s.value,this.context=s.context,this._event=s._event,this._sessionid=s._sessionid,this.event=this._event.data,this.historyValue=s.historyValue,this.history=s.history,this.actions=s.actions||[],this.activities=s.activities||ny,this.meta=Yw(s.configuration),this.events=s.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=s.configuration,this.transitions=s.transitions,this.children=s.children,this.done=!!s.done,this.tags=(m=Array.isArray(s.tags)?new Set(s.tags):s.tags)!==null&&m!==void 0?m:new Set,this.machine=s.machine,Object.defineProperty(this,"nextEvents",{get:function(){return Kw(f.configuration)}})}return l.from=function(s,f){if(s instanceof l)return s.context!==f?new l({value:s.value,context:f,_event:s._event,_sessionid:null,historyValue:s.historyValue,history:s.history,actions:[],activities:s.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):s;var m=kd;return new l({value:s,context:f,_event:m,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},l.create=function(s){return new l(s)},l.inert=function(s,f){if(s instanceof l){if(!s.actions.length)return s;var m=kd;return new l({value:s.value,context:f,_event:m,_sessionid:null,historyValue:s.historyValue,history:s.history,activities:s.activities,configuration:s.configuration,transitions:[],children:{}})}return l.from(s,f)},l.prototype.toStrings=function(s,f){var m=this;if(s===void 0&&(s=this.value),f===void 0&&(f="."),zi(s))return[s];var x=Object.keys(s);return x.concat.apply(x,fr([],Pi(x.map(function(T){return m.toStrings(s[T],f).map(function(k){return T+f+k})})),!1))},l.prototype.toJSON=function(){var s=this;s.configuration,s.transitions;var f=s.tags;s.machine;var m=sm(s,["configuration","transitions","tags","machine"]);return ut(ut({},m),{tags:Array.from(f)})},l.prototype.matches=function(s){return cm(s,this.value)},l.prototype.hasTag=function(s){return this.tags.has(s)},l.prototype.can=function(s){var f;su(!!this.machine);var m=(f=this.machine)===null||f===void 0?void 0:f.getTransitionData(this,s);return!!(m!=null&&m.transitions.length)&&m.transitions.some(function(x){return x.target!==void 0||x.actions.length})},l}(),e2={deferEvents:!1},cy=function(){function l(s){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=ut(ut({},e2),s)}return l.prototype.initialize=function(s){if(this.initialized=!0,s){if(!this.options.deferEvents){this.schedule(s);return}this.process(s)}this.flushEvents()},l.prototype.schedule=function(s){if(!this.initialized||this.processingEvent){this.queue.push(s);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(s),this.flushEvents()},l.prototype.clear=function(){this.queue=[]},l.prototype.flushEvents=function(){for(var s=this.queue.shift();s;)this.process(s),s=this.queue.shift()},l.prototype.process=function(s){this.processingEvent=!0;try{s()}catch(f){throw this.clear(),f}finally{this.processingEvent=!1}},l}(),yp=new Map,t2=0,Qh={bookId:function(){return"x:".concat(t2++)},register:function(l,s){return yp.set(l,s),l},get:function(l){return yp.get(l)},free:function(l){yp.delete(l)}};function dm(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global}function i2(){var l=dm();if(l&&"__xstate__"in l)return l.__xstate__}function r2(l){if(!!dm()){var s=i2();s&&s.register(l)}}function n2(l,s){s===void 0&&(s={});var f=l.initialState,m=new Set,x=[],T=!1,k=function(){if(!T){for(T=!0;x.length>0;){var U=x.shift();f=l.transition(f,U,N),m.forEach(function(V){return V.next(f)})}T=!1}},o=Hw({id:s.id,send:function(U){x.push(U),k()},getSnapshot:function(){return f},subscribe:function(U,V,F){var Y=Vp(U,V,F);return m.add(Y),Y.next(f),{unsubscribe:function(){m.delete(Y)}}}}),N={parent:s.parent,self:o,id:s.id||"anonymous",observers:m};return f=l.start?l.start(N):f,o}var o2={sync:!1,autoForward:!1},An;(function(l){l[l.NotStarted=0]="NotStarted",l[l.Running=1]="Running",l[l.Stopped=2]="Stopped"})(An||(An={}));var a2=function(){function l(s,f){var m=this;f===void 0&&(f=l.defaultOptions),this.machine=s,this.scheduler=new cy,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=An.NotStarted,this.children=new Map,this.forwardTo=new Set,this.init=this.start,this.send=function(V,F){if(Gl(V))return m.batch(V),m.state;var Y=en(um(V,F));if(m.status===An.Stopped)return m.state;if(m.status!==An.Running&&!m.options.deferEvents)throw new Error('Event "'.concat(Y.name,'" was sent to uninitialized service "').concat(m.machine.id,`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `).concat(JSON.stringify(Y.data)));return m.scheduler.schedule(function(){m.forward(Y);var $=m.nextState(Y);m.update($,Y)}),m._state},this.sendTo=function(V,F){var Y=m.parent&&(F===yu.Parent||m.parent.id===F),$=Y?m.parent:zi(F)?m.children.get(F)||Qh.get(F):Pw(F)?F:void 0;if(!$){if(!Y)throw new Error("Unable to send event to child '".concat(F,"' from service '").concat(m.id,"'."));return}"machine"in $?$.send(ut(ut({},V),{name:V.name===bw?"".concat(tu(m.id)):V.name,origin:m.sessionId})):$.send(V.data)};var x=ut(ut({},l.defaultOptions),f),T=x.clock,k=x.logger,o=x.parent,N=x.id,U=N!==void 0?N:s.id;this.id=U,this.logger=k,this.clock=T,this.parent=o,this.options=x,this.scheduler=new cy({deferEvents:this.options.deferEvents}),this.sessionId=Qh.bookId()}return Object.defineProperty(l.prototype,"initialState",{get:function(){var s=this;return this._initialState?this._initialState:iu(this,function(){return s._initialState=s.machine.initialState,s._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),l.prototype.execute=function(s,f){var m,x;try{for(var T=Ti(s.actions),k=T.next();!k.done;k=T.next()){var o=k.value;this.exec(o,s,f)}}catch(N){m={error:N}}finally{try{k&&!k.done&&(x=T.return)&&x.call(T)}finally{if(m)throw m.error}}},l.prototype.update=function(s,f){var m,x,T,k,o,N,U,V,F=this;if(s._sessionid=this.sessionId,this._state=s,this.options.execute&&this.execute(this.state),this.children.forEach(function(Je){F.state.children[Je.id]=Je}),this.devTools&&this.devTools.send(f.data,s),s.event)try{for(var Y=Ti(this.eventListeners),$=Y.next();!$.done;$=Y.next()){var ye=$.value;ye(s.event)}}catch(Je){m={error:Je}}finally{try{$&&!$.done&&(x=Y.return)&&x.call(Y)}finally{if(m)throw m.error}}try{for(var be=Ti(this.listeners),Ue=be.next();!Ue.done;Ue=be.next()){var ye=Ue.value;ye(s,s.event)}}catch(Je){T={error:Je}}finally{try{Ue&&!Ue.done&&(k=be.return)&&k.call(be)}finally{if(T)throw T.error}}try{for(var Ge=Ti(this.contextListeners),S=Ge.next();!S.done;S=Ge.next()){var we=S.value;we(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(Je){o={error:Je}}finally{try{S&&!S.done&&(N=Ge.return)&&N.call(Ge)}finally{if(o)throw o.error}}var Le=lu(s.configuration||[],this.machine);if(this.state.configuration&&Le){var Ze=s.configuration.find(function(Je){return Je.type==="final"&&Je.parent===F.machine}),xe=Ze&&Ze.doneData?Id(Ze.doneData,s.context,f):void 0;try{for(var Se=Ti(this.doneListeners),Re=Se.next();!Re.done;Re=Se.next()){var ye=Re.value;ye(yd(this.id,xe))}}catch(Je){U={error:Je}}finally{try{Re&&!Re.done&&(V=Se.return)&&V.call(Se)}finally{if(U)throw U.error}}this.stop()}},l.prototype.onTransition=function(s){return this.listeners.add(s),this.status===An.Running&&s(this.state,this.state.event),this},l.prototype.subscribe=function(s,f,m){var x=this;if(!s)return{unsubscribe:function(){}};var T,k=m;return typeof s=="function"?T=s:(T=s.next.bind(s),k=s.complete.bind(s)),this.listeners.add(T),this.status===An.Running&&T(this.state),k&&this.onDone(k),{unsubscribe:function(){T&&x.listeners.delete(T),k&&x.doneListeners.delete(k)}}},l.prototype.onEvent=function(s){return this.eventListeners.add(s),this},l.prototype.onSend=function(s){return this.sendListeners.add(s),this},l.prototype.onChange=function(s){return this.contextListeners.add(s),this},l.prototype.onStop=function(s){return this.stopListeners.add(s),this},l.prototype.onDone=function(s){return this.doneListeners.add(s),this},l.prototype.off=function(s){return this.listeners.delete(s),this.eventListeners.delete(s),this.sendListeners.delete(s),this.stopListeners.delete(s),this.doneListeners.delete(s),this.contextListeners.delete(s),this},l.prototype.start=function(s){var f=this;if(this.status===An.Running)return this;this.machine._init(),Qh.register(this.sessionId,this),this.initialized=!0,this.status=An.Running;var m=s===void 0?this.initialState:iu(this,function(){return Jw(s)?f.machine.resolveState(s):f.machine.resolveState(ho.from(s,f.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){f.update(m,kd)}),this},l.prototype.stop=function(){var s,f,m,x,T,k,o,N,U,V,F=this;try{for(var Y=Ti(this.listeners),$=Y.next();!$.done;$=Y.next()){var ye=$.value;this.listeners.delete(ye)}}catch(Re){s={error:Re}}finally{try{$&&!$.done&&(f=Y.return)&&f.call(Y)}finally{if(s)throw s.error}}try{for(var be=Ti(this.stopListeners),Ue=be.next();!Ue.done;Ue=be.next()){var ye=Ue.value;ye(),this.stopListeners.delete(ye)}}catch(Re){m={error:Re}}finally{try{Ue&&!Ue.done&&(x=be.return)&&x.call(be)}finally{if(m)throw m.error}}try{for(var Ge=Ti(this.contextListeners),S=Ge.next();!S.done;S=Ge.next()){var ye=S.value;this.contextListeners.delete(ye)}}catch(Re){T={error:Re}}finally{try{S&&!S.done&&(k=Ge.return)&&k.call(Ge)}finally{if(T)throw T.error}}try{for(var we=Ti(this.doneListeners),Le=we.next();!Le.done;Le=we.next()){var ye=Le.value;this.doneListeners.delete(ye)}}catch(Re){o={error:Re}}finally{try{Le&&!Le.done&&(N=we.return)&&N.call(we)}finally{if(o)throw o.error}}if(!this.initialized)return this;fr([],Pi(this.state.configuration),!1).sort(function(Re,Je){return Je.order-Re.order}).forEach(function(Re){var Je,ot;try{for(var st=Ti(Re.definition.exit),wt=st.next();!wt.done;wt=st.next()){var ai=wt.value;F.exec(ai,F.state)}}catch(vi){Je={error:vi}}finally{try{wt&&!wt.done&&(ot=st.return)&&ot.call(st)}finally{if(Je)throw Je.error}}}),this.children.forEach(function(Re){Fi(Re.stop)&&Re.stop()});try{for(var Ze=Ti(Object.keys(this.delayedEventsMap)),xe=Ze.next();!xe.done;xe=Ze.next()){var Se=xe.value;this.clock.clearTimeout(this.delayedEventsMap[Se])}}catch(Re){U={error:Re}}finally{try{xe&&!xe.done&&(V=Ze.return)&&V.call(Ze)}finally{if(U)throw U.error}}return this.scheduler.clear(),this.initialized=!1,this.status=An.Stopped,Qh.free(this.sessionId),this},l.prototype.batch=function(s){var f=this;if(!(this.status===An.NotStarted&&this.options.deferEvents)){if(this.status!==An.Running)throw new Error("".concat(s.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'))}this.scheduler.schedule(function(){var m,x,T=f.state,k=!1,o=[],N=function(Y){var $=en(Y);f.forward($),T=iu(f,function(){return f.machine.transition(T,$)}),o.push.apply(o,fr([],Pi(T.actions.map(function(ye){return Qw(ye,T)})),!1)),k=k||!!T.changed};try{for(var U=Ti(s),V=U.next();!V.done;V=U.next()){var F=V.value;N(F)}}catch(Y){m={error:Y}}finally{try{V&&!V.done&&(x=U.return)&&x.call(U)}finally{if(m)throw m.error}}T.changed=k,T.actions=o,f.update(T,en(s[s.length-1]))})},l.prototype.sender=function(s){return this.send.bind(this,s)},l.prototype.nextState=function(s){var f=this,m=en(s);if(m.name.indexOf(ry)===0&&!this.state.nextEvents.some(function(T){return T.indexOf(ry)===0}))throw m.data.data;var x=iu(this,function(){return f.machine.transition(f.state,m)});return x},l.prototype.forward=function(s){var f,m;try{for(var x=Ti(this.forwardTo),T=x.next();!T.done;T=x.next()){var k=T.value,o=this.children.get(k);if(!o)throw new Error("Unable to forward event '".concat(s,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(k,"'."));o.send(s)}}catch(N){f={error:N}}finally{try{T&&!T.done&&(m=x.return)&&m.call(x)}finally{if(f)throw f.error}}},l.prototype.defer=function(s){var f=this;this.delayedEventsMap[s.id]=this.clock.setTimeout(function(){s.to?f.sendTo(s._event,s.to):f.send(s._event)},s.delay)},l.prototype.cancel=function(s){this.clock.clearTimeout(this.delayedEventsMap[s]),delete this.delayedEventsMap[s]},l.prototype.exec=function(s,f,m){m===void 0&&(m=this.machine.options.actions);var x=f.context,T=f._event,k=s.exec||Np(s.type,m),o=Fi(k)?k:k?k.exec:s.exec;if(o)try{return o(x,T.data,{action:s,state:this.state,_event:T})}catch(Le){throw this.parent&&this.parent.send({type:"xstate.error",data:Le}),Le}switch(s.type){case jd:var N=s;if(typeof N.delay=="number"){this.defer(N);return}else N.to?this.sendTo(N._event,N.to):this.send(N._event);break;case Pv:this.cancel(s.sendId);break;case Rp:{if(this.status!==An.Running)return;var U=s.activity;if(!this.state.activities[U.id||U.type])break;if(U.type===Ui.Invoke){var V=jv(U.src),F=this.machine.options.services?this.machine.options.services[V.type]:void 0,Y=U.id,$=U.data,ye="autoForward"in U?U.autoForward:!!U.forward;if(!F)return;var be=$?Id($,x,T):void 0;if(typeof F=="string")return;var Ue=Fi(F)?F(x,T.data,{data:be,src:V,meta:U.meta}):F;if(!Ue)return;var Ge=void 0;vs(Ue)&&(Ue=be?Ue.withContext(be):Ue,Ge={autoForward:ye}),this.spawn(Ue,Y,Ge)}else this.spawnActivity(U);break}case lm:{this.stopChild(s.activity.id);break}case Dv:var S=s.label,we=s.value;S?this.logger(S,we):this.logger(we);break}},l.prototype.removeChild=function(s){var f;this.children.delete(s),this.forwardTo.delete(s),(f=this.state)===null||f===void 0||delete f.children[s]},l.prototype.stopChild=function(s){var f=this.children.get(s);!f||(this.removeChild(s),Fi(f.stop)&&f.stop())},l.prototype.spawn=function(s,f,m){if(ay(s))return this.spawnPromise(Promise.resolve(s),f);if(Fi(s))return this.spawnCallback(s,f);if(Ww(s))return this.spawnActor(s,f);if(zw(s))return this.spawnObservable(s,f);if(vs(s))return this.spawnMachine(s,ut(ut({},m),{id:f}));if(Iw(s))return this.spawnBehavior(s,f);throw new Error('Unable to spawn entity "'.concat(f,'" of type "').concat(typeof s,'".'))},l.prototype.spawnMachine=function(s,f){var m=this;f===void 0&&(f={});var x=new l(s,ut(ut({},this.options),{parent:this,id:f.id||s.id})),T=ut(ut({},o2),f);T.sync&&x.onTransition(function(o){m.send(Lv,{state:o,id:x.id})});var k=x;return this.children.set(x.id,k),T.autoForward&&this.forwardTo.add(x.id),x.onDone(function(o){m.removeChild(x.id),m.send(en(o,{origin:x.id}))}).start(),k},l.prototype.spawnBehavior=function(s,f){var m=n2(s,{id:f,parent:this});return this.children.set(f,m),m},l.prototype.spawnPromise=function(s,f){var m,x=this,T=!1,k;s.then(function(N){T||(k=N,x.removeChild(f),x.send(en(yd(f,N),{origin:f})))},function(N){if(!T){x.removeChild(f);var U=tu(f,N);try{x.send(en(U,{origin:f}))}catch{x.devTools&&x.devTools.send(U,x.state),x.machine.strict&&x.stop()}}});var o=(m={id:f,send:function(){},subscribe:function(N,U,V){var F=Vp(N,U,V),Y=!1;return s.then(function($){Y||(F.next($),!Y&&F.complete())},function($){Y||F.error($)}),{unsubscribe:function(){return Y=!0}}},stop:function(){T=!0},toJSON:function(){return{id:f}},getSnapshot:function(){return k}},m[Aa]=function(){return this},m);return this.children.set(f,o),o},l.prototype.spawnCallback=function(s,f){var m,x=this,T=!1,k=new Set,o=new Set,N,U=function(Y){N=Y,o.forEach(function($){return $(Y)}),!T&&x.send(en(Y,{origin:f}))},V;try{V=s(U,function(Y){k.add(Y)})}catch(Y){this.send(tu(f,Y))}if(ay(V))return this.spawnPromise(V,f);var F=(m={id:f,send:function(Y){return k.forEach(function($){return $(Y)})},subscribe:function(Y){var $=Vp(Y);return o.add($.next),{unsubscribe:function(){o.delete($.next)}}},stop:function(){T=!0,Fi(V)&&V()},toJSON:function(){return{id:f}},getSnapshot:function(){return N}},m[Aa]=function(){return this},m);return this.children.set(f,F),F},l.prototype.spawnObservable=function(s,f){var m,x=this,T,k=s.subscribe(function(N){T=N,x.send(en(N,{origin:f}))},function(N){x.removeChild(f),x.send(en(tu(f,N),{origin:f}))},function(){x.removeChild(f),x.send(en(yd(f),{origin:f}))}),o=(m={id:f,send:function(){},subscribe:function(N,U,V){return s.subscribe(N,U,V)},stop:function(){return k.unsubscribe()},getSnapshot:function(){return T},toJSON:function(){return{id:f}}},m[Aa]=function(){return this},m);return this.children.set(f,o),o},l.prototype.spawnActor=function(s,f){return this.children.set(f,s),s},l.prototype.spawnActivity=function(s){var f=this.machine.options&&this.machine.options.activities?this.machine.options.activities[s.type]:void 0;if(!!f){var m=f(this.state.context,s);this.spawnEffect(s.id,m)}},l.prototype.spawnEffect=function(s,f){var m;this.children.set(s,(m={id:s,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:f||void 0,getSnapshot:function(){},toJSON:function(){return{id:s}}},m[Aa]=function(){return this},m))},l.prototype.attachDev=function(){var s=dm();if(this.options.devTools&&s){if(s.__REDUX_DEVTOOLS_EXTENSION__){var f=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=s.__REDUX_DEVTOOLS_EXTENSION__.connect(ut(ut({name:this.id,autoPause:!0,stateSanitizer:function(m){return{value:m.value,context:m.context,actions:m.actions}}},f),{features:ut({jump:!1,skip:!1},f?f.features:void 0)}),this.machine),this.devTools.init(this.state)}r2(this)}},l.prototype.toJSON=function(){return{id:this.id}},l.prototype[Aa]=function(){return this},l.prototype.getSnapshot=function(){return this.status===An.NotStarted?this.initialState:this._state},l.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(s,f){return setTimeout(s,f)},clearTimeout:function(s){return clearTimeout(s)}},logger:console.log.bind(console),devTools:!1},l.interpret=Hv,l}();function Hv(l,s){var f=new a2(l,s);return f}function s2(l){if(typeof l=="string"){var s={type:l};return s.toString=function(){return l},s}return l}function ed(l){return ut(ut({type:Op},l),{toJSON:function(){l.onDone,l.onError;var s=sm(l,["onDone","onError"]);return ut(ut({},s),{type:Op,src:s2(l.src)})}})}var zl="",$p="#",Wc="*",Al={},Cl=function(l){return l[0]===$p},l2=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},c2=function(l,s,f){var m=f.slice(0,-1).some(function(T){return!("cond"in T)&&!("in"in T)&&(zi(T.target)||vs(T.target))}),x=s===zl?"the transient event":"event '".concat(s,"'");su(!m,"One or more transitions for ".concat(x," on state '").concat(l.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")},u2=function(){function l(s,f,m,x){var T=this;m===void 0&&(m="context"in s?s.context:void 0);var k;this.config=s,this._context=m,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(l2(),f),this.parent=x==null?void 0:x.parent,this.key=this.config.key||(x==null?void 0:x.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:Rv),this.id=this.config.id||fr([this.machine.key],Pi(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(k=this.config.schema)!==null&&k!==void 0?k:{},this.description=this.config.description,this.initial=this.config.initial,this.states=this.config.states?eu(this.config.states,function(U,V){var F,Y=new l(U,{},void 0,{parent:T,key:V});return Object.assign(T.idMap,ut((F={},F[Y.id]=Y,F),Y.idMap)),Y}):Al;var o=0;function N(U){var V,F;U.order=o++;try{for(var Y=Ti(Fl(U)),$=Y.next();!$.done;$=Y.next()){var ye=$.value;N(ye)}}catch(be){V={error:be}}finally{try{$&&!$.done&&(F=Y.return)&&F.call(Y)}finally{if(V)throw V.error}}}N(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(U){var V=U.event;return V===zl}):zl in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=uo(this.config.entry||this.config.onEntry).map(function(U){return vu(U)}),this.onExit=uo(this.config.exit||this.config.onExit).map(function(U){return vu(U)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=uo(this.config.invoke).map(function(U,V){var F,Y;if(vs(U)){var $=Yh(T.id,V);return T.machine.options.services=ut((F={},F[$]=U,F),T.machine.options.services),ed({src:$,id:$})}else if(zi(U.src)){var $=U.id||Yh(T.id,V);return ed(ut(ut({},U),{id:$,src:U.src}))}else if(vs(U.src)||Fi(U.src)){var $=U.id||Yh(T.id,V);return T.machine.options.services=ut((Y={},Y[$]=U.src,Y),T.machine.options.services),ed(ut(ut({id:$},U),{src:$}))}else{var ye=U.src;return ed(ut(ut({id:Yh(T.id,V)},U),{src:ye}))}}),this.activities=uo(this.config.activities).concat(this.invoke).map(function(U){return hm(U)}),this.transition=this.transition.bind(this),this.tags=uo(this.config.tags)}return l.prototype._init=function(){this.__cache.transitions||Zv(this).forEach(function(s){return s.on})},l.prototype.withConfig=function(s,f){var m=this.options,x=m.actions,T=m.activities,k=m.guards,o=m.services,N=m.delays;return new l(this.config,{actions:ut(ut({},x),s.actions),activities:ut(ut({},T),s.activities),guards:ut(ut({},k),s.guards),services:ut(ut({},o),s.services),delays:ut(ut({},N),s.delays)},f!=null?f:this.context)},l.prototype.withContext=function(s){return new l(this.config,this.options,s)},Object.defineProperty(l.prototype,"context",{get:function(){return Fi(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:eu(this.states,function(s){return s.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),l.prototype.toJSON=function(){return this.definition},Object.defineProperty(l.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var s=this.transitions;return this.__cache.on=s.reduce(function(f,m){return f[m.eventType]=f[m.eventType]||[],f[m.eventType].push(m),f},{})},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),l.prototype.getCandidates=function(s){if(this.__cache.candidates[s])return this.__cache.candidates[s];var f=s===zl,m=this.transitions.filter(function(x){var T=x.eventType===s;return f?T:T||x.eventType===Wc});return this.__cache.candidates[s]=m,m},l.prototype.getDelayedTransitions=function(){var s=this,f=this.config.after;if(!f)return[];var m=function(T,k){var o=Fi(T)?"".concat(s.id,":delay[").concat(k,"]"):T,N=Gw(o,s.id);return s.onEntry.push(Gv(N,{delay:T})),s.onExit.push(Fw(N)),N},x=Gl(f)?f.map(function(T,k){var o=m(T.delay,k);return ut(ut({},T),{event:o})}):er(Object.keys(f).map(function(T,k){var o=f[T],N=zi(o)?{target:o}:o,U=isNaN(+T)?T:+T,V=m(U,k);return uo(N).map(function(F){return ut(ut({},F),{event:V,delay:U})})}));return x.map(function(T){var k=T.delay;return ut(ut({},s.formatTransition(T)),{delay:k})})},l.prototype.getStateNodes=function(s){var f,m=this;if(!s)return[];var x=s instanceof ho?s.value:au(s,this.delimiter);if(zi(x)){var T=this.getStateNode(x).initial;return T!==void 0?this.getStateNodes((f={},f[x]=T,f)):[this,this.states[x]]}var k=Object.keys(x),o=[this];return o.push.apply(o,fr([],Pi(er(k.map(function(N){return m.getStateNode(N).getStateNodes(x[N])}))),!1)),o},l.prototype.handles=function(s){var f=Bv(s);return this.events.includes(f)},l.prototype.resolveState=function(s){var f=s instanceof ho?s:ho.create(s),m=Array.from(kl([],this.getStateNodes(f.value)));return new ho(ut(ut({},f),{value:this.resolve(f.value),configuration:m,done:lu(m,this),tags:ly(m),machine:this.machine}))},l.prototype.transitionLeafNode=function(s,f,m){var x=this.getStateNode(s),T=x.next(f,m);return!T||!T.transitions.length?this.next(f,m):T},l.prototype.transitionCompoundNode=function(s,f,m){var x=Object.keys(s),T=this.getStateNode(x[0]),k=T._transition(s[x[0]],f,m);return!k||!k.transitions.length?this.next(f,m):k},l.prototype.transitionParallelNode=function(s,f,m){var x,T,k={};try{for(var o=Ti(Object.keys(s)),N=o.next();!N.done;N=o.next()){var U=N.value,V=s[U];if(!!V){var F=this.getStateNode(U),Y=F._transition(V,f,m);Y&&(k[U]=Y)}}}catch(S){x={error:S}}finally{try{N&&!N.done&&(T=o.return)&&T.call(o)}finally{if(x)throw x.error}}var $=Object.keys(k).map(function(S){return k[S]}),ye=er($.map(function(S){return S.transitions})),be=$.some(function(S){return S.transitions.length>0});if(!be)return this.next(f,m);var Ue=er($.map(function(S){return S.entrySet})),Ge=er(Object.keys(k).map(function(S){return k[S].configuration}));return{transitions:ye,entrySet:Ue,exitSet:er($.map(function(S){return S.exitSet})),configuration:Ge,source:f,actions:er(Object.keys(k).map(function(S){return k[S].actions}))}},l.prototype._transition=function(s,f,m){return zi(s)?this.transitionLeafNode(s,f,m):Object.keys(s).length===1?this.transitionCompoundNode(s,f,m):this.transitionParallelNode(s,f,m)},l.prototype.getTransitionData=function(s,f){return this._transition(s.value,s,en(f))},l.prototype.next=function(s,f){var m,x,T=this,k=f.name,o=[],N=[],U;try{for(var V=Ti(this.getCandidates(k)),F=V.next();!F.done;F=V.next()){var Y=F.value,$=Y.cond,ye=Y.in,be=s.context,Ue=ye?zi(ye)&&Cl(ye)?s.matches(au(this.getStateNodeById(ye).path,this.delimiter)):cm(au(ye,this.delimiter),Aw(this.path.slice(0,-2))(s.value)):!0,Ge=!1;try{Ge=!$||Nv(this.machine,$,be,f,s)}catch(Ze){throw new Error("Unable to evaluate guard '".concat($.name||$.type,"' in transition for event '").concat(k,"' in state node '").concat(this.id,`':
`).concat(Ze.message))}if(Ge&&Ue){Y.target!==void 0&&(N=Y.target),o.push.apply(o,fr([],Pi(Y.actions),!1)),U=Y;break}}}catch(Ze){m={error:Ze}}finally{try{F&&!F.done&&(x=V.return)&&x.call(V)}finally{if(m)throw m.error}}if(!!U){if(!N.length)return{transitions:[U],entrySet:[],exitSet:[],configuration:s.value?[this]:[],source:s,actions:o};var S=er(N.map(function(Ze){return T.getRelativeStateNodes(Ze,s.historyValue)})),we=!!U.internal,Le=we?[]:er(S.map(function(Ze){return T.nodesFromChild(Ze)}));return{transitions:[U],entrySet:Le,exitSet:we?[]:[this],configuration:S,source:s,actions:o}}},l.prototype.nodesFromChild=function(s){if(s.escapes(this))return[];for(var f=[],m=s;m&&m!==this;)f.push(m),m=m.parent;return f.push(this),f},l.prototype.escapes=function(s){if(this===s)return!1;for(var f=this.parent;f;){if(f===s)return!1;f=f.parent}return!0},l.prototype.getActions=function(s,f,m,x){var T,k,o,N,U=kl([],x?this.getStateNodes(x.value):[this]),V=s.configuration.length?kl(U,s.configuration):U;try{for(var F=Ti(V),Y=F.next();!Y.done;Y=F.next()){var $=Y.value;vd(U,$)||s.entrySet.push($)}}catch(Se){T={error:Se}}finally{try{Y&&!Y.done&&(k=F.return)&&k.call(F)}finally{if(T)throw T.error}}try{for(var ye=Ti(U),be=ye.next();!be.done;be=ye.next()){var $=be.value;(!vd(V,$)||vd(s.exitSet,$.parent))&&s.exitSet.push($)}}catch(Se){o={error:Se}}finally{try{be&&!be.done&&(N=ye.return)&&N.call(ye)}finally{if(o)throw o.error}}var Ue=er(s.entrySet.map(function(Se){var Re=[];if(Se.type!=="final")return Re;var Je=Se.parent;if(!Je.parent)return Re;Re.push(Jh(Se.id,Se.doneData),Jh(Je.id,Se.doneData?Id(Se.doneData,f,m):void 0));var ot=Je.parent;return ot.type==="parallel"&&Fl(ot).every(function(st){return lu(s.configuration,st)})&&Re.push(Jh(ot.id)),Re}));s.exitSet.sort(function(Se,Re){return Re.order-Se.order}),s.entrySet.sort(function(Se,Re){return Se.order-Re.order});var Ge=new Set(s.entrySet),S=new Set(s.exitSet),we=Pi([er(Array.from(Ge).map(function(Se){return fr(fr([],Pi(Se.activities.map(function(Re){return Uw(Re)})),!1),Pi(Se.onEntry),!1)})).concat(Ue.map(Lw)),er(Array.from(S).map(function(Se){return fr(fr([],Pi(Se.onExit),!1),Pi(Se.activities.map(function(Re){return Vw(Re)})),!1)}))],2),Le=we[0],Ze=we[1],xe=zd(Ze.concat(s.actions).concat(Le),this.machine.options.actions);return xe},l.prototype.transition=function(s,f,m){s===void 0&&(s=this.initialState);var x=en(f),T;if(s instanceof ho)T=m===void 0?s:this.resolveState(ho.from(s,m));else{var k=zi(s)?this.resolve(Md(this.getResolvedPath(s))):this.resolve(s),o=m!=null?m:this.machine.context;T=this.resolveState(ho.from(k,o))}if(!qc&&x.name===Wc)throw new Error("An event cannot have the wildcard type ('".concat(Wc,"')"));if(this.strict&&!this.events.includes(x.name)&&!Mw(x.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(x.name,"'"));var N=this._transition(T.value,T,x)||{transitions:[],configuration:[],entrySet:[],exitSet:[],source:T,actions:[]},U=kl([],this.getStateNodes(T.value)),V=N.configuration.length?kl(U,N.configuration):U;return N.configuration=fr([],Pi(V),!1),this.resolveTransition(N,T,T.context,x)},l.prototype.resolveRaisedTransition=function(s,f,m){var x,T=s.actions;return s=this.transition(s,f),s._event=m,s.event=m.data,(x=s.actions).unshift.apply(x,fr([],Pi(T),!1)),s},l.prototype.resolveTransition=function(s,f,m,x){var T,k,o=this;x===void 0&&(x=kd);var N=s.configuration,U=!f||s.transitions.length>0,V=U?Xw(this.machine,N):void 0,F=f?f.historyValue?f.historyValue:s.source?this.machine.historyValue(f.value):void 0:void 0,Y=this.getActions(s,m,x,f),$=f?ut({},f.activities):{};try{for(var ye=Ti(Y),be=ye.next();!be.done;be=ye.next()){var Ue=be.value;Ue.type===Rp?$[Ue.activity.id||Ue.activity.type]=Ue:Ue.type===lm&&($[Ue.activity.id||Ue.activity.type]=!1)}}catch(kt){T={error:kt}}finally{try{be&&!be.done&&(k=ye.return)&&k.call(ye)}finally{if(T)throw T.error}}var Ge=Pi(jp(this,f,m,x,Y,this.machine.config.preserveActionOrder),2),S=Ge[0],we=Ge[1],Le=Pi(Fv(S,function(kt){return kt.type===Nd||kt.type===jd&&kt.to===yu.Internal}),2),Ze=Le[0],xe=Le[1],Se=S.filter(function(kt){var ui;return kt.type===Rp&&((ui=kt.activity)===null||ui===void 0?void 0:ui.type)===Op}),Re=Se.reduce(function(kt,ui){return kt[ui.activity.id]=$w(ui.activity,o.machine,we,x),kt},f?ut({},f.children):{}),Je=U?s.configuration:f?f.configuration:[],ot=lu(Je,this),st=new ho({value:V||f.value,context:we,_event:x,_sessionid:f?f._sessionid:null,historyValue:V?F?kw(F,V):void 0:f?f.historyValue:void 0,history:!V||s.source?f:void 0,actions:V?xe:[],activities:V?$:f?f.activities:{},events:[],configuration:Je,transitions:s.transitions,children:Re,done:ot,tags:f==null?void 0:f.tags,machine:this}),wt=m!==we;st.changed=x.name===Lv||wt;var ai=st.history;ai&&delete ai.history;var vi=!ot&&(this._transient||N.some(function(kt){return kt._transient}));if(!U&&(!vi||x.name===zl))return st;var Ft=st;if(!ot)for(vi&&(Ft=this.resolveRaisedTransition(Ft,{type:vw},x));Ze.length;){var Vi=Ze.shift();Ft=this.resolveRaisedTransition(Ft,Vi._event,x)}var Dt=Ft.changed||(ai?!!Ft.actions.length||wt||typeof ai.value!=typeof Ft.value||!Wv(Ft.value,ai.value):void 0);return Ft.changed=Dt,Ft.history=ai,Ft.tags=ly(Ft.configuration),Ft},l.prototype.getStateNode=function(s){if(Cl(s))return this.machine.getStateNodeById(s);if(!this.states)throw new Error("Unable to retrieve child state '".concat(s,"' from '").concat(this.id,"'; no child states exist."));var f=this.states[s];if(!f)throw new Error("Child state '".concat(s,"' does not exist on '").concat(this.id,"'"));return f},l.prototype.getStateNodeById=function(s){var f=Cl(s)?s.slice($p.length):s;if(f===this.id)return this;var m=this.machine.idMap[f];if(!m)throw new Error("Child state node '#".concat(f,"' does not exist on machine '").concat(this.id,"'"));return m},l.prototype.getStateNodeByPath=function(s){if(typeof s=="string"&&Cl(s))try{return this.getStateNodeById(s.slice(1))}catch{}for(var f=Up(s,this.delimiter).slice(),m=this;f.length;){var x=f.shift();if(!x.length)break;m=m.getStateNode(x)}return m},l.prototype.resolve=function(s){var f,m=this;if(!s)return this.initialStateValue||Al;switch(this.type){case"parallel":return eu(this.initialStateValue,function(T,k){return T?m.getStateNode(k).resolve(s[k]||T):Al});case"compound":if(zi(s)){var x=this.getStateNode(s);return x.type==="parallel"||x.type==="compound"?(f={},f[s]=x.initialStateValue,f):s}return Object.keys(s).length?eu(s,function(T,k){return T?m.getStateNode(k).resolve(T):Al}):this.initialStateValue||{};default:return s||Al}},l.prototype.getResolvedPath=function(s){if(Cl(s)){var f=this.machine.idMap[s.slice($p.length)];if(!f)throw new Error("Unable to find state node '".concat(s,"'"));return f.path}return Up(s,this.delimiter)},Object.defineProperty(l.prototype,"initialStateValue",{get:function(){var s;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var f;if(this.type==="parallel")f=oy(this.states,function(m){return m.initialStateValue||Al},function(m){return m.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));f=Pd(this.states[this.initial])?this.initial:(s={},s[this.initial]=this.states[this.initial].initialStateValue,s)}else f={};return this.__cache.initialStateValue=f,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),l.prototype.getInitialState=function(s,f){this._init();var m=this.getStateNodes(s);return this.resolveTransition({configuration:m,entrySet:m,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,f!=null?f:this.machine.context,void 0)},Object.defineProperty(l.prototype,"initialState",{get:function(){var s=this.initialStateValue;if(!s)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(s)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"target",{get:function(){var s;if(this.type==="history"){var f=this.config;zi(f.target)?s=Cl(f.target)?Md(this.machine.getStateNodeById(f.target).path.slice(this.path.length-1)):f.target:s=f.target}return s},enumerable:!1,configurable:!0}),l.prototype.getRelativeStateNodes=function(s,f,m){return m===void 0&&(m=!0),m?s.type==="history"?s.resolveHistory(f):s.initialStateNodes:[s]},Object.defineProperty(l.prototype,"initialStateNodes",{get:function(){var s=this;if(Pd(this))return[this];if(this.type==="compound"&&!this.initial)return qc||su(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this];var f=gd(this.initialStateValue);return er(f.map(function(m){return s.getFromRelativePath(m)}))},enumerable:!1,configurable:!0}),l.prototype.getFromRelativePath=function(s){if(!s.length)return[this];var f=Pi(s),m=f[0],x=f.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(m,"' from node with no states"));var T=this.getStateNode(m);if(T.type==="history")return T.resolveHistory();if(!this.states[m])throw new Error("Child state '".concat(m,"' does not exist on '").concat(this.id,"'"));return this.states[m].getFromRelativePath(x)},l.prototype.historyValue=function(s){if(!!Object.keys(this.states).length)return{current:s||this.initialStateValue,states:oy(this.states,function(f,m){if(!s)return f.historyValue();var x=zi(s)?void 0:s[m];return f.historyValue(x||f.initialStateValue)},function(f){return!f.history})}},l.prototype.resolveHistory=function(s){var f=this;if(this.type!=="history")return[this];var m=this.parent;if(!s){var x=this.target;return x?er(gd(x).map(function(k){return m.getFromRelativePath(k)})):m.initialStateNodes}var T=Cw(m.path,"states")(s).current;return zi(T)?[m.getStateNode(T)]:er(gd(T).map(function(k){return f.history==="deep"?m.getFromRelativePath(k):[m.states[k[0]]]}))},Object.defineProperty(l.prototype,"stateIds",{get:function(){var s=this,f=er(Object.keys(this.states).map(function(m){return s.states[m].stateIds}));return[this.id].concat(f)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"events",{get:function(){var s,f,m,x;if(this.__cache.events)return this.__cache.events;var T=this.states,k=new Set(this.ownEvents);if(T)try{for(var o=Ti(Object.keys(T)),N=o.next();!N.done;N=o.next()){var U=N.value,V=T[U];if(V.states)try{for(var F=(m=void 0,Ti(V.events)),Y=F.next();!Y.done;Y=F.next()){var $=Y.value;k.add("".concat($))}}catch(ye){m={error:ye}}finally{try{Y&&!Y.done&&(x=F.return)&&x.call(F)}finally{if(m)throw m.error}}}}catch(ye){s={error:ye}}finally{try{N&&!N.done&&(f=o.return)&&f.call(o)}finally{if(s)throw s.error}}return this.__cache.events=Array.from(k)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"ownEvents",{get:function(){var s=new Set(this.transitions.filter(function(f){return!(!f.target&&!f.actions.length&&f.internal)}).map(function(f){return f.eventType}));return Array.from(s)},enumerable:!1,configurable:!0}),l.prototype.resolveTarget=function(s){var f=this;if(s!==void 0)return s.map(function(m){if(!zi(m))return m;var x=m[0]===f.delimiter;if(x&&!f.parent)return f.getStateNodeByPath(m.slice(1));var T=x?f.key+m:m;if(f.parent)try{var k=f.parent.getStateNodeByPath(T);return k}catch(o){throw new Error("Invalid transition definition for state node '".concat(f.id,`':
`).concat(o.message))}else return f.getStateNodeByPath(T)})},l.prototype.formatTransition=function(s){var f=this,m=Dw(s.target),x="internal"in s?s.internal:m?m.some(function(N){return zi(N)&&N[0]===f.delimiter}):!0,T=this.machine.options.guards,k=this.resolveTarget(m),o=ut(ut({},s),{actions:zd(uo(s.actions)),cond:Vv(s.cond,T),target:k,source:this,internal:x,eventType:s.event,toJSON:function(){return ut(ut({},o),{target:o.target?o.target.map(function(N){return"#".concat(N.id)}):void 0,source:"#".concat(f.id)})}});return o},l.prototype.formatTransitions=function(){var s,f,m=this,x;if(!this.config.on)x=[];else if(Array.isArray(this.config.on))x=this.config.on;else{var T=this.config.on,k=Wc,o=T[k],N=o===void 0?[]:o,U=sm(T,[typeof k=="symbol"?k:k+""]);x=er(Object.keys(U).map(function(S){!qc&&S===zl&&su(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(m.id,'".'));var we=El(S,U[S]);return qc||c2(m,S,we),we}).concat(El(Wc,N)))}var V=this.config.always?El("",this.config.always):[],F=this.config.onDone?El(String(Jh(this.id)),this.config.onDone):[];qc||su(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var Y=er(this.invoke.map(function(S){var we=[];return S.onDone&&we.push.apply(we,fr([],Pi(El(String(yd(S.id)),S.onDone)),!1)),S.onError&&we.push.apply(we,fr([],Pi(El(String(tu(S.id)),S.onError)),!1)),we})),$=this.after,ye=er(fr(fr(fr(fr([],Pi(F),!1),Pi(Y),!1),Pi(x),!1),Pi(V),!1).map(function(S){return uo(S).map(function(we){return m.formatTransition(we)})}));try{for(var be=Ti($),Ue=be.next();!Ue.done;Ue=be.next()){var Ge=Ue.value;ye.push(Ge)}}catch(S){s={error:S}}finally{try{Ue&&!Ue.done&&(f=be.return)&&f.call(be)}finally{if(s)throw s.error}}return ye},l}();function h2(l,s,f){return f===void 0&&(f=l.context),new u2(l,s,f)}var d2=jw,Zp;(function(l){l[l.Effect=1]="Effect",l[l.LayoutEffect=2]="LayoutEffect"})(Zp||(Zp={}));var cu=xs;function uy(l){var s=vt();return s.current||(s.current={v:l()}),s.current.v}var f2=globalThis&&globalThis.__read||function(l,s){var f=typeof Symbol=="function"&&l[Symbol.iterator];if(!f)return l;var m=f.call(l),x,T=[],k;try{for(;(s===void 0||s-- >0)&&!(x=m.next()).done;)T.push(x.value)}catch(o){k={error:o}}finally{try{x&&!x.done&&(f=m.return)&&f.call(m)}finally{if(k)throw k.error}}return T},p2=globalThis&&globalThis.__values||function(l){var s=typeof Symbol=="function"&&Symbol.iterator,f=s&&l[s],m=0;if(f)return f.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&m>=l.length&&(l=void 0),{value:l&&l[m++],done:!l}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};function m2(l,s){var f,m,x=f2([[],[]],2),T=x[0],k=x[1];try{for(var o=p2(l),N=o.next();!N.done;N=o.next()){var U=N.value;s(U)?T.push(U):k.push(U)}}catch(V){f={error:V}}finally{try{N&&!N.done&&(m=o.return)&&m.call(o)}finally{if(f)throw f.error}}return[T,k]}var Hc=globalThis&&globalThis.__read||function(l,s){var f=typeof Symbol=="function"&&l[Symbol.iterator];if(!f)return l;var m=f.call(l),x,T=[],k;try{for(;(s===void 0||s-- >0)&&!(x=m.next()).done;)T.push(x.value)}catch(o){k={error:o}}finally{try{x&&!x.done&&(f=m.return)&&f.call(m)}finally{if(k)throw k.error}}return T},hy=globalThis&&globalThis.__spreadArray||function(l,s,f){if(f||arguments.length===2)for(var m=0,x=s.length,T;m<x;m++)(T||!(m in s))&&(T||(T=Array.prototype.slice.call(s,0,m)),T[m]=s[m]);return l.concat(T||Array.prototype.slice.call(s))};function dy(l,s){var f=l.exec,m=f(s.context,s._event.data,{action:l,state:s,_event:s._event});m()}function _2(l){var s=vt([]),f=vt([]);cu(function(){var m=l.subscribe(function(x){var T,k;if(x.actions.length){var o=x.actions.filter(function(F){return typeof F.exec=="function"&&"__effect"in F.exec}),N=Hc(m2(o,function(F){return F.exec.__effect===Zp.Effect}),2),U=N[0],V=N[1];(T=s.current).push.apply(T,hy([],Hc(U.map(function(F){return[F,x]})),!1)),(k=f.current).push.apply(k,hy([],Hc(V.map(function(F){return[F,x]})),!1))}});return function(){m.unsubscribe()}},[]),cu(function(){for(;f.current.length;){var m=Hc(f.current.shift(),2),x=m[0],T=m[1];dy(x,T)}}),Jt(function(){for(;s.current.length;){var m=Hc(s.current.shift(),2),x=m[0],T=m[1];dy(x,T)}})}var uu=globalThis&&globalThis.__assign||function(){return uu=Object.assign||function(l){for(var s,f=1,m=arguments.length;f<m;f++){s=arguments[f];for(var x in s)Object.prototype.hasOwnProperty.call(s,x)&&(l[x]=s[x])}return l},uu.apply(this,arguments)},g2=globalThis&&globalThis.__rest||function(l,s){var f={};for(var m in l)Object.prototype.hasOwnProperty.call(l,m)&&s.indexOf(m)<0&&(f[m]=l[m]);if(l!=null&&typeof Object.getOwnPropertySymbols=="function")for(var x=0,m=Object.getOwnPropertySymbols(l);x<m.length;x++)s.indexOf(m[x])<0&&Object.prototype.propertyIsEnumerable.call(l,m[x])&&(f[m[x]]=l[m[x]]);return f};globalThis&&globalThis.__read;function y2(l,s,f){if(typeof l=="object")return l;var m=function(){};return{next:l,error:s||m,complete:f||m}}function v2(l,s,f){s===void 0&&(s={});var m=uy(function(){return typeof l=="function"?l():l}),x=s.context,T=s.guards,k=s.actions,o=s.activities,N=s.services,U=s.delays,V=s.state,F=g2(s,["context","guards","actions","activities","services","delays","state"]),Y=uy(function(){var $={context:x,guards:T,actions:k,activities:o,services:N,delays:U},ye=m.withConfig($,function(){return uu(uu({},m.context),x)});return Hv(ye,uu({deferEvents:!0},F))});return cu(function(){var $;return f&&($=Y.subscribe(y2(f))),function(){$==null||$.unsubscribe()}},[f]),cu(function(){return Y.start(V?ho.create(V):void 0),function(){Y.stop()}},[]),cu(function(){Object.assign(Y.machine.options.actions,k),Object.assign(Y.machine.options.guards,T),Object.assign(Y.machine.options.activities,o),Object.assign(Y.machine.options.services,N),Object.assign(Y.machine.options.delays,U)},[k,T,o,N,U]),_2(Y),Y}var x2=globalThis&&globalThis.__read||function(l,s){var f=typeof Symbol=="function"&&l[Symbol.iterator];if(!f)return l;var m=f.call(l),x,T=[],k;try{for(;(s===void 0||s-- >0)&&!(x=m.next()).done;)T.push(x.value)}catch(o){k={error:o}}finally{try{x&&!x.done&&(f=m.return)&&f.call(m)}finally{if(k)throw k.error}}return T};globalThis&&globalThis.__spreadArray;function b2(l,s){s===void 0&&(s={});var f=Yt(function(o){var N=o.changed===void 0&&Object.keys(o.children).length;(o.changed||N)&&k(o)},[]),m=v2(l,s,f),x=x2(Ri(function(){var o=m.machine.initialState;return s.state?ho.create(s.state):o}),2),T=x[0],k=x[1];return[T,m.send,m]}function pr(){return pr=Object.assign||function(l){for(var s=1;s<arguments.length;s++){var f=arguments[s];for(var m in f)Object.prototype.hasOwnProperty.call(f,m)&&(l[m]=f[m])}return l},pr.apply(this,arguments)}function Dl(l,s){if(l==null)return{};var f={},m=Object.keys(l),x,T;for(T=0;T<m.length;T++)x=m[T],!(s.indexOf(x)>=0)&&(f[x]=l[x]);return f}const oi={arr:Array.isArray,obj:l=>Object.prototype.toString.call(l)==="[object Object]",fun:l=>typeof l=="function",str:l=>typeof l=="string",num:l=>typeof l=="number",und:l=>l===void 0,nul:l=>l===null,set:l=>l instanceof Set,map:l=>l instanceof Map,equ(l,s){if(typeof l!=typeof s)return!1;if(oi.str(l)||oi.num(l))return l===s;if(oi.obj(l)&&oi.obj(s)&&Object.keys(l).length+Object.keys(s).length===0)return!0;let f;for(f in l)if(!(f in s))return!1;for(f in s)if(l[f]!==s[f])return!1;return oi.und(f)?l===s:!0}};function w2(l,s){return s===void 0&&(s=!0),f=>(oi.arr(f)?f:Object.keys(f)).reduce((m,x)=>{const T=s?x[0].toLowerCase()+x.substring(1):x;return m[T]=l(T),m},l)}function T2(){const l=Ri(!1),s=l[1];return Yt(()=>s(m=>!m),[])}function fs(l,s){return oi.und(l)||oi.nul(l)?s:l}function td(l){return oi.und(l)?[]:oi.arr(l)?l:[l]}function Pl(l){for(var s=arguments.length,f=new Array(s>1?s-1:0),m=1;m<s;m++)f[m-1]=arguments[m];return oi.fun(l)?l(...f):l}function S2(l){return l.to,l.from,l.config,l.onStart,l.onRest,l.onFrame,l.children,l.reset,l.reverse,l.force,l.immediate,l.delay,l.attach,l.destroyed,l.interpolateTo,l.ref,l.lazy,Dl(l,["to","from","config","onStart","onRest","onFrame","children","reset","reverse","force","immediate","delay","attach","destroyed","interpolateTo","ref","lazy"])}function vp(l){const s=S2(l);if(oi.und(s))return pr({to:s},l);const f=Object.keys(l).reduce((m,x)=>oi.und(s[x])?pr({},m,{[x]:l[x]}):m,{});return pr({to:s},f)}function E2(l,s){return s&&(oi.fun(s)?s(l):oi.obj(s)&&(s.current=l)),l}class fo{constructor(){this.payload=void 0,this.children=[]}getAnimatedValue(){return this.getValue()}getPayload(){return this.payload||this}attach(){}detach(){}getChildren(){return this.children}addChild(s){this.children.length===0&&this.attach(),this.children.push(s)}removeChild(s){const f=this.children.indexOf(s);this.children.splice(f,1),this.children.length===0&&this.detach()}}class qp extends fo{constructor(){super(...arguments);this.payload=[],this.attach=()=>this.payload.forEach(s=>s instanceof fo&&s.addChild(this)),this.detach=()=>this.payload.forEach(s=>s instanceof fo&&s.removeChild(this))}}class Xv extends fo{constructor(){super(...arguments);this.payload={},this.attach=()=>Object.values(this.payload).forEach(s=>s instanceof fo&&s.addChild(this)),this.detach=()=>Object.values(this.payload).forEach(s=>s instanceof fo&&s.removeChild(this))}getValue(s){s===void 0&&(s=!1);const f={};for(const m in this.payload){const x=this.payload[m];s&&!(x instanceof fo)||(f[m]=x instanceof fo?x[s?"getAnimatedValue":"getValue"]():x)}return f}getAnimatedValue(){return this.getValue(!0)}}let fm;function A2(l,s){fm={fn:l,transform:s}}let Kv;function C2(l){Kv=l}let Yv=l=>typeof window!="undefined"?window.requestAnimationFrame(l):-1,Dd;function M2(l){Dd=l}let Jv=()=>Date.now(),I2=l=>l.current,Qv;function k2(l){Qv=l}class z2 extends Xv{constructor(s,f){super();this.update=void 0,this.payload=s.style?pr({},s,{style:Qv(s.style)}):s,this.update=f,this.attach()}}const P2=l=>oi.fun(l)&&!(l.prototype instanceof Cn.Component),D2=l=>Su((f,m)=>{const x=T2(),T=vt(!0),k=vt(null),o=vt(null),N=Yt(Y=>{const $=k.current,ye=()=>{let be=!1;o.current&&(be=fm.fn(o.current,k.current.getAnimatedValue())),(!o.current||be===!1)&&x()};k.current=new z2(Y,ye),$&&$.detach()},[]);Jt(()=>()=>{T.current=!1,k.current&&k.current.detach()},[]),Nl(m,()=>I2(o)),N(f);const U=k.current.getValue();U.scrollTop,U.scrollLeft;const V=Dl(U,["scrollTop","scrollLeft"]),F=P2(l)?void 0:Y=>o.current=E2(Y,m);return Cn.createElement(l,pr({},V,{ref:F}))});let hu=!1;const ms=new Set,e0=()=>{if(!hu)return!1;let l=Jv();for(let s of ms){let f=!1;for(let m=0;m<s.configs.length;m++){let x=s.configs[m],T,k;for(let o=0;o<x.animatedValues.length;o++){let N=x.animatedValues[o];if(N.done)continue;let U=x.fromValues[o],V=x.toValues[o],F=N.lastPosition,Y=V instanceof fo,$=Array.isArray(x.initialVelocity)?x.initialVelocity[o]:x.initialVelocity;if(Y&&(V=V.getValue()),x.immediate){N.setValue(V),N.done=!0;continue}if(typeof U=="string"||typeof V=="string"){N.setValue(V),N.done=!0;continue}if(x.duration!==void 0)F=U+x.easing((l-N.startTime)/x.duration)*(V-U),T=l>=N.startTime+x.duration;else if(x.decay)F=U+$/(1-.998)*(1-Math.exp(-(1-.998)*(l-N.startTime))),T=Math.abs(N.lastPosition-F)<.1,T&&(V=F);else{k=N.lastTime!==void 0?N.lastTime:l,$=N.lastVelocity!==void 0?N.lastVelocity:x.initialVelocity,l>k+64&&(k=l);let ye=Math.floor(l-k);for(let S=0;S<ye;++S){let we=-x.tension*(F-V),Le=-x.friction*$,Ze=(we+Le)/x.mass;$=$+Ze*1/1e3,F=F+$*1/1e3}let be=x.clamp&&x.tension!==0?U<V?F>V:F<V:!1,Ue=Math.abs($)<=x.precision,Ge=x.tension!==0?Math.abs(V-F)<=x.precision:!0;T=be||Ue&&Ge,N.lastVelocity=$,N.lastTime=l}Y&&!x.toValues[o].done&&(T=!1),T?(N.value!==V&&(F=V),N.done=!0):f=!0,N.setValue(F),N.lastPosition=F}s.props.onFrame&&(s.values[x.name]=x.interpolation.getValue())}s.props.onFrame&&s.props.onFrame(s.values),f||(ms.delete(s),s.stop(!0))}return ms.size?Yv(e0):hu=!1,hu},L2=l=>{ms.has(l)||ms.add(l),hu||(hu=!0,Yv(e0))},R2=l=>{ms.has(l)&&ms.delete(l)};function Ld(l,s,f){if(typeof l=="function")return l;if(Array.isArray(l))return Ld({range:l,output:s,extrapolate:f});if(Dd&&typeof l.output[0]=="string")return Dd(l);const m=l,x=m.output,T=m.range||[0,1],k=m.extrapolateLeft||m.extrapolate||"extend",o=m.extrapolateRight||m.extrapolate||"extend",N=m.easing||(U=>U);return U=>{const V=O2(U,T);return B2(U,T[V],T[V+1],x[V],x[V+1],N,k,o,m.map)}}function B2(l,s,f,m,x,T,k,o,N){let U=N?N(l):l;if(U<s){if(k==="identity")return U;k==="clamp"&&(U=s)}if(U>f){if(o==="identity")return U;o==="clamp"&&(U=f)}return m===x?m:s===f?l<=s?m:x:(s===-1/0?U=-U:f===1/0?U=U-s:U=(U-s)/(f-s),U=T(U),m===-1/0?U=-U:x===1/0?U=U+m:U=U*(x-m)+m,U)}function O2(l,s){for(var f=1;f<s.length-1&&!(s[f]>=l);++f);return f-1}class Ul extends qp{constructor(s,f,m,x){super();this.calc=void 0,this.payload=s instanceof qp&&!(s instanceof Ul)?s.getPayload():Array.isArray(s)?s:[s],this.calc=Ld(f,m,x)}getValue(){return this.calc(...this.payload.map(s=>s.getValue()))}updateConfig(s,f,m){this.calc=Ld(s,f,m)}interpolate(s,f,m){return new Ul(this,s,f,m)}}const Ml=(l,s,f)=>l&&new Ul(l,s,f),F2={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}};function t0(l,s){"update"in l?s.add(l):l.getChildren().forEach(f=>t0(f,s))}class Wp extends fo{constructor(s){var f;super();f=this,this.animatedStyles=new Set,this.value=void 0,this.startPosition=void 0,this.lastPosition=void 0,this.lastVelocity=void 0,this.startTime=void 0,this.lastTime=void 0,this.done=!1,this.setValue=function(m,x){x===void 0&&(x=!0),f.value=m,x&&f.flush()},this.value=s,this.startPosition=s,this.lastPosition=s}flush(){this.animatedStyles.size===0&&t0(this,this.animatedStyles),this.animatedStyles.forEach(s=>s.update())}clearStyles(){this.animatedStyles.clear()}getValue(){return this.value}interpolate(s,f,m){return new Ul(this,s,f,m)}}class U2 extends qp{constructor(s){super();this.payload=s.map(f=>new Wp(f))}setValue(s,f){f===void 0&&(f=!0),Array.isArray(s)?s.length===this.payload.length&&s.forEach((m,x)=>this.payload[x].setValue(m,f)):this.payload.forEach(m=>m.setValue(s,f))}getValue(){return this.payload.map(s=>s.getValue())}interpolate(s,f){return new Ul(this,s,f)}}let V2=0;class N2{constructor(){this.id=void 0,this.idle=!0,this.hasChanged=!1,this.guid=0,this.local=0,this.props={},this.merged={},this.animations={},this.interpolations={},this.values={},this.configs=[],this.listeners=[],this.queue=[],this.localQueue=void 0,this.getValues=()=>this.interpolations,this.id=V2++}update(s){if(!s)return this;const f=vp(s),m=f.delay,x=m===void 0?0:m,T=f.to,k=Dl(f,["delay","to"]);if(oi.arr(T)||oi.fun(T))this.queue.push(pr({},k,{delay:x,to:T}));else if(T){let o={};Object.entries(T).forEach(N=>{let U=N[0],V=N[1];const F=pr({to:{[U]:V},delay:Pl(x,U)},k),Y=o[F.delay]&&o[F.delay].to;o[F.delay]=pr({},o[F.delay],F,{to:pr({},Y,F.to)})}),this.queue=Object.values(o)}return this.queue=this.queue.sort((o,N)=>o.delay-N.delay),this.diff(k),this}start(s){if(this.queue.length){this.idle=!1,this.localQueue&&this.localQueue.forEach(x=>{let T=x.from,k=T===void 0?{}:T,o=x.to,N=o===void 0?{}:o;oi.obj(k)&&(this.merged=pr({},k,this.merged)),oi.obj(N)&&(this.merged=pr({},this.merged,N))});const f=this.local=++this.guid,m=this.localQueue=this.queue;this.queue=[],m.forEach((x,T)=>{let k=x.delay,o=Dl(x,["delay"]);const N=V=>{T===m.length-1&&f===this.guid&&V&&(this.idle=!0,this.props.onRest&&this.props.onRest(this.merged)),s&&s()};let U=oi.arr(o.to)||oi.fun(o.to);k?setTimeout(()=>{f===this.guid&&(U?this.runAsync(o,N):this.diff(o).start(N))},k):U?this.runAsync(o,N):this.diff(o).start(N)})}else oi.fun(s)&&this.listeners.push(s),this.props.onStart&&this.props.onStart(),L2(this);return this}stop(s){return this.listeners.forEach(f=>f(s)),this.listeners=[],this}pause(s){return this.stop(!0),s&&R2(this),this}runAsync(s,f){var m=this;s.delay;let x=Dl(s,["delay"]);const T=this.local;let k=Promise.resolve(void 0);if(oi.arr(x.to))for(let o=0;o<x.to.length;o++){const N=o,U=pr({},x,vp(x.to[N]));oi.arr(U.config)&&(U.config=U.config[N]),k=k.then(()=>{if(T===this.guid)return new Promise(V=>this.diff(U).start(V))})}else if(oi.fun(x.to)){let o=0,N;k=k.then(()=>x.to(U=>{const V=pr({},x,vp(U));if(oi.arr(V.config)&&(V.config=V.config[o]),o++,T===this.guid)return N=new Promise(F=>this.diff(V).start(F))},function(U){return U===void 0&&(U=!0),m.stop(U)}).then(()=>N))}k.then(f)}diff(s){this.props=pr({},this.props,s);let f=this.props,m=f.from,x=m===void 0?{}:m,T=f.to,k=T===void 0?{}:T,o=f.config,N=o===void 0?{}:o,U=f.reverse,V=f.attach,F=f.reset,Y=f.immediate;if(U){var $=[k,x];x=$[0],k=$[1]}this.merged=pr({},x,this.merged,k),this.hasChanged=!1;let ye=V&&V(this);if(this.animations=Object.entries(this.merged).reduce((be,Ue)=>{let Ge=Ue[0],S=Ue[1],we=be[Ge]||{};const Le=oi.num(S),Ze=oi.str(S)&&!S.startsWith("#")&&!/\d/.test(S)&&!Kv[S],xe=oi.arr(S),Se=!Le&&!xe&&!Ze;let Re=oi.und(x[Ge])?S:x[Ge],Je=Le||xe||Ze?S:1,ot=Pl(N,Ge);ye&&(Je=ye.animations[Ge].parent);let st=we.parent,wt=we.interpolation,ai=td(ye?Je.getPayload():Je),vi,Ft=S;Se&&(Ft=Dd({range:[0,1],output:[S,S]})(1));let Vi=wt&&wt.getValue();const kt=!oi.und(st)&&we.animatedValues.some(hi=>!hi.done),ui=!oi.equ(Ft,Vi),Di=!oi.equ(Ft,we.previous),At=!oi.equ(ot,we.config);if(F||Di&&ui||At){if(Le||Ze)st=wt=we.parent||new Wp(Re);else if(xe)st=wt=we.parent||new U2(Re);else if(Se){let hi=we.interpolation&&we.interpolation.calc(we.parent.value);hi=hi!==void 0&&!F?hi:Re,we.parent?(st=we.parent,st.setValue(0,!1)):st=new Wp(0);const cr={output:[hi,S]};we.interpolation?(wt=we.interpolation,we.interpolation.updateConfig(cr)):wt=st.interpolate(cr)}return ai=td(ye?Je.getPayload():Je),vi=td(st.getPayload()),F&&!Se&&st.setValue(Re,!1),this.hasChanged=!0,vi.forEach(hi=>{hi.startPosition=hi.value,hi.lastPosition=hi.value,hi.lastVelocity=kt?hi.lastVelocity:void 0,hi.lastTime=kt?hi.lastTime:void 0,hi.startTime=Jv(),hi.done=!1,hi.animatedStyles.clear()}),Pl(Y,Ge)&&st.setValue(Se?Je:S,!1),pr({},be,{[Ge]:pr({},we,{name:Ge,parent:st,interpolation:wt,animatedValues:vi,toValues:ai,previous:Ft,config:ot,fromValues:td(st.getValue()),immediate:Pl(Y,Ge),initialVelocity:fs(ot.velocity,0),clamp:fs(ot.clamp,!1),precision:fs(ot.precision,.01),tension:fs(ot.tension,170),friction:fs(ot.friction,26),mass:fs(ot.mass,1),duration:ot.duration,easing:fs(ot.easing,hi=>hi),decay:ot.decay})})}else return ui?be:(Se&&(st.setValue(1,!1),wt.updateConfig({output:[Ft,Ft]})),st.done=!0,this.hasChanged=!0,pr({},be,{[Ge]:pr({},be[Ge],{previous:Ft})}))},this.animations),this.hasChanged){this.configs=Object.values(this.animations),this.values={},this.interpolations={};for(let be in this.animations)this.interpolations[be]=this.animations[be].interpolation,this.values[be]=this.animations[be].interpolation.getValue()}return this}destroy(){this.stop(),this.props={},this.merged={},this.animations={},this.interpolations={},this.values={},this.configs=[],this.local=0}}const j2=(l,s)=>{const f=vt(!1),m=vt(),x=oi.fun(s),T=Gr(()=>{m.current&&(m.current.map(F=>F.destroy()),m.current=void 0);let V;return[new Array(l).fill().map((F,Y)=>{const $=new N2,ye=x?Pl(s,Y,$):s[Y];return Y===0&&(V=ye.ref),$.update(ye),V||$.start(),$}),V]},[l]),k=T[0],o=T[1];m.current=k,Nl(o,()=>({start:()=>Promise.all(m.current.map(V=>new Promise(F=>V.start(F)))),stop:V=>m.current.forEach(F=>F.stop(V)),get controllers(){return m.current}}));const N=Gr(()=>V=>m.current.map((F,Y)=>{F.update(x?Pl(V,Y,F):V[Y]),o||F.start()}),[l]);Jt(()=>{f.current?x||N(s):o||m.current.forEach(V=>V.start())}),Jt(()=>(f.current=!0,()=>m.current.forEach(V=>V.destroy())),[]);const U=m.current.map(V=>V.getValues());return x?[U,N,V=>m.current.forEach(F=>F.pause(V))]:U},G2=l=>{const s=oi.fun(l),f=j2(1,s?l:[l]),m=f[0],x=f[1],T=f[2];return s?[m[0],x,T]:m};class $2 extends Xv{constructor(s){s===void 0&&(s={});super();s.transform&&!(s.transform instanceof fo)&&(s=fm.transform(s)),this.payload=s}}const Rd={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},po="[-+]?\\d*\\.?\\d+",Bd=po+"%";function Gd(){for(var l=arguments.length,s=new Array(l),f=0;f<l;f++)s[f]=arguments[f];return"\\(\\s*("+s.join(")\\s*,\\s*(")+")\\s*\\)"}const Z2=new RegExp("rgb"+Gd(po,po,po)),q2=new RegExp("rgba"+Gd(po,po,po,po)),W2=new RegExp("hsl"+Gd(po,Bd,Bd)),H2=new RegExp("hsla"+Gd(po,Bd,Bd,po)),X2=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,K2=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Y2=/^#([0-9a-fA-F]{6})$/,J2=/^#([0-9a-fA-F]{8})$/;function Q2(l){let s;return typeof l=="number"?l>>>0===l&&l>=0&&l<=4294967295?l:null:(s=Y2.exec(l))?parseInt(s[1]+"ff",16)>>>0:Rd.hasOwnProperty(l)?Rd[l]:(s=Z2.exec(l))?(Il(s[1])<<24|Il(s[2])<<16|Il(s[3])<<8|255)>>>0:(s=q2.exec(l))?(Il(s[1])<<24|Il(s[2])<<16|Il(s[3])<<8|my(s[4]))>>>0:(s=X2.exec(l))?parseInt(s[1]+s[1]+s[2]+s[2]+s[3]+s[3]+"ff",16)>>>0:(s=J2.exec(l))?parseInt(s[1],16)>>>0:(s=K2.exec(l))?parseInt(s[1]+s[1]+s[2]+s[2]+s[3]+s[3]+s[4]+s[4],16)>>>0:(s=W2.exec(l))?(fy(py(s[1]),id(s[2]),id(s[3]))|255)>>>0:(s=H2.exec(l))?(fy(py(s[1]),id(s[2]),id(s[3]))|my(s[4]))>>>0:null}function xp(l,s,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?l+(s-l)*6*f:f<1/2?s:f<2/3?l+(s-l)*(2/3-f)*6:l}function fy(l,s,f){const m=f<.5?f*(1+s):f+s-f*s,x=2*f-m,T=xp(x,m,l+1/3),k=xp(x,m,l),o=xp(x,m,l-1/3);return Math.round(T*255)<<24|Math.round(k*255)<<16|Math.round(o*255)<<8}function Il(l){const s=parseInt(l,10);return s<0?0:s>255?255:s}function py(l){return(parseFloat(l)%360+360)%360/360}function my(l){const s=parseFloat(l);return s<0?0:s>1?255:Math.round(s*255)}function id(l){const s=parseFloat(l);return s<0?0:s>100?1:s/100}function _y(l){let s=Q2(l);if(s===null)return l;s=s||0;let f=(s&4278190080)>>>24,m=(s&16711680)>>>16,x=(s&65280)>>>8,T=(s&255)/255;return`rgba(${f}, ${m}, ${x}, ${T})`}const rd=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,eT=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,tT=new RegExp(`(${Object.keys(Rd).join("|")})`,"g"),iT=l=>{const s=l.output.map(x=>x.replace(eT,_y)).map(x=>x.replace(tT,_y)),f=s[0].match(rd).map(()=>[]);s.forEach(x=>{x.match(rd).forEach((T,k)=>f[k].push(+T))});const m=s[0].match(rd).map((x,T)=>Ld(pr({},l,{output:f[T]})));return x=>{let T=0;return s[0].replace(rd,()=>m[T++](x)).replace(/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,(k,o,N,U,V)=>`rgba(${Math.round(o)}, ${Math.round(N)}, ${Math.round(U)}, ${V})`)}};let du={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};const rT=(l,s)=>l+s.charAt(0).toUpperCase()+s.substring(1),nT=["Webkit","Ms","Moz","O"];du=Object.keys(du).reduce((l,s)=>(nT.forEach(f=>l[rT(f,s)]=l[s]),l),du);function oT(l,s,f){return s==null||typeof s=="boolean"||s===""?"":!f&&typeof s=="number"&&s!==0&&!(du.hasOwnProperty(l)&&du[l])?s+"px":(""+s).trim()}const gy={};k2(l=>new $2(l));M2(iT);C2(Rd);A2((l,s)=>{if(l.nodeType&&l.setAttribute!==void 0){const x=s.style,T=s.children,k=s.scrollTop,o=s.scrollLeft,N=Dl(s,["style","children","scrollTop","scrollLeft"]),U=l.nodeName==="filter"||l.parentNode&&l.parentNode.nodeName==="filter";k!==void 0&&(l.scrollTop=k),o!==void 0&&(l.scrollLeft=o),T!==void 0&&(l.textContent=T);for(let V in x)if(!!x.hasOwnProperty(V)){var f=V.indexOf("--")===0,m=oT(V,x[V],f);V==="float"&&(V="cssFloat"),f?l.style.setProperty(V,m):l.style[V]=m}for(let V in N){const F=U?V:gy[V]||(gy[V]=V.replace(/([A-Z])/g,Y=>"-"+Y.toLowerCase()));typeof l.getAttribute(F)!="undefined"&&l.setAttribute(F,N[V])}return}else return!1},l=>l);const aT=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],sT=w2(D2,!1),lT=sT(aT);function yy(l,s){return l.map(function(f,m){return f+s[m]})}function i0(l,s){return l.map(function(f,m){return f-s[m]})}function Hp(l){return Math.hypot.apply(Math,l)}function cT(l,s,f){var m=Hp(s),x=m===0?0:1/m,T=f===0?0:1/f,k=T*m,o=s.map(function(V){return T*V}),N=s.map(function(V){return x*V}),U=Hp(l);return{velocities:o,velocity:k,distance:U,direction:N}}function Xp(l){return Math.sign?Math.sign(l):Number(l>0)-Number(l<0)||+l}function uT(l,s,f){return Math.max(s,Math.min(l,f))}function hT(l,s){return Math.pow(l,s*5)}function vy(l,s,f){return s===0||Math.abs(s)===1/0?hT(l,f):l*s*f/(s+f*l)}function fu(l,s,f,m){return m===void 0&&(m=.15),m===0?uT(l,s,f):l<s?-vy(s-l,f-s,m)+s:l>f?+vy(l-f,f-s,m)+f:l}function xy(l,s){for(var f=0;f<s.length;f++){var m=s[f];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(l,m.key,m)}}function dT(l,s,f){return s&&xy(l.prototype,s),f&&xy(l,f),l}function dn(){return dn=Object.assign||function(l){for(var s=1;s<arguments.length;s++){var f=arguments[s];for(var m in f)Object.prototype.hasOwnProperty.call(f,m)&&(l[m]=f[m])}return l},dn.apply(this,arguments)}function r0(l,s){l.prototype=Object.create(s.prototype),l.prototype.constructor=l,l.__proto__=s}function fT(l,s){if(l==null)return{};var f={},m=Object.keys(l),x,T;for(T=0;T<m.length;T++)x=m[T],!(s.indexOf(x)>=0)&&(f[x]=l[x]);return f}function nd(l){if(l===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return l}function pT(l,s){if(!!l){if(typeof l=="string")return by(l,s);var f=Object.prototype.toString.call(l).slice(8,-1);if(f==="Object"&&l.constructor&&(f=l.constructor.name),f==="Map"||f==="Set")return Array.from(l);if(f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f))return by(l,s)}}function by(l,s){(s==null||s>l.length)&&(s=l.length);for(var f=0,m=new Array(s);f<s;f++)m[f]=l[f];return m}function $d(l,s){var f;if(typeof Symbol=="undefined"||l[Symbol.iterator]==null){if(Array.isArray(l)||(f=pT(l))||s&&l&&typeof l.length=="number"){f&&(l=f);var m=0;return function(){return m>=l.length?{done:!0}:{done:!1,value:l[m++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return f=l[Symbol.iterator](),f.next.bind(f)}function n0(){}function o0(){for(var l=arguments.length,s=new Array(l),f=0;f<l;f++)s[f]=arguments[f];return s.length===0?n0:s.length===1?s[0]:function(){for(var m,x=$d(s),T;!(T=x()).done;){var k=T.value;m=k.apply(this,arguments)||m}return m}}function Ca(l,s){if(l===void 0){if(s===void 0)throw new Error("Must define fallback value if undefined is expected");l=s}return Array.isArray(l)?l:[l,l]}function od(l){if(typeof l=="function"){for(var s=arguments.length,f=new Array(s>1?s-1:0),m=1;m<s;m++)f[m-1]=arguments[m];return l.apply(void 0,f)}else return l}function pm(l,s){l===void 0&&(l={});for(var f={},m=0,x=Object.entries(s);m<x.length;m++){var T=x[m],k=T[0],o=T[1];switch(typeof o){case"function":f[k]=o.call(f,l[k],k,l);break;case"object":f[k]=pm(l[k],o);break;case"boolean":o&&(f[k]=l[k]);break}}return f}var mT=180,_T=.15,gT=.5,yT=60,vT={threshold:function(s){return s===void 0&&(s=0),Ca(s)},rubberband:function(s){switch(s===void 0&&(s=0),s){case!0:return Ca(_T);case!1:return Ca(0);default:return Ca(s)}},enabled:function(s){return s===void 0&&(s=!0),s},triggerAllEvents:function(s){return s===void 0&&(s=!1),s},initial:function(s){return s===void 0&&(s=0),typeof s=="function"?s:Ca(s)}},a0=dn({},vT,{axis:!0,lockDirection:function(s){return s===void 0&&(s=!1),s},bounds:function(s){if(s===void 0&&(s={}),typeof s=="function")return function(F){return a0.bounds(s(F))};var f=s,m=f.left,x=m===void 0?-1/0:m,T=f.right,k=T===void 0?1/0:T,o=f.top,N=o===void 0?-1/0:o,U=f.bottom,V=U===void 0?1/0:U;return[[x,k],[N,V]]}}),xT=typeof window!="undefined"&&window.document&&window.document.createElement,bT={enabled:function(s){return s===void 0&&(s=!0),s},domTarget:!0,window:function(l){function s(f){return l.apply(this,arguments)}return s.toString=function(){return l.toString()},s}(function(l){return l===void 0&&(l=xT?window:void 0),l}),eventOptions:function(s){var f=s===void 0?{}:s,m=f.passive,x=m===void 0?!0:m,T=f.capture,k=T===void 0?!1:T;return{passive:x,capture:k}}},wT=dn({},a0,{threshold:function(s,f,m){var x=m.filterTaps,T=x===void 0?!1:x,k=m.lockDirection,o=k===void 0?!1:k,N=m.axis,U=N===void 0?void 0:N,V=Ca(s,T?3:o||U?1:0);return this.filterTaps=T||V[0]+V[1]>0,V},swipeVelocity:function(s){return s===void 0&&(s=gT),Ca(s)},swipeDistance:function(s){return s===void 0&&(s=yT),Ca(s)},delay:function(s){switch(s===void 0&&(s=0),s){case!0:return mT;case!1:return 0;default:return s}}});function TT(l){return l===void 0&&(l={}),pm(l,bT)}function ST(l){return l===void 0&&(l={}),pm(l,wT)}function ET(l){var s=l.domTarget,f=l.eventOptions,m=l.window,x=l.enabled,T=fT(l,["domTarget","eventOptions","window","enabled"]),k=TT({domTarget:s,eventOptions:f,window:m,enabled:x});return k.drag=ST(T),k}function Xc(l){return dn({_active:!1,_blocked:!1,_intentional:[!1,!1],_movement:[0,0],_initial:[0,0],_bounds:[[-1/0,1/0],[-1/0,1/0]],_lastEventType:void 0,event:void 0,intentional:!1,values:[0,0],velocities:[0,0],delta:[0,0],movement:[0,0],offset:[0,0],lastOffset:[0,0],direction:[0,0],initial:[0,0],previous:[0,0],first:!1,last:!1,active:!1,timeStamp:0,startTime:0,elapsedTime:0,cancel:n0,canceled:!1,memo:void 0,args:void 0},l)}function s0(){var l={hovering:!1,scrolling:!1,wheeling:!1,dragging:!1,moving:!1,pinching:!1,touches:0,buttons:0,down:!1,shiftKey:!1,altKey:!1,metaKey:!1,ctrlKey:!1},s=Xc({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0,_isTap:!0,_delayedEvent:!1,_pointerId:void 0,tap:!1,swipe:[0,0]}),f=Xc({da:[0,0],vdva:[0,0],origin:void 0,turns:0}),m=Xc({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),x=Xc({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),T=Xc({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0});return{shared:l,drag:s,pinch:f,wheel:m,move:x,scroll:T}}var ps=new Map,AT=function(){function l(f,m){var x=this;m===void 0&&(m=[]),this.controller=f,this.args=m,this.debounced=!0,this.setTimeout=function(T,k){var o;k===void 0&&(k=140),clearTimeout(x.controller.timeouts[x.stateKey]);for(var N=arguments.length,U=new Array(N>2?N-2:0),V=2;V<N;V++)U[V-2]=arguments[V];x.controller.timeouts[x.stateKey]=(o=window).setTimeout.apply(o,[T,k].concat(U))},this.clearTimeout=function(){clearTimeout(x.controller.timeouts[x.stateKey])},this.fireGestureHandler=function(T){if(T===void 0&&(T=!1),x.state._blocked)return x.debounced||(x.state._active=!1,x.clean()),null;if(!T&&!x.state.intentional&&!x.config.triggerAllEvents)return null;if(x.state.intentional){var k=x.state.active,o=x.state._active;x.state.active=o,x.state.first=o&&!k,x.state.last=k&&!o,x.controller.state.shared[x.ingKey]=o}var N=dn({},x.controller.state.shared,x.state,x.mapStateValues(x.state)),U=x.handler(N);return x.state.memo=U!==void 0?U:x.state.memo,x.state._active||x.clean(),N}}var s=l.prototype;return s.updateSharedState=function(m){Object.assign(this.controller.state.shared,m)},s.updateGestureState=function(m){Object.assign(this.state,m)},s.checkIntentionality=function(m,x){return{_intentional:m,_blocked:!1}},s.getMovement=function(m){var x=this.config,T=x.initial,k=x.bounds,o=x.rubberband,N=x.threshold,U=this.state,V=U._bounds,F=U._initial,Y=U._active,$=U._intentional,ye=U.lastOffset,be=U.movement,Ue=this.getInternalMovement(m,this.state),Ge=$[0]===!1?wy(Ue[0],N[0]):$[0],S=$[1]===!1?wy(Ue[1],N[1]):$[1],we=this.checkIntentionality([Ge,S],Ue);if(we._blocked)return dn({},we,{_movement:Ue,delta:[0,0]});var Le=we._intentional,Ze=Ue,xe,Se;if(Le[0]!==!1&&$[0]===!1&&(Se=od(T,this.state),xe=od(k,this.state),F[0]=Se[0],V[0]=xe[0]),Le[1]!==!1&&$[1]===!1){var Re,Je;Se=(Re=Se)!=null?Re:od(T,this.state),xe=(Je=xe)!=null?Je:od(k,this.state),F[1]=Se[1],V[1]=xe[1]}var ot=[Le[0]!==!1?Ue[0]-Le[0]:F[0],Le[1]!==!1?Ue[1]-Le[1]:F[1]],st=yy(ot,ye),wt=Y?o:[0,0];return ot=Ty(V,yy(ot,F),wt),dn({},we,{intentional:Le[0]!==!1||Le[1]!==!1,_initial:F,_movement:Ze,movement:ot,values:m,offset:Ty(V,st,wt),delta:i0(ot,be)})},s.clean=function(){this.clearTimeout()},dT(l,[{key:"config",get:function(){return this.controller.config[this.stateKey]}},{key:"enabled",get:function(){return this.controller.config.enabled&&this.config.enabled}},{key:"state",get:function(){return this.controller.state[this.stateKey]}},{key:"handler",get:function(){return this.controller.handlers[this.stateKey]}}]),l}();function wy(l,s){return Math.abs(l)>=s?Xp(l)*s:!1}function Ty(l,s,f){var m=s[0],x=s[1],T=f[0],k=f[1],o=l[0],N=o[0],U=o[1],V=l[1],F=V[0],Y=V[1];return[fu(m,N,U,T),fu(x,F,Y,k)]}function bp(l,s,f){var m=l.state,x=l.args,T=s.timeStamp,k=s.type,o=m.values,N=f?0:T-m.startTime;return{_lastEventType:k,event:s,timeStamp:T,elapsedTime:N,args:x,previous:o}}function CT(l,s,f){var m=l.state.offset,x=f.timeStamp;return dn({},s0()[l.stateKey],{_active:!0,values:s,initial:s,offset:m,lastOffset:m,startTime:x})}function MT(l,s){return function(f){for(var m=arguments.length,x=new Array(m>1?m-1:0),T=1;T<m;T++)x[T-1]=arguments[T];return l.call.apply(l,[this,dn({},s,{event:f})].concat(x))}}var IT=function(s){var f=this;this.classes=s,this.bind=function(){for(var m={},x=arguments.length,T=new Array(x),k=0;k<x;k++)T[k]=arguments[k];for(var o=$d(f.classes),N;!(N=o()).done;){var U=N.value;new U(f,T).addBindings(m)}for(var V=0,F=Object.entries(f.nativeRefs);V<F.length;V++){var Y=F[V],$=Y[0],ye=Y[1];Kp(m,$,MT(ye,dn({},f.state.shared,{args:T})))}return f.config.domTarget?DT(f,m):LT(f,m)},this.effect=function(){return f.config.domTarget&&f.bind(),f.clean},this.clean=function(){var m=c0(f.config),x=f.config.eventOptions;m&&Au(m,l0(f.domListeners),x),Object.values(f.timeouts).forEach(clearTimeout),kT(f)},this.state=s0(),this.timeouts={},this.domListeners=[],this.windowListeners={}};function kT(l){var s=l.config,f=s.window,m=s.eventOptions,x=l.windowListeners;if(!!f){for(var T in x){var k=x[T];Au(f,k,m)}l.windowListeners={}}}function zT(l,s){var f=l.config,m=l.windowListeners;!f.window||(Au(f.window,m[s],f.eventOptions),delete m[s])}function PT(l,s,f){var m=l.config,x=l.windowListeners;f===void 0&&(f=[]),m.window&&(Au(m.window,x[s],m.eventOptions),u0(m.window,x[s]=f,m.eventOptions))}function DT(l,s){var f=l.config,m=l.domListeners,x=c0(f);if(!x)throw new Error("domTarget must be defined");var T=f.eventOptions;Au(x,l0(m),T);for(var k=0,o=Object.entries(s);k<o.length;k++){var N=o[k],U=N[0],V=N[1],F=U.slice(2).toLowerCase();m.push([F,o0.apply(void 0,V)])}u0(x,m,T)}function LT(l,s){for(var f=l.config,m={},x=f.eventOptions.capture?"Capture":"",T=0,k=Object.entries(s);T<k.length;T++){var o=k[T],N=o[0],U=o[1],V=Array.isArray(U)?U:[U],F=N+x;m[F]=o0.apply(void 0,V)}return m}function l0(l){return l===void 0&&(l=[]),l.splice(0,l.length)}function c0(l){var s=l.domTarget;return s&&"current"in s?s.current:s}function Kp(l,s,f){l[s]||(l[s]=[]),l[s].push(f)}function u0(l,s,f){s===void 0&&(s=[]),f===void 0&&(f={});for(var m=$d(s),x;!(x=m()).done;){var T=x.value,k=T[0],o=T[1];l.addEventListener(k,o,f)}}function Au(l,s,f){s===void 0&&(s=[]),f===void 0&&(f={});for(var m=$d(s),x;!(x=m()).done;){var T=x.value,k=T[0],o=T[1];l.removeEventListener(k,o,f)}}function RT(l,s,f){f===void 0&&(f={});var m=OT(l),x=Cn.useMemo(function(){return new IT(m)},[]);return x.config=s,x.handlers=l,x.nativeRefs=f,Cn.useEffect(x.effect,[]),x.config.domTarget?BT:x.bind}function BT(){}function OT(l){var s=new Set;return l.drag&&s.add(ps.get("drag")),l.wheel&&s.add(ps.get("wheel")),l.scroll&&s.add(ps.get("scroll")),l.move&&s.add(ps.get("move")),l.pinch&&s.add(ps.get("pinch")),l.hover&&s.add(ps.get("hover")),s}var FT=function(l){r0(s,l);function s(){return l.apply(this,arguments)||this}var f=s.prototype;return f.getInternalMovement=function(x,T){return i0(x,T.initial)},f.checkIntentionality=function(x,T){if(x[0]===!1&&x[1]===!1)return{_intentional:x,axis:this.state.axis};var k=T.map(Math.abs),o=k[0],N=k[1],U=this.state.axis||(o>N?"x":o<N?"y":void 0);return!this.config.axis&&!this.config.lockDirection?{_intentional:x,_blocked:!1,axis:U}:U?!!this.config.axis&&U!==this.config.axis?{_intentional:x,_blocked:!0,axis:U}:(x[U==="x"?1:0]=!1,{_intentional:x,_blocked:!1,axis:U}):{_intentional:[!1,!1],_blocked:!1,axis:U}},f.getKinematics=function(x,T){var k=this.getMovement(x);if(!k._blocked){var o=T.timeStamp-this.state.timeStamp;Object.assign(k,cT(k.movement,k.delta,o))}return k},f.mapStateValues=function(x){return{xy:x.values,vxvy:x.velocities}},s}(AT);function h0(l){if("touches"in l){var s=l.targetTouches,f=l.changedTouches;return s.length>0?s:f}return null}function Sy(l){var s="buttons"in l?l.buttons:0,f=h0(l),m=f&&f.length||0,x=m>0||s>0,T=l.shiftKey,k=l.altKey,o=l.metaKey,N=l.ctrlKey;return{touches:m,down:x,buttons:s,shiftKey:T,altKey:k,metaKey:o,ctrlKey:N}}function Ey(l){var s=h0(l),f=s?s[0]:l,m=f.clientX,x=f.clientY;return[m,x]}var UT=3,VT=220,NT=function(l){r0(s,l);function s(){var m;return m=l.apply(this,arguments)||this,m.ingKey="dragging",m.stateKey="drag",m.onDragStart=function(x){!m.enabled||m.state._active||(PT(m.controller,m.stateKey,[["pointermove",m.onDragChange],["pointerup",m.onDragEnd],["pointercancel",m.onDragEnd]]),m.updateGestureState({_pointerId:x.pointerId}),m.config.delay>0?(m.state._delayedEvent=!0,"persist"in x&&typeof x.persist=="function"&&x.persist(),m.setTimeout(m.startDrag.bind(nd(m)),m.config.delay,x)):m.startDrag(x))},m.onDragChange=function(x){if(!m.state.canceled&&x.pointerId===m.state._pointerId){if(!m.state._active){m.state._delayedEvent&&(m.clearTimeout(),m.startDrag(x));return}var T=Sy(x);if(!T.down){m.onDragEnd(x);return}m.updateSharedState(T);var k=Ey(x),o=m.getKinematics(k,x),N=bp(nd(m),x),U=m.state._isTap,V=Hp(o._movement);U&&V>=UT&&(U=!1),m.updateGestureState(dn({},N,o,{_isTap:U})),m.fireGestureHandler()}},m.onDragEnd=function(x){if(x.pointerId===m.state._pointerId){m.state._active=!1,m.updateSharedState({down:!1,buttons:0,touches:0});var T=m.state._isTap,k=m.state.velocities,o=k[0],N=k[1],U=m.state.movement,V=U[0],F=U[1],Y=m.state._intentional,$=Y[0],ye=Y[1],be=m.config.swipeVelocity,Ue=be[0],Ge=be[1],S=m.config.swipeDistance,we=S[0],Le=S[1],Ze=dn({},bp(nd(m),x),m.getMovement(m.state.values)),xe=[0,0];Ze.elapsedTime<VT&&($!==!1&&Math.abs(o)>Ue&&Math.abs(V)>we&&(xe[0]=Xp(o)),ye!==!1&&Math.abs(N)>Ge&&Math.abs(F)>Le&&(xe[1]=Xp(N))),m.updateGestureState(dn({},Ze,{tap:T,swipe:xe})),m.fireGestureHandler(T===!0)}},m.clean=function(){l.prototype.clean.call(nd(m)),m.state._delayedEvent=!1,zT(m.controller,m.stateKey)},m.onCancel=function(){m.state.canceled||(m.updateGestureState({canceled:!0}),m.state._active=!1,m.updateSharedState({down:!1,buttons:0,touches:0}),requestAnimationFrame(function(){return m.fireGestureHandler()}))},m.onClick=function(x){m.state._isTap||x.stopPropagation()},m}var f=s.prototype;return f.startDrag=function(x){var T=Ey(x);this.updateSharedState(Sy(x)),this.updateGestureState(dn({},CT(this,T,x),bp(this,x,!0),{_pointerId:x.pointerId,cancel:this.onCancel})),this.updateGestureState(this.getMovement(T)),this.fireGestureHandler()},f.addBindings=function(x){if(Kp(x,"onPointerDown",this.onDragStart),this.config.filterTaps){var T=this.controller.config.eventOptions.capture?"onClick":"onClickCapture";Kp(x,T,this.onClick)}},s}(FT);function jT(l,s){var f,m=[],x,T=!1;function k(){for(var o=arguments.length,N=new Array(o),U=0;U<o;U++)N[U]=arguments[U];return T&&f===this&&s(N,m)||(x=l.apply(this,N),T=!0,f=this,m=N),x}return k}function xd(l,s){if(l===s)return!0;if(l&&s&&typeof l=="object"&&typeof s=="object"){if(l.constructor!==s.constructor)return!1;var f,m,x;if(Array.isArray(l)){if(f=l.length,f!==s.length)return!1;for(m=f;m--!==0;)if(!xd(l[m],s[m]))return!1;return!0}var T;if(typeof Map=="function"&&l instanceof Map&&s instanceof Map){if(l.size!==s.size)return!1;for(T=l.entries();!(m=T.next()).done;)if(!s.has(m.value[0]))return!1;for(T=l.entries();!(m=T.next()).done;)if(!xd(m.value[1],s.get(m.value[0])))return!1;return!0}if(typeof Set=="function"&&l instanceof Set&&s instanceof Set){if(l.size!==s.size)return!1;for(T=l.entries();!(m=T.next()).done;)if(!s.has(m.value[0]))return!1;return!0}if(l.constructor===RegExp)return l.source===s.source&&l.flags===s.flags;if(l.valueOf!==Object.prototype.valueOf)return l.valueOf()===s.valueOf();if(l.toString!==Object.prototype.toString)return l.toString()===s.toString();if(x=Object.keys(l),f=x.length,f!==Object.keys(s).length)return!1;for(m=f;m--!==0;)if(!Object.prototype.hasOwnProperty.call(s,x[m]))return!1;if(typeof Element!="undefined"&&l instanceof Element)return!1;for(m=f;m--!==0;)if(!(x[m]==="_owner"&&l.$$typeof)&&!xd(l[x[m]],s[x[m]]))return!1;return!0}return l!==l&&s!==s}function GT(l,s){try{return xd(l,s)}catch(f){if((f.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw f}}function $T(l,s){s===void 0&&(s={}),ps.set("drag",NT);var f=vt();return f.current||(f.current=jT(ET,GT)),RT({drag:l},f.current(s))}/*!
* tabbable 5.2.1
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var d0=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],Yp=d0.join(","),xu=typeof Element=="undefined"?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,f0=function(s,f,m){var x=Array.prototype.slice.apply(s.querySelectorAll(Yp));return f&&xu.call(s,Yp)&&x.unshift(s),x=x.filter(m),x},ZT=function(s){return s.contentEditable==="true"},p0=function(s){var f=parseInt(s.getAttribute("tabindex"),10);return isNaN(f)?ZT(s)||(s.nodeName==="AUDIO"||s.nodeName==="VIDEO"||s.nodeName==="DETAILS")&&s.getAttribute("tabindex")===null?0:s.tabIndex:f},qT=function(s,f){return s.tabIndex===f.tabIndex?s.documentOrder-f.documentOrder:s.tabIndex-f.tabIndex},mm=function(s){return s.tagName==="INPUT"},WT=function(s){return mm(s)&&s.type==="hidden"},HT=function(s){var f=s.tagName==="DETAILS"&&Array.prototype.slice.apply(s.children).some(function(m){return m.tagName==="SUMMARY"});return f},XT=function(s,f){for(var m=0;m<s.length;m++)if(s[m].checked&&s[m].form===f)return s[m]},KT=function(s){if(!s.name)return!0;var f=s.form||s.ownerDocument,m=function(o){return f.querySelectorAll('input[type="radio"][name="'+o+'"]')},x;if(typeof window!="undefined"&&typeof window.CSS!="undefined"&&typeof window.CSS.escape=="function")x=m(window.CSS.escape(s.name));else try{x=m(s.name)}catch(k){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",k.message),!1}var T=XT(x,s.form);return!T||T===s},YT=function(s){return mm(s)&&s.type==="radio"},JT=function(s){return YT(s)&&!KT(s)},QT=function(s,f){if(getComputedStyle(s).visibility==="hidden")return!0;var m=xu.call(s,"details>summary:first-of-type"),x=m?s.parentElement:s;if(xu.call(x,"details:not([open]) *"))return!0;if(!f||f==="full")for(;s;){if(getComputedStyle(s).display==="none")return!0;s=s.parentElement}else if(f==="non-zero-area"){var T=s.getBoundingClientRect(),k=T.width,o=T.height;return k===0&&o===0}return!1},eS=function(s){if(mm(s)||s.tagName==="SELECT"||s.tagName==="TEXTAREA"||s.tagName==="BUTTON")for(var f=s.parentElement;f;){if(f.tagName==="FIELDSET"&&f.disabled){for(var m=0;m<f.children.length;m++){var x=f.children.item(m);if(x.tagName==="LEGEND")return!x.contains(s)}return!0}f=f.parentElement}return!1},_m=function(s,f){return!(f.disabled||WT(f)||QT(f,s.displayCheck)||HT(f)||eS(f))},m0=function(s,f){return!(!_m(s,f)||JT(f)||p0(f)<0)},tS=function(s,f){f=f||{};var m=[],x=[],T=f0(s,f.includeContainer,m0.bind(null,f));T.forEach(function(o,N){var U=p0(o);U===0?m.push(o):x.push({documentOrder:N,tabIndex:U,node:o})});var k=x.sort(qT).map(function(o){return o.node}).concat(m);return k},iS=function(s,f){f=f||{};var m=f0(s,f.includeContainer,_m.bind(null,f));return m},ad=function(s,f){if(f=f||{},!s)throw new Error("No node provided");return xu.call(s,Yp)===!1?!1:m0(f,s)},rS=d0.concat("iframe").join(","),wp=function(s,f){if(f=f||{},!s)throw new Error("No node provided");return xu.call(s,rS)===!1?!1:_m(f,s)};/*!
* focus-trap 6.7.3
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function Ay(l,s){var f=Object.keys(l);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(l);s&&(m=m.filter(function(x){return Object.getOwnPropertyDescriptor(l,x).enumerable})),f.push.apply(f,m)}return f}function nS(l){for(var s=1;s<arguments.length;s++){var f=arguments[s]!=null?arguments[s]:{};s%2?Ay(Object(f),!0).forEach(function(m){oS(l,m,f[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(f)):Ay(Object(f)).forEach(function(m){Object.defineProperty(l,m,Object.getOwnPropertyDescriptor(f,m))})}return l}function oS(l,s,f){return s in l?Object.defineProperty(l,s,{value:f,enumerable:!0,configurable:!0,writable:!0}):l[s]=f,l}var Cy=function(){var l=[];return{activateTrap:function(f){if(l.length>0){var m=l[l.length-1];m!==f&&m.pause()}var x=l.indexOf(f);x===-1||l.splice(x,1),l.push(f)},deactivateTrap:function(f){var m=l.indexOf(f);m!==-1&&l.splice(m,1),l.length>0&&l[l.length-1].unpause()}}}(),aS=function(s){return s.tagName&&s.tagName.toLowerCase()==="input"&&typeof s.select=="function"},sS=function(s){return s.key==="Escape"||s.key==="Esc"||s.keyCode===27},lS=function(s){return s.key==="Tab"||s.keyCode===9},My=function(s){return setTimeout(s,0)},Tp=function(s,f){var m=-1;return s.every(function(x,T){return f(x)?(m=T,!1):!0}),m},Kc=function(s){for(var f=arguments.length,m=new Array(f>1?f-1:0),x=1;x<f;x++)m[x-1]=arguments[x];return typeof s=="function"?s.apply(void 0,m):s},sd=function(s){return s.target.shadowRoot&&typeof s.composedPath=="function"?s.composedPath()[0]:s.target},cS=function(s,f){var m=(f==null?void 0:f.document)||document,x=nS({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},f),T={containers:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0},k,o=function(xe,Se,Re){return xe&&xe[Se]!==void 0?xe[Se]:x[Re||Se]},N=function(xe){return!!(xe&&T.containers.some(function(Se){return Se.contains(xe)}))},U=function(xe){var Se=x[xe];if(typeof Se=="function"){for(var Re=arguments.length,Je=new Array(Re>1?Re-1:0),ot=1;ot<Re;ot++)Je[ot-1]=arguments[ot];Se=Se.apply(void 0,Je)}if(!Se){if(Se===void 0||Se===!1)return Se;throw new Error("`".concat(xe,"` was specified but was not a node, or did not return a node"))}var st=Se;if(typeof Se=="string"&&(st=m.querySelector(Se),!st))throw new Error("`".concat(xe,"` as selector refers to no known node"));return st},V=function(){var xe=U("initialFocus");if(xe===!1)return!1;if(xe===void 0)if(N(m.activeElement))xe=m.activeElement;else{var Se=T.tabbableGroups[0],Re=Se&&Se.firstTabbableNode;xe=Re||U("fallbackFocus")}if(!xe)throw new Error("Your focus-trap needs to have at least one focusable element");return xe},F=function(){if(T.tabbableGroups=T.containers.map(function(xe){var Se=tS(xe),Re=iS(xe);if(Se.length>0)return{container:xe,firstTabbableNode:Se[0],lastTabbableNode:Se[Se.length-1],nextTabbableNode:function(ot){var st=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,wt=Re.findIndex(function(ai){return ai===ot});return st?Re.slice(wt+1).find(function(ai){return ad(ai)}):Re.slice(0,wt).reverse().find(function(ai){return ad(ai)})}}}).filter(function(xe){return!!xe}),T.tabbableGroups.length<=0&&!U("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},Y=function Ze(xe){if(xe!==!1&&xe!==m.activeElement){if(!xe||!xe.focus){Ze(V());return}xe.focus({preventScroll:!!x.preventScroll}),T.mostRecentlyFocusedNode=xe,aS(xe)&&xe.select()}},$=function(xe){var Se=U("setReturnFocus",xe);return Se||(Se===!1?!1:xe)},ye=function(xe){var Se=sd(xe);if(!N(Se)){if(Kc(x.clickOutsideDeactivates,xe)){k.deactivate({returnFocus:x.returnFocusOnDeactivate&&!wp(Se)});return}Kc(x.allowOutsideClick,xe)||xe.preventDefault()}},be=function(xe){var Se=sd(xe),Re=N(Se);Re||Se instanceof Document?Re&&(T.mostRecentlyFocusedNode=Se):(xe.stopImmediatePropagation(),Y(T.mostRecentlyFocusedNode||V()))},Ue=function(xe){var Se=sd(xe);F();var Re=null;if(T.tabbableGroups.length>0){var Je=Tp(T.tabbableGroups,function(Dt){var kt=Dt.container;return kt.contains(Se)}),ot=Je>=0?T.tabbableGroups[Je]:void 0;if(Je<0)xe.shiftKey?Re=T.tabbableGroups[T.tabbableGroups.length-1].lastTabbableNode:Re=T.tabbableGroups[0].firstTabbableNode;else if(xe.shiftKey){var st=Tp(T.tabbableGroups,function(Dt){var kt=Dt.firstTabbableNode;return Se===kt});if(st<0&&(ot.container===Se||wp(Se)&&!ad(Se)&&!ot.nextTabbableNode(Se,!1))&&(st=Je),st>=0){var wt=st===0?T.tabbableGroups.length-1:st-1,ai=T.tabbableGroups[wt];Re=ai.lastTabbableNode}}else{var vi=Tp(T.tabbableGroups,function(Dt){var kt=Dt.lastTabbableNode;return Se===kt});if(vi<0&&(ot.container===Se||wp(Se)&&!ad(Se)&&!ot.nextTabbableNode(Se))&&(vi=Je),vi>=0){var Ft=vi===T.tabbableGroups.length-1?0:vi+1,Vi=T.tabbableGroups[Ft];Re=Vi.firstTabbableNode}}}else Re=U("fallbackFocus");Re&&(xe.preventDefault(),Y(Re))},Ge=function(xe){if(sS(xe)&&Kc(x.escapeDeactivates,xe)!==!1){xe.preventDefault(),k.deactivate();return}if(lS(xe)){Ue(xe);return}},S=function(xe){if(!Kc(x.clickOutsideDeactivates,xe)){var Se=sd(xe);N(Se)||Kc(x.allowOutsideClick,xe)||(xe.preventDefault(),xe.stopImmediatePropagation())}},we=function(){if(!!T.active)return Cy.activateTrap(k),T.delayInitialFocusTimer=x.delayInitialFocus?My(function(){Y(V())}):Y(V()),m.addEventListener("focusin",be,!0),m.addEventListener("mousedown",ye,{capture:!0,passive:!1}),m.addEventListener("touchstart",ye,{capture:!0,passive:!1}),m.addEventListener("click",S,{capture:!0,passive:!1}),m.addEventListener("keydown",Ge,{capture:!0,passive:!1}),k},Le=function(){if(!!T.active)return m.removeEventListener("focusin",be,!0),m.removeEventListener("mousedown",ye,!0),m.removeEventListener("touchstart",ye,!0),m.removeEventListener("click",S,!0),m.removeEventListener("keydown",Ge,!0),k};return k={activate:function(xe){if(T.active)return this;var Se=o(xe,"onActivate"),Re=o(xe,"onPostActivate"),Je=o(xe,"checkCanFocusTrap");Je||F(),T.active=!0,T.paused=!1,T.nodeFocusedBeforeActivation=m.activeElement,Se&&Se();var ot=function(){Je&&F(),we(),Re&&Re()};return Je?(Je(T.containers.concat()).then(ot,ot),this):(ot(),this)},deactivate:function(xe){if(!T.active)return this;clearTimeout(T.delayInitialFocusTimer),T.delayInitialFocusTimer=void 0,Le(),T.active=!1,T.paused=!1,Cy.deactivateTrap(k);var Se=o(xe,"onDeactivate"),Re=o(xe,"onPostDeactivate"),Je=o(xe,"checkCanReturnFocus");Se&&Se();var ot=o(xe,"returnFocus","returnFocusOnDeactivate"),st=function(){My(function(){ot&&Y($(T.nodeFocusedBeforeActivation)),Re&&Re()})};return ot&&Je?(Je($(T.nodeFocusedBeforeActivation)).then(st,st),this):(st(),this)},pause:function(){return T.paused||!T.active?this:(T.paused=!0,Le(),this)},unpause:function(){return!T.paused||!T.active?this:(T.paused=!1,F(),we(),this)},updateContainerElements:function(xe){var Se=[].concat(xe).filter(Boolean);return T.containers=Se.map(function(Re){return typeof Re=="string"?m.querySelector(Re):Re}),T.active&&F(),this}},k.updateContainerElements(s),k};function uS(l){if(Array.isArray(l)){for(var s=0,f=Array(l.length);s<l.length;s++)f[s]=l[s];return f}else return Array.from(l)}var gm=!1;if(typeof window!="undefined"){var Iy={get passive(){gm=!0}};window.addEventListener("testPassive",null,Iy),window.removeEventListener("testPassive",null,Iy)}var _0=typeof window!="undefined"&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||window.navigator.platform==="MacIntel"&&window.navigator.maxTouchPoints>1),Ma=[],Od=!1,g0=-1,pu=void 0,mu=void 0,y0=function(s){return Ma.some(function(f){return!!(f.options.allowTouchMove&&f.options.allowTouchMove(s))})},Fd=function(s){var f=s||window.event;return y0(f.target)||f.touches.length>1?!0:(f.preventDefault&&f.preventDefault(),!1)},hS=function(s){if(mu===void 0){var f=!!s&&s.reserveScrollBarGap===!0,m=window.innerWidth-document.documentElement.clientWidth;f&&m>0&&(mu=document.body.style.paddingRight,document.body.style.paddingRight=m+"px")}pu===void 0&&(pu=document.body.style.overflow,document.body.style.overflow="hidden")},dS=function(){mu!==void 0&&(document.body.style.paddingRight=mu,mu=void 0),pu!==void 0&&(document.body.style.overflow=pu,pu=void 0)},fS=function(s){return s?s.scrollHeight-s.scrollTop<=s.clientHeight:!1},pS=function(s,f){var m=s.targetTouches[0].clientY-g0;return y0(s.target)?!1:f&&f.scrollTop===0&&m>0||fS(f)&&m<0?Fd(s):(s.stopPropagation(),!0)},mS=function(s,f){if(!s){console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.");return}if(!Ma.some(function(x){return x.targetElement===s})){var m={targetElement:s,options:f||{}};Ma=[].concat(uS(Ma),[m]),_0?(s.ontouchstart=function(x){x.targetTouches.length===1&&(g0=x.targetTouches[0].clientY)},s.ontouchmove=function(x){x.targetTouches.length===1&&pS(x,s)},Od||(document.addEventListener("touchmove",Fd,gm?{passive:!1}:void 0),Od=!0)):hS(f)}},_S=function(s){if(!s){console.error("enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.");return}Ma=Ma.filter(function(f){return f.targetElement!==s}),_0?(s.ontouchstart=null,s.ontouchmove=null,Od&&Ma.length===0&&(document.removeEventListener("touchmove",Fd,gm?{passive:!1}:void 0),Od=!1)):Ma.length||dS()},_s=[],gS=function(){return _s.some(function(l){return l.activeTargets.length>0})},yS=function(){return _s.some(function(l){return l.skippedTargets.length>0})},ky="ResizeObserver loop completed with undelivered notifications.",vS=function(){var l;typeof ErrorEvent=="function"?l=new ErrorEvent("error",{message:ky}):(l=document.createEvent("Event"),l.initEvent("error",!1,!1),l.message=ky),window.dispatchEvent(l)},bu;(function(l){l.BORDER_BOX="border-box",l.CONTENT_BOX="content-box",l.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"})(bu||(bu={}));var gs=function(l){return Object.freeze(l)},xS=function(){function l(s,f){this.inlineSize=s,this.blockSize=f,gs(this)}return l}(),v0=function(){function l(s,f,m,x){return this.x=s,this.y=f,this.width=m,this.height=x,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,gs(this)}return l.prototype.toJSON=function(){var s=this,f=s.x,m=s.y,x=s.top,T=s.right,k=s.bottom,o=s.left,N=s.width,U=s.height;return{x:f,y:m,top:x,right:T,bottom:k,left:o,width:N,height:U}},l.fromRect=function(s){return new l(s.x,s.y,s.width,s.height)},l}(),ym=function(l){return l instanceof SVGElement&&"getBBox"in l},x0=function(l){if(ym(l)){var s=l.getBBox(),f=s.width,m=s.height;return!f&&!m}var x=l,T=x.offsetWidth,k=x.offsetHeight;return!(T||k||l.getClientRects().length)},zy=function(l){var s,f;if(l instanceof Element)return!0;var m=(f=(s=l)===null||s===void 0?void 0:s.ownerDocument)===null||f===void 0?void 0:f.defaultView;return!!(m&&l instanceof m.Element)},bS=function(l){switch(l.tagName){case"INPUT":if(l.type!=="image")break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1},_u=typeof window!="undefined"?window:{},ld=new WeakMap,Py=/auto|scroll/,wS=/^tb|vertical/,TS=/msie|trident/i.test(_u.navigator&&_u.navigator.userAgent),Ro=function(l){return parseFloat(l||"0")},Ll=function(l,s,f){return l===void 0&&(l=0),s===void 0&&(s=0),f===void 0&&(f=!1),new xS((f?s:l)||0,(f?l:s)||0)},Dy=gs({devicePixelContentBoxSize:Ll(),borderBoxSize:Ll(),contentBoxSize:Ll(),contentRect:new v0(0,0,0,0)}),b0=function(l,s){if(s===void 0&&(s=!1),ld.has(l)&&!s)return ld.get(l);if(x0(l))return ld.set(l,Dy),Dy;var f=getComputedStyle(l),m=ym(l)&&l.ownerSVGElement&&l.getBBox(),x=!TS&&f.boxSizing==="border-box",T=wS.test(f.writingMode||""),k=!m&&Py.test(f.overflowY||""),o=!m&&Py.test(f.overflowX||""),N=m?0:Ro(f.paddingTop),U=m?0:Ro(f.paddingRight),V=m?0:Ro(f.paddingBottom),F=m?0:Ro(f.paddingLeft),Y=m?0:Ro(f.borderTopWidth),$=m?0:Ro(f.borderRightWidth),ye=m?0:Ro(f.borderBottomWidth),be=m?0:Ro(f.borderLeftWidth),Ue=F+U,Ge=N+V,S=be+$,we=Y+ye,Le=o?l.offsetHeight-we-l.clientHeight:0,Ze=k?l.offsetWidth-S-l.clientWidth:0,xe=x?Ue+S:0,Se=x?Ge+we:0,Re=m?m.width:Ro(f.width)-xe-Ze,Je=m?m.height:Ro(f.height)-Se-Le,ot=Re+Ue+Ze+S,st=Je+Ge+Le+we,wt=gs({devicePixelContentBoxSize:Ll(Math.round(Re*devicePixelRatio),Math.round(Je*devicePixelRatio),T),borderBoxSize:Ll(ot,st,T),contentBoxSize:Ll(Re,Je,T),contentRect:new v0(F,N,Re,Je)});return ld.set(l,wt),wt},w0=function(l,s,f){var m=b0(l,f),x=m.borderBoxSize,T=m.contentBoxSize,k=m.devicePixelContentBoxSize;switch(s){case bu.DEVICE_PIXEL_CONTENT_BOX:return k;case bu.BORDER_BOX:return x;default:return T}},SS=function(){function l(s){var f=b0(s);this.target=s,this.contentRect=f.contentRect,this.borderBoxSize=gs([f.borderBoxSize]),this.contentBoxSize=gs([f.contentBoxSize]),this.devicePixelContentBoxSize=gs([f.devicePixelContentBoxSize])}return l}(),T0=function(l){if(x0(l))return 1/0;for(var s=0,f=l.parentNode;f;)s+=1,f=f.parentNode;return s},ES=function(){var l=1/0,s=[];_s.forEach(function(k){if(k.activeTargets.length!==0){var o=[];k.activeTargets.forEach(function(U){var V=new SS(U.target),F=T0(U.target);o.push(V),U.lastReportedSize=w0(U.target,U.observedBox),F<l&&(l=F)}),s.push(function(){k.callback.call(k.observer,o,k.observer)}),k.activeTargets.splice(0,k.activeTargets.length)}});for(var f=0,m=s;f<m.length;f++){var x=m[f];x()}return l},Ly=function(l){_s.forEach(function(f){f.activeTargets.splice(0,f.activeTargets.length),f.skippedTargets.splice(0,f.skippedTargets.length),f.observationTargets.forEach(function(x){x.isActive()&&(T0(x.target)>l?f.activeTargets.push(x):f.skippedTargets.push(x))})})},AS=function(){var l=0;for(Ly(l);gS();)l=ES(),Ly(l);return yS()&&vS(),l>0},Sp,S0=[],CS=function(){return S0.splice(0).forEach(function(l){return l()})},MS=function(l){if(!Sp){var s=0,f=document.createTextNode(""),m={characterData:!0};new MutationObserver(function(){return CS()}).observe(f,m),Sp=function(){f.textContent=""+(s?s--:s++)}}S0.push(l),Sp()},IS=function(l){MS(function(){requestAnimationFrame(l)})},bd=0,kS=function(){return!!bd},zS=250,PS={attributes:!0,characterData:!0,childList:!0,subtree:!0},Ry=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],By=function(l){return l===void 0&&(l=0),Date.now()+l},Ep=!1,DS=function(){function l(){var s=this;this.stopped=!0,this.listener=function(){return s.schedule()}}return l.prototype.run=function(s){var f=this;if(s===void 0&&(s=zS),!Ep){Ep=!0;var m=By(s);IS(function(){var x=!1;try{x=AS()}finally{if(Ep=!1,s=m-By(),!kS())return;x?f.run(1e3):s>0?f.run(s):f.start()}})}},l.prototype.schedule=function(){this.stop(),this.run()},l.prototype.observe=function(){var s=this,f=function(){return s.observer&&s.observer.observe(document.body,PS)};document.body?f():_u.addEventListener("DOMContentLoaded",f)},l.prototype.start=function(){var s=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),Ry.forEach(function(f){return _u.addEventListener(f,s.listener,!0)}))},l.prototype.stop=function(){var s=this;this.stopped||(this.observer&&this.observer.disconnect(),Ry.forEach(function(f){return _u.removeEventListener(f,s.listener,!0)}),this.stopped=!0)},l}(),Jp=new DS,Oy=function(l){!bd&&l>0&&Jp.start(),bd+=l,!bd&&Jp.stop()},LS=function(l){return!ym(l)&&!bS(l)&&getComputedStyle(l).display==="inline"},RS=function(){function l(s,f){this.target=s,this.observedBox=f||bu.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return l.prototype.isActive=function(){var s=w0(this.target,this.observedBox,!0);return LS(this.target)&&(this.lastReportedSize=s),this.lastReportedSize.inlineSize!==s.inlineSize||this.lastReportedSize.blockSize!==s.blockSize},l}(),BS=function(){function l(s,f){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=s,this.callback=f}return l}(),cd=new WeakMap,Fy=function(l,s){for(var f=0;f<l.length;f+=1)if(l[f].target===s)return f;return-1},ud=function(){function l(){}return l.connect=function(s,f){var m=new BS(s,f);cd.set(s,m)},l.observe=function(s,f,m){var x=cd.get(s),T=x.observationTargets.length===0;Fy(x.observationTargets,f)<0&&(T&&_s.push(x),x.observationTargets.push(new RS(f,m&&m.box)),Oy(1),Jp.schedule())},l.unobserve=function(s,f){var m=cd.get(s),x=Fy(m.observationTargets,f),T=m.observationTargets.length===1;x>=0&&(T&&_s.splice(_s.indexOf(m),1),m.observationTargets.splice(x,1),Oy(-1))},l.disconnect=function(s){var f=this,m=cd.get(s);m.observationTargets.slice().forEach(function(x){return f.unobserve(s,x.target)}),m.activeTargets.splice(0,m.activeTargets.length)},l}(),OS=function(){function l(s){if(arguments.length===0)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if(typeof s!="function")throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");ud.connect(this,s)}return l.prototype.observe=function(s,f){if(arguments.length===0)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!zy(s))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");ud.observe(this,s,f)},l.prototype.unobserve=function(s){if(arguments.length===0)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!zy(s))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");ud.unobserve(this,s)},l.prototype.disconnect=function(){ud.disconnect(this)},l.toString=function(){return"function ResizeObserver () { [polyfill code] }"},l}();function hn(){return(hn=Object.assign||function(l){for(var s=1;s<arguments.length;s++){var f=arguments[s];for(var m in f)Object.prototype.hasOwnProperty.call(f,m)&&(l[m]=f[m])}return l}).apply(this,arguments)}function wd(l,s){if(l==null)return{};var f,m,x={},T=Object.keys(l);for(m=0;m<T.length;m++)s.indexOf(f=T[m])>=0||(x[f]=l[f]);return x}var gu=typeof window!="undefined"?xs:Jt;function Yc(l,s,f){return s=(s=+s)==s?s:0,f=(f=+f)==f?f:0,(l=+l)==l&&(l=(l=l<=f?l:f)>=s?l:s),l}function hd(l){var s=Math.round(l);if(Number.isNaN(l))throw new TypeError("Found a NaN! Check your snapPoints / defaultSnap / snapTo ");return s}var FS={box:"border-box"};function Ap(l,s){var f=s.label,m=s.enabled,x=s.resizeSourceRef,T=Ri(0),k=T[0],o=T[1];Xo(f+": "+k);var N=Yt(function(U){o(U[0].borderBoxSize[0].blockSize),x.current="element"},[x]);return gu(function(){if(l.current&&m){var U=new OS(N);return U.observe(l.current,FS),function(){U.disconnect()}}},[l,N,m]),m?k:0}function Yr(l){return l===void 0&&(l=1e3),new Promise(function(s){return setTimeout(s,l)})}var Uy={DRAG:{target:"#overlay.dragging",actions:"onOpenEnd"}},Vy={RESIZE:{target:"#overlay.resizing",actions:"onOpenEnd"}},US=h2({id:"overlay",initial:"closed",context:{initialState:"CLOSED"},states:{closed:{on:{OPEN:"opening",CLOSE:void 0}},opening:{initial:"start",states:{start:{invoke:{src:"onOpenStart",onDone:"transition"}},transition:{always:[{target:"immediately",cond:"initiallyOpen"},{target:"smoothly",cond:"initiallyClosed"}]},immediately:{initial:"open",states:{open:{invoke:{src:"openImmediately",onDone:"activating"}},activating:{invoke:{src:"activate",onDone:"#overlay.opening.end"},on:hn({},Uy,Vy)}}},smoothly:{initial:"visuallyHidden",states:{visuallyHidden:{invoke:{src:"renderVisuallyHidden",onDone:"activating"}},activating:{invoke:{src:"activate",onDone:"open"}},open:{invoke:{src:"openSmoothly",onDone:"#overlay.opening.end"},on:hn({},Uy,Vy)}}},end:{invoke:{src:"onOpenEnd",onDone:"done"},on:{CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:hn({},{CLOSE:{target:"#overlay.closing",actions:"onOpenCancel"}}),onDone:"open"},open:{on:{DRAG:"#overlay.dragging",SNAP:"snapping",RESIZE:"resizing"}},dragging:{on:{SNAP:"snapping"}},snapping:{initial:"start",states:{start:{invoke:{src:"onSnapStart",onDone:"snappingSmoothly"},entry:[d2({y:function(l,s){return s.payload.y},velocity:function(l,s){return s.payload.velocity},snapSource:function(l,s){var f=s.payload.source;return f===void 0?"custom":f}})]},snappingSmoothly:{invoke:{src:"snapSmoothly",onDone:"end"}},end:{invoke:{src:"onSnapEnd",onDone:"done"},on:{RESIZE:"#overlay.resizing",SNAP:"#overlay.snapping",CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:{SNAP:{target:"snapping",actions:"onSnapEnd"},RESIZE:{target:"#overlay.resizing",actions:"onSnapCancel"},DRAG:{target:"#overlay.dragging",actions:"onSnapCancel"},CLOSE:{target:"#overlay.closing",actions:"onSnapCancel"}},onDone:"open"},resizing:{initial:"start",states:{start:{invoke:{src:"onResizeStart",onDone:"resizingSmoothly"}},resizingSmoothly:{invoke:{src:"resizeSmoothly",onDone:"end"}},end:{invoke:{src:"onResizeEnd",onDone:"done"},on:{SNAP:"#overlay.snapping",CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:{RESIZE:{target:"resizing",actions:"onResizeEnd"},SNAP:{target:"snapping",actions:"onResizeCancel"},DRAG:{target:"#overlay.dragging",actions:"onResizeCancel"},CLOSE:{target:"#overlay.closing",actions:"onResizeCancel"}},onDone:"open"},closing:{initial:"start",states:{start:{invoke:{src:"onCloseStart",onDone:"deactivating"},on:{OPEN:{target:"#overlay.open",actions:"onCloseCancel"}}},deactivating:{invoke:{src:"deactivate",onDone:"closingSmoothly"}},closingSmoothly:{invoke:{src:"closeSmoothly",onDone:"end"}},end:{invoke:{src:"onCloseEnd",onDone:"done"},on:{OPEN:{target:"#overlay.opening",actions:"onCloseCancel"}}},done:{type:"final"}},on:{CLOSE:void 0,OPEN:{target:"#overlay.opening",actions:"onCloseCancel"}},onDone:"closed"}},on:{CLOSE:"closing"}},{actions:{onOpenCancel:function(l,s){},onSnapCancel:function(l,s){},onResizeCancel:function(l,s){},onCloseCancel:function(l,s){},onOpenEnd:function(l,s){},onSnapEnd:function(l,s){},onRezizeEnd:function(l,s){}},services:{onSnapStart:function(){try{return Promise.resolve(Yr()).then(function(){})}catch(l){return Promise.reject(l)}},onOpenStart:function(){try{return Promise.resolve(Yr()).then(function(){})}catch(l){return Promise.reject(l)}},onCloseStart:function(){try{return Promise.resolve(Yr()).then(function(){})}catch(l){return Promise.reject(l)}},onResizeStart:function(){try{return Promise.resolve(Yr()).then(function(){})}catch(l){return Promise.reject(l)}},onSnapEnd:function(){try{return Promise.resolve(Yr()).then(function(){})}catch(l){return Promise.reject(l)}},onOpenEnd:function(){try{return Promise.resolve(Yr()).then(function(){})}catch(l){return Promise.reject(l)}},onCloseEnd:function(){try{return Promise.resolve(Yr()).then(function(){})}catch(l){return Promise.reject(l)}},onResizeEnd:function(){try{return Promise.resolve(Yr()).then(function(){})}catch(l){return Promise.reject(l)}},renderVisuallyHidden:function(l,s){try{return Promise.resolve(Yr()).then(function(){})}catch(f){return Promise.reject(f)}},activate:function(l,s){try{return Promise.resolve(Yr()).then(function(){})}catch(f){return Promise.reject(f)}},deactivate:function(l,s){try{return Promise.resolve(Yr()).then(function(){})}catch(f){return Promise.reject(f)}},openSmoothly:function(l,s){try{return Promise.resolve(Yr()).then(function(){})}catch(f){return Promise.reject(f)}},openImmediately:function(l,s){try{return Promise.resolve(Yr()).then(function(){})}catch(f){return Promise.reject(f)}},snapSmoothly:function(l,s){try{return Promise.resolve(Yr()).then(function(){})}catch(f){return Promise.reject(f)}},resizeSmoothly:function(l,s){try{return Promise.resolve(Yr()).then(function(){})}catch(f){return Promise.reject(f)}},closeSmoothly:function(l,s){try{return Promise.resolve(Yr()).then(function(){})}catch(f){return Promise.reject(f)}}},guards:{initiallyClosed:function(l){return l.initialState==="CLOSED"},initiallyOpen:function(l){return l.initialState==="OPEN"}}}),VS=["children","sibling","className","footer","header","open","initialState","lastSnapRef","initialFocusRef","onDismiss","maxHeight","defaultSnap","snapPoints","blocking","scrollLocking","style","onSpringStart","onSpringCancel","onSpringEnd","reserveScrollBarGap","expandOnContentDrag"],NS=["velocity"],jS=["onRest","config"],E0=F2.default,GS=E0.tension,dd=E0.friction,$S=Cn.forwardRef(function(l,s){var f=l.children,m=l.sibling,x=l.className,T=l.footer,k=l.header,o=l.open,N=l.initialState,U=l.lastSnapRef,V=l.initialFocusRef,F=l.onDismiss,Y=l.maxHeight,$=l.defaultSnap,ye=$===void 0?qS:$,be=l.snapPoints,Ue=be===void 0?WS:be,Ge=l.blocking,S=Ge===void 0||Ge,we=l.scrollLocking,Le=we===void 0||we,Ze=l.style,xe=l.onSpringStart,Se=l.onSpringCancel,Re=l.onSpringEnd,Je=l.reserveScrollBarGap,ot=Je===void 0?S:Je,st=l.expandOnContentDrag,wt=st!==void 0&&st,ai=wd(l,VS),vi=function(){var Ne=Ri(!1),bt=Ne[0],et=Ne[1],zt=Ri({}),xi=zt[0],Ut=zt[1],di=Yt(function(fi){return Ut(function(pi){var Ct;return hn({},pi,((Ct={})[fi]=!1,Ct))}),function(){Ut(function(pi){var Ct;return hn({},pi,((Ct={})[fi]=!0,Ct))})}},[]);return Jt(function(){var fi=Object.values(xi);fi.length!==0&&fi.every(Boolean)&&et(!0)},[xi]),{ready:bt,registerReady:di}}(),Ft=vi.ready,Vi=vi.registerReady,Dt=vt(!1),kt=vt(xe),ui=vt(Se),Di=vt(Re);Jt(function(){kt.current=xe,ui.current=Se,Di.current=Re},[Se,xe,Re]);var At,hi,cr=G2(function(){return{y:0,ready:0,maxHeight:0,minSnap:0,maxSnap:0}}),yr=cr[0],Gn=cr[1],tn=vt(null),mr=vt(null),Pn=vt(null),$n=vt(null),Dn=vt(null),Ln=vt(null),tr=vt(0),Or=vt(),Et=vt(!1),Zi=(At=Gr(function(){return typeof window!="undefined"?window.matchMedia("(prefers-reduced-motion: reduce)"):null},[]),hi=vt(At==null?void 0:At.matches),Xo(hi.current?"reduce":"no-preference"),Jt(function(){var Ne=function(bt){hi.current=bt.matches};return At==null||At.addListener(Ne),function(){return At==null?void 0:At.removeListener(Ne)}},[At]),hi),vr=function(Ne){var bt=Ne.targetRef,et=Ne.enabled,zt=Ne.reserveScrollBarGap,xi=vt({activate:function(){throw new TypeError("Tried to activate scroll lock too early")},deactivate:function(){}});return Xo(et?"Enabled":"Disabled"),Jt(function(){if(!et)return xi.current.deactivate(),void(xi.current={activate:function(){},deactivate:function(){}});var Ut=bt.current,di=!1;xi.current={activate:function(){di||(di=!0,mS(Ut,{allowTouchMove:function(fi){return fi.closest("[data-body-scroll-lock-ignore]")},reserveScrollBarGap:zt}))},deactivate:function(){di&&(di=!1,_S(Ut))}}},[et,bt,zt]),xi}({targetRef:mr,enabled:Ft&&Le,reserveScrollBarGap:ot}),Dr=function(Ne){var bt=Ne.targetRef,et=Ne.enabled,zt=vt({activate:function(){throw new TypeError("Tried to activate aria hider too early")},deactivate:function(){}});return Xo(et?"Enabled":"Disabled"),Jt(function(){if(!et)return zt.current.deactivate(),void(zt.current={activate:function(){},deactivate:function(){}});var xi=bt.current,Ut=!1,di=[],fi=[];zt.current={activate:function(){if(!Ut){Ut=!0;var pi=xi.parentNode;document.querySelectorAll("body > *").forEach(function(Ct){if(Ct!==pi){var $t=Ct.getAttribute("aria-hidden");$t!==null&&$t!=="false"||(di.push($t),fi.push(Ct),Ct.setAttribute("aria-hidden","true"))}})}},deactivate:function(){Ut&&(Ut=!1,fi.forEach(function(pi,Ct){var $t=di[Ct];$t===null?pi.removeAttribute("aria-hidden"):pi.setAttribute("aria-hidden",$t)}),di=[],fi=[])}}},[bt,et]),zt}({targetRef:tn,enabled:Ft&&S}),$r=function(Ne){var bt=Ne.targetRef,et=Ne.fallbackRef,zt=Ne.initialFocusRef,xi=Ne.enabled,Ut=vt({activate:function(){throw new TypeError("Tried to activate focus trap too early")},deactivate:function(){}});return Xo(xi?"Enabled":"Disabled"),Jt(function(){if(!xi)return Ut.current.deactivate(),void(Ut.current={activate:function(){},deactivate:function(){}});var di=et.current,fi=cS(bt.current,{onActivate:void 0,initialFocus:zt?function(){return(zt==null?void 0:zt.current)||di}:void 0,fallbackFocus:di,escapeDeactivates:!1,clickOutsideDeactivates:!1}),pi=!1;Ut.current={activate:function(){try{return pi?Promise.resolve():(pi=!0,Promise.resolve(fi.activate()).then(function(){return Promise.resolve(new Promise(function(Ct){return setTimeout(function(){return Ct(void 0)},0)})).then(function(){})}))}catch(Ct){return Promise.reject(Ct)}},deactivate:function(){pi&&(pi=!1,fi.deactivate())}}},[xi,et,zt,bt]),Ut}({targetRef:tn,fallbackRef:Ln,initialFocusRef:V||void 0,enabled:Ft&&S&&V!==!1}),pn=function(Ne){var bt=Ne.getSnapPoints,et=Ne.heightRef,zt=Ne.lastSnapRef,xi=Ne.ready,Ut=function(J){var D=J.contentRef,O=J.controlledMaxHeight,H=J.footerEnabled,ee=J.footerRef,le=J.headerEnabled,he=J.headerRef,fe=J.registerReady,ue=J.resizeSourceRef,_e=Gr(function(){return fe("contentHeight")},[fe]),Me=function(mt,Lt,mi){var bi=Gr(function(){return Lt("maxHeight")},[Lt]),gi=Ri(function(){return hd(mt)||typeof window!="undefined"?window.innerHeight:0}),Ci=gi[0],mn=gi[1],_n=Ci>0,Yi=vt(0);return Xo(mt?"controlled":"auto"),Jt(function(){_n&&bi()},[_n,bi]),gu(function(){if(mt)return mn(hd(mt)),void(mi.current="maxheightprop");var nn=function(){Yi.current||(Yi.current=requestAnimationFrame(function(){mn(window.innerHeight),mi.current="window",Yi.current=0}))};return window.addEventListener("resize",nn),mn(window.innerHeight),mi.current="window",bi(),function(){window.removeEventListener("resize",nn),cancelAnimationFrame(Yi.current)}},[mt,bi,mi]),Ci}(O,fe,ue),Pe=Ap(he,{label:"headerHeight",enabled:le,resizeSourceRef:ue}),Fe=Ap(D,{label:"contentHeight",enabled:!0,resizeSourceRef:ue}),ht=Ap(ee,{label:"footerHeight",enabled:H,resizeSourceRef:ue}),ft=Math.min(Me-Pe-ht,Fe)+Pe+ht;Xo("minHeight: "+ft);var pt=Fe>0;return Jt(function(){pt&&_e()},[pt,_e]),{maxHeight:Me,minHeight:ft,headerHeight:Pe,footerHeight:ht}}({contentRef:Ne.contentRef,controlledMaxHeight:Ne.controlledMaxHeight,footerEnabled:Ne.footerEnabled,footerRef:Ne.footerRef,headerEnabled:Ne.headerEnabled,headerRef:Ne.headerRef,registerReady:Ne.registerReady,resizeSourceRef:Ne.resizeSourceRef}),di=Ut.maxHeight,fi=Ut.minHeight,pi=Ut.headerHeight,Ct=Ut.footerHeight,$t=function(J,D){var O=[].concat(J).map(hd).reduce(function(he,fe){return he.add(Yc(fe,0,D)),he},new Set),H=Array.from(O),ee=Math.min.apply(Math,H);if(Number.isNaN(ee))throw new TypeError("minSnap is NaN");var le=Math.max.apply(Math,H);if(Number.isNaN(le))throw new TypeError("maxSnap is NaN");return{snapPoints:H,minSnap:ee,maxSnap:le}}(xi?bt({height:et.current,footerHeight:Ct,headerHeight:pi,minHeight:fi,maxHeight:di}):[0],di),qi=$t.snapPoints,rn=$t.minSnap,ji=$t.maxSnap;return Xo("minSnap: "+rn+", maxSnap:"+ji),{minSnap:rn,maxSnap:ji,findSnap:function(J){var D=hd(typeof J=="function"?J({footerHeight:Ct,headerHeight:pi,height:et.current,minHeight:fi,maxHeight:di,snapPoints:qi,lastSnap:zt.current}):J);return qi.reduce(function(O,H){return Math.abs(H-D)<Math.abs(O-D)?H:O},rn)},maxHeight:di}}({contentRef:Pn,controlledMaxHeight:Y,footerEnabled:!!T,footerRef:Dn,getSnapPoints:Ue,headerEnabled:k!==!1,headerRef:$n,heightRef:tr,lastSnapRef:U,ready:Ft,registerReady:Vi,resizeSourceRef:Or}),Nt=pn.minSnap,Mr=pn.maxSnap,xr=pn.maxHeight,Fr=pn.findSnap,_r=vt(xr),Gt=vt(Nt),Ai=vt(Mr),He=vt(Fr),rt=vt(0);gu(function(){_r.current=xr,Ai.current=Mr,Gt.current=Nt,He.current=Fr,rt.current=Fr(ye)},[Fr,ye,xr,Mr,Nt]);var xt=Yt(function(Ne){var bt=Ne.onRest,et=Ne.config,zt=(et=et===void 0?{}:et).velocity,xi=zt===void 0?1:zt,Ut=wd(et,NS),di=wd(Ne,jS);return new Promise(function(fi){return Gn(hn({},di,{config:hn({velocity:xi},Ut,{mass:1,tension:GS,friction:Math.max(dd,dd+(dd-dd*xi))}),onRest:function(){var pi=[].slice.call(arguments);fi.apply(void 0,pi),bt==null||bt.apply(void 0,pi)}}))})},[Gn]),Ht=b2(US,{devTools:!1,actions:{onOpenCancel:Yt(function(){return ui.current==null?void 0:ui.current({type:"OPEN"})},[]),onSnapCancel:Yt(function(Ne){return ui.current==null?void 0:ui.current({type:"SNAP",source:Ne.snapSource})},[]),onCloseCancel:Yt(function(){return ui.current==null?void 0:ui.current({type:"CLOSE"})},[]),onResizeCancel:Yt(function(){return ui.current==null?void 0:ui.current({type:"RESIZE",source:Or.current})},[]),onOpenEnd:Yt(function(){return Di.current==null?void 0:Di.current({type:"OPEN"})},[]),onSnapEnd:Yt(function(Ne,bt){return Di.current==null?void 0:Di.current({type:"SNAP",source:Ne.snapSource})},[]),onResizeEnd:Yt(function(){return Di.current==null?void 0:Di.current({type:"RESIZE",source:Or.current})},[])},context:{initialState:N},services:{onSnapStart:Yt(function(Ne,bt){try{return Promise.resolve(kt.current==null?void 0:kt.current({type:"SNAP",source:bt.payload.source||"custom"}))}catch(et){return Promise.reject(et)}},[]),onOpenStart:Yt(function(){try{return Promise.resolve(kt.current==null?void 0:kt.current({type:"OPEN"}))}catch(Ne){return Promise.reject(Ne)}},[]),onCloseStart:Yt(function(){try{return Promise.resolve(kt.current==null?void 0:kt.current({type:"CLOSE"}))}catch(Ne){return Promise.reject(Ne)}},[]),onResizeStart:Yt(function(){try{return Promise.resolve(kt.current==null?void 0:kt.current({type:"RESIZE",source:Or.current}))}catch(Ne){return Promise.reject(Ne)}},[]),onSnapEnd:Yt(function(Ne,bt){try{return Promise.resolve(Di.current==null?void 0:Di.current({type:"SNAP",source:Ne.snapSource}))}catch(et){return Promise.reject(et)}},[]),onOpenEnd:Yt(function(){try{return Promise.resolve(Di.current==null?void 0:Di.current({type:"OPEN"}))}catch(Ne){return Promise.reject(Ne)}},[]),onCloseEnd:Yt(function(){try{return Promise.resolve(Di.current==null?void 0:Di.current({type:"CLOSE"}))}catch(Ne){return Promise.reject(Ne)}},[]),onResizeEnd:Yt(function(){try{return Promise.resolve(Di.current==null?void 0:Di.current({type:"RESIZE",source:Or.current}))}catch(Ne){return Promise.reject(Ne)}},[]),renderVisuallyHidden:Yt(function(Ne,bt){try{return Promise.resolve(xt({y:rt.current,ready:0,maxHeight:_r.current,maxSnap:Ai.current,minSnap:rt.current,immediate:!0})).then(function(){})}catch(et){return Promise.reject(et)}},[xt]),activate:Yt(function(Ne,bt){try{return Dt.current=!0,Promise.resolve(Promise.all([vr.current.activate(),$r.current.activate(),Dr.current.activate()])).then(function(){})}catch(et){return Promise.reject(et)}},[Dr,$r,vr]),deactivate:Yt(function(){try{return vr.current.deactivate(),$r.current.deactivate(),Dr.current.deactivate(),Dt.current=!1,Promise.resolve()}catch(Ne){return Promise.reject(Ne)}},[Dr,$r,vr]),openImmediately:Yt(function(){try{return tr.current=rt.current,Promise.resolve(xt({y:rt.current,ready:1,maxHeight:_r.current,maxSnap:Ai.current,minSnap:rt.current,immediate:!0})).then(function(){})}catch(Ne){return Promise.reject(Ne)}},[xt]),openSmoothly:Yt(function(){try{return Promise.resolve(xt({y:0,ready:1,maxHeight:_r.current,maxSnap:Ai.current,minSnap:rt.current,immediate:!0})).then(function(){return tr.current=rt.current,Promise.resolve(xt({y:rt.current,ready:1,maxHeight:_r.current,maxSnap:Ai.current,minSnap:rt.current,immediate:Zi.current})).then(function(){})})}catch(Ne){return Promise.reject(Ne)}},[xt,Zi]),snapSmoothly:Yt(function(Ne,bt){try{var et=He.current(Ne.y);return tr.current=et,U.current=et,Promise.resolve(xt({y:et,ready:1,maxHeight:_r.current,maxSnap:Ai.current,minSnap:Gt.current,immediate:Zi.current,config:{velocity:Ne.velocity}})).then(function(){})}catch(zt){return Promise.reject(zt)}},[xt,U,Zi]),resizeSmoothly:Yt(function(){try{var Ne=He.current(tr.current);return tr.current=Ne,U.current=Ne,Promise.resolve(xt({y:Ne,ready:1,maxHeight:_r.current,maxSnap:Ai.current,minSnap:Gt.current,immediate:Or.current!=="element"||Zi.current})).then(function(){})}catch(bt){return Promise.reject(bt)}},[xt,U,Zi]),closeSmoothly:Yt(function(Ne,bt){try{return xt({minSnap:tr.current,immediate:!0}),tr.current=0,Promise.resolve(xt({y:0,maxHeight:_r.current,maxSnap:Ai.current,immediate:Zi.current})).then(function(){return Promise.resolve(xt({ready:0,immediate:!0})).then(function(){})})}catch(et){return Promise.reject(et)}},[xt,Zi])}}),Xt=Ht[0],Ni=Ht[1];Jt(function(){Ft&&Ni(o?"OPEN":"CLOSE")},[o,Ni,Ft]),gu(function(){(xr||Mr||Nt)&&Ni("RESIZE")},[xr,Mr,Nt,Ni]),Jt(function(){return function(){vr.current.deactivate(),$r.current.deactivate(),Dr.current.deactivate()}},[Dr,$r,vr]),Nl(s,function(){return{snapTo:function(Ne,bt){var et=bt===void 0?{}:bt,zt=et.velocity,xi=zt===void 0?1:zt,Ut=et.source,di=Ut===void 0?"custom":Ut;Ni("SNAP",{payload:{y:He.current(Ne),velocity:xi,source:di}})},get height(){return tr.current}}},[Ni]),Jt(function(){var Ne=mr.current,bt=function(zt){Et.current&&zt.preventDefault()},et=function(zt){Ne.scrollTop<0&&(requestAnimationFrame(function(){Ne.style.overflow="hidden",Ne.scrollTop=0,Ne.style.removeProperty("overflow")}),zt.preventDefault())};return wt&&(Ne.addEventListener("scroll",bt),Ne.addEventListener("touchmove",bt),Ne.addEventListener("touchstart",et)),function(){Ne.removeEventListener("scroll",bt),Ne.removeEventListener("touchmove",bt),Ne.removeEventListener("touchstart",et)}},[wt,mr]);var ir=$T(function(Ne){var bt=Ne.args,et=(bt=bt===void 0?[]:bt)[0],zt=(et=et===void 0?{}:et).closeOnTap,xi=zt!==void 0&&zt,Ut=et.isContentDragging,di=Ut!==void 0&&Ut,fi=Ne.cancel,pi=Ne.direction[1],Ct=Ne.down,$t=Ne.first,qi=Ne.last,rn=Ne.memo,ji=rn===void 0?yr.y.getValue():rn,J=Ne.tap,D=Ne.velocity,O=-1*Ne.movement[1];if(!Dt.current)return fi(),ji;if(F&&xi&&J)return fi(),setTimeout(function(){return F()},0),ji;if(J)return ji;var H=ji+O,ee=O*D,le=Math.max(Gt.current,Math.min(Ai.current,H+2*ee));if(!Ct&&F&&pi>0&&H+ee<Gt.current/2)return fi(),F(),ji;var he=Ct?F||Gt.current!==Ai.current?fu(H,F?0:Gt.current,Ai.current,.55):H<Gt.current?fu(H,Gt.current,2*Ai.current,.55):fu(H,Gt.current/2,Ai.current,.55):le;return wt&&di?(he>=Ai.current&&(he=Ai.current),ji===Ai.current&&mr.current.scrollTop>0&&(he=Ai.current),Et.current=he<Ai.current):Et.current=!1,$t&&Ni("DRAG"),qi?(Ni("SNAP",{payload:{y:he,velocity:D>.05?D:1,source:"dragging"}}),ji):(Gn({y:he,ready:1,maxHeight:_r.current,maxSnap:Ai.current,minSnap:Gt.current,immediate:!0,config:{velocity:D}}),ji)},{filterTaps:!0});if(Number.isNaN(Ai.current))throw new TypeError("maxSnapRef is NaN!!");if(Number.isNaN(Gt.current))throw new TypeError("minSnapRef is NaN!!");var Lr=function(Ne){var bt,et=Ne.spring,zt=Ml([et.y,et.maxHeight],function(Ct,$t){return Math.round(Yc($t-Ct,0,16))+"px"}),xi=Ml([et.y,et.minSnap,et.maxSnap],function(Ct,$t,qi){return Yc(Ct,$t,qi)+"px"}),Ut=Ml([et.y,et.minSnap,et.maxSnap],function(Ct,$t,qi){return Ct<$t?$t-Ct+"px":Ct>qi?qi-Ct+"px":"0px"}),di=Ml([et.y,et.maxSnap],function(Ct,$t){return Ct>=$t?Math.ceil(Ct-$t):0}),fi=Ml([et.y,et.minSnap],function(Ct,$t){if(!$t)return 0;var qi=Math.max($t/2-45,0);return Yc((Ct-qi)*(1/(Math.min($t/2+45,$t)-qi)+0),0,1)}),pi=Ml([et.y,et.minSnap],function(Ct,$t){return $t?Yc(Ct/$t,0,1):0});return(bt={})["--rsbs-content-opacity"]=fi,bt["--rsbs-backdrop-opacity"]=pi,bt["--rsbs-antigap-scale-y"]=di,bt["--rsbs-overlay-translate-y"]=Ut,bt["--rsbs-overlay-rounded"]=zt,bt["--rsbs-overlay-h"]=xi,bt}({spring:yr});return Cn.createElement(lT.div,hn({},ai,{"data-rsbs-root":!0,"data-rsbs-state":ZS.find(Xt.matches),"data-rsbs-is-blocking":S,"data-rsbs-is-dismissable":!!F,"data-rsbs-has-header":!!k,"data-rsbs-has-footer":!!T,className:x,ref:tn,style:hn({},Lr,Ze,{opacity:yr.ready})}),m,S&&Cn.createElement("div",hn({key:"backdrop","data-rsbs-backdrop":!0},ir({closeOnTap:!0}))),Cn.createElement("div",{key:"overlay","aria-modal":"true",role:"dialog","data-rsbs-overlay":!0,tabIndex:-1,ref:Ln,onKeyDown:function(Ne){Ne.key==="Escape"&&(Ne.stopPropagation(),F&&F())}},k!==!1&&Cn.createElement("div",hn({key:"header","data-rsbs-header":!0,ref:$n},ir()),k),Cn.createElement("div",hn({key:"scroll","data-rsbs-scroll":!0,ref:mr},wt?ir({isContentDragging:!0}):{}),Cn.createElement("div",{"data-rsbs-content":!0,ref:Pn},f)),T&&Cn.createElement("div",hn({key:"footer",ref:Dn,"data-rsbs-footer":!0},ir()),T)))}),ZS=["closed","opening","open","closing","dragging","snapping","resizing"];function qS(l){var s=l.lastSnap;return s!=null?s:Math.min.apply(Math,l.snapPoints)}function WS(l){return l.minHeight}var HS=["onSpringStart","onSpringEnd","skipInitialTransition"],fd=Su(function(l,s){var f=l.onSpringStart,m=l.onSpringEnd,x=l.skipInitialTransition,T=wd(l,HS),k=Ri(!1),o=k[0],N=k[1],U=vt(),V=vt(null),F=vt(x&&T.open?"OPEN":"CLOSED");gu(function(){if(T.open)return cancelAnimationFrame(U.current),N(!0),function(){F.current="CLOSED"}},[T.open]);var Y=Yt(function(ye){try{return Promise.resolve(f==null?void 0:f(ye)).then(function(){ye.type==="OPEN"&&cancelAnimationFrame(U.current)})}catch(be){return Promise.reject(be)}},[f]),$=Yt(function(ye){try{return Promise.resolve(m==null?void 0:m(ye)).then(function(){ye.type==="CLOSE"&&(U.current=requestAnimationFrame(function(){return N(!1)}))})}catch(be){return Promise.reject(be)}},[m]);return o?Cn.createElement(yw,{"data-rsbs-portal":!0},Cn.createElement($S,hn({},T,{lastSnapRef:V,ref:s,initialState:F.current,onSpringStart:Y,onSpringEnd:$}))):null});function In(l,s){if(!s)return l;var f=+(Math.round(l+"e+2")+"e-2"),m=f.toString().split(".");return m[0]=m[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),m.join(".")}function kn(l,s){if(l!==s){var f=l==="area"?"an area measurement to a length measurement":"a length measurement to an area measurement";throw new Error(`Invalid conversion. You are trying to convert ${f}.`)}}var zn={km:.001,km2:1e-6,hm:.01,hm2:1e-4,dam:.1,dam2:.01,m:1,m2:1,dm:10,dm2:100,cm:100,cm2:1e4,mm:1e3,mm2:1e6},Qp={km:{value:1e3,category:"length"},km2:{value:1e6,category:"area"},hm:{value:100,category:"length"},hm2:{value:1e4,category:"area"},dam:{value:10,category:"length"},dam2:{value:100,category:"area"},m:{value:1,category:"length"},m2:{value:1,category:"area"},dm:{value:.1,category:"length"},dm2:{value:.01,category:"area"},cm:{value:.01,category:"length"},cm2:{value:1e-4,category:"area"},mm:{value:.001,category:"length"},mm2:{value:1e-6,category:"area"}};function Pr(l){if(!(this instanceof Pr))return new Pr(l);this.value=l===0?0:l||1,this.type=Qp.m}Pr.prototype.input=function(l){if(!l in Qp)throw new Error("type "+l+" is not valid");return this.type=Qp[l],this};Pr.prototype.km=function(){return kn(this.type.category,"length"),In(this.value*this.type.value*zn.km,this.prettify)+"km"};Pr.prototype.km2=function(){return kn(this.type.category,"area"),In(this.value*this.type.value*zn.km2,this.prettify)+"km2"};Pr.prototype.hm=function(){return kn(this.type.category,"length"),In(this.value*this.type.value*zn.hm,this.prettify)+"hm"};Pr.prototype.hm2=function(){return kn(this.type.category,"area"),In(this.value*this.type.value*zn.hm2,this.prettify)+"hm2"};Pr.prototype.dam=function(){return kn(this.type.category,"length"),In(this.value*this.type.value*zn.dam,this.prettify)+"dam"};Pr.prototype.dam2=function(){return kn(this.type.category,"area"),In(this.value*this.type.value*zn.dam2,this.prettify)+"dam2"};Pr.prototype.m=function(){return kn(this.type.category,"length"),In(this.value*this.type.value*zn.m,this.prettify)+"m"};Pr.prototype.m2=function(){return kn(this.type.category,"area"),In(this.value*this.type.value*zn.m2,this.prettify)+"m2"};Pr.prototype.dm=function(){return kn(this.type.category,"length"),In(this.value*this.type.value*zn.dm,this.prettify)+"dm"};Pr.prototype.dm2=function(){return kn(this.type.category,"area"),In(this.value*this.type.value*zn.dm2,this.prettify)+"dm2"};Pr.prototype.cm=function(){return kn(this.type.category,"length"),In(this.value*this.type.value*zn.cm,this.prettify)+"cm"};Pr.prototype.cm2=function(){return kn(this.type.category,"area"),In(this.value*this.type.value*zn.cm2,this.prettify)+"cm2"};Pr.prototype.mm=function(){return kn(this.type.category,"length"),In(this.value*this.type.value*zn.mm,this.prettify)+"mm"};Pr.prototype.mm2=function(){return kn(this.type.category,"area"),In(this.value*this.type.value*zn.mm2,this.prettify)+"mm2"};Pr.prototype.humanize=function(){var l=this.type.value*this.value,s=this.type.category;return this.prettify=!0,s==="area"?l>=1e6?this.km2():l>=1?this.m2():l>=.5?this.m2():l>=.1?this.cm2():this.mm2():l>=1e3?this.km():l>=1?this.m():l>=.5?this.m():l>=.1?this.cm():this.mm()};var XS=Pr;function $l(l,s){if(!s)return l;var f=+(Math.round(l+"e+2")+"e-2"),m=f.toString().split(".");return m[0]=m[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),m.join(".")}function Zl(l,s){if(l!==s){var f=l==="area"?"an area measurement to a length measurement":"a length measurement to an area measurement";throw new Error(`Invalid conversion. You are trying to convert ${f}.`)}}var ql={mi:189394e-9,mi2:3587e-11,ft:1,ft2:1,in:12,in2:144},em={mi:{value:5280,category:"length"},mi2:{value:2788e4,category:"area"},ft:{value:1,category:"length"},ft2:{value:1,category:"area"},in:{value:.08333336,category:"length"},in2:{value:.00694444,category:"area"}};function _o(l){if(!(this instanceof _o))return new _o(l);this.value=l===0?0:l||1,this.type=em.ft}_o.prototype.input=function(l){if(!l in em)throw new Error("type "+l+" is not valid");return this.type=em[l],this};_o.prototype.mi=function(){return Zl(this.type.category,"length"),$l(this.value*this.type.value*ql.mi,this.prettify)+"mi"};_o.prototype.mi2=function(){return Zl(this.type.category,"area"),$l(this.value*this.type.value*ql.mi2,this.prettify)+"mi2"};_o.prototype.ft=function(){return Zl(this.type.category,"length"),$l(this.value*this.type.value*ql.ft,this.prettify)+"ft"};_o.prototype.ft2=function(){return Zl(this.type.category,"area"),$l(this.value*this.type.value*ql.ft2,this.prettify)+"ft2"};_o.prototype.in=function(){return Zl(this.type.category,"length"),$l(this.value*this.type.value*ql.in,this.prettify)+"in"};_o.prototype.in2=function(){return Zl(this.type.category,"area"),$l(this.value*this.type.value*ql.in2,this.prettify)+"in2"};_o.prototype.humanize=function(){var l=this.type.value*this.value,s=this.type.category;return this.prettify=!0,s==="area"?l>=2788e4?this.mi2():l>=.999?this.ft2():this.in2():l>=5280?this.mi():l>=1?this.ft():this.in()};var KS=_o,A0={exports:{}};(function(l){(function(){var s={y:function(S){return S===1?"\u03C7\u03C1\u03CC\u03BD\u03BF\u03C2":"\u03C7\u03C1\u03CC\u03BD\u03B9\u03B1"},mo:function(S){return S===1?"\u03BC\u03AE\u03BD\u03B1\u03C2":"\u03BC\u03AE\u03BD\u03B5\u03C2"},w:function(S){return S===1?"\u03B5\u03B2\u03B4\u03BF\u03BC\u03AC\u03B4\u03B1":"\u03B5\u03B2\u03B4\u03BF\u03BC\u03AC\u03B4\u03B5\u03C2"},d:function(S){return S===1?"\u03BC\u03AD\u03C1\u03B1":"\u03BC\u03AD\u03C1\u03B5\u03C2"},h:function(S){return S===1?"\u03CE\u03C1\u03B1":"\u03CE\u03C1\u03B5\u03C2"},m:function(S){return S===1?"\u03BB\u03B5\u03C0\u03C4\u03CC":"\u03BB\u03B5\u03C0\u03C4\u03AC"},s:function(S){return S===1?"\u03B4\u03B5\u03C5\u03C4\u03B5\u03C1\u03CC\u03BB\u03B5\u03C0\u03C4\u03BF":"\u03B4\u03B5\u03C5\u03C4\u03B5\u03C1\u03CC\u03BB\u03B5\u03C0\u03C4\u03B1"},ms:function(S){return S===1?"\u03C7\u03B9\u03BB\u03B9\u03BF\u03C3\u03C4\u03CC \u03C4\u03BF\u03C5 \u03B4\u03B5\u03C5\u03C4\u03B5\u03C1\u03BF\u03BB\u03AD\u03C0\u03C4\u03BF\u03C5":"\u03C7\u03B9\u03BB\u03B9\u03BF\u03C3\u03C4\u03AC \u03C4\u03BF\u03C5 \u03B4\u03B5\u03C5\u03C4\u03B5\u03C1\u03BF\u03BB\u03AD\u03C0\u03C4\u03BF\u03C5"},decimal:","},f=["\u06F0","\u0661","\u0662","\u0663","\u0664","\u0665","\u0666","\u0667","\u0668","\u0669"],m={af:{y:"jaar",mo:function(S){return"maand"+(S===1?"":"e")},w:function(S){return S===1?"week":"weke"},d:function(S){return S===1?"dag":"dae"},h:function(S){return S===1?"uur":"ure"},m:function(S){return S===1?"minuut":"minute"},s:function(S){return"sekonde"+(S===1?"":"s")},ms:function(S){return"millisekonde"+(S===1?"":"s")},decimal:","},ar:{y:function(S){return["\u0633\u0646\u0629","\u0633\u0646\u062A\u0627\u0646","\u0633\u0646\u0648\u0627\u062A"][V(S)]},mo:function(S){return["\u0634\u0647\u0631","\u0634\u0647\u0631\u0627\u0646","\u0623\u0634\u0647\u0631"][V(S)]},w:function(S){return["\u0623\u0633\u0628\u0648\u0639","\u0623\u0633\u0628\u0648\u0639\u064A\u0646","\u0623\u0633\u0627\u0628\u064A\u0639"][V(S)]},d:function(S){return["\u064A\u0648\u0645","\u064A\u0648\u0645\u064A\u0646","\u0623\u064A\u0627\u0645"][V(S)]},h:function(S){return["\u0633\u0627\u0639\u0629","\u0633\u0627\u0639\u062A\u064A\u0646","\u0633\u0627\u0639\u0627\u062A"][V(S)]},m:function(S){return["\u062F\u0642\u064A\u0642\u0629","\u062F\u0642\u064A\u0642\u062A\u0627\u0646","\u062F\u0642\u0627\u0626\u0642"][V(S)]},s:function(S){return["\u062B\u0627\u0646\u064A\u0629","\u062B\u0627\u0646\u064A\u062A\u0627\u0646","\u062B\u0648\u0627\u0646\u064A"][V(S)]},ms:function(S){return["\u062C\u0632\u0621 \u0645\u0646 \u0627\u0644\u062B\u0627\u0646\u064A\u0629","\u062C\u0632\u0622\u0646 \u0645\u0646 \u0627\u0644\u062B\u0627\u0646\u064A\u0629","\u0623\u062C\u0632\u0627\u0621 \u0645\u0646 \u0627\u0644\u062B\u0627\u0646\u064A\u0629"][V(S)]},decimal:",",delimiter:" \u0648 ",_formatCount:function(S,we){for(var Le=U(f,{".":we}),Ze=S.toString().split(""),xe=0;xe<Ze.length;xe++){var Se=Ze[xe];Ge(Le,Se)&&(Ze[xe]=Le[Se])}return Ze.join("")}},bg:{y:function(S){return["\u0433\u043E\u0434\u0438\u043D\u0438","\u0433\u043E\u0434\u0438\u043D\u0430","\u0433\u043E\u0434\u0438\u043D\u0438"][Y(S)]},mo:function(S){return["\u043C\u0435\u0441\u0435\u0446\u0430","\u043C\u0435\u0441\u0435\u0446","\u043C\u0435\u0441\u0435\u0446\u0430"][Y(S)]},w:function(S){return["\u0441\u0435\u0434\u043C\u0438\u0446\u0438","\u0441\u0435\u0434\u043C\u0438\u0446\u0430","\u0441\u0435\u0434\u043C\u0438\u0446\u0438"][Y(S)]},d:function(S){return["\u0434\u043D\u0438","\u0434\u0435\u043D","\u0434\u043D\u0438"][Y(S)]},h:function(S){return["\u0447\u0430\u0441\u0430","\u0447\u0430\u0441","\u0447\u0430\u0441\u0430"][Y(S)]},m:function(S){return["\u043C\u0438\u043D\u0443\u0442\u0438","\u043C\u0438\u043D\u0443\u0442\u0430","\u043C\u0438\u043D\u0443\u0442\u0438"][Y(S)]},s:function(S){return["\u0441\u0435\u043A\u0443\u043D\u0434\u0438","\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u0441\u0435\u043A\u0443\u043D\u0434\u0438"][Y(S)]},ms:function(S){return["\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0438","\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0438"][Y(S)]},decimal:","},bn:{y:"\u09AC\u099B\u09B0",mo:"\u09AE\u09BE\u09B8",w:"\u09B8\u09AA\u09CD\u09A4\u09BE\u09B9",d:"\u09A6\u09BF\u09A8",h:"\u0998\u09A8\u09CD\u099F\u09BE",m:"\u09AE\u09BF\u09A8\u09BF\u099F",s:"\u09B8\u09C7\u0995\u09C7\u09A8\u09CD\u09A1",ms:"\u09AE\u09BF\u09B2\u09BF\u09B8\u09C7\u0995\u09C7\u09A8\u09CD\u09A1"},ca:{y:function(S){return"any"+(S===1?"":"s")},mo:function(S){return"mes"+(S===1?"":"os")},w:function(S){return"setman"+(S===1?"a":"es")},d:function(S){return"di"+(S===1?"a":"es")},h:function(S){return"hor"+(S===1?"a":"es")},m:function(S){return"minut"+(S===1?"":"s")},s:function(S){return"segon"+(S===1?"":"s")},ms:function(S){return"milisegon"+(S===1?"":"s")},decimal:","},cs:{y:function(S){return["rok","roku","roky","let"][$(S)]},mo:function(S){return["m\u011Bs\xEDc","m\u011Bs\xEDce","m\u011Bs\xEDce","m\u011Bs\xEDc\u016F"][$(S)]},w:function(S){return["t\xFDden","t\xFDdne","t\xFDdny","t\xFDdn\u016F"][$(S)]},d:function(S){return["den","dne","dny","dn\xED"][$(S)]},h:function(S){return["hodina","hodiny","hodiny","hodin"][$(S)]},m:function(S){return["minuta","minuty","minuty","minut"][$(S)]},s:function(S){return["sekunda","sekundy","sekundy","sekund"][$(S)]},ms:function(S){return["milisekunda","milisekundy","milisekundy","milisekund"][$(S)]},decimal:","},cy:{y:"flwyddyn",mo:"mis",w:"wythnos",d:"diwrnod",h:"awr",m:"munud",s:"eiliad",ms:"milieiliad"},da:{y:"\xE5r",mo:function(S){return"m\xE5ned"+(S===1?"":"er")},w:function(S){return"uge"+(S===1?"":"r")},d:function(S){return"dag"+(S===1?"":"e")},h:function(S){return"time"+(S===1?"":"r")},m:function(S){return"minut"+(S===1?"":"ter")},s:function(S){return"sekund"+(S===1?"":"er")},ms:function(S){return"millisekund"+(S===1?"":"er")},decimal:","},de:{y:function(S){return"Jahr"+(S===1?"":"e")},mo:function(S){return"Monat"+(S===1?"":"e")},w:function(S){return"Woche"+(S===1?"":"n")},d:function(S){return"Tag"+(S===1?"":"e")},h:function(S){return"Stunde"+(S===1?"":"n")},m:function(S){return"Minute"+(S===1?"":"n")},s:function(S){return"Sekunde"+(S===1?"":"n")},ms:function(S){return"Millisekunde"+(S===1?"":"n")},decimal:","},el:s,en:{y:function(S){return"year"+(S===1?"":"s")},mo:function(S){return"month"+(S===1?"":"s")},w:function(S){return"week"+(S===1?"":"s")},d:function(S){return"day"+(S===1?"":"s")},h:function(S){return"hour"+(S===1?"":"s")},m:function(S){return"minute"+(S===1?"":"s")},s:function(S){return"second"+(S===1?"":"s")},ms:function(S){return"millisecond"+(S===1?"":"s")},decimal:"."},eo:{y:function(S){return"jaro"+(S===1?"":"j")},mo:function(S){return"monato"+(S===1?"":"j")},w:function(S){return"semajno"+(S===1?"":"j")},d:function(S){return"tago"+(S===1?"":"j")},h:function(S){return"horo"+(S===1?"":"j")},m:function(S){return"minuto"+(S===1?"":"j")},s:function(S){return"sekundo"+(S===1?"":"j")},ms:function(S){return"milisekundo"+(S===1?"":"j")},decimal:","},es:{y:function(S){return"a\xF1o"+(S===1?"":"s")},mo:function(S){return"mes"+(S===1?"":"es")},w:function(S){return"semana"+(S===1?"":"s")},d:function(S){return"d\xEDa"+(S===1?"":"s")},h:function(S){return"hora"+(S===1?"":"s")},m:function(S){return"minuto"+(S===1?"":"s")},s:function(S){return"segundo"+(S===1?"":"s")},ms:function(S){return"milisegundo"+(S===1?"":"s")},decimal:","},et:{y:function(S){return"aasta"+(S===1?"":"t")},mo:function(S){return"kuu"+(S===1?"":"d")},w:function(S){return"n\xE4dal"+(S===1?"":"at")},d:function(S){return"p\xE4ev"+(S===1?"":"a")},h:function(S){return"tund"+(S===1?"":"i")},m:function(S){return"minut"+(S===1?"":"it")},s:function(S){return"sekund"+(S===1?"":"it")},ms:function(S){return"millisekund"+(S===1?"":"it")},decimal:","},eu:{y:"urte",mo:"hilabete",w:"aste",d:"egun",h:"ordu",m:"minutu",s:"segundo",ms:"milisegundo",decimal:","},fa:{y:"\u0633\u0627\u0644",mo:"\u0645\u0627\u0647",w:"\u0647\u0641\u062A\u0647",d:"\u0631\u0648\u0632",h:"\u0633\u0627\u0639\u062A",m:"\u062F\u0642\u06CC\u0642\u0647",s:"\u062B\u0627\u0646\u06CC\u0647",ms:"\u0645\u06CC\u0644\u06CC \u062B\u0627\u0646\u06CC\u0647",decimal:"."},fi:{y:function(S){return S===1?"vuosi":"vuotta"},mo:function(S){return S===1?"kuukausi":"kuukautta"},w:function(S){return"viikko"+(S===1?"":"a")},d:function(S){return"p\xE4iv\xE4"+(S===1?"":"\xE4")},h:function(S){return"tunti"+(S===1?"":"a")},m:function(S){return"minuutti"+(S===1?"":"a")},s:function(S){return"sekunti"+(S===1?"":"a")},ms:function(S){return"millisekunti"+(S===1?"":"a")},decimal:","},fo:{y:"\xE1r",mo:function(S){return S===1?"m\xE1na\xF0ur":"m\xE1na\xF0ir"},w:function(S){return S===1?"vika":"vikur"},d:function(S){return S===1?"dagur":"dagar"},h:function(S){return S===1?"t\xEDmi":"t\xEDmar"},m:function(S){return S===1?"minuttur":"minuttir"},s:"sekund",ms:"millisekund",decimal:","},fr:{y:function(S){return"an"+(S>=2?"s":"")},mo:"mois",w:function(S){return"semaine"+(S>=2?"s":"")},d:function(S){return"jour"+(S>=2?"s":"")},h:function(S){return"heure"+(S>=2?"s":"")},m:function(S){return"minute"+(S>=2?"s":"")},s:function(S){return"seconde"+(S>=2?"s":"")},ms:function(S){return"milliseconde"+(S>=2?"s":"")},decimal:","},gr:s,he:{y:function(S){return S===1?"\u05E9\u05E0\u05D4":"\u05E9\u05E0\u05D9\u05DD"},mo:function(S){return S===1?"\u05D7\u05D5\u05D3\u05E9":"\u05D7\u05D5\u05D3\u05E9\u05D9\u05DD"},w:function(S){return S===1?"\u05E9\u05D1\u05D5\u05E2":"\u05E9\u05D1\u05D5\u05E2\u05D5\u05EA"},d:function(S){return S===1?"\u05D9\u05D5\u05DD":"\u05D9\u05DE\u05D9\u05DD"},h:function(S){return S===1?"\u05E9\u05E2\u05D4":"\u05E9\u05E2\u05D5\u05EA"},m:function(S){return S===1?"\u05D3\u05E7\u05D4":"\u05D3\u05E7\u05D5\u05EA"},s:function(S){return S===1?"\u05E9\u05E0\u05D9\u05D4":"\u05E9\u05E0\u05D9\u05D5\u05EA"},ms:function(S){return S===1?"\u05DE\u05D9\u05DC\u05D9\u05E9\u05E0\u05D9\u05D9\u05D4":"\u05DE\u05D9\u05DC\u05D9\u05E9\u05E0\u05D9\u05D5\u05EA"},decimal:"."},hr:{y:function(S){return S%10===2||S%10===3||S%10===4?"godine":"godina"},mo:function(S){return S===1?"mjesec":S===2||S===3||S===4?"mjeseca":"mjeseci"},w:function(S){return S%10===1&&S!==11?"tjedan":"tjedna"},d:function(S){return S===1?"dan":"dana"},h:function(S){return S===1?"sat":S===2||S===3||S===4?"sata":"sati"},m:function(S){var we=S%10;return(we===2||we===3||we===4)&&(S<10||S>14)?"minute":"minuta"},s:function(S){var we=S%10;return we===5||Math.floor(S)===S&&S>=10&&S<=19?"sekundi":we===1?"sekunda":we===2||we===3||we===4?"sekunde":"sekundi"},ms:function(S){return S===1?"milisekunda":S%10===2||S%10===3||S%10===4?"milisekunde":"milisekundi"},decimal:","},hi:{y:"\u0938\u093E\u0932",mo:function(S){return S===1?"\u092E\u0939\u0940\u0928\u093E":"\u092E\u0939\u0940\u0928\u0947"},w:function(S){return S===1?"\u0939\u095E\u094D\u0924\u093E":"\u0939\u092B\u094D\u0924\u0947"},d:"\u0926\u093F\u0928",h:function(S){return S===1?"\u0918\u0902\u091F\u093E":"\u0918\u0902\u091F\u0947"},m:"\u092E\u093F\u0928\u091F",s:"\u0938\u0947\u0915\u0902\u0921",ms:"\u092E\u093F\u0932\u0940\u0938\u0947\u0915\u0902\u0921",decimal:"."},hu:{y:"\xE9v",mo:"h\xF3nap",w:"h\xE9t",d:"nap",h:"\xF3ra",m:"perc",s:"m\xE1sodperc",ms:"ezredm\xE1sodperc",decimal:","},id:{y:"tahun",mo:"bulan",w:"minggu",d:"hari",h:"jam",m:"menit",s:"detik",ms:"milidetik",decimal:"."},is:{y:"\xE1r",mo:function(S){return"m\xE1nu\xF0"+(S===1?"ur":"ir")},w:function(S){return"vik"+(S===1?"a":"ur")},d:function(S){return"dag"+(S===1?"ur":"ar")},h:function(S){return"klukkut\xEDm"+(S===1?"i":"ar")},m:function(S){return"m\xEDn\xFAt"+(S===1?"a":"ur")},s:function(S){return"sek\xFAnd"+(S===1?"a":"ur")},ms:function(S){return"millisek\xFAnd"+(S===1?"a":"ur")},decimal:"."},it:{y:function(S){return"ann"+(S===1?"o":"i")},mo:function(S){return"mes"+(S===1?"e":"i")},w:function(S){return"settiman"+(S===1?"a":"e")},d:function(S){return"giorn"+(S===1?"o":"i")},h:function(S){return"or"+(S===1?"a":"e")},m:function(S){return"minut"+(S===1?"o":"i")},s:function(S){return"second"+(S===1?"o":"i")},ms:function(S){return"millisecond"+(S===1?"o":"i")},decimal:","},ja:{y:"\u5E74",mo:"\u30F6\u6708",w:"\u9031",d:"\u65E5",h:"\u6642\u9593",m:"\u5206",s:"\u79D2",ms:"\u30DF\u30EA\u79D2",decimal:"."},km:{y:"\u1786\u17D2\u1793\u17B6\u17C6",mo:"\u1781\u17C2",w:"\u179F\u1794\u17D2\u178F\u17B6\u17A0\u17CD",d:"\u1790\u17D2\u1784\u17C3",h:"\u1798\u17C9\u17C4\u1784",m:"\u1793\u17B6\u1791\u17B8",s:"\u179C\u17B7\u1793\u17B6\u1791\u17B8",ms:"\u1798\u17B7\u179B\u17D2\u179B\u17B8\u179C\u17B7\u1793\u17B6\u1791\u17B8"},kn:{y:function(S){return S===1?"\u0CB5\u0CB0\u0CCD\u0CB7":"\u0CB5\u0CB0\u0CCD\u0CB7\u0C97\u0CB3\u0CC1"},mo:function(S){return S===1?"\u0CA4\u0CBF\u0C82\u0C97\u0CB3\u0CC1":"\u0CA4\u0CBF\u0C82\u0C97\u0CB3\u0CC1\u0C97\u0CB3\u0CC1"},w:function(S){return S===1?"\u0CB5\u0CBE\u0CB0":"\u0CB5\u0CBE\u0CB0\u0C97\u0CB3\u0CC1"},d:function(S){return S===1?"\u0CA6\u0CBF\u0CA8":"\u0CA6\u0CBF\u0CA8\u0C97\u0CB3\u0CC1"},h:function(S){return S===1?"\u0C97\u0C82\u0C9F\u0CC6":"\u0C97\u0C82\u0C9F\u0CC6\u0C97\u0CB3\u0CC1"},m:function(S){return S===1?"\u0CA8\u0CBF\u0CAE\u0CBF\u0CB7":"\u0CA8\u0CBF\u0CAE\u0CBF\u0CB7\u0C97\u0CB3\u0CC1"},s:function(S){return S===1?"\u0CB8\u0CC6\u0C95\u0CC6\u0C82\u0CA1\u0CCD":"\u0CB8\u0CC6\u0C95\u0CC6\u0C82\u0CA1\u0CC1\u0C97\u0CB3\u0CC1"},ms:function(S){return S===1?"\u0CAE\u0CBF\u0CB2\u0CBF\u0CB8\u0CC6\u0C95\u0CC6\u0C82\u0CA1\u0CCD":"\u0CAE\u0CBF\u0CB2\u0CBF\u0CB8\u0CC6\u0C95\u0CC6\u0C82\u0CA1\u0CC1\u0C97\u0CB3\u0CC1"}},ko:{y:"\uB144",mo:"\uAC1C\uC6D4",w:"\uC8FC\uC77C",d:"\uC77C",h:"\uC2DC\uAC04",m:"\uBD84",s:"\uCD08",ms:"\uBC00\uB9AC \uCD08",decimal:"."},ku:{y:"sal",mo:"meh",w:"hefte",d:"roj",h:"seet",m:"deqe",s:"saniye",ms:"m\xEEl\xEE\xE7irk",decimal:","},lo:{y:"\u0E9B\u0EB5",mo:"\u0EC0\u0E94\u0EB7\u0EAD\u0E99",w:"\u0EAD\u0EB2\u0E97\u0EB4\u0E94",d:"\u0EA1\u0EB7\u0EC9",h:"\u0E8A\u0EBB\u0EC8\u0EA7\u0EC2\u0EA1\u0E87",m:"\u0E99\u0EB2\u0E97\u0EB5",s:"\u0EA7\u0EB4\u0E99\u0EB2\u0E97\u0EB5",ms:"\u0EA1\u0EB4\u0E99\u0EA5\u0EB4\u0EA7\u0EB4\u0E99\u0EB2\u0E97\u0EB5",decimal:","},lt:{y:function(S){return S%10===0||S%100>=10&&S%100<=20?"met\u0173":"metai"},mo:function(S){return["m\u0117nuo","m\u0117nesiai","m\u0117nesi\u0173"][ye(S)]},w:function(S){return["savait\u0117","savait\u0117s","savai\u010Di\u0173"][ye(S)]},d:function(S){return["diena","dienos","dien\u0173"][ye(S)]},h:function(S){return["valanda","valandos","valand\u0173"][ye(S)]},m:function(S){return["minut\u0117","minut\u0117s","minu\u010Di\u0173"][ye(S)]},s:function(S){return["sekund\u0117","sekund\u0117s","sekund\u017Ei\u0173"][ye(S)]},ms:function(S){return["milisekund\u0117","milisekund\u0117s","milisekund\u017Ei\u0173"][ye(S)]},decimal:","},lv:{y:function(S){return be(S)?"gads":"gadi"},mo:function(S){return be(S)?"m\u0113nesis":"m\u0113ne\u0161i"},w:function(S){return be(S)?"ned\u0113\u013Ca":"ned\u0113\u013Cas"},d:function(S){return be(S)?"diena":"dienas"},h:function(S){return be(S)?"stunda":"stundas"},m:function(S){return be(S)?"min\u016Bte":"min\u016Btes"},s:function(S){return be(S)?"sekunde":"sekundes"},ms:function(S){return be(S)?"milisekunde":"milisekundes"},decimal:","},mk:{y:function(S){return S===1?"\u0433\u043E\u0434\u0438\u043D\u0430":"\u0433\u043E\u0434\u0438\u043D\u0438"},mo:function(S){return S===1?"\u043C\u0435\u0441\u0435\u0446":"\u043C\u0435\u0441\u0435\u0446\u0438"},w:function(S){return S===1?"\u043D\u0435\u0434\u0435\u043B\u0430":"\u043D\u0435\u0434\u0435\u043B\u0438"},d:function(S){return S===1?"\u0434\u0435\u043D":"\u0434\u0435\u043D\u0430"},h:function(S){return S===1?"\u0447\u0430\u0441":"\u0447\u0430\u0441\u0430"},m:function(S){return S===1?"\u043C\u0438\u043D\u0443\u0442\u0430":"\u043C\u0438\u043D\u0443\u0442\u0438"},s:function(S){return S===1?"\u0441\u0435\u043A\u0443\u043D\u0434\u0430":"\u0441\u0435\u043A\u0443\u043D\u0434\u0438"},ms:function(S){return S===1?"\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0430":"\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0438"},decimal:","},mr:{y:function(S){return S===1?"\u0935\u0930\u094D\u0937":"\u0935\u0930\u094D\u0937\u0947"},mo:function(S){return S===1?"\u092E\u0939\u093F\u0928\u093E":"\u092E\u0939\u093F\u0928\u0947"},w:function(S){return S===1?"\u0906\u0920\u0935\u0921\u093E":"\u0906\u0920\u0935\u0921\u0947"},d:"\u0926\u093F\u0935\u0938",h:"\u0924\u093E\u0938",m:function(S){return S===1?"\u092E\u093F\u0928\u093F\u091F":"\u092E\u093F\u0928\u093F\u091F\u0947"},s:"\u0938\u0947\u0915\u0902\u0926",ms:"\u092E\u093F\u0932\u093F\u0938\u0947\u0915\u0902\u0926"},ms:{y:"tahun",mo:"bulan",w:"minggu",d:"hari",h:"jam",m:"minit",s:"saat",ms:"milisaat",decimal:"."},nl:{y:"jaar",mo:function(S){return S===1?"maand":"maanden"},w:function(S){return S===1?"week":"weken"},d:function(S){return S===1?"dag":"dagen"},h:"uur",m:function(S){return S===1?"minuut":"minuten"},s:function(S){return S===1?"seconde":"seconden"},ms:function(S){return S===1?"milliseconde":"milliseconden"},decimal:","},no:{y:"\xE5r",mo:function(S){return"m\xE5ned"+(S===1?"":"er")},w:function(S){return"uke"+(S===1?"":"r")},d:function(S){return"dag"+(S===1?"":"er")},h:function(S){return"time"+(S===1?"":"r")},m:function(S){return"minutt"+(S===1?"":"er")},s:function(S){return"sekund"+(S===1?"":"er")},ms:function(S){return"millisekund"+(S===1?"":"er")},decimal:","},pl:{y:function(S){return["rok","roku","lata","lat"][F(S)]},mo:function(S){return["miesi\u0105c","miesi\u0105ca","miesi\u0105ce","miesi\u0119cy"][F(S)]},w:function(S){return["tydzie\u0144","tygodnia","tygodnie","tygodni"][F(S)]},d:function(S){return["dzie\u0144","dnia","dni","dni"][F(S)]},h:function(S){return["godzina","godziny","godziny","godzin"][F(S)]},m:function(S){return["minuta","minuty","minuty","minut"][F(S)]},s:function(S){return["sekunda","sekundy","sekundy","sekund"][F(S)]},ms:function(S){return["milisekunda","milisekundy","milisekundy","milisekund"][F(S)]},decimal:","},pt:{y:function(S){return"ano"+(S===1?"":"s")},mo:function(S){return S===1?"m\xEAs":"meses"},w:function(S){return"semana"+(S===1?"":"s")},d:function(S){return"dia"+(S===1?"":"s")},h:function(S){return"hora"+(S===1?"":"s")},m:function(S){return"minuto"+(S===1?"":"s")},s:function(S){return"segundo"+(S===1?"":"s")},ms:function(S){return"milissegundo"+(S===1?"":"s")},decimal:","},ro:{y:function(S){return S===1?"an":"ani"},mo:function(S){return S===1?"lun\u0103":"luni"},w:function(S){return S===1?"s\u0103pt\u0103m\xE2n\u0103":"s\u0103pt\u0103m\xE2ni"},d:function(S){return S===1?"zi":"zile"},h:function(S){return S===1?"or\u0103":"ore"},m:function(S){return S===1?"minut":"minute"},s:function(S){return S===1?"secund\u0103":"secunde"},ms:function(S){return S===1?"milisecund\u0103":"milisecunde"},decimal:","},ru:{y:function(S){return["\u043B\u0435\u0442","\u0433\u043E\u0434","\u0433\u043E\u0434\u0430"][Y(S)]},mo:function(S){return["\u043C\u0435\u0441\u044F\u0446\u0435\u0432","\u043C\u0435\u0441\u044F\u0446","\u043C\u0435\u0441\u044F\u0446\u0430"][Y(S)]},w:function(S){return["\u043D\u0435\u0434\u0435\u043B\u044C","\u043D\u0435\u0434\u0435\u043B\u044F","\u043D\u0435\u0434\u0435\u043B\u0438"][Y(S)]},d:function(S){return["\u0434\u043D\u0435\u0439","\u0434\u0435\u043D\u044C","\u0434\u043D\u044F"][Y(S)]},h:function(S){return["\u0447\u0430\u0441\u043E\u0432","\u0447\u0430\u0441","\u0447\u0430\u0441\u0430"][Y(S)]},m:function(S){return["\u043C\u0438\u043D\u0443\u0442","\u043C\u0438\u043D\u0443\u0442\u0430","\u043C\u0438\u043D\u0443\u0442\u044B"][Y(S)]},s:function(S){return["\u0441\u0435\u043A\u0443\u043D\u0434","\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u0441\u0435\u043A\u0443\u043D\u0434\u044B"][Y(S)]},ms:function(S){return["\u043C\u0438\u043B\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434","\u043C\u0438\u043B\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u043C\u0438\u043B\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u044B"][Y(S)]},decimal:","},sq:{y:function(S){return S===1?"vit":"vjet"},mo:"muaj",w:"jav\xEB",d:"dit\xEB",h:"or\xEB",m:function(S){return"minut"+(S===1?"\xEB":"a")},s:function(S){return"sekond"+(S===1?"\xEB":"a")},ms:function(S){return"milisekond"+(S===1?"\xEB":"a")},decimal:","},sr:{y:function(S){return["\u0433\u043E\u0434\u0438\u043D\u0438","\u0433\u043E\u0434\u0438\u043D\u0430","\u0433\u043E\u0434\u0438\u043D\u0435"][Y(S)]},mo:function(S){return["\u043C\u0435\u0441\u0435\u0446\u0438","\u043C\u0435\u0441\u0435\u0446","\u043C\u0435\u0441\u0435\u0446\u0430"][Y(S)]},w:function(S){return["\u043D\u0435\u0434\u0435\u0459\u0438","\u043D\u0435\u0434\u0435\u0459\u0430","\u043D\u0435\u0434\u0435\u0459\u0435"][Y(S)]},d:function(S){return["\u0434\u0430\u043D\u0438","\u0434\u0430\u043D","\u0434\u0430\u043D\u0430"][Y(S)]},h:function(S){return["\u0441\u0430\u0442\u0438","\u0441\u0430\u0442","\u0441\u0430\u0442\u0430"][Y(S)]},m:function(S){return["\u043C\u0438\u043D\u0443\u0442\u0430","\u043C\u0438\u043D\u0443\u0442","\u043C\u0438\u043D\u0443\u0442\u0430"][Y(S)]},s:function(S){return["\u0441\u0435\u043A\u0443\u043D\u0434\u0438","\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u0441\u0435\u043A\u0443\u043D\u0434\u0435"][Y(S)]},ms:function(S){return["\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0438","\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0435"][Y(S)]},decimal:","},ta:{y:function(S){return S===1?"\u0BB5\u0BB0\u0BC1\u0B9F\u0BAE\u0BCD":"\u0B86\u0BA3\u0BCD\u0B9F\u0BC1\u0B95\u0BB3\u0BCD"},mo:function(S){return S===1?"\u0BAE\u0BBE\u0BA4\u0BAE\u0BCD":"\u0BAE\u0BBE\u0BA4\u0B99\u0BCD\u0B95\u0BB3\u0BCD"},w:function(S){return S===1?"\u0BB5\u0BBE\u0BB0\u0BAE\u0BCD":"\u0BB5\u0BBE\u0BB0\u0B99\u0BCD\u0B95\u0BB3\u0BCD"},d:function(S){return S===1?"\u0BA8\u0BBE\u0BB3\u0BCD":"\u0BA8\u0BBE\u0B9F\u0BCD\u0B95\u0BB3\u0BCD"},h:function(S){return S===1?"\u0BAE\u0BA3\u0BBF":"\u0BAE\u0BA3\u0BBF\u0BA8\u0BC7\u0BB0\u0BAE\u0BCD"},m:function(S){return"\u0BA8\u0BBF\u0BAE\u0BBF\u0B9F"+(S===1?"\u0BAE\u0BCD":"\u0B99\u0BCD\u0B95\u0BB3\u0BCD")},s:function(S){return"\u0BB5\u0BBF\u0BA9\u0BBE\u0B9F\u0BBF"+(S===1?"":"\u0B95\u0BB3\u0BCD")},ms:function(S){return"\u0BAE\u0BBF\u0BB2\u0BCD\u0BB2\u0BBF \u0BB5\u0BBF\u0BA8\u0BBE\u0B9F\u0BBF"+(S===1?"":"\u0B95\u0BB3\u0BCD")}},te:{y:function(S){return"\u0C38\u0C02\u0C35\u0C24\u0C4D\u0C38"+(S===1?"\u0C30\u0C02":"\u0C30\u0C3E\u0C32")},mo:function(S){return"\u0C28\u0C46\u0C32"+(S===1?"":"\u0C32")},w:function(S){return S===1?"\u0C35\u0C3E\u0C30\u0C02":"\u0C35\u0C3E\u0C30\u0C3E\u0C32\u0C41"},d:function(S){return"\u0C30\u0C4B\u0C1C\u0C41"+(S===1?"":"\u0C32\u0C41")},h:function(S){return"\u0C17\u0C02\u0C1F"+(S===1?"":"\u0C32\u0C41")},m:function(S){return S===1?"\u0C28\u0C3F\u0C2E\u0C3F\u0C37\u0C02":"\u0C28\u0C3F\u0C2E\u0C3F\u0C37\u0C3E\u0C32\u0C41"},s:function(S){return S===1?"\u0C38\u0C46\u0C15\u0C28\u0C41":"\u0C38\u0C46\u0C15\u0C28\u0C4D\u0C32\u0C41"},ms:function(S){return S===1?"\u0C2E\u0C3F\u0C32\u0C4D\u0C32\u0C40\u0C38\u0C46\u0C15\u0C28\u0C4D":"\u0C2E\u0C3F\u0C32\u0C4D\u0C32\u0C40\u0C38\u0C46\u0C15\u0C28\u0C4D\u0C32\u0C41"}},uk:{y:function(S){return["\u0440\u043E\u043A\u0456\u0432","\u0440\u0456\u043A","\u0440\u043E\u043A\u0438"][Y(S)]},mo:function(S){return["\u043C\u0456\u0441\u044F\u0446\u0456\u0432","\u043C\u0456\u0441\u044F\u0446\u044C","\u043C\u0456\u0441\u044F\u0446\u0456"][Y(S)]},w:function(S){return["\u0442\u0438\u0436\u043D\u0456\u0432","\u0442\u0438\u0436\u0434\u0435\u043D\u044C","\u0442\u0438\u0436\u043D\u0456"][Y(S)]},d:function(S){return["\u0434\u043D\u0456\u0432","\u0434\u0435\u043D\u044C","\u0434\u043D\u0456"][Y(S)]},h:function(S){return["\u0433\u043E\u0434\u0438\u043D","\u0433\u043E\u0434\u0438\u043D\u0430","\u0433\u043E\u0434\u0438\u043D\u0438"][Y(S)]},m:function(S){return["\u0445\u0432\u0438\u043B\u0438\u043D","\u0445\u0432\u0438\u043B\u0438\u043D\u0430","\u0445\u0432\u0438\u043B\u0438\u043D\u0438"][Y(S)]},s:function(S){return["\u0441\u0435\u043A\u0443\u043D\u0434","\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u0441\u0435\u043A\u0443\u043D\u0434\u0438"][Y(S)]},ms:function(S){return["\u043C\u0456\u043B\u0456\u0441\u0435\u043A\u0443\u043D\u0434","\u043C\u0456\u043B\u0456\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u043C\u0456\u043B\u0456\u0441\u0435\u043A\u0443\u043D\u0434\u0438"][Y(S)]},decimal:","},ur:{y:"\u0633\u0627\u0644",mo:function(S){return S===1?"\u0645\u06C1\u06CC\u0646\u06C1":"\u0645\u06C1\u06CC\u0646\u06D2"},w:function(S){return S===1?"\u06C1\u0641\u062A\u06C1":"\u06C1\u0641\u062A\u06D2"},d:"\u062F\u0646",h:function(S){return S===1?"\u06AF\u06BE\u0646\u0679\u06C1":"\u06AF\u06BE\u0646\u0679\u06D2"},m:"\u0645\u0646\u0679",s:"\u0633\u06CC\u06A9\u0646\u0688",ms:"\u0645\u0644\u06CC \u0633\u06CC\u06A9\u0646\u0688",decimal:"."},sk:{y:function(S){return["rok","roky","roky","rokov"][$(S)]},mo:function(S){return["mesiac","mesiace","mesiace","mesiacov"][$(S)]},w:function(S){return["t\xFD\u017Ede\u0148","t\xFD\u017Edne","t\xFD\u017Edne","t\xFD\u017Ed\u0148ov"][$(S)]},d:function(S){return["de\u0148","dni","dni","dn\xED"][$(S)]},h:function(S){return["hodina","hodiny","hodiny","hod\xEDn"][$(S)]},m:function(S){return["min\xFAta","min\xFAty","min\xFAty","min\xFAt"][$(S)]},s:function(S){return["sekunda","sekundy","sekundy","sek\xFAnd"][$(S)]},ms:function(S){return["milisekunda","milisekundy","milisekundy","milisek\xFAnd"][$(S)]},decimal:","},sl:{y:function(S){return S%10===1?"leto":S%100===2?"leti":S%100===3||S%100===4||Math.floor(S)!==S&&S%100<=5?"leta":"let"},mo:function(S){return S%10===1?"mesec":S%100===2||Math.floor(S)!==S&&S%100<=5?"meseca":S%10===3||S%10===4?"mesece":"mesecev"},w:function(S){return S%10===1?"teden":S%10===2||Math.floor(S)!==S&&S%100<=4?"tedna":S%10===3||S%10===4?"tedne":"tednov"},d:function(S){return S%100===1?"dan":"dni"},h:function(S){return S%10===1?"ura":S%100===2?"uri":S%10===3||S%10===4||Math.floor(S)!==S?"ure":"ur"},m:function(S){return S%10===1?"minuta":S%10===2?"minuti":S%10===3||S%10===4||Math.floor(S)!==S&&S%100<=4?"minute":"minut"},s:function(S){return S%10===1?"sekunda":S%100===2?"sekundi":S%100===3||S%100===4||Math.floor(S)!==S?"sekunde":"sekund"},ms:function(S){return S%10===1?"milisekunda":S%100===2?"milisekundi":S%100===3||S%100===4||Math.floor(S)!==S?"milisekunde":"milisekund"},decimal:","},sv:{y:"\xE5r",mo:function(S){return"m\xE5nad"+(S===1?"":"er")},w:function(S){return"veck"+(S===1?"a":"or")},d:function(S){return"dag"+(S===1?"":"ar")},h:function(S){return"timm"+(S===1?"e":"ar")},m:function(S){return"minut"+(S===1?"":"er")},s:function(S){return"sekund"+(S===1?"":"er")},ms:function(S){return"millisekund"+(S===1?"":"er")},decimal:","},sw:{y:function(S){return S===1?"mwaka":"miaka"},mo:function(S){return S===1?"mwezi":"miezi"},w:"wiki",d:function(S){return S===1?"siku":"masiku"},h:function(S){return S===1?"saa":"masaa"},m:"dakika",s:"sekunde",ms:"milisekunde",decimal:"."},tr:{y:"y\u0131l",mo:"ay",w:"hafta",d:"g\xFCn",h:"saat",m:"dakika",s:"saniye",ms:"milisaniye",decimal:","},th:{y:"\u0E1B\u0E35",mo:"\u0E40\u0E14\u0E37\u0E2D\u0E19",w:"\u0E2A\u0E31\u0E1B\u0E14\u0E32\u0E2B\u0E4C",d:"\u0E27\u0E31\u0E19",h:"\u0E0A\u0E31\u0E48\u0E27\u0E42\u0E21\u0E07",m:"\u0E19\u0E32\u0E17\u0E35",s:"\u0E27\u0E34\u0E19\u0E32\u0E17\u0E35",ms:"\u0E21\u0E34\u0E25\u0E25\u0E34\u0E27\u0E34\u0E19\u0E32\u0E17\u0E35",decimal:"."},vi:{y:"n\u0103m",mo:"th\xE1ng",w:"tu\u1EA7n",d:"ng\xE0y",h:"gi\u1EDD",m:"ph\xFAt",s:"gi\xE2y",ms:"mili gi\xE2y",decimal:","},zh_CN:{y:"\u5E74",mo:"\u4E2A\u6708",w:"\u5468",d:"\u5929",h:"\u5C0F\u65F6",m:"\u5206\u949F",s:"\u79D2",ms:"\u6BEB\u79D2",decimal:"."},zh_TW:{y:"\u5E74",mo:"\u500B\u6708",w:"\u5468",d:"\u5929",h:"\u5C0F\u6642",m:"\u5206\u9418",s:"\u79D2",ms:"\u6BEB\u79D2",decimal:"."}};function x(S){var we=function(Ze,xe){var Se=U({},we,xe||{});return o(Ze,Se)};return U(we,{language:"en",spacer:" ",conjunction:"",serialComma:!0,units:["y","mo","w","d","h","m","s"],languages:{},round:!1,unitMeasures:{y:315576e5,mo:26298e5,w:6048e5,d:864e5,h:36e5,m:6e4,s:1e3,ms:1}},S)}var T=x({});function k(S){var we=[S.language];if(Ge(S,"fallbacks"))if(Ue(S.fallbacks)&&S.fallbacks.length)we=we.concat(S.fallbacks);else throw new Error("fallbacks must be an array with at least one element");for(var Le=0;Le<we.length;Le++){var Ze=we[Le];if(Ge(S.languages,Ze))return S.languages[Ze];if(Ge(m,Ze))return m[Ze]}throw new Error("No language found.")}function o(S,we){var Le,Ze,xe;S=Math.abs(S);var Se=k(we),Re=[],Je,ot,st;for(Le=0,Ze=we.units.length;Le<Ze;Le++){if(Je=we.units[Le],ot=we.unitMeasures[Je],Le+1===Ze)if(Ge(we,"maxDecimalPoints")){var wt=Math.pow(10,we.maxDecimalPoints),ai=S/ot;st=parseFloat((Math.floor(wt*ai)/wt).toFixed(we.maxDecimalPoints))}else st=S/ot;else st=Math.floor(S/ot);Re.push({unitCount:st,unitName:Je}),S-=st*ot}var vi=0;for(Le=0;Le<Re.length;Le++)if(Re[Le].unitCount){vi=Le;break}if(we.round){var Ft,Vi;for(Le=Re.length-1;Le>=0&&(xe=Re[Le],xe.unitCount=Math.round(xe.unitCount),Le!==0);Le--)Vi=Re[Le-1],Ft=we.unitMeasures[Vi.unitName]/we.unitMeasures[xe.unitName],(xe.unitCount%Ft===0||we.largest&&we.largest-1<Le-vi)&&(Vi.unitCount+=xe.unitCount/Ft,xe.unitCount=0)}var Dt=[];for(Le=0,Re.length;Le<Ze&&(xe=Re[Le],xe.unitCount&&Dt.push(N(xe.unitCount,xe.unitName,Se,we)),Dt.length!==we.largest);Le++);if(Dt.length){var kt;if(Ge(we,"delimiter")?kt=we.delimiter:Ge(Se,"delimiter")?kt=Se.delimiter:kt=", ",!we.conjunction||Dt.length===1)return Dt.join(kt);if(Dt.length===2)return Dt.join(we.conjunction);if(Dt.length>2)return Dt.slice(0,-1).join(kt)+(we.serialComma?",":"")+we.conjunction+Dt.slice(-1)}else return N(0,we.units[we.units.length-1],Se,we)}function N(S,we,Le,Ze){var xe;Ge(Ze,"decimal")?xe=Ze.decimal:Ge(Le,"decimal")?xe=Le.decimal:xe=".";var Se;typeof Le._formatCount=="function"?Se=Le._formatCount(S,xe):Se=S.toString().replace(".",xe);var Re=Le[we],Je;return typeof Re=="function"?Je=Re(S):Je=Re,Se+Ze.spacer+Je}function U(S){for(var we,Le=1;Le<arguments.length;Le++){we=arguments[Le];for(var Ze in we)Ge(we,Ze)&&(S[Ze]=we[Ze])}return S}function V(S){return S===1?0:S===2?1:S>2&&S<11?2:0}function F(S){return S===1?0:Math.floor(S)!==S?1:S%10>=2&&S%10<=4&&!(S%100>10&&S%100<20)?2:3}function Y(S){return Math.floor(S)!==S?2:S%100>=5&&S%100<=20||S%10>=5&&S%10<=9||S%10===0?0:S%10===1?1:S>1?2:0}function $(S){return S===1?0:Math.floor(S)!==S?1:S%10>=2&&S%10<=4&&S%100<10?2:3}function ye(S){return S===1||S%10===1&&S%100>20?0:Math.floor(S)!==S||S%10>=2&&S%100>20||S%10>=2&&S%100<10?1:2}function be(S){return S%10===1&&S%100!==11}var Ue=Array.isArray||function(S){return Object.prototype.toString.call(S)==="[object Array]"};function Ge(S,we){return Object.prototype.hasOwnProperty.call(S,we)}T.getSupportedLanguages=function(){var we=[];for(var Le in m)Ge(m,Le)&&Le!=="gr"&&we.push(Le);return we},T.humanizer=x,l.exports?l.exports=T:this.humanizeDuration=T})()})(A0);var YS=A0.exports;const JS=Math.asin,Ny=Math.cos,QS=Math.sin,eE=Math.sqrt,tE=Math.PI,iE=6378137;function rE(l){return l*l}function pd(l){return l*tE/180}function jy(l){return rE(QS(l/2))}function nE(l,s){const f=pd(Array.isArray(l)?l[1]:l.latitude||l.lat),m=pd(Array.isArray(s)?s[1]:s.latitude||s.lat),x=pd(Array.isArray(l)?l[0]:l.longitude||l.lng||l.lon),T=pd(Array.isArray(s)?s[0]:s.longitude||s.lng||s.lon),k=jy(m-f)+Ny(f)*Ny(m)*jy(T-x);return 2*iE*JS(eE(k))}var oE=nE,aE=["bottom","height","left","right","top","width"],sE=function(s,f){return s===void 0&&(s={}),f===void 0&&(f={}),aE.some(function(m){return s[m]!==f[m]})},Ea=new Map,C0,lE=function l(){var s=[];Ea.forEach(function(f,m){var x=m.getBoundingClientRect();sE(x,f.rect)&&(f.rect=x,s.push(f))}),s.forEach(function(f){f.callbacks.forEach(function(m){return m(f.rect)})}),C0=window.requestAnimationFrame(l)};function cE(l,s){return{observe:function(){var m=Ea.size===0;Ea.has(l)?Ea.get(l).callbacks.push(s):Ea.set(l,{rect:void 0,hasRectChanged:!1,callbacks:[s]}),m&&lE()},unobserve:function(){var m=Ea.get(l);if(m){var x=m.callbacks.indexOf(s);x>=0&&m.callbacks.splice(x,1),m.callbacks.length||Ea.delete(l),Ea.size||cancelAnimationFrame(C0)}}}}function uE(){return!!(typeof window!="undefined"&&window.document&&window.document.createElement)}var Cp=uE()?xs:Jt;function hE(l){return typeof l=="boolean"}function dE(l){return!!(l&&{}.toString.call(l)=="[object Function]")}function Gy(l,s,f){var m,x;if(hE(s))m=s;else{var T;m=(T=s==null?void 0:s.observe)!=null?T:!0,x=s==null?void 0:s.onChange}dE(f)&&(x=f);var k=Ri(l.current),o=k[0],N=k[1],U=vt(!1),V=vt(!1),F=Ri(null),Y=F[0],$=F[1],ye=vt(x);return Cp(function(){ye.current=x,l.current!==o&&N(l.current)}),Cp(function(){o&&!U.current&&(U.current=!0,$(o.getBoundingClientRect()))},[o]),Cp(function(){if(!!m){var be=o;if(V.current||(V.current=!0,be=l.current),!!be){var Ue=cE(be,function(Ge){ye.current==null||ye.current(Ge),$(Ge)});return Ue.observe(),function(){Ue.unobserve()}}}},[m,o,l]),Y}function fE(l,s){const f=vt(null),m=()=>{let T,k;return"hidden"in document?(T="hidden",k="visibilitychange"):"mozHidden"in document?(T="mozHidden",k="mozvisibilitychange"):"webkitHidden"in document&&(T="webkitHidden",k="webkitvisibilitychange"),{hidden:T,visibilityChange:k}},x=()=>clearTimeout(f.current);Jt(()=>{const{hidden:T,visibilityChange:k}=m();if(typeof l!="function")throw new Error("callback must be a function");const o=()=>{if(s){if(typeof s!="number"||s<0)throw new Error("delay must be a positive integer");f.current&&x(),f.current=setTimeout(()=>l(!document[T]),s)}else l(!document[T])};return document.addEventListener(k,o),()=>{document.removeEventListener(k,o)}},[l])}const{VITE_ORS_API_KEY:pE,VITE_GRAPHHOPPER_API_KEY:mE}={VITE_MAPBOX_ACCESS_TOKEN:"pk.eyJ1IjoiY2hlZWF1biIsImEiOiJjbDBkdXJud3gwY21qM2Rtenk1ZTM4dzNqIn0.lIVOhBl1NrdplE6DrbEngw",VITE_ORS_API_KEY:"5b3ce3597851110001cf624888ac0dd0f3434a208374935e71ad9bcd",VITE_GRAPHHOPPER_API_KEY:"LijBPDQGfu7Iiq80w3HzwB4RUDJbMbhs6BU0dEnn",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0},Mp={OSRM:(l,s)=>`https://routing.openstreetmap.de/routed-foot/route/v1/driving/${l.join(",")};${s.join(",")}`,ORS:()=>"https://api.openrouteservice.org/v2/directions/foot-hiking/geojson",GHOP:()=>"https://graphhopper.com/api/1/route"},_E=async(l,s,f)=>{const m=fetch(Mp.OSRM(l,s)+"?"+new URLSearchParams(wi({geometries:"geojson",overview:"full",continue_straight:!1,generate_hints:!1,alternatives:1},f))).then(F=>F.json()).catch(F=>{}),x=fetch(Mp.ORS(),{method:"POST",headers:{"Content-Type":"application/json",Authorization:pE},body:JSON.stringify({coordinates:[l,s],instructions:!1,alternative_routes:{target_count:2}})}).then(F=>F.json()).catch(F=>{}),T=new URLSearchParams({vehicle:"foot",key:mE,instructions:!0,points_encoded:!1,point:[...l].reverse().join(","),algorithm:"alternative_route","alternative_route.max_paths":2});T.append("point",[...s].reverse().join(","));const k=fetch(Mp.GHOP()+"?"+T).then(F=>F.json()).catch(F=>{}),[o,N,U]=await Promise.all([m,x,k]);return console.log({response1:o,response2:N,response3:U}),{type:"FeatureCollection",features:[...o==null?void 0:o.routes.map((F,Y)=>({type:"Feature",geometry:F==null?void 0:F.geometry,properties:{index:Y,provider:"osrm",distance:F==null?void 0:F.distance}})),...N==null?void 0:N.features.map((F,Y)=>{var $,ye;return{type:"Feature",geometry:F==null?void 0:F.geometry,properties:{index:Y,provider:"ors",distance:(ye=($=F==null?void 0:F.properties)==null?void 0:$.summary)==null?void 0:ye.distance}}}),...U==null?void 0:U.paths.map((F,Y)=>({type:"Feature",geometry:F==null?void 0:F.points,properties:{index:Y,provider:"graphhopper",distance:F==null?void 0:F.distance}}))]}},md="mapwalker-";var Jr={get:l=>{try{return JSON.parse(localStorage.getItem(md+l))}catch{return null}},set:(l,s)=>{try{s?localStorage.setItem(md+l,JSON.stringify(s)):localStorage.removeItem(md+l)}catch{}},del:l=>{try{localStorage.removeItem(md+l)}catch{}}},$y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAABCCAYAAAA7WKTiAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAomSURBVHgBzZhdbBxXFcfPvTP74a/NpqkSkzT1Nk3INkKNS4tihUpeoYhGVCIVoBIqkPKAIG+lFaCKiCAkHgqIqhWqVPFUKAW/UPqVqqmqyIYWDEokt0KJTQvZtEllt3G8SfyxuzNzb8+599zZsZs6/pgH3+hk7qxn7v3N/5x77oeAFRStdQkv3WjummejUkersVXJhBDjsMwilvogwlDHfWi9aEVYXiHIQbCQtaW8sCQwhKowlFGlOTGZr/3uud7w3Hi3GL+0Ca7OFL0gykshQOZz9cy6zposFmr+XeUxv3JH1du1rZYAHEG4wev1Ka4DRMocBOsuuPSXEz21Z16qqPMflnzpQUZKoKsn6CrBQzNwaCLRtNy+ZdS/r39Y3rv3XALw6cXUE4tAkcv2o+Wn3x4rXvjJkweiCxOlrOcjkAcxmGfrvrBgHjYpJTaL964DbMuYunXzqPeDbx6Xu0oERLH4PMKNLhmMoe6j+tmjT/ZdeeWNfj+M8gRFIBZOQlbae98phnWR8QF8NKyD5C6iCCAIAcIIlJR1ve/OQe/hg//i7ghu5LpgCFUG6z7478O/qlx57Z/9BGIMlcn69prxyBBQ2LrMZgDacqgvXqnuExg2r6EF1ghQpybouQbA3bsHxdFDQ58GJxZAUUwdJvedeejRyuXjw/053yqUM3CeUSnL9QyDilwWoKsdoB3HRh7rdJ8hMJRMIZlSOGIsFMyhB6fRZuZAf/F2B0dufSoZc3KBYIcIauzIE32Tr77Z7+EXU2B7Ln4o0KV1m4krch2BFDos2Dq8ru9C6wS4oYCG9Q0Fe1/EehGvhU77bEcbwBtvVfRjA3vAjvaDSRA/oVYFL8XayJnixIuD/T6IeIQRmL0KBmSjWCKVOvK2M9dhO7o0w3GGQW/diGrN+FZFsCqKMAT1+qmK3t83hgPCMLhUIhMupICHMz/97X7dbNqcJFrD39RBGjgHa1xGcUUwnW0t1daxYhu6rGqkIv1GytJz7W32g9ryIKMorx995gDr08eJPHZlidR6/8/HSjOj/98pKA8Jm4kEAlBdgv3NwuKdR2AZC0fupI4cXJFdatxZYBe2M1TeKmpikQYKqnjhYil6+c0Su7QvCUZuhPeefWmPhRGxSXNvTca/4ZXcRAFODRtAtHzOdmzgWDUCJKU6rELQlrWjllxN79PgwVgOB17vZxbjOYnSUVYvXjp1unj59Ltl4JztzA7d1p1gUJMKCM4ZxVvGbwESnHEhQ9FvWX6OUonv3jWfDvrCRyU1MUWKFWmRINmNMH787z0xioZWEQuA4rvkMwkjYApwj2PQDALZkj3+xsRnczX4w7Hd/GO378Am/naybEYQc8VsunWhP8dP6IS5XBWhBZxMKWfBtP2NEitmfVNX/LxW/L6K+6BFQc5WSwRmljD1S1PF+SSaAZWd6/if+d1kcwbBIW9AmmEriWLyNGW2YTunKyVWAqRnmnZ6crBa2T6iDy52JxUzQI2pK+szoFkAC6V04l7byVgZs40J6qjhMjpatm7jxvgltHFEL9IzMzbbA01HlNPImvaDFH90ePmqW+flCczkjbDeyNEkrJxObkWgVXxVWlow+jt+qUeNE1QdO5vFoPc4hmhunMvY2KLmgsCCE9g02mzdAuJ7GhWPSC1qtx7kk2CmOOq4Y52o871tQKH6Cug7JSohyE2+y+jQiqks/0ZgYdhSlcDMXNkwcBF+BLVHRh/vCoHRBJoX2UxDBSqnJT5ADwkHISESyhr+LVQ0LSGUpgaxji6iPGQIosRkTaPRDTdSkNxGKpFq7FaF7g4JSit7zXh15qrHYLn166aCicnuCN0VJVxn4JzRy9hZiB3ZmYACGL9uGuxIoxHp1CKw5LKnyfPlLBlCIXyAv4fYbqAi0z4UCvESnMBoB1PsvKl7fHLiYreRlNWxIBJCvJdoHlrIy2aCEqyIRhb/Kg6GJg+GjLdgPcajlwdLhDEX4m8Bqm7gFMFhH+s65oFV0cpdO3omPjr5NkROJcXu09Z9EkGkmz953iS5tPbiePTnKO6adroySbW1ktAIQgNGcdukUshXW4+g665dYwxWlawY7Hro0Ig2YUIvautzZX3fslYjQRRCE7+WzDSO1wb+1kBlmqhcgCMuxNwVYlwFCBugSk3zDj6jQvN8k67KqRZB+5e+UHVgPn55FdNBrWPzpmLXLTdVr549XwpRYknqx5M5mHs3o5i5DTgBm5HrGXVlvG6THPc8KDgnGrVoZPOHuqAnsMxnt4623b7DbJRpg+xWF2a9XT78wJDJaeZFHasTGlWoAYVfSXX7xUEYmXtSqWHUC41q9bCJFmA94PvAPFMPWyrTe01+h/opfGOf25wM0n8ObJhG563f/mq1cMvWKn0dBab7GudCJ3vcsArjhh0U/a2hWm61gPa+6X5nlzrzt28dveHr+8iN7liBN1hC1BkO9jxx5AUvl2sobUcKudVcDUBolVOuI46ZkOPHKBeY6zxQVs78Hs6HCjB3bTny3ePOc25DEm9GeK09vuHOz9V6vvblQTMQtHVfkAjSuEHqMGwpZdypHBzfhxa6wcDO4kGAbRS/cvdQR+9OF1uDMQ8kSnL79o/vH6289/KJfnqCNrQZ6fEOnI8F3IaEd1G0+24tv8W8ht0giac8Hv037t87uP2xH19z+3atDW+8Czdwx06YJa/HcAZMyHlgks4seFclOAGb3KrtSHbrOE2zCY/QG+/ZO1h+/BG34R1YeFRw3SOCf//wl33nnnutEjUaOerYTxyg0D6TYkEyaGsD42YH157VjYBENlvfeKAyVP7Fg8Pc3dKOCBJwZYbLT576T/HkI7+5Z+r0O2Wzeo5dKPiER8buk4kdVtwW/9fes7m669c/eqH4+dvcocqr14JaFIzhKOYOAS8m//fsi6V3n/5r39SZd3YKbbd2bp9p3WnVixvm/NpR2lLd9r37h7Z+694qN02zzcCKjqEWAFYgcZJICr7/ylCJ9gnVc9WdXYECP7CZP8pImM35sO228luFHT3j5Qe/M9K2eVO8nEEbXvXB3QI4giqB3YPGR50PHLz/Zzd/ZiPcvHkj5HDrVj0/DmfPT8Af/zTw88Tr5iSRoepL6c+HJRaWnRof4b3oYUbmz9Of9iqdHFZhmUXCCsr8U+iE6Gb4iYXPVmEFZUVgixatIY2SDphjcbvtFEoKYLrlPT1vD7+qkgKYSLCItLhScmXsvU8G/0pL+sGfDldKMaYX3KdQUnZl8rhvdSXl4F9TozJRxJpSDBJ5DNZY5o+LXkuZP1FSgqKSfh5LqaSTx65RXW1JOV2kV1JOsOmVdF25+BJ7WSUdV7qi19TqYr5CaXk1XcXMSWM6JaVlT/rDMh3FRPrDcjVgS9pRr7SsBsxuej/hxnn3o7DCshqw59Hq2Vy2EcPxIV1nZ2d8zAQrLCsG47OMp3b33vF4W0d7zS1e8Uiq1tvb+3tYcHS53PIxfbEsAyHnVcMAAAAASUVORK5CYII=",Zy="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABL0lEQVR4AWJwL/ABlE7V2A0EUWx7U7sXSB2qc6JMF7xEmLnbPUWYqU4qs5swM335jZy/E44LGSWN5n9tBK+vr3WCZkEomLeYEHQIfJevhXErnP8B4MSp0+IJEA6vn5ZbF44yTUHpNNmbeQXqZwqXA7tne06ieMWAJ+8f36/XjOdvKXSB/8BhEmgh9umsxYmezE6qNx0A8rmkTZDSauo8O5z5QYlIUqonM5bqyzVGkRnj/61zRxlrYDzeHfcsE+Q0ilwk+jI74GA+1iD0GL8SHbG/MuhOB+RRV70BC4NYHN6XBr2ZEtfKdcLA4AsGozYw9kGshjj43onOcnVZIKcDJbXGHb1GVSifRTL/KJL5tMrsBNfKtbXJFZHy0yrThEl+gHEfJg1Wu5OJLEIrrHP5b3P6pThmM9CwAAAAAElFTkSuQmCC",qy="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAZlBMVEVHcEz///+zAKG6GKn///////+zAJ////+0AKD///+6GKr///////////+yAKG9Ja/TbcmyAKHz1e+0AKDz1fDdjtX46vfdjdX46viyAKH////CM7T////CM7O0AKC9Ja7TbMmzAKF6zRIdAAAAIXRSTlMAa+X3m2ymvzMM9xgwp8zz35nHmcfXw9fDpnjvd+/M898tOvE7AAAAlUlEQVR4XmXPSWLDMAwEQZAi2Zap3fuWZP7/yUjC0XWbPgG26UIP6V3NtQFHaPeduE8vabxA2krgfNTueCaYVVj3TylxLXc6e3ORTofVSZrIlhgVD7tBH3oDqXgoEnyHno8GD1G/JMtM0rztWbrxtI5rI8XHY5AaqGaZpdGuWch+OrdRev1dSf5MxpFbc/WZoM/dNv4BxucM0w0EVH0AAAAASUVORK5CYII=",Wy="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAV1BMVEVHcEz////////////////////////////////87PDzfZnuSnHrHk7uPmf1m7D72+LsM17rHk7pHk7qHk397PD1m6/rHk7rHlD////rHk7tPmfzfpr///8RMzXWAAAAHXRSTlMAMGunv5t3GAzD3+//89fH98ym5cPXmTNspvPfeD/z9xIAAACOSURBVHgBZc/VgYAwEEXRIVz84S7917lAsn6+IqP2iFwMSZqZlzsCl7/3hKKspLqB5HlxtJ1eXYszy+C+98Mw3i8TkaXM0rLeFqlks4Ra4/rqVREbSLt/2CX4/xBTqfcPow4S2zi/izZcFjHdbcdh6O+2kJltPwfb/Og0tVSdBYlfZiPYcvOyK4F4i+z2AXk5CstVjWTDAAAAAElFTkSuQmCC",gE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAMAAABlApw1AAABuVBMVEWN3PeU3vi46frN8Pzb9P3x+/74/f7////i9v2b4PjG7fvq+P7U8vzq+f74/f+x5/q36frC4/d3we07peUdl+EOkN9KrOek1fMsnuOk1vPh8fuV3vi03PWz3PWl1vPN7/zD4/fO7/x3wO3b9f2l1fPq+P3G7vvp+P7w+P1ouuuq5PnS6vmGyO+p5Pmi4vm/6/pZs+nN8Puq5fmGx+/g8fuVz/GVzvFoueu/6/ui4/nq6Obw7u319PPt7OuHx+/6+fnt6+lZsunr6ef+/v7v7uz7+/v29fT29fX8/PyWz/Hy8fDr6ej9/Pz39/b5+Pf6+vn5+Pj08vH19PLz8vGWzvHv7Or09PJ4wO3u7Ovy8e/y8PC05JvQ7sHj9dnx+u255aLt+ebe89P2/PPH67TQ7sD7/vna8s3V8Me+6Kjn9uDL7Lr6/fm+56js+Oa55aG55qHf9NPx++zM7bq03fXD6a7o99/V78fj9dq956jB6a6956dHcAFSeRHR3L9egiHo7d+juIC6yqB1lECuwZCMpmBpizH09u/F06/d5M+Yr3BqizDR27+AnVDC6a7V8Mbo9+Do7t/d5c9egiCAgMNAAAAHT0lEQVR4AezaB7KjMAwGYIcX+DHpwSI8Xu+9bN/7X2x77FCcPmsx4+8Ev8dSACmCIc/zPM/zPM/zPM/rBAfdMAIQxgeBbF36JEZJL5Ctih+hri9FS5j4FYloAzmAVSgFe0GEJYYjwVyCFRL2+Vt9ghHWMBZsyQhrGErBVYiSyTRVRCqbTlDSa0cDzHLS8sM2tIHEgiKlkryAMTwSHPVhHCqqUMfcr0DCOKEGp8yvIIBWKGqgCt5XMICWU6MUWsy6gmZkcQjtiHMF5WSRQwsEN2eYm5DVOeYuBDcx5i7J6hJzXcavERlZpZgLBTfQFFkpzA0ZH4CWgOYPsG/RZiUExk2cklXGuImvNvsZjRk/yM6dPMj8q0QH2jVZnEKTgp0YWrryAm4EP8kmHzSB4KcTrSiiYxiS+1TlWFGFuobRF4L5FaDIqSQtsEC2YbB1nZOWn2LRrWDqDiXnl5kiUunlOUrC1g53+S/Lxqi6v0ddGAimApRM/pTQwwQ14WML8hcZ/fNQ8K0je/4nRcbzPWqS1uQvbwiM7hH3/CV5wXlt3HlJ7PlNKzA9wetbHMGe31DP/E7QCfomvD2/tRV6buvmIIRhzV/yXqDkg3BEJjGM1fmtrfBRuPASA5vnL9eRwwGLjLFx/pL3e6dXMIp2zF8+Qdftd8tG+Y20vHNlkn/yrGhdn1zV0AjNPn/JFG3i3s2YUYaou589KNrUVzdTrn4t/GSa0jYyJ0tjWS36jLalTA0Fbi7gfoOWXT5r77v5R4qi3Vw6WFkGC/lpV5mDSV1cHh1uovi25If0+/9fRT7QhhpG1rOfzNxFlxNREAXg7Gofxx16Du4w7u7u8Yy7z5/HQ52c7vvayKVri9VH3ktuugo0TfCnMFn/AEn+90vwVd+BUgEAb8DEJkSaaPZXLfoBEATwyXYvpFatzYHKL6BN77Bbv+0OgJs4TXRwAJ16hMwfAtn7YgfYL06X/K1uCqC5x8NSUDL98L6II+AzXp3o5QD63MbxP5q3RAQAMjhN9HMAA2LYiMg+vP2reQyw8LeaQQ6gV7TqzkOyaeimaAGAJHCa6KYAmntEqz1bO/RDehTMgIc4Ug9zAK0iWtbjh+k3tUPvCXDffAkIgJFRMZcZYOE0McYBNPeGAkgafhKMkwDNA6EAn+AtnmABRvrCAO6DI0R8BfQaBADYIvVd4iVWwWQIwPv6zz59B5tiAGo1LY7VMzmDAY4pcFZ//hwT0Nw5Zmt+Yv5nHnMFyPOU1oL+9NFmEkAJehWkr7/3ZxLwBJDnWe1fa4wG0Fqc6Z+cmBxrXdIYs+wBIDcfJ36lp7r80UkE4FoWI0DLuqnRT18ALgD3jwG4OpkA3H9gwHxzQMDKP6zV+lmT/TEcrrWVgBVrXP9J+xMIWOu5CABg/xrbUOW1fz4A9w/mGfYqrASvGKd//fJlr2JpJQIA0D9Kzlr58kqoilH6B5egkq+Cv302APeP3kg3Njc30c3lA3D/cJ6xtQKLD9jG/cNLsBMhwG4F94/nGaXoAIrm/sE8oxoZQNnUP04Te5EBFM39w3nGfkQAZXP/eJ5RighgD/dvThOFaAAOXP7pGJ5nFKMBKCngjc/tiN1IAKqOX8C0sjhSF3fZAPMVeO84K0bzDCDgA8wnqB3NM4CADygZdz/aHeYZCTEI+IBD0xVoF6ftCMsg4AOOpFafnPu3D/USWMAH7ApePGjXeYZXAR9wjB/DNek03LOAD1jD20Mn+GxBAR9QxHsTFt4rQgI+4FSbMKxAZBsqiIWP0mAJBb84SMAHnOEd2PuC94qQgA+owB3SpGjJw0YKYo3JEV2iJVbCk4APqOINxrtSV2kvgn06YA//v3jPRXy/BltsgH6bxAu5vgTnBADIEUmUI3wJdva5gENzjgggqHIBhih9UwIJdvaZAEOUTogEE5SYAEOOeCh+BG/0Z1wQACBKgxxxVvQg0J9eZAKOPERpKV8CAUiu+0SApyh9uQIEAHzFA1xrU3gIsL6yAgTgDJV4AE1yz01PoIEgAoBTBZhmAJ4Ez5kAfITwFAYJVBziDnxv564VGgiCMI6X0+PQ4FLSpctTpMK9RCrkO7+L4fDCOMxx7C4+h8y/i032F9eDJT4KjHnW5zF+Ke3joSB0CXKvnN567tyHAeA1jdl+yRrhLYKuARZLAmLLVcBXACV4i6DG+6eSgMy8Rbkq7x0CVkHFuPW8uiTAa+QE04/LqREXwy6gsZ67448MEOdDEoCIcg1VOru7OqtTlCuAS0BTQ0OFd56ZLICvAnMxCgUr5KwJWQAictUIUGxvxX0CaQBa5KhtmOkUtCEOCEKylhpnOgQR5AE4bJCl2DLTKoggD3BcB7F15ta88fbfRjkABEdvvP3zzLWXV4IfoCwAkK04l2OYubfx/CR+ApQIAF+k+eW4Zx7HD7e9hh8lQMmA2dmT07OddaLzizTzwDlneslNl+AEAALH/HcABShAAbO/PAUoQAEKUIACFKAABSigvK4B2MjGH+Q3T3oAAAAASUVORK5CYII=",yE=kb(ab),M0,I0,k0,tm=yE,vE=0;function Hy(l,s,f,m,x){var T,k,o={};for(k in s)k=="ref"?T=s[k]:o[k]=s[k];var N={type:l,props:o,key:f,ref:T,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--vE,__source:x,__self:m};if(typeof l=="function"&&(T=l.defaultProps))for(k in T)o[k]===void 0&&(o[k]=T[k]);return tm.options.vnode&&tm.options.vnode(N),N}k0=tm.Fragment,I0=Hy,M0=Hy;const De=I0,ni=M0,Jc=k0,xE=l=>De("svg",dr(wi({preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.75em",height:"1.75em"},l),{children:De("path",{fill:"currentColor",d:"M13.5 5.5c1.1 0 2-.9 2-2s-.9-2-2-2s-2 .9-2 2s.9 2 2 2zM9.8 8.9L7.24 21.81c-.13.61.35 1.19.98 1.19h.08c.47 0 .87-.32.98-.78L10.9 15l2.1 2v5c0 .55.45 1 1 1s1-.45 1-1v-5.64c0-.55-.22-1.07-.62-1.45L12.9 13.5l.6-3a7.321 7.321 0 0 0 4.36 2.41c.6.09 1.14-.39 1.14-1c0-.49-.36-.9-.85-.98c-1.52-.25-2.78-1.15-3.45-2.33l-1-1.6a2.145 2.145 0 0 0-2.65-.84L7.22 7.78A2.01 2.01 0 0 0 6 9.63V12c0 .55.45 1 1 1s1-.45 1-1V9.6l1.8-.7"})})),bE=l=>De("svg",dr(wi({preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.75em",height:"1.75em"},l),{children:De("path",{fill:"currentColor",d:"M11 9h2V7h-2m1 13c-4.41 0-8-3.59-8-8s3.59-8 8-8s8 3.59 8 8s-3.59 8-8 8m0-18A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2m-1 15h2v-6h-2v6Z"})})),wE=l=>De("svg",dr(wi({preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.75em",height:"1.75em"},l),{children:De("path",{fill:"currentColor",d:"M11 18h2v-2h-2v2m1-16A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8s8 3.59 8 8s-3.59 8-8 8m0-14a4 4 0 0 0-4 4h2a2 2 0 0 1 2-2a2 2 0 0 1 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5a4 4 0 0 0-4-4Z"})})),TE=l=>De("svg",dr(wi({preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.75em",height:"1.75em"},l),{children:De("path",{fill:"currentColor",d:"M12 8a4 4 0 0 1 4 4a4 4 0 0 1-4 4a4 4 0 0 1-4-4a4 4 0 0 1 4-4m0 2a2 2 0 0 0-2 2a2 2 0 0 0 2 2a2 2 0 0 0 2-2a2 2 0 0 0-2-2m-2 12c-.25 0-.46-.18-.5-.42l-.37-2.65c-.63-.25-1.17-.59-1.69-.99l-2.49 1.01c-.22.08-.49 0-.61-.22l-2-3.46a.493.493 0 0 1 .12-.64l2.11-1.66L4.5 12l.07-1l-2.11-1.63a.493.493 0 0 1-.12-.64l2-3.46c.12-.22.39-.31.61-.22l2.49 1c.52-.39 1.06-.73 1.69-.98l.37-2.65c.04-.24.25-.42.5-.42h4c.25 0 .46.18.5.42l.37 2.65c.63.25 1.17.59 1.69.98l2.49-1c.22-.09.49 0 .61.22l2 3.46c.13.22.07.49-.12.64L19.43 11l.07 1l-.07 1l2.11 1.63c.19.15.25.42.12.64l-2 3.46c-.12.22-.39.31-.61.22l-2.49-1c-.52.39-1.06.73-1.69.98l-.37 2.65c-.04.24-.25.42-.5.42h-4m1.25-18l-.37 2.61c-1.2.25-2.26.89-3.03 1.78L5.44 7.35l-.75 1.3L6.8 10.2a5.55 5.55 0 0 0 0 3.6l-2.12 1.56l.75 1.3l2.43-1.04c.77.88 1.82 1.52 3.01 1.76l.37 2.62h1.52l.37-2.61c1.19-.25 2.24-.89 3.01-1.77l2.43 1.04l.75-1.3l-2.12-1.55c.4-1.17.4-2.44 0-3.61l2.11-1.55l-.75-1.3l-2.41 1.04a5.42 5.42 0 0 0-3.03-1.77L12.75 4h-1.5Z"})})),SE=l=>De("svg",dr(wi({preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.75em",height:"1.75em"},l),{children:De("path",{fill:"currentColor",d:"M3 11h8V3H3m2 2h4v4H5m8 12h8v-8h-8m2 2h4v4h-4M3 21h8v-8H3m2 2h4v4H5m8-16v8h8V3m-2 6h-4V5h4Z"})})),EE=l=>De("svg",dr(wi({preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.75em",height:"1.75em"},l),{children:De("path",{fill:"currentColor",d:"M5 5h5v2H7v3H5V5m9 0h5v5h-2V7h-3V5m3 9h2v5h-5v-2h3v-3m-7 3v2H5v-5h2v3h3Z"})})),AE=l=>De("svg",dr(wi({preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.75em",height:"1.75em"},l),{children:De("path",{fill:"currentColor",d:"M12 3a9 9 0 0 0-9 9H0l4 4l4-4H5a7 7 0 0 1 7-7a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.5 0-2.91-.5-4.06-1.3L6.5 19.14A9.115 9.115 0 0 0 12 21a9 9 0 0 0 9-9a9 9 0 0 0-9-9m2 9a2 2 0 0 0-2-2a2 2 0 0 0-2 2a2 2 0 0 0 2 2a2 2 0 0 0 2-2Z"})})),CE=l=>De("svg",dr(wi({preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.75em",height:"1.75em"},l),{children:De("path",{fill:"currentColor",d:"M12 8a4 4 0 0 1 4 4a4 4 0 0 1-4 4a4 4 0 0 1-4-4a4 4 0 0 1 4-4m-8.95 5H1v-2h2.05C3.5 6.83 6.83 3.5 11 3.05V1h2v2.05c4.17.45 7.5 3.78 7.95 7.95H23v2h-2.05c-.45 4.17-3.78 7.5-7.95 7.95V23h-2v-2.05C6.83 20.5 3.5 17.17 3.05 13M12 5a7 7 0 0 0-7 7a7 7 0 0 0 7 7a7 7 0 0 0 7-7a7 7 0 0 0-7-7Z"})})),ME=l=>De("svg",dr(wi({preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.75em",height:"1.75em"},l),{children:De("path",{fill:"currentColor",d:"M14 14h5v2h-3v3h-2v-5m-9 0h5v5H8v-3H5v-2m3-9h2v5H5V8h3V5m11 3v2h-5V5h2v3h3Z"})})),IE=l=>De("svg",dr(wi({preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.75em",height:"1.75em"},l),{children:De("path",{fill:"currentColor",d:"M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 16H5V5h14v14M17 8.4L13.4 12l3.6 3.6l-1.4 1.4l-3.6-3.6L8.4 17L7 15.6l3.6-3.6L7 8.4L8.4 7l3.6 3.6L15.6 7L17 8.4Z"})})),kE=l=>De("svg",dr(wi({preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.75em",height:"1.75em"},l),{children:De("path",{fill:"currentColor",d:"M17 4h3c1.1 0 2 .9 2 2v2h-2V6h-3V4M4 8V6h3V4H4c-1.1 0-2 .9-2 2v2h2m16 8v2h-3v2h3c1.1 0 2-.9 2-2v-2h-2M7 18H4v-2H2v2c0 1.1.9 2 2 2h3v-2m9-8v4H8v-4h8m2-2H6v8h12V8Z"})})),zE=l=>De("svg",dr(wi({preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.75em",height:"1.75em"},l),{children:De("path",{fill:"currentColor",d:"M17 10.54C16.78 7.44 14.63 5 12 5s-4.78 2.44-5 5.54C4 11.23 2 12.5 2 14c0 2.21 4.5 4 10 4s10-1.79 10-4c0-1.5-2-2.77-5-3.46m-2.07 1.3c-1.9.21-3.96.21-5.86 0c-.04-.28-.07-.56-.07-.84c0-2.2 1.35-4 3-4s3 1.8 3 4c0 .28 0 .56-.07.84Z"})})),PE=l=>De("svg",dr(wi({preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.75em",height:"1.75em"},l),{children:De("path",{fill:"currentColor",d:"M11 10H5L3 8l2-2h6V3l1-1l1 1v1h6l2 2l-2 2h-6v2h6l2 2l-2 2h-6v6a2 2 0 0 1 2 2H9a2 2 0 0 1 2-2V10Z"})})),DE=l=>De("svg",dr(wi({preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.75em",height:"1.75em"},l),{children:De("path",{fill:"currentColor",d:"M7.5 2c-1.79 1.15-3 3.18-3 5.5s1.21 4.35 3.03 5.5C4.46 13 2 10.54 2 7.5A5.5 5.5 0 0 1 7.5 2m11.57 1.5l1.43 1.43L4.93 20.5L3.5 19.07L19.07 3.5m-6.18 2.43L11.41 5L9.97 6l.42-1.7L9 3.24l1.75-.12l.58-1.65L12 3.1l1.73.03l-1.35 1.13l.51 1.67m-3.3 3.61l-1.16-.73l-1.12.78l.34-1.32l-1.09-.83l1.36-.09l.45-1.29l.51 1.27l1.36.03l-1.05.87l.4 1.31M19 13.5a5.5 5.5 0 0 1-5.5 5.5c-1.22 0-2.35-.4-3.26-1.07l7.69-7.69c.67.91 1.07 2.04 1.07 3.26m-4.4 6.58l2.77-1.15l-.24 3.35l-2.53-2.2m4.33-2.7l1.15-2.77l2.2 2.54l-3.35.23m1.15-4.96l-1.14-2.78l3.34.24l-2.2 2.54M9.63 18.93l2.77 1.15l-2.53 2.19l-.24-3.34Z"})})),LE=l=>De("svg",dr(wi({preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.75em",height:"1.75em"},l),{children:De("path",{fill:"currentColor",d:"M8 7h2v5H8V7M4.22 2h15.56C21 2 22 3 22 4.22v15.56A2.22 2.22 0 0 1 19.78 22H4.22C3 22 2 21 2 19.78V4.22A2.22 2.22 0 0 1 4.22 2M12 4a8 8 0 0 0-8 8a8 8 0 0 0 8 8a8 8 0 0 0 8-8a8 8 0 0 0-8-8m2 3.5h2v4h-2v-4m-3.5 8.75a1.5 1.5 0 0 1 1.5-1.5a1.5 1.5 0 0 1 1.5 1.5V17h-3v-.75Z"})})),{VITE_MAPBOX_ACCESS_TOKEN:Ip,DEV:RE}={VITE_MAPBOX_ACCESS_TOKEN:"pk.eyJ1IjoiY2hlZWF1biIsImEiOiJjbDBkdXJud3gwY21qM2Rtenk1ZTM4dzNqIn0.lIVOhBl1NrdplE6DrbEngw",VITE_ORS_API_KEY:"5b3ce3597851110001cf624888ac0dd0f3434a208374935e71ad9bcd",VITE_GRAPHHOPPER_API_KEY:"LijBPDQGfu7Iiq80w3HzwB4RUDJbMbhs6BU0dEnn",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0},BE=2,Qr=10,Xy=`mapbox://styles/cheeaun/cl0ds1jbz003014px6nthvdle${RE?"/draft":""}`,Ky={type:"FeatureCollection",features:[]},Yy={walkRoute:{layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["case",["==",["get","provider"],"ors"],"#95378C",["==",["get","provider"],"graphhopper"],"#EB1E4E","#0E90DF"],"line-opacity":["interpolate",["linear"],["zoom"],15,1,18,.5],"line-width":["interpolate",["linear"],["zoom"],15,4,18,14],"line-dasharray":[0,2]}},walkRoute2:{layout:{"symbol-placement":"line","symbol-spacing":["interpolate",["linear"],["zoom"],15,1,19,56],"icon-padding":0,"icon-size":["interpolate",["linear"],["zoom"],15,.5,18,1],"icon-image":["case",["==",["get","provider"],"ors"],"walk-dot-purple",["==",["get","provider"],"graphhopper"],"walk-dot-red","walk-dot-blue"]}}};let Jy=!1;function Qy(l=()=>{}){window.DeviceOrientationEvent&&!Jy&&typeof DeviceOrientationEvent.requestPermission=="function"&&DeviceOrientationEvent.requestPermission().then(function(s){s==="granted"&&(console.log("granted"),Jy=!0,l())}).catch(s=>{})}const OE=wv(()=>cb(()=>import("./geocoder-control.d0faae93.js"),[]));function ev(l,s,f,m){return Math.atan2(m-s,f-l)*180/Math.PI}function tv(){return document.querySelector(".mapboxgl-user-location-show-heading")}function FE(l){return new Promise(s=>setTimeout(s,l))}function UE(){var Nt,Mr,xr,Fr,_r,Gt,Ai;const l=vt(),s=vt(),f=vt(),m=vt(),[x,T]=Ri(!1),k=vt(),[o,N]=Ri(null),[U,V]=Ri(Jr.get("walk-route")||null);Jt(()=>{Jr.set("walk-route",U)},[U]);const[F,Y]=Ri(Jr.get("destination-marker")||null);Jt(()=>{Jr.set("destination-marker",F)},[F]);const[$,ye]=Ri(!1),be=vt(!1),Ge=pw(He=>{if(be.current)if(F)ye($?!1:{lng:He.lngLat.lng,lat:He.lngLat.lat});else{const{lngLat:rt}=He;Y(rt)}},350),[S,we]=Ri(null),[Le,Ze]=Ri(!1),[xe,Se]=Ri(!1),[Re,Je]=Ri(!1),[ot,st]=Ri(!Jr.get("not-first-time")),wt=vt(F),ai=vt(U),vi=Gr(()=>{var rt;const He={};return(rt=U==null?void 0:U.features)==null||rt.forEach(xt=>{const{provider:Ht,distance:Xt}=xt.properties;He[Ht]||(He[Ht]=[]),He[Ht].push(Xt)}),He},[U]),[Ft,Vi]=Ri(!1);Jt(()=>{ot||Re||Le?Vi(!0):Ft&&setTimeout(()=>{Vi(!1)},300)},[Le,Re,ot]);const[Dt,kt]=Ri(!1);Jt(()=>{var He,rt;(He=s.current)==null||He.resize(),(rt=m.current)==null||rt.resize(),o&&Dn()},[Dt]);const ui=vt(),Di=vt(),At=Gr(()=>{if(!F||!o)return 0;const{lng:He,lat:rt}=F,[xt,Ht]=o.features[0].geometry.coordinates;return oE({longitude:xt,latitude:Ht},{longitude:He,latitude:rt})},[F,o]),hi=Yt(()=>{o&&!tv()&&Qy(async()=>{var rt;let He=0;do{if(He++>10)break;(rt=k.current)==null||rt.trigger(),await FE(100)}while(!tv())})},[o]),cr=vt(),yr=vt(),Gn=Gy(l),tn=Gy(f),mr=Yt(()=>{if(F&&cr.current){const{width:He,height:rt}=Gn,{lng:xt,lat:Ht}=F,{x:Xt,y:Ni}=s.current.project([xt,Ht]),ir=Math.max(Math.min(Xt,He-Qr),Qr),Lr=Math.max(Math.min(Ni,rt-Qr),Qr),Ne=He/2,bt=rt/2,et=ev(Ne,bt,Xt,Ni);ir<Xt+Qr&&ir>Xt-Qr&&Lr<Ni+Qr&&Lr>Ni-Qr?cr.current.hidden=!0:(cr.current.hidden=!1,cr.current.style.transform=`translate(${ir}px, ${Lr}px) rotate(${et+90}deg)`)}else cr.current.hidden=!0},[F,Gn]),Pn=Yt(()=>{if(F&&yr.current){const{width:He,height:rt}=tn,{lng:xt,lat:Ht}=F,{x:Xt,y:Ni}=m.current.project([xt,Ht]),ir=Math.max(Math.min(Xt,He-Qr),Qr),Lr=Math.max(Math.min(Ni,rt-Qr),Qr),Ne=He/2,bt=rt/2,et=ev(Ne,bt,Xt,Ni);ir<Xt+Qr&&ir>Xt-Qr&&Lr<Ni+Qr&&Lr>Ni-Qr?yr.current.hidden=!0:(yr.current.hidden=!1,yr.current.style.transform=`translate(${ir}px, ${Lr}px) rotate(${et+90}deg)`)}else yr.current.hidden=!0},[F,tn]),$n=vt(null),Dn=Yt(()=>{var He;($n.current!=="ACTIVE_LOCK"||!document.querySelector(".mapboxgl-ctrl-geolocate-active"))&&((He=k.current)==null||He.trigger())},[]);fE(He=>{var rt;He&&(Dn(),o&&((rt=m.current)==null||rt.easeTo({center:o.features[0].geometry.coordinates})))});const Ln=Yt(He=>{var xt;if(!He)return;const rt=new Mv.LngLatBounds;He.features.forEach(Ht=>{Ht.geometry.coordinates.forEach(Xt=>{rt.extend(Xt)})}),(xt=s.current)==null||xt.fitBounds(rt,{padding:100})},[]),[tr,Or]=Ri(Jr.get("theme")||"auto");Jt(()=>{const He=document.documentElement,rt=document.querySelector('meta[name="color-scheme"]');tr==="light"?(He.classList.add("is-light"),He.classList.remove("is-dark"),rt==null||rt.setAttribute("content","light"),Jr.set("theme",tr)):tr==="dark"?(He.classList.add("is-dark"),He.classList.remove("is-light"),rt==null||rt.setAttribute("content","dark"),Jr.set("theme",tr)):(He.classList.remove("is-dark","is-light"),rt==null||rt.setAttribute("content","light dark"),Jr.del("theme"))},[tr]);const[Et,Zi]=Ri(Jr.get("unit-system")||"metric");Jt(()=>{Et==="imperial"?Jr.set("unit-system",Et):Jr.del("unit-system")},[Et]);const vr=Yt(He=>{if(Et==="imperial"){const rt=He/1609.34;return KS(rt).input("mi").humanize()}return XS(He).humanize()},[Et]),Dr=Yt(He=>{const rt=He/1.33*1e3;return`${vr(He)} (${YS(rt,{units:["h","m"],round:!0})})`},[vr]),[$r,pn]=Ri(!1);return ni("div",{class:`${Dt?"split-view":""}`,children:[De("div",{id:"map",ref:l,children:ni(Ad,{ref:s,mapboxAccessToken:Ip,mapStyle:Xy,initialViewState:Jr.get("view-state")||{longitude:0,latitude:0},boxZoom:!1,renderWorldCopies:!1,maxZoom:21,attributionControl:!1,logoPosition:"top-right",keyboard:!1,onLoad:He=>{var xt;Dn();const{layers:rt}=s.current.getStyle();we((xt=rt.find(Ht=>{var Xt;return Ht.type==="symbol"&&((Xt=Ht==null?void 0:Ht.layout)==null?void 0:Xt["text-field"])}))==null?void 0:xt.id),s.current.loadImage(Zy,(Ht,Xt)=>{Ht||(s.current.addImage("walk-dot-blue",Xt),m.current.addImage("walk-dot-blue",Xt))}),s.current.loadImage(qy,(Ht,Xt)=>{Ht||(s.current.addImage("walk-dot-purple",Xt),m.current.addImage("walk-dot-purple",Xt))}),s.current.loadImage(Wy,(Ht,Xt)=>{Ht||(s.current.addImage("walk-dot-red",Xt),m.current.addImage("walk-dot-red",Xt))})},onMoveStart:He=>{He.geolocateSource||f.current.hidden||f.current.classList.add("faded")},onMoveEnd:He=>{He.geolocateSource||f.current.hidden||f.current.classList.remove("faded")},onIdle:He=>{f.current.hidden||f.current.classList.remove("faded");const{target:rt}=He,xt=rt.getCenter(),Ht={longitude:xt.lng,latitude:xt.lat,zoom:rt.getZoom(),bearing:rt.getBearing(),pitch:rt.getPitch()};Jr.set("view-state",Ht),mr();const Xt=Ht.pitch===0&&Ht.bearing===0;document.querySelector("#map .mapboxgl-ctrl-compass").style.display=Xt?"none":"block"},onMove:He=>{var Ht;const{viewState:rt}=He,xt=rt.zoom<16;f.current.hidden=xt,!xt&&!Dt&&((Ht=m.current)==null||Ht.jumpTo(dr(wi({},rt),{center:[rt.longitude,rt.latitude],zoom:rt.zoom-BE}))),mr()},onClick:He=>{console.log("map click",He),!(He.originalEvent.detail>1)&&(be.current=!0,Ge(He),hi())},onDblClick:He=>{be.current&&(be.current=!1)},onZoomStart:He=>{be.current&&(be.current=!1)},onZoomEnd:He=>{const{zoom:rt}=He.viewState;console.log("zoom",rt)},onDragStart:He=>{be.current&&(be.current=!1)},children:[De(Kb,{position:"top-right",compact:!0}),De(ty,{id:"walk-route",type:"geojson",data:U||Ky,children:De(iy,wi({id:"walk-route",type:"symbol"},Yy.walkRoute2))}),De(gp,{anchor:"bottom",longitude:(F==null?void 0:F.lng)||0,latitude:(F==null?void 0:F.lat)||0,onClick:He=>{He.originalEvent.stopPropagation(),Je(!0)},children:De("img",{src:$y,width:"18",hidden:!F})}),De(ou,{children:De(OE,{accessToken:Ip,marker:!1,clearAndBlurOnSelect:!0,collapsed:!0,position:"top-left"})}),De(Jb,{ref:k,fitBoundsOptions:{zoom:17},positionOptions:{enableHighAccuracy:!0,timeout:5e3},trackUserLocation:!0,showUserHeading:!0,position:"bottom-right",onGeolocate:He=>{const{target:{_watchState:rt},coords:xt}=He;console.log(rt,{onGeolocate:He}),$n.current=rt,xt!=null&&xt.longitude?(N({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[xt.longitude,xt.latitude]}}]}),Qy()):N(null)},onError:He=>{const{code:rt,message:xt}=He;rt!==3&&alert(`${rt}: ${xt}`),N(null)}}),De(ey,{showZoom:!1,visualizePitch:!0,position:"bottom-right"}),De("div",{class:"marker-pointer",ref:cr,hidden:!0}),$&&De(Hb,{anchor:"bottom",longitude:$.lng,latitude:$.lat,closeButton:!1,closeOnMove:!0,onClose:()=>ye(!1),children:De("button",{type:"button",onClick:()=>{wt.current=F,Y({lng:$.lng,lat:$.lat}),ye(!1)},children:"Move marker here"})}),ni("div",{id:"actions",children:[De("button",{type:"button",onClick:()=>{st(!0)},title:"About",children:De(bE,{})}),De("button",{type:"button",onClick:()=>{Ze(!0)},title:"Legend",children:De(wE,{})}),De("button",{type:"button",onClick:()=>{Se(!0)},title:"Options",children:De(TE,{})}),De("button",{type:"button",class:"bold",onClick:()=>{Je(!0)},title:"Actions",disabled:x,children:x?De("div",{class:"loading"}):De(SE,{})})]})]})}),ni("div",{id:"overview-map",ref:f,hidden:!0,children:[ni(Ad,{ref:m,mapboxAccessToken:Ip,mapStyle:Xy,initialViewState:{longitude:0,latitude:0},attributionControl:!1,interactive:!Dt,maxZoom:17,keyboard:!1,onClick:()=>{hi()},onIdle:()=>{Pn();const He=m.current.getPitch(),rt=m.current.getBearing(),xt=He===0&&rt===0;if(document.querySelector("#overview-map .mapboxgl-ctrl-compass").style.display=xt?"none":"block",o){const Xt=m.current.getBounds().contains(o==null?void 0:o.features[0].geometry.coordinates);pn(!Xt)}},onMove:Pn,children:[De(ey,{showZoom:!1,visualizePitch:!0,position:"bottom-right"}),De(ty,{id:"walk-route",type:"geojson",data:U||Ky,children:De(iy,wi({id:"walk-route",type:"symbol"},Yy.walkRoute2))}),De(gp,{anchor:"center",longitude:((Mr=(Nt=o==null?void 0:o.features[0])==null?void 0:Nt.geometry)==null?void 0:Mr.coordinates[0])||0,latitude:((Fr=(xr=o==null?void 0:o.features[0])==null?void 0:xr.geometry)==null?void 0:Fr.coordinates[1])||0,children:De("div",{id:"geolocation-marker",hidden:!o})}),De(gp,{anchor:"bottom",longitude:(F==null?void 0:F.lng)||0,latitude:(F==null?void 0:F.lat)||0,children:De("img",{src:$y,width:"12",hidden:!F})}),De("div",{class:"marker-pointer mini",ref:yr,hidden:!0})]}),ni("div",{id:"mini-actions",children:[De("button",{type:"button",onClick:()=>{kt(!Dt)},children:Dt?De(ME,{}):De(EE,{})}),Dt&&$r&&o&&De("button",{type:"button",onClick:()=>{var He;(He=m.current)==null||He.easeTo({center:o.features[0].geometry.coordinates})},children:De(CE,{})})]})]}),ni("div",{class:"bd",onClick:He=>He.stopPropagation(),hidden:!Ft,children:[De(fd,{open:ot,onDismiss:()=>{st(!1),Jr.set("not-first-time",!0)},initialFocusRef:ui,children:ni("div",{class:"bottom-sheet-container",children:[De("img",{alt:"",src:gE,width:"96",height:"96",style:{borderRadius:24,boxShadow:"0 1px 2px #ccc",float:"right",marginLeft:10}}),De("h1",{children:"MapWalker"}),De("p",{children:"MapWalker is a very opinionated map-based walking route planner."}),ni("p",{children:["The map tiles and styles escalate ",De("b",{children:"all"})," walking paths and roads to the surface. They are color-coded based on their types, such as stairs, bridges, tunnels, etc."]}),De("p",{children:"Once a marker is placed, walk routes can be generated from current location to the marker. Up to 6 walk routes will be generated from different routing engines, overlayed on the map simultaneuously for comparison as each has its own pros and cons."}),ni("p",{children:[De("a",{href:"https://github.com/cheeaun/mapwalker",target:"_blank",children:"Built"})," ","by"," ",De("a",{href:"https://twitter.com/cheeaun",target:"_blank",children:"@cheeaun"}),"."]}),ni("button",{type:"button",class:"block bold",ref:ui,onClick:()=>{st(!1),Jr.set("not-first-time",!0)},children:[De("span",{children:De(xE,{})})," ","Start walking now!"]})]})}),De(fd,{open:Le,onDismiss:()=>{Ze(!1)},children:ni("div",{class:"bottom-sheet-container legend-sheet-container",children:[De("h2",{children:"Map Legend"}),ni("dl",{children:[De("dt",{children:De("span",{class:"path"})}),De("dd",{children:"Foot paths, cycling paths"}),De("dt",{children:De("span",{class:"bridge"})}),De("dd",{children:"Bridges"}),De("dt",{children:De("span",{class:"stairs"})}),De("dd",{children:"Stairs"}),De("dt",{children:De("span",{class:"tunnel"})}),De("dd",{children:"Tunnels, underground paths, under bridge"}),De("dt",{children:De("img",{src:Zy,width:"10",height:"10"})}),ni("dd",{children:["Route from OSRM",(_r=vi.osrm)==null?void 0:_r.map(He=>ni(Jc,{children:[De("br",{}),De("span",{class:"insignificant",children:Dr(He)})]}))]}),De("dt",{children:De("img",{src:qy,width:"10",height:"10"})}),ni("dd",{children:["Route from OpenRouteService",(Gt=vi.ors)==null?void 0:Gt.map(He=>ni(Jc,{children:[De("br",{}),De("span",{class:"insignificant",children:Dr(He)})]}))]}),De("dt",{children:De("img",{src:Wy,width:"10",height:"10"})}),ni("dd",{children:["Route from GraphHopper",(Ai=vi.graphhopper)==null?void 0:Ai.map(He=>ni(Jc,{children:[De("br",{}),De("span",{class:"insignificant",children:Dr(He)})]}))]})]})]})}),De(fd,{open:xe,onDismiss:()=>{Se(!1)},children:ni("div",{class:"bottom-sheet-container options-sheet-container",children:[De("h2",{children:"Options"}),De("p",{children:ni("label",{children:[ni("span",{children:[De(DE,{})," Theme"]}),ni("select",{id:"theme-switcher",value:tr,onChange:He=>{Or(He.target.value)},children:[De("option",{value:"auto",children:"Auto"}),De("option",{value:"light",children:"Light"}),De("option",{value:"dark",children:"Dark"})]})]})}),De("p",{children:ni("label",{children:[ni("span",{children:[De(LE,{})," Unit system"]}),ni("select",{id:"unit-system-switcher",value:Et,onChange:He=>{Zi(He.target.value)},children:[De("option",{value:"metric",children:"Metric"}),De("option",{value:"imperial",children:"Imperial"})]})]})})]})}),De(fd,{open:Re,onDismiss:()=>{Je(!1)},initialFocusRef:Di,children:ni("div",{class:"bottom-sheet-container marker-sheet-container",children:[!!F&&!!o&&ni("div",{class:"insignificant",style:{width:"100%",textAlign:"center"},children:["Air distance to marker: ",vr(At)]}),wt.current&&((F==null?void 0:F.lng)!==wt.current.lng||(F==null?void 0:F.lat)!==wt.current.lat)&&ni("button",{type:"button",onClick:()=>{Y(wt.current)},children:[De("span",{children:De(AE,{})})," ","Restore marker"]}),F?ni(Jc,{children:[ni("button",{type:"button",onClick:()=>{Y(null),wt.current=F},children:[De("span",{children:De(IE,{})})," ","Remove marker"]}),!!U&&ni("button",{type:"button",onClick:()=>{Ln(U),Je(!1)},children:[De("span",{children:De(kE,{})})," ","Zoom whole route"]}),ni("button",{type:"button",onClick:()=>{var He;(He=s.current)==null||He.flyTo({center:F}),Je(!1)},children:[De("span",{children:De(zE,{})})," ","Fly to marker"]}),ni("button",{type:"button",class:"bold block",ref:Di,onClick:async()=>{if(T(!0),Je(!1),console.log({geolocationGeoJSON:o,destinationMarker:F}),!o){alert("Please allow location access to generate routes");return}const He=await _E(o.features[0].geometry.coordinates,[F.lng,F.lat]);V(He),T(!1),Ln(He)},children:[De("span",{children:De(PE,{})})," ","Generate walk routes to marker"]})]}):ni(Jc,{children:[!F&&ni("button",{type:"button",onClick:()=>{var rt;const He=(rt=s.current)==null?void 0:rt.getCenter();Y({lat:He.lat,lng:He.lng}),Je(!1)},children:[De("span",{children:"\u{1F4CC}"})," Place marker on map"]}),U?ni("button",{type:"button",onClick:()=>{ai.current=U,V(null)},children:[De("span",{children:"\u{1F5D1}\uFE0F"})," Clear route"]}):ai.current&&ni("button",{type:"button",onClick:()=>{V(ai.current)},children:[De("span",{children:"\u267B\uFE0F"})," Restore route"]})]})]})})]})]})}ys(De(UE,{}),document.getElementById("app"));export{Ib as c,kb as g,Eu as u};
//# sourceMappingURL=index.7c6184f4.js.map
