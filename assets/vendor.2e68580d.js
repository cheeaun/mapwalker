var f1=Object.defineProperty,p1=Object.defineProperties;var m1=Object.getOwnPropertyDescriptors;var ug=Object.getOwnPropertySymbols;var _1=Object.prototype.hasOwnProperty,g1=Object.prototype.propertyIsEnumerable;var hg=(c,s,p)=>s in c?f1(c,s,{enumerable:!0,configurable:!0,writable:!0,value:p}):c[s]=p,dn=(c,s)=>{for(var p in s||(s={}))_1.call(s,p)&&hg(c,p,s[p]);if(ug)for(var p of ug(s))g1.call(s,p)&&hg(c,p,s[p]);return c},yl=(c,s)=>p1(c,m1(s));function y1(c,s){return s.forEach(function(p){p&&typeof p!="string"&&!Array.isArray(p)&&Object.keys(p).forEach(function(_){if(_!=="default"&&!(_ in c)){var x=Object.getOwnPropertyDescriptor(p,_);Object.defineProperty(c,_,x.get?x:{enumerable:!0,get:function(){return p[_]}})}})}),Object.freeze(Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}))}var du,_t,Sy,Ey,Xc,Ay,dg,Cy,dd={},Iy=[],v1=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function Go(c,s){for(var p in s)c[p]=s[p];return c}function My(c){var s=c.parentNode;s&&s.removeChild(c)}function _n(c,s,p){var _,x,S,z={};for(S in s)S=="key"?_=s[S]:S=="ref"?x=s[S]:z[S]=s[S];if(arguments.length>2&&(z.children=arguments.length>3?du.call(arguments,2):p),typeof c=="function"&&c.defaultProps!=null)for(S in c.defaultProps)z[S]===void 0&&(z[S]=c.defaultProps[S]);return Hc(c,z,_,x,null)}function Hc(c,s,p,_,x){var S={type:c,props:s,key:p,ref:_,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:x==null?++Sy:x};return x==null&&_t.vnode!=null&&_t.vnode(S),S}function ky(){return{current:null}}function Zo(c){return c.children}function to(c,s){this.props=c,this.context=s}function Ml(c,s){if(s==null)return c.__?Ml(c.__,c.__.__k.indexOf(c)+1):null;for(var p;s<c.__k.length;s++)if((p=c.__k[s])!=null&&p.__e!=null)return p.__e;return typeof c.type=="function"?Ml(c):null}function zy(c){var s,p;if((c=c.__)!=null&&c.__c!=null){for(c.__e=c.__c.base=null,s=0;s<c.__k.length;s++)if((p=c.__k[s])!=null&&p.__e!=null){c.__e=c.__c.base=p.__e;break}return zy(c)}}function mp(c){(!c.__d&&(c.__d=!0)&&Xc.push(c)&&!fd.__r++||dg!==_t.debounceRendering)&&((dg=_t.debounceRendering)||Ay)(fd)}function fd(){for(var c;fd.__r=Xc.length;)c=Xc.sort(function(s,p){return s.__v.__b-p.__v.__b}),Xc=[],c.some(function(s){var p,_,x,S,z,o;s.__d&&(z=(S=(p=s).__v).__e,(o=p.__P)&&(_=[],(x=Go({},S)).__v=S.__v+1,Np(o,S,x,p.__n,o.ownerSVGElement!==void 0,S.__h!=null?[z]:null,_,z==null?Ml(S):z,S.__h),Ry(_,S),S.__e!=z&&zy(S)))})}function Py(c,s,p,_,x,S,z,o,j,U){var F,$,J,G,ye,Te,Ue,Ve=_&&_.__k||Iy,T=Ve.length;for(p.__k=[],F=0;F<s.length;F++)if((G=p.__k[F]=(G=s[F])==null||typeof G=="boolean"?null:typeof G=="string"||typeof G=="number"||typeof G=="bigint"?Hc(null,G,null,null,G):Array.isArray(G)?Hc(Zo,{children:G},null,null,null):G.__b>0?Hc(G.type,G.props,G.key,null,G.__v):G)!=null){if(G.__=p,G.__b=p.__b+1,(J=Ve[F])===null||J&&G.key==J.key&&G.type===J.type)Ve[F]=void 0;else for($=0;$<T;$++){if((J=Ve[$])&&G.key==J.key&&G.type===J.type){Ve[$]=void 0;break}J=null}Np(c,G,J=J||dd,x,S,z,o,j,U),ye=G.__e,($=G.ref)&&J.ref!=$&&(Ue||(Ue=[]),J.ref&&Ue.push(J.ref,null,G),Ue.push($,G.__c||ye,G)),ye!=null?(Te==null&&(Te=ye),typeof G.type=="function"&&G.__k===J.__k?G.__d=j=Dy(G,j,c):j=Ly(c,G,J,Ve,ye,j),typeof p.type=="function"&&(p.__d=j)):j&&J.__e==j&&j.parentNode!=c&&(j=Ml(J))}for(p.__e=Te,F=T;F--;)Ve[F]!=null&&(typeof p.type=="function"&&Ve[F].__e!=null&&Ve[F].__e==p.__d&&(p.__d=Ml(_,F+1)),Oy(Ve[F],Ve[F]));if(Ue)for(F=0;F<Ue.length;F++)By(Ue[F],Ue[++F],Ue[++F])}function Dy(c,s,p){for(var _,x=c.__k,S=0;x&&S<x.length;S++)(_=x[S])&&(_.__=c,s=typeof _.type=="function"?Dy(_,s,p):Ly(p,_,_,x,_.__e,s));return s}function Ao(c,s){return s=s||[],c==null||typeof c=="boolean"||(Array.isArray(c)?c.some(function(p){Ao(p,s)}):s.push(c)),s}function Ly(c,s,p,_,x,S){var z,o,j;if(s.__d!==void 0)z=s.__d,s.__d=void 0;else if(p==null||x!=S||x.parentNode==null)e:if(S==null||S.parentNode!==c)c.appendChild(x),z=null;else{for(o=S,j=0;(o=o.nextSibling)&&j<_.length;j+=2)if(o==x)break e;c.insertBefore(x,S),z=S}return z!==void 0?z:x.nextSibling}function x1(c,s,p,_,x){var S;for(S in p)S==="children"||S==="key"||S in s||pd(c,S,null,p[S],_);for(S in s)x&&typeof s[S]!="function"||S==="children"||S==="key"||S==="value"||S==="checked"||p[S]===s[S]||pd(c,S,s[S],p[S],_)}function fg(c,s,p){s[0]==="-"?c.setProperty(s,p):c[s]=p==null?"":typeof p!="number"||v1.test(s)?p:p+"px"}function pd(c,s,p,_,x){var S;e:if(s==="style")if(typeof p=="string")c.style.cssText=p;else{if(typeof _=="string"&&(c.style.cssText=_=""),_)for(s in _)p&&s in p||fg(c.style,s,"");if(p)for(s in p)_&&p[s]===_[s]||fg(c.style,s,p[s])}else if(s[0]==="o"&&s[1]==="n")S=s!==(s=s.replace(/Capture$/,"")),s=s.toLowerCase()in c?s.toLowerCase().slice(2):s.slice(2),c.l||(c.l={}),c.l[s+S]=p,p?_||c.addEventListener(s,S?mg:pg,S):c.removeEventListener(s,S?mg:pg,S);else if(s!=="dangerouslySetInnerHTML"){if(x)s=s.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if(s!=="href"&&s!=="list"&&s!=="form"&&s!=="tabIndex"&&s!=="download"&&s in c)try{c[s]=p==null?"":p;break e}catch{}typeof p=="function"||(p!=null&&(p!==!1||s[0]==="a"&&s[1]==="r")?c.setAttribute(s,p):c.removeAttribute(s))}}function pg(c){this.l[c.type+!1](_t.event?_t.event(c):c)}function mg(c){this.l[c.type+!0](_t.event?_t.event(c):c)}function Np(c,s,p,_,x,S,z,o,j){var U,F,$,J,G,ye,Te,Ue,Ve,T,we,Le=s.type;if(s.constructor!==void 0)return null;p.__h!=null&&(j=p.__h,o=s.__e=p.__e,s.__h=null,S=[o]),(U=_t.__b)&&U(s);try{e:if(typeof Le=="function"){if(Ue=s.props,Ve=(U=Le.contextType)&&_[U.__c],T=U?Ve?Ve.props.value:U.__:_,p.__c?Te=(F=s.__c=p.__c).__=F.__E:("prototype"in Le&&Le.prototype.render?s.__c=F=new Le(Ue,T):(s.__c=F=new to(Ue,T),F.constructor=Le,F.render=w1),Ve&&Ve.sub(F),F.props=Ue,F.state||(F.state={}),F.context=T,F.__n=_,$=F.__d=!0,F.__h=[]),F.__s==null&&(F.__s=F.state),Le.getDerivedStateFromProps!=null&&(F.__s==F.state&&(F.__s=Go({},F.__s)),Go(F.__s,Le.getDerivedStateFromProps(Ue,F.__s))),J=F.props,G=F.state,$)Le.getDerivedStateFromProps==null&&F.componentWillMount!=null&&F.componentWillMount(),F.componentDidMount!=null&&F.__h.push(F.componentDidMount);else{if(Le.getDerivedStateFromProps==null&&Ue!==J&&F.componentWillReceiveProps!=null&&F.componentWillReceiveProps(Ue,T),!F.__e&&F.shouldComponentUpdate!=null&&F.shouldComponentUpdate(Ue,F.__s,T)===!1||s.__v===p.__v){F.props=Ue,F.state=F.__s,s.__v!==p.__v&&(F.__d=!1),F.__v=s,s.__e=p.__e,s.__k=p.__k,s.__k.forEach(function(qe){qe&&(qe.__=s)}),F.__h.length&&z.push(F);break e}F.componentWillUpdate!=null&&F.componentWillUpdate(Ue,F.__s,T),F.componentDidUpdate!=null&&F.__h.push(function(){F.componentDidUpdate(J,G,ye)})}F.context=T,F.props=Ue,F.state=F.__s,(U=_t.__r)&&U(s),F.__d=!1,F.__v=s,F.__P=c,U=F.render(F.props,F.state,F.context),F.state=F.__s,F.getChildContext!=null&&(_=Go(Go({},_),F.getChildContext())),$||F.getSnapshotBeforeUpdate==null||(ye=F.getSnapshotBeforeUpdate(J,G)),we=U!=null&&U.type===Zo&&U.key==null?U.props.children:U,Py(c,Array.isArray(we)?we:[we],s,p,_,x,S,z,o,j),F.base=s.__e,s.__h=null,F.__h.length&&z.push(F),Te&&(F.__E=F.__=null),F.__e=!1}else S==null&&s.__v===p.__v?(s.__k=p.__k,s.__e=p.__e):s.__e=b1(p.__e,s,p,_,x,S,z,j);(U=_t.diffed)&&U(s)}catch(qe){s.__v=null,(j||S!=null)&&(s.__e=o,s.__h=!!j,S[S.indexOf(o)]=null),_t.__e(qe,s,p)}}function Ry(c,s){_t.__c&&_t.__c(s,c),c.some(function(p){try{c=p.__h,p.__h=[],c.some(function(_){_.call(p)})}catch(_){_t.__e(_,p.__v)}})}function b1(c,s,p,_,x,S,z,o){var j,U,F,$=p.props,J=s.props,G=s.type,ye=0;if(G==="svg"&&(x=!0),S!=null){for(;ye<S.length;ye++)if((j=S[ye])&&"setAttribute"in j==!!G&&(G?j.localName===G:j.nodeType===3)){c=j,S[ye]=null;break}}if(c==null){if(G===null)return document.createTextNode(J);c=x?document.createElementNS("http://www.w3.org/2000/svg",G):document.createElement(G,J.is&&J),S=null,o=!1}if(G===null)$===J||o&&c.data===J||(c.data=J);else{if(S=S&&du.call(c.childNodes),U=($=p.props||dd).dangerouslySetInnerHTML,F=J.dangerouslySetInnerHTML,!o){if(S!=null)for($={},ye=0;ye<c.attributes.length;ye++)$[c.attributes[ye].name]=c.attributes[ye].value;(F||U)&&(F&&(U&&F.__html==U.__html||F.__html===c.innerHTML)||(c.innerHTML=F&&F.__html||""))}if(x1(c,J,$,x,o),F)s.__k=[];else if(ye=s.props.children,Py(c,Array.isArray(ye)?ye:[ye],s,p,_,x&&G!=="foreignObject",S,z,S?S[0]:p.__k&&Ml(p,0),o),S!=null)for(ye=S.length;ye--;)S[ye]!=null&&My(S[ye]);o||("value"in J&&(ye=J.value)!==void 0&&(ye!==c.value||G==="progress"&&!ye||G==="option"&&ye!==$.value)&&pd(c,"value",ye,$.value,!1),"checked"in J&&(ye=J.checked)!==void 0&&ye!==c.checked&&pd(c,"checked",ye,$.checked,!1))}return c}function By(c,s,p){try{typeof c=="function"?c(s):c.current=s}catch(_){_t.__e(_,p)}}function Oy(c,s,p){var _,x;if(_t.unmount&&_t.unmount(c),(_=c.ref)&&(_.current&&_.current!==c.__e||By(_,null,s)),(_=c.__c)!=null){if(_.componentWillUnmount)try{_.componentWillUnmount()}catch(S){_t.__e(S,s)}_.base=_.__P=null}if(_=c.__k)for(x=0;x<_.length;x++)_[x]&&Oy(_[x],s,typeof c.type!="function");p||c.__e==null||My(c.__e),c.__e=c.__d=void 0}function w1(c,s,p){return this.constructor(c,p)}function kl(c,s,p){var _,x,S;_t.__&&_t.__(c,s),x=(_=typeof p=="function")?null:p&&p.__k||s.__k,S=[],Np(s,c=(!_&&p||s).__k=_n(Zo,null,[c]),x||dd,dd,s.ownerSVGElement!==void 0,!_&&p?[p]:x?null:s.firstChild?du.call(s.childNodes):null,S,!_&&p?p:x?x.__e:s.firstChild,_),Ry(S,c)}function jp(c,s){kl(c,s,jp)}function Fy(c,s,p){var _,x,S,z=Go({},c.props);for(S in s)S=="key"?_=s[S]:S=="ref"?x=s[S]:z[S]=s[S];return arguments.length>2&&(z.children=arguments.length>3?du.call(arguments,2):p),Hc(c.type,z,_||c.key,x||c.ref,null)}function Cd(c,s){var p={__c:s="__cC"+Cy++,__:c,Consumer:function(_,x){return _.children(x)},Provider:function(_){var x,S;return this.getChildContext||(x=[],(S={})[s]=this,this.getChildContext=function(){return S},this.shouldComponentUpdate=function(z){this.props.value!==z.value&&x.some(mp)},this.sub=function(z){x.push(z);var o=z.componentWillUnmount;z.componentWillUnmount=function(){x.splice(x.indexOf(z),1),o&&o.call(z)}}),_.children}};return p.Provider.__=p.Consumer.contextType=p}du=Iy.slice,_t={__e:function(c,s){for(var p,_,x;s=s.__;)if((p=s.__c)&&!p.__)try{if((_=p.constructor)&&_.getDerivedStateFromError!=null&&(p.setState(_.getDerivedStateFromError(c)),x=p.__d),p.componentDidCatch!=null&&(p.componentDidCatch(c),x=p.__d),x)return p.__E=p}catch(S){c=S}throw c}},Sy=0,Ey=function(c){return c!=null&&c.constructor===void 0},to.prototype.setState=function(c,s){var p;p=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=Go({},this.state),typeof c=="function"&&(c=c(Go({},p),this.props)),c&&Go(p,c),c!=null&&this.__v&&(s&&this.__h.push(s),mp(this))},to.prototype.forceUpdate=function(c){this.__v&&(this.__e=!0,c&&this.__h.push(c),mp(this))},to.prototype.render=Zo,Xc=[],Ay=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,fd.__r=0,Cy=0;var T1=Object.freeze(Object.defineProperty({__proto__:null,render:kl,hydrate:jp,createElement:_n,h:_n,Fragment:Zo,createRef:ky,get isValidElement(){return Ey},Component:to,cloneElement:Fy,createContext:Cd,toChildArray:Ao,get options(){return _t}},Symbol.toStringTag,{value:"Module"})),Rl,Hr,_g,zl=0,Uy=[],gg=_t.__b,yg=_t.__r,vg=_t.diffed,xg=_t.__c,bg=_t.unmount;function fu(c,s){_t.__h&&_t.__h(Hr,c,zl||s),zl=0;var p=Hr.__H||(Hr.__H={__:[],__h:[]});return c>=p.__.length&&p.__.push({}),p.__[c]}function mn(c){return zl=1,Ny(jy,c)}function Ny(c,s,p){var _=fu(Rl++,2);return _.t=c,_.__c||(_.__=[p?p(s):jy(void 0,s),function(x){var S=_.t(_.__[0],x);_.__[0]!==S&&(_.__=[S,_.__[1]],_.__c.setState({}))}],_.__c=Hr),_.__}function si(c,s){var p=fu(Rl++,3);!_t.__s&&Vp(p.__H,s)&&(p.__=c,p.__H=s,Hr.__H.__h.push(p))}function fs(c,s){var p=fu(Rl++,4);!_t.__s&&Vp(p.__H,s)&&(p.__=c,p.__H=s,Hr.__h.push(p))}function Et(c){return zl=5,Kr(function(){return{current:c}},[])}function Bl(c,s,p){zl=6,fs(function(){typeof c=="function"?c(s()):c&&(c.current=s())},p==null?p:p.concat(c))}function Kr(c,s){var p=fu(Rl++,7);return Vp(p.__H,s)&&(p.__=c(),p.__H=s,p.__h=c),p.__}function ui(c,s){return zl=8,Kr(function(){return c},s)}function ps(c){var s=Hr.context[c.__c],p=fu(Rl++,9);return p.c=c,s?(p.__==null&&(p.__=!0,s.sub(Hr)),s.props.value):c.__}function $o(c,s){_t.useDebugValue&&_t.useDebugValue(s?s(c):c)}function S1(){for(var c;c=Uy.shift();)if(c.__P)try{c.__H.__h.forEach(nd),c.__H.__h.forEach(_p),c.__H.__h=[]}catch(s){c.__H.__h=[],_t.__e(s,c.__v)}}_t.__b=function(c){Hr=null,gg&&gg(c)},_t.__r=function(c){yg&&yg(c),Rl=0;var s=(Hr=c.__c).__H;s&&(s.__h.forEach(nd),s.__h.forEach(_p),s.__h=[])},_t.diffed=function(c){vg&&vg(c);var s=c.__c;s&&s.__H&&s.__H.__h.length&&(Uy.push(s)!==1&&_g===_t.requestAnimationFrame||((_g=_t.requestAnimationFrame)||function(p){var _,x=function(){clearTimeout(S),wg&&cancelAnimationFrame(_),setTimeout(p)},S=setTimeout(x,100);wg&&(_=requestAnimationFrame(x))})(S1)),Hr=null},_t.__c=function(c,s){s.some(function(p){try{p.__h.forEach(nd),p.__h=p.__h.filter(function(_){return!_.__||_p(_)})}catch(_){s.some(function(x){x.__h&&(x.__h=[])}),s=[],_t.__e(_,p.__v)}}),xg&&xg(c,s)},_t.unmount=function(c){bg&&bg(c);var s,p=c.__c;p&&p.__H&&(p.__H.__.forEach(function(_){try{nd(_)}catch(x){s=x}}),s&&_t.__e(s,p.__v))};var wg=typeof requestAnimationFrame=="function";function nd(c){var s=Hr,p=c.__c;typeof p=="function"&&(c.__c=void 0,p()),Hr=s}function _p(c){var s=Hr;c.__c=c.__(),Hr=s}function Vp(c,s){return!c||c.length!==s.length||s.some(function(p,_){return p!==c[_]})}function jy(c,s){return typeof s=="function"?s(c):s}function Vy(c,s){for(var p in s)c[p]=s[p];return c}function gp(c,s){for(var p in c)if(p!=="__source"&&!(p in s))return!0;for(var _ in s)if(_!=="__source"&&c[_]!==s[_])return!0;return!1}function yp(c){this.props=c}function Ta(c,s){function p(x){var S=this.props.ref,z=S==x.ref;return!z&&S&&(S.call?S(null):S.current=null),s?!s(this.props,x)||!z:gp(this.props,x)}function _(x){return this.shouldComponentUpdate=p,_n(c,x)}return _.displayName="Memo("+(c.displayName||c.name)+")",_.prototype.isReactComponent=!0,_.__f=!0,_}(yp.prototype=new to).isPureReactComponent=!0,yp.prototype.shouldComponentUpdate=function(c,s){return gp(this.props,c)||gp(this.state,s)};var Tg=_t.__b;_t.__b=function(c){c.type&&c.type.__f&&c.ref&&(c.props.ref=c.ref,c.ref=null),Tg&&Tg(c)};var E1=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function pu(c){function s(p,_){var x=Vy({},p);return delete x.ref,c(x,(_=p.ref||_)&&(typeof _!="object"||"current"in _)?_:null)}return s.$$typeof=E1,s.render=s,s.prototype.isReactComponent=s.__f=!0,s.displayName="ForwardRef("+(c.displayName||c.name)+")",s}var Sg=function(c,s){return c==null?null:Ao(Ao(c).map(s))},$p={map:Sg,forEach:Sg,count:function(c){return c?Ao(c).length:0},only:function(c){var s=Ao(c);if(s.length!==1)throw"Children.only";return s[0]},toArray:Ao},A1=_t.__e;_t.__e=function(c,s,p){if(c.then){for(var _,x=s;x=x.__;)if((_=x.__c)&&_.__c)return s.__e==null&&(s.__e=p.__e,s.__k=p.__k),_.__c(c,s)}A1(c,s,p)};var Eg=_t.unmount;function od(){this.__u=0,this.t=null,this.__b=null}function $y(c){var s=c.__.__c;return s&&s.__e&&s.__e(c)}function C1(c){var s,p,_;function x(S){if(s||(s=c()).then(function(z){p=z.default||z},function(z){_=z}),_)throw _;if(!p)throw s;return _n(p,S)}return x.displayName="Lazy",x.__f=!0,x}function Gc(){this.u=null,this.o=null}_t.unmount=function(c){var s=c.__c;s&&s.__R&&s.__R(),s&&c.__h===!0&&(c.type=null),Eg&&Eg(c)},(od.prototype=new to).__c=function(c,s){var p=s.__c,_=this;_.t==null&&(_.t=[]),_.t.push(p);var x=$y(_.__v),S=!1,z=function(){S||(S=!0,p.__R=null,x?x(o):o())};p.__R=z;var o=function(){if(!--_.__u){if(_.state.__e){var U=_.state.__e;_.__v.__k[0]=function $(J,G,ye){return J&&(J.__v=null,J.__k=J.__k&&J.__k.map(function(Te){return $(Te,G,ye)}),J.__c&&J.__c.__P===G&&(J.__e&&ye.insertBefore(J.__e,J.__d),J.__c.__e=!0,J.__c.__P=ye)),J}(U,U.__c.__P,U.__c.__O)}var F;for(_.setState({__e:_.__b=null});F=_.t.pop();)F.forceUpdate()}},j=s.__h===!0;_.__u++||j||_.setState({__e:_.__b=_.__v.__k[0]}),c.then(z,z)},od.prototype.componentWillUnmount=function(){this.t=[]},od.prototype.render=function(c,s){if(this.__b){if(this.__v.__k){var p=document.createElement("div"),_=this.__v.__k[0].__c;this.__v.__k[0]=function S(z,o,j){return z&&(z.__c&&z.__c.__H&&(z.__c.__H.__.forEach(function(U){typeof U.__c=="function"&&U.__c()}),z.__c.__H=null),(z=Vy({},z)).__c!=null&&(z.__c.__P===j&&(z.__c.__P=o),z.__c=null),z.__k=z.__k&&z.__k.map(function(U){return S(U,o,j)})),z}(this.__b,p,_.__O=_.__P)}this.__b=null}var x=s.__e&&_n(Zo,null,c.fallback);return x&&(x.__h=null),[_n(Zo,null,s.__e?null:c.children),x]};var Ag=function(c,s,p){if(++p[1]===p[0]&&c.o.delete(s),c.props.revealOrder&&(c.props.revealOrder[0]!=="t"||!c.o.size))for(p=c.u;p;){for(;p.length>3;)p.pop()();if(p[1]<p[0])break;c.u=p=p[2]}};function I1(c){return this.getChildContext=function(){return c.context},c.children}function M1(c){var s=this,p=c.i;s.componentWillUnmount=function(){kl(null,s.l),s.l=null,s.i=null},s.i&&s.i!==p&&s.componentWillUnmount(),c.__v?(s.l||(s.i=p,s.l={nodeType:1,parentNode:p,childNodes:[],appendChild:function(_){this.childNodes.push(_),s.i.appendChild(_)},insertBefore:function(_,x){this.childNodes.push(_),s.i.appendChild(_)},removeChild:function(_){this.childNodes.splice(this.childNodes.indexOf(_)>>>1,1),s.i.removeChild(_)}}),kl(_n(I1,{context:s.context},c.__v),s.l)):s.l&&s.componentWillUnmount()}function Id(c,s){return _n(M1,{__v:c,i:s})}(Gc.prototype=new to).__e=function(c){var s=this,p=$y(s.__v),_=s.o.get(c);return _[0]++,function(x){var S=function(){s.props.revealOrder?(_.push(x),Ag(s,c,_)):x()};p?p(S):S()}},Gc.prototype.render=function(c){this.u=null,this.o=new Map;var s=Ao(c.children);c.revealOrder&&c.revealOrder[0]==="b"&&s.reverse();for(var p=s.length;p--;)this.o.set(s[p],this.u=[1,0,this.u]);return c.children},Gc.prototype.componentDidUpdate=Gc.prototype.componentDidMount=function(){var c=this;this.o.forEach(function(s,p){Ag(c,p,s)})};var Gy=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.element")||60103,k1=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|marker(?!H|W|U)|overline|paint|stop|strikethrough|stroke|text(?!L)|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,z1=typeof document!="undefined",P1=function(c){return(typeof Symbol!="undefined"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(c)};function D1(c,s,p){return s.__k==null&&(s.textContent=""),kl(c,s),typeof p=="function"&&p(),c?c.__c:null}function L1(c,s,p){return jp(c,s),typeof p=="function"&&p(),c?c.__c:null}to.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(c){Object.defineProperty(to.prototype,c,{configurable:!0,get:function(){return this["UNSAFE_"+c]},set:function(s){Object.defineProperty(this,c,{configurable:!0,writable:!0,value:s})}})});var Cg=_t.event;function R1(){}function B1(){return this.cancelBubble}function O1(){return this.defaultPrevented}_t.event=function(c){return Cg&&(c=Cg(c)),c.persist=R1,c.isPropagationStopped=B1,c.isDefaultPrevented=O1,c.nativeEvent=c};var Zy,Ig={configurable:!0,get:function(){return this.class}},Mg=_t.vnode;_t.vnode=function(c){var s=c.type,p=c.props,_=p;if(typeof s=="string"){var x=s.indexOf("-")===-1;for(var S in _={},p){var z=p[S];z1&&S==="children"&&s==="noscript"||S==="value"&&"defaultValue"in p&&z==null||(S==="defaultValue"&&"value"in p&&p.value==null?S="value":S==="download"&&z===!0?z="":/ondoubleclick/i.test(S)?S="ondblclick":/^onchange(textarea|input)/i.test(S+s)&&!P1(p.type)?S="oninput":/^onfocus$/i.test(S)?S="onfocusin":/^onblur$/i.test(S)?S="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(S)?S=S.toLowerCase():x&&k1.test(S)?S=S.replace(/[A-Z0-9]/,"-$&").toLowerCase():z===null&&(z=void 0),_[S]=z)}s=="select"&&_.multiple&&Array.isArray(_.value)&&(_.value=Ao(p.children).forEach(function(o){o.props.selected=_.value.indexOf(o.props.value)!=-1})),s=="select"&&_.defaultValue!=null&&(_.value=Ao(p.children).forEach(function(o){o.props.selected=_.multiple?_.defaultValue.indexOf(o.props.value)!=-1:_.defaultValue==o.props.value})),c.props=_,p.class!=p.className&&(Ig.enumerable="className"in p,p.className!=null&&(_.class=p.className),Object.defineProperty(_,"className",Ig))}c.$$typeof=Gy,Mg&&Mg(c)};var kg=_t.__r;_t.__r=function(c){kg&&kg(c),Zy=c.__c};var F1={ReactCurrentDispatcher:{current:{readContext:function(c){return Zy.__n[c.__c].props.value}}}};function U1(c){return _n.bind(null,c)}function qy(c){return!!c&&c.$$typeof===Gy}function Wy(c){return qy(c)?Fy.apply(null,arguments):c}function N1(c){return!!c.__k&&(kl(null,c),!0)}function j1(c){return c&&(c.base||c.nodeType===1&&c)||null}var V1=function(c,s){return c(s)},$1=function(c,s){return c(s)},pn={useState:mn,useReducer:Ny,useEffect:si,useLayoutEffect:fs,useRef:Et,useImperativeHandle:Bl,useMemo:Kr,useCallback:ui,useContext:ps,useDebugValue:$o,version:"17.0.2",Children:$p,render:D1,hydrate:L1,unmountComponentAtNode:N1,createPortal:Id,createElement:_n,createContext:Cd,createFactory:U1,cloneElement:Wy,createRef:ky,Fragment:Zo,isValidElement:qy,findDOMNode:j1,Component:to,PureComponent:yp,memo:Ta,forwardRef:pu,flushSync:$1,unstable_batchedUpdates:V1,StrictMode:Zo,Suspense:od,SuspenseList:Gc,lazy:C1,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:F1},G1=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Z1(c){if(c.__esModule)return c;var s=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(c).forEach(function(p){var _=Object.getOwnPropertyDescriptor(c,p);Object.defineProperty(s,p,_.get?_:{enumerable:!0,get:function(){return c[p]}})}),s}var Gp={exports:{}};(function(c,s){(function(p,_){c.exports=_()})(G1,function(){var p,_,x;function S(o,j){if(!p)p=j;else if(!_)_=j;else{var U="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+p+")(sharedChunk); ("+_+")(sharedChunk); self.onerror = null;",F={};p(F),x=j(F),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(x.workerUrl=window.URL.createObjectURL(new Blob([U],{type:"text/javascript"})))}}S(["exports"],function(o){var j="2.7.1",U=F;function F(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n}F.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},F.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},F.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},F.prototype.solveCurveX=function(t,e){var r,n,l,u,f;for(e===void 0&&(e=1e-6),l=t,f=0;f<8;f++){if(u=this.sampleCurveX(l)-t,Math.abs(u)<e)return l;var g=this.sampleCurveDerivativeX(l);if(Math.abs(g)<1e-6)break;l-=u/g}if((l=t)<(r=0))return r;if(l>(n=1))return n;for(;r<n;){if(u=this.sampleCurveX(l),Math.abs(u-t)<e)return l;t>u?r=l:n=l,l=.5*(n-r)+r}return l},F.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var $=J;function J(t,e){this.x=t,this.y=e}J.prototype={clone:function(){return new J(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),l=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},J.convert=function(t){return t instanceof J?t:Array.isArray(t)?new J(t[0],t[1]):t};var G=typeof self!="undefined"?self:{},ye=1e-6,Te=typeof Float32Array!="undefined"?Float32Array:Array;function Ue(){var t=new Te(9);return Te!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Ve(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function T(t,e,r){var n=e[0],l=e[1],u=e[2],f=e[3],g=e[4],v=e[5],w=e[6],A=e[7],C=e[8],I=e[9],L=e[10],B=e[11],V=e[12],q=e[13],Q=e[14],oe=e[15],ce=r[0],de=r[1],pe=r[2],me=r[3];return t[0]=ce*n+de*g+pe*C+me*V,t[1]=ce*l+de*v+pe*I+me*q,t[2]=ce*u+de*w+pe*L+me*Q,t[3]=ce*f+de*A+pe*B+me*oe,t[4]=(ce=r[4])*n+(de=r[5])*g+(pe=r[6])*C+(me=r[7])*V,t[5]=ce*l+de*v+pe*I+me*q,t[6]=ce*u+de*w+pe*L+me*Q,t[7]=ce*f+de*A+pe*B+me*oe,t[8]=(ce=r[8])*n+(de=r[9])*g+(pe=r[10])*C+(me=r[11])*V,t[9]=ce*l+de*v+pe*I+me*q,t[10]=ce*u+de*w+pe*L+me*Q,t[11]=ce*f+de*A+pe*B+me*oe,t[12]=(ce=r[12])*n+(de=r[13])*g+(pe=r[14])*C+(me=r[15])*V,t[13]=ce*l+de*v+pe*I+me*q,t[14]=ce*u+de*w+pe*L+me*Q,t[15]=ce*f+de*A+pe*B+me*oe,t}function we(t,e,r){var n,l,u,f,g,v,w,A,C,I,L,B,V=r[0],q=r[1],Q=r[2];return e===t?(t[12]=e[0]*V+e[4]*q+e[8]*Q+e[12],t[13]=e[1]*V+e[5]*q+e[9]*Q+e[13],t[14]=e[2]*V+e[6]*q+e[10]*Q+e[14],t[15]=e[3]*V+e[7]*q+e[11]*Q+e[15]):(l=e[1],u=e[2],f=e[3],g=e[4],v=e[5],w=e[6],A=e[7],C=e[8],I=e[9],L=e[10],B=e[11],t[0]=n=e[0],t[1]=l,t[2]=u,t[3]=f,t[4]=g,t[5]=v,t[6]=w,t[7]=A,t[8]=C,t[9]=I,t[10]=L,t[11]=B,t[12]=n*V+g*q+C*Q+e[12],t[13]=l*V+v*q+I*Q+e[13],t[14]=u*V+w*q+L*Q+e[14],t[15]=f*V+A*q+B*Q+e[15]),t}function Le(t,e,r){var n=r[0],l=r[1],u=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*l,t[5]=e[5]*l,t[6]=e[6]*l,t[7]=e[7]*l,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function qe(t,e,r){var n=Math.sin(r),l=Math.cos(r),u=e[4],f=e[5],g=e[6],v=e[7],w=e[8],A=e[9],C=e[10],I=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*l+w*n,t[5]=f*l+A*n,t[6]=g*l+C*n,t[7]=v*l+I*n,t[8]=w*l-u*n,t[9]=A*l-f*n,t[10]=C*l-g*n,t[11]=I*l-v*n,t}function xe(t,e,r){var n=Math.sin(r),l=Math.cos(r),u=e[0],f=e[1],g=e[2],v=e[3],w=e[8],A=e[9],C=e[10],I=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*l-w*n,t[1]=f*l-A*n,t[2]=g*l-C*n,t[3]=v*l-I*n,t[8]=u*n+w*l,t[9]=f*n+A*l,t[10]=g*n+C*l,t[11]=v*n+I*l,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Se=T;function Oe(){var t=new Te(3);return Te!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ye(t){var e=new Te(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function rt(t){return Math.hypot(t[0],t[1],t[2])}function st(t,e,r){var n=new Te(3);return n[0]=t,n[1]=e,n[2]=r,n}function wt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function di(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Si(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Nt(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function Ni(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function qt(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function Ct(t,e){var r=e[0],n=e[1],l=e[2],u=r*r+n*n+l*l;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t[2]=e[2]*u,t}function fi(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Li(t,e,r){var n=e[0],l=e[1],u=e[2],f=r[0],g=r[1],v=r[2];return t[0]=l*v-u*g,t[1]=u*f-n*v,t[2]=n*g-l*f,t}function Tt(t,e,r){var n=e[0],l=e[1],u=e[2],f=r[3]*n+r[7]*l+r[11]*u+r[15];return t[0]=(r[0]*n+r[4]*l+r[8]*u+r[12])/(f=f||1),t[1]=(r[1]*n+r[5]*l+r[9]*u+r[13])/f,t[2]=(r[2]*n+r[6]*l+r[10]*u+r[14])/f,t}function pi(t,e,r){var n=r[0],l=r[1],u=r[2],f=e[0],g=e[1],v=e[2],w=l*v-u*g,A=u*f-n*v,C=n*g-l*f,I=l*C-u*A,L=u*w-n*C,B=n*A-l*w,V=2*r[3];return A*=V,C*=V,L*=2,B*=2,t[0]=f+(w*=V)+(I*=2),t[1]=g+A+L,t[2]=v+C+B,t}var Br,xn=di,Co=Si,Mn=rt;function pr(t,e,r){var n=e[0],l=e[1],u=e[2],f=e[3];return t[0]=r[0]*n+r[4]*l+r[8]*u+r[12]*f,t[1]=r[1]*n+r[5]*l+r[9]*u+r[13]*f,t[2]=r[2]*n+r[6]*l+r[10]*u+r[14]*f,t[3]=r[3]*n+r[7]*l+r[11]*u+r[15]*f,t}function io(){var t=new Te(4);return Te!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Io(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Mo(t,e,r){r*=.5;var n=e[0],l=e[1],u=e[2],f=e[3],g=Math.sin(r),v=Math.cos(r);return t[0]=n*v+f*g,t[1]=l*v+u*g,t[2]=u*v-l*g,t[3]=f*v-n*g,t}function ro(t,e){return t[0]===e[0]&&t[1]===e[1]}Oe(),Br=new Te(4),Te!=Float32Array&&(Br[0]=0,Br[1]=0,Br[2]=0,Br[3]=0),Oe(),st(1,0,0),st(0,1,0),io(),io(),Ue(),function(){var t;t=new Te(2),Te!=Float32Array&&(t[0]=0,t[1]=0)}();const Er=Math.PI/180,Or=180/Math.PI;function It(t){return t*Er}function ji(t){return t*Or}const Ar=[[0,0],[1,0],[1,1],[0,1]];function Yr(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}function Jr(t,e,r,n){const l=new U(t,e,r,n);return function(u){return l.solve(u)}}const kn=Jr(.25,.1,.25,1);function Vt(t,e,r){return Math.min(r,Math.max(e,t))}function Cr(t,e,r){return(r=Vt((r-t)/(e-t),0,1))*r*(3-2*r)}function vr(t,e,r){const n=r-e,l=((t-e)%n+n)%n+e;return l===e?r:l}function Qr(t,e,r){if(!t.length)return r(null,[]);let n=t.length;const l=new Array(t.length);let u=null;t.forEach((f,g)=>{e(f,(v,w)=>{v&&(u=v),l[g]=w,--n==0&&r(u,l)})})}function mr(t){const e=[];for(const r in t)e.push(t[r]);return e}function Wt(t,...e){for(const r of e)for(const n in r)t[n]=r[n];return t}let Ai=1;function zn(){return Ai++}function _r(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function wi(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function ko(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function no(t,e){t.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function xr(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Fr(t,e,r){const n={};for(const l in t)n[l]=e.call(r||this,t[l],l,t);return n}function oo(t,e,r){const n={};for(const l in t)e.call(r||this,t[l],l,t)&&(n[l]=t[l]);return n}function je(t){return Array.isArray(t)?t.map(je):typeof t=="object"&&t?Fr(t,je):t}const gt={};function Je(t){gt[t]||(typeof console!="undefined"&&console.warn(t),gt[t]=!0)}function St(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function li(t){let e=0;for(let r,n,l=0,u=t.length,f=u-1;l<u;f=l++)r=t[l],n=t[f],e+=(n.x-r.x)*(r.y+n.y);return e}function Dt(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function ei(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,n,l,u)=>{const f=l||u;return e[n]=!f||f.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let ti,ii,vt,Bt=null;function Ri(t){if(Bt==null){const e=t.navigator?t.navigator.userAgent:null;Bt=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Bt}function Ur(t){try{const e=G[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const zi={now:()=>vt!==void 0?vt:G.performance.now(),setNow(t){vt=t},restoreNow(){vt=void 0},frame(t){const e=G.requestAnimationFrame(t);return{cancel:()=>G.cancelAnimationFrame(e)}},getImageData(t,e=0){const r=G.document.createElement("canvas"),n=r.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return r.width=t.width,r.height=t.height,n.drawImage(t,0,0,t.width,t.height),n.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:t=>(ti||(ti=G.document.createElement("a")),ti.href=t,ti.href),get devicePixelRatio(){return G.devicePixelRatio},get prefersReducedMotion(){return!!G.matchMedia&&(ii==null&&(ii=G.matchMedia("(prefers-reduced-motion: reduce)")),ii.matches)}};let Y;const D={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Y==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Y={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):t}catch{Y=t}}return Y},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},O={supported:!1,testSupport:function(t){!le&&ee&&(he?fe(t):X=t)}};let X,ee,le=!1,he=!1;function fe(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ee),t.isContextLost())return;O.supported=!0}catch{}t.deleteTexture(e),le=!0}G.document&&(ee=G.document.createElement("img"),ee.onload=function(){X&&fe(X),X=null,he=!0},ee.onerror=function(){le=!0,X=null},ee.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ue="01",_e="NO_ACCESS_TOKEN";function Ie(t){return t.indexOf("mapbox:")===0}function Pe(t){return D.API_URL_REGEX.test(t)}const Be=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function lt(t){const e=t.match(Be);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ut(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function ht(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(G.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class dt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=ht(D.ACCESS_TOKEN);let n="";return n=r&&r.u?G.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(l,u)=>String.fromCharCode(Number("0x"+u)))):D.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=Ur("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const l=G.localStorage.getItem(r);l&&(this.eventData=JSON.parse(l));const u=G.localStorage.getItem(n);u&&(this.anonId=u)}catch{Je("Unable to read from LocalStorage")}}saveEventData(){const e=Ur("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{G.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&G.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{Je("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,n,l){if(!D.EVENTS_URL)return;const u=lt(D.EVENTS_URL);u.params.push(`access_token=${l||D.ACCESS_TOKEN||""}`);const f={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:j,skuId:ue,userId:this.anonId},g=r?Wt(f,r):f,v={url:ut(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=Pn(v,w=>{this.pendingRequest=null,n(w),this.saveEventData(),this.processRequests(l)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const Mt=new class extends dt{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){D.EVENTS_URL&&D.ACCESS_TOKEN&&Array.isArray(t)&&t.some(r=>Ie(r)||Pe(r))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=ht(D.ACCESS_TOKEN),r=e?e.u:D.ACCESS_TOKEN;let n=r!==this.eventData.tokenU;ko(this.anonId)||(this.anonId=_r(),n=!0);const l=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),f=new Date(l),g=(l-this.eventData.lastSuccess)/864e5;n=n||g>=1||g<-1||u.getDate()!==f.getDate()}else n=!0;if(!n)return this.processRequests();this.postEvent(l,{"enabled.telemetry":!1},u=>{u||(this.eventData.lastSuccess=l,this.eventData.tokenU=r)},t)}},ri=Mt.postTurnstileEvent.bind(Mt),ci=new class extends dt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,r,n){this.skuToken=e,this.errorCb=n,D.EVENTS_URL&&(r||D.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(_e)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),ko(this.anonId)||(this.anonId=_r()),this.postEvent(r,{skuToken:this.skuToken},n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t))}},oi=ci.postMapLoadEvent.bind(ci),gi=new class extends dt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,r,n){if(!D.API_URL||!D.SESSION_PATH)return;const l=lt(D.API_URL+D.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${n||D.ACCESS_TOKEN||""}`);const u={url:ut(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Dd(u,f=>{this.pendingRequest=null,r(f),this.saveEventData(),this.processRequests(n)})}getSessionAPI(t,e,r,n){this.skuToken=e,this.errorCb=n,D.SESSION_PATH&&D.API_URL&&(r||D.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(_e)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t)}},en=gi.getSessionAPI.bind(gi),tn=new Set,Vi="mapbox-tiles";let Nr,_s,gu=500,Ul=50;function Sa(){G.caches&&!Nr&&(Nr=G.caches.open(Vi))}function Nl(t){const e=t.indexOf("?");return e<0?t:t.slice(0,e)}let gs=1/0;const ys={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ys);class Ea extends Error{constructor(e,r,n){r===401&&Pe(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const jl=Dt()?()=>self.worker&&self.worker.referrer:()=>(G.location.protocol==="blob:"?G.parent:G).location.href,bn=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(jl())&&!/^\w+:/.test(r))){if(G.fetch&&G.Request&&G.AbortController&&G.Request.prototype.hasOwnProperty("signal"))return function(n,l){const u=new G.AbortController,f=new G.Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:jl(),signal:u.signal});let g=!1,v=!1;const w=(A=f.url).indexOf("sku=")>0&&Pe(A);var A;n.type==="json"&&f.headers.set("Accept","application/json");const C=(L,B,V)=>{if(v)return;if(L&&L.message!=="SecurityError"&&Je(L),B&&V)return I(B);const q=Date.now();G.fetch(f).then(Q=>{if(Q.ok){const oe=w?Q.clone():null;return I(Q,oe,q)}return l(new Ea(Q.statusText,Q.status,n.url))}).catch(Q=>{Q.code!==20&&l(new Error(Q.message))})},I=(L,B,V)=>{(n.type==="arrayBuffer"?L.arrayBuffer():n.type==="json"?L.json():L.text()).then(q=>{v||(B&&V&&function(Q,oe,ce){if(Sa(),!Nr)return;const de={status:oe.status,statusText:oe.statusText,headers:new G.Headers};oe.headers.forEach((me,ke)=>de.headers.set(ke,me));const pe=ei(oe.headers.get("Cache-Control")||"");pe["no-store"]||(pe["max-age"]&&de.headers.set("Expires",new Date(ce+1e3*pe["max-age"]).toUTCString()),new Date(de.headers.get("Expires")).getTime()-ce<42e4||function(me,ke){if(_s===void 0)try{new Response(new ReadableStream),_s=!0}catch{_s=!1}_s?ke(me.body):me.blob().then(ke)}(oe,me=>{const ke=new G.Response(me,de);Sa(),Nr&&Nr.then(Ce=>Ce.put(Nl(Q.url),ke)).catch(Ce=>Je(Ce.message))}))}(f,B,V),g=!0,l(null,q,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(q=>{v||l(new Error(q.message))})};return w?function(L,B){if(Sa(),!Nr)return B(null);const V=Nl(L.url);Nr.then(q=>{q.match(V).then(Q=>{const oe=function(ce){if(!ce)return!1;const de=new Date(ce.headers.get("Expires")||0),pe=ei(ce.headers.get("Cache-Control")||"");return de>Date.now()&&!pe["no-cache"]}(Q);q.delete(V),oe&&q.put(V,Q.clone()),B(null,Q,oe)}).catch(B)}).catch(B)}(f,C):C(null,null),{cancel:()=>{v=!0,g||u.abort()}}}(t,e);if(Dt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(n,l){const u=new G.XMLHttpRequest;u.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const f in n.headers)u.setRequestHeader(f,n.headers[f]);return n.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=n.credentials==="include",u.onerror=()=>{l(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let f=u.response;if(n.type==="json")try{f=JSON.parse(u.response)}catch(g){return l(g)}l(null,f,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else l(new Ea(u.statusText,u.status,n.url))},u.send(n.body),{cancel:()=>u.abort()}}(t,e)},Aa=function(t,e){return bn(Wt(t,{type:"arrayBuffer"}),e)},Pn=function(t,e){return bn(Wt(t,{method:"POST"}),e)},Dd=function(t,e){return bn(Wt(t,{method:"GET"}),e)};function yu(t){const e=G.document.createElement("a");return e.href=t,e.protocol===G.document.location.protocol&&e.host===G.document.location.host}const qo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Wo,Ca;Wo=[],Ca=0;const vu=function(t,e){if(O.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ca>=D.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Wo.push(u),u}Ca++;let r=!1;const n=()=>{if(!r)for(r=!0,Ca--;Wo.length&&Ca<D.MAX_PARALLEL_IMAGE_REQUESTS;){const u=Wo.shift(),{requestParameters:f,callback:g,cancelled:v}=u;v||(u.cancel=vu(f,g).cancel)}},l=Aa(t,(u,f,g,v)=>{n(),u?e(u):f&&(G.createImageBitmap?function(w,A){const C=new G.Blob([new Uint8Array(w)],{type:"image/png"});G.createImageBitmap(C).then(I=>{A(null,I)}).catch(I=>{A(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(w,A)=>e(w,A,g,v)):function(w,A){const C=new G.Image,I=G.URL;C.onload=()=>{A(null,C),I.revokeObjectURL(C.src),C.onload=null,G.requestAnimationFrame(()=>{C.src=qo})},C.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new G.Blob([new Uint8Array(w)],{type:"image/png"});C.src=w.byteLength?I.createObjectURL(L):qo}(f,(w,A)=>e(w,A,g,v)))});return{cancel:()=>{l.cancel(),n()}}};function xu(t,e,r){r[t]&&r[t].indexOf(e)!==-1||(r[t]=r[t]||[],r[t].push(e))}function vs(t,e,r){if(r&&r[t]){const n=r[t].indexOf(e);n!==-1&&r[t].splice(n,1)}}class ao{constructor(e,r={}){Wt(this,r),this.type=e}}class xs extends ao{constructor(e,r={}){super("error",Wt({error:e},r))}}class so{on(e,r){return this._listeners=this._listeners||{},xu(e,r,this._listeners),this}off(e,r){return vs(e,r,this._listeners),vs(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},xu(e,r,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,r){typeof e=="string"&&(e=new ao(e,r||{}));const n=e.type;if(this.listens(n)){e.target=this;const l=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const g of l)g.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const g of u)vs(n,g,this._oneTimeListeners),g.call(this,e);const f=this._eventedParent;f&&(Wt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(e))}else e instanceof xs&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Ee=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class et{constructor(e,r,n,l){this.message=(e?`${e}: `:"")+n,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function bu(t){const e=t.value;return e?[new et(t.key,e,"constants have been deprecated as of v8")]:[]}function lo(t,...e){for(const r of e)for(const n in r)t[n]=r[n];return t}function $i(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function jn(t){if(Array.isArray(t))return t.map(jn);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const r in t)e[r]=jn(t[r]);return e}return $i(t)}class Dn extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class bs{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[n,l]of r)this.bindings[n]=l}concat(e){return new bs(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const co={kind:"null"},Qe={kind:"number"},Ot={kind:"string"},zt={kind:"boolean"},Ln={kind:"color"},Xo={kind:"object"},Pt={kind:"value"},Ia={kind:"collator"},uo={kind:"formatted"},Ma={kind:"resolvedImage"};function rn(t,e){return{kind:"array",itemType:t,N:e}}function Bi(t){if(t.kind==="array"){const e=Bi(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const Ld=[co,Qe,Ot,zt,Ln,uo,Xo,rn(Pt),Ma];function Ir(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ir(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const r of Ld)if(!Ir(r,e))return null}}return`Expected ${Bi(t)} but found ${Bi(e)} instead.`}function ws(t,e){return e.some(r=>r.kind===t.kind)}function Ho(t,e){return e.some(r=>r==="null"?t===null:r==="array"?Array.isArray(t):r==="object"?t&&!Array.isArray(t)&&typeof t=="object":r===typeof t)}function Ko(t){var e={exports:{}};return t(e,e.exports),e.exports}var Yo=Ko(function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(g){return(g=Math.round(g))<0?0:g>255?255:g}function l(g){return n(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function u(g){return(v=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:v>1?1:v;var v}function f(g,v,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?g+(v-g)*w*6:2*w<1?v:3*w<2?g+(v-g)*(2/3-w)*6:g}try{e.parseCSSColor=function(g){var v,w=g.replace(/ /g,"").toLowerCase();if(w in r)return r[w].slice();if(w[0]==="#")return w.length===4?(v=parseInt(w.substr(1),16))>=0&&v<=4095?[(3840&v)>>4|(3840&v)>>8,240&v|(240&v)>>4,15&v|(15&v)<<4,1]:null:w.length===7&&(v=parseInt(w.substr(1),16))>=0&&v<=16777215?[(16711680&v)>>16,(65280&v)>>8,255&v,1]:null;var A=w.indexOf("("),C=w.indexOf(")");if(A!==-1&&C+1===w.length){var I=w.substr(0,A),L=w.substr(A+1,C-(A+1)).split(","),B=1;switch(I){case"rgba":if(L.length!==4)return null;B=u(L.pop());case"rgb":return L.length!==3?null:[l(L[0]),l(L[1]),l(L[2]),B];case"hsla":if(L.length!==4)return null;B=u(L.pop());case"hsl":if(L.length!==3)return null;var V=(parseFloat(L[0])%360+360)%360/360,q=u(L[1]),Q=u(L[2]),oe=Q<=.5?Q*(q+1):Q+q-Q*q,ce=2*Q-oe;return[n(255*f(ce,oe,V+1/3)),n(255*f(ce,oe,V)),n(255*f(ce,oe,V-1/3)),B];default:return null}}return null}}catch{}});class Xt{constructor(e,r,n,l=1){this.r=e,this.g=r,this.b=n,this.a=l}static parse(e){if(!e)return;if(e instanceof Xt)return e;if(typeof e!="string")return;const r=Yo.parseCSSColor(e);return r?new Xt(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,n,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(n)},${l})`}toArray(){const{r:e,g:r,b:n,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*r/l,255*n/l,l]}}Xt.black=new Xt(0,0,0,1),Xt.white=new Xt(1,1,1,1),Xt.transparent=new Xt(0,0,0,0),Xt.red=new Xt(1,0,0,1),Xt.blue=new Xt(0,0,1,1);class Ts{constructor(e,r,n){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Vl{constructor(e,r,n,l,u){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=n,this.fontStack=l,this.textColor=u}}class At{constructor(e){this.sections=e}static fromString(e){return new At([new Vl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof At?e:At.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const n={};r.fontStack&&(n["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(n["font-scale"]=r.scale),r.textColor&&(n["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(n)}return e}}class nn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new nn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function wu(t,e,r,n){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[t,e,r,n]:[t,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ss(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Xt||t instanceof Ts||t instanceof At||t instanceof nn)return!0;if(Array.isArray(t)){for(const e of t)if(!Ss(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Ss(t[e]))return!1;return!0}return!1}function qi(t){if(t===null)return co;if(typeof t=="string")return Ot;if(typeof t=="boolean")return zt;if(typeof t=="number")return Qe;if(t instanceof Xt)return Ln;if(t instanceof Ts)return Ia;if(t instanceof At)return uo;if(t instanceof nn)return Ma;if(Array.isArray(t)){const e=t.length;let r;for(const n of t){const l=qi(n);if(r){if(r===l)continue;r=Pt;break}r=l}return rn(r||Pt,e)}return Xo}function ka(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Xt||t instanceof At||t instanceof nn?t.toString():JSON.stringify(t)}class ho{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ss(e[1]))return r.error("invalid value");const n=e[1];let l=qi(n);const u=r.expectedType;return l.kind!=="array"||l.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(l=u),new ho(l,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Xt?["rgba"].concat(this.value.toArray()):this.value instanceof At?this.value.serialize():this.value}}class rr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Es={string:Ot,number:Qe,boolean:zt,object:Xo};class on{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let n,l=1;const u=e[0];if(u==="array"){let g,v;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in Es)||w==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);g=Es[w],l++}else g=Pt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);v=e[2],l++}n=rn(g,v)}else n=Es[u];const f=[];for(;l<e.length;l++){const g=r.parse(e[l],l,Pt);if(!g)return null;f.push(g)}return new on(n,f)}evaluate(e){for(let r=0;r<this.args.length;r++){const n=this.args[r].evaluate(e);if(!Ir(this.type,qi(n)))return n;if(r===this.args.length-1)throw new rr(`Expected value to be of type ${Bi(this.type)}, but found ${Bi(qi(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){r.push(n.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&r.push(l)}}return r.concat(this.args.map(n=>n.serialize()))}}class Rn{constructor(e){this.type=uo,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return r.error("First argument must be an image or text section.");const l=[];let u=!1;for(let f=1;f<=e.length-1;++f){const g=e[f];if(u&&typeof g=="object"&&!Array.isArray(g)){u=!1;let v=null;if(g["font-scale"]&&(v=r.parse(g["font-scale"],1,Qe),!v))return null;let w=null;if(g["text-font"]&&(w=r.parse(g["text-font"],1,rn(Ot)),!w))return null;let A=null;if(g["text-color"]&&(A=r.parse(g["text-color"],1,Ln),!A))return null;const C=l[l.length-1];C.scale=v,C.font=w,C.textColor=A}else{const v=r.parse(e[f],1,Pt);if(!v)return null;const w=v.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:v,scale:null,font:null,textColor:null})}}return new Rn(l)}evaluate(e){return new At(this.sections.map(r=>{const n=r.content.evaluate(e);return qi(n)===Ma?new Vl("",n,null,null,null):new Vl(ka(n),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const n={};r.scale&&(n["font-scale"]=r.scale.serialize()),r.font&&(n["text-font"]=r.font.serialize()),r.textColor&&(n["text-color"]=r.textColor.serialize()),e.push(n)}return e}}class zo{constructor(e){this.type=Ma,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const n=r.parse(e[1],1,Ot);return n?new zo(n):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),n=nn.fromString(r);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(r)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Rd={"to-boolean":zt,"to-color":Ln,"to-number":Qe,"to-string":Ot};class Bn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const n=e[0];if((n==="to-boolean"||n==="to-string")&&e.length!==2)return r.error("Expected one argument.");const l=Rd[n],u=[];for(let f=1;f<e.length;f++){const g=r.parse(e[f],f,Pt);if(!g)return null;u.push(g)}return new Bn(l,u)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,n;for(const l of this.args){if(r=l.evaluate(e),n=null,r instanceof Xt)return r;if(typeof r=="string"){const u=e.parseColor(r);if(u)return u}else if(Array.isArray(r)&&(n=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:wu(r[0],r[1],r[2],r[3]),!n))return new Xt(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new rr(n||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const n of this.args){if(r=n.evaluate(e),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new rr(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?At.fromString(ka(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?nn.fromString(ka(this.args[0].evaluate(e))):ka(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Rn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new zo(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Tu=["Unknown","Point","LineString","Polygon"];class Su{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Tu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:n,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*r-e[0])+this.featureDistanceData.bearing[1]*(l*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Xt.parse(e)),r}}class jr{constructor(e,r,n,l){this.name=e,this.type=r,this._evaluate=n,this.args=l}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const n=e[0],l=jr.definitions[n];if(!l)return r.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,g=f.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let v=null;for(const[w,A]of g){v=new Is(r.registry,r.path,null,r.scope);const C=[];let I=!1;for(let L=1;L<e.length;L++){const B=e[L],V=Array.isArray(w)?w[L-1]:w.type,q=v.parse(B,1+C.length,V);if(!q){I=!0;break}C.push(q)}if(!I)if(Array.isArray(w)&&w.length!==C.length)v.error(`Expected ${w.length} arguments, but found ${C.length} instead.`);else{for(let L=0;L<C.length;L++){const B=Array.isArray(w)?w[L]:w.type,V=C[L];v.concat(L+1).checkSubtype(B,V.type)}if(v.errors.length===0)return new jr(n,u,A,C)}}if(g.length===1)r.errors.push(...v.errors);else{const w=(g.length?g:f).map(([C])=>{return I=C,Array.isArray(I)?`(${I.map(Bi).join(", ")})`:`(${Bi(I.type)}...)`;var I}).join(" | "),A=[];for(let C=1;C<e.length;C++){const I=r.parse(e[C],1+A.length);if(!I)return null;A.push(Bi(I.type))}r.error(`Expected arguments of type ${w}, but found (${A.join(", ")}) instead.`)}return null}static register(e,r){jr.definitions=r;for(const n in r)e[n]=jr}}class za{constructor(e,r,n){this.type=Ia,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return r.error("Collator options argument must be an object.");const l=r.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,zt);if(!l)return null;const u=r.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,zt);if(!u)return null;let f=null;return n.locale&&(f=r.parse(n.locale,1,Ot),!f)?null:new za(l,u,f)}evaluate(e){return new Ts(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const fo=8192;function As(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Pa(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Eu(t,e){const r=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(r*l*fo),Math.round(n*l*fo)]}function Au(t,e,r){const n=t[0]-e[0],l=t[1]-e[1],u=t[0]-r[0],f=t[1]-r[1];return n*f-u*l==0&&n*u<=0&&l*f<=0}function $l(t,e){let r=!1;for(let f=0,g=e.length;f<g;f++){const v=e[f];for(let w=0,A=v.length;w<A-1;w++){if(Au(t,v[w],v[w+1]))return!1;(l=v[w])[1]>(n=t)[1]!=(u=v[w+1])[1]>n[1]&&n[0]<(u[0]-l[0])*(n[1]-l[1])/(u[1]-l[1])+l[0]&&(r=!r)}}var n,l,u;return r}function Cu(t,e){for(let r=0;r<e.length;r++)if($l(t,e[r]))return!0;return!1}function Gl(t,e,r,n){const l=n[0]-r[0],u=n[1]-r[1],f=(t[0]-r[0])*u-l*(t[1]-r[1]),g=(e[0]-r[0])*u-l*(e[1]-r[1]);return f>0&&g<0||f<0&&g>0}function Bd(t,e,r){for(const w of r)for(let A=0;A<w.length-1;++A)if((g=[(f=w[A+1])[0]-(u=w[A])[0],f[1]-u[1]])[0]*(v=[(l=e)[0]-(n=t)[0],l[1]-n[1]])[1]-g[1]*v[0]!=0&&Gl(n,l,u,f)&&Gl(u,f,n,l))return!0;var n,l,u,f,g,v;return!1}function Iu(t,e){for(let r=0;r<t.length;++r)if(!$l(t[r],e))return!1;for(let r=0;r<t.length-1;++r)if(Bd(t[r],t[r+1],e))return!1;return!0}function Od(t,e){for(let r=0;r<e.length;r++)if(Iu(t,e[r]))return!0;return!1}function Zl(t,e,r){const n=[];for(let l=0;l<t.length;l++){const u=[];for(let f=0;f<t[l].length;f++){const g=Eu(t[l][f],r);As(e,g),u.push(g)}n.push(u)}return n}function Mu(t,e,r){const n=[];for(let l=0;l<t.length;l++){const u=Zl(t[l],e,r);n.push(u)}return n}function ql(t,e,r,n){if(t[0]<r[0]||t[0]>r[2]){const l=.5*n;let u=t[0]-r[0]>l?-n:r[0]-t[0]>l?n:0;u===0&&(u=t[0]-r[2]>l?-n:r[2]-t[0]>l?n:0),t[0]+=u}As(e,t)}function ku(t,e,r,n){const l=Math.pow(2,n.z)*fo,u=[n.x*fo,n.y*fo],f=[];for(const g of t)for(const v of g){const w=[v.x+u[0],v.y+u[1]];ql(w,e,r,l),f.push(w)}return f}function zu(t,e,r,n){const l=Math.pow(2,n.z)*fo,u=[n.x*fo,n.y*fo],f=[];for(const v of t){const w=[];for(const A of v){const C=[A.x+u[0],A.y+u[1]];As(e,C),w.push(C)}f.push(w)}if(e[2]-e[0]<=l/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const v of f)for(const w of v)ql(w,e,r,l)}var g;return f}class Po{constructor(e,r){this.type=zt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ss(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let l=0;l<n.features.length;++l){const u=n.features[l].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Po(n,n.features[l].geometry)}else if(n.type==="Feature"){const l=n.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Po(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new Po(n,n)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,n){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(n.type==="Polygon"){const g=Zl(n.coordinates,u,f),v=ku(r.geometry(),l,u,f);if(!Pa(l,u))return!1;for(const w of v)if(!$l(w,g))return!1}if(n.type==="MultiPolygon"){const g=Mu(n.coordinates,u,f),v=ku(r.geometry(),l,u,f);if(!Pa(l,u))return!1;for(const w of v)if(!Cu(w,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,n){const l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(n.type==="Polygon"){const g=Zl(n.coordinates,u,f),v=zu(r.geometry(),l,u,f);if(!Pa(l,u))return!1;for(const w of v)if(!Iu(w,g))return!1}if(n.type==="MultiPolygon"){const g=Mu(n.coordinates,u,f),v=zu(r.geometry(),l,u,f);if(!Pa(l,u))return!1;for(const w of v)if(!Od(w,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Jo(t){if(t instanceof jr&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Po)return!1;let e=!0;return t.eachChild(r=>{e&&!Jo(r)&&(e=!1)}),e}function Da(t){if(t instanceof jr&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(r=>{e&&!Da(r)&&(e=!1)}),e}function La(t,e){if(t instanceof jr&&e.indexOf(t.name)>=0)return!1;let r=!0;return t.eachChild(n=>{r&&!La(n,e)&&(r=!1)}),r}class Cs{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const n=e[1];return r.scope.has(n)?new Cs(n,r.scope.get(n)):r.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Is{constructor(e,r=[],n,l=new bs,u=[]){this.registry=e,this.path=r,this.key=r.map(f=>`[${f}]`).join(""),this.scope=l,this.errors=u,this.expectedType=n}parse(e,r,n,l,u={}){return r?this.concat(r,n,l)._parse(e,u):this._parse(e,u)}_parse(e,r){function n(l,u,f){return f==="assert"?new on(u,[l]):f==="coerce"?new Bn(u,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=e[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const u=this.registry[l];if(u){let f=u.parse(e,this);if(!f)return null;if(this.expectedType){const g=this.expectedType,v=f.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||v.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(g,v))return null}else f=n(f,g,r.typeAnnotation||"coerce");else f=n(f,g,r.typeAnnotation||"assert")}if(!(f instanceof ho)&&f.type.kind!=="resolvedImage"&&Ms(f)){const g=new Su;try{f=new ho(f.type,f.evaluate(g))}catch(v){return this.error(v.message),null}}return f}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,n){const l=typeof e=="number"?this.path.concat(e):this.path,u=n?this.scope.concat(n):this.scope;return new Is(this.registry,l,r||null,u,this.errors)}error(e,...r){const n=`${this.key}${r.map(l=>`[${l}]`).join("")}`;this.errors.push(new Dn(n,e))}checkSubtype(e,r){const n=Ir(e,r);return n&&this.error(n),n}}function Ms(t){if(t instanceof Cs)return Ms(t.boundExpression);if(t instanceof jr&&t.name==="error"||t instanceof za||t instanceof Po)return!1;const e=t instanceof Bn||t instanceof on;let r=!0;return t.eachChild(n=>{r=e?r&&Ms(n):r&&n instanceof ho}),!!r&&Jo(t)&&La(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ra(t,e){const r=t.length-1;let n,l,u=0,f=r,g=0;for(;u<=f;)if(g=Math.floor((u+f)/2),n=t[g],l=t[g+1],n<=e){if(g===r||e<l)return g;u=g+1}else{if(!(n>e))throw new rr("Input is not a number.");f=g-1}return 0}class Ba{constructor(e,r,n){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[l,u]of n)this.labels.push(l),this.outputs.push(u)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const n=r.parse(e[1],1,Qe);if(!n)return null;const l=[];let u=null;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);for(let f=1;f<e.length;f+=2){const g=f===1?-1/0:e[f],v=e[f+1],w=f,A=f+1;if(typeof g!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(l.length&&l[l.length-1][0]>=g)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const C=r.parse(v,A,u);if(!C)return null;u=u||C.type,l.push([g,C])}return new Ba(u,n,l)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return n[0].evaluate(e);const u=r.length;return l>=r[u-1]?n[u-1].evaluate(e):n[Ra(r,l)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}function ni(t,e,r){return t*(1-r)+e*r}var ks=Object.freeze({__proto__:null,number:ni,color:function(t,e,r){return new Xt(ni(t.r,e.r,r),ni(t.g,e.g,r),ni(t.b,e.b,r),ni(t.a,e.a,r))},array:function(t,e,r){return t.map((n,l)=>ni(n,e[l],r))}});const Pu=.95047,Oa=1.08883,Wl=4/29,zs=6/29,Du=3*zs*zs,Fd=Math.PI/180,Ud=180/Math.PI;function Ps(t){return t>.008856451679035631?Math.pow(t,1/3):t/Du+Wl}function Ds(t){return t>zs?t*t*t:Du*(t-Wl)}function Ls(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Fa(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Lu(t){const e=Fa(t.r),r=Fa(t.g),n=Fa(t.b),l=Ps((.4124564*e+.3575761*r+.1804375*n)/Pu),u=Ps((.2126729*e+.7151522*r+.072175*n)/1);return{l:116*u-16,a:500*(l-u),b:200*(u-Ps((.0193339*e+.119192*r+.9503041*n)/Oa)),alpha:t.a}}function Ru(t){let e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*Ds(e),r=Pu*Ds(r),n=Oa*Ds(n),new Xt(Ls(3.2404542*r-1.5371385*e-.4985314*n),Ls(-.969266*r+1.8760108*e+.041556*n),Ls(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}function Nd(t,e,r){const n=e-t;return t+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const Ua={forward:Lu,reverse:Ru,interpolate:function(t,e,r){return{l:ni(t.l,e.l,r),a:ni(t.a,e.a,r),b:ni(t.b,e.b,r),alpha:ni(t.alpha,e.alpha,r)}}},Na={forward:function(t){const{l:e,a:r,b:n}=Lu(t),l=Math.atan2(n,r)*Ud;return{h:l<0?l+360:l,c:Math.sqrt(r*r+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Fd,r=t.c;return Ru({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:Nd(t.h,e.h,r),c:ni(t.c,e.c,r),l:ni(t.l,e.l,r),alpha:ni(t.alpha,e.alpha,r)}}};var Bu=Object.freeze({__proto__:null,lab:Ua,hcl:Na});class Mr{constructor(e,r,n,l,u){this.type=e,this.operator=r,this.interpolation=n,this.input=l,this.labels=[],this.outputs=[];for(const[f,g]of u)this.labels.push(f),this.outputs.push(g)}static interpolationFactor(e,r,n,l){let u=0;if(e.name==="exponential")u=Rs(r,e.base,n,l);else if(e.name==="linear")u=Rs(r,1,n,l);else if(e.name==="cubic-bezier"){const f=e.controlPoints;u=new U(f[0],f[1],f[2],f[3]).solve(Rs(r,1,n,l))}return u}static parse(e,r){let[n,l,u,...f]=e;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const w=l[1];if(typeof w!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:w}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const w=l.slice(1);if(w.length!==4||w.some(A=>typeof A!="number"||A<0||A>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(u=r.parse(u,2,Qe),!u)return null;const g=[];let v=null;n==="interpolate-hcl"||n==="interpolate-lab"?v=Ln:r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType);for(let w=0;w<f.length;w+=2){const A=f[w],C=f[w+1],I=w+3,L=w+4;if(typeof A!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(g.length&&g[g.length-1][0]>=A)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const B=r.parse(C,L,v);if(!B)return null;v=v||B.type,g.push([A,B])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new Mr(v,n,l,u,g):r.error(`Type ${Bi(v)} is not interpolatable.`)}evaluate(e){const r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);const l=this.input.evaluate(e);if(l<=r[0])return n[0].evaluate(e);const u=r.length;if(l>=r[u-1])return n[u-1].evaluate(e);const f=Ra(r,l),g=Mr.interpolationFactor(this.interpolation,l,r[f],r[f+1]),v=n[f].evaluate(e),w=n[f+1].evaluate(e);return this.operator==="interpolate"?ks[this.type.kind.toLowerCase()](v,w,g):this.operator==="interpolate-hcl"?Na.reverse(Na.interpolate(Na.forward(v),Na.forward(w),g)):Ua.reverse(Ua.interpolate(Ua.forward(v),Ua.forward(w),g))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)r.push(this.labels[n],this.outputs[n].serialize());return r}}function Rs(t,e,r,n){const l=n-r,u=t-r;return l===0?0:e===1?u/l:(Math.pow(e,u)-1)/(Math.pow(e,l)-1)}class Do{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let n=null;const l=r.expectedType;l&&l.kind!=="value"&&(n=l);const u=[];for(const g of e.slice(1)){const v=r.parse(g,1+u.length,n,void 0,{typeAnnotation:"omit"});if(!v)return null;n=n||v.type,u.push(v)}const f=l&&u.some(g=>Ir(l,g.type));return new Do(f?Pt:n,u)}evaluate(e){let r,n=null,l=0;for(const u of this.args){if(l++,n=u.evaluate(e),n&&n instanceof nn&&!n.available&&(r||(r=n),n=null,l===this.args.length))return r;if(n!==null)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Bs{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let u=1;u<e.length-1;u+=2){const f=e[u];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,u);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",u);const g=r.parse(e[u+1],u+1);if(!g)return null;n.push([f,g])}const l=r.parse(e[e.length-1],e.length-1,r.expectedType,n);return l?new Bs(n,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,n]of this.bindings)e.push(r,n.serialize());return e.push(this.result.serialize()),e}}class Xl{constructor(e,r,n){this.type=e,this.index=r,this.input=n}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Qe),l=r.parse(e[2],2,rn(r.expectedType||Pt));return n&&l?new Xl(l.type.itemType,n,l):null}evaluate(e){const r=this.index.evaluate(e),n=this.input.evaluate(e);if(r<0)throw new rr(`Array index out of bounds: ${r} < 0.`);if(r>=n.length)throw new rr(`Array index out of bounds: ${r} > ${n.length-1}.`);if(r!==Math.floor(r))throw new rr(`Array index must be an integer, but found ${r} instead.`);return n[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Hl{constructor(e,r){this.type=zt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Pt),l=r.parse(e[2],2,Pt);return n&&l?ws(n.type,[zt,Ot,Qe,co,Pt])?new Hl(n,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(n.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!Ho(r,["boolean","string","number","null"]))throw new rr(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(qi(r))} instead.`);if(!Ho(n,["string","array"]))throw new rr(`Expected second argument to be of type array or string, but found ${Bi(qi(n))} instead.`);return n.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class wn{constructor(e,r,n){this.type=Qe,this.needle=e,this.haystack=r,this.fromIndex=n}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Pt),l=r.parse(e[2],2,Pt);if(!n||!l)return null;if(!ws(n.type,[zt,Ot,Qe,co,Pt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(n.type)} instead`);if(e.length===4){const u=r.parse(e[3],3,Qe);return u?new wn(n,l,u):null}return new wn(n,l)}evaluate(e){const r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!Ho(r,["boolean","string","number","null"]))throw new rr(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(qi(r))} instead.`);if(!Ho(n,["string","array"]))throw new rr(`Expected second argument to be of type array or string, but found ${Bi(qi(n))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return n.indexOf(r,l)}return n.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Os{constructor(e,r,n,l,u,f){this.inputType=e,this.type=r,this.input=n,this.cases=l,this.outputs=u,this.otherwise=f}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let n,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const u={},f=[];for(let w=2;w<e.length-1;w+=2){let A=e[w];const C=e[w+1];Array.isArray(A)||(A=[A]);const I=r.concat(w);if(A.length===0)return I.error("Expected at least one branch label.");for(const B of A){if(typeof B!="number"&&typeof B!="string")return I.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return I.error("Numeric branch labels must be integer values.");if(n){if(I.checkSubtype(n,qi(B)))return null}else n=qi(B);if(u[String(B)]!==void 0)return I.error("Branch labels must be unique.");u[String(B)]=f.length}const L=r.parse(C,w,l);if(!L)return null;l=l||L.type,f.push(L)}const g=r.parse(e[1],1,Pt);if(!g)return null;const v=r.parse(e[e.length-1],e.length-1,l);return v?g.type.kind!=="value"&&r.concat(1).checkSubtype(n,g.type)?null:new Os(n,l,g,u,f,v):null}evaluate(e){const r=this.input.evaluate(e);return(qi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),n=[],l={};for(const f of r){const g=l[this.cases[f]];g===void 0?(l[this.cases[f]]=n.length,n.push([this.cases[f],[f]])):n[g][1].push(f)}const u=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,g]of n)e.push(g.length===1?u(g[0]):g.map(u)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class po{constructor(e,r,n){this.type=e,this.branches=r,this.otherwise=n}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let n;r.expectedType&&r.expectedType.kind!=="value"&&(n=r.expectedType);const l=[];for(let f=1;f<e.length-1;f+=2){const g=r.parse(e[f],f,zt);if(!g)return null;const v=r.parse(e[f+1],f+1,n);if(!v)return null;l.push([g,v]),n=n||v.type}const u=r.parse(e[e.length-1],e.length-1,n);return u?new po(n,l,u):null}evaluate(e){for(const[r,n]of this.branches)if(r.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,n]of this.branches)e(r),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class ja{constructor(e,r,n,l){this.type=e,this.input=r,this.beginIndex=n,this.endIndex=l}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=r.parse(e[1],1,Pt),l=r.parse(e[2],2,Qe);if(!n||!l)return null;if(!ws(n.type,[rn(Pt),Ot,Pt]))return r.error(`Expected first argument to be of type array or string, but found ${Bi(n.type)} instead`);if(e.length===4){const u=r.parse(e[3],3,Qe);return u?new ja(n.type,n,l,u):null}return new ja(n.type,n,l)}evaluate(e){const r=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!Ho(r,["string","array"]))throw new rr(`Expected first argument to be of type array or string, but found ${Bi(qi(r))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return r.slice(n,l)}return r.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Ou(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Fs(t,e,r,n){return n.compare(e,r)===0}function mo(t,e,r){const n=t!=="=="&&t!=="!=";return class Xy{constructor(u,f,g){this.type=zt,this.lhs=u,this.rhs=f,this.collator=g,this.hasUntypedArgument=u.type.kind==="value"||f.type.kind==="value"}static parse(u,f){if(u.length!==3&&u.length!==4)return f.error("Expected two or three arguments.");const g=u[0];let v=f.parse(u[1],1,Pt);if(!v)return null;if(!Ou(g,v.type))return f.concat(1).error(`"${g}" comparisons are not supported for type '${Bi(v.type)}'.`);let w=f.parse(u[2],2,Pt);if(!w)return null;if(!Ou(g,w.type))return f.concat(2).error(`"${g}" comparisons are not supported for type '${Bi(w.type)}'.`);if(v.type.kind!==w.type.kind&&v.type.kind!=="value"&&w.type.kind!=="value")return f.error(`Cannot compare types '${Bi(v.type)}' and '${Bi(w.type)}'.`);n&&(v.type.kind==="value"&&w.type.kind!=="value"?v=new on(w.type,[v]):v.type.kind!=="value"&&w.type.kind==="value"&&(w=new on(v.type,[w])));let A=null;if(u.length===4){if(v.type.kind!=="string"&&w.type.kind!=="string"&&v.type.kind!=="value"&&w.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(A=f.parse(u[3],3,Ia),!A)return null}return new Xy(v,w,A)}evaluate(u){const f=this.lhs.evaluate(u),g=this.rhs.evaluate(u);if(n&&this.hasUntypedArgument){const v=qi(f),w=qi(g);if(v.kind!==w.kind||v.kind!=="string"&&v.kind!=="number")throw new rr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${v.kind}, ${w.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const v=qi(f),w=qi(g);if(v.kind!=="string"||w.kind!=="string")return e(u,f,g)}return this.collator?r(u,f,g,this.collator.evaluate(u)):e(u,f,g)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[t];return this.eachChild(f=>{u.push(f.serialize())}),u}}}const Fu=mo("==",function(t,e,r){return e===r},Fs),Kl=mo("!=",function(t,e,r){return e!==r},function(t,e,r,n){return!Fs(0,e,r,n)}),Yl=mo("<",function(t,e,r){return e<r},function(t,e,r,n){return n.compare(e,r)<0}),Uu=mo(">",function(t,e,r){return e>r},function(t,e,r,n){return n.compare(e,r)>0}),Jl=mo("<=",function(t,e,r){return e<=r},function(t,e,r,n){return n.compare(e,r)<=0}),Nu=mo(">=",function(t,e,r){return e>=r},function(t,e,r,n){return n.compare(e,r)>=0});class Us{constructor(e,r,n,l,u){this.type=Ot,this.number=e,this.locale=r,this.currency=n,this.minFractionDigits=l,this.maxFractionDigits=u}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const n=r.parse(e[1],1,Qe);if(!n)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=r.parse(l.locale,1,Ot),!u))return null;let f=null;if(l.currency&&(f=r.parse(l.currency,1,Ot),!f))return null;let g=null;if(l["min-fraction-digits"]&&(g=r.parse(l["min-fraction-digits"],1,Qe),!g))return null;let v=null;return l["max-fraction-digits"]&&(v=r.parse(l["max-fraction-digits"],1,Qe),!v)?null:new Us(n,u,f,g,v)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ns{constructor(e){this.type=Qe,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=r.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Bi(n.type)} instead.`):new Ns(n):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new rr(`Expected value to be of type string or array, but found ${Bi(qi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Tn={"==":Fu,"!=":Kl,">":Uu,"<":Yl,">=":Nu,"<=":Jl,array:on,at:Xl,boolean:on,case:po,coalesce:Do,collator:za,format:Rn,image:zo,in:Hl,"index-of":wn,interpolate:Mr,"interpolate-hcl":Mr,"interpolate-lab":Mr,length:Ns,let:Bs,literal:ho,match:Os,number:on,"number-format":Us,object:on,slice:ja,step:Ba,string:on,"to-boolean":Bn,"to-color":Bn,"to-number":Bn,"to-string":Bn,var:Cs,within:Po};function Ql(t,[e,r,n,l]){e=e.evaluate(t),r=r.evaluate(t),n=n.evaluate(t);const u=l?l.evaluate(t):1,f=wu(e,r,n,u);if(f)throw new rr(f);return new Xt(e/255*u,r/255*u,n/255*u,u)}function ec(t,e){return t in e}function Va(t,e){const r=e[t];return r===void 0?null:r}function _o(t){return{type:t}}function ju(t){return{result:"success",value:t}}function Vn(t){return{result:"error",value:t}}function Qo(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Vu(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function tc(t){return!!t.expression&&t.expression.interpolated}function Yt(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function js(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Vs(t){return t}function $a(t,e){const r=e.type==="color",n=t.stops&&typeof t.stops[0][0]=="object",l=n||!(n||t.property!==void 0),u=t.type||(tc(e)?"exponential":"interval");if(r&&((t=lo({},t)).stops&&(t.stops=t.stops.map(w=>[w[0],Xt.parse(w[1])])),t.default=Xt.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Bu[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let f,g,v;if(u==="exponential")f=$u;else if(u==="interval")f=jd;else if(u==="categorical"){f=$s,g=Object.create(null);for(const w of t.stops)g[w[0]]=w[1];v=typeof t.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);f=Vd}if(n){const w={},A=[];for(let L=0;L<t.stops.length;L++){const B=t.stops[L],V=B[0].zoom;w[V]===void 0&&(w[V]={zoom:V,type:t.type,property:t.property,default:t.default,stops:[]},A.push(V)),w[V].stops.push([B[0].value,B[1]])}const C=[];for(const L of A)C.push([w[L].zoom,$a(w[L],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:Mr.interpolationFactor.bind(void 0,I),zoomStops:C.map(L=>L[0]),evaluate:({zoom:L},B)=>$u({stops:C,base:t.base},e,L).evaluate(L,B)}}if(l){const w=u==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Mr.interpolationFactor.bind(void 0,w),zoomStops:t.stops.map(A=>A[0]),evaluate:({zoom:A})=>f(t,e,A,g,v)}}return{kind:"source",evaluate(w,A){const C=A&&A.properties?A.properties[t.property]:void 0;return C===void 0?ur(t.default,e.default):f(t,e,C,g,v)}}}function ur(t,e,r){return t!==void 0?t:e!==void 0?e:r!==void 0?r:void 0}function $s(t,e,r,n,l){return ur(typeof r===l?n[r]:void 0,t.default,e.default)}function jd(t,e,r){if(Yt(r)!=="number")return ur(t.default,e.default);const n=t.stops.length;if(n===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];const l=Ra(t.stops.map(u=>u[0]),r);return t.stops[l][1]}function $u(t,e,r){const n=t.base!==void 0?t.base:1;if(Yt(r)!=="number")return ur(t.default,e.default);const l=t.stops.length;if(l===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[l-1][0])return t.stops[l-1][1];const u=Ra(t.stops.map(A=>A[0]),r),f=function(A,C,I,L){const B=L-I,V=A-I;return B===0?0:C===1?V/B:(Math.pow(C,V)-1)/(Math.pow(C,B)-1)}(r,n,t.stops[u][0],t.stops[u+1][0]),g=t.stops[u][1],v=t.stops[u+1][1];let w=ks[e.type]||Vs;if(t.colorSpace&&t.colorSpace!=="rgb"){const A=Bu[t.colorSpace];w=(C,I)=>A.reverse(A.interpolate(A.forward(C),A.forward(I),f))}return typeof g.evaluate=="function"?{evaluate(...A){const C=g.evaluate.apply(void 0,A),I=v.evaluate.apply(void 0,A);if(C!==void 0&&I!==void 0)return w(C,I,f)}}:w(g,v,f)}function Vd(t,e,r){return e.type==="color"?r=Xt.parse(r):e.type==="formatted"?r=At.fromString(r.toString()):e.type==="resolvedImage"?r=nn.fromString(r.toString()):Yt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),ur(r,t.default,e.default)}jr.register(Tn,{error:[{kind:"error"},[Ot],(t,[e])=>{throw new rr(e.evaluate(t))}],typeof:[Ot,[Pt],(t,[e])=>Bi(qi(e.evaluate(t)))],"to-rgba":[rn(Qe,4),[Ln],(t,[e])=>e.evaluate(t).toArray()],rgb:[Ln,[Qe,Qe,Qe],Ql],rgba:[Ln,[Qe,Qe,Qe,Qe],Ql],has:{type:zt,overloads:[[[Ot],(t,[e])=>ec(e.evaluate(t),t.properties())],[[Ot,Xo],(t,[e,r])=>ec(e.evaluate(t),r.evaluate(t))]]},get:{type:Pt,overloads:[[[Ot],(t,[e])=>Va(e.evaluate(t),t.properties())],[[Ot,Xo],(t,[e,r])=>Va(e.evaluate(t),r.evaluate(t))]]},"feature-state":[Pt,[Ot],(t,[e])=>Va(e.evaluate(t),t.featureState||{})],properties:[Xo,[],t=>t.properties()],"geometry-type":[Ot,[],t=>t.geometryType()],id:[Pt,[],t=>t.id()],zoom:[Qe,[],t=>t.globals.zoom],pitch:[Qe,[],t=>t.globals.pitch||0],"distance-from-center":[Qe,[],t=>t.distanceFromCenter()],"heatmap-density":[Qe,[],t=>t.globals.heatmapDensity||0],"line-progress":[Qe,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Qe,[],t=>t.globals.skyRadialProgress||0],accumulated:[Pt,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Qe,_o(Qe),(t,e)=>{let r=0;for(const n of e)r+=n.evaluate(t);return r}],"*":[Qe,_o(Qe),(t,e)=>{let r=1;for(const n of e)r*=n.evaluate(t);return r}],"-":{type:Qe,overloads:[[[Qe,Qe],(t,[e,r])=>e.evaluate(t)-r.evaluate(t)],[[Qe],(t,[e])=>-e.evaluate(t)]]},"/":[Qe,[Qe,Qe],(t,[e,r])=>e.evaluate(t)/r.evaluate(t)],"%":[Qe,[Qe,Qe],(t,[e,r])=>e.evaluate(t)%r.evaluate(t)],ln2:[Qe,[],()=>Math.LN2],pi:[Qe,[],()=>Math.PI],e:[Qe,[],()=>Math.E],"^":[Qe,[Qe,Qe],(t,[e,r])=>Math.pow(e.evaluate(t),r.evaluate(t))],sqrt:[Qe,[Qe],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Qe,[Qe],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Qe,[Qe],(t,[e])=>Math.log(e.evaluate(t))],log2:[Qe,[Qe],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Qe,[Qe],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Qe,[Qe],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Qe,[Qe],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Qe,[Qe],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Qe,[Qe],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Qe,[Qe],(t,[e])=>Math.atan(e.evaluate(t))],min:[Qe,_o(Qe),(t,e)=>Math.min(...e.map(r=>r.evaluate(t)))],max:[Qe,_o(Qe),(t,e)=>Math.max(...e.map(r=>r.evaluate(t)))],abs:[Qe,[Qe],(t,[e])=>Math.abs(e.evaluate(t))],round:[Qe,[Qe],(t,[e])=>{const r=e.evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[Qe,[Qe],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Qe,[Qe],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[zt,[Ot,Pt],(t,[e,r])=>t.properties()[e.value]===r.value],"filter-id-==":[zt,[Pt],(t,[e])=>t.id()===e.value],"filter-type-==":[zt,[Ot],(t,[e])=>t.geometryType()===e.value],"filter-<":[zt,[Ot,Pt],(t,[e,r])=>{const n=t.properties()[e.value],l=r.value;return typeof n==typeof l&&n<l}],"filter-id-<":[zt,[Pt],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r<n}],"filter->":[zt,[Ot,Pt],(t,[e,r])=>{const n=t.properties()[e.value],l=r.value;return typeof n==typeof l&&n>l}],"filter-id->":[zt,[Pt],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r>n}],"filter-<=":[zt,[Ot,Pt],(t,[e,r])=>{const n=t.properties()[e.value],l=r.value;return typeof n==typeof l&&n<=l}],"filter-id-<=":[zt,[Pt],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r<=n}],"filter->=":[zt,[Ot,Pt],(t,[e,r])=>{const n=t.properties()[e.value],l=r.value;return typeof n==typeof l&&n>=l}],"filter-id->=":[zt,[Pt],(t,[e])=>{const r=t.id(),n=e.value;return typeof r==typeof n&&r>=n}],"filter-has":[zt,[Pt],(t,[e])=>e.value in t.properties()],"filter-has-id":[zt,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[zt,[rn(Ot)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[zt,[rn(Pt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[zt,[Ot,rn(Pt)],(t,[e,r])=>r.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[zt,[Ot,rn(Pt)],(t,[e,r])=>function(n,l,u,f){for(;u<=f;){const g=u+f>>1;if(l[g]===n)return!0;l[g]>n?f=g-1:u=g+1}return!1}(t.properties()[e.value],r.value,0,r.value.length-1)],all:{type:zt,overloads:[[[zt,zt],(t,[e,r])=>e.evaluate(t)&&r.evaluate(t)],[_o(zt),(t,e)=>{for(const r of e)if(!r.evaluate(t))return!1;return!0}]]},any:{type:zt,overloads:[[[zt,zt],(t,[e,r])=>e.evaluate(t)||r.evaluate(t)],[_o(zt),(t,e)=>{for(const r of e)if(r.evaluate(t))return!0;return!1}]]},"!":[zt,[zt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[zt,[Ot],(t,[e])=>{const r=t.globals&&t.globals.isSupportedScript;return!r||r(e.evaluate(t))}],upcase:[Ot,[Ot],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Ot,[Ot],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Ot,_o(Pt),(t,e)=>e.map(r=>ka(r.evaluate(t))).join("")],"resolved-locale":[Ot,[Ia],(t,[e])=>e.evaluate(t).resolvedLocale()]});class ic{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new Su,this._defaultValue=r?function(n){return n.type==="color"&&js(n.default)?new Xt(0,0,0,0):n.type==="color"?Xt.parse(n.default)||null:n.default===void 0?null:n.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,n,l,u,f,g,v){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=n,this._evaluator.canonical=l,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,n,l,u,f,g,v){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=n||null,this._evaluator.canonical=l,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=v||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new rr(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console!="undefined"&&console.warn(w.message)),this._defaultValue}}}function ea(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Tn}function Ga(t,e){const r=new Is(Tn,[],e?function(l){const u={color:Ln,string:Ot,number:Qe,enum:Ot,boolean:zt,formatted:uo,resolvedImage:Ma};return l.type==="array"?rn(u[l.value]||Pt,l.length):u[l.type]}(e):void 0),n=r.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?ju(new ic(n,e)):Vn(r.errors)}class Za{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Da(r.expression)}evaluateWithoutErrorHandling(e,r,n,l,u,f){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,l,u,f)}evaluate(e,r,n,l,u,f){return this._styleExpression.evaluate(e,r,n,l,u,f)}}class rc{constructor(e,r,n,l){this.kind=e,this.zoomStops=n,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Da(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,r,n,l,u,f){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,l,u,f)}evaluate(e,r,n,l,u,f){return this._styleExpression.evaluate(e,r,n,l,u,f)}interpolationFactor(e,r,n){return this.interpolationType?Mr.interpolationFactor(this.interpolationType,e,r,n):0}}function Gu(t,e){if((t=Ga(t,e)).result==="error")return t;const r=t.value.expression,n=Jo(r);if(!n&&!Qo(e))return Vn([new Dn("","data expressions not supported")]);const l=La(r,["zoom","pitch","distance-from-center"]);if(!l&&!Vu(e))return Vn([new Dn("","zoom expressions not supported")]);const u=Gs(r);return u||l?u instanceof Dn?Vn([u]):u instanceof Mr&&!tc(e)?Vn([new Dn("",'"interpolate" expressions cannot be used with this property')]):ju(u?new rc(n?"camera":"composite",t.value,u.labels,u instanceof Mr?u.interpolation:void 0):new Za(n?"constant":"source",t.value)):Vn([new Dn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ta{constructor(e,r){this._parameters=e,this._specification=r,lo(this,$a(this._parameters,this._specification))}static deserialize(e){return new ta(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Gs(t){let e=null;if(t instanceof Bs)e=Gs(t.result);else if(t instanceof Do){for(const r of t.args)if(e=Gs(r),e)break}else(t instanceof Ba||t instanceof Mr)&&t.input instanceof jr&&t.input.name==="zoom"&&(e=t);return e instanceof Dn||t.eachChild(r=>{const n=Gs(r);n instanceof Dn?e=n:!e&&n?e=new Dn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new Dn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function an(t){const e=t.key,r=t.value,n=t.valueSpec||{},l=t.objectElementValidators||{},u=t.style,f=t.styleSpec;let g=[];const v=Yt(r);if(v!=="object")return[new et(e,r,`object expected, ${v} found`)];for(const w in r){const A=w.split(".")[0],C=n[A]||n["*"];let I;if(l[A])I=l[A];else if(n[A])I=nr;else if(l["*"])I=l["*"];else{if(!n["*"]){g.push(new et(e,r[w],`unknown property "${w}"`));continue}I=nr}g=g.concat(I({key:(e&&`${e}.`)+w,value:r[w],valueSpec:C,style:u,styleSpec:f,object:r,objectKey:w},r))}for(const w in n)l[w]||n[w].required&&n[w].default===void 0&&r[w]===void 0&&g.push(new et(e,r,`missing required property "${w}"`));return g}function nc(t){const e=t.value,r=t.valueSpec,n=t.style,l=t.styleSpec,u=t.key,f=t.arrayElementValidator||nr;if(Yt(e)!=="array")return[new et(u,e,`array expected, ${Yt(e)} found`)];if(r.length&&e.length!==r.length)return[new et(u,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new et(u,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let g={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum};l.$version<7&&(g.function=r.function),Yt(r.value)==="object"&&(g=r.value);let v=[];for(let w=0;w<e.length;w++)v=v.concat(f({array:e,arrayIndex:w,value:e[w],valueSpec:g,style:n,styleSpec:l,key:`${u}[${w}]`}));return v}function Zu(t){const e=t.key,r=t.value,n=t.valueSpec;let l=Yt(r);if(l==="number"&&r!=r&&(l="NaN"),l!=="number")return[new et(e,r,`number expected, ${l} found`)];if("minimum"in n){let u=n.minimum;if(Yt(n.minimum)==="array"&&(u=n.minimum[t.arrayIndex]),r<u)return[new et(e,r,`${r} is less than the minimum value ${u}`)]}if("maximum"in n){let u=n.maximum;if(Yt(n.maximum)==="array"&&(u=n.maximum[t.arrayIndex]),r>u)return[new et(e,r,`${r} is greater than the maximum value ${u}`)]}return[]}function Zs(t){const e=t.valueSpec,r=$i(t.value.type);let n,l,u,f={};const g=r!=="categorical"&&t.value.property===void 0,v=!g,w=Yt(t.value.stops)==="array"&&Yt(t.value.stops[0])==="array"&&Yt(t.value.stops[0][0])==="object",A=an({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(L){if(r==="identity")return[new et(L.key,L.value,'identity function may not have a "stops" property')];let B=[];const V=L.value;return B=B.concat(nc({key:L.key,value:V,valueSpec:L.valueSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:C})),Yt(V)==="array"&&V.length===0&&B.push(new et(L.key,V,"array must have at least one stop")),B},default:function(L){return nr({key:L.key,value:L.value,valueSpec:e,style:L.style,styleSpec:L.styleSpec})}}});return r==="identity"&&g&&A.push(new et(t.key,t.value,'missing required property "property"')),r==="identity"||t.value.stops||A.push(new et(t.key,t.value,'missing required property "stops"')),r==="exponential"&&t.valueSpec.expression&&!tc(t.valueSpec)&&A.push(new et(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(v&&!Qo(t.valueSpec)?A.push(new et(t.key,t.value,"property functions not supported")):g&&!Vu(t.valueSpec)&&A.push(new et(t.key,t.value,"zoom functions not supported"))),r!=="categorical"&&!w||t.value.property!==void 0||A.push(new et(t.key,t.value,'"property" property is required')),A;function C(L){let B=[];const V=L.value,q=L.key;if(Yt(V)!=="array")return[new et(q,V,`array expected, ${Yt(V)} found`)];if(V.length!==2)return[new et(q,V,`array length 2 expected, length ${V.length} found`)];if(w){if(Yt(V[0])!=="object")return[new et(q,V,`object expected, ${Yt(V[0])} found`)];if(V[0].zoom===void 0)return[new et(q,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new et(q,V,"object stop key must have value")];if(u&&u>$i(V[0].zoom))return[new et(q,V[0].zoom,"stop zoom values must appear in ascending order")];$i(V[0].zoom)!==u&&(u=$i(V[0].zoom),l=void 0,f={}),B=B.concat(an({key:`${q}[0]`,value:V[0],valueSpec:{zoom:{}},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:Zu,value:I}}))}else B=B.concat(I({key:`${q}[0]`,value:V[0],valueSpec:{},style:L.style,styleSpec:L.styleSpec},V));return ea(jn(V[1]))?B.concat([new et(`${q}[1]`,V[1],"expressions are not allowed in function stops.")]):B.concat(nr({key:`${q}[1]`,value:V[1],valueSpec:e,style:L.style,styleSpec:L.styleSpec}))}function I(L,B){const V=Yt(L.value),q=$i(L.value),Q=L.value!==null?L.value:B;if(n){if(V!==n)return[new et(L.key,Q,`${V} stop domain type must match previous stop domain type ${n}`)]}else n=V;if(V!=="number"&&V!=="string"&&V!=="boolean")return[new et(L.key,Q,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&r!=="categorical"){let oe=`number expected, ${V} found`;return Qo(e)&&r===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new et(L.key,Q,oe)]}return r!=="categorical"||V!=="number"||isFinite(q)&&Math.floor(q)===q?r!=="categorical"&&V==="number"&&l!==void 0&&q<l?[new et(L.key,Q,"stop domain values must appear in ascending order")]:(l=q,r==="categorical"&&q in f?[new et(L.key,Q,"stop domain values must be unique")]:(f[q]=!0,[])):[new et(L.key,Q,`integer expected, found ${q}`)]}}function $n(t){const e=(t.expressionContext==="property"?Gu:Ga)(jn(t.value),t.valueSpec);if(e.result==="error")return e.value.map(n=>new et(`${t.key}${n.key}`,t.value,n.message));const r=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!r.outputDefined())return[new et(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Da(r))return[new et(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return oc(r,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!La(r,["zoom","feature-state"]))return[new et(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Jo(r))return[new et(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function oc(t,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const l of e.valueSpec.expression.parameters)r.delete(l);if(r.size===0)return[];const n=[];return t instanceof jr&&r.has(t.name)?[new et(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(l=>{n.push(...oc(l,e))}),n)}function qs(t){const e=t.key,r=t.value,n=t.valueSpec,l=[];return Array.isArray(n.values)?n.values.indexOf($i(r))===-1&&l.push(new et(e,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(n.values).indexOf($i(r))===-1&&l.push(new et(e,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function Ws(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Ws(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Xs(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ws(t)||(t=Ks(t));const r=t;let n=!0;try{n=function(w){if(!ia(w))return w;let A=jn(w);return qu(A),A=Hs(A),A}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const l=Ee[`filter_${e}`],u=Ga(n,l);let f=null;if(u.result==="error")throw new Error(u.value.map(w=>`${w.key}: ${w.message}`).join(", "));f=(w,A,C)=>u.value.evaluate(w,A,{},C);let g=null,v=null;if(n!==r){const w=Ga(r,l);if(w.result==="error")throw new Error(w.value.map(A=>`${A.key}: ${A.message}`).join(", "));g=(A,C,I,L,B)=>w.value.evaluate(A,C,{},I,void 0,void 0,L,B),v=!Jo(w.value.expression)}return f=f,{filter:f,dynamicFilter:g||void 0,needGeometry:ac(n),needFeature:!!v}}function Hs(t){if(!Array.isArray(t))return t;const e=function(r){if($d.has(r[0])){for(let n=1;n<r.length;n++)if(ia(r[n]))return!0}return r}(t);return e===!0?e:e.map(r=>Hs(r))}function qu(t){let e=!1;const r=[];if(t[0]==="case"){for(let n=1;n<t.length-1;n+=2)e=e||ia(t[n]),r.push(t[n+1]);r.push(t[t.length-1])}else if(t[0]==="match"){e=e||ia(t[1]);for(let n=2;n<t.length-1;n+=2)r.push(t[n+1]);r.push(t[t.length-1])}else if(t[0]==="step"){e=e||ia(t[1]);for(let n=1;n<t.length-1;n+=2)r.push(t[n+1])}e&&(t.length=0,t.push("any",...r));for(let n=1;n<t.length;n++)qu(t[n])}function ia(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<t.length;r++)if(ia(t[r]))return!0;return!1}const $d=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Gd(t,e){return t<e?-1:t>e?1:0}function ac(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(ac(t[e]))return!0;return!1}function Ks(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?sc(t[1],t[2],"=="):e==="!="?Ys(sc(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?sc(t[1],t[2],e):e==="any"?(r=t.slice(1),["any"].concat(r.map(Ks))):e==="all"?["all"].concat(t.slice(1).map(Ks)):e==="none"?["all"].concat(t.slice(1).map(Ks).map(Ys)):e==="in"?Wu(t[1],t.slice(2)):e==="!in"?Ys(Wu(t[1],t.slice(2))):e==="has"?Xu(t[1]):e==="!has"?Ys(Xu(t[1])):e!=="within"||t;var r}function sc(t,e,r){switch(t){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,t,e]}}function Wu(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Gd)]]:["filter-in-small",t,["literal",e]]}}function Xu(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ys(t){return["!",t]}function lc(t){if(Ws(jn(t.value))){const e=jn(t.layerType);return $n(lo({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${e||"fill"}`]}))}return Hu(t)}function Hu(t){const e=t.value,r=t.key;if(Yt(e)!=="array")return[new et(r,e,`array expected, ${Yt(e)} found`)];const n=t.styleSpec;let l,u=[];if(e.length<1)return[new et(r,e,"filter array must have at least 1 element")];switch(u=u.concat(qs({key:`${r}[0]`,value:e[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),$i(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&$i(e[1])==="$type"&&u.push(new et(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&u.push(new et(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=Yt(e[1]),l!=="string"&&u.push(new et(`${r}[1]`,e[1],`string expected, ${l} found`)));for(let f=2;f<e.length;f++)l=Yt(e[f]),$i(e[1])==="$type"?u=u.concat(qs({key:`${r}[${f}]`,value:e[f],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&u.push(new et(`${r}[${f}]`,e[f],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let f=1;f<e.length;f++)u=u.concat(Hu({key:`${r}[${f}]`,value:e[f],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":l=Yt(e[1]),e.length!==2?u.push(new et(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&u.push(new et(`${r}[1]`,e[1],`string expected, ${l} found`));break;case"within":l=Yt(e[1]),e.length!==2?u.push(new et(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="object"&&u.push(new et(`${r}[1]`,e[1],`object expected, ${l} found`))}return u}function qa(t,e){const r=t.key,n=t.style,l=t.styleSpec,u=t.value,f=t.objectKey,g=l[`${e}_${t.layerType}`];if(!g)return[];const v=f.match(/^(.*)-transition$/);if(e==="paint"&&v&&g[v[1]]&&g[v[1]].transition)return nr({key:r,value:u,valueSpec:l.transition,style:n,styleSpec:l});const w=t.valueSpec||g[f];if(!w)return[new et(r,u,`unknown property "${f}"`)];let A;if(Yt(u)==="string"&&Qo(w)&&!w.tokens&&(A=/^{([^}]+)}$/.exec(u)))return[new et(r,u,`"${f}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const C=[];return t.layerType==="symbol"&&(f==="text-field"&&n&&!n.glyphs&&C.push(new et(r,u,'use of "text-field" requires a style "glyphs" property')),f==="text-font"&&js(jn(u))&&$i(u.type)==="identity"&&C.push(new et(r,u,'"text-font" does not support identity functions'))),C.concat(nr({key:t.key,value:u,valueSpec:w,style:n,styleSpec:l,expressionContext:"property",propertyType:e,propertyKey:f}))}function Ku(t){return qa(t,"paint")}function Yu(t){return qa(t,"layout")}function Wa(t){let e=[];const r=t.value,n=t.key,l=t.style,u=t.styleSpec;r.type||r.ref||e.push(new et(n,r,'either "type" or "ref" is required'));let f=$i(r.type);const g=$i(r.ref);if(r.id){const v=$i(r.id);for(let w=0;w<t.arrayIndex;w++){const A=l.layers[w];$i(A.id)===v&&e.push(new et(n,r.id,`duplicate layer id "${r.id}", previously used at line ${A.id.__line__}`))}}if("ref"in r){let v;["type","source","source-layer","filter","layout"].forEach(w=>{w in r&&e.push(new et(n,r[w],`"${w}" is prohibited for ref layers`))}),l.layers.forEach(w=>{$i(w.id)===g&&(v=w)}),v?v.ref?e.push(new et(n,r.ref,"ref cannot reference another ref layer")):f=$i(v.type):e.push(new et(n,r.ref,`ref layer "${g}" not found`))}else if(f!=="background"&&f!=="sky")if(r.source){const v=l.sources&&l.sources[r.source],w=v&&$i(v.type);v?w==="vector"&&f==="raster"?e.push(new et(n,r.source,`layer "${r.id}" requires a raster source`)):w==="raster"&&f!=="raster"?e.push(new et(n,r.source,`layer "${r.id}" requires a vector source`)):w!=="vector"||r["source-layer"]?w==="raster-dem"&&f!=="hillshade"?e.push(new et(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!r.paint||!r.paint["line-gradient"]||w==="geojson"&&v.lineMetrics||e.push(new et(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new et(n,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new et(n,r.source,`source "${r.source}" not found`))}else e.push(new et(n,r,'missing required property "source"'));return e=e.concat(an({key:n,value:r,valueSpec:u.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>nr({key:`${n}.type`,value:r.type,valueSpec:u.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"}),filter:v=>lc(lo({layerType:f},v)),layout:v=>an({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":w=>Yu(lo({layerType:f},w))}}),paint:v=>an({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{"*":w=>Ku(lo({layerType:f},w))}})}})),e}function ra(t){const e=t.value,r=t.key,n=Yt(e);return n!=="string"?[new et(r,e,`string expected, ${n} found`)]:[]}const cc={promoteId:function({key:t,value:e}){if(Yt(e)==="string")return ra({key:t,value:e});{const r=[];for(const n in e)r.push(...ra({key:`${t}.${n}`,value:e[n]}));return r}}};function Ju(t){const e=t.value,r=t.key,n=t.styleSpec,l=t.style;if(!e.type)return[new et(r,e,'"type" is required')];const u=$i(e.type);let f;switch(u){case"vector":case"raster":case"raster-dem":return f=an({key:r,value:e,valueSpec:n[`source_${u.replace("-","_")}`],style:t.style,styleSpec:n,objectElementValidators:cc}),f;case"geojson":if(f=an({key:r,value:e,valueSpec:n.source_geojson,style:l,styleSpec:n,objectElementValidators:cc}),e.cluster)for(const g in e.clusterProperties){const[v,w]=e.clusterProperties[g],A=typeof v=="string"?[v,["accumulated"],["get",g]]:v;f.push(...$n({key:`${r}.${g}.map`,value:w,expressionContext:"cluster-map"})),f.push(...$n({key:`${r}.${g}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return f;case"video":return an({key:r,value:e,valueSpec:n.source_video,style:l,styleSpec:n});case"image":return an({key:r,value:e,valueSpec:n.source_image,style:l,styleSpec:n});case"canvas":return[new et(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qs({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:l,styleSpec:n})}}function uc(t){const e=t.value,r=t.styleSpec,n=r.light,l=t.style;let u=[];const f=Yt(e);if(e===void 0)return u;if(f!=="object")return u=u.concat([new et("light",e,`object expected, ${f} found`)]),u;for(const g in e){const v=g.match(/^(.*)-transition$/);u=u.concat(v&&n[v[1]]&&n[v[1]].transition?nr({key:g,value:e[g],valueSpec:r.transition,style:l,styleSpec:r}):n[g]?nr({key:g,value:e[g],valueSpec:n[g],style:l,styleSpec:r}):[new et(g,e[g],`unknown property "${g}"`)])}return u}function hc(t){const e=t.value,r=t.key,n=t.style,l=t.styleSpec,u=l.terrain;let f=[];const g=Yt(e);if(e===void 0)return f;if(g!=="object")return f=f.concat([new et("terrain",e,`object expected, ${g} found`)]),f;for(const v in e){const w=v.match(/^(.*)-transition$/);f=f.concat(w&&u[w[1]]&&u[w[1]].transition?nr({key:v,value:e[v],valueSpec:l.transition,style:n,styleSpec:l}):u[v]?nr({key:v,value:e[v],valueSpec:u[v],style:n,styleSpec:l}):[new et(v,e[v],`unknown property "${v}"`)])}if(e.source){const v=n.sources&&n.sources[e.source],w=v&&$i(v.type);v?w!=="raster-dem"&&f.push(new et(r,e.source,`terrain cannot be used with a source of type ${w}, it only be used with a "raster-dem" source type`)):f.push(new et(r,e.source,`source "${e.source}" not found`))}else f.push(new et(r,e,'terrain is missing required property "source"'));return f}function dc(t){const e=t.value,r=t.style,n=t.styleSpec,l=n.fog;let u=[];const f=Yt(e);if(e===void 0)return u;if(f!=="object")return u=u.concat([new et("fog",e,`object expected, ${f} found`)]),u;for(const g in e){const v=g.match(/^(.*)-transition$/);u=u.concat(v&&l[v[1]]&&l[v[1]].transition?nr({key:g,value:e[g],valueSpec:n.transition,style:r,styleSpec:n}):l[g]?nr({key:g,value:e[g],valueSpec:l[g],style:r,styleSpec:n}):[new et(g,e[g],`unknown property "${g}"`)])}return u}const fc={"*":()=>[],array:nc,boolean:function(t){const e=t.value,r=t.key,n=Yt(e);return n!=="boolean"?[new et(r,e,`boolean expected, ${n} found`)]:[]},number:Zu,color:function(t){const e=t.key,r=t.value,n=Yt(r);return n!=="string"?[new et(e,r,`color expected, ${n} found`)]:Yo.parseCSSColor(r)===null?[new et(e,r,`color expected, "${r}" found`)]:[]},constants:bu,enum:qs,filter:lc,function:Zs,layer:Wa,object:an,source:Ju,light:uc,terrain:hc,fog:dc,string:ra,formatted:function(t){return ra(t).length===0?[]:$n(t)},resolvedImage:function(t){return ra(t).length===0?[]:$n(t)},projection:function(t){const e=t.value,r=t.styleSpec,n=r.projection,l=t.style;let u=[];const f=Yt(e);if(f==="object")for(const g in e)u=u.concat(nr({key:g,value:e[g],valueSpec:n[g],style:l,styleSpec:r}));else f!=="string"&&(u=u.concat([new et("projection",e,`object or string expected, ${f} found`)]));return u}};function nr(t){const e=t.value,r=t.valueSpec,n=t.styleSpec;return r.expression&&js($i(e))?Zs(t):r.expression&&ea(jn(e))?$n(t):r.type&&fc[r.type]?fc[r.type](t):an(lo({},t,{valueSpec:r.type?n[r.type]:r}))}function pc(t){const e=t.value,r=t.key,n=ra(t);return n.length||(e.indexOf("{fontstack}")===-1&&n.push(new et(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&n.push(new et(r,e,'"glyphs" url must include a "{range}" token'))),n}function Gn(t,e=Ee){let r=[];return r=r.concat(nr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:pc,"*":()=>[]}})),t.constants&&(r=r.concat(bu({key:"constants",value:t.constants,style:t,styleSpec:e}))),Qu(r)}function Qu(t){return[].concat(t).sort((e,r)=>e.line-r.line)}function Sn(t){return function(...e){return Qu(t.apply(this,e))}}Gn.source=Sn(Ju),Gn.light=Sn(uc),Gn.terrain=Sn(hc),Gn.fog=Sn(dc),Gn.layer=Sn(Wa),Gn.filter=Sn(lc),Gn.paintProperty=Sn(Ku),Gn.layoutProperty=Sn(Yu);const na=Gn,oa=na.light,Zd=na.fog,mc=na.paintProperty,qd=na.layoutProperty;function eh(t,e){let r=!1;if(e&&e.length)for(const n of e)t.fire(new xs(new Error(n.message))),r=!0;return r}var Xa=br;function br(t,e,r){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var l=new Int32Array(this.arrayBuffer);t=l[0],this.d=(e=l[1])+2*(r=l[2]);for(var u=0;u<this.d*this.d;u++){var f=l[3+u],g=l[3+u+1];n.push(f===g?null:l.subarray(f,g))}var v=l[3+n.length+1];this.keys=l.subarray(l[3+n.length],v),this.bboxes=l.subarray(v),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var w=0;w<this.d*this.d;w++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var A=r/e*t;this.min=-A,this.max=t+A}br.prototype.insert=function(t,e,r,n,l){this._forEachCell(e,r,n,l,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(l)},br.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},br.prototype._insertCell=function(t,e,r,n,l,u){this.cells[l].push(u)},br.prototype.query=function(t,e,r,n,l){var u=this.min,f=this.max;if(t<=u&&e<=u&&f<=r&&f<=n&&!l)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(t,e,r,n,this._queryCell,g,{},l),g},br.prototype._queryCell=function(t,e,r,n,l,u,f,g){var v=this.cells[l];if(v!==null)for(var w=this.keys,A=this.bboxes,C=0;C<v.length;C++){var I=v[C];if(f[I]===void 0){var L=4*I;(g?g(A[L+0],A[L+1],A[L+2],A[L+3]):t<=A[L+2]&&e<=A[L+3]&&r>=A[L+0]&&n>=A[L+1])?(f[I]=!0,u.push(w[I])):f[I]=!1}}},br.prototype._forEachCell=function(t,e,r,n,l,u,f,g){for(var v=this._convertToCellCoord(t),w=this._convertToCellCoord(e),A=this._convertToCellCoord(r),C=this._convertToCellCoord(n),I=v;I<=A;I++)for(var L=w;L<=C;L++){var B=this.d*L+I;if((!g||g(this._convertFromCellCoord(I),this._convertFromCellCoord(L),this._convertFromCellCoord(I+1),this._convertFromCellCoord(L+1)))&&l.call(this,t,e,r,n,B,u,f,g))return}},br.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},br.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},br.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var l=new Int32Array(e+r+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var u=e,f=0;f<t.length;f++){var g=t[f];l[3+f]=u,l.set(g,u),u+=g.length}return l[3+t.length]=u,l.set(this.keys,u),l[3+t.length+1]=u+=this.keys.length,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer};const{ImageData:Ha,ImageBitmap:aa}=G,Ka={};function it(t,e,r={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Ka[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}it("Object",Object),Xa.serialize=function(t,e){const r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},Xa.deserialize=function(t){return new Xa(t.buffer)},it("Grid",Xa),it("Color",Xt),it("Error",Error),it("ResolvedImage",nn),it("StylePropertyFunction",ta),it("StyleExpression",ic,{omit:["_evaluator"]}),it("ZoomDependentExpression",rc),it("ZoomConstantExpression",Za),it("CompoundExpression",jr,{omit:["_evaluate"]});for(const t in Tn)Tn[t]._classRegistryKey||it(`Expression_${t}`,Tn[t]);function sa(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function th(t){return aa&&t instanceof aa}function Ya(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(sa(t)||th(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const r=t;return e&&e.push(r.buffer),r}if(t instanceof Ha)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const r=[];for(const n of t)r.push(Ya(n,e));return r}if(typeof t=="object"){const r=t.constructor,n=r._classRegistryKey;if(!n)throw new Error("can't serialize object of unregistered class");const l=r.serialize?r.serialize(t,e):{};if(!r.serialize){for(const u in t){if(!t.hasOwnProperty(u)||Ka[n].omit.indexOf(u)>=0)continue;const f=t[u];l[u]=Ka[n].shallow.indexOf(u)>=0?f:Ya(f,e)}t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(l.$name=n),l}throw new Error("can't serialize object of type "+typeof t)}function go(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||sa(t)||th(t)||ArrayBuffer.isView(t)||t instanceof Ha)return t;if(Array.isArray(t))return t.map(go);if(typeof t=="object"){const e=t.$name||"Object",{klass:r}=Ka[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(t);const n=Object.create(r.prototype);for(const l of Object.keys(t)){if(l==="$name")continue;const u=t[l];n[l]=Ka[e].shallow.indexOf(l)>=0?u:go(u)}return n}throw new Error("can't deserialize object of type "+typeof t)}class h{constructor(){this.first=!0}update(e,r){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}const i=t=>t>=1536&&t<=1791,a=t=>t>=1872&&t<=1919,d=t=>t>=2208&&t<=2303,m=t=>t>=11904&&t<=12031,y=t=>t>=12032&&t<=12255,b=t=>t>=12272&&t<=12287,E=t=>t>=12288&&t<=12351,M=t=>t>=12352&&t<=12447,k=t=>t>=12448&&t<=12543,P=t=>t>=12544&&t<=12591,R=t=>t>=12704&&t<=12735,N=t=>t>=12736&&t<=12783,H=t=>t>=12784&&t<=12799,Z=t=>t>=12800&&t<=13055,K=t=>t>=13056&&t<=13311,ae=t=>t>=13312&&t<=19903,W=t=>t>=19968&&t<=40959,re=t=>t>=40960&&t<=42127,ne=t=>t>=42128&&t<=42191,te=t=>t>=44032&&t<=55215,ie=t=>t>=63744&&t<=64255,se=t=>t>=64336&&t<=65023,ge=t=>t>=65040&&t<=65055,be=t=>t>=65072&&t<=65103,Xe=t=>t>=65104&&t<=65135,Ne=t=>t>=65136&&t<=65279,Fe=t=>t>=65280&&t<=65519;function Ae(t){for(const e of t)if(ze(e.charCodeAt(0)))return!0;return!1}function ve(t){for(const e of t)if(!Re(e.charCodeAt(0)))return!1;return!0}function Re(t){return!(i(t)||a(t)||d(t)||se(t)||Ne(t))}function ze(t){return!(t!==746&&t!==747&&(t<4352||!(R(t)||P(t)||be(t)&&!(t>=65097&&t<=65103)||ie(t)||K(t)||m(t)||N(t)||!(!E(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||ae(t)||W(t)||Z(t)||(e=>e>=12592&&e<=12687)(t)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||te(t)||M(t)||b(t)||(e=>e>=12688&&e<=12703)(t)||y(t)||H(t)||k(t)&&t!==12540||!(!Fe(t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Xe(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||ge(t)||(e=>e>=19904&&e<=19967)(t)||re(t)||ne(t))))}function ct(t){return!(ze(t)||function(e){return!!((r=>r>=128&&r<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(r=>r>=8192&&r<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&e!==9251||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||E(e)||k(e)||(r=>r>=57344&&r<=63743)(e)||be(e)||Xe(e)||Fe(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function mt(t){return t>=1424&&t<=2303||se(t)||Ne(t)}function kt(t,e){return!(!e&&mt(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(r=>r>=6016&&r<=6143)(t))}function We(t){for(const e of t)if(mt(e.charCodeAt(0)))return!0;return!1}const ft="deferred",xt="loading",ai="loaded";let yi=null,yt="unavailable",Lt=null;const Ci=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(yt="error"),yi&&yi(t)};function Ji(){kr.fire(new ao("pluginStateChange",{pluginStatus:yt,pluginURL:Lt}))}const kr=new so,sn=function(){return yt},En=function(){if(yt!==ft||!Lt)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");yt=xt,Ji(),Lt&&Aa({url:Lt},t=>{t?Ci(t):(yt=ai,Ji())})},$t={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>yt===ai||$t.applyArabicShaping!=null,isLoading:()=>yt===xt,setState(t){yt=t.pluginStatus,Lt=t.pluginURL},isParsed:()=>$t.applyArabicShaping!=null&&$t.processBidirectionalText!=null&&$t.processStyledBidirectionalText!=null,getPluginURL:()=>Lt};class bt{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new h,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,n){for(const l of r)if(!kt(l.charCodeAt(0),n))return!1;return!0}(e,$t.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*r}}}class Ft{constructor(e,r){this.property=e,this.value=r,this.expression=function(n,l){if(js(n))return new ta(n,l);if(ea(n)){const u=Gu(n,l);if(u.result==="error")throw new Error(u.value.map(f=>`${f.key}: ${f.message}`).join(", "));return u.value}{let u=n;return typeof n=="string"&&l.type==="color"&&(u=Xt.parse(n)),{kind:"constant",evaluate:()=>u}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,n){return this.property.possiblyEvaluate(this,e,r,n)}}class Fi{constructor(e){this.property=e,this.value=new Ft(e,void 0)}transitioned(e,r){return new Ei(this.property,this.value,r,Wt({},e.transition,this.transition),e.now)}untransitioned(){return new Ei(this.property,this.value,null,{},0)}}class Vr{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return je(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Fi(this._values[e].property)),this._values[e].value=new Ft(this._values[e].property,r===null?void 0:je(r))}getTransition(e){return je(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Fi(this._values[e].property)),this._values[e].transition=je(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n);const l=this.getTransition(r);l!==void 0&&(e[`${r}-transition`]=l)}return e}transitioned(e,r){const n=new $r(this._properties);for(const l of Object.keys(this._values))n._values[l]=this._values[l].transitioned(e,r._values[l]);return n}untransitioned(){const e=new $r(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Ei{constructor(e,r,n,l,u){const f=l.delay||0,g=l.duration||0;u=u||0,this.property=e,this.value=r,this.begin=u+f,this.end=this.begin+g,e.specification.transition&&(l.delay||l.duration)&&(this.prior=n)}possiblyEvaluate(e,r,n){const l=e.now||0,u=this.value.possiblyEvaluate(e,r,n),f=this.prior;if(f){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return f.possiblyEvaluate(e,r,n);{const g=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,r,n),u,Yr(g))}}return u}}class $r{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,n){const l=new Lo(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,r,n);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ja{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return je(this._values[e].value)}setValue(e,r){this._values[e]=new Ft(this._values[e].property,r===null?void 0:je(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const n=this.getValue(r);n!==void 0&&(e[r]=n)}return e}possiblyEvaluate(e,r,n){const l=new Lo(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,r,n);return l}}class zr{constructor(e,r,n){this.property=e,this.value=r,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,n,l){return this.property.evaluate(this.value,this.parameters,e,r,n,l)}}class Lo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class nt{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,n){const l=ks[this.specification.type];return l?l(e,r,n):e}}class pt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,n,l){return new zr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},n,l)}:e.expression,r)}interpolate(e,r,n){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new zr(this,{kind:"constant",value:void 0},e.parameters);const l=ks[this.specification.type];return l?new zr(this,{kind:"constant",value:l(e.value.value,r.value.value,n)},e.parameters):e}evaluate(e,r,n,l,u,f){return e.kind==="constant"?e.value:e.evaluate(r,n,l,u,f)}}class or extends pt{possiblyEvaluate(e,r,n,l){if(e.value===void 0)return new zr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const u=e.expression.evaluate(r,null,{},n,l),f=e.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,g=this._calculate(f,f,f,r);return new zr(this,{kind:"constant",value:g},r)}if(e.expression.kind==="camera"){const u=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new zr(this,{kind:"constant",value:u},r)}return new zr(this,e.expression,r)}evaluate(e,r,n,l,u,f){if(e.kind==="source"){const g=e.evaluate(r,n,l,u,f);return this._calculate(g,g,g,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},n,l),e.evaluate({zoom:Math.floor(r.zoom)},n,l),e.evaluate({zoom:Math.floor(r.zoom)+1},n,l),r):e.value}_calculate(e,r,n,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:r,other:n}:{from:n,to:r,other:e}}interpolate(e){return e}}class Ro{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,l){if(e.value!==void 0){if(e.expression.kind==="constant"){const u=e.expression.evaluate(r,null,{},n,l);return this._calculate(u,u,u,r)}return this._calculate(e.expression.evaluate(new bt(Math.floor(r.zoom-1),r)),e.expression.evaluate(new bt(Math.floor(r.zoom),r)),e.expression.evaluate(new bt(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,n,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:n,to:r}}interpolate(e){return e}}class yo{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,l){return!!e.expression.evaluate(r,null,{},n,l)}interpolate(){return!1}}class hr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const n=e[r];n.specification.overridable&&this.overridableProperties.push(r);const l=this.defaultPropertyValues[r]=new Ft(n,void 0),u=this.defaultTransitionablePropertyValues[r]=new Fi(n);this.defaultTransitioningPropertyValues[r]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}function rm(t,e){return 256*(t=Vt(Math.floor(t),0,255))+Vt(Math.floor(e),0,255)}it("DataDrivenProperty",pt),it("DataConstantProperty",nt),it("CrossFadedDataDrivenProperty",or),it("CrossFadedProperty",Ro),it("ColorRampProperty",yo);const Hv={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _c{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Wi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Oi(t,e=1){let r=0,n=0;return{members:t.map(l=>{const u=Hv[l.type].BYTES_PER_ELEMENT,f=r=nm(r,Math.max(e,u)),g=l.components||1;return n=Math.max(n,u),r+=u*g,{name:l.name,type:l.type,components:g,offset:f}}),size:nm(r,Math.max(n,e)),alignment:e}}function nm(t,e){return Math.ceil(t/e)*e}class Js extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const l=2*e;return this.int16[l+0]=r,this.int16[l+1]=n,e}}Js.prototype.bytesPerElement=4,it("StructArrayLayout2i4",Js);class Qs extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,n,l)}emplace(e,r,n,l,u){const f=4*e;return this.int16[f+0]=r,this.int16[f+1]=n,this.int16[f+2]=l,this.int16[f+3]=u,e}}Qs.prototype.bytesPerElement=8,it("StructArrayLayout4i8",Qs);class Wd extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,n,l,u,f,g)}emplace(e,r,n,l,u,f,g,v){const w=6*e,A=12*e,C=3*e;return this.int16[w+0]=r,this.int16[w+1]=n,this.uint8[A+4]=l,this.uint8[A+5]=u,this.uint8[A+6]=f,this.uint8[A+7]=g,this.float32[C+2]=v,e}}Wd.prototype.bytesPerElement=12,it("StructArrayLayout2i4ub1f12",Wd);class el extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,n)}emplace(e,r,n,l){const u=3*e;return this.float32[u+0]=r,this.float32[u+1]=n,this.float32[u+2]=l,e}}el.prototype.bytesPerElement=12,it("StructArrayLayout3f12",el);class la extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,f,g,v,w,A){const C=this.length;return this.resize(C+1),this.emplace(C,e,r,n,l,u,f,g,v,w,A)}emplace(e,r,n,l,u,f,g,v,w,A,C){const I=10*e;return this.uint16[I+0]=r,this.uint16[I+1]=n,this.uint16[I+2]=l,this.uint16[I+3]=u,this.uint16[I+4]=f,this.uint16[I+5]=g,this.uint16[I+6]=v,this.uint16[I+7]=w,this.uint16[I+8]=A,this.uint16[I+9]=C,e}}la.prototype.bytesPerElement=20,it("StructArrayLayout10ui20",la);class ih extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,f,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,r,n,l,u,f,g,v)}emplace(e,r,n,l,u,f,g,v,w){const A=8*e;return this.uint16[A+0]=r,this.uint16[A+1]=n,this.uint16[A+2]=l,this.uint16[A+3]=u,this.uint16[A+4]=f,this.uint16[A+5]=g,this.uint16[A+6]=v,this.uint16[A+7]=w,e}}ih.prototype.bytesPerElement=16,it("StructArrayLayout8ui16",ih);class Xd extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,f,g,v,w,A,C,I,L,B,V,q){const Q=this.length;return this.resize(Q+1),this.emplace(Q,e,r,n,l,u,f,g,v,w,A,C,I,L,B,V,q)}emplace(e,r,n,l,u,f,g,v,w,A,C,I,L,B,V,q,Q){const oe=16*e;return this.int16[oe+0]=r,this.int16[oe+1]=n,this.int16[oe+2]=l,this.int16[oe+3]=u,this.uint16[oe+4]=f,this.uint16[oe+5]=g,this.uint16[oe+6]=v,this.uint16[oe+7]=w,this.int16[oe+8]=A,this.int16[oe+9]=C,this.int16[oe+10]=I,this.int16[oe+11]=L,this.int16[oe+12]=B,this.int16[oe+13]=V,this.int16[oe+14]=q,this.int16[oe+15]=Q,e}}Xd.prototype.bytesPerElement=32,it("StructArrayLayout4i4ui4i4i32",Xd);class Hd extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Hd.prototype.bytesPerElement=4,it("StructArrayLayout1ul4",Hd);class Kd extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,f,g,v,w,A,C,I,L){const B=this.length;return this.resize(B+1),this.emplace(B,e,r,n,l,u,f,g,v,w,A,C,I,L)}emplace(e,r,n,l,u,f,g,v,w,A,C,I,L,B){const V=20*e,q=10*e;return this.int16[V+0]=r,this.int16[V+1]=n,this.int16[V+2]=l,this.int16[V+3]=u,this.int16[V+4]=f,this.float32[q+3]=g,this.float32[q+4]=v,this.float32[q+5]=w,this.float32[q+6]=A,this.int16[V+14]=C,this.uint32[q+8]=I,this.uint16[V+18]=L,this.uint16[V+19]=B,e}}Kd.prototype.bytesPerElement=40,it("StructArrayLayout5i4f1i1ul2ui40",Kd);class rh extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,n,l,u,f,g)}emplace(e,r,n,l,u,f,g,v){const w=8*e;return this.int16[w+0]=r,this.int16[w+1]=n,this.int16[w+2]=l,this.int16[w+4]=u,this.int16[w+5]=f,this.int16[w+6]=g,this.int16[w+7]=v,e}}rh.prototype.bytesPerElement=16,it("StructArrayLayout3i2i2i16",rh);class Yd extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,n,l,u)}emplace(e,r,n,l,u,f){const g=4*e,v=8*e;return this.float32[g+0]=r,this.float32[g+1]=n,this.float32[g+2]=l,this.int16[v+6]=u,this.int16[v+7]=f,e}}Yd.prototype.bytesPerElement=16,it("StructArrayLayout2f1f2i16",Yd);class Jd extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,n,l)}emplace(e,r,n,l,u){const f=12*e,g=3*e;return this.uint8[f+0]=r,this.uint8[f+1]=n,this.float32[g+1]=l,this.float32[g+2]=u,e}}Jd.prototype.bytesPerElement=12,it("StructArrayLayout2ub2f12",Jd);class An extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,n)}emplace(e,r,n,l){const u=3*e;return this.uint16[u+0]=r,this.uint16[u+1]=n,this.uint16[u+2]=l,e}}An.prototype.bytesPerElement=6,it("StructArrayLayout3ui6",An);class Qd extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,f,g,v,w,A,C,I,L,B,V,q,Q,oe,ce,de,pe){const me=this.length;return this.resize(me+1),this.emplace(me,e,r,n,l,u,f,g,v,w,A,C,I,L,B,V,q,Q,oe,ce,de,pe)}emplace(e,r,n,l,u,f,g,v,w,A,C,I,L,B,V,q,Q,oe,ce,de,pe,me){const ke=30*e,Ce=15*e,He=60*e;return this.int16[ke+0]=r,this.int16[ke+1]=n,this.int16[ke+2]=l,this.float32[Ce+2]=u,this.float32[Ce+3]=f,this.uint16[ke+8]=g,this.uint16[ke+9]=v,this.uint32[Ce+5]=w,this.uint32[Ce+6]=A,this.uint32[Ce+7]=C,this.uint16[ke+16]=I,this.uint16[ke+17]=L,this.uint16[ke+18]=B,this.float32[Ce+10]=V,this.float32[Ce+11]=q,this.uint8[He+48]=Q,this.uint8[He+49]=oe,this.uint8[He+50]=ce,this.uint32[Ce+13]=de,this.int16[ke+28]=pe,this.uint8[He+58]=me,e}}Qd.prototype.bytesPerElement=60,it("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Qd);class ef extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,f,g,v,w,A,C,I,L,B,V,q,Q,oe,ce,de,pe,me,ke,Ce,He,Ge,Me,Ze,Ke,De){const tt=this.length;return this.resize(tt+1),this.emplace(tt,e,r,n,l,u,f,g,v,w,A,C,I,L,B,V,q,Q,oe,ce,de,pe,me,ke,Ce,He,Ge,Me,Ze,Ke,De)}emplace(e,r,n,l,u,f,g,v,w,A,C,I,L,B,V,q,Q,oe,ce,de,pe,me,ke,Ce,He,Ge,Me,Ze,Ke,De,tt){const ot=38*e,jt=19*e;return this.int16[ot+0]=r,this.int16[ot+1]=n,this.int16[ot+2]=l,this.float32[jt+2]=u,this.float32[jt+3]=f,this.int16[ot+8]=g,this.int16[ot+9]=v,this.int16[ot+10]=w,this.int16[ot+11]=A,this.int16[ot+12]=C,this.int16[ot+13]=I,this.uint16[ot+14]=L,this.uint16[ot+15]=B,this.uint16[ot+16]=V,this.uint16[ot+17]=q,this.uint16[ot+18]=Q,this.uint16[ot+19]=oe,this.uint16[ot+20]=ce,this.uint16[ot+21]=de,this.uint16[ot+22]=pe,this.uint16[ot+23]=me,this.uint16[ot+24]=ke,this.uint16[ot+25]=Ce,this.uint16[ot+26]=He,this.uint16[ot+27]=Ge,this.uint16[ot+28]=Me,this.uint32[jt+15]=Ze,this.float32[jt+16]=Ke,this.float32[jt+17]=De,this.float32[jt+18]=tt,e}}ef.prototype.bytesPerElement=76,it("StructArrayLayout3i2f6i15ui1ul3f76",ef);class nh extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}nh.prototype.bytesPerElement=4,it("StructArrayLayout1f4",nh);class tf extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,n)}emplace(e,r,n,l){const u=3*e;return this.int16[u+0]=r,this.int16[u+1]=n,this.int16[u+2]=l,e}}tf.prototype.bytesPerElement=6,it("StructArrayLayout3i6",tf);class gc extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,l,u,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,n,l,u,f,g)}emplace(e,r,n,l,u,f,g,v){const w=7*e;return this.float32[w+0]=r,this.float32[w+1]=n,this.float32[w+2]=l,this.float32[w+3]=u,this.float32[w+4]=f,this.float32[w+5]=g,this.float32[w+6]=v,e}}gc.prototype.bytesPerElement=28,it("StructArrayLayout7f28",gc);class rf extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,n,l)}emplace(e,r,n,l,u){const f=6*e;return this.uint32[3*e+0]=r,this.uint16[f+2]=n,this.uint16[f+3]=l,this.uint16[f+4]=u,e}}rf.prototype.bytesPerElement=12,it("StructArrayLayout1ul3ui12",rf);class ca extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const l=2*e;return this.uint16[l+0]=r,this.uint16[l+1]=n,e}}ca.prototype.bytesPerElement=4,it("StructArrayLayout2ui4",ca);class oh extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}oh.prototype.bytesPerElement=2,it("StructArrayLayout1ui2",oh);class ah extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){const l=2*e;return this.float32[l+0]=r,this.float32[l+1]=n,e}}ah.prototype.bytesPerElement=8,it("StructArrayLayout2f8",ah);class nf extends Wi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,n,l)}emplace(e,r,n,l,u){const f=4*e;return this.float32[f+0]=r,this.float32[f+1]=n,this.float32[f+2]=l,this.float32[f+3]=u,e}}nf.prototype.bytesPerElement=16,it("StructArrayLayout4f16",nf);class om extends _c{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}om.prototype.size=40;class of extends Kd{get(e){return new om(this,e)}}it("CollisionBoxArray",of);class am extends _c{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}am.prototype.size=60;class sm extends Qd{get(e){return new am(this,e)}}it("PlacedSymbolArray",sm);class lm extends _c{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}lm.prototype.size=76;class cm extends ef{get(e){return new lm(this,e)}}it("SymbolInstanceArray",cm);class um extends nh{getoffsetX(e){return this.float32[1*e+0]}}it("GlyphOffsetArray",um);class hm extends tf{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}it("SymbolLineVertexArray",hm);class dm extends _c{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}dm.prototype.size=12;class fm extends rf{get(e){return new dm(this,e)}}it("FeatureIndexArray",fm);class pm extends _c{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}pm.prototype.size=4;class mm extends ca{get(e){return new pm(this,e)}}it("FillExtrusionCentroidArray",mm);const Kv=Oi([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Yv=Oi([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var _m=Ko(function(t){t.exports=function(e,r){var n,l,u,f,g,v,w,A;for(l=e.length-(n=3&e.length),u=r,g=3432918353,v=461845907,A=0;A<l;)w=255&e.charCodeAt(A)|(255&e.charCodeAt(++A))<<8|(255&e.charCodeAt(++A))<<16|(255&e.charCodeAt(++A))<<24,++A,u=27492+(65535&(f=5*(65535&(u=(u^=w=(65535&(w=(w=(65535&w)*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(w=0,n){case 3:w^=(255&e.charCodeAt(A+2))<<16;case 2:w^=(255&e.charCodeAt(A+1))<<8;case 1:u^=w=(65535&(w=(w=(65535&(w^=255&e.charCodeAt(A)))*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}}),Jv=Ko(function(t){t.exports=function(e,r){for(var n,l=e.length,u=r^l,f=0;l>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(f)|(255&e.charCodeAt(++f))<<8|(255&e.charCodeAt(++f))<<16|(255&e.charCodeAt(++f))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),l-=4,++f;switch(l){case 3:u^=(255&e.charCodeAt(f+2))<<16;case 2:u^=(255&e.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}}),yc=_m,Qv=Jv;yc.murmur3=_m,yc.murmur2=Qv;class sh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,n,l){this.ids.push(gm(e)),this.positions.push(r,n,l)}getPositions(e){const r=gm(e);let n=0,l=this.ids.length-1;for(;n<l;){const f=n+l>>1;this.ids[f]>=r?l=f:n=f+1}const u=[];for(;this.ids[n]===r;)u.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return u}static serialize(e,r){const n=new Float64Array(e.ids),l=new Uint32Array(e.positions);return af(n,l,0,n.length-1),r&&r.push(n.buffer,l.buffer),{ids:n,positions:l}}static deserialize(e){const r=new sh;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function gm(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:yc(String(t))}function af(t,e,r,n){for(;r<n;){const l=t[r+n>>1];let u=r-1,f=n+1;for(;;){do u++;while(t[u]<l);do f--;while(t[f]>l);if(u>=f)break;lh(t,u,f),lh(e,3*u,3*f),lh(e,3*u+1,3*f+1),lh(e,3*u+2,3*f+2)}f-r<n-f?(af(t,e,r,f),r=f+1):(af(t,e,f+1,n),n=f)}}function lh(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}it("FeaturePositionMap",sh);class Bo{constructor(e,r){this.gl=e.gl,this.location=r}}class ch extends Bo{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class ym extends Bo{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class vm extends Bo{constructor(e,r){super(e,r),this.current=Xt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const ex=new Float32Array(16),tx=new Float32Array(9),ix=new Float32Array(4);function sf(t){return[rm(255*t.r,255*t.g),rm(255*t.b,255*t.a)]}class vc{constructor(e,r,n){this.value=e,this.uniformNames=r.map(l=>`u_${l}`),this.type=n}setUniform(e,r,n){e.set(n.constantOr(this.value))}getBinding(e,r,n){return this.type==="color"?new vm(e,r):new ch(e,r)}}class tl{constructor(e,r){this.uniformNames=r.map(n=>`u_${n}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tl.concat(r.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,r,n,l){const u=l==="u_pattern_to"||l==="u_dash_to"?this.patternTo:l==="u_pattern_from"||l==="u_dash_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;u&&e.set(u)}getBinding(e,r,n){return n==="u_pattern_from"||n==="u_pattern_to"||n==="u_dash_from"||n==="u_dash_to"?new ym(e,r):new ch(e,r)}}class Oo{constructor(e,r,n,l){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=r.map(u=>({name:`a_${u}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,r,n,l,u,f){const g=this.paintVertexArray.length,v=this.expression.evaluate(new bt(0),r,{},u,l,f);this.paintVertexArray.resize(e),this._setPaintValue(g,e,v)}updatePaintArray(e,r,n,l,u){const f=this.expression.evaluate({zoom:0},n,l,void 0,u);this._setPaintValue(e,r,f)}_setPaintValue(e,r,n){if(this.type==="color"){const l=sf(n);for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,l[0],l[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Zn{constructor(e,r,n,l,u,f){this.expression=e,this.uniformNames=r.map(g=>`u_${g}_t`),this.type=n,this.useIntegerZoom=l,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,r,n,l,u,f){const g=this.expression.evaluate(new bt(this.zoom),r,{},u,l,f),v=this.expression.evaluate(new bt(this.zoom+1),r,{},u,l,f),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,g,v)}updatePaintArray(e,r,n,l,u){const f=this.expression.evaluate({zoom:this.zoom},n,l,void 0,u),g=this.expression.evaluate({zoom:this.zoom+1},n,l,void 0,u);this._setPaintValue(e,r,f,g)}_setPaintValue(e,r,n,l){if(this.type==="color"){const u=sf(n),f=sf(l);for(let g=e;g<r;g++)this.paintVertexArray.emplace(g,u[0],u[1],f[0],f[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,n,l);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const n=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=Vt(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(l)}getBinding(e,r,n){return new ch(e,r)}}class ua{constructor(e,r,n,l,u,f,g){this.expression=e,this.type=n,this.useIntegerZoom=l,this.zoom=u,this.layerId=g,this.paintVertexAttributes=(n==="array"?Yv:Kv).members;for(let v=0;v<r.length;++v);this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,r,n){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(l,e,r.patterns&&r.patterns[this.layerId],n)}updatePaintArray(e,r,n,l,u,f){this._setPaintValues(e,r,n.patterns&&n.patterns[this.layerId],f)}_setPaintValues(e,r,n,l){if(!l||!n)return;const{min:u,mid:f,max:g}=n,v=l[u],w=l[f],A=l[g];if(v&&w&&A)for(let C=e;C<r;C++)this._setPaintValue(this.zoomInPaintVertexArray,C,w,v),this._setPaintValue(this.zoomOutPaintVertexArray,C,w,A)}_setPaintValue(e,r,n,l){e.emplace(r,n.tl[0],n.tl[1],n.br[0],n.br[1],l.tl[0],l.tl[1],l.br[0],l.br[1],n.pixelRatio,l.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Fo{constructor(e,r,n=()=>!0){this.binders={},this._buffers=[];const l=[];for(const u in e.paint._values){if(!n(u))continue;const f=e.paint.get(u);if(!(f instanceof zr&&Qo(f.property.specification)))continue;const g=nx(u,e.type),v=f.value,w=f.property.specification.type,A=f.property.useIntegerZoom,C=f.property.specification["property-type"],I=C==="cross-faded"||C==="cross-faded-data-driven",L=String(u)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(v.kind!=="constant"||L)if(v.kind==="source"||L||I){const B=xm(u,w,"source");this.binders[u]=I?new ua(v,g,w,A,r,B,e.id):new Oo(v,g,w,B),l.push(`/a_${u}`)}else{const B=xm(u,w,"composite");this.binders[u]=new Zn(v,g,w,A,r,B),l.push(`/z_${u}`)}else this.binders[u]=I?new tl(v.value,g):new vc(v.value,g,w),l.push(`/u_${u}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Oo||r instanceof Zn?r.maxValue:0}populatePaintArrays(e,r,n,l,u,f){for(const g in this.binders){const v=this.binders[g];(v instanceof Oo||v instanceof Zn||v instanceof ua)&&v.populatePaintArray(e,r,n,l,u,f)}}setConstantPatternPositions(e,r){for(const n in this.binders){const l=this.binders[n];l instanceof tl&&l.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,n,l,u,f){let g=!1;for(const v in e){const w=r.getPositions(v);for(const A of w){const C=n.feature(A.index);for(const I in this.binders){const L=this.binders[I];if((L instanceof Oo||L instanceof Zn||L instanceof ua)&&L.expression.isStateDependent===!0){const B=l.paint.get(I);L.expression=B.value,L.updatePaintArray(A.start,A.end,C,e[v],u,f),g=!0}}}}return g}defines(){const e=[];for(const r in this.binders){const n=this.binders[r];(n instanceof vc||n instanceof tl)&&e.push(...n.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof Oo||n instanceof Zn||n instanceof ua)for(let l=0;l<n.paintVertexAttributes.length;l++)e.push(n.paintVertexAttributes[l].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof vc||n instanceof tl||n instanceof Zn)for(const l of n.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const n=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof vc||u instanceof tl||u instanceof Zn){for(const f of u.uniformNames)if(r[f]){const g=u.getBinding(e,r[f],f);n.push({name:f,property:l,binding:g})}}}return n}setUniforms(e,r,n,l){for(const{name:u,property:f,binding:g}of r)this.binders[f].setUniform(g,l,n.get(f),u)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const n=this.binders[r];if(e&&n instanceof ua){const l=e.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(n instanceof Oo||n instanceof Zn)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const r in this.binders){const n=this.binders[r];(n instanceof Oo||n instanceof Zn||n instanceof ua)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Oo||r instanceof Zn||r instanceof ua)&&r.destroy()}}}class Qa{constructor(e,r,n=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Fo(l,r,n);this.needsUpload=!1,this._featureMap=new sh,this._bufferOffset=0}populatePaintArrays(e,r,n,l,u,f,g){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,r,l,u,f,g);r.id!==void 0&&this._featureMap.add(r.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,n,l,u){for(const f of n)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,r,f,l,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const rx={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function nx(t,e){return rx[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const ox={"line-pattern":{source:la,composite:la},"fill-pattern":{source:la,composite:la},"fill-extrusion-pattern":{source:la,composite:la},"line-dasharray":{source:ih,composite:ih}},ax={color:{source:ah,composite:nf},number:{source:nh,composite:ah}};function xm(t,e,r){const n=ox[t];return n&&n[r]||ax[e][r]}it("ConstantBinder",vc),it("CrossFadedConstantBinder",tl),it("SourceExpressionBinder",Oo),it("CrossFadedCompositeBinder",ua),it("CompositeExpressionBinder",Zn),it("ProgramConfiguration",Fo,{omit:["_buffers"]}),it("ProgramConfigurationSet",Qa);const uh="-transition";class qn extends so{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Ja(r.layout)),r.paint)){this._transitionablePaint=new Vr(r.paint);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Lo(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,n={}){r!=null&&this._validate(qd,`layers.${this.id}.layout.${e}`,e,r,n)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return xr(e,uh)?this._transitionablePaint.getTransition(e.slice(0,-uh.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,n={}){if(r!=null&&this._validate(mc,`layers.${this.id}.paint.${e}`,e,r,n))return!1;if(xr(e,uh))return this._transitionablePaint.setTransition(e.slice(0,-uh.length),r||void 0),!1;{const l=this._transitionablePaint._values[e],u=l.property.specification["property-type"]==="cross-faded-data-driven",f=l.value.isDataDriven(),g=l.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const v=this._transitionablePaint._values[e].value;return v.isDataDriven()||f||u||this._handleOverridablePaintPropertyUpdate(e,g,v)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),oo(e,(r,n)=>!(r===void 0||n==="layout"&&!Object.keys(r).length||n==="paint"&&!Object.keys(r).length))}_validate(e,r,n,l,u={}){return(!u||u.validate!==!1)&&eh(this,e.call(na,{key:r,layerType:this.type,objectKey:n,value:l,styleSpec:Ee,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof zr&&Qo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Xs(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const sx=Oi([{name:"a_pos",components:2,type:"Int16"}],4),{members:lx}=sx;class Xi{constructor(e=[]){this.segments=e}prepareSegment(e,r,n,l){let u=this.segments[this.segments.length-1];return e>Xi.MAX_VERTEX_ARRAY_LENGTH&&Je(`Max vertices per segment is ${Xi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>Xi.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:r.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},l!==void 0&&(u.sortKey=l),this.segments.push(u)),u}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,n,l){return new Xi([{vertexOffset:e,primitiveOffset:r,vertexLength:n,primitiveLength:l,vaos:{},sortKey:0}])}}Xi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,it("SegmentVector",Xi);var Rt=8192;class es{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof mi?new mi(e.lng,e.lat):mi.convert(e),this}setSouthWest(e){return this._sw=e instanceof mi?new mi(e.lng,e.lat):mi.convert(e),this}extend(e){const r=this._sw,n=this._ne;let l,u;if(e instanceof mi)l=e,u=e;else{if(!(e instanceof es))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(es.convert(e)):this.extend(mi.convert(e)):this;if(l=e._sw,u=e._ne,!l||!u)return this}return r||n?(r.lng=Math.min(l.lng,r.lng),r.lat=Math.min(l.lat,r.lat),n.lng=Math.max(u.lng,n.lng),n.lat=Math.max(u.lat,n.lat)):(this._sw=new mi(l.lng,l.lat),this._ne=new mi(u.lng,u.lat)),this}getCenter(){return new mi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new mi(this.getWest(),this.getNorth())}getSouthEast(){return new mi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:n}=mi.convert(e);let l=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&l}static convert(e){return!e||e instanceof es?e:new es(e)}}const bm=63710088e-1;class mi{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new mi(vr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,n=this.lat*r,l=e.lat*r,u=Math.sin(n)*Math.sin(l)+Math.cos(n)*Math.cos(l)*Math.cos((e.lng-this.lng)*r);return bm*Math.acos(Math.min(u,1))}toBounds(e=0){const r=360*e/40075017,n=r/Math.cos(Math.PI/180*this.lat);return new es(new mi(this.lng-n,this.lat-r),new mi(this.lng+n,this.lat+r))}static convert(e){if(e instanceof mi)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new mi(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new mi(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const wm=2*Math.PI*bm;function Tm(t){return wm*Math.cos(t*Math.PI/180)}function il(t){return(180+t)/360}function rl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Wn(t,e){return t/Tm(e)}function Uo(t){return 360*t-180}function On(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Sm(t,e){return t*Tm(On(e))}const vo=85.051129;class hh{constructor(e,r,n=0){this.x=+e,this.y=+r,this.z=+n}static fromLngLat(e,r=0){const n=mi.convert(e);return new hh(il(n.lng),rl(n.lat),Wn(r,n.lat))}toLngLat(){return new mi(Uo(this.x),On(this.y))}toAltitude(){return Sm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/wm*(e=On(this.y),1/Math.cos(e*Math.PI/180));var e}}function lf(t,e,r,n,l,u,f,g,v){const w=(e+n)/2,A=(r+l)/2,C=new $(w,A);g(C),function(I,L,B,V,q,Q){const oe=B-q,ce=V-Q;return Math.abs((V-L)*oe-(B-I)*ce)/Math.hypot(oe,ce)}(C.x,C.y,u.x,u.y,f.x,f.y)>=v?(lf(t,e,r,w,A,u,C,g,v),lf(t,w,A,n,l,C,f,g,v)):t.push(f)}function cx(t,e,r){const n=[];let l,u,f;for(const g of t){const{x:v,y:w}=g;e(g),f?lf(n,l,u,v,w,f,g,e,r):n.push(g),l=v,u=w,f=g}return n}const cf=Math.pow(2,14)-1,Em=-cf-1;function ux(t,e){const r=Math.round(t.x*e),n=Math.round(t.y*e);return t.x=Vt(r,Em,cf),t.y=Vt(n,Em,cf),(r<t.x||r>t.x+1||n<t.y||n>t.y+1)&&Je("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function No(t,e,r){const n=t.loadGeometry(),l=t.extent,u=Rt/l;if(e&&r&&r.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:g,x:v,y:w,projection:A}=r,C=I=>{const L=Uo((e.x+I.x/l)/f),B=On((e.y+I.y/l)/f),V=A.project(L,B);I.x=(V.x*g-v)*l,I.y=(V.y*g-w)*l};for(let I=0;I<n.length;I++)if(t.type!==1)n[I]=cx(n[I],C,1);else{const L=[];for(const B of n[I])B.x<0||B.x>=l||B.y<0||B.y>=l||(C(B),L.push(B));n[I]=L}}for(const f of n)for(const g of f)ux(g,u);return n}function ts(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?No(t):[]}}function dh(t,e,r,n,l){t.emplaceBack(2*e+(n+1)/2,2*r+(l+1)/2)}class uf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Js,this.indexArray=new An,this.segments=new Xi,this.programConfigurations=new Qa(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,l){const u=this.layers[0],f=[];let g=null;u.type==="circle"&&(g=u.layout.get("circle-sort-key"));for(const{feature:v,id:w,index:A,sourceLayerIndex:C}of e){const I=this.layers[0]._featureFilter.needGeometry,L=ts(v,I);if(!this.layers[0]._featureFilter.filter(new bt(this.zoom),L,n))continue;const B=g?g.evaluate(L,{},n):void 0,V={id:w,properties:v.properties,type:v.type,sourceLayerIndex:C,index:A,geometry:I?L.geometry:No(v,n,l),patterns:{},sortKey:B};f.push(V)}g&&f.sort((v,w)=>v.sortKey-w.sortKey);for(const v of f){const{geometry:w,index:A,sourceLayerIndex:C}=v,I=e[A].feature;this.addFeature(v,w,A,r.availableImages,n),r.featureIndex.insert(I,w,A,C,this.index)}}update(e,r,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lx),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,n,l,u){for(const f of r)for(const g of f){const v=g.x,w=g.y;if(v<0||v>=Rt||w<0||w>=Rt)continue;const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),C=A.vertexLength;dh(this.layoutVertexArray,v,w,-1,-1),dh(this.layoutVertexArray,v,w,1,-1),dh(this.layoutVertexArray,v,w,1,1),dh(this.layoutVertexArray,v,w,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+3,C+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},l,u)}}function Am(t,e){for(let r=0;r<t.length;r++)if(nl(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(nl(t,e[r]))return!0;return!!hf(t,e)}function hx(t,e,r){return!!nl(t,e)||!!df(e,t,r)}function Cm(t,e){if(t.length===1)return Mm(e,t[0]);for(let r=0;r<e.length;r++){const n=e[r];for(let l=0;l<n.length;l++)if(nl(t,n[l]))return!0}for(let r=0;r<t.length;r++)if(Mm(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(hf(t,e[r]))return!0;return!1}function dx(t,e,r){if(t.length>1){if(hf(t,e))return!0;for(let n=0;n<e.length;n++)if(df(e[n],t,r))return!0}for(let n=0;n<t.length;n++)if(df(t[n],e,r))return!0;return!1}function hf(t,e){if(t.length===0||e.length===0)return!1;for(let r=0;r<t.length-1;r++){const n=t[r],l=t[r+1];for(let u=0;u<e.length-1;u++)if(fx(n,l,e[u],e[u+1]))return!0}return!1}function fx(t,e,r,n){return St(t,r,n)!==St(e,r,n)&&St(t,e,r)!==St(t,e,n)}function df(t,e,r){const n=r*r;if(e.length===1)return t.distSqr(e[0])<n;for(let l=1;l<e.length;l++)if(Im(t,e[l-1],e[l])<n)return!0;return!1}function Im(t,e,r){const n=e.distSqr(r);if(n===0)return t.distSqr(e);const l=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/n;return t.distSqr(l<0?e:l>1?r:r.sub(e)._mult(l)._add(e))}function Mm(t,e){let r,n,l,u=!1;for(let f=0;f<t.length;f++){r=t[f];for(let g=0,v=r.length-1;g<r.length;v=g++)n=r[g],l=r[v],n.y>e.y!=l.y>e.y&&e.x<(l.x-n.x)*(e.y-n.y)/(l.y-n.y)+n.x&&(u=!u)}return u}function nl(t,e){let r=!1;for(let n=0,l=t.length-1;n<t.length;l=n++){const u=t[n],f=t[l];u.y>e.y!=f.y>e.y&&e.x<(f.x-u.x)*(e.y-u.y)/(f.y-u.y)+u.x&&(r=!r)}return r}function km(t,e,r,n,l){for(const f of t)if(e<=f.x&&r<=f.y&&n>=f.x&&l>=f.y)return!0;const u=[new $(e,r),new $(e,l),new $(n,l),new $(n,r)];if(t.length>2){for(const f of u)if(nl(t,f))return!0}for(let f=0;f<t.length-1;f++)if(px(t[f],t[f+1],u))return!0;return!1}function px(t,e,r){const n=r[0],l=r[2];if(t.x<n.x&&e.x<n.x||t.x>l.x&&e.x>l.x||t.y<n.y&&e.y<n.y||t.y>l.y&&e.y>l.y)return!1;const u=St(t,e,r[0]);return u!==St(t,e,r[1])||u!==St(t,e,r[2])||u!==St(t,e,r[3])}function ol(t,e,r){const n=e.paint.get(t).value;return n.kind==="constant"?n.value:r.programConfigurations.get(e.id).getMaxValue(t)}function fh(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function zm(t,e,r,n,l){if(!e[0]&&!e[1])return t;const u=$.convert(e)._mult(l);r==="viewport"&&u._rotate(-n);const f=[];for(let g=0;g<t.length;g++)f.push(t[g].sub(u));return f}function Pm(t,e,r,n){const l=$.convert(t)._mult(n);return e==="viewport"&&l._rotate(-r),l}it("CircleBucket",uf,{omit:["layers"]});const mx=new hr({"circle-sort-key":new pt(Ee.layout_circle["circle-sort-key"])});var _x={paint:new hr({"circle-radius":new pt(Ee.paint_circle["circle-radius"]),"circle-color":new pt(Ee.paint_circle["circle-color"]),"circle-blur":new pt(Ee.paint_circle["circle-blur"]),"circle-opacity":new pt(Ee.paint_circle["circle-opacity"]),"circle-translate":new nt(Ee.paint_circle["circle-translate"]),"circle-translate-anchor":new nt(Ee.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new nt(Ee.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new nt(Ee.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pt(Ee.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pt(Ee.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pt(Ee.paint_circle["circle-stroke-opacity"])}),layout:mx};class ff{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,n,l){const u=Math.pow(2,n),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(v=>{const w=pr([],v,e),A=1/w[3]/r*u;return function(C,I,L){return C[0]=I[0]*L[0],C[1]=I[1]*L[1],C[2]=I[2]*L[2],C[3]=I[3]*L[3],C}(w,w,[A,A,l?1/w[3]:A,A])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(v=>{const w=Ct([],Li([],xn([],f[v[0]],f[v[1]]),xn([],f[v[2]],f[v[1]]))),A=-fi(w,f[v[1]]);return w.concat(A)});return new ff(f,g)}}class Xn{constructor(e,r){this.min=e,this.max=r,this.center=Ni([],wt([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],n=Ye(this.min),l=Ye(this.max);for(let u=0;u<r.length;u++)n[u]=r[u]?this.min[u]:this.center[u],l[u]=r[u]?this.center[u]:this.max[u];return l[2]=this.max[2],new Xn(n,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let n=!0;for(let l=0;l<e.planes.length;l++){const u=e.planes[l];let f=0;for(let g=0;g<r.length;g++)f+=fi(u,r[g])+u[3]>=0;if(f===0)return 0;f!==r.length&&(n=!1)}if(n)return 2;for(let l=0;l<3;l++){let u=Number.MAX_VALUE,f=-Number.MAX_VALUE;for(let g=0;g<e.points.length;g++){const v=e.points[g][l]-this.min[l];u=Math.min(u,v),f=Math.max(f,v)}if(f<0||u>this.max[l]-this.min[l])return 0}return 1}}function Dm(t,e,r,n,l,u,f,g,v){if(u&&t.queryGeometry.isAboveHorizon)return!1;u&&(v*=t.pixelToTileUnitsFactor);for(const w of e)for(const A of w){const C=A.add(g),I=l&&r.elevation?r.elevation.exaggeration()*l.getElevationAt(C.x,C.y,!0):0,L=u?C:gx(C,I,n),B=u?t.tilespaceRays.map(q=>vx(q,I)):t.queryGeometry.screenGeometry,V=pr([],[A.x,A.y,I,1],n);if(!f&&u?v*=V[3]/r.cameraToCenterDistance:f&&!u&&(v*=r.cameraToCenterDistance/V[3]),hx(B,L,v))return!0}return!1}function gx(t,e,r){const n=pr([],[t.x,t.y,e,1],r);return new $(n[0]/n[3],n[1]/n[3])}const Lm=st(0,0,0),yx=st(0,0,1);function vx(t,e){const r=Oe();return Lm[2]=e,t.intersectsPlane(Lm,yx,r),new $(r[0],r[1])}class Rm extends uf{}function pf(t,{width:e,height:r},n,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*r*n)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*r*n);return t.width=e,t.height=r,t.data=l,t}function Bm(t,{width:e,height:r},n){if(e===t.width&&r===t.height)return;const l=pf({},{width:e,height:r},n);mf(t,l,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,r)},n),t.width=e,t.height=r,t.data=l.data}function mf(t,e,r,n,l,u){if(l.width===0||l.height===0)return e;if(l.width>t.width||l.height>t.height||r.x>t.width-l.width||r.y>t.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||n.x>e.width-l.width||n.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const f=t.data,g=e.data;for(let v=0;v<l.height;v++){const w=((r.y+v)*t.width+r.x)*u,A=((n.y+v)*e.width+n.x)*u;for(let C=0;C<l.width*u;C++)g[A+C]=f[w+C]}return e}it("HeatmapBucket",Rm,{omit:["layers"]});class ha{constructor(e,r){pf(this,e,1,r)}resize(e){Bm(this,e,1)}clone(){return new ha({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,l,u){mf(e,r,n,l,u,1)}}class Cn{constructor(e,r){pf(this,e,4,r)}resize(e){Bm(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Cn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,l,u){mf(e,r,n,l,u,4)}}it("AlphaImage",ha),it("RGBAImage",Cn);var xx={paint:new hr({"heatmap-radius":new pt(Ee.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pt(Ee.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new nt(Ee.paint_heatmap["heatmap-intensity"]),"heatmap-color":new yo(Ee.paint_heatmap["heatmap-color"]),"heatmap-opacity":new nt(Ee.paint_heatmap["heatmap-opacity"])})};function _f(t){const e={},r=t.resolution||256,n=t.clips?t.clips.length:1,l=t.image||new Cn({width:r,height:n}),u=(f,g,v)=>{e[t.evaluationKey]=v;const w=t.expression.evaluate(e);l.data[f+g+0]=Math.floor(255*w.r/w.a),l.data[f+g+1]=Math.floor(255*w.g/w.a),l.data[f+g+2]=Math.floor(255*w.b/w.a),l.data[f+g+3]=Math.floor(255*w.a)};if(t.clips)for(let f=0,g=0;f<n;++f,g+=4*r)for(let v=0,w=0;v<r;v++,w+=4){const A=v/(r-1),{start:C,end:I}=t.clips[f];u(g,w,C*(1-A)+I*A)}else for(let f=0,g=0;f<r;f++,g+=4)u(0,g,f/(r-1));return l}var bx={paint:new hr({"hillshade-illumination-direction":new nt(Ee.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new nt(Ee.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new nt(Ee.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new nt(Ee.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new nt(Ee.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new nt(Ee.paint_hillshade["hillshade-accent-color"])})};const wx=Oi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Tx}=wx;var ph=mh,Sx=mh;function mh(t,e,r){r=r||2;var n,l,u,f,g,v,w,A=e&&e.length,C=A?e[0]*r:t.length,I=Om(t,0,C,r,!0),L=[];if(!I||I.next===I.prev)return L;if(A&&(I=function(V,q,Q,oe){var ce,de,pe,me=[];for(ce=0,de=q.length;ce<de;ce++)(pe=Om(V,q[ce]*oe,ce<de-1?q[ce+1]*oe:V.length,oe,!1))===pe.next&&(pe.steiner=!0),me.push(Px(pe));for(me.sort(Mx),ce=0;ce<me.length;ce++)Q=da(Q=kx(me[ce],Q),Q.next);return Q}(t,e,I,r)),t.length>80*r){n=u=t[0],l=f=t[1];for(var B=r;B<C;B+=r)(g=t[B])<n&&(n=g),(v=t[B+1])<l&&(l=v),g>u&&(u=g),v>f&&(f=v);w=(w=Math.max(u-n,f-l))!==0?1/w:0}return xc(I,L,r,n,l,w),L}function Om(t,e,r,n,l){var u,f;if(l===vf(t,e,r,n)>0)for(u=e;u<r;u+=n)f=Nm(u,t[u],t[u+1],f);else for(u=r-n;u>=e;u-=n)f=Nm(u,t[u],t[u+1],f);return f&&_h(f,f.next)&&(wc(f),f=f.next),f}function da(t,e){if(!t)return t;e||(e=t);var r,n=t;do if(r=!1,n.steiner||!_h(n,n.next)&&Hi(n.prev,n,n.next)!==0)n=n.next;else{if(wc(n),(n=e=n.prev)===n.next)break;r=!0}while(r||n!==e);return e}function xc(t,e,r,n,l,u,f){if(t){!f&&u&&function(A,C,I,L){var B=A;do B.z===null&&(B.z=gf(B.x,B.y,C,I,L)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==A);B.prevZ.nextZ=null,B.prevZ=null,function(V){var q,Q,oe,ce,de,pe,me,ke,Ce=1;do{for(Q=V,V=null,de=null,pe=0;Q;){for(pe++,oe=Q,me=0,q=0;q<Ce&&(me++,oe=oe.nextZ);q++);for(ke=Ce;me>0||ke>0&&oe;)me!==0&&(ke===0||!oe||Q.z<=oe.z)?(ce=Q,Q=Q.nextZ,me--):(ce=oe,oe=oe.nextZ,ke--),de?de.nextZ=ce:V=ce,ce.prevZ=de,de=ce;Q=oe}de.nextZ=null,Ce*=2}while(pe>1)}(B)}(t,n,l,u);for(var g,v,w=t;t.prev!==t.next;)if(g=t.prev,v=t.next,u?Ax(t,n,l,u):Ex(t))e.push(g.i/r),e.push(t.i/r),e.push(v.i/r),wc(t),t=v.next,w=v.next;else if((t=v)===w){f?f===1?xc(t=Cx(da(t),e,r),e,r,n,l,u,2):f===2&&Ix(t,e,r,n,l,u):xc(da(t),e,r,n,l,u,1);break}}}function Ex(t){var e=t.prev,r=t,n=t.next;if(Hi(e,r,n)>=0)return!1;for(var l=t.next.next;l!==t.prev;){if(al(e.x,e.y,r.x,r.y,n.x,n.y,l.x,l.y)&&Hi(l.prev,l,l.next)>=0)return!1;l=l.next}return!0}function Ax(t,e,r,n){var l=t.prev,u=t,f=t.next;if(Hi(l,u,f)>=0)return!1;for(var g=l.x>u.x?l.x>f.x?l.x:f.x:u.x>f.x?u.x:f.x,v=l.y>u.y?l.y>f.y?l.y:f.y:u.y>f.y?u.y:f.y,w=gf(l.x<u.x?l.x<f.x?l.x:f.x:u.x<f.x?u.x:f.x,l.y<u.y?l.y<f.y?l.y:f.y:u.y<f.y?u.y:f.y,e,r,n),A=gf(g,v,e,r,n),C=t.prevZ,I=t.nextZ;C&&C.z>=w&&I&&I.z<=A;){if(C!==t.prev&&C!==t.next&&al(l.x,l.y,u.x,u.y,f.x,f.y,C.x,C.y)&&Hi(C.prev,C,C.next)>=0||(C=C.prevZ,I!==t.prev&&I!==t.next&&al(l.x,l.y,u.x,u.y,f.x,f.y,I.x,I.y)&&Hi(I.prev,I,I.next)>=0))return!1;I=I.nextZ}for(;C&&C.z>=w;){if(C!==t.prev&&C!==t.next&&al(l.x,l.y,u.x,u.y,f.x,f.y,C.x,C.y)&&Hi(C.prev,C,C.next)>=0)return!1;C=C.prevZ}for(;I&&I.z<=A;){if(I!==t.prev&&I!==t.next&&al(l.x,l.y,u.x,u.y,f.x,f.y,I.x,I.y)&&Hi(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function Cx(t,e,r){var n=t;do{var l=n.prev,u=n.next.next;!_h(l,u)&&Fm(l,n,n.next,u)&&bc(l,u)&&bc(u,l)&&(e.push(l.i/r),e.push(n.i/r),e.push(u.i/r),wc(n),wc(n.next),n=t=u),n=n.next}while(n!==t);return da(n)}function Ix(t,e,r,n,l,u){var f=t;do{for(var g=f.next.next;g!==f.prev;){if(f.i!==g.i&&Dx(f,g)){var v=Um(f,g);return f=da(f,f.next),v=da(v,v.next),xc(f,e,r,n,l,u),void xc(v,e,r,n,l,u)}g=g.next}f=f.next}while(f!==t)}function Mx(t,e){return t.x-e.x}function kx(t,e){var r=function(u,f){var g,v=f,w=u.x,A=u.y,C=-1/0;do{if(A<=v.y&&A>=v.next.y&&v.next.y!==v.y){var I=v.x+(A-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(I<=w&&I>C){if(C=I,I===w){if(A===v.y)return v;if(A===v.next.y)return v.next}g=v.x<v.next.x?v:v.next}}v=v.next}while(v!==f);if(!g)return null;if(w===C)return g;var L,B=g,V=g.x,q=g.y,Q=1/0;v=g;do w>=v.x&&v.x>=V&&w!==v.x&&al(A<q?w:C,A,V,q,A<q?C:w,A,v.x,v.y)&&(L=Math.abs(A-v.y)/(w-v.x),bc(v,u)&&(L<Q||L===Q&&(v.x>g.x||v.x===g.x&&zx(g,v)))&&(g=v,Q=L)),v=v.next;while(v!==B);return g}(t,e);if(!r)return e;var n=Um(r,t),l=da(r,r.next);return da(n,n.next),e===r?l:e}function zx(t,e){return Hi(t.prev,t,e.prev)<0&&Hi(e.next,t,t.next)<0}function gf(t,e,r,n,l){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*l)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*l)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Px(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function al(t,e,r,n,l,u,f,g){return(l-f)*(e-g)-(t-f)*(u-g)>=0&&(t-f)*(n-g)-(r-f)*(e-g)>=0&&(r-f)*(u-g)-(l-f)*(n-g)>=0}function Dx(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(r,n){var l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==n.i&&l.next.i!==n.i&&Fm(l,l.next,r,n))return!0;l=l.next}while(l!==r);return!1}(t,e)&&(bc(t,e)&&bc(e,t)&&function(r,n){var l=r,u=!1,f=(r.x+n.x)/2,g=(r.y+n.y)/2;do l.y>g!=l.next.y>g&&l.next.y!==l.y&&f<(l.next.x-l.x)*(g-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next;while(l!==r);return u}(t,e)&&(Hi(t.prev,t,e.prev)||Hi(t,e.prev,e))||_h(t,e)&&Hi(t.prev,t,t.next)>0&&Hi(e.prev,e,e.next)>0)}function Hi(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function _h(t,e){return t.x===e.x&&t.y===e.y}function Fm(t,e,r,n){var l=yh(Hi(t,e,r)),u=yh(Hi(t,e,n)),f=yh(Hi(r,n,t)),g=yh(Hi(r,n,e));return l!==u&&f!==g||!(l!==0||!gh(t,r,e))||!(u!==0||!gh(t,n,e))||!(f!==0||!gh(r,t,n))||!(g!==0||!gh(r,e,n))}function gh(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function yh(t){return t>0?1:t<0?-1:0}function bc(t,e){return Hi(t.prev,t,t.next)<0?Hi(t,e,t.next)>=0&&Hi(t,t.prev,e)>=0:Hi(t,e,t.prev)<0||Hi(t,t.next,e)<0}function Um(t,e){var r=new yf(t.i,t.x,t.y),n=new yf(e.i,e.x,e.y),l=t.next,u=e.prev;return t.next=e,e.prev=t,r.next=l,l.prev=r,n.next=r,r.prev=n,u.next=n,n.prev=u,n}function Nm(t,e,r,n){var l=new yf(t,e,r);return n?(l.next=n.next,l.prev=n,n.next.prev=l,n.next=l):(l.prev=l,l.next=l),l}function wc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function yf(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function vf(t,e,r,n){for(var l=0,u=e,f=r-n;u<r;u+=n)l+=(t[f]-t[u])*(t[u+1]+t[f+1]),f=u;return l}function Lx(t,e,r,n,l){jm(t,e,r||0,n||t.length-1,l||Rx)}function jm(t,e,r,n,l){for(;n>r;){if(n-r>600){var u=n-r+1,f=e-r+1,g=Math.log(u),v=.5*Math.exp(2*g/3),w=.5*Math.sqrt(g*v*(u-v)/u)*(f-u/2<0?-1:1);jm(t,e,Math.max(r,Math.floor(e-f*v/u+w)),Math.min(n,Math.floor(e+(u-f)*v/u+w)),l)}var A=t[e],C=r,I=n;for(Tc(t,r,e),l(t[n],A)>0&&Tc(t,r,n);C<I;){for(Tc(t,C,I),C++,I--;l(t[C],A)<0;)C++;for(;l(t[I],A)>0;)I--}l(t[r],A)===0?Tc(t,r,I):Tc(t,++I,n),I<=e&&(r=I+1),e<=I&&(n=I-1)}}function Tc(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function Rx(t,e){return t<e?-1:t>e?1:0}function xf(t,e){const r=t.length;if(r<=1)return[t];const n=[];let l,u;for(let f=0;f<r;f++){const g=li(t[f]);g!==0&&(t[f].area=Math.abs(g),u===void 0&&(u=g<0),u===g<0?(l&&n.push(l),l=[t[f]]):l.push(t[f]))}if(l&&n.push(l),e>1)for(let f=0;f<n.length;f++)n[f].length<=e||(Lx(n[f],e,1,n[f].length-1,Bx),n[f]=n[f].slice(0,e));return n}function Bx(t,e){return e.area-t.area}function bf(t,e,r){const n=r.patternDependencies;let l=!1;for(const u of e){const f=u.paint.get(`${t}-pattern`);f.isConstant()||(l=!0);const g=f.constantOr(null);g&&(l=!0,n[g.to]=!0,n[g.from]=!0)}return l}function wf(t,e,r,n,l){const u=l.patternDependencies;for(const f of e){const g=f.paint.get(`${t}-pattern`).value;if(g.kind!=="constant"){let v=g.evaluate({zoom:n-1},r,{},l.availableImages),w=g.evaluate({zoom:n},r,{},l.availableImages),A=g.evaluate({zoom:n+1},r,{},l.availableImages);v=v&&v.name?v.name:v,w=w&&w.name?w.name:w,A=A&&A.name?A.name:A,u[v]=!0,u[w]=!0,u[A]=!0,r.patterns[f.id]={min:v,mid:w,max:A}}}return r}mh.deviation=function(t,e,r,n){var l=e&&e.length,u=Math.abs(vf(t,0,l?e[0]*r:t.length,r));if(l)for(var f=0,g=e.length;f<g;f++)u-=Math.abs(vf(t,e[f]*r,f<g-1?e[f+1]*r:t.length,r));var v=0;for(f=0;f<n.length;f+=3){var w=n[f]*r,A=n[f+1]*r,C=n[f+2]*r;v+=Math.abs((t[w]-t[C])*(t[A+1]-t[w+1])-(t[w]-t[A])*(t[C+1]-t[w+1]))}return u===0&&v===0?0:Math.abs((v-u)/u)},mh.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,l=0;l<t.length;l++){for(var u=0;u<t[l].length;u++)for(var f=0;f<e;f++)r.vertices.push(t[l][u][f]);l>0&&r.holes.push(n+=t[l-1].length)}return r},ph.default=Sx;class vh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Js,this.indexArray=new An,this.indexArray2=new ca,this.programConfigurations=new Qa(e.layers,e.zoom),this.segments=new Xi,this.segments2=new Xi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,l){this.hasPattern=bf("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:g,id:v,index:w,sourceLayerIndex:A}of e){const C=this.layers[0]._featureFilter.needGeometry,I=ts(g,C);if(!this.layers[0]._featureFilter.filter(new bt(this.zoom),I,n))continue;const L=u?u.evaluate(I,{},n,r.availableImages):void 0,B={id:v,properties:g.properties,type:g.type,sourceLayerIndex:A,index:w,geometry:C?I.geometry:No(g,n,l),patterns:{},sortKey:L};f.push(B)}u&&f.sort((g,v)=>g.sortKey-v.sortKey);for(const g of f){const{geometry:v,index:w,sourceLayerIndex:A}=g;if(this.hasPattern){const C=wf("fill",this.layers,g,this.zoom,r);this.patternFeatures.push(C)}else this.addFeature(g,v,w,n,{},r.availableImages);r.featureIndex.insert(e[w].feature,v,w,A,this.index)}}update(e,r,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,l)}addFeatures(e,r,n,l){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Tx),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,n,l,u,f=[]){for(const g of xf(r,500)){let v=0;for(const B of g)v+=B.length;const w=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),A=w.vertexLength,C=[],I=[];for(const B of g){if(B.length===0)continue;B!==g[0]&&I.push(C.length/2);const V=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),q=V.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(q+B.length-1,q),C.push(B[0].x),C.push(B[0].y);for(let Q=1;Q<B.length;Q++)this.layoutVertexArray.emplaceBack(B[Q].x,B[Q].y),this.indexArray2.emplaceBack(q+Q-1,q+Q),C.push(B[Q].x),C.push(B[Q].y);V.vertexLength+=B.length,V.primitiveLength+=B.length}const L=ph(C,I);for(let B=0;B<L.length;B+=3)this.indexArray.emplaceBack(A+L[B],A+L[B+1],A+L[B+2]);w.vertexLength+=v,w.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,f,l)}}it("FillBucket",vh,{omit:["layers","patternFeatures"]});const Ox=new hr({"fill-sort-key":new pt(Ee.layout_fill["fill-sort-key"])});var Fx={paint:new hr({"fill-antialias":new nt(Ee.paint_fill["fill-antialias"]),"fill-opacity":new pt(Ee.paint_fill["fill-opacity"]),"fill-color":new pt(Ee.paint_fill["fill-color"]),"fill-outline-color":new pt(Ee.paint_fill["fill-outline-color"]),"fill-translate":new nt(Ee.paint_fill["fill-translate"]),"fill-translate-anchor":new nt(Ee.paint_fill["fill-translate-anchor"]),"fill-pattern":new or(Ee.paint_fill["fill-pattern"])}),layout:Ox};const Ux=Oi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Nx=Oi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:jx}=Ux;var Vm=sl;function sl(t,e,r,n,l){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=l,t.readFields(Vx,this,e)}function Vx(t,e,r){t==1?e.id=r.readVarint():t==2?function(n,l){for(var u=n.readVarint()+n.pos;n.pos<u;){var f=l._keys[n.readVarint()],g=l._values[n.readVarint()];l.properties[f]=g}}(r,e):t==3?e.type=r.readVarint():t==4&&(e._geometry=r.pos)}function $x(t){for(var e,r,n=0,l=0,u=t.length,f=u-1;l<u;f=l++)n+=((r=t[f]).x-(e=t[l]).x)*(e.y+r.y);return n}sl.types=["Unknown","Point","LineString","Polygon"],sl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,l=0,u=0,f=0,g=[];t.pos<r;){if(l<=0){var v=t.readVarint();n=7&v,l=v>>3}if(l--,n===1||n===2)u+=t.readSVarint(),f+=t.readSVarint(),n===1&&(e&&g.push(e),e=[]),e.push(new $(u,f));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&g.push(e),g},sl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,l=0,u=0,f=1/0,g=-1/0,v=1/0,w=-1/0;t.pos<e;){if(n<=0){var A=t.readVarint();r=7&A,n=A>>3}if(n--,r===1||r===2)(l+=t.readSVarint())<f&&(f=l),l>g&&(g=l),(u+=t.readSVarint())<v&&(v=u),u>w&&(w=u);else if(r!==7)throw new Error("unknown command "+r)}return[f,v,g,w]},sl.prototype.toGeoJSON=function(t,e,r){var n,l,u=this.extent*Math.pow(2,r),f=this.extent*t,g=this.extent*e,v=this.loadGeometry(),w=sl.types[this.type];function A(L){for(var B=0;B<L.length;B++){var V=L[B];L[B]=[360*(V.x+f)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+g)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(n=0;n<v.length;n++)C[n]=v[n][0];A(v=C);break;case 2:for(n=0;n<v.length;n++)A(v[n]);break;case 3:for(v=function(L){var B=L.length;if(B<=1)return[L];for(var V,q,Q=[],oe=0;oe<B;oe++){var ce=$x(L[oe]);ce!==0&&(q===void 0&&(q=ce<0),q===ce<0?(V&&Q.push(V),V=[L[oe]]):V.push(L[oe]))}return V&&Q.push(V),Q}(v),n=0;n<v.length;n++)for(l=0;l<v[n].length;l++)A(v[n][l])}v.length===1?v=v[0]:w="Multi"+w;var I={type:"Feature",geometry:{type:w,coordinates:v},properties:this.properties};return"id"in this&&(I.id=this.id),I};var $m=Gm;function Gm(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Gx,this,e),this.length=this._features.length}function Gx(t,e,r){t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(function(n){for(var l=null,u=n.readVarint()+n.pos;n.pos<u;){var f=n.readVarint()>>3;l=f===1?n.readString():f===2?n.readFloat():f===3?n.readDouble():f===4?n.readVarint64():f===5?n.readVarint():f===6?n.readSVarint():f===7?n.readBoolean():null}return l}(r))}function Zx(t,e,r){if(t===3){var n=new $m(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}Gm.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Vm(this._pbf,e,this.extent,this._keys,this._values)};var is={VectorTile:function(t,e){this.layers=t.readFields(Zx,{},e)},VectorTileFeature:Vm,VectorTileLayer:$m};const qx=is.VectorTileFeature.types,Wx=Math.pow(2,13);function Sc(t,e,r,n,l,u,f,g){t.emplaceBack((e<<1)+f,(r<<1)+u,(Math.floor(n*Wx)<<1)+l,Math.round(g))}class Zm{constructor(){this.acc=new $(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new $(e.x,e.y),this.max=new $(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);let n=!!this.borders;const l=this.min,u=this.max;e.x<l.x?(l.x=e.x,n=!0):e.x>u.x&&(u.x=e.x,n=!0),e.y<l.y?(l.y=e.y,n=!0):e.y>u.y&&(u.y=e.y,n=!0),((e.x===0||e.x===Rt)&&e.x===r.x)!=((e.y===0||e.y===Rt)&&e.y===r.y)&&this.processBorderOverlap(e,r),n&&this.checkBorderIntersection(e,r)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,ni(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Rt!=e.x>Rt&&this.addBorderIntersection(1,ni(r.y,e.y,(Rt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,ni(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Rt!=e.y>Rt&&this.addBorderIntersection(3,ni(r.x,e.x,(Rt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];r<n[0]&&(n[0]=r),r>n[1]&&(n[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const n=e.x===0?0:1;this.addBorderIntersection(n,r.y),this.addBorderIntersection(n,e.y)}else{const n=e.y===0?2:3;this.addBorderIntersection(n,r.x),this.addBorderIntersection(n,e.x)}}centroid(){const e=this.polyCount.reduce((r,n)=>r+n.edges,0);return e!==0?this.acc.div(e)._round():new $(0,0)}span(){return new $(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class Tf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Qs,this.centroidVertexArray=new mm,this.indexArray=new An,this.programConfigurations=new Qa(e.layers,e.zoom),this.segments=new Xi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,n,l){this.features=[],this.hasPattern=bf("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(u){const f=Math.exp(Math.PI*(1-u.y/(1<<u.z)*2));return 80150034*f/(f*f+1)/Rt/(1<<u.z)}(n);for(const{feature:u,id:f,index:g,sourceLayerIndex:v}of e){const w=this.layers[0]._featureFilter.needGeometry,A=ts(u,w);if(!this.layers[0]._featureFilter.filter(new bt(this.zoom),A,n))continue;const C={id:f,sourceLayerIndex:v,index:g,geometry:w?A.geometry:No(u,n,l),properties:u.properties,type:u.type,patterns:{}},I=this.layoutVertexArray.length;this.hasPattern?this.features.push(wf("fill-extrusion",this.layers,C,this.zoom,r)):this.addFeature(C,C.geometry,g,n,{},r.availableImages),r.featureIndex.insert(u,C.geometry,g,v,this.index,I)}this.sortBorders()}addFeatures(e,r,n,l){for(const u of this.features){const{geometry:f}=u;this.addFeature(u,f,u.index,r,n,l)}this.sortBorders()}update(e,r,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jx),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Nx.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,n,l,u,f){const g=this.enableTerrain?new Zm:null;for(const w of xf(r,500)){let A=0,C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(w.length===0||(v=w[0]).every(q=>q.x<=0)||v.every(q=>q.x>=Rt)||v.every(q=>q.y<=0)||v.every(q=>q.y>=Rt))continue;for(let q=0;q<w.length;q++){const Q=w[q];if(Q.length===0)continue;A+=Q.length;let oe=0;g&&g.startRing(Q[0]);for(let ce=0;ce<Q.length;ce++){const de=Q[ce];if(ce>=1){const pe=Q[ce-1];if(!Xx(de,pe)){g&&g.append(de,pe),C.vertexLength+4>Xi.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const me=de.sub(pe)._perp(),ke=me.x/(Math.abs(me.x)+Math.abs(me.y)),Ce=me.y>0?1:0,He=pe.dist(de);oe+He>32768&&(oe=0),Sc(this.layoutVertexArray,de.x,de.y,ke,Ce,0,0,oe),Sc(this.layoutVertexArray,de.x,de.y,ke,Ce,0,1,oe),oe+=He,Sc(this.layoutVertexArray,pe.x,pe.y,ke,Ce,0,0,oe),Sc(this.layoutVertexArray,pe.x,pe.y,ke,Ce,0,1,oe);const Ge=C.vertexLength;this.indexArray.emplaceBack(Ge,Ge+2,Ge+1),this.indexArray.emplaceBack(Ge+1,Ge+2,Ge+3),C.vertexLength+=4,C.primitiveLength+=2}}}}if(C.vertexLength+A>Xi.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray)),qx[e.type]!=="Polygon")continue;const I=[],L=[],B=C.vertexLength;for(let q=0;q<w.length;q++){const Q=w[q];if(Q.length!==0){Q!==w[0]&&L.push(I.length/2);for(let oe=0;oe<Q.length;oe++){const ce=Q[oe];Sc(this.layoutVertexArray,ce.x,ce.y,0,0,1,1,0),I.push(ce.x),I.push(ce.y),g&&g.currentPolyCount.top++}}}const V=ph(I,L);for(let q=0;q<V.length;q+=3)this.indexArray.emplaceBack(B+V[q],B+V[q+2],B+V[q+1]);C.primitiveLength+=V.length/3,C.vertexLength+=A}var v;if(g&&g.polyCount.length>0){if(g.borders){g.vertexArrayOffset=this.centroidVertexArray.length;const w=g.borders,A=this.featuresOnBorder.push(g)-1;for(let C=0;C<4;C++)w[C][0]!==Number.MAX_VALUE&&this.borders[C].push(A)}this.encodeCentroid(g.borders?void 0:g.centroid(),g)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,f,l)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,n)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}encodeCentroid(e,r,n=!0){let l,u;if(e)if(e.y!==0){const g=r.span()._mult(this.tileToMeter);l=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(g.x/10)),u=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(g.y/10))}else l=Math.ceil(7*(e.x+450)),u=0;else l=0,u=+n;let f=n?this.centroidVertexArray.length:r.vertexArrayOffset;for(const g of r.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*g.edges+g.top);for(let v=0;v<2*g.edges;v++)this.centroidVertexArray.emplace(f++,0,u),this.centroidVertexArray.emplace(f++,l,u);for(let v=0;v<g.top;v++)this.centroidVertexArray.emplace(f++,l,u)}}}function Xx(t,e){return t.x===e.x&&(t.x<0||t.x>Rt)||t.y===e.y&&(t.y<0||t.y>Rt)}it("FillExtrusionBucket",Tf,{omit:["layers","features"]}),it("PartMetadata",Zm);var Hx={paint:new hr({"fill-extrusion-opacity":new nt(Ee["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pt(Ee["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new nt(Ee["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new nt(Ee["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new or(Ee["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new pt(Ee["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pt(Ee["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new nt(Ee["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Ec(t,e){return t.x*e.x+t.y*e.y}function qm(t,e){if(t.length===1){let r=0;const n=e[r++];let l;for(;!l||n.equals(l);)if(l=e[r++],!l)return 1/0;for(;r<e.length;r++){const u=e[r],f=t[0],g=l.sub(n),v=u.sub(n),w=f.sub(n),A=Ec(g,g),C=Ec(g,v),I=Ec(v,v),L=Ec(w,g),B=Ec(w,v),V=A*I-C*C,q=(I*L-C*B)/V,Q=(A*B-C*L)/V,oe=n.z*(1-q-Q)+l.z*q+u.z*Q;if(isFinite(oe))return oe}return 1/0}{let r=1/0;for(const n of e)r=Math.min(r,n.z);return r}}function Wm(t){const e=new $(t[0],t[1]);return e.z=t[2],e}function Kx(t,e,r,n,l,u,f,g){const v=f*l.getElevationAt(t,e,!0,!0),w=u[0]!==0,A=w?u[1]===0?f*(u[0]/7-450):f*function(C,I,L){const B=Math.floor(I[0]/8),V=Math.floor(I[1]/8),q=10*(I[0]-8*B),Q=10*(I[1]-8*V),oe=C.getElevationAt(B,V,!0,!0),ce=C.getMeterToDEM(L),de=Math.floor(.5*(q*ce-1)),pe=Math.floor(.5*(Q*ce-1)),me=C.tileCoordToPixel(B,V),ke=2*de+1,Ce=2*pe+1,He=function(tt,ot,jt,xi,Gt){return[tt.getElevationAtPixel(ot,jt,!0),tt.getElevationAtPixel(ot+Gt,jt,!0),tt.getElevationAtPixel(ot,jt+Gt,!0),tt.getElevationAtPixel(ot+xi,jt+Gt,!0)]}(C,me.x-de,me.y-pe,ke,Ce),Ge=Math.abs(He[0]-He[1]),Me=Math.abs(He[2]-He[3]),Ze=Math.abs(He[0]-He[2])+Math.abs(He[1]-He[3]),Ke=Math.min(.25,.5*ce*(Ge+Me)/ke),De=Math.min(.25,.5*ce*Ze/Ce);return oe+Math.max(Ke*q,De*Q)}(l,u,g):v;return{base:v+(r===0)?-1:r,top:w?Math.max(A+n,v+r+2):v+n}}const Yx=Oi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Jx}=Yx,Qx=Oi([{name:"a_packed",components:3,type:"Float32"}]),{members:e0}=Qx,t0=is.VectorTileFeature.types,i0=Math.cos(Math.PI/180*37.5);class xh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Wd,this.layoutVertexArray2=new el,this.indexArray=new An,this.programConfigurations=new Qa(e.layers,e.zoom),this.segments=new Xi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,l){this.hasPattern=bf("line",this.layers,r);const u=this.layers[0].layout.get("line-sort-key"),f=[];for(const{feature:A,id:C,index:I,sourceLayerIndex:L}of e){const B=this.layers[0]._featureFilter.needGeometry,V=ts(A,B);if(!this.layers[0]._featureFilter.filter(new bt(this.zoom),V,n))continue;const q=u?u.evaluate(V,{},n):void 0,Q={id:C,properties:A.properties,type:A.type,sourceLayerIndex:L,index:I,geometry:B?V.geometry:No(A,n,l),patterns:{},sortKey:q};f.push(Q)}u&&f.sort((A,C)=>A.sortKey-C.sortKey);const{lineAtlas:g,featureIndex:v}=r,w=this.addConstantDashes(g);for(const A of f){const{geometry:C,index:I,sourceLayerIndex:L}=A;if(w&&this.addFeatureDashes(A,g),this.hasPattern){const B=wf("line",this.layers,A,this.zoom,r);this.patternFeatures.push(B)}else this.addFeature(A,C,I,n,g.positions,r.availableImages);v.insert(e[I].feature,C,I,L,this.index)}}addConstantDashes(e){let r=!1;for(const n of this.layers){const l=n.paint.get("line-dasharray").value,u=n.layout.get("line-cap").value;if(l.kind!=="constant"||u.kind!=="constant")r=!0;else{const f=u.value,g=l.value;if(!g)continue;e.addDash(g.from,f),e.addDash(g.to,f),g.other&&e.addDash(g.other,f)}}return r}addFeatureDashes(e,r){const n=this.zoom;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(u.kind==="constant"&&f.kind==="constant")continue;let g,v,w,A,C,I;if(u.kind==="constant"){const q=u.value;if(!q)continue;g=q.other||q.to,v=q.to,w=q.from}else g=u.evaluate({zoom:n-1},e),v=u.evaluate({zoom:n},e),w=u.evaluate({zoom:n+1},e);f.kind==="constant"?A=C=I=f.value:(A=f.evaluate({zoom:n-1},e),C=f.evaluate({zoom:n},e),I=f.evaluate({zoom:n+1},e)),r.addDash(g,A),r.addDash(v,C),r.addDash(w,I);const L=r.getKey(g,A),B=r.getKey(v,C),V=r.getKey(w,I);e.patterns[l.id]={min:L,mid:B,max:V}}}update(e,r,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,l)}addFeatures(e,r,n,l){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,n,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,e0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jx),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,n,l,u,f){const g=this.layers[0].layout,v=g.get("line-join").evaluate(e,{}),w=g.get("line-cap").evaluate(e,{}),A=g.get("line-miter-limit"),C=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const I of r)this.addLine(I,e,v,w,A,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,u,f,l)}addLine(e,r,n,l,u,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<e.length-1;Q++)this.totalDistance+=e[Q].dist(e[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g=t0[r.type]==="Polygon";let v=e.length;for(;v>=2&&e[v-1].equals(e[v-2]);)v--;let w=0;for(;w<v-1&&e[w].equals(e[w+1]);)w++;if(v<(g?3:2))return;n==="bevel"&&(u=1.05);const A=this.overscaling<=16?122880/(512*this.overscaling):0,C=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let I,L,B,V,q;this.e1=this.e2=-1,g&&(I=e[v-2],q=e[w].sub(I)._unit()._perp());for(let Q=w;Q<v;Q++){if(B=Q===v-1?g?e[w+1]:void 0:e[Q+1],B&&e[Q].equals(B))continue;q&&(V=q),I&&(L=I),I=e[Q],q=B?B.sub(I)._unit()._perp():V,V=V||q;let oe=V.add(q);oe.x===0&&oe.y===0||oe._unit();const ce=V.x*q.x+V.y*q.y,de=oe.x*q.x+oe.y*q.y,pe=de!==0?1/de:1/0,me=2*Math.sqrt(2-2*de),ke=de<i0&&L&&B,Ce=V.x*q.y-V.y*q.x>0;if(ke&&Q>w){const Me=I.dist(L);if(Me>2*A){const Ze=I.sub(I.sub(L)._mult(A/Me)._round());this.updateDistance(L,Ze),this.addCurrentVertex(Ze,V,0,0,C),L=Ze}}const He=L&&B;let Ge=He?n:g?"butt":l;if(He&&Ge==="round"&&(pe<f?Ge="miter":pe<=2&&(Ge="fakeround")),Ge==="miter"&&pe>u&&(Ge="bevel"),Ge==="bevel"&&(pe>2&&(Ge="flipbevel"),pe<u&&(Ge="miter")),L&&this.updateDistance(L,I),Ge==="miter")oe._mult(pe),this.addCurrentVertex(I,oe,0,0,C);else if(Ge==="flipbevel"){if(pe>100)oe=q.mult(-1);else{const Me=pe*V.add(q).mag()/V.sub(q).mag();oe._perp()._mult(Me*(Ce?-1:1))}this.addCurrentVertex(I,oe,0,0,C),this.addCurrentVertex(I,oe.mult(-1),0,0,C)}else if(Ge==="bevel"||Ge==="fakeround"){const Me=-Math.sqrt(pe*pe-1),Ze=Ce?Me:0,Ke=Ce?0:Me;if(L&&this.addCurrentVertex(I,V,Ze,Ke,C),Ge==="fakeround"){const De=Math.round(180*me/Math.PI/20);for(let tt=1;tt<De;tt++){let ot=tt/De;if(ot!==.5){const xi=ot-.5;ot+=ot*xi*(ot-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*xi*xi+(.848013+ce*(.215638*ce-1.06021)))}const jt=q.sub(V)._mult(ot)._add(V)._unit()._mult(Ce?-1:1);this.addHalfVertex(I,jt.x,jt.y,!1,Ce,0,C)}}B&&this.addCurrentVertex(I,q,-Ze,-Ke,C)}else if(Ge==="butt")this.addCurrentVertex(I,oe,0,0,C);else if(Ge==="square"){const Me=L?1:-1;L||this.addCurrentVertex(I,oe,Me,Me,C),this.addCurrentVertex(I,oe,0,0,C),L&&this.addCurrentVertex(I,oe,Me,Me,C)}else Ge==="round"&&(L&&(this.addCurrentVertex(I,V,0,0,C),this.addCurrentVertex(I,V,1,1,C,!0)),B&&(this.addCurrentVertex(I,q,-1,-1,C,!0),this.addCurrentVertex(I,q,0,0,C)));if(ke&&Q<v-1){const Me=I.dist(B);if(Me>2*A){const Ze=I.add(B.sub(I)._mult(A/Me)._round());this.updateDistance(I,Ze),this.addCurrentVertex(Ze,q,0,0,C),I=Ze}}}}addCurrentVertex(e,r,n,l,u,f=!1){const g=r.y*l-r.x,v=-r.y-r.x*l;this.addHalfVertex(e,r.x+r.y*n,r.y-r.x*n,f,!1,n,u),this.addHalfVertex(e,g,v,f,!0,-l,u)}addHalfVertex({x:e,y:r},n,l,u,f,g,v){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(r<<1)+(f?1:0),Math.round(63*n)+128,Math.round(63*l)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const w=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),v.primitiveLength++),f?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}it("LineBucket",xh,{omit:["layers","patternFeatures"]});const r0=new hr({"line-cap":new pt(Ee.layout_line["line-cap"]),"line-join":new pt(Ee.layout_line["line-join"]),"line-miter-limit":new nt(Ee.layout_line["line-miter-limit"]),"line-round-limit":new nt(Ee.layout_line["line-round-limit"]),"line-sort-key":new pt(Ee.layout_line["line-sort-key"])});var Xm={paint:new hr({"line-opacity":new pt(Ee.paint_line["line-opacity"]),"line-color":new pt(Ee.paint_line["line-color"]),"line-translate":new nt(Ee.paint_line["line-translate"]),"line-translate-anchor":new nt(Ee.paint_line["line-translate-anchor"]),"line-width":new pt(Ee.paint_line["line-width"]),"line-gap-width":new pt(Ee.paint_line["line-gap-width"]),"line-offset":new pt(Ee.paint_line["line-offset"]),"line-blur":new pt(Ee.paint_line["line-blur"]),"line-dasharray":new or(Ee.paint_line["line-dasharray"]),"line-pattern":new or(Ee.paint_line["line-pattern"]),"line-gradient":new yo(Ee.paint_line["line-gradient"])}),layout:r0};const Hm=new class extends pt{possiblyEvaluate(t,e){return e=new bt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,r,n){return e=Wt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,r,n)}}(Xm.paint.properties["line-width"].specification);function Km(t,e){return e>0?e+2*t:t}Hm.useIntegerZoom=!0;const n0=Oi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),o0=Oi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Oi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const a0=Oi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),s0=Oi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Oi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ym=Oi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),l0=Oi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Oi([{name:"triangle",components:3,type:"Uint16"}]),Oi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Oi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Oi([{type:"Float32",name:"offsetX"}]),Oi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var gr=24;const xo=128;function Sf(t,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new bt(t+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:l}=r;let u=0;for(;u<n.length&&n[u]<=t;)u++;u=Math.max(0,u-1);let f=u;for(;f<n.length&&n[f]<t+1;)f++;f=Math.min(n.length-1,f);const g=n[u],v=n[f];return r.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:v,interpolationType:l}:{kind:"camera",minZoom:g,maxZoom:v,minSize:r.evaluate(new bt(g)),maxSize:r.evaluate(new bt(v)),interpolationType:l}}}function bh(t,{uSize:e,uSizeT:r},{lowerSize:n,upperSize:l}){return t.kind==="source"?n/xo:t.kind==="composite"?ni(n/xo,l/xo,r):e}function ll(t,e){let r=0,n=0;if(t.kind==="constant")n=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:l,minZoom:u,maxZoom:f}=t,g=l?Vt(Mr.interpolationFactor(l,e,u,f),0,1):0;t.kind==="camera"?n=ni(t.minSize,t.maxSize,g):r=g}return{uSizeT:r,uSize:n}}var c0=Object.freeze({__proto__:null,getSizeData:Sf,evaluateSizeForFeature:bh,evaluateSizeForZoom:ll,SIZE_PACK_FACTOR:xo});function u0(t,e,r){return t.sections.forEach(n=>{n.text=function(l,u,f){const g=u.layout.get("text-transform").evaluate(f,{});return g==="uppercase"?l=l.toLocaleUpperCase():g==="lowercase"&&(l=l.toLocaleLowerCase()),$t.applyArabicShaping&&(l=$t.applyArabicShaping(l)),l}(n.text,e,r)}),t}const Ac={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function h0(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function d0(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}var Jm=function(t,e,r,n,l){var u,f,g=8*l-n-1,v=(1<<g)-1,w=v>>1,A=-7,C=r?l-1:0,I=r?-1:1,L=t[e+C];for(C+=I,u=L&(1<<-A)-1,L>>=-A,A+=g;A>0;u=256*u+t[e+C],C+=I,A-=8);for(f=u&(1<<-A)-1,u>>=-A,A+=n;A>0;f=256*f+t[e+C],C+=I,A-=8);if(u===0)u=1-w;else{if(u===v)return f?NaN:1/0*(L?-1:1);f+=Math.pow(2,n),u-=w}return(L?-1:1)*f*Math.pow(2,u-n)},Qm=function(t,e,r,n,l,u){var f,g,v,w=8*u-l-1,A=(1<<w)-1,C=A>>1,I=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=n?0:u-1,B=n?1:-1,V=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,f=A):(f=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-f))<1&&(f--,v*=2),(e+=f+C>=1?I/v:I*Math.pow(2,1-C))*v>=2&&(f++,v/=2),f+C>=A?(g=0,f=A):f+C>=1?(g=(e*v-1)*Math.pow(2,l),f+=C):(g=e*Math.pow(2,C-1)*Math.pow(2,l),f=0));l>=8;t[r+L]=255&g,L+=B,g/=256,l-=8);for(f=f<<l|g,w+=l;w>0;t[r+L]=255&f,L+=B,f/=256,w-=8);t[r+L-B]|=128*V},Cc=vi;function vi(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}vi.Varint=0,vi.Fixed64=1,vi.Bytes=2,vi.Fixed32=5;var Ef=4294967296,e_=1/Ef,t_=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function jo(t){return t.type===vi.Bytes?t.readVarint()+t.pos:t.pos+1}function cl(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function i_(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var l=r.pos-1;l>=t;l--)r.buf[l+n]=r.buf[l]}function f0(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function p0(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function m0(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function _0(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function g0(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function y0(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function v0(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function x0(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function b0(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function wh(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function ul(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function r_(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function w0(t,e,r){e.glyphs=[],t===1&&r.readMessage(T0,e)}function T0(t,e,r){if(t===3){const{id:n,bitmap:l,width:u,height:f,left:g,top:v,advance:w}=r.readMessage(S0,{});e.glyphs.push({id:n,bitmap:new ha({width:u+6,height:f+6},l),metrics:{width:u,height:f,left:g,top:v,advance:w}})}else t===4?e.ascender=r.readSVarint():t===5&&(e.descender=r.readSVarint())}function S0(t,e,r){t===1?e.id=r.readVarint():t===2?e.bitmap=r.readBytes():t===3?e.width=r.readVarint():t===4?e.height=r.readVarint():t===5?e.left=r.readSVarint():t===6?e.top=r.readSVarint():t===7&&(e.advance=r.readVarint())}function Af(t){let e=0,r=0;for(const f of t)e+=f.w*f.h,r=Math.max(r,f.w);t.sort((f,g)=>g.h-f.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let l=0,u=0;for(const f of t)for(let g=n.length-1;g>=0;g--){const v=n[g];if(!(f.w>v.w||f.h>v.h)){if(f.x=v.x,f.y=v.y,u=Math.max(u,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===v.w&&f.h===v.h){const w=n.pop();g<n.length&&(n[g]=w)}else f.h===v.h?(v.x+=f.w,v.w-=f.w):f.w===v.w?(v.y+=f.h,v.h-=f.h):(n.push({x:v.x+f.w,y:v.y,w:v.w-f.w,h:f.h}),v.y+=f.h,v.h-=f.h);break}}return{w:l,h:u,fill:e/(l*u)||0}}vi.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),l=n>>3,u=this.pos;this.type=7&n,t(l,e,this),this.pos===u&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=wh(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=r_(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=wh(this.buf,this.pos)+wh(this.buf,this.pos+4)*Ef;return this.pos+=8,t},readSFixed64:function(){var t=wh(this.buf,this.pos)+r_(this.buf,this.pos+4)*Ef;return this.pos+=8,t},readFloat:function(){var t=Jm(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Jm(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(l,u,f){var g,v,w=f.buf;if(g=(112&(v=w[f.pos++]))>>4,v<128||(g|=(127&(v=w[f.pos++]))<<3,v<128)||(g|=(127&(v=w[f.pos++]))<<10,v<128)||(g|=(127&(v=w[f.pos++]))<<17,v<128)||(g|=(127&(v=w[f.pos++]))<<24,v<128)||(g|=(1&(v=w[f.pos++]))<<31,v<128))return cl(l,g,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&t_?function(r,n,l){return t_.decode(r.subarray(n,l))}(this.buf,e,t):function(r,n,l){for(var u="",f=n;f<l;){var g,v,w,A=r[f],C=null,I=A>239?4:A>223?3:A>191?2:1;if(f+I>l)break;I===1?A<128&&(C=A):I===2?(192&(g=r[f+1]))==128&&(C=(31&A)<<6|63&g)<=127&&(C=null):I===3?(v=r[f+2],(192&(g=r[f+1]))==128&&(192&v)==128&&((C=(15&A)<<12|(63&g)<<6|63&v)<=2047||C>=55296&&C<=57343)&&(C=null)):I===4&&(v=r[f+2],w=r[f+3],(192&(g=r[f+1]))==128&&(192&v)==128&&(192&w)==128&&((C=(15&A)<<18|(63&g)<<12|(63&v)<<6|63&w)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,I=1):C>65535&&(C-=65536,u+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),u+=String.fromCharCode(C),f+=I}return u}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==vi.Bytes)return t.push(this.readVarint(e));var r=jo(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==vi.Bytes)return t.push(this.readSVarint());var e=jo(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==vi.Bytes)return t.push(this.readBoolean());var e=jo(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==vi.Bytes)return t.push(this.readFloat());var e=jo(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==vi.Bytes)return t.push(this.readDouble());var e=jo(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==vi.Bytes)return t.push(this.readFixed32());var e=jo(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==vi.Bytes)return t.push(this.readSFixed32());var e=jo(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==vi.Bytes)return t.push(this.readFixed64());var e=jo(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==vi.Bytes)return t.push(this.readSFixed64());var e=jo(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===vi.Varint)for(;this.buf[this.pos++]>127;);else if(e===vi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===vi.Fixed32)this.pos+=4;else{if(e!==vi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),ul(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),ul(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),ul(this.buf,-1&t,this.pos),ul(this.buf,Math.floor(t*e_),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),ul(this.buf,-1&t,this.pos),ul(this.buf,Math.floor(t*e_),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,r){var n,l;if(e>=0?(n=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(u,f,g){g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,g.buf[g.pos]=127&(u>>>=7)}(n,0,r),function(u,f){var g=(7&u)<<4;f.buf[f.pos++]|=g|((u>>>=3)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u|((u>>>=7)?128:0),u&&(f.buf[f.pos++]=127&u)))))}(l,r)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(n,l,u){for(var f,g,v=0;v<l.length;v++){if((f=l.charCodeAt(v))>55295&&f<57344){if(!g){f>56319||v+1===l.length?(n[u++]=239,n[u++]=191,n[u++]=189):g=f;continue}if(f<56320){n[u++]=239,n[u++]=191,n[u++]=189,g=f;continue}f=g-55296<<10|f-56320|65536,g=null}else g&&(n[u++]=239,n[u++]=191,n[u++]=189,g=null);f<128?n[u++]=f:(f<2048?n[u++]=f>>6|192:(f<65536?n[u++]=f>>12|224:(n[u++]=f>>18|240,n[u++]=f>>12&63|128),n[u++]=f>>6&63|128),n[u++]=63&f|128)}return u}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&i_(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Qm(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Qm(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&i_(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,vi.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,f0,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,p0,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,g0,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,m0,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,_0,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,y0,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,v0,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,x0,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,b0,e)},writeBytesField:function(t,e){this.writeTag(t,vi.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,vi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,vi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,vi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,vi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,vi.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,vi.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,vi.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,vi.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,vi.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Cf{constructor(e,{pixelRatio:r,version:n,stretchX:l,stretchY:u,content:f}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=l,this.stretchY=u,this.content=f,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class n_{constructor(e,r){const n={},l={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,n,u),this.addImages(r,l,u);const{w:f,h:g}=Af(u),v=new Cn({width:f||1,height:g||1});for(const w in e){const A=e[w],C=n[w].paddedRect;Cn.copy(A.data,v,{x:0,y:0},{x:C.x+1,y:C.y+1},A.data)}for(const w in r){const A=r[w],C=l[w].paddedRect,I=C.x+1,L=C.y+1,B=A.data.width,V=A.data.height;Cn.copy(A.data,v,{x:0,y:0},{x:I,y:L},A.data),Cn.copy(A.data,v,{x:0,y:V-1},{x:I,y:L-1},{width:B,height:1}),Cn.copy(A.data,v,{x:0,y:0},{x:I,y:L+V},{width:B,height:1}),Cn.copy(A.data,v,{x:B-1,y:0},{x:I-1,y:L},{width:1,height:V}),Cn.copy(A.data,v,{x:0,y:0},{x:I+B,y:L},{width:1,height:V})}this.image=v,this.iconPositions=n,this.patternPositions=l}addImages(e,r,n){for(const l in e){const u=e[l],f={x:0,y:0,w:u.data.width+2,h:u.data.height+2};n.push(f),r[l]=new Cf(f,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),r),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),r)}patchUpdatedImage(e,r,n){if(!e||!r||e.version===r.version)return;e.version=r.version;const[l,u]=e.tl;n.update(r.data,void 0,{x:l,y:u})}}it("ImagePosition",Cf),it("ImageAtlas",n_);const In={horizontal:1,vertical:2,horizontalOnly:3};class Ic{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const n=new Ic;return n.scale=e||1,n.fontStack=r,n}static forImage(e){const r=new Ic;return r.imageName=e,r}}class hl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const n=new hl;for(let l=0;l<e.sections.length;l++){const u=e.sections[l];u.image?n.addImageSection(u):n.addTextSection(u,r)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,n){let l="";for(let u=0;u<r.length;u++){const f=r.charCodeAt(u+1)||null,g=r.charCodeAt(u-1)||null;l+=!n&&(f&&ct(f)&&!Ac[r[u+1]]||g&&ct(g)&&!Ac[r[u-1]])||!Ac[r[u]]?r[u]:Ac[r[u]]}return l}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&Th[this.text.charCodeAt(n)];n++)e++;let r=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&Th[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const n=new hl;return n.text=this.text.substring(e,r),n.sectionIndex=this.sectionIndex.slice(e,r),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Ic.forText(e.scale,e.fontStack||r));const n=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(n)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Je("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Ic.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Je("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function If(t,e,r,n,l,u,f,g,v,w,A,C,I,L,B,V){const q=hl.fromFeature(t,l);let Q;C===In.vertical&&q.verticalizePunctuation(I);const{processBidirectionalText:oe,processStyledBidirectionalText:ce}=$t;if(oe&&q.sections.length===1){Q=[];const me=oe(q.toString(),Mf(q,w,u,e,n,L,B));for(const ke of me){const Ce=new hl;Ce.text=ke,Ce.sections=q.sections;for(let He=0;He<ke.length;He++)Ce.sectionIndex.push(0);Q.push(Ce)}}else if(ce){Q=[];const me=ce(q.text,q.sectionIndex,Mf(q,w,u,e,n,L,B));for(const ke of me){const Ce=new hl;Ce.text=ke[0],Ce.sectionIndex=ke[1],Ce.sections=q.sections,Q.push(Ce)}}else Q=function(me,ke){const Ce=[],He=me.text;let Ge=0;for(const Me of ke)Ce.push(me.substring(Ge,Me)),Ge=Me;return Ge<He.length&&Ce.push(me.substring(Ge,He.length)),Ce}(q,Mf(q,w,u,e,n,L,B));const de=[],pe={positionedLines:de,text:q.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(me,ke,Ce,He,Ge,Me,Ze,Ke,De,tt,ot,jt){let xi=0,Gt=0,Zt=0;const $e=Ke==="right"?1:Ke==="left"?0:.5;let Jt=!1;for(const Qt of Ge){const Ut=Qt.getSections();for(const Pi of Ut){if(Pi.imageName)continue;const Yi=ke[Pi.fontStack];if(Yi&&(Jt=Yi.ascender!==void 0&&Yi.descender!==void 0,!Jt))break}if(!Jt)break}let Ht=0;for(const Qt of Ge){Qt.trim();const Ut=Qt.getMaxScale(),Pi=(Ut-1)*gr,Yi={positionedGlyphs:[],lineOffset:0};me.positionedLines[Ht]=Yi;const Gi=Yi.positionedGlyphs;let Qi=0;if(!Qt.length()){Gt+=Me,++Ht;continue}let yr=0,Zr=0;for(let Ii=0;Ii<Qt.length();Ii++){const sr=Qt.getSection(Ii),Un=Qt.getSectionIndex(Ii),dr=Qt.getCharCode(Ii);let _i=sr.scale,lr=null,Di=null,Tr=null,ir=gr,Sr=0;const Pr=!(De===In.horizontal||!ot&&!ze(dr)||ot&&(Th[dr]||(Ki=dr,i(Ki)||a(Ki)||d(Ki)||se(Ki)||Ne(Ki))));if(sr.imageName){const Dr=He[sr.imageName];if(!Dr)continue;Tr=sr.imageName,me.iconsInText=me.iconsInText||!0,Di=Dr.paddedRect;const cr=Dr.displaySize;_i=_i*gr/jt,lr={width:cr[0],height:cr[1],left:1,top:-3,advance:Pr?cr[1]:cr[0],localGlyph:!1},Sr=Jt?-lr.height*_i:Ut*gr-17-cr[1]*_i,ir=lr.advance;const Kn=(Pr?cr[0]:cr[1])*_i-gr*Ut;Kn>0&&Kn>Qi&&(Qi=Kn)}else{const Dr=Ce[sr.fontStack];if(!Dr)continue;Dr[dr]&&(Di=Dr[dr]);const cr=ke[sr.fontStack];if(!cr)continue;const Kn=cr.glyphs[dr];if(!Kn)continue;if(lr=Kn.metrics,ir=dr!==8203?gr:0,Jt){const gl=cr.ascender!==void 0?Math.abs(cr.ascender):0,Rc=cr.descender!==void 0?Math.abs(cr.descender):0,Bc=(gl+Rc)*_i;yr<Bc&&(yr=Bc,Zr=(gl-Rc)/2*_i),Sr=-gl*_i}else Sr=(Ut-_i)*gr-17}Pr?(me.verticalizable=!0,Gi.push({glyph:dr,imageName:Tr,x:xi,y:Gt+Sr,vertical:Pr,scale:_i,localGlyph:lr.localGlyph,fontStack:sr.fontStack,sectionIndex:Un,metrics:lr,rect:Di}),xi+=ir*_i+tt):(Gi.push({glyph:dr,imageName:Tr,x:xi,y:Gt+Sr,vertical:Pr,scale:_i,localGlyph:lr.localGlyph,fontStack:sr.fontStack,sectionIndex:Un,metrics:lr,rect:Di}),xi+=lr.advance*_i+tt)}Gi.length!==0&&(Zt=Math.max(xi-tt,Zt),Jt?c_(Gi,$e,Qi,Zr,Me*Ut/2):c_(Gi,$e,Qi,0,Me/2)),xi=0;const qr=Me*Ut+Qi;Yi.lineOffset=Math.max(Qi,Pi),Gt+=qr,++Ht}var Ki;const Ui=Gt,{horizontalAlign:ar,verticalAlign:wr}=kf(Ze);(function(Qt,Ut,Pi,Yi,Gi,Qi){const yr=(Ut-Pi)*Gi,Zr=-Qi*Yi;for(const qr of Qt)for(const Ii of qr.positionedGlyphs)Ii.x+=yr,Ii.y+=Zr})(me.positionedLines,$e,ar,wr,Zt,Ui),me.top+=-wr*Ui,me.bottom=me.top+Ui,me.left+=-ar*Zt,me.right=me.left+Zt,me.hasBaseline=Jt}(pe,e,r,n,Q,f,g,v,C,w,I,V),!function(me){for(const ke of me)if(ke.positionedGlyphs.length!==0)return!1;return!0}(de)&&pe}const Th={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},E0={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function o_(t,e,r,n,l,u){if(e.imageName){const f=n[e.imageName];return f?f.displaySize[0]*e.scale*gr/u+l:0}{const f=r[e.fontStack],g=f&&f.glyphs[t];return g?g.metrics.advance*e.scale+l:0}}function a_(t,e,r,n){const l=Math.pow(t-e,2);return n?t<e?l/2:2*l:l+Math.abs(r)*r}function A0(t,e,r){let n=0;return t===10&&(n-=1e4),r&&(n+=150),t!==40&&t!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function s_(t,e,r,n,l,u){let f=null,g=a_(e,r,l,u);for(const v of n){const w=a_(e-v.x,r,l,u)+v.badness;w<=g&&(f=v,g=w)}return{index:t,x:e,priorBreak:f,badness:g}}function l_(t){return t?l_(t.priorBreak).concat(t.index):[]}function Mf(t,e,r,n,l,u,f){if(u!=="point")return[];if(!t)return[];const g=[],v=function(I,L,B,V,q,Q){let oe=0;for(let ce=0;ce<I.length();ce++){const de=I.getSection(ce);oe+=o_(I.getCharCode(ce),de,V,q,L,Q)}return oe/Math.max(1,Math.ceil(oe/B))}(t,e,r,n,l,f),w=t.text.indexOf("\u200B")>=0;let A=0;for(let I=0;I<t.length();I++){const L=t.getSection(I),B=t.getCharCode(I);if(Th[B]||(A+=o_(B,L,n,l,e,f)),I<t.length()-1){const V=!((C=B)<11904||!(R(C)||P(C)||be(C)||ie(C)||K(C)||m(C)||N(C)||E(C)||ae(C)||W(C)||Z(C)||Fe(C)||M(C)||b(C)||y(C)||H(C)||k(C)||ge(C)||ne(C)||re(C)));(E0[B]||V||L.imageName)&&g.push(s_(I+1,A,v,g,A0(B,t.getCharCode(I+1),V&&w),!1))}}var C;return l_(s_(t.length(),A,v,g,0,!0))}function kf(t){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function c_(t,e,r,n,l){if(!(e||r||n||l))return;const u=t.length-1,f=t[u],g=(f.x+f.metrics.advance*f.scale)*e;for(let v=0;v<=u;v++)t[v].x-=g,t[v].y+=r+n+l}function C0(t,e,r){const{horizontalAlign:n,verticalAlign:l}=kf(r),u=e[0]-t.displaySize[0]*n,f=e[1]-t.displaySize[1]*l;return{image:t,top:f,bottom:f+t.displaySize[1],left:u,right:u+t.displaySize[0]}}function u_(t,e,r,n,l,u){const f=t.image;let g;if(f.content){const q=f.content,Q=f.pixelRatio||1;g=[q[0]/Q,q[1]/Q,f.displaySize[0]-q[2]/Q,f.displaySize[1]-q[3]/Q]}const v=e.left*u,w=e.right*u;let A,C,I,L;r==="width"||r==="both"?(L=l[0]+v-n[3],C=l[0]+w+n[1]):(L=l[0]+(v+w-f.displaySize[0])/2,C=L+f.displaySize[0]);const B=e.top*u,V=e.bottom*u;return r==="height"||r==="both"?(A=l[1]+B-n[0],I=l[1]+V+n[2]):(A=l[1]+(B+V-f.displaySize[1])/2,I=A+f.displaySize[1]),{image:f,top:A,right:C,bottom:I,left:L,collisionPadding:g}}class Vo extends ${constructor(e,r,n,l,u){super(e,r),this.angle=l,this.z=n,u!==void 0&&(this.segment=u)}clone(){return new Vo(this.x,this.y,this.z,this.angle,this.segment)}}function h_(t,e,r,n,l){if(e.segment===void 0)return!0;let u=e,f=e.segment+1,g=0;for(;g>-r/2;){if(f--,f<0)return!1;g-=t[f].dist(u),u=t[f]}g+=t[f].dist(t[f+1]),f++;const v=[];let w=0;for(;g<r/2;){const A=t[f],C=t[f+1];if(!C)return!1;let I=t[f-1].angleTo(A)-A.angleTo(C);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:g,angleDelta:I}),w+=I;g-v[0].distance>n;)w-=v.shift().angleDelta;if(w>l)return!1;f++,g+=A.dist(C)}return!0}function d_(t){let e=0;for(let r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function f_(t,e,r){return t?.6*e*r:0}function p_(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function I0(t,e,r,n,l,u){const f=f_(r,l,u),g=p_(r,n)*u;let v=0;const w=d_(t)/2;for(let A=0;A<t.length-1;A++){const C=t[A],I=t[A+1],L=C.dist(I);if(v+L>w){const B=(w-v)/L,V=ni(C.x,I.x,B),q=ni(C.y,I.y,B),Q=new Vo(V,q,0,I.angleTo(C),A);return!f||h_(t,Q,g,f,e)?Q:void 0}v+=L}}function M0(t,e,r,n,l,u,f,g,v){const w=f_(n,u,f),A=p_(n,l),C=A*f,I=t[0].x===0||t[0].x===v||t[0].y===0||t[0].y===v;return e-C<e/4&&(e=C+e/4),m_(t,I?e/2*g%e:(A/2+2*u)*f*g%e,e,w,r,C,I,!1,v)}function m_(t,e,r,n,l,u,f,g,v){const w=u/2,A=d_(t);let C=0,I=e-r,L=[];for(let B=0;B<t.length-1;B++){const V=t[B],q=t[B+1],Q=V.dist(q),oe=q.angleTo(V);for(;I+r<C+Q;){I+=r;const ce=(I-C)/Q,de=ni(V.x,q.x,ce),pe=ni(V.y,q.y,ce);if(de>=0&&de<v&&pe>=0&&pe<v&&I-w>=0&&I+w<=A){const me=new Vo(de,pe,0,oe,B);me._round(),n&&!h_(t,me,u,n,l)||L.push(me)}}C+=Q}return g||L.length||f||(L=m_(t,C/2,r,n,l,u,f,!0,v)),L}function __(t,e,r,n,l){const u=[];for(let f=0;f<t.length;f++){const g=t[f];let v;for(let w=0;w<g.length-1;w++){let A=g[w],C=g[w+1];A.x<e&&C.x<e||(A.x<e?A=new $(e,A.y+(e-A.x)/(C.x-A.x)*(C.y-A.y))._round():C.x<e&&(C=new $(e,A.y+(e-A.x)/(C.x-A.x)*(C.y-A.y))._round()),A.y<r&&C.y<r||(A.y<r?A=new $(A.x+(r-A.y)/(C.y-A.y)*(C.x-A.x),r)._round():C.y<r&&(C=new $(A.x+(r-A.y)/(C.y-A.y)*(C.x-A.x),r)._round()),A.x>=n&&C.x>=n||(A.x>=n?A=new $(n,A.y+(n-A.x)/(C.x-A.x)*(C.y-A.y))._round():C.x>=n&&(C=new $(n,A.y+(n-A.x)/(C.x-A.x)*(C.y-A.y))._round()),A.y>=l&&C.y>=l||(A.y>=l?A=new $(A.x+(l-A.y)/(C.y-A.y)*(C.x-A.x),l)._round():C.y>=l&&(C=new $(A.x+(l-A.y)/(C.y-A.y)*(C.x-A.x),l)._round()),v&&A.equals(v[v.length-1])||(v=[A],u.push(v)),v.push(C)))))}}return u}it("Anchor",Vo);const Mc=1e20;function g_(t,e,r,n,l,u,f,g,v){for(let w=e;w<e+n;w++)y_(t,r*u+w,u,l,f,g,v);for(let w=r;w<r+l;w++)y_(t,w*u+e,1,n,f,g,v)}function y_(t,e,r,n,l,u,f){u[0]=0,f[0]=-Mc,f[1]=Mc,l[0]=t[e];for(let g=1,v=0,w=0;g<n;g++){l[g]=t[e+g*r];const A=g*g;do{const C=u[v];w=(l[g]-l[C]+A-C*C)/(g-C)/2}while(w<=f[v]&&--v>-1);v++,u[v]=g,f[v]=w,f[v+1]=Mc}for(let g=0,v=0;g<n;g++){for(;f[v+1]<g;)v++;const w=u[v],A=g-w;t[e+g*r]=l[w]+A*A}}const zf={none:0,ideographs:1,all:2};class dl{constructor(e,r,n){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const n=[];for(const l in e)for(const u of e[l])n.push({stack:l,id:u});Qr(n,({stack:l,id:u},f)=>{let g=this.entries[l];g||(g=this.entries[l]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=g.glyphs[u];if(v!==void 0)return void f(null,{stack:l,id:u,glyph:v});if(v=this._tinySDF(g,l,u),v)return g.glyphs[u]=v,void f(null,{stack:l,id:u,glyph:v});const w=Math.floor(u/256);if(256*w>65535)return void f(new Error("glyphs > 65535 not supported"));if(g.ranges[w])return void f(null,{stack:l,id:u,glyph:v});let A=g.requests[w];A||(A=g.requests[w]=[],dl.loadGlyphRange(l,w,this.url,this.requestManager,(C,I)=>{if(I){g.ascender=I.ascender,g.descender=I.descender;for(const L in I.glyphs)this._doesCharSupportLocalGlyph(+L)||(g.glyphs[+L]=I.glyphs[+L]);g.ranges[w]=!0}for(const L of A)L(C,I);delete g.requests[w]})),A.push((C,I)=>{C?f(C):I&&f(null,{stack:l,id:u,glyph:I.glyphs[u]||null})})},(l,u)=>{if(l)r(l);else if(u){const f={};for(const{stack:g,id:v,glyph:w}of u)f[g]===void 0&&(f[g]={}),f[g].glyphs===void 0&&(f[g].glyphs={}),f[g].glyphs[v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},f[g].ascender=this.entries[g].ascender,f[g].descender=this.entries[g].descender;r(null,f)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==zf.none&&(this.localGlyphMode===zf.all?!!this.localFontFamily:!!this.localFontFamily&&(W(e)||te(e)||M(e)||k(e))||E(e))}_tinySDF(e,r,n){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(n))return;let u=e.tinySDF;if(!u){let V="400";/bold/i.test(r)?V="900":/medium/i.test(r)?V="500":/light/i.test(r)&&(V="200"),u=e.tinySDF=new dl.TinySDF({fontFamily:l,fontWeight:V,fontSize:48,buffer:6,radius:16}),u.fontWeight=V}if(this.localGlyphs[u.fontWeight][n])return this.localGlyphs[u.fontWeight][n];const f=String.fromCharCode(n),{data:g,width:v,height:w,glyphWidth:A,glyphHeight:C,glyphLeft:I,glyphTop:L,glyphAdvance:B}=u.draw(f);return this.localGlyphs[u.fontWeight][n]={id:n,bitmap:new ha({width:v,height:w},g),metrics:{width:A/2,height:C/2,left:I/2,top:L/2-27,advance:B/2,localGlyph:!0}}}}function v_(t,e,r,n){const l=[],u=t.image,f=u.pixelRatio,g=u.paddedRect.w-2,v=u.paddedRect.h-2,w=t.right-t.left,A=t.bottom-t.top,C=u.stretchX||[[0,g]],I=u.stretchY||[[0,v]],L=(Me,Ze)=>Me+Ze[1]-Ze[0],B=C.reduce(L,0),V=I.reduce(L,0),q=g-B,Q=v-V;let oe=0,ce=B,de=0,pe=V,me=0,ke=q,Ce=0,He=Q;if(u.content&&n){const Me=u.content;oe=Sh(C,0,Me[0]),de=Sh(I,0,Me[1]),ce=Sh(C,Me[0],Me[2]),pe=Sh(I,Me[1],Me[3]),me=Me[0]-oe,Ce=Me[1]-de,ke=Me[2]-Me[0]-ce,He=Me[3]-Me[1]-pe}const Ge=(Me,Ze,Ke,De)=>{const tt=Eh(Me.stretch-oe,ce,w,t.left),ot=Ah(Me.fixed-me,ke,Me.stretch,B),jt=Eh(Ze.stretch-de,pe,A,t.top),xi=Ah(Ze.fixed-Ce,He,Ze.stretch,V),Gt=Eh(Ke.stretch-oe,ce,w,t.left),Zt=Ah(Ke.fixed-me,ke,Ke.stretch,B),$e=Eh(De.stretch-de,pe,A,t.top),Jt=Ah(De.fixed-Ce,He,De.stretch,V),Ht=new $(tt,jt),Ki=new $(Gt,jt),Ui=new $(Gt,$e),ar=new $(tt,$e),wr=new $(ot/f,xi/f),Qt=new $(Zt/f,Jt/f),Ut=e*Math.PI/180;if(Ut){const Gi=Math.sin(Ut),Qi=Math.cos(Ut),yr=[Qi,-Gi,Gi,Qi];Ht._matMult(yr),Ki._matMult(yr),ar._matMult(yr),Ui._matMult(yr)}const Pi=Me.stretch+Me.fixed,Yi=Ze.stretch+Ze.fixed;return{tl:Ht,tr:Ki,bl:ar,br:Ui,tex:{x:u.paddedRect.x+1+Pi,y:u.paddedRect.y+1+Yi,w:Ke.stretch+Ke.fixed-Pi,h:De.stretch+De.fixed-Yi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:wr,pixelOffsetBR:Qt,minFontScaleX:ke/f/w,minFontScaleY:He/f/A,isSDF:r}};if(n&&(u.stretchX||u.stretchY)){const Me=x_(C,q,B),Ze=x_(I,Q,V);for(let Ke=0;Ke<Me.length-1;Ke++){const De=Me[Ke],tt=Me[Ke+1];for(let ot=0;ot<Ze.length-1;ot++)l.push(Ge(De,Ze[ot],tt,Ze[ot+1]))}}else l.push(Ge({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:v+1}));return l}function Sh(t,e,r){let n=0;for(const l of t)n+=Math.max(e,Math.min(r,l[1]))-Math.max(e,Math.min(r,l[0]));return n}function x_(t,e,r){const n=[{fixed:-1,stretch:0}];for(const[l,u]of t){const f=n[n.length-1];n.push({fixed:l-f.stretch,stretch:f.stretch}),n.push({fixed:l-f.stretch,stretch:f.stretch+(u-l)})}return n.push({fixed:e+1,stretch:r}),n}function Eh(t,e,r,n){return t/e*r+n}function Ah(t,e,r,n){return t-e*r/n}function k0(t,e,r,n){const l=e+t.positionedLines[n].lineOffset;return n===0?r+l/2:r+(l+(e+t.positionedLines[n-1].lineOffset))/2}dl.loadGlyphRange=function(t,e,r,n,l){const u=256*e,f=u+255,g=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${u}-${f}`),ys.Glyphs);Aa(g,(v,w)=>{if(v)l(v);else if(w){const A={},C=function(I){return new Cc(I).readFields(w0,{})}(w);for(const I of C.glyphs)A[I.id]=I;l(null,{glyphs:A,ascender:C.ascender,descender:C.descender})}})},dl.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:r=8,cutoff:n=.25,fontFamily:l="sans-serif",fontWeight:u="normal",fontStyle:f="normal"}){this.buffer=e,this.cutoff=n,this.radius=r;const g=this.size=t+4*e,v=this._createCanvas(g),w=this.ctx=v.getContext("2d",{willReadFrequently:!0});w.font=`${f} ${u} ${t}px ${l}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:l,actualBoundingBoxRight:u}=this.ctx.measureText(t),f=Math.floor(r),g=Math.min(this.size-this.buffer,Math.ceil(u-l)),v=Math.min(this.size-this.buffer,Math.ceil(r)+Math.ceil(n)),w=g+2*this.buffer,A=v+2*this.buffer,C=w*A,I=new Uint8ClampedArray(C),L={data:I,width:w,height:A,glyphWidth:g,glyphHeight:v,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(g===0||v===0)return L;const{ctx:B,buffer:V,gridInner:q,gridOuter:Q}=this;B.clearRect(V,V,g,v),B.fillText(t,V,V+f+1);const oe=B.getImageData(V,V,g,v);Q.fill(Mc,0,C),q.fill(0,0,C);for(let ce=0;ce<v;ce++)for(let de=0;de<g;de++){const pe=oe.data[4*(ce*g+de)+3]/255;if(pe===0)continue;const me=(ce+V)*w+de+V;if(pe===1)Q[me]=0,q[me]=Mc;else{const ke=.5-pe;Q[me]=ke>0?ke*ke:0,q[me]=ke<0?ke*ke:0}}g_(Q,0,0,w,A,w,this.f,this.v,this.z),g_(q,V,V,g,v,w,this.f,this.v,this.z);for(let ce=0;ce<C;ce++){const de=Math.sqrt(Q[ce])-Math.sqrt(q[ce]);I[ce]=Math.round(255-255*(de/this.radius+this.cutoff))}return L}};class z0{constructor(e=[],r=P0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:n}=this,l=r[e];for(;e>0;){const u=e-1>>1,f=r[u];if(n(l,f)>=0)break;r[e]=f,e=u}r[e]=l}_down(e){const{data:r,compare:n}=this,l=this.length>>1,u=r[e];for(;e<l;){let f=1+(e<<1),g=r[f];const v=f+1;if(v<this.length&&n(r[v],g)<0&&(f=v,g=r[v]),n(g,u)>=0)break;r[e]=g,e=f}r[e]=u}}function P0(t,e){return t<e?-1:t>e?1:0}function D0(t,e=1,r=!1){let n=1/0,l=1/0,u=-1/0,f=-1/0;const g=t[0];for(let L=0;L<g.length;L++){const B=g[L];(!L||B.x<n)&&(n=B.x),(!L||B.y<l)&&(l=B.y),(!L||B.x>u)&&(u=B.x),(!L||B.y>f)&&(f=B.y)}const v=Math.min(u-n,f-l);let w=v/2;const A=new z0([],L0);if(v===0)return new $(n,l);for(let L=n;L<u;L+=v)for(let B=l;B<f;B+=v)A.push(new fl(L+w,B+w,w,t));let C=function(L){let B=0,V=0,q=0;const Q=L[0];for(let oe=0,ce=Q.length,de=ce-1;oe<ce;de=oe++){const pe=Q[oe],me=Q[de],ke=pe.x*me.y-me.x*pe.y;V+=(pe.x+me.x)*ke,q+=(pe.y+me.y)*ke,B+=3*ke}return new fl(V/B,q/B,0,L)}(t),I=A.length;for(;A.length;){const L=A.pop();(L.d>C.d||!C.d)&&(C=L,r&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,I)),L.max-C.d<=e||(w=L.h/2,A.push(new fl(L.p.x-w,L.p.y-w,w,t)),A.push(new fl(L.p.x+w,L.p.y-w,w,t)),A.push(new fl(L.p.x-w,L.p.y+w,w,t)),A.push(new fl(L.p.x+w,L.p.y+w,w,t)),I+=4)}return r&&(console.log(`num probes: ${I}`),console.log(`best distance: ${C.d}`)),C.p}function L0(t,e){return e.max-t.max}function fl(t,e,r,n){this.p=new $(t,e),this.h=r,this.d=function(l,u){let f=!1,g=1/0;for(let v=0;v<u.length;v++){const w=u[v];for(let A=0,C=w.length,I=C-1;A<C;I=A++){const L=w[A],B=w[I];L.y>l.y!=B.y>l.y&&l.x<(B.x-L.x)*(l.y-L.y)/(B.y-L.y)+L.x&&(f=!f),g=Math.min(g,Im(l,L,B))}}return(f?1:-1)*Math.sqrt(g)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}const Pf=Number.POSITIVE_INFINITY,R0=Math.sqrt(2);function b_(t,e){return e[1]!==Pf?function(r,n,l){let u=0,f=0;switch(n=Math.abs(n),l=Math.abs(l),r){case"top-right":case"top-left":case"top":f=l-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-l}switch(r){case"top-right":case"bottom-right":case"right":u=-n;break;case"top-left":case"bottom-left":case"left":u=n}return[u,f]}(t,e[0],e[1]):function(r,n){let l=0,u=0;n<0&&(n=0);const f=n/R0;switch(r){case"top-right":case"top-left":u=f-7;break;case"bottom-right":case"bottom-left":u=7-f;break;case"bottom":u=7-n;break;case"top":u=n-7}switch(r){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=n;break;case"right":l=-n}return[l,u]}(t,e[0])}function B0(t,e,r,n,l,u,f,g,v,w){t.createArrays(),t.tilePixelRatio=Rt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const A=t.layers[0].layout,C=t.layers[0]._unevaluatedLayout._values,I={};if(t.textSizeData.kind==="composite"){const{minZoom:V,maxZoom:q}=t.textSizeData;I.compositeTextSizes=[C["text-size"].possiblyEvaluate(new bt(V),g),C["text-size"].possiblyEvaluate(new bt(q),g)]}if(t.iconSizeData.kind==="composite"){const{minZoom:V,maxZoom:q}=t.iconSizeData;I.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new bt(V),g),C["icon-size"].possiblyEvaluate(new bt(q),g)]}I.layoutTextSize=C["text-size"].possiblyEvaluate(new bt(v+1),g),I.layoutIconSize=C["icon-size"].possiblyEvaluate(new bt(v+1),g),I.textMaxSize=C["text-size"].possiblyEvaluate(new bt(18),g);const L=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",B=A.get("text-size");for(const V of t.features){const q=A.get("text-font").evaluate(V,{},g).join(","),Q=B.evaluate(V,{},g),oe=I.layoutTextSize.evaluate(V,{},g),ce=(I.layoutIconSize.evaluate(V,{},g),{horizontal:{},vertical:void 0}),de=V.text;let pe,me=[0,0];if(de){const He=de.toString(),Ge=A.get("text-letter-spacing").evaluate(V,{},g)*gr,Me=A.get("text-line-height").evaluate(V,{},g)*gr,Ze=ve(He)?Ge:0,Ke=A.get("text-anchor").evaluate(V,{},g),De=A.get("text-variable-anchor");if(!De){const Zt=A.get("text-radial-offset").evaluate(V,{},g);me=Zt?b_(Ke,[Zt*gr,Pf]):A.get("text-offset").evaluate(V,{},g).map($e=>$e*gr)}let tt=L?"center":A.get("text-justify").evaluate(V,{},g);const ot=A.get("symbol-placement"),jt=ot==="point",xi=ot==="point"?A.get("text-max-width").evaluate(V,{},g)*gr:0,Gt=Zt=>{t.allowVerticalPlacement&&Ae(He)&&(ce.vertical=If(de,e,r,l,q,xi,Me,Ke,Zt,Ze,me,In.vertical,!0,ot,oe,Q))};if(!L&&De){const Zt=tt==="auto"?De.map(Jt=>Df(Jt)):[tt];let $e=!1;for(let Jt=0;Jt<Zt.length;Jt++){const Ht=Zt[Jt];if(!ce.horizontal[Ht])if($e)ce.horizontal[Ht]=ce.horizontal[0];else{const Ki=If(de,e,r,l,q,xi,Me,"center",Ht,Ze,me,In.horizontal,!1,ot,oe,Q);Ki&&(ce.horizontal[Ht]=Ki,$e=Ki.positionedLines.length===1)}}Gt("left")}else{if(tt==="auto"&&(tt=Df(Ke)),jt||A.get("text-writing-mode").indexOf("horizontal")>=0||!Ae(He)){const Zt=If(de,e,r,l,q,xi,Me,Ke,tt,Ze,me,In.horizontal,!1,ot,oe,Q);Zt&&(ce.horizontal[tt]=Zt)}Gt(ot==="point"?"left":tt)}}let ke=!1;if(V.icon&&V.icon.name){const He=n[V.icon.name];He&&(pe=C0(l[V.icon.name],A.get("icon-offset").evaluate(V,{},g),A.get("icon-anchor").evaluate(V,{},g)),ke=He.sdf,t.sdfIcons===void 0?t.sdfIcons=He.sdf:t.sdfIcons!==He.sdf&&Je("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(He.pixelRatio!==t.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Ce=T_(ce.horizontal)||ce.vertical;t.iconsInText||(t.iconsInText=!!Ce&&Ce.iconsInText),(Ce||pe)&&O0(t,V,ce,pe,n,I,oe,0,me,ke,f,g,w)}u&&t.generateCollisionDebugBuffers(v,t.collisionBoxArray)}function Df(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function O0(t,e,r,n,l,u,f,g,v,w,A,C,I){let L=u.textMaxSize.evaluate(e,{},C);L===void 0&&(L=f);const B=t.layers[0].layout,V=B.get("icon-offset").evaluate(e,{},C),q=T_(r.horizontal)||r.vertical,Q=f/24,oe=t.tilePixelRatio*L/24,ce=t.tilePixelRatio*B.get("symbol-spacing"),de=B.get("text-padding")*t.tilePixelRatio,pe=B.get("icon-padding")*t.tilePixelRatio,me=It(B.get("text-max-angle")),ke=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Ce=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",He=B.get("symbol-placement"),Ge=ce/2,Me=B.get("icon-text-fit");let Ze;n&&Me!=="none"&&(t.allowVerticalPlacement&&r.vertical&&(Ze=u_(n,r.vertical,Me,B.get("icon-text-fit-padding"),V,Q)),q&&(n=u_(n,q,Me,B.get("icon-text-fit-padding"),V,Q)));const Ke=(De,tt,ot)=>{if(tt.x<0||tt.x>=Rt||tt.y<0||tt.y>=Rt)return;const{x:jt,y:xi,z:Gt}=I.projectTilePoint(tt.x,tt.y,ot),Zt=new Vo(jt,xi,Gt,0,void 0);(function($e,Jt,Ht,Ki,Ui,ar,wr,Qt,Ut,Pi,Yi,Gi,Qi,yr,Zr,qr,Ii,sr,Un,dr,_i,lr,Di,Tr,ir){const Sr=$e.addToLineVertexArray(Jt,Ki);let Pr,Dr,cr,Kn,gl,Rc,Bc,ng=0,og=0,ag=0,sg=0,Jf=-1,Qf=-1;const So={};let lg=yc(""),ep=0,tp=0;if(Ut._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ep,tp]=Ut.layout.get("text-offset").evaluate(_i,{},ir).map(un=>un*gr):(ep=Ut.layout.get("text-radial-offset").evaluate(_i,{},ir)*gr,tp=Pf),$e.allowVerticalPlacement&&Ui.vertical){const un=Ui.vertical;if(Zr)Rc=Lf(un),Qt&&(Bc=Lf(Qt));else{const hn=Ut.layout.get("text-rotate").evaluate(_i,{},ir)+90;cr=Ch(Pi,Ht,Jt,Yi,Gi,Qi,un,yr,hn,qr),Qt&&(Kn=Ch(Pi,Ht,Jt,Yi,Gi,Qi,Qt,sr,hn))}}if(ar){const un=Ut.layout.get("icon-rotate").evaluate(_i,{},ir),hn=Ut.layout.get("icon-text-fit")!=="none",Oc=v_(ar,un,Di,hn),rp=Qt?v_(Qt,un,Di,hn):void 0;Dr=Ch(Pi,Ht,Jt,Yi,Gi,Qi,ar,sr,un),ng=4*Oc.length;const cg=$e.iconSizeData;let as=null;cg.kind==="source"?(as=[xo*Ut.layout.get("icon-size").evaluate(_i,{},ir)],as[0]>fa&&Je(`${$e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):cg.kind==="composite"&&(as=[xo*lr.compositeIconSizes[0].evaluate(_i,{},ir),xo*lr.compositeIconSizes[1].evaluate(_i,{},ir)],(as[0]>fa||as[1]>fa)&&Je(`${$e.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),$e.addSymbols($e.icon,Oc,as,dr,Un,_i,!1,Ht,Jt,Sr.lineStartIndex,Sr.lineLength,-1,Tr,ir),Jf=$e.icon.placedSymbolArray.length-1,rp&&(og=4*rp.length,$e.addSymbols($e.icon,rp,as,dr,Un,_i,In.vertical,Ht,Jt,Sr.lineStartIndex,Sr.lineLength,-1,Tr,ir),Qf=$e.icon.placedSymbolArray.length-1)}for(const un in Ui.horizontal){const hn=Ui.horizontal[un];Pr||(lg=yc(hn.text),Zr?gl=Lf(hn):Pr=Ch(Pi,Ht,Jt,Yi,Gi,Qi,hn,yr,Ut.layout.get("text-rotate").evaluate(_i,{},ir),qr));const Oc=hn.positionedLines.length===1;if(ag+=w_($e,Ht,Jt,hn,wr,Ut,Zr,_i,qr,Sr,Ui.vertical?In.horizontal:In.horizontalOnly,Oc?Object.keys(Ui.horizontal):[un],So,Jf,lr,Tr,ir),Oc)break}Ui.vertical&&(sg+=w_($e,Ht,Jt,Ui.vertical,wr,Ut,Zr,_i,qr,Sr,In.vertical,["vertical"],So,Qf,lr,Tr,ir));let ya=-1;const ip=(un,hn)=>un?Math.max(un,hn):hn;ya=ip(gl,ya),ya=ip(Rc,ya),ya=ip(Bc,ya);const d1=ya>-1?1:0;$e.glyphOffsetArray.length>=pa.MAX_GLYPHS&&Je("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),_i.sortKey!==void 0&&$e.addToSortKeyRanges($e.symbolInstances.length,_i.sortKey),$e.symbolInstances.emplaceBack(Ht.x,Ht.y,Ht.z,Jt.x,Jt.y,So.right>=0?So.right:-1,So.center>=0?So.center:-1,So.left>=0?So.left:-1,So.vertical>=0?So.vertical:-1,Jf,Qf,lg,Pr!==void 0?Pr:$e.collisionBoxArray.length,Pr!==void 0?Pr+1:$e.collisionBoxArray.length,cr!==void 0?cr:$e.collisionBoxArray.length,cr!==void 0?cr+1:$e.collisionBoxArray.length,Dr!==void 0?Dr:$e.collisionBoxArray.length,Dr!==void 0?Dr+1:$e.collisionBoxArray.length,Kn||$e.collisionBoxArray.length,Kn?Kn+1:$e.collisionBoxArray.length,Yi,ag,sg,ng,og,d1,0,ep,tp,ya)})(t,tt,Zt,De,r,n,l,Ze,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,de,ke,v,0,pe,Ce,V,e,u,w,A,C)};if(He==="line")for(const De of __(e.geometry,0,0,Rt,Rt)){const tt=M0(De,ce,me,r.vertical||q,n,24,oe,t.overscaling,Rt);for(const ot of tt){const jt=q;jt&&F0(t,jt.text,Ge,ot)||Ke(De,ot,C)}}else if(He==="line-center"){for(const De of e.geometry)if(De.length>1){const tt=I0(De,me,r.vertical||q,n,24,oe);tt&&Ke(De,tt,C)}}else if(e.type==="Polygon")for(const De of xf(e.geometry,0)){const tt=D0(De,16);Ke(De[0],new Vo(tt.x,tt.y,0,0,void 0),C)}else if(e.type==="LineString")for(const De of e.geometry)Ke(De,new Vo(De[0].x,De[0].y,0,0,void 0),C);else if(e.type==="Point")for(const De of e.geometry)for(const tt of De)Ke([tt],new Vo(tt.x,tt.y,0,0,void 0),C)}const fa=32640;function w_(t,e,r,n,l,u,f,g,v,w,A,C,I,L,B,V,q){const Q=function(de,pe,me,ke,Ce,He,Ge,Me){const Ze=[];if(pe.positionedLines.length===0)return Ze;const Ke=ke.layout.get("text-rotate").evaluate(He,{})*Math.PI/180,De=function(Gt){const Zt=Gt[0],$e=Gt[1],Jt=Zt*$e;return Jt>0?[Zt,-$e]:Jt<0?[-Zt,$e]:Zt===0?[$e,Zt]:[$e,-Zt]}(me);let tt=Math.abs(pe.top-pe.bottom);for(const Gt of pe.positionedLines)tt-=Gt.lineOffset;const ot=pe.positionedLines.length,jt=tt/ot;let xi=pe.top-me[1];for(let Gt=0;Gt<ot;++Gt){const Zt=pe.positionedLines[Gt];xi=k0(pe,jt,xi,Gt);for(const $e of Zt.positionedGlyphs){if(!$e.rect)continue;const Jt=$e.rect||{};let Ht=4,Ki=!0,Ui=1,ar=0;if($e.imageName){const Di=Ge[$e.imageName];if(!Di)continue;if(Di.sdf){Je("SDF images are not supported in formatted text and will be ignored.");continue}Ki=!1,Ui=Di.pixelRatio,Ht=1/Ui}const wr=(Ce||Me)&&$e.vertical,Qt=$e.metrics.advance*$e.scale/2,Ut=$e.metrics,Pi=$e.rect;if(Pi===null)continue;Me&&pe.verticalizable&&(ar=$e.imageName?Qt-$e.metrics.width*$e.scale/2:0);const Yi=Ce?[$e.x+Qt,$e.y]:[0,0];let Gi=[0,0],Qi=[0,0],yr=!1;Ce||(wr?(Qi=[$e.x+Qt+De[0],$e.y+De[1]-ar],yr=!0):Gi=[$e.x+Qt+me[0],$e.y+me[1]-ar]);const Zr=Pi.w*$e.scale/(Ui*($e.localGlyph?2:1)),qr=Pi.h*$e.scale/(Ui*($e.localGlyph?2:1));let Ii,sr,Un,dr;if(wr){const Di=$e.y-xi,Tr=new $(-Qt,Qt-Di),ir=-Math.PI/2,Sr=new $(...Qi);Ii=new $(-Qt+Gi[0],Gi[1]),Ii._rotateAround(ir,Tr)._add(Sr),Ii.x+=-Di+Qt,Ii.y-=(Ut.left-Ht)*$e.scale;const Pr=$e.imageName?Ut.advance*$e.scale:gr*$e.scale,Dr=String.fromCharCode($e.glyph);h0(Dr)?Ii.x+=(1-Ht)*$e.scale:d0(Dr)?Ii.x+=Pr-Ut.height*$e.scale+(-Ht-1)*$e.scale:Ii.x+=$e.imageName||Ut.width+2*Ht===Pi.w&&Ut.height+2*Ht===Pi.h?(Pr-qr)/2:(Pr-(Ut.height+2*Ht)*$e.scale)/2,sr=new $(Ii.x,Ii.y-Zr),Un=new $(Ii.x+qr,Ii.y),dr=new $(Ii.x+qr,Ii.y-Zr)}else{const Di=(Ut.left-Ht)*$e.scale-Qt+Gi[0],Tr=(-Ut.top-Ht)*$e.scale+Gi[1],ir=Di+Zr,Sr=Tr+qr;Ii=new $(Di,Tr),sr=new $(ir,Tr),Un=new $(Di,Sr),dr=new $(ir,Sr)}if(Ke){let Di;Di=Ce?new $(0,0):yr?new $(De[0],De[1]):new $(me[0],me[1]),Ii._rotateAround(Ke,Di),sr._rotateAround(Ke,Di),Un._rotateAround(Ke,Di),dr._rotateAround(Ke,Di)}const _i=new $(0,0),lr=new $(0,0);Ze.push({tl:Ii,tr:sr,bl:Un,br:dr,tex:Jt,writingMode:pe.writingMode,glyphOffset:Yi,sectionIndex:$e.sectionIndex,isSDF:Ki,pixelOffsetTL:_i,pixelOffsetBR:lr,minFontScaleX:0,minFontScaleY:0})}}return Ze}(0,n,v,u,f,g,l,t.allowVerticalPlacement),oe=t.textSizeData;let ce=null;oe.kind==="source"?(ce=[xo*u.layout.get("text-size").evaluate(g,{},q)],ce[0]>fa&&Je(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):oe.kind==="composite"&&(ce=[xo*B.compositeTextSizes[0].evaluate(g,{},q),xo*B.compositeTextSizes[1].evaluate(g,{},q)],(ce[0]>fa||ce[1]>fa)&&Je(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,Q,ce,v,f,g,A,e,r,w.lineStartIndex,w.lineLength,L,V,q);for(const de of C)I[de]=t.text.placedSymbolArray.length-1;return 4*Q.length}function T_(t){for(const e in t)return t[e];return null}function Ch(t,e,r,n,l,u,f,g,v,w){let A=f.top,C=f.bottom,I=f.left,L=f.right;const B=f.collisionPadding;if(B&&(I-=B[0],A-=B[1],L+=B[2],C+=B[3]),v){const V=new $(I,A),q=new $(L,A),Q=new $(I,C),oe=new $(L,C),ce=It(v);let de=new $(0,0);w&&(de=new $(w[0],w[1])),V._rotateAround(ce,de),q._rotateAround(ce,de),Q._rotateAround(ce,de),oe._rotateAround(ce,de),I=Math.min(V.x,q.x,Q.x,oe.x),L=Math.max(V.x,q.x,Q.x,oe.x),A=Math.min(V.y,q.y,Q.y,oe.y),C=Math.max(V.y,q.y,Q.y,oe.y)}return t.emplaceBack(e.x,e.y,e.z,r.x,r.y,I,A,L,C,g,n,l,u),t.length-1}function Lf(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function F0(t,e,r,n){const l=t.compareText;if(e in l){const u=l[e];for(let f=u.length-1;f>=0;f--)if(n.dist(u[f])<r)return!0}else l[e]=[];return l[e].push(n),!1}const U0=is.VectorTileFeature.types,N0=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ih(t,e,r,n,l,u,f,g,v,w,A,C,I,L,B,V){const q=A?Math.min(fa,Math.round(A[0])):0,Q=A?Math.min(fa,Math.round(A[1])):0;t.emplaceBack(e,r,Math.round(32*f),Math.round(32*g),v,w,(q<<1)+(C?1:0),Q,16*I,16*L,256*B,256*V,n,l,u,0)}function Rf(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r)}function j0(t){for(const e of t.sections)if(We(e.text))return!0;return!1}class Bf{constructor(e){this.layoutVertexArray=new Xd,this.indexArray=new An,this.programConfigurations=e,this.segments=new Xi,this.dynamicLayoutVertexArray=new el,this.opacityVertexArray=new Hd,this.placedSymbolArray=new sm}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,n,l){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,n0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,o0.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,N0,!0),this.opacityVertexBuffer.itemSize=1),(n||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}it("SymbolBuffers",Bf);class Of{constructor(e,r,n){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new n,this.segments=new Xi,this.collisionVertexArray=new Jd,this.collisionVertexArrayExt=new el}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,a0.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,s0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}it("CollisionBuffers",Of);class pa{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ve([]),this.placementViewportMatrix=Ve([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Sf(this.zoom,r["text-size"]),this.iconSizeData=Sf(this.zoom,r["icon-size"]);const n=this.layers[0].layout,l=n.get("symbol-sort-key"),u=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(f=>In[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID}createArrays(){this.text=new Bf(new Qa(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Bf(new Qa(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new um,this.lineVertexArray=new hm,this.symbolInstances=new cm}calculateGlyphDependencies(e,r,n,l,u){for(let f=0;f<e.length;f++)if(r[e.charCodeAt(f)]=!0,l&&u){const g=Ac[e.charAt(f)];g&&(r[g.charCodeAt(0)]=!0)}}populate(e,r,n,l){const u=this.layers[0],f=u.layout,g=f.get("text-font"),v=f.get("text-field"),w=f.get("icon-image"),A=(v.value.kind!=="constant"||v.value.value instanceof At&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),C=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,I=f.get("symbol-sort-key");if(this.features=[],!A&&!C)return;const L=r.iconDependencies,B=r.glyphDependencies,V=r.availableImages,q=new bt(this.zoom);for(const{feature:Q,id:oe,index:ce,sourceLayerIndex:de}of e){const pe=u._featureFilter.needGeometry,me=ts(Q,pe);if(!u._featureFilter.filter(q,me,n))continue;let ke,Ce;if(pe||(me.geometry=No(Q,n,l)),A){const Ge=u.getValueAndResolveTokens("text-field",me,n,V),Me=At.factory(Ge);j0(Me)&&(this.hasRTLText=!0),(!this.hasRTLText||sn()==="unavailable"||this.hasRTLText&&$t.isParsed())&&(ke=u0(Me,u,me))}if(C){const Ge=u.getValueAndResolveTokens("icon-image",me,n,V);Ce=Ge instanceof nn?Ge:nn.fromString(Ge)}if(!ke&&!Ce)continue;const He=this.sortFeaturesByKey?I.evaluate(me,{},n):void 0;if(this.features.push({id:oe,text:ke,icon:Ce,index:ce,sourceLayerIndex:de,geometry:me.geometry,properties:Q.properties,type:U0[Q.type],sortKey:He}),Ce&&(L[Ce.name]=!0),ke){const Ge=g.evaluate(me,{},n).join(","),Me=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(In.vertical)>=0;for(const Ze of ke.sections)if(Ze.image)L[Ze.image.name]=!0;else{const Ke=Ae(ke.toString()),De=Ze.fontStack||Ge,tt=B[De]=B[De]||{};this.calculateGlyphDependencies(Ze.text,tt,Me,this.allowVerticalPlacement,Ke)}}}f.get("symbol-placement")==="line"&&(this.features=function(Q){const oe={},ce={},de=[];let pe=0;function me(Ge){de.push(Q[Ge]),pe++}function ke(Ge,Me,Ze){const Ke=ce[Ge];return delete ce[Ge],ce[Me]=Ke,de[Ke].geometry[0].pop(),de[Ke].geometry[0]=de[Ke].geometry[0].concat(Ze[0]),Ke}function Ce(Ge,Me,Ze){const Ke=oe[Me];return delete oe[Me],oe[Ge]=Ke,de[Ke].geometry[0].shift(),de[Ke].geometry[0]=Ze[0].concat(de[Ke].geometry[0]),Ke}function He(Ge,Me,Ze){const Ke=Ze?Me[0][Me[0].length-1]:Me[0][0];return`${Ge}:${Ke.x}:${Ke.y}`}for(let Ge=0;Ge<Q.length;Ge++){const Me=Q[Ge],Ze=Me.geometry,Ke=Me.text?Me.text.toString():null;if(!Ke){me(Ge);continue}const De=He(Ke,Ze),tt=He(Ke,Ze,!0);if(De in ce&&tt in oe&&ce[De]!==oe[tt]){const ot=Ce(De,tt,Ze),jt=ke(De,tt,de[ot].geometry);delete oe[De],delete ce[tt],ce[He(Ke,de[jt].geometry,!0)]=jt,de[ot].geometry=null}else De in ce?ke(De,tt,Ze):tt in oe?Ce(De,tt,Ze):(me(Ge),oe[De]=pe-1,ce[tt]=pe-1)}return de.filter(Ge=>Ge.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Q,oe)=>Q.sortKey-oe.sortKey)}update(e,r,n,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,n,l),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,n,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const n=this.lineVertexArray.length;if(e.segment!==void 0){let l=e.dist(r[e.segment+1]),u=e.dist(r[e.segment]);const f={};for(let g=e.segment+1;g<r.length;g++)f[g]={x:r[g].x,y:r[g].y,tileUnitDistanceFromAnchor:l},g<r.length-1&&(l+=r[g+1].dist(r[g]));for(let g=e.segment||0;g>=0;g--)f[g]={x:r[g].x,y:r[g].y,tileUnitDistanceFromAnchor:u},g>0&&(u+=r[g-1].dist(r[g]));for(let g=0;g<r.length;g++){const v=f[g];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,r,n,l,u,f,g,v,w,A,C,I,L,B){const V=e.indexArray,q=e.layoutVertexArray,Q=e.segments.prepareSegment(4*r.length,q,V,this.canOverlap?f.sortKey:void 0),oe=this.glyphOffsetArray.length,ce=Q.vertexLength,de=this.allowVerticalPlacement&&g===In.vertical?Math.PI/2:0,pe=f.text&&f.text.sections;for(let me=0;me<r.length;me++){const{tl:ke,tr:Ce,bl:He,br:Ge,tex:Me,pixelOffsetTL:Ze,pixelOffsetBR:Ke,minFontScaleX:De,minFontScaleY:tt,glyphOffset:ot,isSDF:jt,sectionIndex:xi}=r[me],Gt=Q.vertexLength,Zt=ot[1];Ih(q,v.x,v.y,v.z,w.x,w.y,ke.x,Zt+ke.y,Me.x,Me.y,n,jt,Ze.x,Ze.y,De,tt),Ih(q,v.x,v.y,v.z,w.x,w.y,Ce.x,Zt+Ce.y,Me.x+Me.w,Me.y,n,jt,Ke.x,Ze.y,De,tt),Ih(q,v.x,v.y,v.z,w.x,w.y,He.x,Zt+He.y,Me.x,Me.y+Me.h,n,jt,Ze.x,Ke.y,De,tt),Ih(q,v.x,v.y,v.z,w.x,w.y,Ge.x,Zt+Ge.y,Me.x+Me.w,Me.y+Me.h,n,jt,Ke.x,Ke.y,De,tt),Rf(e.dynamicLayoutVertexArray,v,de),V.emplaceBack(Gt,Gt+1,Gt+2),V.emplaceBack(Gt+1,Gt+2,Gt+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ot[0]),me!==r.length-1&&xi===r[me+1].sectionIndex||e.programConfigurations.populatePaintArrays(q.length,f,f.index,{},L,B,pe&&pe[xi])}e.placedSymbolArray.emplaceBack(v.x,v.y,v.z,w.x,w.y,oe,this.glyphOffsetArray.length-oe,ce,A,C,w.segment,n?n[0]:0,n?n[1]:0,l[0],l[1],g,0,!1,0,I,0)}_commitLayoutVertex(e,r,n,l,u,f,g){e.emplaceBack(r,n,l,u,f,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,r,n,l,u,f,g){const v=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),w=v.vertexLength,A=g.tileAnchorX,C=g.tileAnchorY;for(let L=0;L<4;L++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,l,u,f,A,C,new $(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,l,u,f,A,C,new $(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,l,u,f,A,C,new $(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,l,u,f,A,C,new $(e.x1,e.y2)),v.vertexLength+=4;const I=n.indexArray;I.emplaceBack(w,w+1),I.emplaceBack(w+1,w+2),I.emplaceBack(w+2,w+3),I.emplaceBack(w+3,w),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,n,l,u,f){for(let g=l;g<u;g++){const v=n.get(g),w=this.getSymbolInstanceTextSize(e,f,r,g);this._addCollisionDebugVertices(v,w,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,r,n,l,u,f){for(let g=l;g<u;g++){const v=n.get(g),w=this.getSymbolInstanceIconSize(e,r,g);this._addCollisionDebugVertices(v,w,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Of(rh,Ym.members,ca),this.iconCollisionBox=new Of(rh,Ym.members,ca);const n=ll(this.iconSizeData,e),l=ll(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(l,e,r,f.textBoxStartIndex,f.textBoxEndIndex,f),this._addTextDebugCollisionBoxes(l,e,r,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._addIconDebugCollisionBoxes(n,e,r,f.iconBoxStartIndex,f.iconBoxEndIndex,f),this._addIconDebugCollisionBoxes(n,e,r,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f)}}getSymbolInstanceTextSize(e,r,n,l){const u=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:l),f=bh(this.textSizeData,e,u)/gr;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,r,n){const l=this.icon.placedSymbolArray.get(n),u=bh(this.iconSizeData,e,l);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,r,n){e.emplaceBack(r,-n,-n),e.emplaceBack(r,n,-n),e.emplaceBack(r,n,n),e.emplaceBack(r,-n,n)}_updateTextDebugCollisionBoxes(e,r,n,l,u,f){for(let g=l;g<u;g++){const v=n.get(g),w=this.getSymbolInstanceTextSize(e,f,r,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,v.padding)}}_updateIconDebugCollisionBoxes(e,r,n,l,u){for(let f=l;f<u;f++){const g=n.get(f),v=this.getSymbolInstanceIconSize(e,r,f);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,v,g.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=ll(this.iconSizeData,e),l=ll(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(l,e,r,f.textBoxStartIndex,f.textBoxEndIndex,f),this._updateTextDebugCollisionBoxes(l,e,r,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f),this._updateIconDebugCollisionBoxes(n,e,r,f.iconBoxStartIndex,f.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,e,r,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,n,l,u,f,g,v,w){const A={};for(let C=r;C<n;C++){const I=e.get(C);A.textBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},A.textFeatureIndex=I.featureIndex;break}for(let C=l;C<u;C++){const I=e.get(C);A.verticalTextBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},A.verticalTextFeatureIndex=I.featureIndex;break}for(let C=f;C<g;C++){const I=e.get(C);A.iconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},A.iconFeatureIndex=I.featureIndex;break}for(let C=v;C<w;C++){const I=e.get(C);A.verticalIconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},A.verticalIconFeatureIndex=I.featureIndex;break}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const n=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const n=e.placedSymbolArray.get(r),l=n.vertexStartIndex+4*n.numGlyphs;for(let u=n.vertexStartIndex;u<l;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),n=Math.cos(e),l=[],u=[],f=[];for(let g=0;g<this.symbolInstances.length;++g){f.push(g);const v=this.symbolInstances.get(g);l.push(0|Math.round(r*v.tileAnchorX+n*v.tileAnchorY)),u.push(v.featureIndex)}return f.sort((g,v)=>l[g]-l[v]||u[v]-u[g]),f}addToSortKeyRanges(e,r){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===r?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const n=this.symbolInstances.get(r);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((l,u,f)=>{l>=0&&f.indexOf(l)===u&&this.addIndicesForPlacedSymbol(this.text,l)}),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}it("SymbolBucket",pa,{omit:["layers","collisionBoxArray","features","compareText"]}),pa.MAX_GLYPHS=65535,pa.addDynamicAttributes=Rf;const V0=new hr({"symbol-placement":new nt(Ee.layout_symbol["symbol-placement"]),"symbol-spacing":new nt(Ee.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new nt(Ee.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pt(Ee.layout_symbol["symbol-sort-key"]),"symbol-z-order":new nt(Ee.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new nt(Ee.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new nt(Ee.layout_symbol["icon-ignore-placement"]),"icon-optional":new nt(Ee.layout_symbol["icon-optional"]),"icon-rotation-alignment":new nt(Ee.layout_symbol["icon-rotation-alignment"]),"icon-size":new pt(Ee.layout_symbol["icon-size"]),"icon-text-fit":new nt(Ee.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new nt(Ee.layout_symbol["icon-text-fit-padding"]),"icon-image":new pt(Ee.layout_symbol["icon-image"]),"icon-rotate":new pt(Ee.layout_symbol["icon-rotate"]),"icon-padding":new nt(Ee.layout_symbol["icon-padding"]),"icon-keep-upright":new nt(Ee.layout_symbol["icon-keep-upright"]),"icon-offset":new pt(Ee.layout_symbol["icon-offset"]),"icon-anchor":new pt(Ee.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new nt(Ee.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new nt(Ee.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new nt(Ee.layout_symbol["text-rotation-alignment"]),"text-field":new pt(Ee.layout_symbol["text-field"]),"text-font":new pt(Ee.layout_symbol["text-font"]),"text-size":new pt(Ee.layout_symbol["text-size"]),"text-max-width":new pt(Ee.layout_symbol["text-max-width"]),"text-line-height":new pt(Ee.layout_symbol["text-line-height"]),"text-letter-spacing":new pt(Ee.layout_symbol["text-letter-spacing"]),"text-justify":new pt(Ee.layout_symbol["text-justify"]),"text-radial-offset":new pt(Ee.layout_symbol["text-radial-offset"]),"text-variable-anchor":new nt(Ee.layout_symbol["text-variable-anchor"]),"text-anchor":new pt(Ee.layout_symbol["text-anchor"]),"text-max-angle":new nt(Ee.layout_symbol["text-max-angle"]),"text-writing-mode":new nt(Ee.layout_symbol["text-writing-mode"]),"text-rotate":new pt(Ee.layout_symbol["text-rotate"]),"text-padding":new nt(Ee.layout_symbol["text-padding"]),"text-keep-upright":new nt(Ee.layout_symbol["text-keep-upright"]),"text-transform":new pt(Ee.layout_symbol["text-transform"]),"text-offset":new pt(Ee.layout_symbol["text-offset"]),"text-allow-overlap":new nt(Ee.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new nt(Ee.layout_symbol["text-ignore-placement"]),"text-optional":new nt(Ee.layout_symbol["text-optional"])});var Ff={paint:new hr({"icon-opacity":new pt(Ee.paint_symbol["icon-opacity"]),"icon-color":new pt(Ee.paint_symbol["icon-color"]),"icon-halo-color":new pt(Ee.paint_symbol["icon-halo-color"]),"icon-halo-width":new pt(Ee.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pt(Ee.paint_symbol["icon-halo-blur"]),"icon-translate":new nt(Ee.paint_symbol["icon-translate"]),"icon-translate-anchor":new nt(Ee.paint_symbol["icon-translate-anchor"]),"text-opacity":new pt(Ee.paint_symbol["text-opacity"]),"text-color":new pt(Ee.paint_symbol["text-color"],{runtimeType:Ln,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new pt(Ee.paint_symbol["text-halo-color"]),"text-halo-width":new pt(Ee.paint_symbol["text-halo-width"]),"text-halo-blur":new pt(Ee.paint_symbol["text-halo-blur"]),"text-translate":new nt(Ee.paint_symbol["text-translate"]),"text-translate-anchor":new nt(Ee.paint_symbol["text-translate-anchor"])}),layout:V0};class S_{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:co,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}it("FormatSectionOverride",S_,{omit:["defaultValue"]});class Mh extends qn{constructor(e){super(e,Ff)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const l=[];for(const u of n)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,n,l){const u=this.layout.get(e).evaluate(r,{},n,l),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||ea(f.value)||!u?u:function(g,v){return v.replace(/{([^{}]+)}/g,(w,A)=>A in g?String(g[A]):"")}(r.properties,u)}createBucket(e){return new pa(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Ff.paint.overridableProperties){if(!Mh.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),n=new S_(r),l=new ic(n,r.property.specification);let u=null;u=r.value.kind==="constant"||r.value.kind==="source"?new Za("source",l):new rc("composite",l,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new zr(r.property,u,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,n){return!(!this.layout||r.isDataDriven()||n.isDataDriven())&&Mh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const n=e.get("text-field"),l=Ff.paint.properties[r];let u=!1;const f=g=>{for(const v of g)if(l.overrides&&l.overrides.hasOverride(v))return void(u=!0)};if(n.value.kind==="constant"&&n.value.value instanceof At)f(n.value.value.sections);else if(n.value.kind==="source"){const g=w=>{u||(w instanceof ho&&qi(w.value)===uo?f(w.value.sections):w instanceof Rn?f(w.sections):w.eachChild(g))},v=n.value;v._styleExpression&&g(v._styleExpression.expression)}return u}getProgramConfiguration(e){return new Fo(this,e)}}var $0={paint:new hr({"background-color":new nt(Ee.paint_background["background-color"]),"background-pattern":new Ro(Ee.paint_background["background-pattern"]),"background-opacity":new nt(Ee.paint_background["background-opacity"])})},G0={paint:new hr({"raster-opacity":new nt(Ee.paint_raster["raster-opacity"]),"raster-hue-rotate":new nt(Ee.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new nt(Ee.paint_raster["raster-brightness-min"]),"raster-brightness-max":new nt(Ee.paint_raster["raster-brightness-max"]),"raster-saturation":new nt(Ee.paint_raster["raster-saturation"]),"raster-contrast":new nt(Ee.paint_raster["raster-contrast"]),"raster-resampling":new nt(Ee.paint_raster["raster-resampling"]),"raster-fade-duration":new nt(Ee.paint_raster["raster-fade-duration"])})};class Z0 extends qn{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var q0={paint:new hr({"sky-type":new nt(Ee.paint_sky["sky-type"]),"sky-atmosphere-sun":new nt(Ee.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new nt(Ee.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new nt(Ee.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new nt(Ee.paint_sky["sky-gradient-radius"]),"sky-gradient":new yo(Ee.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new nt(Ee.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new nt(Ee.paint_sky["sky-atmosphere-color"]),"sky-opacity":new nt(Ee.paint_sky["sky-opacity"])})};function Uf(t,e,r){const n=st(0,0,1),l=Io(io());return function(u,f,g){g*=.5;var v=f[0],w=f[1],A=f[2],C=f[3],I=Math.sin(g),L=Math.cos(g);u[0]=v*L-A*I,u[1]=w*L+C*I,u[2]=A*L+v*I,u[3]=C*L-w*I}(l,l,r?-It(t)+Math.PI:It(t)),Mo(l,l,-It(e)),pi(n,n,l),Ct(n,n)}const W0={circle:class extends qn{constructor(t){super(t,_x)}createBucket(t){return new uf(t)}queryRadius(t){const e=t;return ol("circle-radius",this,e)+ol("circle-stroke-width",this,e)+fh(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,r,n,l,u,f,g){const v=Pm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Dm(t,n,u,f,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",v,w)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Fo(this,t)}},heatmap:class extends qn{createBucket(t){return new Rm(t)}constructor(t){super(t,xx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=_f({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return ol("heatmap-radius",this,t)}queryIntersectsFeature(t,e,r,n,l,u,f,g){const v=this.paint.get("heatmap-radius").evaluate(e,r);return Dm(t,n,u,f,g,!0,!0,new $(0,0),v)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Fo(this,t)}},hillshade:class extends qn{constructor(t){super(t,bx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(t){return new Fo(this,t)}},fill:class extends qn{constructor(t){super(t,Fx)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(t){return new Fo(this,t)}recalculate(t,e){super.recalculate(t,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new vh(t)}queryRadius(){return fh(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,r,n,l,u){return!t.queryGeometry.isAboveHorizon&&Cm(zm(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends qn{constructor(t){super(t,Hx)}createBucket(t){return new Tf(t)}queryRadius(){return fh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Fo(this,t)}queryIntersectsFeature(t,e,r,n,l,u,f,g,v){const w=Pm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(e,r),C=this.paint.get("fill-extrusion-base").evaluate(e,r),I=[0,0],L=g&&u.elevation,B=u.elevation?u.elevation.exaggeration():1;if(L){const Q=t.tile.getBucket(this).centroidVertexArray,oe=v+1;if(oe<Q.length){const ce=Q.get(oe);I[0]=ce.a_centroid_pos0,I[1]=ce.a_centroid_pos1}}if(I[0]===0&&I[1]===1)return!1;const V=function(Q,oe,ce,de,pe,me,ke,Ce,He){return me?function(Ge,Me,Ze,Ke,De,tt,ot,jt,xi){const Gt=[],Zt=[],$e=[0,0,0,1];for(const Jt of Ge){const Ht=[],Ki=[];for(const Ui of Jt){const ar=Ui.x+Ke.x,wr=Ui.y+Ke.y,Qt=Kx(ar,wr,Me,Ze,tt,ot,jt,xi);$e[0]=ar,$e[1]=wr,$e[2]=Qt.base,$e[3]=1,pr($e,$e,De),$e[3]=Math.max($e[3],1e-5);const Ut=Wm([$e[0]/$e[3],$e[1]/$e[3],$e[2]/$e[3]]);$e[0]=ar,$e[1]=wr,$e[2]=Qt.top,$e[3]=1,pr($e,$e,De),$e[3]=Math.max($e[3],1e-5);const Pi=Wm([$e[0]/$e[3],$e[1]/$e[3],$e[2]/$e[3]]);Ht.push(Ut),Ki.push(Pi)}Gt.push(Ht),Zt.push(Ki)}return[Gt,Zt]}(Q,oe,ce,de,pe,me,ke,Ce,He):function(Ge,Me,Ze,Ke,De){const tt=[],ot=[],jt=De[8]*Me,xi=De[9]*Me,Gt=De[10]*Me,Zt=De[11]*Me,$e=De[8]*Ze,Jt=De[9]*Ze,Ht=De[10]*Ze,Ki=De[11]*Ze;for(const Ui of Ge){const ar=[],wr=[];for(const Qt of Ui){const Ut=Qt.x+Ke.x,Pi=Qt.y+Ke.y,Yi=De[0]*Ut+De[4]*Pi+De[12],Gi=De[1]*Ut+De[5]*Pi+De[13],Qi=De[2]*Ut+De[6]*Pi+De[14],yr=De[3]*Ut+De[7]*Pi+De[15],Zr=Yi+jt,qr=Gi+xi,Ii=Qi+Gt,sr=Math.max(yr+Zt,1e-5),Un=Yi+$e,dr=Gi+Jt,_i=Qi+Ht,lr=Math.max(yr+Ki,1e-5),Di=new $(Zr/sr,qr/sr);Di.z=Ii/sr,ar.push(Di);const Tr=new $(Un/lr,dr/lr);Tr.z=_i/lr,wr.push(Tr)}tt.push(ar),ot.push(wr)}return[tt,ot]}(Q,oe,ce,de,pe)}(n,C,A,w,f,L?g:null,I,B,u.center.lat),q=t.queryGeometry;return function(Q,oe,ce){let de=1/0;Cm(ce,oe)&&(de=qm(ce,oe[0]));for(let pe=0;pe<oe.length;pe++){const me=oe[pe],ke=Q[pe];for(let Ce=0;Ce<me.length-1;Ce++){const He=me[Ce],Ge=[He,me[Ce+1],ke[Ce+1],ke[Ce],He];Am(ce,Ge)&&(de=Math.min(de,qm(ce,Ge)))}}return de!==1/0&&de}(V[0],V[1],q.isPointQuery()?q.screenBounds:q.screenGeometry)}},line:class extends qn{constructor(t){super(t,Xm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ba,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Hm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new xh(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Fo(this,t)}queryRadius(t){const e=t,r=Km(ol("line-width",this,e),ol("line-gap-width",this,e)),n=ol("line-offset",this,e);return r/2+Math.abs(n)+fh(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,r,n,l,u){if(t.queryGeometry.isAboveHorizon)return!1;const f=zm(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),g=t.pixelToTileUnitsFactor/2*Km(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),v=this.paint.get("line-offset").evaluate(e,r);return v&&(n=function(w,A){const C=[],I=new $(0,0);for(let L=0;L<w.length;L++){const B=w[L],V=[];for(let q=0;q<B.length;q++){const Q=B[q-1],oe=B[q],ce=B[q+1],de=q===0?I:oe.sub(Q)._unit()._perp(),pe=q===B.length-1?I:ce.sub(oe)._unit()._perp(),me=de._add(pe)._unit();me._mult(1/(me.x*pe.x+me.y*pe.y)),V.push(me._mult(A)._add(oe))}C.push(V)}return C}(n,v*t.pixelToTileUnitsFactor)),function(w,A,C){for(let I=0;I<A.length;I++){const L=A[I];if(w.length>=3){for(let B=0;B<L.length;B++)if(nl(w,L[B]))return!0}if(dx(w,L,C))return!0}return!1}(f,n,g)}isTileClipped(){return!0}},symbol:Mh,background:class extends qn{constructor(t){super(t,$0)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends qn{constructor(t){super(t,G0)}getProgramIds(){return["raster"]}},sky:class extends qn{constructor(t){super(t,q0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=_f({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(t,e){const r=this.paint.get("sky-type");if(r==="atmosphere"){const n=this.paint.get("sky-atmosphere-sun"),l=!n,u=t.style.light,f=u.properties.get("position");return l&&u.properties.get("anchor")==="viewport"&&Je("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?Uf(f.azimuthal,90-f.polar,e):Uf(n[0],90-n[1],e)}if(r==="gradient"){const n=this.paint.get("sky-gradient-center");return Uf(n[0],90-n[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}},{HTMLImageElement:E_,HTMLCanvasElement:A_,HTMLVideoElement:C_,ImageData:I_,ImageBitmap:kh}=G;class zh{constructor(e,r,n,l){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(r,l)}update(e,r,n){const{width:l,height:u}=e,{context:f}=this,{gl:g}=f;if(g.bindTexture(g.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!r||r.premultiply!==!1)),n||this.size&&this.size[0]===l&&this.size[1]===u){const{x:v,y:w}=n||{x:0,y:0};e instanceof E_||e instanceof A_||e instanceof C_||e instanceof I_||kh&&e instanceof kh?g.texSubImage2D(g.TEXTURE_2D,0,v,w,g.RGBA,g.UNSIGNED_BYTE,e):g.texSubImage2D(g.TEXTURE_2D,0,v,w,l,u,g.RGBA,g.UNSIGNED_BYTE,e.data)}else this.size=[l,u],e instanceof E_||e instanceof A_||e instanceof C_||e instanceof I_||kh&&e instanceof kh?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,g.UNSIGNED_BYTE,e):g.texImage2D(g.TEXTURE_2D,0,this.format,l,u,0,this.format,g.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,r){const{context:n}=this,{gl:l}=n;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.filter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,r),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Nf{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new ha({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const n=this.getKey(e,r);return this.positions[n]}trim(){const e=this.width,r=this.height=wi(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,n){const l=[];let u=e.length%2==1?-e[e.length-1]*n:0,f=e[0]*n,g=!0;l.push({left:u,right:f,isDash:g,zeroLength:e[0]===0});let v=e[0];for(let w=1;w<e.length;w++){g=!g;const A=e[w];u=v*n,v+=A,f=v*n,l.push({left:u,right:f,isDash:g,zeroLength:A===0})}return l}addRoundDash(e,r,n){const l=r/2;for(let u=-n;u<=n;u++){const f=this.width*(this.nextRow+n+u);let g=0,v=e[g];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++g]);const A=Math.abs(w-v.left),C=Math.abs(w-v.right),I=Math.min(A,C);let L;const B=u/n*(l+1);if(v.isDash){const V=l-Math.abs(B);L=Math.sqrt(I*I+V*V)}else L=l-Math.sqrt(I*I+B*B);this.image.data[f+w]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,r){for(let v=e.length-1;v>=0;--v){const w=e[v],A=e[v+1];w.zeroLength?e.splice(v,1):A&&A.isDash===w.isDash&&(A.left=w.left,e.splice(v,1))}const n=e[0],l=e[e.length-1];n.isDash===l.isDash&&(n.left=l.left-this.width,l.right=n.right+this.width);const u=this.width*this.nextRow;let f=0,g=e[f];for(let v=0;v<this.width;v++){v/g.right>1&&(g=e[++f]);const w=Math.abs(v-g.left),A=Math.abs(v-g.right),C=Math.min(w,A);this.image.data[u+v]=Math.max(0,Math.min(255,(g.isDash?C:-C)+r+128))}}addDash(e,r){const n=this.getKey(e,r);if(this.positions[n])return this.positions[n];const l=r==="round",u=l?7:0,f=2*u+1;if(this.nextRow+f>this.height)return Je("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let A=0;A<e.length;A++)e[A]<0&&(Je("Negative value is found in line dasharray, replacing values with 0"),e[A]=0),g+=e[A];if(g!==0){const A=this.width/g,C=this.getDashRanges(e,this.width,A);l?this.addRoundDash(C,A,u):this.addRegularDash(C,r==="square"?.5*A:0)}const v=this.nextRow+u;this.nextRow+=f;const w={tl:[v,u],br:[g,0]};return this.positions[n]=w,w}}it("LineAtlas",Nf);class X0{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const H0=G.performance;function M_(t){const e=t?t.url.toString():void 0;return H0.getEntriesByName(e)}class K0{constructor(){this.tasks={},this.taskQueue=[],no(["process"],this),this.invoker=new X0(this.process),this.nextId=0}add(e,r){const n=this.nextId++,l=function({type:u,isSymbolTile:f,zoom:g}){return g=g||0,u==="message"?0:u!=="maybePrepare"||f?u!=="parseTile"||f?u==="parseTile"&&f?300-g:u==="maybePrepare"&&f?400-g:500:200-g:100-g}(r);if(l===0){Dt();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:r,priority:l,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){Dt();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let l=0;l<this.taskQueue.length;l++){const u=this.tasks[this.taskQueue[l]];u.priority<r&&(r=u.priority,e=l)}if(e===null)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}function k_(t,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class Ph{constructor(e,r,n){this.z=e,this.x=r,this.y=n,this.key=kc(0,e,e,r,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const n=function(u,f,g){var v=k_(256*u,256*(f=Math.pow(2,g)-f-1),g),w=k_(256*(u+1),256*(f+1),g);return v[0]+","+v[1]+","+w[0]+","+w[1]}(this.x,this.y,this.z),l=function(u,f,g){let v,w="";for(let A=u;A>0;A--)v=1<<A-1,w+=(f&v?1:0)+(g&v?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class jf{constructor(e,r){this.wrap=e,this.canonical=r,this.key=kc(e,r.z,r.z,r.x,r.y)}}class Gr{constructor(e,r,n,l,u){this.overscaledZ=e,this.wrap=r,this.canonical=new Ph(n,+l,+u),this.key=r===0&&e===n?this.canonical.key:kc(r,e,n,l,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new Gr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Gr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return kc(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return kc(this.wrap*+r,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Gr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,n=2*this.canonical.x,l=2*this.canonical.y;return[new Gr(r,this.wrap,r,n,l),new Gr(r,this.wrap,r,n+1,l),new Gr(r,this.wrap,r,n,l+1),new Gr(r,this.wrap,r,n+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Gr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Gr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new jf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function kc(t,e,r,n,l){const u=1<<Math.min(r,22);let f=u*(l%u)+n%u;return t&&r<22&&(f+=u*u*((t<0?-2*t-1:2*t)%(1<<2*(22-r)))),16*(32*f+r)+(e-r)}it("CanonicalTileID",Ph),it("OverscaledTileID",Gr,{omit:["projMatrix"]});class pl{constructor(e,r,n){this.func=e,this.mask=r,this.range=n}}pl.ReadOnly=!1,pl.ReadWrite=!0,pl.disabled=new pl(519,pl.ReadOnly,[0,1]);const Vf=7680;class $f{constructor(e,r,n,l,u,f){this.test=e,this.ref=r,this.mask=n,this.fail=l,this.depthFail=u,this.pass=f}}$f.disabled=new $f({func:519,mask:0},0,0,Vf,Vf,Vf);class bo{constructor(e,r,n){this.blendFunction=e,this.blendColor=r,this.mask=n}}bo.Replace=[1,0],bo.disabled=new bo(bo.Replace,Xt.transparent,[!1,!1,!1,!1]),bo.unblended=new bo(bo.Replace,Xt.transparent,[!0,!0,!0,!0]),bo.alphaBlended=new bo([1,771],Xt.transparent,[!0,!0,!0,!0]);const Gf=1029,Zf=2305;class Hn{constructor(e,r,n){this.enable=e,this.mode=r,this.frontFace=n}}Hn.disabled=new Hn(!1,Gf,Zf),Hn.backCCW=new Hn(!0,Gf,Zf),Hn.backCW=new Hn(!0,Gf,2304),Hn.frontCW=new Hn(!0,1028,2304),Hn.frontCCW=new Hn(!0,1028,Zf);class z_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const n=e[r];this._stringToNumber[n]=r,this._numberToString[r]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class P_{constructor(e,r,n,l,u){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=n,e._y=l,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Y0{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,n){const l=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},Wt(this.stateChanges[e][l],n),this.deletedStates[e]===null){this.deletedStates[e]={};for(const u in this.state[e])u!==l&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const u in this.state[e][l])n[u]||(this.deletedStates[e][l][u]=null)}else for(const u in n)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][u]===null&&delete this.deletedStates[e][l][u]}removeFeatureState(e,r,n){if(this.deletedStates[e]===null)return;const l=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&r!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][n]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(n in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][n]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,r){const n=String(r),l=Wt({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const u=this.deletedStates[e][r];if(u===null)return{};for(const f in u)delete l[f]}return l}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const n={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const u={};for(const f in this.stateChanges[l])this.state[l][f]||(this.state[l][f]={}),Wt(this.state[l][f],this.stateChanges[l][f]),u[f]=this.state[l][f];n[l]=u}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const u={};if(this.deletedStates[l]===null)for(const f in this.state[l])u[f]={},this.state[l][f]={};else for(const f in this.deletedStates[l]){if(this.deletedStates[l][f]===null)this.state[l][f]={};else for(const g of Object.keys(this.deletedStates[l][f]))delete this.state[l][f][g];u[f]=this.state[l][f]}n[l]=n[l]||{},Wt(n[l],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(const l in e)e[l].setFeatureState(n,r)}}class D_{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const n=this.toIdx(e,r);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function L_(t,e,r,n){let l=0,u=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(n[f])<1e-15){if(r[f]<t[f]||r[f]>e[f])return null}else{const g=1/n[f];let v=(t[f]-r[f])*g,w=(e[f]-r[f])*g;if(v>w){const A=v;v=w,w=A}if(v>l&&(l=v),w<u&&(u=w),l>u)return null}return l}function R_(t,e,r,n,l,u,f,g,v,w,A){const C=n-t,I=l-e,L=u-r,B=f-t,V=g-e,q=v-r,Q=A[1]*q-A[2]*V,oe=A[2]*B-A[0]*q,ce=A[0]*V-A[1]*B,de=C*Q+I*oe+L*ce;if(Math.abs(de)<1e-15)return null;const pe=1/de,me=w[0]-t,ke=w[1]-e,Ce=w[2]-r,He=(me*Q+ke*oe+Ce*ce)*pe;if(He<0||He>1)return null;const Ge=ke*L-Ce*I,Me=Ce*C-me*L,Ze=me*I-ke*C,Ke=(A[0]*Ge+A[1]*Me+A[2]*Ze)*pe;return Ke<0||He+Ke>1?null:(B*Ge+V*Me+q*Ze)*pe}function B_(t,e,r){return(t-e)/(r-e)}function O_(t,e,r,n,l,u,f,g,v){const w=1<<r,A=u-n,C=f-l,I=(t+1)/w*A+n,L=(e+0)/w*C+l,B=(e+1)/w*C+l;g[0]=(t+0)/w*A+n,g[1]=L,v[0]=I,v[1]=B}class F_{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(u){const f=Math.ceil(Math.log2(u.dim/8)),g=[];let v=Math.ceil(Math.pow(2,f));const w=1/v,A=(L,B,V,q,Q)=>{const oe=q?1:0,ce=(L+1)*V-oe,de=B*V,pe=(B+1)*V-oe;Q[0]=L*V,Q[1]=de,Q[2]=ce,Q[3]=pe};let C=new D_(v);const I=[];for(let L=0;L<v*v;L++){A(L%v,Math.floor(L/v),w,!1,I);const B=ma(I[0],I[1],u),V=ma(I[2],I[1],u),q=ma(I[2],I[3],u),Q=ma(I[0],I[3],u);C.minimums.push(Math.min(B,V,q,Q)),C.maximums.push(Math.max(B,V,q,Q)),C.leaves.push(1)}for(g.push(C),v/=2;v>=1;v/=2){const L=g[g.length-1];C=new D_(v);for(let B=0;B<v*v;B++){A(B%v,Math.floor(B/v),2,!0,I);const V=L.getElevation(I[0],I[1]),q=L.getElevation(I[2],I[1]),Q=L.getElevation(I[2],I[3]),oe=L.getElevation(I[0],I[3]),ce=L.isLeaf(I[0],I[1]),de=L.isLeaf(I[2],I[1]),pe=L.isLeaf(I[2],I[3]),me=L.isLeaf(I[0],I[3]),ke=Math.min(V.min,q.min,Q.min,oe.min),Ce=Math.max(V.max,q.max,Q.max,oe.max),He=ce&&de&&pe&&me;C.maximums.push(Ce),C.minimums.push(ke),C.leaves.push(Ce-ke<=5&&He?1:0)}g.push(C)}return g}(this.dem),n=r.length-1,l=r[n];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(r,0,0,n,0)}raycastRoot(e,r,n,l,u,f,g=1){return L_([e,r,-100],[n,l,this.maximums[0]*g],u,f)}raycast(e,r,n,l,u,f,g=1){if(!this.nodeCount)return null;const v=this.raycastRoot(e,r,n,l,u,f,g);if(v==null)return null;const w=[],A=[],C=[],I=[],L=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:B,t:V,nodex:q,nodey:Q,depth:oe}=L.pop();if(this.leaves[B]){O_(q,Q,oe,e,r,n,l,C,I);const de=1<<oe,pe=(q+0)/de,me=(q+1)/de,ke=(Q+0)/de,Ce=(Q+1)/de,He=ma(pe,ke,this.dem)*g,Ge=ma(me,ke,this.dem)*g,Me=ma(me,Ce,this.dem)*g,Ze=ma(pe,Ce,this.dem)*g,Ke=R_(C[0],C[1],He,I[0],C[1],Ge,I[0],I[1],Me,u,f),De=R_(I[0],I[1],Me,C[0],I[1],Ze,C[0],C[1],He,u,f),tt=Math.min(Ke!==null?Ke:Number.MAX_VALUE,De!==null?De:Number.MAX_VALUE);if(tt!==Number.MAX_VALUE)return tt;{const ot=qt([],u,f,V);if(U_(He,Ge,Ze,Me,B_(ot[0],C[0],I[0]),B_(ot[1],C[1],I[1]))>=ot[2])return V}continue}let ce=0;for(let de=0;de<this._siblingOffset.length;de++){O_((q<<1)+this._siblingOffset[de][0],(Q<<1)+this._siblingOffset[de][1],oe+1,e,r,n,l,C,I),C[2]=-100,I[2]=this.maximums[this.childOffsets[B]+de]*g;const pe=L_(C,I,u,f);if(pe!=null){const me=pe;w[de]=me;let ke=!1;for(let Ce=0;Ce<ce&&!ke;Ce++)me>=w[A[Ce]]&&(A.splice(Ce,0,de),ke=!0);ke||(A[ce]=de),ce++}}for(let de=0;de<ce;de++){const pe=A[de];L.push({idx:this.childOffsets[B]+pe,t:w[pe],nodex:(q<<1)+this._siblingOffset[pe][0],nodey:(Q<<1)+this._siblingOffset[pe][1],depth:oe+1})}}return null}_addNode(e,r,n){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,n,l,u){if(e[l].isLeaf(r,n)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const f=l-1,g=e[f];let v,w=0;for(let A=0;A<this._siblingOffset.length;A++){const C=2*r+this._siblingOffset[A][0],I=2*n+this._siblingOffset[A][1],L=g.getElevation(C,I),B=g.isLeaf(C,I),V=this._addNode(L.min,L.max,B);B&&(w|=1<<A),v||(v=V)}for(let A=0;A<this._siblingOffset.length;A++)w&1<<A||this._construct(e,2*r+this._siblingOffset[A][0],2*n+this._siblingOffset[A][1],f,v+A)}}function U_(t,e,r,n,l,u){return ni(ni(t,r,u),ni(e,n,u),l)}function ma(t,e,r){const n=r.dim,l=Vt(t*n-.5,0,n-1),u=Vt(e*n-.5,0,n-1),f=Math.floor(l),g=Math.floor(u),v=Math.min(f+1,n-1),w=Math.min(g+1,n-1);return U_(r.get(f,g),r.get(v,g),r.get(f,w),r.get(v,w),l-f,u-g)}const N_={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Dh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,n,l=!1,u=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return Je(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const f=this.dim=r.height-2;if(this.data=new Uint32Array(r.data.buffer),this.encoding=n||"mapbox",this.borderReady=l,!l){for(let g=0;g<f;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(f,g)]=this.data[this._idx(f-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,f)]=this.data[this._idx(g,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)],u&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new F_(this)}get(e,r,n=!1){const l=new Uint8Array(this.data.buffer);n&&(e=Vt(e,-1,this.dim),r=Vt(r,-1,this.dim));const u=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(l[u],l[u+1],l[u+2])}static getUnpackVector(e){return N_[e]}get unpackVector(){return N_[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,n){return(256*e*256+256*r+n)/10-1e4}_unpackTerrarium(e,r,n){return 256*e+r+n/256-32768}static pack(e,r){const n=[0,0,0,0],l=Dh.getUnpackVector(r);let u=Math.floor((e+l[3])/l[2]);return n[2]=u%256,u=Math.floor(u/256),n[1]=u%256,u=Math.floor(u/256),n[0]=u,n}getPixels(){return new Cn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,u=r*this.dim+this.dim,f=n*this.dim,g=n*this.dim+this.dim;switch(r){case-1:l=u-1;break;case 1:u=l+1}switch(n){case-1:f=g-1;break;case 1:g=f+1}const v=-r*this.dim,w=-n*this.dim;for(let A=f;A<g;A++)for(let C=l;C<u;C++)this.data[this._idx(C,A)]=e.data[this._idx(C+v,A+w)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}it("DEMData",Dh),it("DemMinMaxQuadTree",F_,{omit:["dem"]});class J0{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,n){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const u={value:r,timeout:void 0};if(n!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},n)),this.data[l].push(u),this.order.push(l),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const n=e.wrapped().key,l=r===void 0?0:this.data[n].indexOf(r),u=this.data[n][l];return this.data[n].splice(l,1),u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(u.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const n in this.data)for(const l of this.data[n])e(l.value)||r.push(l);for(const n of r)this.remove(n.value.tileID,n)}}class rs extends so{constructor(e,r,n){super(),this.id=e,this._onlySymbols=n,r.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new J0(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Y0}onAdd(e){this.map=e,this._minTileCacheSize=e?e._minTileCacheSize:null,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const n=this._tiles[r];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return mr(this._tiles).map(e=>e.tileID).sort(j_).map(e=>e.key)}getRenderableIds(e){const r=[];for(const n in this._tiles)this._isIdRenderable(+n,e)&&r.push(this._tiles[n]);return e?r.sort((n,l)=>{const u=n.tileID,f=l.tileID,g=new $(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),v=new $(f.canonical.x,f.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-f.overscaledZ||v.y-g.y||v.x-g.x}).map(n=>n.tileID.key):r.map(n=>n.tileID).sort(j_).map(n=>n.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const n=this._tiles[e];n&&(n.state!=="loading"&&(n.state=r),this._loadTile(n,this._tileLoaded.bind(this,n,e,r)))}_tileLoaded(e,r,n,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new xs(l,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=zi.now(),n==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new ao("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let l=0;l<r.length;l++){const u=r[l];if(e.neighboringTiles&&e.neighboringTiles[u]){const f=this.getTileByID(u);n(e,f),n(f,e)}}function n(l,u){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let f=u.tileID.canonical.x-l.tileID.canonical.x;const g=u.tileID.canonical.y-l.tileID.canonical.y,v=Math.pow(2,l.tileID.canonical.z),w=u.tileID.key;f===0&&g===0||Math.abs(g)>1||(Math.abs(f)>1&&(Math.abs(f+v)===1?f+=v:Math.abs(f-v)===1&&(f-=v)),u.dem&&l.dem&&(l.dem.backfillBorder(u.dem,f,g),l.neighboringTiles&&l.neighboringTiles[w]&&(l.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,n,l){for(const u in this._tiles){let f=this._tiles[u];if(l[u]||!f.hasData()||f.tileID.overscaledZ<=r||f.tileID.overscaledZ>n)continue;let g=f.tileID;for(;f&&f.tileID.overscaledZ>r+1;){const w=f.tileID.scaledTo(f.tileID.overscaledZ-1);f=this._tiles[w.key],f&&f.hasData()&&(g=w)}let v=g;for(;v.overscaledZ>r;)if(v=v.scaledTo(v.overscaledZ-1),e[v.key]){l[g.key]=g;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=r?n:null}for(let n=e.overscaledZ-1;n>=r;n--){const l=e.scaledTo(n),u=this._getLoadedTile(l);if(u)return u}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const n=Math.ceil(e.width/r)+1,l=Math.ceil(e.height/r)+1,u=Math.floor(n*l*5),f=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(g)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const n={};for(const l in this._tiles){const u=this._tiles[l];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+r),n[u.tileID.key]=u}this._tiles=n;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,r,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;let l;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(g=>new Gr(g.canonical.z,g.wrap,g.canonical.z,g.canonical.x,g.canonical.y)):(l=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(l=l.filter(g=>this._source.hasTile(g)))):l=[];const u=this._updateRetainedTiles(l);if(V_(this._source.type)&&l.length!==0){const g={},v={},w=Object.keys(u);for(const C of w){const I=u[C],L=this._tiles[C];if(!L||L.fadeEndTime&&L.fadeEndTime<=zi.now())continue;const B=this.findLoadedParent(I,Math.max(I.overscaledZ-rs.maxOverzooming,this._source.minzoom));B&&(this._addTile(B.tileID),g[B.tileID.key]=B.tileID),v[C]=I}const A=l[l.length-1].overscaledZ;for(const C in this._tiles){const I=this._tiles[C];if(u[C]||!I.hasData())continue;let L=I.tileID;for(;L.overscaledZ>A;){L=L.scaledTo(L.overscaledZ-1);const B=this._tiles[L.key];if(B&&B.hasData()&&v[L.key]){u[C]=I.tileID;break}}}for(const C in g)u[C]||(this._coveredTiles[C]=!0,u[C]=g[C])}for(const g in u)this._tiles[g].clearFadeHold();const f=function(g,v){const w=[];for(const A in g)A in v||w.push(A);return w}(this._tiles,u);for(const g of f){const v=this._tiles[g];v.hasSymbolBuckets&&!v.holdingForFade()?v.setHoldDuration(this.map._fadeDuration):v.hasSymbolBuckets&&!v.symbolFadeFinished()||this._removeTile(+g)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const n={},l=e.reduce((w,A)=>Math.min(w,A.overscaledZ),1/0),u=e[0].overscaledZ,f=Math.max(u-rs.maxOverzooming,this._source.minzoom),g=Math.max(u+rs.maxUnderzooming,this._source.minzoom),v={};for(const w of e){const A=this._addTile(w);r[w.key]=w,A.hasData()||l<this._source.maxzoom&&(v[w.key]=w)}this._retainLoadedChildren(v,l,g,r);for(const w of e){let A=this._tiles[w.key];if(A.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const I=w.children(this._source.maxzoom)[0],L=this.getTile(I);if(L&&L.hasData()){r[I.key]=I;continue}}else{const I=w.children(this._source.maxzoom);if(r[I[0].key]&&r[I[1].key]&&r[I[2].key]&&r[I[3].key])continue}let C=A.wasRequested();for(let I=w.overscaledZ-1;I>=f;--I){const L=w.scaledTo(I);if(n[L.key]||(n[L.key]=!0,A=this.getTile(L),!A&&C&&(A=this._addTile(L)),A&&(r[L.key]=L,C=A.wasRequested(),A.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let n,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){n=this._loadedParentTiles[l.key];break}r.push(l.key);const u=l.scaledTo(l.overscaledZ-1);if(n=this._getLoadedTile(u),n)break;l=u}for(const u of r)this._loadedParentTiles[u]=n}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const n=Boolean(r);if(!n){const l=this.map?this.map.painter:null,u=this._source.type==="raster"||this._source.type==="raster-dem";r=new Wf(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,l,u),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,n||this._source.fire(new ao("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=r.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,r,n){const l=[],u=this.transform;if(!u)return l;for(const f in this._tiles){const g=this._tiles[f];if(n&&g.clearQueryDebugViz(),g.holdingForFade())continue;const v=e.containsTile(g,u,r);v&&l.push(v)}return l}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(n=>this._tiles[n].tileID);for(const n of r)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(V_(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=zi.now())return!0}return!1}setFeatureState(e,r,n){this._state.updateState(e=e||"_geojsonTileLayer",r,n)}removeFeatureState(e,r,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,n)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,n){const l=this._tiles[e];l&&l.setDependencies(r,n)}reloadTilesForDependencies(e,r){for(const n in this._tiles)this._tiles[n].hasDependency(e,r)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,r))}_preloadTiles(e,r){const n=new Map,l=Array.isArray(e)?e:[e],u=this.map.painter.terrain,f=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(const w of l){const A=w.coveringTiles({tileSize:f,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const C of A)n.set(C.key,C);this.usedForTerrain&&w.updateElevation(!1)}const g=Array.from(n.values()),v=this._source.type==="raster"||this._source.type==="raster-dem";Qr(g,(w,A)=>{const C=new Wf(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,v);this._loadTile(C,I=>{this._source.type==="raster-dem"&&C.dem&&this._backfillDEM(C),A(I,C)})},r)}}function j_(t,e){const r=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-r||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function V_(t){return t==="raster"||t==="image"||t==="video"}rs.maxOverzooming=10,rs.maxUnderzooming=3;class Lh{constructor(e,r,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=n}static create(e,r,n){const l=n||e.findDEMTileFor(r);if(!l||!l.dem)return;const u=l.dem,f=l.tileID,g=1<<r.canonical.z-f.canonical.z;return new Lh(l,l.tileSize/Rt/g,[(r.canonical.x/g-f.canonical.x)*u.dim,(r.canonical.y/g-f.canonical.y)*u.dim])}tileCoordToPixel(e,r){const n=r*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(n);return new $(l,u)}getElevationAt(e,r,n,l){const u=e*this._scale+this._offset[0],f=r*this._scale+this._offset[1],g=Math.floor(u),v=Math.floor(f),w=this._dem;return l=!!l,n?ni(ni(w.get(g,v,l),w.get(g,v+1,l),f-v),ni(w.get(g+1,v,l),w.get(g+1,v+1,l),f-v),u-g):w.get(g,v,l)}getElevationAtPixel(e,r,n){return this._dem.get(e,r,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Wn(1,e)*this._dem.stride}}class $_{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Xa(Rt,16,0),this.featureIndexArray=new fm,this.promoteId=r}insert(e,r,n,l,u,f=0){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,l,u,f);const v=this.grid;for(let w=0;w<r.length;w++){const A=r[w],C=[1/0,1/0,-1/0,-1/0];for(let I=0;I<A.length;I++){const L=A[I];C[0]=Math.min(C[0],L.x),C[1]=Math.min(C[1],L.y),C[2]=Math.max(C[2],L.x),C[3]=Math.max(C[3],L.y)}C[0]<Rt&&C[1]<Rt&&C[2]>=0&&C[3]>=0&&v.insert(g,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new is.VectorTile(new Cc(this.rawTileData)).layers,this.sourceLayerCoder=new z_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,n,l){this.loadVTLayers();const u=e.params||{},f=Xs(u.filter),g=e.tileResult,v=e.transform,w=g.bufferedTilespaceBounds,A=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(B,V,q,Q)=>km(g.bufferedTilespaceGeometry,B,V,q,Q));A.sort(Q0);let C=null;v.elevation&&A.length>0&&(C=Lh.create(v.elevation,this.tileID));const I={};let L;for(let B=0;B<A.length;B++){const V=A[B];if(V===L)continue;L=V;const q=this.featureIndexArray.get(V);let Q=null;this.loadMatchingFeature(I,q,f,u.layers,u.availableImages,r,n,l,(oe,ce,de,pe=0)=>(Q||(Q=No(oe,this.tileID.canonical,e.tileTransform)),ce.queryIntersectsFeature(g,oe,de,Q,this.z,e.transform,e.pixelPosMatrix,C,pe)))}return I}loadMatchingFeature(e,r,n,l,u,f,g,v,w){const{featureIndex:A,bucketIndex:C,sourceLayerIndex:I,layoutVertexArrayOffset:L}=r,B=this.bucketLayerIDs[C];if(l&&!function(oe,ce){for(let de=0;de<oe.length;de++)if(ce.indexOf(oe[de])>=0)return!0;return!1}(l,B))return;const V=this.sourceLayerCoder.decode(I),q=this.vtLayers[V].feature(A);if(n.needGeometry){const oe=ts(q,!0);if(!n.filter(new bt(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!n.filter(new bt(this.tileID.overscaledZ),q))return;const Q=this.getId(q,V);for(let oe=0;oe<B.length;oe++){const ce=B[oe];if(l&&l.indexOf(ce)<0)continue;const de=f[ce];if(!de)continue;let pe={};Q!==void 0&&v&&(pe=v.getState(de.sourceLayer||"_geojsonTileLayer",Q));const me=Wt({},g[ce]);me.paint=G_(me.paint,de.paint,q,pe,u),me.layout=G_(me.layout,de.layout,q,pe,u);const ke=!w||w(q,de,pe,L);if(!ke)continue;const Ce=new P_(q,this.z,this.x,this.y,Q);Ce.layer=me;let He=e[ce];He===void 0&&(He=e[ce]=[]),He.push({featureIndex:A,feature:Ce,intersectionZ:ke})}}lookupSymbolFeatures(e,r,n,l,u,f,g,v){const w={};this.loadVTLayers();const A=Xs(u);for(const C of e)this.loadMatchingFeature(w,{bucketIndex:n,sourceLayerIndex:l,featureIndex:C,layoutVertexArrayOffset:0},A,f,g,v,r);return w}loadFeature(e){const{featureIndex:r,sourceLayerIndex:n}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(n),u=this.vtFeatures[l];if(u[r])return u[r];const f=this.vtLayers[l].feature(r);return u[r]=f,f}hasLayer(e){for(const r of this.bucketLayerIDs)for(const n of r)if(e===n)return!0;return!1}getId(e,r){let n=e.id;return this.promoteId&&(n=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof n=="boolean"&&(n=Number(n))),n}}function G_(t,e,r,n,l){return Fr(t,(u,f)=>{const g=e instanceof Lo?e.get(f):null;return g&&g.evaluate?g.evaluate(r,n,l):g})}function Q0(t,e){return e-t}it("FeatureIndex",$_,{omit:["rawTileData","sourceLayerCoder"]});var e1=Oi([{name:"a_pos",type:"Int16",components:2}]);const Fn=32,wo=33,_a=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,r=0,n=0,l=0,u=0,f=0,g=0;for(1&e?l=u=f=Fn:r=n=g=Fn;(e>>=1)>1;){const w=r+l>>1,A=n+u>>1;1&e?(l=r,u=n,r=f,n=g):(r=l,n=u,l=f,u=g),f=w,g=A}const v=4*t;_a[v+0]=r,_a[v+1]=n,_a[v+2]=l,_a[v+3]=u}const To=new Uint16Array(2178),ga=new Uint8Array(1089),Rh=new Uint16Array(1089);function Z_(t){return t===0?-.03125:t===32?.03125:0}var qf=Oi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const q_={type:2,extent:Rt,loadGeometry:()=>[[new $(0,0),new $(8193,0),new $(8193,8193),new $(0,8193),new $(0,0)]]};class Wf{constructor(e,r,n,l,u){this.tileID=e,this.uid=zn(),this.uses=0,this.tileSize=r,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<zi.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=ml(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,u){const f={};if(!u)return f;for(const g of l){const v=g.layerIds.map(w=>u.getLayer(w)).filter(Boolean);if(v.length!==0){g.layers=v,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(w=>v.filter(A=>A.id===w)[0]));for(const w of v)f[w.id]=g}}return f}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const u=this.buckets[l];if(u instanceof pa){if(this.hasSymbolBuckets=!0,!n)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const u=this.buckets[l];if(u instanceof pa&&u.hasRTLText){this.hasRTLText=!0,$t.isLoading()||$t.isLoaded()||sn()!=="deferred"||En();break}}this.queryPadding=0;for(const l in this.buckets){const u=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(l).queryRadius(u))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new of}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const n in this.buckets){const l=this.buckets[n];l.uploadPending()&&l.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new zh(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new zh(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new zh(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,n,l,u,f,g,v){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:g,transform:f,params:u,tileTransform:this.tileTransform},e,r,n):{}}querySourceFeatures(e,r){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const l=n.loadVTLayers(),u=r?r.sourceLayer:"",f=l._geojsonTileLayer||l[u];if(!f)return;const g=Xs(r&&r.filter),{z:v,x:w,y:A}=this.tileID.canonical,C={z:v,x:w,y:A};for(let I=0;I<f.length;I++){const L=f.feature(I);if(g.needGeometry){const q=ts(L,!0);if(!g.filter(new bt(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!g.filter(new bt(this.tileID.overscaledZ),L))continue;const B=n.getId(L,u),V=new P_(L,v,w,A,B);V.tile=C,e.push(V)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const n=ei(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const n=Date.now();let l=!1;if(this.expirationTime>n)l=!1;else if(r)if(this.expirationTime<r)l=!0;else{const u=this.expirationTime-r;u?this.expirationTime=n+Math.max(u,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const n=this.latestFeatureIndex.loadVTLayers(),l=r.style.listImages();for(const u in this.buckets){if(!r.style.hasLayer(u))continue;const f=this.buckets[u],g=f.layers[0].sourceLayer||"_geojsonTileLayer",v=n[g],w=e[g];if(!v||!w||Object.keys(w).length===0)continue;if(f.update(w,v,l,this.imageAtlas&&this.imageAtlas.patternPositions||{}),f instanceof xh||f instanceof vh){const C=r.style._getSourceCache(f.layers[0].source);r._terrain&&r._terrain.enabled&&C&&f.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(C.id,this.tileID)}const A=r&&r.style&&r.style.getLayer(u);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<zi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=zi.now()+e}setDependencies(e,r){const n={};for(const l of r)n[l]=!0;this.dependencies[e]=n}hasDependency(e,r){for(const n of e){const l=this.dependencies[n];if(l){for(const u of r)if(l[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const n=No(q_,this.tileID.canonical,this.tileTransform)[0],l=new Js,u=new oh;for(let f=0;f<n.length;f++){const{x:g,y:v}=n[f];l.emplaceBack(g,v),u.emplaceBack(f)}u.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(l,qf.members),this._tileDebugSegments=Xi.simpleSegment(0,0,l.length,u.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const n=No(q_,this.tileID.canonical,this.tileTransform)[0];let l,u;if(this.isRaster){const f=function(g,v){const w=ml(g,v),A=Math.pow(2,g.z);for(let q=0;q<wo;q++)for(let Q=0;Q<wo;Q++){const oe=Uo((g.x+(Q+Z_(Q))/Fn)/A),ce=On((g.y+(q+Z_(q))/Fn)/A),de=v.project(oe,ce),pe=q*wo+Q;To[2*pe+0]=Math.round((de.x*w.scale-w.x)*Rt),To[2*pe+1]=Math.round((de.y*w.scale-w.y)*Rt)}ga.fill(0),Rh.fill(0);for(let q=2045;q>=0;q--){const Q=4*q,oe=_a[Q+0],ce=_a[Q+1],de=_a[Q+2],pe=_a[Q+3],me=oe+de>>1,ke=ce+pe>>1,Ce=me+ke-ce,He=ke+oe-me,Ge=ce*wo+oe,Me=pe*wo+de,Ze=ke*wo+me,Ke=Math.hypot((To[2*Ge+0]+To[2*Me+0])/2-To[2*Ze+0],(To[2*Ge+1]+To[2*Me+1])/2-To[2*Ze+1])>=16;if(ga[Ze]=ga[Ze]||(Ke?1:0),q<1022){const De=(ce+He>>1)*wo+(oe+Ce>>1),tt=(pe+He>>1)*wo+(de+Ce>>1);ga[Ze]=ga[Ze]||ga[De]||ga[tt]}}const C=new Qs,I=new An;let L=0;function B(q,Q){const oe=Q*wo+q;return Rh[oe]===0&&(C.emplaceBack(To[2*oe+0],To[2*oe+1],q*Rt/Fn,Q*Rt/Fn),Rh[oe]=++L),Rh[oe]-1}function V(q,Q,oe,ce,de,pe){const me=q+oe>>1,ke=Q+ce>>1;if(Math.abs(q-de)+Math.abs(Q-pe)>1&&ga[ke*wo+me])V(de,pe,q,Q,me,ke),V(oe,ce,de,pe,me,ke);else{const Ce=B(q,Q),He=B(oe,ce),Ge=B(de,pe);I.emplaceBack(Ce,He,Ge)}}return V(0,0,Fn,Fn,Fn,0),V(Fn,Fn,0,0,0,Fn),{vertices:C,indices:I}}(this.tileID.canonical,r);l=f.vertices,u=f.indices}else{l=new Qs,u=new An;for(const{x:g,y:v}of n)l.emplaceBack(g,v,0,0);const f=ph(l.int16,void 0,4);for(let g=0;g<f.length;g+=3)u.emplaceBack(f[g],f[g+1],f[g+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,qf.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(u),this._tileBoundsSegments=Xi.simpleSegment(0,0,l.length,u.length)}}const t1=Oi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),i1=Oi([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:W_}=t1;function ns(t,e){const r=t.fovAboveCenter,n=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,l=(t._camera.position[2]*t.worldSize-n)/Math.cos(t._pitch),u=Math.sin(r)*l/Math.sin(Math.max(Math.PI/2-t._pitch-r,.01)),f=Math.sin(t._pitch)*u+l;return Math.min(1.01*f,l*(1/t._horizonShift))}const Xf=Rt/Math.PI/2,ln=-Xf,cn=Xf,r1=[new Xn([ln,ln,ln],[cn,cn,cn]),new Xn([ln,ln,ln],[0,0,cn]),new Xn([0,ln,ln],[cn,0,cn]),new Xn([ln,0,ln],[0,cn,cn]),new Xn([0,0,ln],[cn,cn,cn])];function Bh(t){if(t.z<=1)return r1[t.z+2*t.y+t.x];const[e,r]=X_(t),n=[Oh(e[0],e[1]),Oh(e[0],r[1]),Oh(r[0],e[1]),Oh(r[0],r[1])],l=[cn,cn,cn],u=[ln,ln,ln];for(const f of n)l[0]=Math.min(l[0],f[0]),l[1]=Math.min(l[1],f[1]),l[2]=Math.min(l[2],f[2]),u[0]=Math.max(u[0],f[0]),u[1]=Math.max(u[1],f[1]),u[2]=Math.max(u[2],f[2]);return new Xn(l,u)}function X_(t){const e=Math.pow(2,t.z),r=t.x/e,n=(t.x+1)/e,l=(t.y+1)/e;return[[On(t.y/e),Uo(r)],[On(l),Uo(n)]]}function Hf(t,e,r,n){return r=It(r),n||(n=Xf),[t*Math.sin(r)*n,-e*n,t*Math.cos(r)*n]}function Oh(t,e,r){return Hf(Math.cos(It(t)),Math.sin(It(t)),e,r)}function H_(t){return 16383/Math.max(...xn([],t.max,t.min))}function K_(t){const e=Ve(new Float64Array(16)),r=1/H_(t);return we(e,e,t.min),Le(e,e,[r,r,r]),e}function Y_(t,e,r){const n=e/(2*Math.PI),l=function(f){const g=Rt/(2*Math.PI);return f/(2*Math.PI)/g}(e);if(!r){const f=Vt(t.center.lat,-85.051129,vo);r=[il(t.center.lng)*e,rl(f)*e]}const u=Ve(new Float64Array(16));return we(u,u,[r[0],r[1],-n]),Le(u,u,[l,l,l]),qe(u,u,It(-t._center.lat)),xe(u,u,It(-t._center.lng)),u}class Kf{constructor(e){const r=this._createGridIndices();this.gridIndexBuffer=e.createIndexBuffer(r,!0),this.gridSegments=Xi.simpleSegment(0,0,4225,8192);const n=this._createPoleTriangleIndices();this.poleIndexBuffer=e.createIndexBuffer(n,!0),this.poleSegments=Xi.simpleSegment(0,0,66,64);const l=new gc;l.emplaceBack(-1,1,1,0,0,0,0),l.emplaceBack(1,1,1,0,0,1,0),l.emplaceBack(1,-1,1,0,0,1,1),l.emplaceBack(-1,-1,1,0,0,0,1);const u=new An;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.atmosphereVertexBuffer=e.createVertexBuffer(l,i1.members),this.atmosphereIndexBuffer=e.createIndexBuffer(u),this.atmosphereSegments=Xi.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(e,r,n){const l=new gc,u=r/Math.PI/2;l.emplaceBack(0,-u,0,0,0,.5,n?0:1);const f=360/e,g=Math.cos(It(85)),v=Math.sin(It(85));for(let A=0;A<=64;A++){const C=A/64,I=Hf(g,v,0*(1-(w=C))+f*w,u);l.emplaceBack(I[0],I[1],I[2],0,0,C,n?0:1)}var w;return l}_createPoleTriangleIndices(){const e=new An;for(let r=0;r<=64;r++)e.emplaceBack(0,r+1,r+2);return e}static createGridVertices(e){const r=Math.pow(2,e.z),n=(v,w,A)=>v*(1-A)+w*A,[l,u]=X_(e),f=new gc,g=function(v){const w=Ve(new Float64Array(16)),A=H_(v);var C,I;return Le(w,w,[A,A,A]),we(w,w,((C=[])[0]=-(I=v.min)[0],C[1]=-I[1],C[2]=-I[2],C)),w}(Bh(e));f.reserve(4096);for(let v=0;v<65;v++){const w=n(l[0],u[0],v/64),A=rl(w),C=A*r-e.y,I=Math.sin(It(w)),L=Math.cos(It(w));for(let B=0;B<65;B++){const V=B/64,q=n(l[1],u[1],V),Q=Hf(L,I,q);Tt(Q,Q,g);const oe=il(q);f.emplaceBack(Q[0],Q[1],Q[2],oe,A,V,C)}}return f}_createGridIndices(){const e=new An,r=(n,l)=>{const u=65*l+n;e.emplaceBack(u+1,u,u+65),e.emplaceBack(u+65,u+65+1,u+1)};for(let n=0;n<64;n++)for(let l=0;l<64;l++)r(l,n);return e}getWirefameBuffer(e){if(!this.wireframeSegments){const r=this._createWireframeGrid();this.wireframeIndexBuffer=e.createIndexBuffer(r),this.wireframeSegments=Xi.simpleSegment(0,0,4096,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const e=new ca,r=(n,l)=>{const u=65*l+n;e.emplaceBack(u,u+1),e.emplaceBack(u,u+65),e.emplaceBack(u,u+65+1)};for(let n=0;n<64;n++)for(let l=0;l<64;l++)r(l,n);return e}}function ml(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const r=Math.pow(2,-t.z),n=t.x*r,l=(t.x+1)*r,u=t.y*r,f=(t.y+1)*r,g=Uo(n),v=Uo(l),w=On(u),A=On(f),C=e.project(g,w),I=e.project(v,w),L=e.project(v,A),B=e.project(g,A);let V=Math.min(C.x,I.x,L.x,B.x),q=Math.min(C.y,I.y,L.y,B.y),Q=Math.max(C.x,I.x,L.x,B.x),oe=Math.max(C.y,I.y,L.y,B.y);const ce=r/16;function de(me,ke,Ce,He,Ge,Me){const Ze=(Ce+Ge)/2,Ke=(He+Me)/2,De=e.project(Uo(Ze),On(Ke)),tt=Math.max(0,V-De.x,q-De.y,De.x-Q,De.y-oe);V=Math.min(V,De.x),Q=Math.max(Q,De.x),q=Math.min(q,De.y),oe=Math.max(oe,De.y),tt>ce&&(de(me,De,Ce,He,Ze,Ke),de(De,ke,Ze,Ke,Ge,Me))}de(C,I,n,u,l,u),de(I,L,l,u,l,f),de(L,B,l,f,n,f),de(B,C,n,f,n,u),V-=ce,q-=ce,Q+=ce,oe+=ce;const pe=1/Math.max(Q-V,oe-q);return{scale:pe,x:V*pe,y:q*pe,x2:Q*pe,y2:oe*pe,projection:e}}class J_{constructor(e){const r={},n=[];for(const g in e){const v=e[g],w=r[g]={};for(const A in v.glyphs){const C=v.glyphs[+A];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const I=C.metrics.localGlyph?2:1,L={x:0,y:0,w:C.bitmap.width+2*I,h:C.bitmap.height+2*I};n.push(L),w[A]=L}}const{w:l,h:u}=Af(n),f=new ha({width:l||1,height:u||1});for(const g in e){const v=e[g];for(const w in v.glyphs){const A=v.glyphs[+w];if(!A||A.bitmap.width===0||A.bitmap.height===0)continue;const C=r[g][w],I=A.metrics.localGlyph?2:1;ha.copy(A.bitmap,f,{x:0,y:0},{x:C.x+I,y:C.y+I},A.bitmap)}}this.image=f,this.positions=r}}it("GlyphAtlas",J_);class n1{constructor(e){this.tileID=new Gr(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=ml(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,n,l,u){this.status="parsing",this.data=e,this.collisionBoxArray=new of;const f=new z_(Object.keys(e.layers).sort()),g=new $_(this.tileID,this.promoteId);g.bucketLayerIDs=[];const v={},w=new Nf(256,256),A={featureIndex:g,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:n},C=r.familiesBySource[this.source];for(const pe in C){const me=e.layers[pe];if(!me)continue;let ke=!1,Ce=!1;for(const Me of C[pe])Me[0].type==="symbol"?ke=!0:Ce=!0;if(this.isSymbolTile===!0&&!ke||this.isSymbolTile===!1&&!Ce)continue;me.version===1&&Je(`Vector tile source "${this.source}" layer "${pe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const He=f.encode(pe),Ge=[];for(let Me=0;Me<me.length;Me++){const Ze=me.feature(Me),Ke=g.getId(Ze,pe);Ge.push({feature:Ze,id:Ke,index:Me,sourceLayerIndex:He})}for(const Me of C[pe]){const Ze=Me[0];this.isSymbolTile!==void 0&&Ze.type==="symbol"!==this.isSymbolTile||Ze.minzoom&&this.zoom<Math.floor(Ze.minzoom)||Ze.maxzoom&&this.zoom>=Ze.maxzoom||Ze.visibility!=="none"&&(Yf(Me,this.zoom,n),(v[Ze.id]=Ze.createBucket({index:g.bucketLayerIDs.length,layers:Me,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:He,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:n})).populate(Ge,A,this.tileID.canonical,this.tileTransform),g.bucketLayerIDs.push(Me.map(Ke=>Ke.id)))}}let I,L,B,V;w.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Q=Fr(A.glyphDependencies,pe=>Object.keys(pe).map(Number));Object.keys(Q).length?l.send("getGlyphs",{uid:this.uid,stacks:Q},(pe,me)=>{I||(I=pe,L=me,de.call(this))},void 0,!1,q):L={};const oe=Object.keys(A.iconDependencies);oe.length?l.send("getImages",{icons:oe,source:this.source,tileID:this.tileID,type:"icons"},(pe,me)=>{I||(I=pe,B=me,de.call(this))},void 0,!1,q):B={};const ce=Object.keys(A.patternDependencies);function de(){if(I)return u(I);if(L&&B&&V){const pe=new J_(L),me=new n_(B,V);for(const ke in v){const Ce=v[ke];Ce instanceof pa?(Yf(Ce.layers,this.zoom,n),B0(Ce,L,pe.positions,B,me.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection),Ce.projection=this.projection.name):Ce.hasPattern&&(Ce instanceof xh||Ce instanceof vh||Ce instanceof Tf)&&(Yf(Ce.layers,this.zoom,n),Ce.addFeatures(A,this.tileID.canonical,me.patternPositions,n))}this.status="done",u(null,{buckets:mr(v).filter(ke=>!ke.isEmpty()),featureIndex:g,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pe.image,lineAtlas:w,imageAtlas:me,glyphMap:this.returnDependencies?L:null,iconMap:this.returnDependencies?B:null,glyphPositions:this.returnDependencies?pe.positions:null})}}ce.length?l.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"patterns"},(pe,me)=>{I||(I=pe,V=me,de.call(this))},void 0,!1,q):V={},de.call(this)}}function Yf(t,e,r){const n=new bt(e);for(const l of t)l.recalculate(n,r)}class Q_{constructor(e){this.entries={},this.scheduler=e}request(e,r,n,l){const u=this.entries[e]=this.entries[e]||{callbacks:[]};if(u.result){const[f,g]=u.result;return this.scheduler?this.scheduler.add(()=>{l(f,g)},r):l(f,g),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=n((f,g)=>{u.result=[f,g];for(const v of u.callbacks)this.scheduler?this.scheduler.add(()=>{v(f,g)},r):v(f,g);setTimeout(()=>delete this.entries[e],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(f=>f!==l),u.callbacks.length||(u.cancel(),delete this.entries[e]))}}}function eg(t,e,r){const n=JSON.stringify(t.request);return t.data&&(this.deduped.entries[n]={result:[null,t.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},l=>{const u=Aa(t.request,(f,g,v,w)=>{f?l(f):g&&l(null,{vectorTile:r?void 0:new is.VectorTile(new Cc(g)),rawData:g,cacheControl:v,expires:w})});return()=>{u.cancel(),l()}},e)}const o1=Ve(new Float64Array(16));class os{constructor(e,r){this._tr=e,this._worldSize=r}createInversionMatrix(){return o1}createTileMatrix(e){let r,n,l;const u=e.canonical,f=Ve(new Float64Array(16)),g=this._tr.projection;if(g.isReprojectedInTileSpace){const v=ml(u,g);r=1,n=v.x+e.wrap*v.scale,l=v.y,Le(f,f,[r/v.scale,r/v.scale,this._tr.pixelsPerMeter/this._worldSize])}else r=this._worldSize/this._tr.zoomScale(u.z),n=(u.x+Math.pow(2,u.z)*e.wrap)*r,l=u.y*r;return we(f,f,[n,l,0]),Le(f,f,[r/Rt,r/Rt,1]),f}pointCoordinate(e,r,n){const l=this._tr.horizonLineFromTop(!1),u=new $(e,Math.max(l,r));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(u,n))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var a1={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&ro(this.parallels,this.constants.parallels))return;const t=Math.sin(It(this.parallels[0])),e=(t+Math.sin(It(this.parallels[1])))/2,r=1+t*(2*e-t),n=Math.sqrt(r)/e;this.constants={n:e,c:r,r0:n,parallels:this.parallels}},project(t,e){this.initializeConstants();const r=It(t-this.center[0]),n=It(e),{n:l,c:u,r0:f}=this.constants,g=Math.sqrt(u-2*l*Math.sin(n))/l;return{x:g*Math.sin(r*l),y:g*Math.cos(r*l)-f,z:0}},unproject(t,e){this.initializeConstants();const{n:r,c:n,r0:l}=this.constants,u=l+e;let f=Math.atan2(t,Math.abs(u))*Math.sign(u);u*r<0&&(f-=Math.PI*Math.sign(t)*Math.sign(u));const g=It(this.center[0])*r;f=vr(f,-Math.PI-g,Math.PI-g);const v=ji(f/r)+this.center[0],w=Math.asin(Vt((n-(t*t+u*u)*r*r)/(2*r),-1,1)),A=Vt(ji(w),-85.051129,vo);return new mi(v,A)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Wn(1,t)*e,farthestPixelDistance(t){return ns(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new os(t,e)};const zc=1.340264,Pc=-.081106,Dc=893e-6,Lc=.003796,Fh=Math.sqrt(3)/2;var s1={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const r=Math.asin(Fh*Math.sin(e)),n=r*r,l=n*n*n;return{x:.5*(t*Math.cos(r)/(Fh*(zc+3*Pc*n+l*(7*Dc+9*Lc*n)))/Math.PI+.5),y:1-.5*(r*(zc+Pc*n+l*(Dc+Lc*n))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,n=r*r,l=n*n*n;for(let w,A,C,I=0;I<12&&(A=r*(zc+Pc*n+l*(Dc+Lc*n))-e,C=zc+3*Pc*n+l*(7*Dc+9*Lc*n),w=A/C,r=Vt(r-w,-Math.PI/3,Math.PI/3),n=r*r,l=n*n*n,!(Math.abs(w)<1e-12));++I);const u=Fh*t*(zc+3*Pc*n+l*(7*Dc+9*Lc*n))/Math.cos(r),f=Math.asin(Math.sin(r)/Fh),g=Vt(180*u/Math.PI,-180,180),v=Vt(180*f/Math.PI,-85.051129,vo);return new mi(g,v)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Wn(1,t)*e,farthestPixelDistance(t){return ns(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new os(t,e)},l1={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(t,e)=>({x:.5+t/360,y:.5-e/360,z:0}),unproject(t,e){const r=360*(t-.5),n=Vt(360*(.5-e),-85.051129,vo);return new mi(r,n)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Wn(1,t)*e,farthestPixelDistance(t){return ns(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new os(t,e)};const _l=Math.PI/2;function Uh(t){return Math.tan((_l+t)/2)}var c1={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&ro(this.parallels,this.constants.parallels))return;const t=It(this.parallels[0]),e=It(this.parallels[1]),r=Math.cos(t),n=t===e?Math.sin(t):Math.log(r/Math.cos(e))/Math.log(Uh(e)/Uh(t)),l=r*Math.pow(Uh(t),n)/n;this.constants={n,f:l,parallels:this.parallels}},project(t,e){this.initializeConstants(),e=It(e),t=It(t-this.center[0]);const r=1e-6,{n,f:l}=this.constants;l>0?e<-_l+r&&(e=-_l+r):e>_l-r&&(e=_l-r);const u=l/Math.pow(Uh(e),n),f=u*Math.sin(n*t),g=l-u*Math.cos(n*t);return{x:.5*(f/Math.PI+.5),y:1-.5*(g/Math.PI+.5),z:0}},unproject(t,e){this.initializeConstants(),t=(2*t-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:r,f:n}=this.constants,l=n-e,u=Math.sign(l),f=Math.sign(r)*Math.sqrt(t*t+l*l);let g=Math.atan2(t,Math.abs(l))*u;l*r<0&&(g-=Math.PI*Math.sign(t)*u);const v=Vt(ji(g/r)+this.center[0],-180,180),w=Vt(ji(2*Math.atan(Math.pow(n/f,1/r))-_l),-85.051129,vo);return new mi(v,w)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Wn(1,t)*e,farthestPixelDistance(t){return ns(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new os(t,e)},u1={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(t,e)=>({x:il(t),y:rl(e),z:0}),unproject(t,e){const r=Uo(t),n=On(e);return new mi(r,n)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Wn(1,t)*e,farthestPixelDistance(t){return ns(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new os(t,e)};const tg=It(vo);var h1={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(t,e){const r=(e=It(e))*e,n=r*r;return{x:.5*((t=It(t))*(.8707-.131979*r+n*(n*(.003971*r-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+r*(.015085+n*(.028874*r-.044475-.005916*n)))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,n=25,l=0,u=r*r;do{u=r*r;const v=u*u;l=(r*(1.007226+u*(.015085+v*(.028874*u-.044475-.005916*v)))-e)/(1.007226+u*(.045255+v*(.259866*u-.311325-.005916*11*v))),r=Vt(r-l,-tg,tg)}while(Math.abs(l)>1e-6&&--n>0);u=r*r;const f=Vt(ji(t/(.8707+u*(u*(u*u*u*(.003971-.001529*u)-.013791)-.131979))),-180,180),g=ji(r);return new mi(f,g)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Wn(1,t)*e,farthestPixelDistance(t){return ns(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new os(t,e)};const ig=It(vo),rg={albers:a1,equalEarth:s1,equirectangular:l1,lambertConformalConic:c1,mercator:u1,naturalEarth:h1,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=It(e),t=It(t);const r=Math.cos(e),n=2/Math.PI,l=Math.acos(r*Math.cos(t/2)),u=Math.sin(l)/l,f=.5*(t*n+2*r*Math.sin(t/2)/u)||0,g=.5*(e+Math.sin(e)/u)||0;return{x:.5*(f/Math.PI+.5),y:1-.5*(g/Math.PI+1),z:0}},unproject(t,e){let r=t=(2*t-.5)*Math.PI,n=e=(2*(1-e)-1)*Math.PI,l=25;const u=1e-6;let f=0,g=0;do{const v=Math.cos(n),w=Math.sin(n),A=2*w*v,C=w*w,I=v*v,L=Math.cos(r/2),B=Math.sin(r/2),V=2*L*B,q=B*B,Q=1-I*L*L,oe=Q?1/Q:0,ce=Q?Math.acos(v*L)*Math.sqrt(1/Q):0,de=.5*(2*ce*v*B+2*r/Math.PI)-t,pe=.5*(ce*w+n)-e,me=.5*oe*(I*q+ce*v*L*C)+1/Math.PI,ke=oe*(V*A/4-ce*w*B),Ce=.125*oe*(A*B-ce*w*I*V),He=.5*oe*(C*L+ce*q*v)+.5,Ge=ke*Ce-He*me;f=(pe*ke-de*He)/Ge,g=(de*Ce-pe*me)/Ge,r=Vt(r-f,-Math.PI,Math.PI),n=Vt(n-g,-ig,ig)}while((Math.abs(f)>u||Math.abs(g)>u)&&--l>0);return new mi(ji(r),ji(n))},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Wn(1,t)*e,farthestPixelDistance(t){return ns(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new os(t,e)}};o.ARRAY_TYPE=Te,o.AUTH_ERR_MSG=_e,o.Aabb=Xn,o.Actor=class{constructor(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},no(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Dt()?t:G,this.scheduler=new K0}send(t,e,r,n,l=!1,u){const f=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=u,this.callbacks[f]=r);const g=Ri(this.globalScope)?void 0:[];return this.target.postMessage({id:f,type:t,hasCallback:!!r,targetMapId:n,mustQueue:l,sourceMapId:this.mapId,data:Ya(e,g)},g),{cancel:()=>{r&&delete this.callbacks[f],this.target.postMessage({id:f,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(t){const e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const n=this.cancelCallbacks[r];delete this.cancelCallbacks[r],n&&n.cancel()}else if(e.mustQueue||Dt()){const n=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),n&&n.metadata||{type:"message"})}else this.processTask(r,e)}processTask(t,e){if(e.type==="<response>"){const r=this.callbacks[t];delete this.callbacks[t],r&&(e.error?r(go(e.error)):r(null,go(e.data)))}else{const r=Ri(this.globalScope)?void 0:[],n=e.hasCallback?(u,f)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:u?Ya(u):null,data:Ya(f,r)},r)}:u=>{},l=go(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,l,n);else if(this.parent.getWorkerSource){const u=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,u[0],l.source)[u[1]](l,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=Ph,o.Color=Xt,o.ColorMode=bo,o.CullFaceMode=Hn,o.DEMData=Dh,o.DataConstantProperty=nt,o.DedupedRequest=Q_,o.DepthMode=pl,o.EXTENT=Rt,o.Elevation=class{getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,r=!0){e==null&&(e=null);const n=this._source();if(!n||t.y<0||t.y>1)return e;const l=n.getSource().maxzoom,u=1<<l,f=Math.floor(t.x),g=t.x-f,v=new Gr(l,f,l,Math.floor(g*u),Math.floor(t.y*u)),w=this.findDEMTileFor(v);if(!w||!w.dem)return e;const A=w.dem,C=1<<w.tileID.canonical.z,I=(g*C-w.tileID.canonical.x)*A.dim,L=(t.y*C-w.tileID.canonical.y)*A.dim,B=Math.floor(I),V=Math.floor(L);return(r?this.exaggeration():1)*ni(ni(A.get(B,V),A.get(B,V+1),L-V),ni(A.get(B+1,V),A.get(B+1,V+1),L-V),I-B)}getAtTileOffset(t,e,r){const n=1<<t.canonical.z;return this.getAtPointOrZero(new hh(t.wrap+(t.canonical.x+e/Rt)/n,(t.canonical.y+r/Rt)/n))}getAtTileOffsetFunc(t,e){return r=>{const n=this.getAtTileOffset(t,r.x,r.y),l=e.upVector(t.canonical,r.x,r.y);return Ni(l,l,n*e.upVectorScale(t.canonical)),l}}getForTilePoints(t,e,r,n){const l=Lh.create(this,t,n);return!!l&&(e.forEach(u=>{u[2]=this.exaggeration()*l.getElevationAt(u[0],u[1],r)}),!0)}getMinMaxForTile(t){const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const r=e.dem.tree,n=e.tileID,l=1<<t.canonical.z-n.canonical.z;let u=t.canonical.x/l-n.canonical.x,f=t.canonical.y/l-n.canonical.y,g=0;for(let v=0;v<t.canonical.z-n.canonical.z&&!r.leaves[g];v++){u*=2,f*=2;const w=2*Math.floor(f)+Math.floor(u);g=r.childOffsets[g]+w,u%=1,f%=1}return{min:this.exaggeration()*r.minimums[g],max:this.exaggeration()*r.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=xs,o.EvaluationParameters=bt,o.Event=ao,o.Evented=so,o.Frustum=ff,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GlobeSharedBuffers=Kf,o.GlyphManager=dl,o.ImagePosition=Cf,o.LineAtlas=Nf,o.LngLat=mi,o.LngLatBounds=es,o.LocalGlyphMode=zf,o.MAX_MERCATOR_LATITUDE=vo,o.MercatorCoordinate=hh,o.ONE_EM=gr,o.OverscaledTileID=Gr,o.Properties=hr,o.RGBAImage=Cn,o.Ray=class{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,r){const n=fi(e,this.dir);if(Math.abs(n)<1e-6)return!1;const l=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1]+(t[2]-this.pos[2])*e[2])/n;return r[0]=this.pos[0]+this.dir[0]*l,r[1]=this.pos[1]+this.dir[1]*l,r[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(t,e,r){if(function(I,L){var B=I[0],V=I[1],q=I[2],Q=L[0],oe=L[1],ce=L[2];return Math.abs(B-Q)<=ye*Math.max(1,Math.abs(B),Math.abs(Q))&&Math.abs(V-oe)<=ye*Math.max(1,Math.abs(V),Math.abs(oe))&&Math.abs(q-ce)<=ye*Math.max(1,Math.abs(q),Math.abs(ce))}(this.pos,t)||e===0)return r[0]=r[1]=r[2]=0,!1;const[n,l,u]=this.dir,f=this.pos[0]-t[0],g=this.pos[1]-t[1],v=this.pos[2]-t[2],w=n*n+l*l+u*u,A=2*(f*n+g*l+v*u),C=A*A-4*w*(f*f+g*g+v*v-e*e);if(C<0){const I=Math.max(-A/2,0),L=f+n*I,B=g+l*I,V=v+u*I,q=Math.hypot(L,B,V);return r[0]=L*e/q,r[1]=B*e/q,r[2]=V*e/q,!1}{const I=(-A-Math.sqrt(C))/(2*w);if(I<0){const L=Math.hypot(f,g,v);return r[0]=f*e/L,r[1]=g*e/L,r[2]=v*e/L,!1}return r[0]=f+n*I,r[1]=g+l*I,r[2]=v+u*I,!0}}},o.RequestManager=class{constructor(t,e,r){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ue,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Ie(t))return t;const r=lt(t);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Ie(t))return t;const r=lt(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(t,e){if(!Ie(t))return t;const r=lt(t);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)}normalizeSpriteURL(t,e,r,n){const l=lt(t);return Ie(t)?(l.path=`/styles/v1${l.path}/sprite${e}${r}`,this._makeAPIURL(l,this._customAccessToken||n)):(l.path+=`${e}${r}`,ut(l))}normalizeTileURL(t,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ie(t))return t;const n=lt(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&n.authority!=="raster"&&r===512?"@2x":""}${O.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${D.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${D.TILE_URL_VERSION}${n.path}`);const l=this._customAccessToken||function(u){for(const f of u){const g=f.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(n.params)||D.ACCESS_TOKEN;return D.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,l)}canonicalizeTileURL(t,e){const r=lt(t);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${D.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${D.TILE_URL_VERSION}/`,"")}`;let l=r.params;return e&&(l=l.filter(u=>!u.match(/^access_token=/))),l.length&&(n+=`?${l.join("&")}`),n}canonicalizeTileset(t,e){const r=!!e&&Ie(e),n=[];for(const l of t.tiles||[])Pe(l)?n.push(this.canonicalizeTileURL(l,r)):n.push(l);return n}_makeAPIURL(t,e){const r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=lt(D.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,t.protocol==="http"){const l=t.params.indexOf("secure");l>=0&&t.params.splice(l,1)}if(n.path!=="/"&&(t.path=`${n.path}${t.path}`),!D.REQUIRE_ACCESS_TOKEN)return ut(t);if(e=e||D.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter(l=>l.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),ut(t)}},o.ResourceType=ys,o.SegmentVector=Xi,o.SourceCache=rs,o.StencilMode=$f,o.StructArrayLayout1ui2=oh,o.StructArrayLayout2f1f2i16=Yd,o.StructArrayLayout2i4=Js,o.StructArrayLayout2ui4=ca,o.StructArrayLayout3f12=el,o.StructArrayLayout3ui6=An,o.StructArrayLayout4i8=Qs,o.Texture=zh,o.Tile=Wf,o.Transitionable=Vr,o.Uniform1f=ch,o.Uniform1i=class extends Bo{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},o.Uniform2f=class extends Bo{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},o.Uniform3f=class extends Bo{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},o.Uniform4f=ym,o.UniformColor=vm,o.UniformMatrix2f=class extends Bo{constructor(t,e){super(t,e),this.current=ix}set(t){for(let e=0;e<4;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}},o.UniformMatrix3f=class extends Bo{constructor(t,e){super(t,e),this.current=tx}set(t){for(let e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},o.UniformMatrix4f=class extends Bo{constructor(t,e){super(t,e),this.current=ex}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},o.UnwrappedTileID=jf,o.ValidationError=et,o.VectorTileWorkerSource=class extends so{constructor(t,e,r,n,l){super(),this.actor=t,this.layerIndex=e,this.availableImages=r,this.loadVectorData=l||eg,this.loading={},this.loaded={},this.deduped=new Q_(t.scheduler),this.isSpriteLoaded=n,this.scheduler=t.scheduler}loadTile(t,e){const r=t.uid,n=t&&t.request,l=n&&n.collectResourceTiming,u=this.loading[r]=new n1(t);u.abort=this.loadVectorData(t,(f,g)=>{const v=!this.loading[r];if(delete this.loading[r],v||f||!g)return u.status="done",v||(this.loaded[r]=u),e(f);const w=g.rawData,A={};g.expires&&(A.expires=g.expires),g.cacheControl&&(A.cacheControl=g.cacheControl),u.vectorTile=g.vectorTile||new is.VectorTile(new Cc(w));const C=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(I,L)=>{if(I||!L)return e(I);const B={};if(l){const V=M_(n);V.length>0&&(B.resourceTiming=JSON.parse(JSON.stringify(V)))}e(null,Wt({rawTileData:w.slice(0)},L,A,B))})};this.isSpriteLoaded?C():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(C,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):C()}),this.loaded=this.loaded||{},this.loaded[r]=u})}reloadTile(t,e){const r=this.loaded,n=t.uid,l=this;if(r&&r[n]){const u=r[n];u.showCollisionBoxes=t.showCollisionBoxes,u.enableTerrain=!!t.enableTerrain,u.projection=t.projection;const f=(g,v)=>{const w=u.reloadCallback;w&&(delete u.reloadCallback,u.parse(u.vectorTile,l.layerIndex,this.availableImages,l.actor,w)),e(g,v)};u.status==="parsing"?u.reloadCallback=f:u.status==="done"&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,f):f())}}abortTile(t,e){const r=t.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),e()}removeTile(t,e){const r=this.loaded,n=t.uid;r&&r[n]&&delete r[n],e()}},o.WritingMode=In,o.ZoomHistory=h,o.add=wt,o.addDynamicAttributes=Rf,o.adjoint=function(t,e){var r=e[0],n=e[1],l=e[2],u=e[3],f=e[4],g=e[5],v=e[6],w=e[7],A=e[8];return t[0]=f*A-g*w,t[1]=l*w-n*A,t[2]=n*g-l*f,t[3]=g*v-u*A,t[4]=r*A-l*v,t[5]=l*u-r*g,t[6]=u*w-f*v,t[7]=n*v-r*w,t[8]=r*f-n*u,t},o.asyncAll=Qr,o.bezier=Jr,o.bindAll=no,o.boundsAttributes=qf,o.bufferConvexPolygon=function(t,e){const r=[];for(let n=0;n<t.length;n++){const l=vr(n-1,-1,t.length-1),u=vr(n+1,-1,t.length-1),f=t[n],g=t[u],v=t[l].sub(f).unit(),w=g.sub(f).unit(),A=w.angleWithSep(v.x,v.y),C=v.add(w).unit().mult(-1*e/Math.sin(A/2));r.push(f.add(C))}return r},o.cacheEntryPossiblyAdded=function(t){gs++,gs>Ul&&(t.getActor().send("enforceCacheSizeLimit",gu),gs=0)},o.calculateGlobeMatrix=Y_,o.calculateGlobeMercatorMatrix=function(t){const e=t.worldSize,r=Vt(t.center.lat,-85.051129,vo),n=new $(il(t.center.lng)*e,rl(r)*e),l=Wn(1,t.center.lat)*e,u=t.pixelsPerMeter,f=e/(l/t.pixelsPerMeter),g=Ve(new Float64Array(16));return we(g,g,[n.x,n.y,0]),Le(g,g,[f,f,u]),g},o.clamp=Vt,o.clearTileCache=function(t){const e=G.caches.delete(Vi);t&&e.catch(t).then(()=>t())},o.clipLine=__,o.clone=function(t){var e=new Te(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},o.clone$1=je,o.collisionCircleLayout=l0,o.config=D,o.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},o.create=function(){var t=new Te(16);return Te!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},o.create$1=Ue,o.createExpression=Ga,o.createLayout=Oi,o.createStyleLayer=function(t){return t.type==="custom"?new Z0(t):new W0[t.type](t)},o.cross=Li,o.degToRad=It,o.div=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},o.dot=fi,o.ease=kn,o.easeCubicInOut=Yr,o.emitValidationErrors=eh,o.endsWith=xr,o.enforceCacheSizeLimit=function(t){Sa(),Nr&&Nr.then(e=>{e.keys().then(r=>{for(let n=0;n<r.length-t;n++)e.delete(r[n])})})},o.evaluateSizeForFeature=bh,o.evaluateSizeForZoom=ll,o.evaluateVariableOffset=b_,o.evented=kr,o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},o.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},o.exported=zi,o.exported$1=O,o.extend=Wt,o.extend$1=lo,o.filterObject=oo,o.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},o.fromQuat=function(t,e){var r=e[0],n=e[1],l=e[2],u=e[3],f=r+r,g=n+n,v=l+l,w=r*f,A=n*f,C=n*g,I=l*f,L=l*g,B=l*v,V=u*f,q=u*g,Q=u*v;return t[0]=1-C-B,t[1]=A+Q,t[2]=I-q,t[3]=0,t[4]=A-Q,t[5]=1-w-B,t[6]=L+V,t[7]=0,t[8]=I+q,t[9]=L-V,t[10]=1-w-C,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return Ar[e]},o.getAABBPointSquareDist=function(t,e,r){let n=0;for(let l=0;l<2;++l){const u=r?r[l]:0;t[l]>u&&(n+=(t[l]-u)*(t[l]-u)),e[l]<u&&(n+=(u-e[l])*(u-e[l]))}return n},o.getAnchorAlignment=kf,o.getAnchorJustification=Df,o.getBounds=function(t){let e=1/0,r=1/0,n=-1/0,l=-1/0;for(const u of t)e=Math.min(e,u.x),r=Math.min(r,u.y),n=Math.max(n,u.x),l=Math.max(l,u.y);return{min:new $(e,r),max:new $(n,l)}},o.getColumn=function(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]},o.getImage=vu,o.getJSON=function(t,e){return bn(Wt(t,{type:"json"}),e)},o.getMapSessionAPI=en,o.getPerformanceMeasurement=M_,o.getProjection=function(t){const e=rg[t.name];if(!e)throw new Error(`Invalid projection name: ${t.name}`);return e.conic?function(r,n){if(n.parallels&&Math.abs(n.parallels[0]+n.parallels[1])<.01){let l=function(u){const f=Math.max(.01,Math.cos(It(u))),g=1/(2*Math.max(Math.PI*f,1/f));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(v,w){const A=It(v)*f,C=Math.sin(It(w))/f;return{x:A*g+.5,y:-C*g+.5,z:0}},unproject(v,w){const A=-(w-.5)/g,C=Vt(ji((v-.5)/g)/f,-180,180),I=Math.asin(Vt(A*f,-1,1)),L=Vt(ji(I),-85.051129,vo);return new mi(C,L)}}}(n.parallels[0]);if(n.name==="lambertConformalConic"){const{project:u,unproject:f}=rg.mercator;l={wrap:!0,supportsWorldCopies:!0,project:u,unproject:f}}return Wt({},r,n,l)}return Wt({},r,n)}(e,t):e},o.getRTLTextPluginStatus=sn,o.getReferrer=jl,o.getTilePoint=function(t,{x:e,y:r},n=0){return new $(((e-n)*t.scale-t.x)*Rt,(r*t.scale-t.y)*Rt)},o.getTileVec3=function(t,e,r=0){return st(((e.x-r)*t.scale-t.x)*Rt,(e.y*t.scale-t.y)*Rt,Sm(e.z,e.y))},o.getVideo=function(t,e){const r=G.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let n=0;n<t.length;n++){const l=G.document.createElement("source");yu(t[n])||(r.crossOrigin="Anonymous"),l.src=t[n],r.appendChild(l)}return{cancel:()=>{}}},o.globeBuffersForTileMesh=function(t,e,r,n){const l=t.context,u=t.transform;let f=e.globeGridBuffer,g=e.globePoleBuffer;if(!f){const v=Kf.createGridVertices(r.canonical);f=e.globeGridBuffer=l.createVertexBuffer(v,W_,!1)}if(!g){const v=Kf.createPoleTriangleVertices(n,u.tileSize*n,r.canonical.y===0);g=e.globePoleBuffer=l.createVertexBuffer(v,W_,!1)}return[f,g]},o.globeDenormalizeECEF=K_,o.globeMatrixForTile=function(t,e){const r=K_(Bh(t)),n=((l=new Float64Array(16))[0]=(u=e)[0],l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=u[6],l[7]=u[7],l[8]=u[8],l[9]=u[9],l[10]=u[10],l[11]=u[11],l[12]=u[12],l[13]=u[13],l[14]=u[14],l[15]=u[15],l);var l,u;return Se(n,n,r),n},o.globePoleMatrixForTile=function(t,e,r){const n=Ve(new Float64Array(16)),l=Math.pow(2,t.z),u=(t.x-l/2)/l*Math.PI*2,f=r.point,g=r.worldSize/(r.tileSize*l);return we(n,n,[f.x,f.y,-r.worldSize/Math.PI/2]),Le(n,n,[g,g,g]),qe(n,n,It(-r._center.lat)),xe(n,n,It(-r._center.lng)),xe(n,n,u),e&&Le(n,n,[1,-1,1]),n},o.globeTileBounds=Bh,o.globeToMercatorTransition=function(t){return Cr(5,6,t)},o.identity=Ve,o.identity$1=Io,o.invert=function(t,e){var r=e[0],n=e[1],l=e[2],u=e[3],f=e[4],g=e[5],v=e[6],w=e[7],A=e[8],C=e[9],I=e[10],L=e[11],B=e[12],V=e[13],q=e[14],Q=e[15],oe=r*g-n*f,ce=r*v-l*f,de=r*w-u*f,pe=n*v-l*g,me=n*w-u*g,ke=l*w-u*v,Ce=A*V-C*B,He=A*q-I*B,Ge=A*Q-L*B,Me=C*q-I*V,Ze=C*Q-L*V,Ke=I*Q-L*q,De=oe*Ke-ce*Ze+de*Me+pe*Ge-me*He+ke*Ce;return De?(t[0]=(g*Ke-v*Ze+w*Me)*(De=1/De),t[1]=(l*Ze-n*Ke-u*Me)*De,t[2]=(V*ke-q*me+Q*pe)*De,t[3]=(I*me-C*ke-L*pe)*De,t[4]=(v*Ge-f*Ke-w*He)*De,t[5]=(r*Ke-l*Ge+u*He)*De,t[6]=(q*de-B*ke-Q*ce)*De,t[7]=(A*ke-I*de+L*ce)*De,t[8]=(f*Ze-g*Ge+w*Ce)*De,t[9]=(n*Ge-r*Ze-u*Ce)*De,t[10]=(B*me-V*de+Q*oe)*De,t[11]=(C*de-A*me-L*oe)*De,t[12]=(g*He-f*Me-v*Ce)*De,t[13]=(r*Me-n*He+l*Ce)*De,t[14]=(V*ce-B*pe-q*oe)*De,t[15]=(A*pe-C*ce+I*oe)*De,t):null},o.isMapAuthenticated=function(t){return tn.has(t)},o.isMapboxURL=Ie,o.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Ri(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=On,o.len=Mn,o.length=rt,o.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},o.loadVectorTile=eg,o.makeRequest=bn,o.mercatorXfromLng=il,o.mercatorYfromLat=rl,o.mercatorZfromAltitude=Wn,o.mul=Se,o.mul$1=Co,o.multiply=function(t,e,r){var n=e[0],l=e[1],u=e[2],f=e[3],g=e[4],v=e[5],w=e[6],A=e[7],C=e[8],I=r[0],L=r[1],B=r[2],V=r[3],q=r[4],Q=r[5],oe=r[6],ce=r[7],de=r[8];return t[0]=I*n+L*f+B*w,t[1]=I*l+L*g+B*A,t[2]=I*u+L*v+B*C,t[3]=V*n+q*f+Q*w,t[4]=V*l+q*g+Q*A,t[5]=V*u+q*v+Q*C,t[6]=oe*n+ce*f+de*w,t[7]=oe*l+ce*g+de*A,t[8]=oe*u+ce*v+de*C,t},o.multiply$1=T,o.multiply$2=Si,o.nextPowerOfTwo=wi,o.normalize=Ct,o.normalize$1=function(t,e){var r=e[0],n=e[1],l=e[2],u=e[3],f=r*r+n*n+l*l+u*u;return f>0&&(f=1/Math.sqrt(f)),t[0]=r*f,t[1]=n*f,t[2]=l*f,t[3]=u*f,t},o.number=ni,o.ortho=function(t,e,r,n,l,u,f){var g=1/(e-r),v=1/(n-l),w=1/(u-f);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*v,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+r)*g,t[13]=(l+n)*v,t[14]=(f+u)*w,t[15]=1,t},o.pbf=Cc,o.perspective=function(t,e,r,n,l){var u,f=1/Math.tan(e/2);return t[0]=f/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=(l+n)*(u=1/(n-l)),t[14]=2*l*n*u):(t[10]=-1,t[14]=-2*n),t},o.pick=function(t,e){const r={};for(let n=0;n<e.length;n++){const l=e[n];l in t&&(r[l]=t[l])}return r},o.plugin=$t,o.pointGeometry=$,o.polygonIntersectsBox=km,o.polygonIntersectsPolygon=Am,o.polygonizeBounds=function(t,e,r=0,n=!0){const l=new $(r,r),u=t.sub(l),f=e.add(l),g=[u,new $(f.x,u.y),f,new $(u.x,f.y)];return n&&g.push(u),g},o.posAttributes=e1,o.postMapLoadEvent=oi,o.postTurnstileEvent=ri,o.potpack=Af,o.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.radToDeg=ji,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(t){return t({pluginStatus:yt,pluginURL:Lt}),kr.on("pluginStateChange",t),t},o.removeAuthState=function(t){tn.delete(t)},o.renderColorRamp=_f,o.rotateX=qe,o.rotateX$1=Mo,o.rotateY=xe,o.rotateZ=function(t,e,r){var n=Math.sin(r),l=Math.cos(r),u=e[0],f=e[1],g=e[2],v=e[3],w=e[4],A=e[5],C=e[6],I=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*l+w*n,t[1]=f*l+A*n,t[2]=g*l+C*n,t[3]=v*l+I*n,t[4]=w*l-u*n,t[5]=A*l-f*n,t[6]=C*l-g*n,t[7]=I*l-v*n,t},o.rotateZ$1=function(t,e,r){r*=.5;var n=e[0],l=e[1],u=e[2],f=e[3],g=Math.sin(r),v=Math.cos(r);return t[0]=n*v+l*g,t[1]=l*v-n*g,t[2]=u*v+f*g,t[3]=f*v-u*g,t},o.scale=Le,o.scale$1=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},o.scale$2=Ni,o.scaleAndAdd=qt,o.setCacheLimits=function(t,e){gu=t,Ul=e},o.setColumn=function(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},o.setRTLTextPlugin=function(t,e,r=!1){if(yt===ft||yt===xt||yt===ai)throw new Error("setRTLTextPlugin cannot be called multiple times.");Lt=zi.resolveURL(t),yt=ft,yi=e,Ji(),r||En()},o.smoothstep=Cr,o.spec=Ee,o.storeAuthState=function(t,e){e?tn.add(t):tn.delete(t)},o.sub=xn,o.subtract=di,o.symbolSize=c0,o.tileAABB=function(t,e,r,n,l,u,f,g,v){if(v.name==="globe"){const L=Bh(new jf(u,new Ph(r,n,l)).canonical).getCorners(),B=Number.MAX_VALUE,V=[-B,-B,-B],q=[B,B,B],Q=Y_(t,e);for(let oe=0;oe<L.length;oe++)Tt(L[oe],L[oe],Q),A=q,C=L[oe],(w=q)[0]=Math.min(A[0],C[0]),w[1]=Math.min(A[1],C[1]),w[2]=Math.min(A[2],C[2]),Nt(V,V,L[oe]);return new Xn(q,V)}var w,A,C;const I=ml({z:r,x:n,y:l},v);return new Xn([(u+I.x/I.scale)*e,e*(I.y/I.scale),f],[(u+I.x2/I.scale)*e,e*(I.y2/I.scale),g])},o.tileTransform=ml,o.transformMat3=function(t,e,r){var n=e[0],l=e[1],u=e[2];return t[0]=n*r[0]+l*r[3]+u*r[6],t[1]=n*r[1]+l*r[4]+u*r[7],t[2]=n*r[2]+l*r[5]+u*r[8],t},o.transformMat4=Tt,o.transformMat4$1=pr,o.transformQuat=pi,o.translate=we,o.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],l=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=l}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},o.triggerPluginCompletionEvent=Ci,o.uniqueId=zn,o.validateCustomStyleLayer=function(t){const e=[],r=t.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFog=Zd,o.validateLight=oa,o.validateStyle=na,o.values=mr,o.vectorTile=is,o.version=j,o.warnOnce=Je,o.window=G,o.wrap=vr}),S(["./shared"],function(o){function j(Y){const D=typeof Y;if(D==="number"||D==="boolean"||D==="string"||Y==null)return JSON.stringify(Y);if(Array.isArray(Y)){let ee="[";for(const le of Y)ee+=`${j(le)},`;return`${ee}]`}const O=Object.keys(Y).sort();let X="{";for(let ee=0;ee<O.length;ee++)X+=`${JSON.stringify(O[ee])}:${j(Y[O[ee]])},`;return`${X}}`}function U(Y){let D="";for(const O of o.refProperties)D+=`/${j(Y[O])}`;return D}class F{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,O){for(const ee of D)this._layerConfigs[ee.id]=ee,(this._layers[ee.id]=o.createStyleLayer(ee)).compileFilter(),this.keyCache[ee.id]&&delete this.keyCache[ee.id];for(const ee of O)delete this.keyCache[ee],delete this._layerConfigs[ee],delete this._layers[ee];this.familiesBySource={};const X=function(ee,le){const he={};for(let ue=0;ue<ee.length;ue++){const _e=le&&le[ee[ue].id]||U(ee[ue]);le&&(le[ee[ue].id]=_e);let Ie=he[_e];Ie||(Ie=he[_e]=[]),Ie.push(ee[ue])}const fe=[];for(const ue in he)fe.push(he[ue]);return fe}(o.values(this._layerConfigs),this.keyCache);for(const ee of X){const le=ee.map(Pe=>this._layers[Pe.id]),he=le[0];if(he.visibility==="none")continue;const fe=he.source||"";let ue=this.familiesBySource[fe];ue||(ue=this.familiesBySource[fe]={});const _e=he.sourceLayer||"_geojsonTileLayer";let Ie=ue[_e];Ie||(Ie=ue[_e]=[]),Ie.push(le)}}}const{ImageBitmap:$}=o.window;class J{loadTile(D,O){const{uid:X,encoding:ee,rawImageData:le,padding:he,buildQuadTree:fe}=D,ue=$&&le instanceof $?this.getImageData(le,he):le;O(null,new o.DEMData(X,ue,ee,he<1,fe))}getImageData(D,O){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(D.width,D.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=D.width,this.offscreenCanvas.height=D.height,this.offscreenCanvasContext.drawImage(D,0,0,D.width,D.height);const X=this.offscreenCanvasContext.getImageData(-O,-O,D.width+2*O,D.height+2*O);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:X.width,height:X.height},X.data)}}var G=function Y(D,O){var X,ee=D&&D.type;if(ee==="FeatureCollection")for(X=0;X<D.features.length;X++)Y(D.features[X],O);else if(ee==="GeometryCollection")for(X=0;X<D.geometries.length;X++)Y(D.geometries[X],O);else if(ee==="Feature")Y(D.geometry,O);else if(ee==="Polygon")ye(D.coordinates,O);else if(ee==="MultiPolygon")for(X=0;X<D.coordinates.length;X++)ye(D.coordinates[X],O);return D};function ye(Y,D){if(Y.length!==0){Te(Y[0],D);for(var O=1;O<Y.length;O++)Te(Y[O],!D)}}function Te(Y,D){for(var O=0,X=0,ee=0,le=Y.length,he=le-1;ee<le;he=ee++){var fe=(Y[ee][0]-Y[he][0])*(Y[he][1]+Y[ee][1]),ue=O+fe;X+=Math.abs(O)>=Math.abs(fe)?O-ue+fe:fe-ue+O,O=ue}O+X>=0!=!!D&&Y.reverse()}const Ue=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ve{constructor(D){this._feature=D,this.extent=o.EXTENT,this.type=D.type,this.properties=D.tags,"id"in D&&!isNaN(D.id)&&(this.id=parseInt(D.id,10))}loadGeometry(){if(this._feature.type===1){const D=[];for(const O of this._feature.geometry)D.push([new o.pointGeometry(O[0],O[1])]);return D}{const D=[];for(const O of this._feature.geometry){const X=[];for(const ee of O)X.push(new o.pointGeometry(ee[0],ee[1]));D.push(X)}return D}}toGeoJSON(D,O,X){return Ue.call(this,D,O,X)}}class T{constructor(D){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=D.length,this._features=D}feature(D){return new Ve(this._features[D])}}var we=o.vectorTile.VectorTileFeature,Le=qe;function qe(Y,D){this.options=D||{},this.features=Y,this.length=Y.length}function xe(Y,D){this.id=typeof Y.id=="number"?Y.id:void 0,this.type=Y.type,this.rawGeometry=Y.type===1?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=D||4096}qe.prototype.feature=function(Y){return new xe(this.features[Y],this.options.extent)},xe.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var D=0;D<Y.length;D++){for(var O=Y[D],X=[],ee=0;ee<O.length;ee++)X.push(new o.pointGeometry(O[ee][0],O[ee][1]));this.geometry.push(X)}return this.geometry},xe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,D=1/0,O=-1/0,X=1/0,ee=-1/0,le=0;le<Y.length;le++)for(var he=Y[le],fe=0;fe<he.length;fe++){var ue=he[fe];D=Math.min(D,ue.x),O=Math.max(O,ue.x),X=Math.min(X,ue.y),ee=Math.max(ee,ue.y)}return[D,X,O,ee]},xe.prototype.toGeoJSON=we.prototype.toGeoJSON;var Se=Ye,Oe=Le;function Ye(Y){var D=new o.pbf;return function(O,X){for(var ee in O.layers)X.writeMessage(3,rt,O.layers[ee])}(Y,D),D.finish()}function rt(Y,D){var O;D.writeVarintField(15,Y.version||1),D.writeStringField(1,Y.name||""),D.writeVarintField(5,Y.extent||4096);var X={keys:[],values:[],keycache:{},valuecache:{}};for(O=0;O<Y.length;O++)X.feature=Y.feature(O),D.writeMessage(2,st,X);var ee=X.keys;for(O=0;O<ee.length;O++)D.writeStringField(3,ee[O]);var le=X.values;for(O=0;O<le.length;O++)D.writeMessage(4,Ni,le[O])}function st(Y,D){var O=Y.feature;O.id!==void 0&&D.writeVarintField(1,O.id),D.writeMessage(2,wt,Y),D.writeVarintField(3,O.type),D.writeMessage(4,Nt,O)}function wt(Y,D){var O=Y.feature,X=Y.keys,ee=Y.values,le=Y.keycache,he=Y.valuecache;for(var fe in O.properties){var ue=O.properties[fe],_e=le[fe];if(ue!==null){_e===void 0&&(X.push(fe),le[fe]=_e=X.length-1),D.writeVarint(_e);var Ie=typeof ue;Ie!=="string"&&Ie!=="boolean"&&Ie!=="number"&&(ue=JSON.stringify(ue));var Pe=Ie+":"+ue,Be=he[Pe];Be===void 0&&(ee.push(ue),he[Pe]=Be=ee.length-1),D.writeVarint(Be)}}}function di(Y,D){return(D<<3)+(7&Y)}function Si(Y){return Y<<1^Y>>31}function Nt(Y,D){for(var O=Y.loadGeometry(),X=Y.type,ee=0,le=0,he=O.length,fe=0;fe<he;fe++){var ue=O[fe],_e=1;X===1&&(_e=ue.length),D.writeVarint(di(1,_e));for(var Ie=X===3?ue.length-1:ue.length,Pe=0;Pe<Ie;Pe++){Pe===1&&X!==1&&D.writeVarint(di(2,Ie-1));var Be=ue[Pe].x-ee,lt=ue[Pe].y-le;D.writeVarint(Si(Be)),D.writeVarint(Si(lt)),ee+=Be,le+=lt}X===3&&D.writeVarint(di(7,1))}}function Ni(Y,D){var O=typeof Y;O==="string"?D.writeStringField(1,Y):O==="boolean"?D.writeBooleanField(7,Y):O==="number"&&(Y%1!=0?D.writeDoubleField(3,Y):Y<0?D.writeSVarintField(6,Y):D.writeVarintField(5,Y))}function qt(Y,D,O,X,ee,le){if(ee-X<=O)return;const he=X+ee>>1;Ct(Y,D,he,X,ee,le%2),qt(Y,D,O,X,he-1,le+1),qt(Y,D,O,he+1,ee,le+1)}function Ct(Y,D,O,X,ee,le){for(;ee>X;){if(ee-X>600){const _e=ee-X+1,Ie=O-X+1,Pe=Math.log(_e),Be=.5*Math.exp(2*Pe/3),lt=.5*Math.sqrt(Pe*Be*(_e-Be)/_e)*(Ie-_e/2<0?-1:1);Ct(Y,D,O,Math.max(X,Math.floor(O-Ie*Be/_e+lt)),Math.min(ee,Math.floor(O+(_e-Ie)*Be/_e+lt)),le)}const he=D[2*O+le];let fe=X,ue=ee;for(fi(Y,D,X,O),D[2*ee+le]>he&&fi(Y,D,X,ee);fe<ue;){for(fi(Y,D,fe,ue),fe++,ue--;D[2*fe+le]<he;)fe++;for(;D[2*ue+le]>he;)ue--}D[2*X+le]===he?fi(Y,D,X,ue):(ue++,fi(Y,D,ue,ee)),ue<=O&&(X=ue+1),O<=ue&&(ee=ue-1)}}function fi(Y,D,O,X){Li(Y,O,X),Li(D,2*O,2*X),Li(D,2*O+1,2*X+1)}function Li(Y,D,O){const X=Y[D];Y[D]=Y[O],Y[O]=X}function Tt(Y,D,O,X){const ee=Y-O,le=D-X;return ee*ee+le*le}Se.fromVectorTileJs=Ye,Se.fromGeojsonVt=function(Y,D){D=D||{};var O={};for(var X in Y)O[X]=new Le(Y[X].features,D),O[X].name=X,O[X].version=D.version,O[X].extent=D.extent;return Ye({layers:O})},Se.GeoJSONWrapper=Oe;const pi=Y=>Y[0],Br=Y=>Y[1];class xn{constructor(D,O=pi,X=Br,ee=64,le=Float64Array){this.nodeSize=ee,this.points=D;const he=D.length<65536?Uint16Array:Uint32Array,fe=this.ids=new he(D.length),ue=this.coords=new le(2*D.length);for(let _e=0;_e<D.length;_e++)fe[_e]=_e,ue[2*_e]=O(D[_e]),ue[2*_e+1]=X(D[_e]);qt(fe,ue,ee,0,fe.length-1,0)}range(D,O,X,ee){return function(le,he,fe,ue,_e,Ie,Pe){const Be=[0,le.length-1,0],lt=[];let ut,ht;for(;Be.length;){const dt=Be.pop(),Mt=Be.pop(),ri=Be.pop();if(Mt-ri<=Pe){for(let gi=ri;gi<=Mt;gi++)ut=he[2*gi],ht=he[2*gi+1],ut>=fe&&ut<=_e&&ht>=ue&&ht<=Ie&&lt.push(le[gi]);continue}const ci=Math.floor((ri+Mt)/2);ut=he[2*ci],ht=he[2*ci+1],ut>=fe&&ut<=_e&&ht>=ue&&ht<=Ie&&lt.push(le[ci]);const oi=(dt+1)%2;(dt===0?fe<=ut:ue<=ht)&&(Be.push(ri),Be.push(ci-1),Be.push(oi)),(dt===0?_e>=ut:Ie>=ht)&&(Be.push(ci+1),Be.push(Mt),Be.push(oi))}return lt}(this.ids,this.coords,D,O,X,ee,this.nodeSize)}within(D,O,X){return function(ee,le,he,fe,ue,_e){const Ie=[0,ee.length-1,0],Pe=[],Be=ue*ue;for(;Ie.length;){const lt=Ie.pop(),ut=Ie.pop(),ht=Ie.pop();if(ut-ht<=_e){for(let oi=ht;oi<=ut;oi++)Tt(le[2*oi],le[2*oi+1],he,fe)<=Be&&Pe.push(ee[oi]);continue}const dt=Math.floor((ht+ut)/2),Mt=le[2*dt],ri=le[2*dt+1];Tt(Mt,ri,he,fe)<=Be&&Pe.push(ee[dt]);const ci=(lt+1)%2;(lt===0?he-ue<=Mt:fe-ue<=ri)&&(Ie.push(ht),Ie.push(dt-1),Ie.push(ci)),(lt===0?he+ue>=Mt:fe+ue>=ri)&&(Ie.push(dt+1),Ie.push(ut),Ie.push(ci))}return Pe}(this.ids,this.coords,D,O,X,this.nodeSize)}}const Co={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Y=>Y},Mn=Math.fround||(pr=new Float32Array(1),Y=>(pr[0]=+Y,pr[0]));var pr;class io{constructor(D){this.options=Ar(Object.create(Co),D),this.trees=new Array(this.options.maxZoom+1)}load(D){const{log:O,minZoom:X,maxZoom:ee,nodeSize:le}=this.options;O&&console.time("total time");const he=`prepare ${D.length} points`;O&&console.time(he),this.points=D;let fe=[];for(let ue=0;ue<D.length;ue++)D[ue].geometry&&fe.push(Mo(D[ue],ue));this.trees[ee+1]=new xn(fe,Yr,Jr,le,Float32Array),O&&console.timeEnd(he);for(let ue=ee;ue>=X;ue--){const _e=+Date.now();fe=this._cluster(fe,ue),this.trees[ue]=new xn(fe,Yr,Jr,le,Float32Array),O&&console.log("z%d: %d clusters in %dms",ue,fe.length,+Date.now()-_e)}return O&&console.timeEnd("total time"),this}getClusters(D,O){let X=((D[0]+180)%360+360)%360-180;const ee=Math.max(-90,Math.min(90,D[1]));let le=D[2]===180?180:((D[2]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)X=-180,le=180;else if(X>le){const Ie=this.getClusters([X,ee,180,he],O),Pe=this.getClusters([-180,ee,le,he],O);return Ie.concat(Pe)}const fe=this.trees[this._limitZoom(O)],ue=fe.range(Or(X),It(he),Or(le),It(ee)),_e=[];for(const Ie of ue){const Pe=fe.points[Ie];_e.push(Pe.numPoints?ro(Pe):this.points[Pe.index])}return _e}getChildren(D){const O=this._getOriginId(D),X=this._getOriginZoom(D),ee="No cluster with the specified id.",le=this.trees[X];if(!le)throw new Error(ee);const he=le.points[O];if(!he)throw new Error(ee);const fe=this.options.radius/(this.options.extent*Math.pow(2,X-1)),ue=le.within(he.x,he.y,fe),_e=[];for(const Ie of ue){const Pe=le.points[Ie];Pe.parentId===D&&_e.push(Pe.numPoints?ro(Pe):this.points[Pe.index])}if(_e.length===0)throw new Error(ee);return _e}getLeaves(D,O,X){const ee=[];return this._appendLeaves(ee,D,O=O||10,X=X||0,0),ee}getTile(D,O,X){const ee=this.trees[this._limitZoom(D)],le=Math.pow(2,D),{extent:he,radius:fe}=this.options,ue=fe/he,_e=(X-ue)/le,Ie=(X+1+ue)/le,Pe={features:[]};return this._addTileFeatures(ee.range((O-ue)/le,_e,(O+1+ue)/le,Ie),ee.points,O,X,le,Pe),O===0&&this._addTileFeatures(ee.range(1-ue/le,_e,1,Ie),ee.points,le,X,le,Pe),O===le-1&&this._addTileFeatures(ee.range(0,_e,ue/le,Ie),ee.points,-1,X,le,Pe),Pe.features.length?Pe:null}getClusterExpansionZoom(D){let O=this._getOriginZoom(D)-1;for(;O<=this.options.maxZoom;){const X=this.getChildren(D);if(O++,X.length!==1)break;D=X[0].properties.cluster_id}return O}_appendLeaves(D,O,X,ee,le){const he=this.getChildren(O);for(const fe of he){const ue=fe.properties;if(ue&&ue.cluster?le+ue.point_count<=ee?le+=ue.point_count:le=this._appendLeaves(D,ue.cluster_id,X,ee,le):le<ee?le++:D.push(fe),D.length===X)break}return le}_addTileFeatures(D,O,X,ee,le,he){for(const fe of D){const ue=O[fe],_e=ue.numPoints;let Ie,Pe,Be;if(_e)Ie=Er(ue),Pe=ue.x,Be=ue.y;else{const ht=this.points[ue.index];Ie=ht.properties,Pe=Or(ht.geometry.coordinates[0]),Be=It(ht.geometry.coordinates[1])}const lt={type:1,geometry:[[Math.round(this.options.extent*(Pe*le-X)),Math.round(this.options.extent*(Be*le-ee))]],tags:Ie};let ut;_e?ut=ue.id:this.options.generateId?ut=ue.index:this.points[ue.index].id&&(ut=this.points[ue.index].id),ut!==void 0&&(lt.id=ut),he.features.push(lt)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(+D,this.options.maxZoom+1))}_cluster(D,O){const X=[],{radius:ee,extent:le,reduce:he,minPoints:fe}=this.options,ue=ee/(le*Math.pow(2,O));for(let _e=0;_e<D.length;_e++){const Ie=D[_e];if(Ie.zoom<=O)continue;Ie.zoom=O;const Pe=this.trees[O+1],Be=Pe.within(Ie.x,Ie.y,ue),lt=Ie.numPoints||1;let ut=lt;for(const ht of Be){const dt=Pe.points[ht];dt.zoom>O&&(ut+=dt.numPoints||1)}if(ut>lt&&ut>=fe){let ht=Ie.x*lt,dt=Ie.y*lt,Mt=he&&lt>1?this._map(Ie,!0):null;const ri=(_e<<5)+(O+1)+this.points.length;for(const ci of Be){const oi=Pe.points[ci];if(oi.zoom<=O)continue;oi.zoom=O;const gi=oi.numPoints||1;ht+=oi.x*gi,dt+=oi.y*gi,oi.parentId=ri,he&&(Mt||(Mt=this._map(Ie,!0)),he(Mt,this._map(oi)))}Ie.parentId=ri,X.push(Io(ht/ut,dt/ut,ri,ut,Mt))}else if(X.push(Ie),ut>1)for(const ht of Be){const dt=Pe.points[ht];dt.zoom<=O||(dt.zoom=O,X.push(dt))}}return X}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,O){if(D.numPoints)return O?Ar({},D.properties):D.properties;const X=this.points[D.index].properties,ee=this.options.map(X);return O&&ee===X?Ar({},ee):ee}}function Io(Y,D,O,X,ee){return{x:Mn(Y),y:Mn(D),zoom:1/0,id:O,parentId:-1,numPoints:X,properties:ee}}function Mo(Y,D){const[O,X]=Y.geometry.coordinates;return{x:Mn(Or(O)),y:Mn(It(X)),zoom:1/0,index:D,parentId:-1}}function ro(Y){return{type:"Feature",id:Y.id,properties:Er(Y),geometry:{type:"Point",coordinates:[(D=Y.x,360*(D-.5)),ji(Y.y)]}};var D}function Er(Y){const D=Y.numPoints,O=D>=1e4?`${Math.round(D/1e3)}k`:D>=1e3?Math.round(D/100)/10+"k":D;return Ar(Ar({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:D,point_count_abbreviated:O})}function Or(Y){return Y/360+.5}function It(Y){const D=Math.sin(Y*Math.PI/180),O=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return O<0?0:O>1?1:O}function ji(Y){const D=(180-360*Y)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function Ar(Y,D){for(const O in D)Y[O]=D[O];return Y}function Yr(Y){return Y.x}function Jr(Y){return Y.y}function kn(Y,D,O,X){for(var ee,le=X,he=O-D>>1,fe=O-D,ue=Y[D],_e=Y[D+1],Ie=Y[O],Pe=Y[O+1],Be=D+3;Be<O;Be+=3){var lt=Vt(Y[Be],Y[Be+1],ue,_e,Ie,Pe);if(lt>le)ee=Be,le=lt;else if(lt===le){var ut=Math.abs(Be-he);ut<fe&&(ee=Be,fe=ut)}}le>X&&(ee-D>3&&kn(Y,D,ee,X),Y[ee+2]=le,O-ee>3&&kn(Y,ee,O,X))}function Vt(Y,D,O,X,ee,le){var he=ee-O,fe=le-X;if(he!==0||fe!==0){var ue=((Y-O)*he+(D-X)*fe)/(he*he+fe*fe);ue>1?(O=ee,X=le):ue>0&&(O+=he*ue,X+=fe*ue)}return(he=Y-O)*he+(fe=D-X)*fe}function Cr(Y,D,O,X){var ee={id:Y===void 0?null:Y,type:D,geometry:O,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(le){var he=le.geometry,fe=le.type;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")vr(le,he);else if(fe==="Polygon"||fe==="MultiLineString")for(var ue=0;ue<he.length;ue++)vr(le,he[ue]);else if(fe==="MultiPolygon")for(ue=0;ue<he.length;ue++)for(var _e=0;_e<he[ue].length;_e++)vr(le,he[ue][_e])}(ee),ee}function vr(Y,D){for(var O=0;O<D.length;O+=3)Y.minX=Math.min(Y.minX,D[O]),Y.minY=Math.min(Y.minY,D[O+1]),Y.maxX=Math.max(Y.maxX,D[O]),Y.maxY=Math.max(Y.maxY,D[O+1])}function Qr(Y,D,O,X){if(D.geometry){var ee=D.geometry.coordinates,le=D.geometry.type,he=Math.pow(O.tolerance/((1<<O.maxZoom)*O.extent),2),fe=[],ue=D.id;if(O.promoteId?ue=D.properties[O.promoteId]:O.generateId&&(ue=X||0),le==="Point")mr(ee,fe);else if(le==="MultiPoint")for(var _e=0;_e<ee.length;_e++)mr(ee[_e],fe);else if(le==="LineString")Wt(ee,fe,he,!1);else if(le==="MultiLineString"){if(O.lineMetrics){for(_e=0;_e<ee.length;_e++)Wt(ee[_e],fe=[],he,!1),Y.push(Cr(ue,"LineString",fe,D.properties));return}Ai(ee,fe,he,!1)}else if(le==="Polygon")Ai(ee,fe,he,!0);else{if(le!=="MultiPolygon"){if(le==="GeometryCollection"){for(_e=0;_e<D.geometry.geometries.length;_e++)Qr(Y,{id:ue,geometry:D.geometry.geometries[_e],properties:D.properties},O,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_e=0;_e<ee.length;_e++){var Ie=[];Ai(ee[_e],Ie,he,!0),fe.push(Ie)}}Y.push(Cr(ue,le,fe,D.properties))}}function mr(Y,D){D.push(zn(Y[0])),D.push(_r(Y[1])),D.push(0)}function Wt(Y,D,O,X){for(var ee,le,he=0,fe=0;fe<Y.length;fe++){var ue=zn(Y[fe][0]),_e=_r(Y[fe][1]);D.push(ue),D.push(_e),D.push(0),fe>0&&(he+=X?(ee*_e-ue*le)/2:Math.sqrt(Math.pow(ue-ee,2)+Math.pow(_e-le,2))),ee=ue,le=_e}var Ie=D.length-3;D[2]=1,kn(D,0,Ie,O),D[Ie+2]=1,D.size=Math.abs(he),D.start=0,D.end=D.size}function Ai(Y,D,O,X){for(var ee=0;ee<Y.length;ee++){var le=[];Wt(Y[ee],le,O,X),D.push(le)}}function zn(Y){return Y/360+.5}function _r(Y){var D=Math.sin(Y*Math.PI/180),O=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return O<0?0:O>1?1:O}function wi(Y,D,O,X,ee,le,he,fe){if(X/=D,le>=(O/=D)&&he<X)return Y;if(he<O||le>=X)return null;for(var ue=[],_e=0;_e<Y.length;_e++){var Ie=Y[_e],Pe=Ie.geometry,Be=Ie.type,lt=ee===0?Ie.minX:Ie.minY,ut=ee===0?Ie.maxX:Ie.maxY;if(lt>=O&&ut<X)ue.push(Ie);else if(!(ut<O||lt>=X)){var ht=[];if(Be==="Point"||Be==="MultiPoint")ko(Pe,ht,O,X,ee);else if(Be==="LineString")no(Pe,ht,O,X,ee,!1,fe.lineMetrics);else if(Be==="MultiLineString")Fr(Pe,ht,O,X,ee,!1);else if(Be==="Polygon")Fr(Pe,ht,O,X,ee,!0);else if(Be==="MultiPolygon")for(var dt=0;dt<Pe.length;dt++){var Mt=[];Fr(Pe[dt],Mt,O,X,ee,!0),Mt.length&&ht.push(Mt)}if(ht.length){if(fe.lineMetrics&&Be==="LineString"){for(dt=0;dt<ht.length;dt++)ue.push(Cr(Ie.id,Be,ht[dt],Ie.tags));continue}Be!=="LineString"&&Be!=="MultiLineString"||(ht.length===1?(Be="LineString",ht=ht[0]):Be="MultiLineString"),Be!=="Point"&&Be!=="MultiPoint"||(Be=ht.length===3?"Point":"MultiPoint"),ue.push(Cr(Ie.id,Be,ht,Ie.tags))}}}return ue.length?ue:null}function ko(Y,D,O,X,ee){for(var le=0;le<Y.length;le+=3){var he=Y[le+ee];he>=O&&he<=X&&(D.push(Y[le]),D.push(Y[le+1]),D.push(Y[le+2]))}}function no(Y,D,O,X,ee,le,he){for(var fe,ue,_e=xr(Y),Ie=ee===0?je:gt,Pe=Y.start,Be=0;Be<Y.length-3;Be+=3){var lt=Y[Be],ut=Y[Be+1],ht=Y[Be+2],dt=Y[Be+3],Mt=Y[Be+4],ri=ee===0?lt:ut,ci=ee===0?dt:Mt,oi=!1;he&&(fe=Math.sqrt(Math.pow(lt-dt,2)+Math.pow(ut-Mt,2))),ri<O?ci>O&&(ue=Ie(_e,lt,ut,dt,Mt,O),he&&(_e.start=Pe+fe*ue)):ri>X?ci<X&&(ue=Ie(_e,lt,ut,dt,Mt,X),he&&(_e.start=Pe+fe*ue)):oo(_e,lt,ut,ht),ci<O&&ri>=O&&(ue=Ie(_e,lt,ut,dt,Mt,O),oi=!0),ci>X&&ri<=X&&(ue=Ie(_e,lt,ut,dt,Mt,X),oi=!0),!le&&oi&&(he&&(_e.end=Pe+fe*ue),D.push(_e),_e=xr(Y)),he&&(Pe+=fe)}var gi=Y.length-3;lt=Y[gi],ut=Y[gi+1],ht=Y[gi+2],(ri=ee===0?lt:ut)>=O&&ri<=X&&oo(_e,lt,ut,ht),gi=_e.length-3,le&&gi>=3&&(_e[gi]!==_e[0]||_e[gi+1]!==_e[1])&&oo(_e,_e[0],_e[1],_e[2]),_e.length&&D.push(_e)}function xr(Y){var D=[];return D.size=Y.size,D.start=Y.start,D.end=Y.end,D}function Fr(Y,D,O,X,ee,le){for(var he=0;he<Y.length;he++)no(Y[he],D,O,X,ee,le,!1)}function oo(Y,D,O,X){Y.push(D),Y.push(O),Y.push(X)}function je(Y,D,O,X,ee,le){var he=(le-D)/(X-D);return Y.push(le),Y.push(O+(ee-O)*he),Y.push(1),he}function gt(Y,D,O,X,ee,le){var he=(le-O)/(ee-O);return Y.push(D+(X-D)*he),Y.push(le),Y.push(1),he}function Je(Y,D){for(var O=[],X=0;X<Y.length;X++){var ee,le=Y[X],he=le.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")ee=St(le.geometry,D);else if(he==="MultiLineString"||he==="Polygon"){ee=[];for(var fe=0;fe<le.geometry.length;fe++)ee.push(St(le.geometry[fe],D))}else if(he==="MultiPolygon")for(ee=[],fe=0;fe<le.geometry.length;fe++){for(var ue=[],_e=0;_e<le.geometry[fe].length;_e++)ue.push(St(le.geometry[fe][_e],D));ee.push(ue)}O.push(Cr(le.id,he,ee,le.tags))}return O}function St(Y,D){var O=[];O.size=Y.size,Y.start!==void 0&&(O.start=Y.start,O.end=Y.end);for(var X=0;X<Y.length;X+=3)O.push(Y[X]+D,Y[X+1],Y[X+2]);return O}function li(Y,D){if(Y.transformed)return Y;var O,X,ee,le=1<<Y.z,he=Y.x,fe=Y.y;for(O=0;O<Y.features.length;O++){var ue=Y.features[O],_e=ue.geometry,Ie=ue.type;if(ue.geometry=[],Ie===1)for(X=0;X<_e.length;X+=2)ue.geometry.push(Dt(_e[X],_e[X+1],D,le,he,fe));else for(X=0;X<_e.length;X++){var Pe=[];for(ee=0;ee<_e[X].length;ee+=2)Pe.push(Dt(_e[X][ee],_e[X][ee+1],D,le,he,fe));ue.geometry.push(Pe)}}return Y.transformed=!0,Y}function Dt(Y,D,O,X,ee,le){return[Math.round(O*(Y*X-ee)),Math.round(O*(D*X-le))]}function ei(Y,D,O,X,ee){for(var le=D===ee.maxZoom?0:ee.tolerance/((1<<D)*ee.extent),he={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:O,y:X,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},fe=0;fe<Y.length;fe++){he.numFeatures++,ti(he,Y[fe],le,ee);var ue=Y[fe].minX,_e=Y[fe].minY,Ie=Y[fe].maxX,Pe=Y[fe].maxY;ue<he.minX&&(he.minX=ue),_e<he.minY&&(he.minY=_e),Ie>he.maxX&&(he.maxX=Ie),Pe>he.maxY&&(he.maxY=Pe)}return he}function ti(Y,D,O,X){var ee=D.geometry,le=D.type,he=[];if(le==="Point"||le==="MultiPoint")for(var fe=0;fe<ee.length;fe+=3)he.push(ee[fe]),he.push(ee[fe+1]),Y.numPoints++,Y.numSimplified++;else if(le==="LineString")ii(he,ee,Y,O,!1,!1);else if(le==="MultiLineString"||le==="Polygon")for(fe=0;fe<ee.length;fe++)ii(he,ee[fe],Y,O,le==="Polygon",fe===0);else if(le==="MultiPolygon")for(var ue=0;ue<ee.length;ue++){var _e=ee[ue];for(fe=0;fe<_e.length;fe++)ii(he,_e[fe],Y,O,!0,fe===0)}if(he.length){var Ie=D.tags||null;if(le==="LineString"&&X.lineMetrics){for(var Pe in Ie={},D.tags)Ie[Pe]=D.tags[Pe];Ie.mapbox_clip_start=ee.start/ee.size,Ie.mapbox_clip_end=ee.end/ee.size}var Be={geometry:he,type:le==="Polygon"||le==="MultiPolygon"?3:le==="LineString"||le==="MultiLineString"?2:1,tags:Ie};D.id!==null&&(Be.id=D.id),Y.features.push(Be)}}function ii(Y,D,O,X,ee,le){var he=X*X;if(X>0&&D.size<(ee?he:X))O.numPoints+=D.length/3;else{for(var fe=[],ue=0;ue<D.length;ue+=3)(X===0||D[ue+2]>he)&&(O.numSimplified++,fe.push(D[ue]),fe.push(D[ue+1])),O.numPoints++;ee&&function(_e,Ie){for(var Pe=0,Be=0,lt=_e.length,ut=lt-2;Be<lt;ut=Be,Be+=2)Pe+=(_e[Be]-_e[ut])*(_e[Be+1]+_e[ut+1]);if(Pe>0===Ie)for(Be=0,lt=_e.length;Be<lt/2;Be+=2){var ht=_e[Be],dt=_e[Be+1];_e[Be]=_e[lt-2-Be],_e[Be+1]=_e[lt-1-Be],_e[lt-2-Be]=ht,_e[lt-1-Be]=dt}}(fe,le),Y.push(fe)}}function vt(Y,D){var O=(D=this.options=function(ee,le){for(var he in le)ee[he]=le[he];return ee}(Object.create(this.options),D)).debug;if(O&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var X=function(ee,le){var he=[];if(ee.type==="FeatureCollection")for(var fe=0;fe<ee.features.length;fe++)Qr(he,ee.features[fe],le,fe);else Qr(he,ee.type==="Feature"?ee:{geometry:ee},le);return he}(Y,D);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(X=function(ee,le){var he=le.buffer/le.extent,fe=ee,ue=wi(ee,1,-1-he,he,0,-1,2,le),_e=wi(ee,1,1-he,2+he,0,-1,2,le);return(ue||_e)&&(fe=wi(ee,1,-he,1+he,0,-1,2,le)||[],ue&&(fe=Je(ue,1).concat(fe)),_e&&(fe=fe.concat(Je(_e,-1)))),fe}(X,D)).length&&this.splitTile(X,0,0,0),O&&(X.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Bt(Y,D,O){return 32*((1<<Y)*O+D)+Y}function Ri(Y,D){const O=Y.tileID.canonical;if(!this._geoJSONIndex)return D(null,null);const X=this._geoJSONIndex.getTile(O.z,O.x,O.y);if(!X)return D(null,null);const ee=new T(X.features);let le=Se(ee);le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),D(null,{vectorTile:ee,rawData:le.buffer})}vt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},vt.prototype.splitTile=function(Y,D,O,X,ee,le,he){for(var fe=[Y,D,O,X],ue=this.options,_e=ue.debug;fe.length;){X=fe.pop(),O=fe.pop(),D=fe.pop(),Y=fe.pop();var Ie=1<<D,Pe=Bt(D,O,X),Be=this.tiles[Pe];if(!Be&&(_e>1&&console.time("creation"),Be=this.tiles[Pe]=ei(Y,D,O,X,ue),this.tileCoords.push({z:D,x:O,y:X}),_e)){_e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,O,X,Be.numFeatures,Be.numPoints,Be.numSimplified),console.timeEnd("creation"));var lt="z"+D;this.stats[lt]=(this.stats[lt]||0)+1,this.total++}if(Be.source=Y,ee){if(D===ue.maxZoom||D===ee)continue;var ut=1<<ee-D;if(O!==Math.floor(le/ut)||X!==Math.floor(he/ut))continue}else if(D===ue.indexMaxZoom||Be.numPoints<=ue.indexMaxPoints)continue;if(Be.source=null,Y.length!==0){_e>1&&console.time("clipping");var ht,dt,Mt,ri,ci,oi,gi=.5*ue.buffer/ue.extent,en=.5-gi,tn=.5+gi,Vi=1+gi;ht=dt=Mt=ri=null,ci=wi(Y,Ie,O-gi,O+tn,0,Be.minX,Be.maxX,ue),oi=wi(Y,Ie,O+en,O+Vi,0,Be.minX,Be.maxX,ue),Y=null,ci&&(ht=wi(ci,Ie,X-gi,X+tn,1,Be.minY,Be.maxY,ue),dt=wi(ci,Ie,X+en,X+Vi,1,Be.minY,Be.maxY,ue),ci=null),oi&&(Mt=wi(oi,Ie,X-gi,X+tn,1,Be.minY,Be.maxY,ue),ri=wi(oi,Ie,X+en,X+Vi,1,Be.minY,Be.maxY,ue),oi=null),_e>1&&console.timeEnd("clipping"),fe.push(ht||[],D+1,2*O,2*X),fe.push(dt||[],D+1,2*O,2*X+1),fe.push(Mt||[],D+1,2*O+1,2*X),fe.push(ri||[],D+1,2*O+1,2*X+1)}}},vt.prototype.getTile=function(Y,D,O){var X=this.options,ee=X.extent,le=X.debug;if(Y<0||Y>24)return null;var he=1<<Y,fe=Bt(Y,D=(D%he+he)%he,O);if(this.tiles[fe])return li(this.tiles[fe],ee);le>1&&console.log("drilling down to z%d-%d-%d",Y,D,O);for(var ue,_e=Y,Ie=D,Pe=O;!ue&&_e>0;)_e--,Ie=Math.floor(Ie/2),Pe=Math.floor(Pe/2),ue=this.tiles[Bt(_e,Ie,Pe)];return ue&&ue.source?(le>1&&console.log("found parent tile z%d-%d-%d",_e,Ie,Pe),le>1&&console.time("drilling down"),this.splitTile(ue.source,_e,Ie,Pe,Y,D,O),le>1&&console.timeEnd("drilling down"),this.tiles[fe]?li(this.tiles[fe],ee):null):null};class Ur extends o.VectorTileWorkerSource{constructor(D,O,X,ee,le){super(D,O,X,ee,Ri),le&&(this.loadGeoJSON=le)}loadData(D,O){const X=D&&D.request,ee=X&&X.collectResourceTiming;this.loadGeoJSON(D,(le,he)=>{if(le||!he)return O(le);if(typeof he!="object")return O(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));{G(he,!0);try{if(D.filter){const ue=o.createExpression(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ue.result==="error")throw new Error(ue.value.map(Ie=>`${Ie.key}: ${Ie.message}`).join(", "));const _e=he.features.filter(Ie=>ue.value.evaluate({zoom:0},Ie));he={type:"FeatureCollection",features:_e}}this._geoJSONIndex=D.cluster?new io(function({superclusterOptions:ue,clusterProperties:_e}){if(!_e||!ue)return ue;const Ie={},Pe={},Be={accumulated:null,zoom:0},lt={properties:null},ut=Object.keys(_e);for(const ht of ut){const[dt,Mt]=_e[ht],ri=o.createExpression(Mt),ci=o.createExpression(typeof dt=="string"?[dt,["accumulated"],["get",ht]]:dt);Ie[ht]=ri.value,Pe[ht]=ci.value}return ue.map=ht=>{lt.properties=ht;const dt={};for(const Mt of ut)dt[Mt]=Ie[Mt].evaluate(Be,lt);return dt},ue.reduce=(ht,dt)=>{lt.properties=dt;for(const Mt of ut)Be.accumulated=ht[Mt],ht[Mt]=Pe[Mt].evaluate(Be,lt)},ue}(D)).load(he.features):function(ue,_e){return new vt(ue,_e)}(he,D.geojsonVtOptions)}catch(ue){return O(ue)}this.loaded={};const fe={};if(ee){const ue=o.getPerformanceMeasurement(X);ue&&(fe.resourceTiming={},fe.resourceTiming[D.source]=JSON.parse(JSON.stringify(ue)))}O(null,fe)}})}reloadTile(D,O){const X=this.loaded;return X&&X[D.uid]?super.reloadTile(D,O):this.loadTile(D,O)}loadGeoJSON(D,O){if(D.request)o.getJSON(D.request,O);else{if(typeof D.data!="string")return O(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));try{return O(null,JSON.parse(D.data))}catch{return O(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(D,O){try{O(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(X){O(X)}}getClusterChildren(D,O){try{O(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(X){O(X)}}getClusterLeaves(D,O){try{O(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(X){O(X)}}}class zi{constructor(D){this.self=D,this.actor=new o.Actor(D,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:Ur},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(O,X)=>{if(this.workerSourceTypes[O])throw new Error(`Worker source with name "${O}" already registered.`);this.workerSourceTypes[O]=X},this.self.registerRTLTextPlugin=O=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=O.applyArabicShaping,o.plugin.processBidirectionalText=O.processBidirectionalText,o.plugin.processStyledBidirectionalText=O.processStyledBidirectionalText}}clearCaches(D,O,X){delete this.layerIndexes[D],delete this.availableImages[D],delete this.workerSources[D],delete this.demWorkerSources[D],X()}checkIfReady(D,O,X){X()}setReferrer(D,O){this.referrer=O}spriteLoaded(D,O){this.isSpriteLoaded[D]=O;for(const X in this.workerSources[D]){const ee=this.workerSources[D][X];for(const le in ee)ee[le]instanceof o.VectorTileWorkerSource&&(ee[le].isSpriteLoaded=O,ee[le].fire(new o.Event("isSpriteLoaded")))}}setImages(D,O,X){this.availableImages[D]=O;for(const ee in this.workerSources[D]){const le=this.workerSources[D][ee];for(const he in le)le[he].availableImages=O}X()}enableTerrain(D,O,X){this.terrain=O,X()}setProjection(D,O){this.projections[D]=o.getProjection(O)}setLayers(D,O,X){this.getLayerIndex(D).replace(O),X()}updateLayers(D,O,X){this.getLayerIndex(D).update(O.layers,O.removedIds),X()}loadTile(D,O,X){const ee=this.enableTerrain?o.extend({enableTerrain:this.terrain},O):O;ee.projection=this.projections[D]||this.defaultProjection,this.getWorkerSource(D,O.type,O.source).loadTile(ee,X)}loadDEMTile(D,O,X){const ee=this.enableTerrain?o.extend({buildQuadTree:this.terrain},O):O;this.getDEMWorkerSource(D,O.source).loadTile(ee,X)}reloadTile(D,O,X){const ee=this.enableTerrain?o.extend({enableTerrain:this.terrain},O):O;ee.projection=this.projections[D]||this.defaultProjection,this.getWorkerSource(D,O.type,O.source).reloadTile(ee,X)}abortTile(D,O,X){this.getWorkerSource(D,O.type,O.source).abortTile(O,X)}removeTile(D,O,X){this.getWorkerSource(D,O.type,O.source).removeTile(O,X)}removeSource(D,O,X){if(!this.workerSources[D]||!this.workerSources[D][O.type]||!this.workerSources[D][O.type][O.source])return;const ee=this.workerSources[D][O.type][O.source];delete this.workerSources[D][O.type][O.source],ee.removeSource!==void 0?ee.removeSource(O,X):X()}loadWorkerSource(D,O,X){try{this.self.importScripts(O.url),X()}catch(ee){X(ee.toString())}}syncRTLPluginState(D,O,X){try{o.plugin.setState(O);const ee=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ee!=null){this.self.importScripts(ee);const le=o.plugin.isParsed();X(le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ee}`),le)}}catch(ee){X(ee.toString())}}getAvailableImages(D){let O=this.availableImages[D];return O||(O=[]),O}getLayerIndex(D){let O=this.layerIndexes[D];return O||(O=this.layerIndexes[D]=new F),O}getWorkerSource(D,O,X){return this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][O]||(this.workerSources[D][O]={}),this.workerSources[D][O][X]||(this.workerSources[D][O][X]=new this.workerSourceTypes[O]({send:(ee,le,he,fe,ue,_e)=>{this.actor.send(ee,le,he,D,ue,_e)},scheduler:this.actor.scheduler},this.getLayerIndex(D),this.getAvailableImages(D),this.isSpriteLoaded[D])),this.workerSources[D][O][X]}getDEMWorkerSource(D,O){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][O]||(this.demWorkerSources[D][O]=new J),this.demWorkerSources[D][O]}enforceCacheSizeLimit(D,O){o.enforceCacheSizeLimit(O)}getWorkerPerformanceMetrics(D,O,X){X(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new zi(self)),zi}),S(["./shared"],function(o){var j=U;function U(h){return!function(i){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,m,y=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(y);try{m=new Worker(b),d=!0}catch{d=!1}return m&&m.terminate(),URL.revokeObjectURL(b),d}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var d=document.createElement("canvas");d.width=d.height=1;var m=d.getContext("2d");if(!m)return!1;var y=m.getImageData(0,0,1,1);return y&&y.width===d.width}()?(F[a=i&&i.failIfMajorPerformanceCaveat]===void 0&&(F[a]=function(d){var m,y=function(b){var E=document.createElement("canvas"),M=Object.create(U.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=b,E.getContext("webgl",M)||E.getContext("experimental-webgl",M)}(d);if(!y)return!1;try{m=y.createShader(y.VERTEX_SHADER)}catch{return!1}return!(!m||y.isContextLost())&&(y.shaderSource(m,"void main() {}"),y.compileShader(m),y.getShaderParameter(m,y.COMPILE_STATUS)===!0)}(a)),F[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var a}(h)}var F={};function $(h,i){var a=i[0],d=i[1],m=i[2],y=i[3],b=a*y-m*d;return b?(h[0]=y*(b=1/b),h[1]=-d*b,h[2]=-m*b,h[3]=a*b,h):null}function J(h,i){if(Array.isArray(h)){if(!Array.isArray(i)||h.length!==i.length)return!1;for(let a=0;a<h.length;a++)if(!J(h[a],i[a]))return!1;return!0}if(typeof h=="object"&&h!==null&&i!==null){if(typeof i!="object"||Object.keys(h).length!==Object.keys(i).length)return!1;for(const a in h)if(!J(h[a],i[a]))return!1;return!0}return h===i}U.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const G={create:function(h,i,a){const d=o.window.document.createElement(h);return i!==void 0&&(d.className=i),a&&a.appendChild(d),d},createSVG:function(h,i,a){const d=o.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const m of Object.keys(i))d.setAttributeNS(null,m,i[m]);return a&&a.appendChild(d),d}},ye=o.window.document&&o.window.document.documentElement.style,Te=ye&&ye.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ue;G.disableDrag=function(){ye&&Te&&(Ue=ye[Te],ye[Te]="none")},G.enableDrag=function(){ye&&Te&&(ye[Te]=Ue)};const Ve=function(h){h.preventDefault(),h.stopPropagation(),o.window.removeEventListener("click",Ve,!0)};function T(h,i,a){const d=h.offsetWidth===i.width?1:h.offsetWidth/i.width;return new o.pointGeometry((a.clientX-i.left)*d,(a.clientY-i.top)*d)}function we(h){const{userImage:i}=h;return!!(i&&i.render&&i.render())&&(h.data.replace(new Uint8Array(i.data.buffer)),!0)}G.suppressClick=function(){o.window.addEventListener("click",Ve,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",Ve,!0)},0)},G.mousePos=function(h,i){const a=h.getBoundingClientRect();return T(h,a,i)},G.touchPos=function(h,i){const a=h.getBoundingClientRect(),d=[];for(let m=0;m<i.length;m++)d.push(T(h,a,i[m]));return d},G.mouseButton=function(h){return o.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button};class Le extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:a,callback:d}of this.requestors)this._notify(a,d);this.requestors=[]}}getImage(i){return this.images[i]}addImage(i,a){this._validate(i,a)&&(this.images[i]=a)}_validate(i,a){let d=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new o.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),d=!1),d}_validateStretch(i,a){if(!i)return!0;let d=0;for(const m of i){if(m[0]<d||m[1]<m[0]||a<m[1])return!1;d=m[1]}return!0}_validateContent(i,a){return!(i&&(i.length!==4||i[0]<0||a.data.width<i[0]||i[1]<0||a.data.height<i[1]||i[2]<0||a.data.width<i[2]||i[3]<0||a.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,a){a.version=this.images[i].version+1,this.images[i]=a,this.updatedImages[i]=!0}removeImage(i){const a=this.images[i];delete this.images[i],delete this.patterns[i],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,a){let d=!0;if(!this.isLoaded())for(const m of i)this.images[m]||(d=!1);this.isLoaded()||d?this._notify(i,a):this.requestors.push({ids:i,callback:a})}_notify(i,a){const d={};for(const m of i){this.images[m]||this.fire(new o.Event("styleimagemissing",{id:m}));const y=this.images[m];y?d[m]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:Boolean(y.userImage&&y.userImage.render)}:o.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,d)}getPixelSize(){const{width:i,height:a}=this.atlasImage;return{width:i,height:a}}getPattern(i){const a=this.patterns[i],d=this.getImage(i);if(!d)return null;if(a&&a.position.version===d.version)return a.position;if(a)a.position.version=d.version;else{const m={w:d.data.width+2,h:d.data.height+2,x:0,y:0},y=new o.ImagePosition(m,d);this.patterns[i]={bin:m,position:y}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const a=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(i,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const y in this.patterns)i.push(this.patterns[y].bin);const{w:a,h:d}=o.potpack(i),m=this.atlasImage;m.resize({width:a||1,height:d||1});for(const y in this.patterns){const{bin:b}=this.patterns[y],E=b.x+1,M=b.y+1,k=this.images[y].data,P=k.width,R=k.height;o.RGBAImage.copy(k,m,{x:0,y:0},{x:E,y:M},{width:P,height:R}),o.RGBAImage.copy(k,m,{x:0,y:R-1},{x:E,y:M-1},{width:P,height:1}),o.RGBAImage.copy(k,m,{x:0,y:0},{x:E,y:M+R},{width:P,height:1}),o.RGBAImage.copy(k,m,{x:P-1,y:0},{x:E-1,y:M},{width:1,height:R}),o.RGBAImage.copy(k,m,{x:0,y:0},{x:E+P,y:M},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const a of i){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const d=this.images[a];we(d)&&this.updateImage(a,d)}}}const qe=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(h,i){return function([a,d,m]){const y=o.degToRad(d+90),b=o.degToRad(m);return{x:a*Math.cos(y)*Math.sin(b),y:a*Math.sin(y)*Math.sin(b),z:a*Math.cos(b),azimuthal:d,polar:m}}(h.expression.evaluate(i))}interpolate(h,i,a){return{x:o.number(h.x,i.x,a),y:o.number(h.y,i.y,a),z:o.number(h.z,i.z,a),azimuthal:o.number(h.azimuthal,i.azimuthal,a),polar:o.number(h.polar,i.polar,a)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),xe="-transition";class Se extends o.Evented{constructor(i){super(),this._transitionable=new o.Transitionable(qe),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,a={}){if(!this._validate(o.validateLight,i,a))for(const d in i){const m=i[d];o.endsWith(d,xe)?this._transitionable.setTransition(d.slice(0,-xe.length),m):this._transitionable.setValue(d,m)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,d){return(!d||d.validate!==!1)&&o.emitValidationErrors(this,i.call(o.validateStyle,o.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const Oe=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),Ye="-transition";class rt extends o.Evented{constructor(i,a){super(),this._transitionable=new o.Transitionable(Oe),this.set(i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(i){for(const a in i){const d=i[a];o.endsWith(a,Ye)?this._transitionable.setTransition(a.slice(0,-Ye.length),d):this._transitionable.setValue(a,d)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}}function st(h,i,a,d){const m=o.smoothstep(45,65,a),[y,b]=wt(h,d),E=o.length(i);let M=1-Math.min(1,Math.exp((E-y)/(b-y)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*m*h.alpha}function wt(h,i){const a=.5/Math.tan(.5*i);return[h.range[0]+a,h.range[1]+a]}const di=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"])}),Si="-transition";class Nt extends o.Evented{constructor(i,a){super(),this._transitionable=new o.Transitionable(di),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=a}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,a={}){if(!this._validate(o.validateFog,i,a))for(const d in i){const m=i[d];o.endsWith(d,Si)?this._transitionable.setTransition(d.slice(0,-Si.length),m):this._transitionable.setValue(d,m)}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return o.smoothstep(45,65,i)*a.a}getOpacityAtLatLng(i,a){return this._transform.projection.supportsFog?function(d,m,y){const b=o.MercatorCoordinate.fromLngLat(m),E=y.elevation?y.elevation.getAtPointOrZero(b):0,M=[b.x,b.y,E];return o.transformMat4(M,M,y.mercatorFogMatrix),st(d,M,y.pitch,y._fov)}(this.state,i,a):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?wt(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,d){return(!d||d.validate!==!1)&&o.emitValidationErrors(this,i.call(o.validateStyle,o.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Ni{constructor(i,a){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const d=this.workerPool.acquire(this.id);for(let m=0;m<d.length;m++){const y=new Ni.Actor(d[m],a,this.id);y.name=`Worker ${m}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,a,d){o.asyncAll(this.actors,(m,y)=>{m.send(i,a,y)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function qt(h,i,a){return i*(o.EXTENT/(h.tileSize*Math.pow(2,a-h.tileID.overscaledZ)))}Ni.Actor=o.Actor;class Ct{constructor(i,a,d){this.context=i;const m=i.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(d),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Li{constructor(i,a,d,m){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=m,this.context=i;const y=i.gl;this.buffer=y.createBuffer(),i.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,a){for(let d=0;d<this.attributes.length;d++){const m=a.attributes[this.attributes[d].name];m!==void 0&&i.enableVertexAttribArray(m)}}setVertexAttribPointers(i,a,d){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],b=a.attributes[y.name];b!==void 0&&i.vertexAttribPointer(b,y.components,i[fi[y.type]],!1,this.itemSize,y.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Tt{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pi extends Tt{getDefault(){return o.Color.transparent}set(i){const a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Br extends Tt{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class xn extends Tt{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Co extends Tt{getDefault(){return[!0,!0,!0,!0]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Mn extends Tt{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class pr extends Tt{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class io extends Tt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const a=this.current;(i.func!==a.func||i.ref!==a.ref||i.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Io extends Tt{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Mo extends Tt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=i,this.dirty=!1}}class ro extends Tt{getDefault(){return[0,1]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Er extends Tt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=i,this.dirty=!1}}class Or extends Tt{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class It extends Tt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.BLEND):a.disable(a.BLEND),this.current=i,this.dirty=!1}}class ji extends Tt{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Ar extends Tt{getDefault(){return o.Color.transparent}set(i){const a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Yr extends Tt{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Jr extends Tt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=i,this.dirty=!1}}class kn extends Tt{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Vt extends Tt{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class Cr extends Tt{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class vr extends Tt{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Qr extends Tt{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class mr extends Tt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Wt extends Tt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ai extends Tt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class zn extends Tt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class _r extends Tt{getDefault(){return null}set(i){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class wi extends Tt{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class ko extends Tt{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class no extends Tt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class xr extends Tt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Fr extends Tt{constructor(i,a){super(i),this.context=i,this.parent=a}getDefault(){return null}}class oo extends Fr{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class je extends Fr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class gt extends je{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Je{constructor(i,a,d,m){this.context=i,this.width=a,this.height=d;const y=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new oo(i,y),m&&(this.depthAttachment=new je(i,y))}destroy(){const i=this.context.gl,a=this.colorAttachment.get();if(a&&i.deleteTexture(a),this.depthAttachment){const d=this.depthAttachment.get();d&&i.deleteRenderbuffer(d)}i.deleteFramebuffer(this.framebuffer)}}class St{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new pi(this),this.clearDepth=new Br(this),this.clearStencil=new xn(this),this.colorMask=new Co(this),this.depthMask=new Mn(this),this.stencilMask=new pr(this),this.stencilFunc=new io(this),this.stencilOp=new Io(this),this.stencilTest=new Mo(this),this.depthRange=new ro(this),this.depthTest=new Er(this),this.depthFunc=new Or(this),this.blend=new It(this),this.blendFunc=new ji(this),this.blendColor=new Ar(this),this.blendEquation=new Yr(this),this.cullFace=new Jr(this),this.cullFaceSide=new kn(this),this.frontFace=new Vt(this),this.program=new Cr(this),this.activeTexture=new vr(this),this.viewport=new Qr(this),this.bindFramebuffer=new mr(this),this.bindRenderbuffer=new Wt(this),this.bindTexture=new Ai(this),this.bindVertexBuffer=new zn(this),this.bindElementBuffer=new _r(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new wi(this),this.pixelStoreUnpack=new ko(this),this.pixelStoreUnpackPremultiplyAlpha=new no(this),this.pixelStoreUnpackFlipY=new xr(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,a){return new Ct(this,i,a)}createVertexBuffer(i,a,d){return new Li(this,i,a,d)}createRenderbuffer(i,a,d){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,i,a,d),this.bindRenderbuffer.set(null),y}createFramebuffer(i,a,d){return new Je(this,i,a,d)}clear({color:i,depth:a,stencil:d}){const m=this.gl;let y=0;i&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),d!==void 0&&(y|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),m.clear(y)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){J(i.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class li{constructor(i,a,d,m){this.screenBounds=i,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(y=>m.pointCoordinate3D(y)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(i,a){let d,m;if(i instanceof o.pointGeometry||typeof i[0]=="number"){const y=o.pointGeometry.convert(i);d=[o.pointGeometry.convert(i)],m=a.isPointAboveHorizon(y)}else{const y=o.pointGeometry.convert(i[0]),b=o.pointGeometry.convert(i[1]);d=[y,b],m=o.polygonizeBounds(y,b).every(E=>a.isPointAboveHorizon(E))}return new li(d,a.getCameraPoint(),m,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],m=o.polygonizeBounds(a,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<d.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?m[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(m[3]=this.cameraPoint)),o.bufferConvexPolygon(m,i)}containsTile(i,a,d){const m=i.queryPadding+1,y=i.tileID.wrap,b=d?this._bufferedCameraMercator(m,a).map(Z=>o.getTilePoint(i.tileTransform,Z,y)):this._bufferedScreenMercator(m,a).map(Z=>o.getTilePoint(i.tileTransform,Z,y)),E=this.screenGeometryMercator.map(Z=>o.getTileVec3(i.tileTransform,Z,y)),M=E.map(Z=>new o.pointGeometry(Z[0],Z[1])),k=a.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),P=o.getTileVec3(i.tileTransform,k,y),R=E.map(Z=>{const K=o.sub(Z,Z,P);return o.normalize(K,K),new o.Ray(P,K)}),N=qt(i,1,a.zoom);if(o.polygonIntersectsBox(b,0,0,o.EXTENT,o.EXTENT))return{queryGeometry:this,tilespaceGeometry:M,tilespaceRays:R,bufferedTilespaceGeometry:b,bufferedTilespaceBounds:(H=o.getBounds(b),H.min.x=o.clamp(H.min.x,0,o.EXTENT),H.min.y=o.clamp(H.min.y,0,o.EXTENT),H.max.x=o.clamp(H.max.x,0,o.EXTENT),H.max.y=o.clamp(H.max.y,0,o.EXTENT),H),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:N};var H}_bufferedScreenMercator(i,a){const d=Dt(i);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{const m=this.bufferedScreenGeometry(i).map(y=>a.pointCoordinate3D(y));return this._screenRaycastCache[d]=m,m}}_bufferedCameraMercator(i,a){const d=Dt(i);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{const m=this.bufferedCameraGeometry(i).map(y=>a.pointCoordinate3D(y));return this._cameraRaycastCache[d]=m,m}}}function Dt(h){return 100*h|0}function ei(h,i,a){const d=function(m,y){if(m)return a(m);if(y){const b=o.pick(o.extend(y,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(b.vectorLayers=y.vector_layers,b.vectorLayerIds=b.vectorLayers.map(E=>E.id)),b.tiles=i.canonicalizeTileset(b,h.url),a(null,b)}};return h.url?o.getJSON(i.transformRequest(i.normalizeSourceURL(h.url),o.ResourceType.Source),d):o.exported.frame(()=>d(null,h))}class ti{constructor(i,a,d){this.bounds=o.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=a||0,this.maxzoom=d||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const a=Math.pow(2,i.z),d=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*a),m=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*a),y=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*a),b=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*a);return i.x>=d&&i.x<y&&i.y>=m&&i.y<b}}class ii extends o.Evented{constructor(i,a,d,m){super(),this.id=i,this.dispatcher=d,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},a),o.extend(this,o.pick(a,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ei(this._options,this.map._requestManager,(i,a)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new o.ErrorEvent(i)):a&&(o.extend(this,a),a.bounds&&(this.tileBounds=new ti(a.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(a.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,a){const d=o.exported.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);i.request=o.getImage(this.map._requestManager.transformRequest(m,o.ResourceType.Tile),(y,b,E,M)=>{if(delete i.request,i.aborted)i.state="unloaded",a(null);else if(y)i.state="errored",a(y);else if(b){this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:E,expires:M});const k=this.map.painter.context,P=k.gl;i.texture=this.map.painter.getTileTexture(b.width),i.texture?i.texture.update(b,{useMipmap:!0}):(i.texture=new o.Texture(k,b,P.RGBA,{useMipmap:!0}),i.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE),k.extTextureFilterAnisotropic&&P.texParameterf(P.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax)),i.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),a(null)}})}abortTile(i,a){i.request&&(i.request.cancel(),delete i.request),a()}unloadTile(i,a){i.texture&&this.map.painter.saveTileTexture(i.texture),a()}hasTransition(){return!1}}let vt;function Bt(h,i,a,d,m,y,b,E){const M=[h,a,m,i,d,y,1,1,1],k=[b,E,1],P=o.adjoint([],M),[R,N,H]=o.transformMat3(k,k,o.transpose(P,P));return o.multiply(M,[R,0,0,0,N,0,0,0,H],M)}class Ri extends o.Evented{constructor(i,a,d,m){super(),this.id=i,this.dispatcher=d,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=a}load(i,a){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(d,m)=>{this._loaded=!0,d?this.fire(new o.ErrorEvent(d)):m&&(this.image=o.exported.getImageData(m),this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),a&&a(),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this.options.url=i.url,this.load(i.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}setCoordinates(i){this.coordinates=i,delete this._boundsArray;const a=i.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(d){let m=1/0,y=1/0,b=-1/0,E=-1/0;for(const R of d)m=Math.min(m,R.x),y=Math.min(y,R.y),b=Math.max(b,R.x),E=Math.max(E,R.y);const M=Math.max(b-m,E-y),k=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),P=Math.pow(2,k);return new o.CanonicalTileID(k,Math.floor((m+b)/2*P),Math.floor((y+E)/2*P))}(a),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const i=o.tileTransform(this.tileID,this.map.transform.projection),[a,d,m,y]=this.coordinates.map(b=>{const E=i.projection.project(b[0],b[1]);return o.getTilePoint(i,E)._round()});return this.perspectiveTransform=function(b,E,M,k,P,R,N,H,Z,K){const ae=Bt(0,0,b,0,0,E,b,E),W=Bt(M,k,P,R,N,H,Z,K);return o.multiply(W,o.adjoint(ae,ae),W),[W[6]/W[8]*b/o.EXTENT,W[7]/W[8]*E/o.EXTENT]}(this.width,this.height,a.x,a.y,d.x,d.y,y.x,y.y,m.x,m.y),this._boundsArray=new o.StructArrayLayout4i8,this._boundsArray.emplaceBack(a.x,a.y,0,0),this._boundsArray.emplaceBack(d.x,d.y,o.EXTENT,0),this._boundsArray.emplaceBack(y.x,y.y,0,o.EXTENT),this._boundsArray.emplaceBack(m.x,m.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,a=i.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new o.Texture(i,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));for(const d in this.tiles){const m=this.tiles[d];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}loadTile(i,a){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},a(null)):(i.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ur={vector:class extends o.Evented{constructor(h,i,a,d){if(super(),this.id=h,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(i,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ei(this._options,this.map._requestManager,(h,i)=>{this._tileJSONRequest=null,this._loaded=!0,h?this.fire(new o.ErrorEvent(h)):i&&(o.extend(this,i),i.bounds&&(this.tileBounds=new ti(i.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(i.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}onAdd(h){this.map=h,this.load()}setSourceProperty(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h();const i=this.map.style._getSourceCaches(this.id);for(const a of i)a.clearTiles();this.load()}setTiles(h){return this.setSourceProperty(()=>{this._options.tiles=h}),this}setUrl(h){return this.setSourceProperty(()=>{this.url=h,this._options.url=h}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(h,i){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(a,o.ResourceType.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:h.isSymbolTile};if(d.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired")h.state==="loading"?h.reloadCallback=i:h.request=h.actor.send("reloadTile",d,m.bind(this));else if(h.actor=this._tileWorkers[a]=this._tileWorkers[a]||this.dispatcher.getActor(),this.dispatcher.ready)h.request=h.actor.send("loadTile",d,m.bind(this),void 0,!0);else{const y=o.loadVectorTile.call({deduped:this._deduped},d,(b,E)=>{b||!E?m.call(this,b):(d.data={cacheControl:E.cacheControl,expires:E.expires,rawData:E.rawData.slice(0)},h.actor&&h.actor.send("loadTile",d,m.bind(this),void 0,!0))},!0);h.request={cancel:y}}function m(y,b){return delete h.request,h.aborted?i(null):y&&y.status!==404?i(y):(b&&b.resourceTiming&&(h.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&b&&h.setExpiryData(b),h.loadVectorData(b,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id})}unloadTile(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ii,"raster-dem":class extends ii{constructor(h,i,a,d){super(h,i,a,d),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(h,i){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(m,y){m&&(h.state="errored",i(m)),y&&(h.dem=y,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",i(null))}h.request=o.getImage(this.map._requestManager.transformRequest(a,o.ResourceType.Tile),function(m,y,b,E){if(delete h.request,h.aborted)h.state="unloaded",i(null);else if(m)h.state="errored",i(m);else if(y){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:b,expires:E});const M=o.window.ImageBitmap&&y instanceof o.window.ImageBitmap&&(vt==null&&(vt=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),vt),k=1-(y.width-o.prevPowerOfTwo(y.width))/2;k<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const P=M?y:o.exported.getImageData(y,k),R={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:P,encoding:this.encoding,padding:k};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",R,d.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const i=h.canonical,a=Math.pow(2,i.z),d=(i.x-1+a)%a,m=i.x===0?h.wrap-1:h.wrap,y=(i.x+1+a)%a,b=i.x+1===a?h.wrap+1:h.wrap,E={};return E[new o.OverscaledTileID(h.overscaledZ,m,i.z,d,i.y).key]={backfilled:!1},E[new o.OverscaledTileID(h.overscaledZ,b,i.z,y,i.y).key]={backfilled:!1},i.y>0&&(E[new o.OverscaledTileID(h.overscaledZ,m,i.z,d,i.y-1).key]={backfilled:!1},E[new o.OverscaledTileID(h.overscaledZ,h.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},E[new o.OverscaledTileID(h.overscaledZ,b,i.z,y,i.y-1).key]={backfilled:!1}),i.y+1<a&&(E[new o.OverscaledTileID(h.overscaledZ,m,i.z,d,i.y+1).key]={backfilled:!1},E[new o.OverscaledTileID(h.overscaledZ,h.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},E[new o.OverscaledTileID(h.overscaledZ,b,i.z,y,i.y+1).key]={backfilled:!1}),E}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends o.Evented{constructor(h,i,a,d){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(d),this._data=i.data,this._options=o.extend({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const m=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*m,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*m,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:o.EXTENT,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*m,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},i),this}getClusterChildren(h,i){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},i),this}getClusterLeaves(h,i,a,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:i,offset:a},d),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=o.extend({},this.workerOptions),i=this._data;typeof i=="string"?(h.request=this.map._requestManager.transformRequest(o.exported.resolveURL(i),o.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(a,d)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new o.ErrorEvent(a));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&d&&d.resourceTiming&&d.resourceTiming[this.id]&&(m.resourceTiming=d.resourceTiming[this.id]),this.fire(new o.Event("data",m)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,i){const a=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(a,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(d,m)=>(delete h.request,h.unloadVectorData(),h.aborted?i(null):d?i(d):(h.loadVectorData(m,this.map.painter,a==="reloadTile"),i(null))),void 0,a==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ri{constructor(h,i,a,d){super(h,i,a,d),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const i of h.urls)this.urls.push(this.map._requestManager.transformRequest(i,o.ResourceType.Source).url);o.getVideo(this.urls,(i,a)=>{this._loaded=!0,i?this.fire(new o.ErrorEvent(i)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const i=this.video.seekable;h<i.start(0)||h>i.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,i=h.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(h,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2));for(const a in this.tiles){const d=this.tiles[a];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ri,canvas:class extends Ri{constructor(h,i,a,d){super(h,i,a,d),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(y=>typeof y!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context,a=i.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,o.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(i,this.canvas,a.RGBA,{premultiply:!0});for(const d in this.tiles){const m=this.tiles[d];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}}},zi=function(h,i,a,d){const m=new Ur[i.type](h,i,a,d);if(m.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${m.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],m),m};function Y(h,i){const a=o.identity([]);return o.scale(a,a,[.5*h.width,.5*-h.height,1]),o.translate(a,a,[1,-1,0]),o.multiply$1(a,a,h.calculateProjMatrix(i.toUnwrapped()))}function D(h,i,a,d,m,y,b,E=!1){const M=h.tilesIn(d,b,E);M.sort(X);const k=[];for(const R of M)k.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(i,a,h._state,R,m,y,Y(h.transform,R.tile.tileID),E)});const P=function(R){const N={},H={};for(const Z of R){const K=Z.queryResults,ae=Z.wrappedTileID,W=H[ae]=H[ae]||{};for(const re in K){const ne=K[re],te=W[re]=W[re]||{},ie=N[re]=N[re]||[];for(const se of ne)te[se.featureIndex]||(te[se.featureIndex]=!0,ie.push(se))}}return N}(k);for(const R in P)P[R].forEach(N=>{const H=N.feature,Z=h.getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=Z});return P}function O(h,i){const a=h.getRenderableIds().map(y=>h.getTileByID(y)),d=[],m={};for(let y=0;y<a.length;y++){const b=a[y],E=b.tileID.canonical.key;m[E]||(m[E]=!0,b.querySourceFeatures(d,i))}return d}function X(h,i){const a=h.tileID,d=i.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}function ee(){return go.workerClass!=null?new go.workerClass:new o.window.Worker(go.workerUrl)}const le="mapboxgl_preloaded_worker_pool";class he{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<he.workerCount;)this.workers.push(new ee);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[le]}numActive(){return Object.keys(this.active).length}}let fe;function ue(){return fe||(fe=new he),fe}function _e(h,i){const a={};for(const d in h)d!=="ref"&&(a[d]=h[d]);return o.refProperties.forEach(d=>{d in i&&(a[d]=i[d])}),a}function Ie(h){h=h.slice();const i=Object.create(null);for(let a=0;a<h.length;a++)i[h[a].id]=h[a];for(let a=0;a<h.length;a++)"ref"in h[a]&&(h[a]=_e(h[a],i[h[a].ref]));return h}he.workerCount=2;const Pe={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Be(h,i,a){a.push({command:Pe.addSource,args:[h,i[h]]})}function lt(h,i,a){i.push({command:Pe.removeSource,args:[h]}),a[h]=!0}function ut(h,i,a,d){lt(h,a,d),Be(h,i,a)}function ht(h,i,a){let d;for(d in h[a])if(h[a].hasOwnProperty(d)&&d!=="data"&&!J(h[a][d],i[a][d]))return!1;for(d in i[a])if(i[a].hasOwnProperty(d)&&d!=="data"&&!J(h[a][d],i[a][d]))return!1;return!0}function dt(h,i,a,d,m,y){let b;for(b in i=i||{},h=h||{})h.hasOwnProperty(b)&&(J(h[b],i[b])||a.push({command:y,args:[d,b,i[b],m]}));for(b in i)i.hasOwnProperty(b)&&!h.hasOwnProperty(b)&&(J(h[b],i[b])||a.push({command:y,args:[d,b,i[b],m]}))}function Mt(h){return h.id}function ri(h,i){return h[i.id]=i,h}class ci{constructor(i,a){this.reset(i,a)}reset(i,a){this.points=i||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=o.clamp(i,0,1);let a=1,d=this._distances[a];const m=i*this.paddedLength+this.padding;for(;d<m&&a<this._distances.length;)d=this._distances[++a];const y=a-1,b=this._distances[y],E=d-b,M=E>0?(m-b)/E:0;return this.points[y].mult(1-M).add(this.points[a].mult(M))}}class oi{constructor(i,a,d){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(i/d),this.yCellCount=Math.ceil(a/d);for(let b=0;b<this.xCellCount*this.yCellCount;b++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=a,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,a,d,m,y){this._forEachCell(a,d,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(i,a,d,m){this._forEachCell(a-m,d-m,a+m,d+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(a),this.circles.push(d),this.circles.push(m)}_insertBoxCell(i,a,d,m,y,b){this.boxCells[y].push(b)}_insertCircleCell(i,a,d,m,y,b){this.circleCells[y].push(b)}_query(i,a,d,m,y,b){if(d<0||i>this.width||m<0||a>this.height)return!y&&[];const E=[];if(i<=0&&a<=0&&this.width<=d&&this.height<=m){if(y)return!0;for(let M=0;M<this.boxKeys.length;M++)E.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const k=this.circles[3*M],P=this.circles[3*M+1],R=this.circles[3*M+2];E.push({key:this.circleKeys[M],x1:k-R,y1:P-R,x2:k+R,y2:P+R})}return b?E.filter(b):E}return this._forEachCell(i,a,d,m,this._queryCell,E,{hitTest:y,seenUids:{box:{},circle:{}}},b),y?E.length>0:E}_queryCircle(i,a,d,m,y){const b=i-d,E=i+d,M=a-d,k=a+d;if(E<0||b>this.width||k<0||M>this.height)return!m&&[];const P=[];return this._forEachCell(b,M,E,k,this._queryCellCircle,P,{hitTest:m,circle:{x:i,y:a,radius:d},seenUids:{box:{},circle:{}}},y),m?P.length>0:P}query(i,a,d,m,y){return this._query(i,a,d,m,!1,y)}hitTest(i,a,d,m,y){return this._query(i,a,d,m,!0,y)}hitTestCircle(i,a,d,m){return this._queryCircle(i,a,d,!0,m)}_queryCell(i,a,d,m,y,b,E,M){const k=E.seenUids,P=this.boxCells[y];if(P!==null){const N=this.bboxes;for(const H of P)if(!k.box[H]){k.box[H]=!0;const Z=4*H;if(i<=N[Z+2]&&a<=N[Z+3]&&d>=N[Z+0]&&m>=N[Z+1]&&(!M||M(this.boxKeys[H]))){if(E.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[H],x1:N[Z],y1:N[Z+1],x2:N[Z+2],y2:N[Z+3]})}}}const R=this.circleCells[y];if(R!==null){const N=this.circles;for(const H of R)if(!k.circle[H]){k.circle[H]=!0;const Z=3*H;if(this._circleAndRectCollide(N[Z],N[Z+1],N[Z+2],i,a,d,m)&&(!M||M(this.circleKeys[H]))){if(E.hitTest)return b.push(!0),!0;{const K=N[Z],ae=N[Z+1],W=N[Z+2];b.push({key:this.circleKeys[H],x1:K-W,y1:ae-W,x2:K+W,y2:ae+W})}}}}}_queryCellCircle(i,a,d,m,y,b,E,M){const k=E.circle,P=E.seenUids,R=this.boxCells[y];if(R!==null){const H=this.bboxes;for(const Z of R)if(!P.box[Z]){P.box[Z]=!0;const K=4*Z;if(this._circleAndRectCollide(k.x,k.y,k.radius,H[K+0],H[K+1],H[K+2],H[K+3])&&(!M||M(this.boxKeys[Z])))return b.push(!0),!0}}const N=this.circleCells[y];if(N!==null){const H=this.circles;for(const Z of N)if(!P.circle[Z]){P.circle[Z]=!0;const K=3*Z;if(this._circlesCollide(H[K],H[K+1],H[K+2],k.x,k.y,k.radius)&&(!M||M(this.circleKeys[Z])))return b.push(!0),!0}}}_forEachCell(i,a,d,m,y,b,E,M){const k=this._convertToXCellCoord(i),P=this._convertToYCellCoord(a),R=this._convertToXCellCoord(d),N=this._convertToYCellCoord(m);for(let H=k;H<=R;H++)for(let Z=P;Z<=N;Z++)if(y.call(this,i,a,d,m,this.xCellCount*Z+H,b,E,M))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,a,d,m,y,b){const E=m-i,M=y-a,k=d+b;return k*k>E*E+M*M}_circleAndRectCollide(i,a,d,m,y,b,E){const M=(b-m)/2,k=Math.abs(i-(m+M));if(k>M+d)return!1;const P=(E-y)/2,R=Math.abs(a-(y+P));if(R>P+d)return!1;if(k<=M||R<=P)return!0;const N=k-M,H=R-P;return N*N+H*H<=d*d}}const gi=Math.tan(85*Math.PI/180);function en(h,i,a,d,m,y){let b=o.create();if(a){if(m.projection.name==="globe")b=o.calculateGlobeMatrix(m,m.worldSize/m._projectionScaler,[0,0]),o.multiply$1(b,b,o.globeDenormalizeECEF(o.globeTileBounds(i)));else{const E=$([],y);b[0]=E[0],b[1]=E[1],b[4]=E[2],b[5]=E[3]}d||o.rotateZ(b,b,m.angle)}else o.multiply$1(b,m.labelPlaneMatrix,h);return b}function tn(h,i,a,d,m,y){if(a){if(m.projection.name==="globe"){const b=en(h,i,a,d,m,y);return o.invert(b,b),o.multiply$1(b,h,b),b}{const b=o.clone(h),E=o.identity([]);return E[0]=y[0],E[1]=y[1],E[4]=y[2],E[5]=y[3],o.multiply$1(b,b,E),d||o.rotateZ(b,b,-m.angle),b}}return m.glCoordMatrix}function Vi(h,i,a=0){const d=[h.x,h.y,a,1];a?o.transformMat4$1(d,d,i):Aa(d,d,i);const m=d[3];return{point:new o.pointGeometry(d[0]/m,d[1]/m),signedDistanceFromCamera:m}}function Nr(h,i){return Math.min(.5+h/i*.5,1.5)}function _s(h,i){const a=h[0]/h[3],d=h[1]/h[3];return a>=-i[0]&&a<=i[0]&&d>=-i[1]&&d<=i[1]}function gu(h,i,a,d,m,y,b,E,M,k){const P=a.transform,R=d?h.textSizeData:h.iconSizeData,N=o.evaluateSizeForZoom(R,a.transform.zoom),H=[256/a.width*2+1,256/a.height*2+1],Z=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;Z.clear();const K=h.lineVertexArray,ae=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,W=a.transform.width/a.transform.height;let re=!1;for(let ne=0;ne<ae.length;ne++){const te=ae.get(ne);if(te.writingMode!==o.WritingMode.vertical||re||ne!==0&&ae.get(ne-1).writingMode===o.WritingMode.horizontal||(re=!0),te.hidden||te.writingMode===o.WritingMode.vertical&&!re){bn(te.numGlyphs,Z);continue}re=!1;const ie=new o.pointGeometry(te.tileAnchorX,te.tileAnchorY),se=M?M(ie):[0,0,0],ge=P.projection.projectTilePoint(ie.x,ie.y,k.canonical),be=[ge.x+se[0],ge.y+se[1],ge.z+se[2]],Xe=[...be,1];if(o.transformMat4$1(Xe,Xe,i),!_s(Xe,H)){bn(te.numGlyphs,Z);continue}const Ne=Nr(a.transform.cameraToCenterDistance,Xe[3]),Fe=o.evaluateSizeForFeature(R,N,te),Ae=b?Fe/Ne:Fe*Ne,ve=Vi(new o.pointGeometry(be[0],be[1]),m,be[2]);if(ve.signedDistanceFromCamera<=0){bn(te.numGlyphs,Z);continue}let Re={};const ze=b?null:M,ct=Nl(te,Ae,!1,E,i,m,y,h.glyphOffsetArray,K,Z,ve.point,ie,Re,W,ze,P.projection,k);re=ct.useVertical,ze&&ct.needsFlipping&&(Re={}),(ct.notEnoughRoom||re||ct.needsFlipping&&Nl(te,Ae,!0,E,i,m,y,h.glyphOffsetArray,K,Z,ve.point,ie,Re,W,ze,P.projection,k).notEnoughRoom)&&bn(te.numGlyphs,Z)}d?h.text.dynamicLayoutVertexBuffer.updateData(Z):h.icon.dynamicLayoutVertexBuffer.updateData(Z)}function Ul(h,i,a,d,m,y,b,E,M,k,P,R,N,H,Z){const K=E.glyphStartIndex+E.numGlyphs,ae=E.lineStartIndex,W=E.lineStartIndex+E.lineLength,re=i.getoffsetX(E.glyphStartIndex),ne=i.getoffsetX(K-1),te=Ea(h*re,a,d,m,y,b,E.segment,ae,W,M,k,P,R,N,!0,H,Z);if(!te)return null;const ie=Ea(h*ne,a,d,m,y,b,E.segment,ae,W,M,k,P,R,N,!0,H,Z);return ie?{first:te,last:ie}:null}function Sa(h,i,a,d){return h.writingMode===o.WritingMode.horizontal&&Math.abs(a.y-i.y)>Math.abs(a.x-i.x)*d?{useVertical:!0}:h.writingMode===o.WritingMode.vertical?i.y<a.y?{needsFlipping:!0}:null:h.flipState!==0&&function(m,y,b){const E=(y.x-m.x)*b;return E===0||Math.abs((y.y-m.y)/E)>gi}(i,a,d)?h.flipState===1?{needsFlipping:!0}:null:i.x>a.x?{needsFlipping:!0}:null}function Nl(h,i,a,d,m,y,b,E,M,k,P,R,N,H,Z,K,ae){const W=i/24,re=h.lineOffsetX*W,ne=h.lineOffsetY*W;let te;if(h.numGlyphs>1){const ie=h.glyphStartIndex+h.numGlyphs,se=h.lineStartIndex,ge=h.lineStartIndex+h.lineLength,be=Ul(W,E,re,ne,a,P,R,h,M,y,N,Z,!1,K,ae);if(!be)return{notEnoughRoom:!0};const Xe=Vi(be.first.point,b).point,Ne=Vi(be.last.point,b).point;if(d&&!a){const Fe=Sa(h,Xe,Ne,H);if(h.flipState=Fe&&Fe.needsFlipping?1:2,Fe)return Fe}te=[be.first];for(let Fe=h.glyphStartIndex+1;Fe<ie-1;Fe++)te.push(Ea(W*E.getoffsetX(Fe),re,ne,a,P,R,h.segment,se,ge,M,y,N,Z,!1,!1,K,ae));te.push(be.last)}else{if(d&&!a){const se=Vi(R,m).point,ge=h.lineStartIndex+h.segment+1,be=new o.pointGeometry(M.getx(ge),M.gety(ge)),Xe=Vi(be,m),Ne=Sa(h,se,Xe.signedDistanceFromCamera>0?Xe.point:ys(R,be,se,1,m,void 0,K,ae.canonical),H);if(h.flipState=Ne&&Ne.needsFlipping?1:2,Ne)return Ne}const ie=Ea(W*E.getoffsetX(h.glyphStartIndex),re,ne,a,P,R,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,M,y,N,Z,!1,!1,K,ae);if(!ie)return{notEnoughRoom:!0};te=[ie]}for(const ie of te)o.addDynamicAttributes(k,ie.point,ie.angle);return{}}function gs(h,i,a,d,m){const y=d.projectTilePoint(h.x,h.y,i);if(!m)return Vi(y,a,y.z);const b=m(h);return Vi(new o.pointGeometry(y.x+b[0],y.y+b[1]),a,y.z+b[2])}function ys(h,i,a,d,m,y,b,E){const M=gs(h.add(h.sub(i)._unit()),E,m,b,y).point,k=a.sub(M);return a.add(k._mult(d/k.mag()))}function Ea(h,i,a,d,m,y,b,E,M,k,P,R,N,H,Z,K,ae){const W=d?h-i:h+i;let re=W>0?1:-1,ne=0;d&&(re*=-1,ne=Math.PI),re<0&&(ne+=Math.PI);let te=re>0?E+b:E+b+1,ie=m,se=m,ge=0,be=0;const Xe=Math.abs(W),Ne=[],Fe=[];let Ae=y;const ve=()=>{const We=te-re;return ge===0?y:new o.pointGeometry(k.getx(We),k.gety(We))},Re=()=>ys(ve(),Ae,se,Xe-ge+1,P,N,K,ae.canonical);for(;ge+be<=Xe;){if(te+=re,te<E||te>=M)return null;if(se=ie,Ne.push(ie),H&&Fe.push(Ae||ve()),ie=R[te],ie===void 0){Ae=new o.pointGeometry(k.getx(te),k.gety(te));const We=gs(Ae,ae.canonical,P,K,N);ie=We.signedDistanceFromCamera>0?R[te]=We.point:Re()}else Ae=null;ge+=be,be=se.dist(ie)}Z&&N&&(Ae=Ae||new o.pointGeometry(k.getx(te),k.gety(te)),R[te]=ie=R[te]===void 0?ie:Re(),be=se.dist(ie));const ze=(Xe-ge)/be,ct=ie.sub(se),mt=ct.mult(ze)._add(se);a&&mt._add(ct._unit()._perp()._mult(a*re));const kt=ne+Math.atan2(ie.y-se.y,ie.x-se.x);return Ne.push(mt),H&&(Ae=Ae||new o.pointGeometry(k.getx(te),k.gety(te)),Fe.push(function(We,ft,xt){const ai=1-xt;return new o.pointGeometry(We.x*ai+ft.x*xt,We.y*ai+ft.y*xt)}(Fe.length>0?Fe[Fe.length-1]:Ae,Ae,ze))),{point:mt,angle:kt,path:Ne,tilePath:Fe}}const jl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function bn(h,i){for(let a=0;a<h;a++){const d=i.length;i.resize(d+4),i.float32.set(jl,3*d)}}function Aa(h,i,a){const d=i[0],m=i[1];return h[0]=a[0]*d+a[4]*m+a[12],h[1]=a[1]*d+a[5]*m+a[13],h[3]=a[3]*d+a[7]*m+a[15],h}const Pn=100;class Dd{constructor(i,a,d=new oi(i.width+200,i.height+200,25),m=new oi(i.width+200,i.height+200,25)){this.transform=i,this.grid=d,this.ignoredGrid=m,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Pn,this.screenBottomBoundary=i.height+Pn,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=a}placeCollisionBox(i,a,d,m,y,b,E){let M=a.projectedAnchorX,k=a.projectedAnchorY,P=a.projectedAnchorZ;const R=a.elevation,N=a.tileID;if(R&&N){const te=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),ie=te.upVector(N.canonical,a.tileAnchorX,a.tileAnchorY),se=te.upVectorScale(N.canonical);M+=ie[0]*R*se,k+=ie[1]*R*se,P+=ie[2]*R*se}const H=this.projectAndGetPerspectiveRatio(b,M,k,P,a.tileID),Z=y*H.perspectiveRatio,K=(a.x1*i+d.x-a.padding)*Z+H.point.x,ae=(a.y1*i+d.y-a.padding)*Z+H.point.y,W=(a.x2*i+d.x+a.padding)*Z+H.point.x,re=(a.y2*i+d.y+a.padding)*Z+H.point.y,ne=H.perspectiveRatio<=.55||H.aboveHorizon;return!this.isInsideGrid(K,ae,W,re)||!m&&this.grid.hitTest(K,ae,W,re,E)||ne?{box:[],offscreen:!1}:{box:[K,ae,W,re],offscreen:this.isOffscreen(K,ae,W,re)}}placeCollisionCircles(i,a,d,m,y,b,E,M,k,P,R,N,H,Z){const K=[],ae=this.transform.elevation,W=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),re=ae?ae.getAtTileOffsetFunc(Z,W):ze=>[0,0,0],ne=new o.pointGeometry(a.tileAnchorX,a.tileAnchorY),te=this.transform.projection.projectTilePoint(a.tileAnchorX,a.tileAnchorY,Z.canonical),ie=re(ne),se=[te.x+ie[0],te.y+ie[1],te.z+ie[2]],ge=this.projectAndGetPerspectiveRatio(b,se[0],se[1],se[2],Z),{perspectiveRatio:be}=ge,Xe=(P?y/be:y*be)/o.ONE_EM,Ne=Vi(new o.pointGeometry(se[0],se[1]),E,se[2]).point,Fe=ge.signedDistanceFromCamera>0?Ul(Xe,m,a.lineOffsetX*Xe,a.lineOffsetY*Xe,!1,Ne,ne,a,d,E,{},ae&&!P?re:null,P&&!!ae,this.transform.projection,Z):null;let Ae=!1,ve=!1,Re=!0;if(Fe&&!ge.aboveHorizon){const ze=.5*N*be+H,ct=new o.pointGeometry(-100,-100),mt=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),kt=new ci,We=Fe.first,ft=Fe.last;let xt=[];for(let yt=We.path.length-1;yt>=1;yt--)xt.push(We.path[yt]);for(let yt=1;yt<ft.path.length;yt++)xt.push(ft.path[yt]);const ai=2.5*ze;if(M){const yt=xt.map(ae?(Lt,Ci)=>{const Ji=re(Ci<We.path.length-1?We.tilePath[We.path.length-1-Ci]:ft.tilePath[Ci-We.path.length+2]);return Vi(Lt,M,Ji[2])}:Lt=>Vi(Lt,M));xt=yt.some(Lt=>Lt.signedDistanceFromCamera<=0)?[]:yt.map(Lt=>Lt.point)}let yi=[];if(xt.length>0){const yt=xt[0].clone(),Lt=xt[0].clone();for(let Ci=1;Ci<xt.length;Ci++)yt.x=Math.min(yt.x,xt[Ci].x),yt.y=Math.min(yt.y,xt[Ci].y),Lt.x=Math.max(Lt.x,xt[Ci].x),Lt.y=Math.max(Lt.y,xt[Ci].y);yi=yt.x>=ct.x&&Lt.x<=mt.x&&yt.y>=ct.y&&Lt.y<=mt.y?[xt]:Lt.x<ct.x||yt.x>mt.x||Lt.y<ct.y||yt.y>mt.y?[]:o.clipLine([xt],ct.x,ct.y,mt.x,mt.y)}for(const yt of yi){kt.reset(yt,.25*ze);let Lt=0;Lt=kt.length<=.5*ze?1:Math.ceil(kt.paddedLength/ai)+1;for(let Ci=0;Ci<Lt;Ci++){const Ji=Ci/Math.max(Lt-1,1),kr=kt.lerp(Ji),sn=kr.x+Pn,En=kr.y+Pn;K.push(sn,En,ze,0);const $t=sn-ze,bt=En-ze,Ft=sn+ze,Fi=En+ze;if(Re=Re&&this.isOffscreen($t,bt,Ft,Fi),ve=ve||this.isInsideGrid($t,bt,Ft,Fi),!i&&this.grid.hitTestCircle(sn,En,ze,R)&&(Ae=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Ae}}}}return{circles:!k&&Ae||!ve?[]:K,offscreen:Re,collisionDetected:Ae}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let d=1/0,m=1/0,y=-1/0,b=-1/0;for(const P of i){const R=new o.pointGeometry(P.x+Pn,P.y+Pn);d=Math.min(d,R.x),m=Math.min(m,R.y),y=Math.max(y,R.x),b=Math.max(b,R.y),a.push(R)}const E=this.grid.query(d,m,y,b).concat(this.ignoredGrid.query(d,m,y,b)),M={},k={};for(const P of E){const R=P.key;if(M[R.bucketInstanceId]===void 0&&(M[R.bucketInstanceId]={}),M[R.bucketInstanceId][R.featureIndex])continue;const N=[new o.pointGeometry(P.x1,P.y1),new o.pointGeometry(P.x2,P.y1),new o.pointGeometry(P.x2,P.y2),new o.pointGeometry(P.x1,P.y2)];o.polygonIntersectsPolygon(a,N)&&(M[R.bucketInstanceId][R.featureIndex]=!0,k[R.bucketInstanceId]===void 0&&(k[R.bucketInstanceId]=[]),k[R.bucketInstanceId].push(R.featureIndex))}return k}insertCollisionBox(i,a,d,m,y){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:m,collisionGroupID:y},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,a,d,m,y){const b=a?this.ignoredGrid:this.grid,E={bucketInstanceId:d,featureIndex:m,collisionGroupID:y};for(let M=0;M<i.length;M+=4)b.insertCircle(E,i[M],i[M+1],i[M+2])}projectAndGetPerspectiveRatio(i,a,d,m,y){const b=[a,d,m||0,1];let E=!1;if(m||this.transform.pitch>0){o.transformMat4$1(b,b,i);let M=!1;this.fogState&&y&&(M=function(k,P,R,N,H,Z){const K=Z.calculateFogTileMatrix(H),ae=[P,R,N];return o.transformMat4(ae,ae,K),st(k,ae,Z.pitch,Z._fov)}(this.fogState,a,d,m||0,y.toUnwrapped(),this.transform)>.9),E=b[2]>b[3]||M}else Aa(b,b,i);return{point:new o.pointGeometry((b[0]/b[3]+1)/2*this.transform.width+Pn,(-b[1]/b[3]+1)/2*this.transform.height+Pn),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/b[3]*.5,1.5),signedDistanceFromCamera:b[3],aboveHorizon:E}}isOffscreen(i,a,d,m){return d<Pn||i>=this.screenRightBoundary||m<Pn||a>this.screenBottomBoundary}isInsideGrid(i,a,d,m){return d>=0&&i<this.gridRightBoundary&&m>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const i=o.identity([]);return o.translate(i,i,[-100,-100,0]),i}}class yu{constructor(i,a,d,m){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?a:-a))):m&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class qo{constructor(i,a,d,m,y,b=!1){this.text=new yu(i?i.text:null,a,d,y),this.icon=new yu(i?i.icon:null,a,m,y),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Wo{constructor(i,a,d,m=!1){this.text=i,this.icon=a,this.skipFade=d,this.clipped=m}}class Ca{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class vu{constructor(i,a,d,m,y){this.bucketInstanceId=i,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=m,this.tileID=y}}class xu{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const a=++this.maxGroupID;this.collisionGroups[i]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[i]}}function vs(h,i,a,d,m){const{horizontalAlign:y,verticalAlign:b}=o.getAnchorAlignment(h),E=-(y-.5)*i,M=-(b-.5)*a,k=o.evaluateVariableOffset(h,d);return new o.pointGeometry(E+k[0]*m,M+k[1]*m)}function ao(h,i,a,d,m){const y=new o.pointGeometry(h,i);return a&&y._rotate(d?m:-m),y}class xs{constructor(i,a,d,m,y){this.transform=i.clone(),this.collisionIndex=new Dd(this.transform,y),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new xu(d),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,a,d,m){const y=d.getBucket(a),b=d.latestFeatureIndex;if(!y||!b||a.id!==y.layerIds[0])return;const E=y.layers[0].layout,M=d.collisionBoxArray,k=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),P=d.tileSize/o.EXTENT,R=d.tileID.toUnwrapped(),N=this.transform.calculateProjMatrix(R),H=E.get("text-pitch-alignment")==="map",Z=E.get("text-rotation-alignment")==="map";a.compileFilter();const K=a.dynamicFilter(),ae=a.dynamicFilterNeedsFeature(),W=this.transform.calculatePixelsToTileUnitsMatrix(d),re=en(N,d.tileID.canonical,H,Z,this.transform,W);let ne=null;if(H){const se=tn(N,d.tileID.canonical,H,Z,this.transform,W);ne=o.multiply$1([],this.transform.labelPlaneMatrix,se)}let te=null;K&&d.latestFeatureIndex&&(te={unwrappedTileID:R,dynamicFilter:K,dynamicFilterNeedsFeature:ae,featureIndex:d.latestFeatureIndex}),this.retainedQueryData[y.bucketInstanceId]=new vu(y.bucketInstanceId,b,y.sourceLayerIndex,y.index,d.tileID);const ie={bucket:y,layout:E,posMatrix:N,textLabelPlaneMatrix:re,labelToScreenMatrix:ne,clippingData:te,scale:k,textPixelRatio:P,holdingForFade:d.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(y.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(m)for(const se of y.sortKeyRanges){const{sortKey:ge,symbolInstanceStart:be,symbolInstanceEnd:Xe}=se;i.push({sortKey:ge,symbolInstanceStart:be,symbolInstanceEnd:Xe,parameters:ie})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(i,a,d,m,y,b,E,M,k,P,R,N,H,Z,K,ae,W,re){const ne=[N.textOffset0,N.textOffset1],te=vs(i,d,m,ne,y),ie=this.collisionIndex.placeCollisionBox(y,a,ao(te.x,te.y,b,E,this.transform.angle),R,M,k,P.predicate);if((!ae||this.collisionIndex.placeCollisionBox(Z.getSymbolInstanceIconSize(re,this.transform.zoom,H),ae,ao(te.x,te.y,b,E,this.transform.angle),R,M,k,P.predicate).box.length!==0)&&ie.box.length>0){let se;return this.prevPlacement&&this.prevPlacement.variableOffsets[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID].text&&(se=this.prevPlacement.variableOffsets[N.crossTileID].anchor),this.variableOffsets[N.crossTileID]={textOffset:ne,width:d,height:m,anchor:i,textScale:y,prevAnchor:se},this.markUsedJustification(Z,i,N,K),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,K,N),this.placedOrientations[N.crossTileID]=K),{shift:te,placedGlyphBoxes:ie}}}placeLayerBucketPart(i,a,d,m){const{bucket:y,layout:b,posMatrix:E,textLabelPlaneMatrix:M,labelToScreenMatrix:k,clippingData:P,textPixelRatio:R,holdingForFade:N,collisionBoxArray:H,partiallyEvaluatedTextSize:Z,partiallyEvaluatedIconSize:K,collisionGroup:ae}=i.parameters,W=b.get("text-optional"),re=b.get("icon-optional"),ne=b.get("text-allow-overlap"),te=b.get("icon-allow-overlap"),ie=b.get("text-rotation-alignment")==="map",se=b.get("text-pitch-alignment")==="map",ge=b.get("icon-text-fit")!=="none",be=b.get("symbol-z-order")==="viewport-y",Xe=ne&&(te||!y.hasIconData()||re),Ne=te&&(ne||!y.hasTextData()||W);!y.collisionArrays&&H&&y.deserializeCollisionBoxes(H),d&&m&&y.updateCollisionDebugBuffers(this.transform.zoom,H);const Fe=(Ae,ve,Re)=>{if(P){const $t={zoom:this.transform.zoom,pitch:this.transform.pitch};let bt=null;if(P.dynamicFilterNeedsFeature){const Ft=this.retainedQueryData[y.bucketInstanceId];bt=P.featureIndex.loadFeature({featureIndex:Ae.featureIndex,bucketIndex:Ft.bucketIndex,sourceLayerIndex:Ft.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,P.dynamicFilter)($t,bt,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new o.pointGeometry(Ae.tileAnchorX,Ae.tileAnchorY),this.transform.calculateDistanceTileData(P.unwrappedTileID)))return this.placements[Ae.crossTileID]=new Wo(!1,!1,!1,!0),void(a[Ae.crossTileID]=!0)}if(a[Ae.crossTileID])return;if(N)return void(this.placements[Ae.crossTileID]=new Wo(!1,!1,!1));let ze=!1,ct=!1,mt=!0,kt=null,We={box:null,offscreen:null},ft={box:null,offscreen:null},xt=null,ai=null,yi=null,yt=0,Lt=0,Ci=0;Re.textFeatureIndex?yt=Re.textFeatureIndex:Ae.useRuntimeCollisionCircles&&(yt=Ae.featureIndex),Re.verticalTextFeatureIndex&&(Lt=Re.verticalTextFeatureIndex);const Ji=$t=>{$t.tileID=this.retainedQueryData[y.bucketInstanceId].tileID,(this.transform.elevation||$t.elevation)&&($t.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[y.bucketInstanceId].tileID,$t.tileAnchorX,$t.tileAnchorY):0)},kr=Re.textBox;if(kr){Ji(kr);const $t=Ft=>{let Fi=o.WritingMode.horizontal;if(y.allowVerticalPlacement&&!Ft&&this.prevPlacement){const Vr=this.prevPlacement.placedOrientations[Ae.crossTileID];Vr&&(this.placedOrientations[Ae.crossTileID]=Vr,Fi=Vr,this.markUsedOrientation(y,Fi,Ae))}return Fi},bt=(Ft,Fi)=>{if(y.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&Re.verticalTextBox){for(const Vr of y.writingModes)if(Vr===o.WritingMode.vertical?(We=Fi(),ft=We):We=Ft(),We&&We.box&&We.box.length)break}else We=Ft()};if(b.get("text-variable-anchor")){let Ft=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ae.crossTileID]){const Ei=this.prevPlacement.variableOffsets[Ae.crossTileID];Ft.indexOf(Ei.anchor)>0&&(Ft=Ft.filter($r=>$r!==Ei.anchor),Ft.unshift(Ei.anchor))}const Fi=(Ei,$r,Ja)=>{const zr=y.getSymbolInstanceTextSize(Z,Ae,this.transform.zoom,ve),Lo=(Ei.x2-Ei.x1)*zr+2*Ei.padding,nt=(Ei.y2-Ei.y1)*zr+2*Ei.padding,pt=ge&&!te?$r:null;pt&&Ji(pt);let or={box:[],offscreen:!1};const Ro=ne?2*Ft.length:Ft.length;for(let yo=0;yo<Ro;++yo){const hr=this.attemptAnchorPlacement(Ft[yo%Ft.length],Ei,Lo,nt,zr,ie,se,R,E,ae,yo>=Ft.length,Ae,ve,y,Ja,pt,Z,K);if(hr&&(or=hr.placedGlyphBoxes,or&&or.box&&or.box.length)){ze=!0,kt=hr.shift;break}}return or};bt(()=>Fi(kr,Re.iconBox,o.WritingMode.horizontal),()=>{const Ei=Re.verticalTextBox;return Ei&&Ji(Ei),y.allowVerticalPlacement&&!(We&&We.box&&We.box.length)&&Ae.numVerticalGlyphVertices>0&&Ei?Fi(Ei,Re.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),We&&(ze=We.box,mt=We.offscreen);const Vr=$t(We&&We.box);if(!ze&&this.prevPlacement){const Ei=this.prevPlacement.variableOffsets[Ae.crossTileID];Ei&&(this.variableOffsets[Ae.crossTileID]=Ei,this.markUsedJustification(y,Ei.anchor,Ae,Vr))}}else{const Ft=(Fi,Vr)=>{const Ei=y.getSymbolInstanceTextSize(Z,Ae,this.transform.zoom,ve),$r=this.collisionIndex.placeCollisionBox(Ei,Fi,new o.pointGeometry(0,0),ne,R,E,ae.predicate);return $r&&$r.box&&$r.box.length&&(this.markUsedOrientation(y,Vr,Ae),this.placedOrientations[Ae.crossTileID]=Vr),$r};bt(()=>Ft(kr,o.WritingMode.horizontal),()=>{const Fi=Re.verticalTextBox;return y.allowVerticalPlacement&&Ae.numVerticalGlyphVertices>0&&Fi?(Ji(Fi),Ft(Fi,o.WritingMode.vertical)):{box:null,offscreen:null}}),$t(We&&We.box&&We.box.length)}}if(xt=We,ze=xt&&xt.box&&xt.box.length>0,mt=xt&&xt.offscreen,Ae.useRuntimeCollisionCircles){const $t=y.text.placedSymbolArray.get(Ae.centerJustifiedTextSymbolIndex>=0?Ae.centerJustifiedTextSymbolIndex:Ae.verticalPlacedTextSymbolIndex),bt=o.evaluateSizeForFeature(y.textSizeData,Z,$t),Ft=b.get("text-padding");ai=this.collisionIndex.placeCollisionCircles(ne,$t,y.lineVertexArray,y.glyphOffsetArray,bt,E,M,k,d,se,ae.predicate,Ae.collisionCircleDiameter*bt/o.ONE_EM,Ft,this.retainedQueryData[y.bucketInstanceId].tileID),ze=ne||ai.circles.length>0&&!ai.collisionDetected,mt=mt&&ai.offscreen}if(Re.iconFeatureIndex&&(Ci=Re.iconFeatureIndex),Re.iconBox){const $t=bt=>{Ji(bt);const Ft=ge&&kt?ao(kt.x,kt.y,ie,se,this.transform.angle):new o.pointGeometry(0,0),Fi=y.getSymbolInstanceIconSize(K,this.transform.zoom,ve);return this.collisionIndex.placeCollisionBox(Fi,bt,Ft,te,R,E,ae.predicate)};ft&&ft.box&&ft.box.length&&Re.verticalIconBox?(yi=$t(Re.verticalIconBox),ct=yi.box.length>0):(yi=$t(Re.iconBox),ct=yi.box.length>0),mt=mt&&yi.offscreen}const sn=W||Ae.numHorizontalGlyphVertices===0&&Ae.numVerticalGlyphVertices===0,En=re||Ae.numIconVertices===0;if(sn||En?En?sn||(ct=ct&&ze):ze=ct&&ze:ct=ze=ct&&ze,ze&&xt&&xt.box&&this.collisionIndex.insertCollisionBox(xt.box,b.get("text-ignore-placement"),y.bucketInstanceId,ft&&ft.box&&Lt?Lt:yt,ae.ID),ct&&yi&&this.collisionIndex.insertCollisionBox(yi.box,b.get("icon-ignore-placement"),y.bucketInstanceId,Ci,ae.ID),ai&&(ze&&this.collisionIndex.insertCollisionCircles(ai.circles,b.get("text-ignore-placement"),y.bucketInstanceId,yt,ae.ID),d)){const $t=y.bucketInstanceId;let bt=this.collisionCircleArrays[$t];bt===void 0&&(bt=this.collisionCircleArrays[$t]=new Ca);for(let Ft=0;Ft<ai.circles.length;Ft+=4)bt.circles.push(ai.circles[Ft+0]),bt.circles.push(ai.circles[Ft+1]),bt.circles.push(ai.circles[Ft+2]),bt.circles.push(ai.collisionDetected?1:0)}this.placements[Ae.crossTileID]=new Wo(ze||Xe,ct||Ne,mt||y.justReloaded),a[Ae.crossTileID]=!0};if(be){const Ae=y.getSortedSymbolIndexes(this.transform.angle);for(let ve=Ae.length-1;ve>=0;--ve){const Re=Ae[ve];Fe(y.symbolInstances.get(Re),Re,y.collisionArrays[Re])}}else for(let Ae=i.symbolInstanceStart;Ae<i.symbolInstanceEnd;Ae++)Fe(y.symbolInstances.get(Ae),Ae,y.collisionArrays[Ae]);if(d&&y.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[y.bucketInstanceId];o.invert(Ae.invProjMatrix,E),Ae.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(i,a,d,m){let y;y=m===o.WritingMode.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(a)];const b=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const E of b)E>=0&&(i.text.placedSymbolArray.get(E).crossTileID=y>=0&&E!==y?0:d.crossTileID)}markUsedOrientation(i,a,d){const m=a===o.WritingMode.horizontal||a===o.WritingMode.horizontalOnly?a:0,y=a===o.WritingMode.vertical?a:0,b=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const E of b)i.text.placedSymbolArray.get(E).placedOrientation=m;d.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const m=a?a.symbolFadeChange(i):1,y=a?a.opacities:{},b=a?a.variableOffsets:{},E=a?a.placedOrientations:{};for(const M in this.placements){const k=this.placements[M],P=y[M];P?(this.opacities[M]=new qo(P,m,k.text,k.icon,null,k.clipped),d=d||k.text!==P.text.placed||k.icon!==P.icon.placed):(this.opacities[M]=new qo(null,m,k.text,k.icon,k.skipFade,k.clipped),d=d||k.text||k.icon)}for(const M in y){const k=y[M];if(!this.opacities[M]){const P=new qo(k,m,!1,!1);P.isHidden()||(this.opacities[M]=P,d=d||k.text.placed||k.icon.placed)}}for(const M in b)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=b[M]);for(const M in E)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=E[M]);d?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:i)}updateLayerOpacities(i,a){const d={};for(const m of a){const y=m.getBucket(i);y&&m.latestFeatureIndex&&i.id===y.layerIds[0]&&this.updateBucketOpacities(y,d,m.collisionBoxArray)}}updateBucketOpacities(i,a,d){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const m=i.layers[0].layout,y=!!i.layers[0].dynamicFilter(),b=new qo(null,0,!1,!1,!0),E=m.get("text-allow-overlap"),M=m.get("icon-allow-overlap"),k=m.get("text-variable-anchor"),P=m.get("text-rotation-alignment")==="map",R=m.get("text-pitch-alignment")==="map",N=m.get("icon-text-fit")!=="none",H=new qo(null,0,E&&(M||!i.hasIconData()||m.get("icon-optional")),M&&(E||!i.hasTextData()||m.get("text-optional")),!0);!i.collisionArrays&&d&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(d);const Z=(ae,W,re)=>{for(let ne=0;ne<W/4;ne++)ae.opacityVertexArray.emplaceBack(re)};let K=0;for(let ae=0;ae<i.symbolInstances.length;ae++){const W=i.symbolInstances.get(ae),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:ne,crossTileID:te}=W;let ie=this.opacities[te];a[te]?ie=b:ie||(ie=H,this.opacities[te]=ie),a[te]=!0;const se=re>0||ne>0,ge=W.numIconVertices>0,be=this.placedOrientations[W.crossTileID],Xe=be===o.WritingMode.vertical,Ne=be===o.WritingMode.horizontal||be===o.WritingMode.horizontalOnly;if(!se&&!ge||ie.isHidden()||K++,se){const Fe=bs(ie.text);Z(i.text,re,Xe?co:Fe),Z(i.text,ne,Ne?co:Fe);const Ae=ie.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(ze=>{ze>=0&&(i.text.placedSymbolArray.get(ze).hidden=Ae||Xe?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=Ae||Ne?1:0);const ve=this.variableOffsets[W.crossTileID];ve&&this.markUsedJustification(i,ve.anchor,W,be);const Re=this.placedOrientations[W.crossTileID];Re&&(this.markUsedJustification(i,"left",W,Re),this.markUsedOrientation(i,Re,W))}if(ge){const Fe=bs(ie.icon);W.placedIconSymbolIndex>=0&&(Z(i.icon,W.numIconVertices,Xe?co:Fe),i.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=ie.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(Z(i.icon,W.numVerticalIconVertices,Ne?co:Fe),i.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=ie.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Fe=i.collisionArrays[ae];if(Fe){let Ae=new o.pointGeometry(0,0),ve=!0;if(Fe.textBox||Fe.verticalTextBox){if(k){const ze=this.variableOffsets[te];ze?(Ae=vs(ze.anchor,ze.width,ze.height,ze.textOffset,ze.textScale),P&&Ae._rotate(R?this.transform.angle:-this.transform.angle)):ve=!1}y&&(ve=!ie.clipped),Fe.textBox&&so(i.textCollisionBox.collisionVertexArray,ie.text.placed,!ve||Xe,Ae.x,Ae.y),Fe.verticalTextBox&&so(i.textCollisionBox.collisionVertexArray,ie.text.placed,!ve||Ne,Ae.x,Ae.y)}const Re=ve&&Boolean(!Ne&&Fe.verticalIconBox);Fe.iconBox&&so(i.iconCollisionBox.collisionVertexArray,ie.icon.placed,Re,N?Ae.x:0,N?Ae.y:0),Fe.verticalIconBox&&so(i.iconCollisionBox.collisionVertexArray,ie.icon.placed,!Re,N?Ae.x:0,N?Ae.y:0)}}}if(i.fullyClipped=K===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ae.invProjMatrix,i.placementViewportMatrix=ae.viewportMatrix,i.collisionCircleArray=ae.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,a){const d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>i}setStale(){this.stale=!0}}function so(h,i,a,d,m){h.emplaceBack(i?1:0,a?1:0,d||0,m||0),h.emplaceBack(i?1:0,a?1:0,d||0,m||0),h.emplaceBack(i?1:0,a?1:0,d||0,m||0),h.emplaceBack(i?1:0,a?1:0,d||0,m||0)}const Ee=Math.pow(2,25),et=Math.pow(2,24),bu=Math.pow(2,17),lo=Math.pow(2,16),$i=Math.pow(2,9),jn=Math.pow(2,8),Dn=Math.pow(2,1);function bs(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const i=h.placed?1:0,a=Math.floor(127*h.opacity);return a*Ee+i*et+a*bu+i*lo+a*$i+i*jn+a*Dn+i}const co=0;class Qe{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,a,d,m,y){const b=this._bucketParts;for(;this._currentTileIndex<i.length;)if(a.getBucketParts(b,m,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((E,M)=>E.sortKey-M.sortKey));this._currentPartIndex<b.length;){const E=b[this._currentPartIndex];if(a.placeLayerBucketPart(E,this._seenCrossTileIDs,d,E.symbolInstanceStart===0),this._currentPartIndex++,y())return!0}return!1}}class Ot{constructor(i,a,d,m,y,b,E,M){this.placement=new xs(i,y,b,E,M),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(i,a,d){const m=o.exported.now(),y=()=>{const b=o.exported.now()-m;return!this._forceFullPlacement&&b>2};for(;this._currentPlacementIndex>=0;){const b=a[i[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=E)&&(!b.maxzoom||b.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new Qe(b)),this._inProgressLayer.continuePlacement(d[b.source],this.placement,this._showCollisionBoxes,b,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const zt=512/o.EXTENT/2;class Ln{constructor(i,a,d){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=d;for(let m=0;m<a.length;m++){const y=a.get(m),b=y.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:y.crossTileID,coord:this.getScaledCoordinates(y,i)})}}getScaledCoordinates(i,a){const d=zt/Math.pow(2,a.canonical.z-this.tileID.canonical.z);return{x:Math.floor((a.canonical.x*o.EXTENT+i.tileAnchorX)*d),y:Math.floor((a.canonical.y*o.EXTENT+i.tileAnchorY)*d)}}findMatches(i,a,d){const m=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let y=0;y<i.length;y++){const b=i.get(y);if(b.crossTileID)continue;const E=this.indexedSymbolInstances[b.key];if(!E)continue;const M=this.getScaledCoordinates(b,a);for(const k of E)if(Math.abs(k.coord.x-M.x)<=m&&Math.abs(k.coord.y-M.y)<=m&&!d[k.crossTileID]){d[k.crossTileID]=!0,b.crossTileID=k.crossTileID;break}}}}class Xo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Pt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const a=Math.round((i-this.lng)/360);if(a!==0)for(const d in this.indexes){const m=this.indexes[d],y={};for(const b in m){const E=m[b];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+a),y[E.tileID.key]=E}this.indexes[d]=y}this.lng=i}addBucket(i,a,d){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let y=0;y<a.symbolInstances.length;y++)a.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const m=this.usedCrossTileIDs[i.overscaledZ];for(const y in this.indexes){const b=this.indexes[y];if(Number(y)>i.overscaledZ)for(const E in b){const M=b[E];M.tileID.isChildOf(i)&&M.findMatches(a.symbolInstances,i,m)}else{const E=b[i.scaledTo(Number(y)).key];E&&E.findMatches(a.symbolInstances,i,m)}}for(let y=0;y<a.symbolInstances.length;y++){const b=a.symbolInstances.get(y);b.crossTileID||(b.crossTileID=d.generate(),m[b.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Ln(i,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(i,a){for(const d in a.indexedSymbolInstances)for(const m of a.indexedSymbolInstances[d])delete this.usedCrossTileIDs[i][m.crossTileID]}removeStaleBuckets(i){let a=!1;for(const d in this.indexes){const m=this.indexes[d];for(const y in m)i[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,m[y]),delete m[y],a=!0)}return a}}class Ia{constructor(){this.layerIndexes={},this.crossTileIDs=new Xo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,a,d,m){let y=this.layerIndexes[i.id];y===void 0&&(y=this.layerIndexes[i.id]=new Pt);let b=!1;const E={};m.name!=="globe"&&y.handleWrapJump(d);for(const M of a){const k=M.getBucket(i);k&&i.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(M.tileID,k,this.crossTileIDs)&&(b=!0),E[k.bucketInstanceId]=!0)}return y.removeStaleBuckets(E)&&(b=!0),b}pruneUnusedLayers(i){const a={};i.forEach(d=>{a[d]=!0});for(const d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}const uo=(h,i)=>o.emitValidationErrors(h,i&&i.filter(a=>a.identifier!=="source.canvas")),Ma=o.pick(Pe,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),rn=o.pick(Pe,["setCenter","setZoom","setBearing","setPitch"]),Bi=function(){const h={},i=o.spec.$version;for(const a in o.spec.$root){const d=o.spec.$root[a];if(d.required){let m=null;m=a==="version"?i:d.type==="array"?[]:{},m!=null&&(h[a]=m)}}return h}(),Ld={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ir extends o.Evented{constructor(i,a={}){super(),this.map=i,this.dispatcher=new Ni(ue(),this),this.imageManager=new Le,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(i._requestManager,a.localFontFamily?o.LocalGlyphMode.all:a.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,a.localFontFamily||a.localIdeographFontFamily),this.lineAtlas=new o.LineAtlas(256,512),this.crossTileSymbolIndex=new Ia,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const d=this;this._rtlTextPluginCallback=Ir.registerForPluginStateChange(m=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(y,b)=>{if(o.triggerPluginCompletionEvent(y),b&&b.every(E=>E))for(const E in d._sourceCaches){const M=d._sourceCaches[E],k=M.getSource().type;k!=="vector"&&k!=="geojson"||M.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const y=this.getSource(m.sourceId);if(y&&y.vectorLayerIds)for(const b in this._layers){const E=this._layers[b];E.source===y.id&&this._validateLayer(E)}})}loadURL(i,a={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const d=typeof a.validate=="boolean"?a.validate:!o.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,a.accessToken);const m=this.map._requestManager.transformRequest(i,o.ResourceType.Style);this._request=o.getJSON(m,(y,b)=>{this._request=null,y?this.fire(new o.ErrorEvent(y)):b&&this._load(b,d)})}loadJSON(i,a={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(i,a.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(Bi,!1)}_updateLayerCount(i,a){const d=a?1:-1;i.is3D()&&(this._num3DLayers+=d),i.type==="circle"&&(this._numCircleLayers+=d),i.type==="symbol"&&(this._numSymbolLayers+=d)}_load(i,a){if(a&&uo(this,o.validateStyle(i)))return;this._loaded=!0,this.stylesheet=i,this.updateProjection();for(const m in i.sources)this.addSource(m,i.sources[m],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const d=Ie(this.stylesheet.layers);this._order=d.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of d)m=o.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize(),this._updateLayerCount(m,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Se(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&this.terrain.drapeRenderMode===0}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const i=this.map.transform.projection,a=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),d=this.map.transform.projection;if(this._loaded&&(d.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),a){if(d.isReprojectedInTileSpace||i.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const m in this._sourceCaches)this._sourceCaches[m].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(i){this._spriteRequest=function(a,d,m){let y,b,E;const M=o.exported.devicePixelRatio>1?"@2x":"";let k=o.getJSON(d.transformRequest(d.normalizeSpriteURL(a,M,".json"),o.ResourceType.SpriteJSON),(N,H)=>{k=null,E||(E=N,y=H,R())}),P=o.getImage(d.transformRequest(d.normalizeSpriteURL(a,M,".png"),o.ResourceType.SpriteImage),(N,H)=>{P=null,E||(E=N,b=H,R())});function R(){if(E)m(E);else if(y&&b){const N=o.exported.getImageData(b),H={};for(const Z in y){const{width:K,height:ae,x:W,y:re,sdf:ne,pixelRatio:te,stretchX:ie,stretchY:se,content:ge}=y[Z],be=new o.RGBAImage({width:K,height:ae});o.RGBAImage.copy(N,be,{x:W,y:re},{x:0,y:0},{width:K,height:ae}),H[Z]={data:be,pixelRatio:te,sdf:ne,stretchX:ie,stretchY:se,content:ge}}m(null,H)}}return{cancel(){k&&(k.cancel(),k=null),P&&(P.cancel(),P=null)}}}(i,this.map._requestManager,(a,d)=>{if(this._spriteRequest=null,a)this.fire(new o.ErrorEvent(a));else if(d)for(const m in d)this.imageManager.addImage(m,d[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(i){const a=this.getSource(i.source);if(!a)return;const d=i.sourceLayer;d&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(d)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${d}" does not exist on source "${a.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const a=[];for(const d of i){const m=this._layers[d];m.type!=="custom"&&a.push(m.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&Ld[i.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const a=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(m.length||y.length)&&this._updateWorkerLayers(m,y);for(const b in this._updatedSources){const E=this._updatedSources[b];E==="reload"?this._reloadSource(b):E==="clear"&&this._clearSource(b)}this._updateTilesForChangedImages();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const d={};for(const m in this._sourceCaches){const y=this._sourceCaches[m];d[m]=y.used,y.used=!1}for(const m of this._order){const y=this._layers[m];if(y.recalculate(i,this._availableImages),!y.isHidden(i.zoom)){const E=this._getLayerSourceCache(y);E&&(E.used=!0)}const b=this.map.painter;if(b){const E=y.getProgramIds();if(!E)continue;const M=y.getProgramConfiguration(i.zoom);for(const k of E)b.useProgram(k,M)}}for(const m in d){const y=this._sourceCaches[m];d[m]!==y.used&&y.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:y.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),a&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),uo(this,o.validateStyle(i)))return!1;(i=o.clone$1(i)).layers=Ie(i.layers);const a=function(m,y){if(!m)return[{command:Pe.setStyle,args:[y]}];let b=[];try{if(!J(m.version,y.version))return[{command:Pe.setStyle,args:[y]}];J(m.center,y.center)||b.push({command:Pe.setCenter,args:[y.center]}),J(m.zoom,y.zoom)||b.push({command:Pe.setZoom,args:[y.zoom]}),J(m.bearing,y.bearing)||b.push({command:Pe.setBearing,args:[y.bearing]}),J(m.pitch,y.pitch)||b.push({command:Pe.setPitch,args:[y.pitch]}),J(m.sprite,y.sprite)||b.push({command:Pe.setSprite,args:[y.sprite]}),J(m.glyphs,y.glyphs)||b.push({command:Pe.setGlyphs,args:[y.glyphs]}),J(m.transition,y.transition)||b.push({command:Pe.setTransition,args:[y.transition]}),J(m.light,y.light)||b.push({command:Pe.setLight,args:[y.light]}),J(m.fog,y.fog)||b.push({command:Pe.setFog,args:[y.fog]}),J(m.projection,y.projection)||b.push({command:Pe.setProjection,args:[y.projection]});const E={},M=[];(function(R,N,H,Z){let K;for(K in N=N||{},R=R||{})R.hasOwnProperty(K)&&(N.hasOwnProperty(K)||lt(K,H,Z));for(K in N)N.hasOwnProperty(K)&&(R.hasOwnProperty(K)?J(R[K],N[K])||(R[K].type==="geojson"&&N[K].type==="geojson"&&ht(R,N,K)?H.push({command:Pe.setGeoJSONSourceData,args:[K,N[K].data]}):ut(K,N,H,Z)):Be(K,N,H))})(m.sources,y.sources,M,E);const k=[];m.layers&&m.layers.forEach(R=>{E[R.source]?b.push({command:Pe.removeLayer,args:[R.id]}):k.push(R)});let P=m.terrain;P&&E[P.source]&&(b.push({command:Pe.setTerrain,args:[void 0]}),P=void 0),b=b.concat(M),J(P,y.terrain)||b.push({command:Pe.setTerrain,args:[y.terrain]}),function(R,N,H){N=N||[];const Z=(R=R||[]).map(Mt),K=N.map(Mt),ae=R.reduce(ri,{}),W=N.reduce(ri,{}),re=Z.slice(),ne=Object.create(null);let te,ie,se,ge,be,Xe,Ne;for(te=0,ie=0;te<Z.length;te++)se=Z[te],W.hasOwnProperty(se)?ie++:(H.push({command:Pe.removeLayer,args:[se]}),re.splice(re.indexOf(se,ie),1));for(te=0,ie=0;te<K.length;te++)se=K[K.length-1-te],re[re.length-1-te]!==se&&(ae.hasOwnProperty(se)?(H.push({command:Pe.removeLayer,args:[se]}),re.splice(re.lastIndexOf(se,re.length-ie),1)):ie++,Xe=re[re.length-te],H.push({command:Pe.addLayer,args:[W[se],Xe]}),re.splice(re.length-te,0,se),ne[se]=!0);for(te=0;te<K.length;te++)if(se=K[te],ge=ae[se],be=W[se],!ne[se]&&!J(ge,be))if(J(ge.source,be.source)&&J(ge["source-layer"],be["source-layer"])&&J(ge.type,be.type)){for(Ne in dt(ge.layout,be.layout,H,se,null,Pe.setLayoutProperty),dt(ge.paint,be.paint,H,se,null,Pe.setPaintProperty),J(ge.filter,be.filter)||H.push({command:Pe.setFilter,args:[se,be.filter]}),J(ge.minzoom,be.minzoom)&&J(ge.maxzoom,be.maxzoom)||H.push({command:Pe.setLayerZoomRange,args:[se,be.minzoom,be.maxzoom]}),ge)ge.hasOwnProperty(Ne)&&Ne!=="layout"&&Ne!=="paint"&&Ne!=="filter"&&Ne!=="metadata"&&Ne!=="minzoom"&&Ne!=="maxzoom"&&(Ne.indexOf("paint.")===0?dt(ge[Ne],be[Ne],H,se,Ne.slice(6),Pe.setPaintProperty):J(ge[Ne],be[Ne])||H.push({command:Pe.setLayerProperty,args:[se,Ne,be[Ne]]}));for(Ne in be)be.hasOwnProperty(Ne)&&!ge.hasOwnProperty(Ne)&&Ne!=="layout"&&Ne!=="paint"&&Ne!=="filter"&&Ne!=="metadata"&&Ne!=="minzoom"&&Ne!=="maxzoom"&&(Ne.indexOf("paint.")===0?dt(ge[Ne],be[Ne],H,se,Ne.slice(6),Pe.setPaintProperty):J(ge[Ne],be[Ne])||H.push({command:Pe.setLayerProperty,args:[se,Ne,be[Ne]]}))}else H.push({command:Pe.removeLayer,args:[se]}),Xe=re[re.lastIndexOf(se)+1],H.push({command:Pe.addLayer,args:[be,Xe]})}(k,y.layers,b)}catch(E){console.warn("Unable to compute style diff:",E),b=[{command:Pe.setStyle,args:[y]}]}return b}(this.serialize(),i).filter(m=>!(m.command in rn));if(a.length===0)return!1;const d=a.filter(m=>!(m.command in Ma));if(d.length>0)throw new Error(`Unimplemented: ${d.map(m=>m.command).join(", ")}.`);return a.forEach(m=>{m.command!=="setTransition"&&this[m.command].apply(this,m.args)}),this.stylesheet=i,this.updateProjection(),!0}addImage(i,a){if(this.getImage(i))return this.fire(new o.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(i,a),this._afterImageUpdated(i)}updateImage(i,a){this.imageManager.updateImage(i,a)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new o.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,a,d={}){if(this._checkLoaded(),this.getSource(i)!==void 0)throw new Error("There is already a source with this ID");if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(o.validateStyle.source,`sources.${i}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const m=zi(i,a,this.dispatcher,this);m.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:m.serialize(),sourceId:i}));const y=b=>{const E=(b?"symbol:":"other:")+i,M=this._sourceCaches[E]=new o.SourceCache(E,m,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[i]=M,M.style=this,M.onAdd(this.map)};y(!1),a.type!=="vector"&&a.type!=="geojson"||y(!0),m.onAdd&&m.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const a=this.getSource(i);if(a===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===i)return this.fire(new o.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new o.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const d=this._getSourceCaches(i);for(const m of d)delete this._sourceCaches[m.id],delete this._updatedSources[m.id],m.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles();delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,a){this._checkLoaded(),this.getSource(i).setData(a),this._changed=!0}getSource(i){const a=this._getSourceCache(i);return a&&a.getSource()}addLayer(i,a,d={}){this._checkLoaded();const m=i.id;if(this.getLayer(m))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${m}" already exists on this map`)));let y;if(i.type==="custom"){if(uo(this,o.validateCustomStyleLayer(i)))return;y=o.createStyleLayer(i)}else{if(typeof i.source=="object"&&(this.addSource(m,i.source),i=o.clone$1(i),i=o.extend(i,{source:m})),this._validate(o.validateStyle.layer,`layers.${m}`,i,{arrayIndex:-1},d))return;y=o.createStyleLayer(i),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0)}const b=a?this._order.indexOf(a):this._order.length;if(a&&b===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`)));this._order.splice(b,0,m),this._layerOrderChanged=!0,this._layers[m]=y;const E=this._getLayerSourceCache(y);if(this._removedLayers[m]&&y.source&&E&&y.type!=="custom"){const M=this._removedLayers[m];delete this._removedLayers[m],M.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",E.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,a){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===a)return;const d=this._order.indexOf(i);this._order.splice(d,1);const m=a?this._order.indexOf(a):this._order.length;a&&m===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`))):(this._order.splice(m,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const a=this._layers[i];if(!a)return void this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));a.setEventedParent(null),this._updateLayerCount(a,!1);const d=this._order.indexOf(i);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=a,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],a.onRemove&&a.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const a in this._layers)if(this._layers[a].type===i)return!0;return!1}setLayerZoomRange(i,a,d){this._checkLoaded();const m=this.getLayer(i);m?m.minzoom===a&&m.maxzoom===d||(a!=null&&(m.minzoom=a),d!=null&&(m.maxzoom=d),this._updateLayer(m)):this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,a,d={}){this._checkLoaded();const m=this.getLayer(i);if(m){if(!J(m.filter,a))return a==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(o.validateStyle.filter,`layers.${m.id}.filter`,a,{layerType:m.type},d)||(m.filter=o.clone$1(a),this._updateLayer(m)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){return o.clone$1(this.getLayer(i).filter)}setLayoutProperty(i,a,d,m={}){this._checkLoaded();const y=this.getLayer(i);y?J(y.getLayoutProperty(a),d)||(y.setLayoutProperty(a,d,m),this._updateLayer(y)):this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,a){const d=this.getLayer(i);if(d)return d.getLayoutProperty(a);this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,a,d,m={}){this._checkLoaded();const y=this.getLayer(i);y?J(y.getPaintProperty(a),d)||(y.setPaintProperty(a,d,m)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,a){return this.getLayer(i).getPaintProperty(a)}setFeatureState(i,a){this._checkLoaded();const d=i.source,m=i.sourceLayer,y=this.getSource(d);if(y===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const b=y.type;if(b==="geojson"&&m)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!m)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const E=this._getSourceCaches(d);for(const M of E)M.setFeatureState(m,i.id,a)}removeFeatureState(i,a){this._checkLoaded();const d=i.source,m=this.getSource(d);if(m===void 0)return void this.fire(new o.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const y=m.type,b=y==="vector"?i.sourceLayer:void 0;if(y==="vector"&&!b)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const E=this._getSourceCaches(d);for(const M of E)M.removeFeatureState(b,i.id,a)}getFeatureState(i){this._checkLoaded();const a=i.source,d=i.sourceLayer,m=this.getSource(a);if(m!==void 0){if(m.type!=="vector"||d)return i.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(a)[0].getFeatureState(d,i.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const a in this._sourceCaches){const d=this._sourceCaches[a].getSource();i[d.id]||(i[d.id]=d.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},a=>a!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0;const a=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&a&&a.getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",a.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const a=b=>this._layers[b].type==="fill-extrusion",d={},m=[];for(let b=this._order.length-1;b>=0;b--){const E=this._order[b];if(a(E)){d[E]=b;for(const M of i){const k=M[E];if(k)for(const P of k)m.push(P)}}}m.sort((b,E)=>E.intersectionZ-b.intersectionZ);const y=[];for(let b=this._order.length-1;b>=0;b--){const E=this._order[b];if(a(E))for(let M=m.length-1;M>=0;M--){const k=m[M].feature;if(d[k.layer.id]<b)break;y.push(k),m.pop()}else for(const M of i){const k=M[E];if(k)for(const P of k)y.push(P.feature)}}return y}queryRenderedFeatures(i,a,d){a&&a.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",a.filter,null,a);const m={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const M of a.layers){const k=this._layers[M];if(!k)return this.fire(new o.ErrorEvent(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];m[k.source]=!0}}const y=[];a.availableImages=this._availableImages;const b=a&&a.layers?a.layers.some(M=>{const k=this.getLayer(M);return k&&k.is3D()}):this.has3DLayers(),E=li.createFromScreenPoints(i,d);for(const M in this._sourceCaches){const k=this._sourceCaches[M].getSource().id;a.layers&&!m[k]||y.push(D(this._sourceCaches[M],this._layers,this._serializedLayers,E,a,d,b,!!this.map._showQueryGeometry))}return this.placement&&y.push(function(M,k,P,R,N,H,Z){const K={},ae=H.queryRenderedSymbols(R),W=[];for(const re of Object.keys(ae).map(Number))W.push(Z[re]);W.sort(X);for(const re of W){const ne=re.featureIndex.lookupSymbolFeatures(ae[re.bucketInstanceId],k,re.bucketIndex,re.sourceLayerIndex,N.filter,N.layers,N.availableImages,M);for(const te in ne){const ie=K[te]=K[te]||[],se=ne[te];se.sort((ge,be)=>{const Xe=re.featureSortOrder;if(Xe){const Ne=Xe.indexOf(ge.featureIndex);return Xe.indexOf(be.featureIndex)-Ne}return be.featureIndex-ge.featureIndex});for(const ge of se)ie.push(ge)}}for(const re in K)K[re].forEach(ne=>{const te=ne.feature,ie=P(M[re]).getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=ie});return K}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),E.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(i,a){a&&a.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",a.filter,null,a);const d=this._getSourceCaches(i);let m=[];for(const y of d)m=m.concat(O(y,a));return m}addSourceType(i,a,d){return Ir.getSourceType(i)?d(new Error(`A source type called "${i}" already exists.`)):(Ir.setSourceType(i,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:a.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(i,a={}){this._checkLoaded();const d=this.light.getLight();let m=!1;for(const b in i)if(!J(i[b],d[b])){m=!0;break}if(!m)return;const y={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,a),this.light.updateTransitions(y)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,a=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(a===1){if(typeof i.source=="object"){const d="terrain-dem-src";this.addSource(d,i.source),i=o.clone$1(i),i=o.extend(i,{source:d})}if(this._validate(o.validateStyle.terrain,"terrain",i))return}if(!this.terrain||this.terrain&&a!==this.terrain.drapeRenderMode)this._createTerrain(i,a);else{const d=this.terrain,m=d.get();for(const y in i)if(!J(i[y],m[y])){d.set(i),this.stylesheet.terrain=i;const b={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(b);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const a=this.fog=new Nt(i,this.map.transform);this.stylesheet.fog=i;const d={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};a.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog,d=a.get();for(const m in i)if(!J(i[m],d[m])){a.set(i),this.stylesheet.fog=i;const y={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};a.updateTransitions(y);break}}else this._createFog(i);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(d=>this.isLayerDraped(this._layers[d])),a=this._order.filter(d=>!this.isLayerDraped(this._layers[d]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...a)}_createTerrain(i,a){const d=this.terrain=new rt(i,a);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const m={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(m)}_force3DLayerUpdate(){for(const i in this._layers){const a=this._layers[i];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const a=this._layers[i];a.type==="symbol"&&this._updateLayer(a)}}_validate(i,a,d,m,y={}){return(!y||y.validate!==!1)&&uo(this,i.call(o.validateStyle,o.extend({key:a,style:this.serialize(),value:d,styleSpec:o.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const a=this._getSourceCaches(i);for(const d of a)d.clearTiles()}_reloadSource(i){const a=this._getSourceCaches(i);for(const d of a)d.resume(),d.reload()}_updateSources(i){for(const a in this._sourceCaches)this._sourceCaches[a].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const a=this._sourceCaches[i];a.resume(),a.reload()}}_updatePlacement(i,a,d,m,y=!1){let b=!1,E=!1;const M={};for(const k of this._order){const P=this._layers[k];if(P.type!=="symbol")continue;if(!M[P.source]){const N=this._getLayerSourceCache(P);if(!N)continue;M[P.source]=N.getRenderableIds(!0).map(H=>N.getTileByID(H)).sort((H,Z)=>Z.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(Z.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(P,M[P.source],i.center.lng,i.projection);b=b||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),y=y||this._layerOrderChanged||d===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(y||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),i.zoom))&&(this.pauseablePlacement=new Ot(i,this._order,y,a,d,m,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),E=!0),b&&this.pauseablePlacement.placement.setStale()),E||b)for(const k of this._order){const P=this._layers[k];P.type==="symbol"&&this.placement.updateLayerOpacities(P,M[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,a,d){this.imageManager.getImages(a.icons,d),this._updateTilesForChangedImages();const m=y=>{y&&y.setDependencies(a.tileID.key,a.type,a.icons)};m(this._otherSourceCaches[a.source]),m(this._symbolSourceCaches[a.source])}getGlyphs(i,a,d){this.glyphManager.getGlyphs(a.stacks,d)}getResource(i,a,d){return o.makeRequest(a,d)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const a=[];return this._otherSourceCaches[i]&&a.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&a.push(this._symbolSourceCaches[i]),a}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ir.getSourceType=function(h){return Ur[h]},Ir.setSourceType=function(h,i){Ur[h]=i},Ir.registerForPluginStateChange=o.registerForPluginStateChange;var ws=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,Ho="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Ko={},Yo={};Ko=At("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),Yo=At(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const Xt=At(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
return mix(globe,mercator,t);
#else
return globe;
#endif
}
#ifdef PROJECTION_GLOBE_VIEW
mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Ts=ws;var Vl={background:At(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:At(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:At(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:At("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:At(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:At(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:At("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:At("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:At("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:At(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:At(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:At(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:At(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:At(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:At(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:At(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:At(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:At(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:At(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:At(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:At(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:At(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:At(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:At(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:At(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:At(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ho),skyboxGradient:At(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ho),skyboxCapture:At(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:At(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:At(`uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)
discard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function At(h,i,a){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,y=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),b=h.match(m),E=i.match(m),M=ws.match(m);let k=E?E.concat(b):b;a||(Ko.staticUniforms&&(k=Ko.staticUniforms.concat(k)),Yo.staticUniforms&&(k=Yo.staticUniforms.concat(k))),k&&(k=k.concat(M));const P={};return{fragmentSource:h=h.replace(d,(R,N,H,Z,K)=>(P[K]=!0,N==="define"?`
#ifndef HAS_UNIFORM_u_${K}
varying ${H} ${Z} ${K};
#else
uniform ${H} ${Z} u_${K};
#endif
`:`
#ifdef HAS_UNIFORM_u_${K}
    ${H} ${Z} ${K} = u_${K};
#endif
`)),vertexSource:i=i.replace(d,(R,N,H,Z,K)=>{const ae=Z==="float"?"vec2":"vec4",W=K.match(/color/)?"color":ae;return P[K]?N==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
attribute ${H} ${ae} a_${K};
varying ${H} ${Z} ${K};
#else
uniform ${H} ${Z} u_${K};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = a_${K};
#else
    ${H} ${Z} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = unpack_mix_${W}(a_${K}, u_${K}_t);
#else
    ${H} ${Z} ${K} = u_${K};
#endif
`:N==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
attribute ${H} ${ae} a_${K};
#else
uniform ${H} ${Z} u_${K};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${H} ${Z} ${K} = a_${K};
#else
    ${H} ${Z} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${H} ${Z} ${K} = unpack_mix_${W}(a_${K}, u_${K}_t);
#else
    ${H} ${Z} ${K} = u_${K};
#endif
`}),staticAttributes:y,staticUniforms:k}}class nn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,a,d,m,y,b,E,M){this.context=i;let k=this.boundPaintVertexBuffers.length!==m.length;for(let P=0;!k&&P<m.length;P++)this.boundPaintVertexBuffers[P]!==m[P]&&(k=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===a&&this.boundLayoutVertexBuffer===d&&!k&&this.boundIndexBuffer===y&&this.boundVertexOffset===b&&this.boundDynamicVertexBuffer===E&&this.boundDynamicVertexBuffer2===M?(i.bindVertexArrayOES.set(this.vao),E&&E.bind(),y&&y.dynamicDraw&&y.bind(),M&&M.bind()):this.freshBind(a,d,m,y,b,E,M)}freshBind(i,a,d,m,y,b,E){let M;const k=i.numAttributes,P=this.context,R=P.gl;if(P.extVertexArrayObject)this.vao&&this.destroy(),this.vao=P.extVertexArrayObject.createVertexArrayOES(),P.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=i,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=E;else{M=P.currentNumAttributes||0;for(let N=k;N<M;N++)R.disableVertexAttribArray(N)}a.enableAttributes(R,i);for(const N of d)N.enableAttributes(R,i);b&&b.enableAttributes(R,i),E&&E.enableAttributes(R,i),a.bind(),a.setVertexAttribPointers(R,i,y);for(const N of d)N.bind(),N.setVertexAttribPointers(R,i,y);b&&(b.bind(),b.setVertexAttribPointers(R,i,y)),m&&m.bind(),E&&(E.bind(),E.setVertexAttribPointers(R,i,y)),P.currentNumAttributes=k}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function wu(h,i){const a=Math.pow(2,i.canonical.z),d=i.canonical.y;return[new o.MercatorCoordinate(0,d/a).toLngLat().lat,new o.MercatorCoordinate(0,(d+1)/a).toLngLat().lat]}function Ss(h,i,a,d,m,y,b){const E=h.context,M=E.gl,k=a.fbo;if(!k)return;h.prepareDrawTile(i);const P=h.useProgram("hillshade");E.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,k.colorAttachment.get());const R=((K,ae,W,re)=>{const ne=W.paint.get("hillshade-shadow-color"),te=W.paint.get("hillshade-highlight-color"),ie=W.paint.get("hillshade-accent-color");let se=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(se-=K.transform.angle);const ge=!K.options.moving;return{u_matrix:re||K.transform.calculateProjMatrix(ae.tileID.toUnwrapped(),ge),u_image:0,u_latrange:wu(0,ae.tileID),u_light:[W.paint.get("hillshade-exaggeration"),se],u_shadow:ne,u_highlight:te,u_accent:ie}})(h,a,d,h.terrain?i.projMatrix:null);h.prepareDrawProgram(E,P,i.toUnwrapped());const{tileBoundsBuffer:N,tileBoundsIndexBuffer:H,tileBoundsSegments:Z}=h.getTileBoundsBuffers(a);P.draw(E,M.TRIANGLES,m,y,b,o.CullFaceMode.disabled,R,d.id,N,H,Z)}function qi(h,i,a){if(!i.needsDEMTextureUpload)return;const d=h.context,m=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||h.getTileTexture(a.stride);const y=a.getPixels();i.demTexture?i.demTexture.update(y,{premultiply:!1}):i.demTexture=new o.Texture(d,y,m.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function ka(h,i,a,d,m,y){const b=h.context,E=b.gl;if(!i.dem)return;const M=i.dem;if(b.activeTexture.set(E.TEXTURE1),qi(h,i,M),!i.demTexture)return;i.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const k=M.dim;b.activeTexture.set(E.TEXTURE0);let P=i.fbo;if(!P){const Z=new o.Texture(b,{width:k,height:k,data:null},E.RGBA);Z.bind(E.LINEAR,E.CLAMP_TO_EDGE),P=i.fbo=b.createFramebuffer(k,k,!0),P.colorAttachment.set(Z.texture)}b.bindFramebuffer.set(P.framebuffer),b.viewport.set([0,0,k,k]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:N,tileBoundsSegments:H}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(b,E.TRIANGLES,d,m,y,o.CullFaceMode.disabled,((Z,K)=>{const ae=K.stride,W=o.create();return o.ortho(W,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(W,W,[0,-o.EXTENT,0]),{u_matrix:W,u_image:1,u_dimension:[ae,ae],u_zoom:Z.overscaledZ,u_unpack:K.unpackVector}})(i.tileID,M),a.id,R,N,H),i.needsHillshadePrepare=!1}const ho=(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_image0:new o.Uniform1i(h,i.u_image0),u_skirt_height:new o.Uniform1f(h,i.u_skirt_height)}),rr=(h,i)=>({u_matrix:h,u_image0:0,u_skirt_height:i}),Es=(h,i,a,d,m)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:i,u_merc_matrix:a,u_zoom_transition:d,u_merc_center:m,u_image0:0});function on(h,i){return h!=null&&i!=null&&!(!h.hasData()||!i.hasData())&&h.demTexture!=null&&i.demTexture!=null&&h.tileID.key!==i.tileID.key}const Rn=new class{constructor(){this.operations={}}newMorphing(h,i,a,d,m){if(h in this.operations){const y=this.operations[h];y.to.tileID.key!==a.tileID.key&&(y.queued=a)}else this.operations[h]={startTime:d,phase:0,duration:m,from:i,to:a,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const i=this.operations[h];return{from:i.from,to:i.to,phase:i.phase}}update(h){for(const i in this.operations){const a=this.operations[i];for(a.phase=(h-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,h)){delete this.operations[i];break}}}_nextOp(h,i){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=i,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},zo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Rd(h,i){const a=1<<h.z;return!i&&(h.x===0||h.x===a-1)||h.y===0||h.y===a-1}const Bn=h=>({u_matrix:h});function Tu(h,i,a,d,m){if(m>0){const y=o.exported.now(),b=(y-h.timeAdded)/m,E=i?(y-i.timeAdded)/m:-1,M=a.getSource(),k=d.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),P=!i||Math.abs(i.tileID.overscaledZ-k)>Math.abs(h.tileID.overscaledZ-k),R=P&&h.refreshedUponExpiration?1:o.clamp(P?b:1-E,0,1);return h.refreshedUponExpiration&&b>=1&&(h.refreshedUponExpiration=!1),i?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}class Su extends o.SourceCache{constructor(i){const a={type:"raster-dem",maxzoom:i.transform.maxZoom},d=new Ni(ue(),null),m=zi("mock-dem",a,d,i.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,a){i.state="loaded",a(null)}}class jr extends o.SourceCache{constructor(i){const a=zi("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new Ni(ue(),null),i.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,a,d){if(i.freezeTileCoverage)return;this.transform=i;const m=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,b)=>{if(y[b.key]="",!this._tiles[b.key]){const E=new o.Tile(b,this._source.tileSize*b.overscaleFactor(),i.tileZoom);E.state="loaded",this._tiles[b.key]=E}return y},{});for(const y in this._tiles)y in m||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(i){const a=this.proxyCachedFBO[i];if(a!==void 0){const d=Object.values(a);this.renderCachePool.push(...d),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class za extends o.OverscaledTileID{constructor(i,a,d){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=a,this.projMatrix=d}}class fo extends o.Elevation{constructor(i,a){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,m,y]=function(M){const k=new o.StructArrayLayout4i8,P=new o.StructArrayLayout3ui6,R=131;k.reserve(17161),P.reserve(33800);const N=o.EXTENT/128,H=o.EXTENT+N/2,Z=H+N;for(let ae=-N;ae<Z;ae+=N)for(let W=-N;W<Z;W+=N){const re=W<0||W>H||ae<0||ae>H?24575:0,ne=o.clamp(Math.round(W),0,o.EXTENT),te=o.clamp(Math.round(ae),0,o.EXTENT);k.emplaceBack(ne+re,te,ne,te)}const K=(ae,W)=>{const re=W*R+ae;P.emplaceBack(re+1,re,re+R),P.emplaceBack(re+R,re+R+1,re+1)};for(let ae=1;ae<129;ae++)for(let W=1;W<129;W++)K(W,ae);return[0,129].forEach(ae=>{for(let W=0;W<130;W++)K(W,ae),K(ae,W)}),[k,P,32768]}(),b=i.context;this.gridBuffer=b.createVertexBuffer(d,o.boundsAttributes.members),this.gridIndexBuffer=b.createIndexBuffer(m),this.gridSegments=o.SegmentVector.simpleSegment(0,0,d.length,m.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,d.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new jr(a.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,0,o.EXTENT,0,o.EXTENT,0,1);const E=b.gl;this._overlapStencilMode=new o.StencilMode({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Su(a.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency()}update(i,a,d){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const m=i.terrain.properties;this.sourceCache=i.terrain.drapeRenderMode===0?this._mockSourceCache:i._getSourceCache(m.get("source")),this._exaggeration=m.get("exaggeration");const y=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const b=this.getScaledDemTileSize();this.sourceCache.update(a,b,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,y(),this._initializing=!0),y(),a.updateElevation(!d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||i.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=a.getIds().map(M=>{const k=a.getTileByID(M).tileID;return k.projMatrix=d.calculateProjMatrix(k.toUnwrapped()),k});(function(M,k){const P=k.transform.pointCoordinate(k.transform.getCameraPoint()),R=new o.pointGeometry(P.x,P.y);M.sort((N,H)=>{if(H.overscaledZ-N.overscaledZ)return H.overscaledZ-N.overscaledZ;const Z=new o.pointGeometry(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),K=new o.pointGeometry(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),ae=R.mult(1<<N.canonical.z);return ae.x-=.5,ae.y-=.5,ae.distSqr(Z)-ae.distSqr(K)})})(m,this.painter),this._previousZoom=d.zoom;const y=this.proxyToSource||{};this.proxyToSource={},m.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const b=this._style._sourceCaches;for(const M in b){const k=b[M];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,i[M],y),k.usedForTerrain))continue;const P=i[M];k.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[a.id]=m.map(M=>new za(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const E={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const k=this.terrainTileForTile[M.key];if(!k)continue;const P=k.tileID.key;P in E||(this._visibleDemTiles.push(k),E[P]=P)}}_assignTerrainTiles(i){this._initializing||i.forEach(a=>{if(this.terrainTileForTile[a.key])return;const d=this._findTileCoveringTileID(a,this.sourceCache);d&&(this.terrainTileForTile[a.key]=d)})}_prepareDEMTextures(){const i=this.painter.context,a=i.gl;for(const d in this.terrainTileForTile){const m=this.terrainTileForTile[d],y=m.dem;!y||m.demTexture&&!m.needsDEMTextureUpload||(i.activeTexture.set(a.TEXTURE1),qi(this.painter,m,y))}}_prepareDemTileUniforms(i,a,d,m){if(!a||a.demTexture==null)return!1;const y=i.tileID.canonical,b=Math.pow(2,a.tileID.canonical.z-y.z),E=m||"";return d[`u_dem_tl${E}`]=[y.x*b%1,y.y*b%1],d[`u_dem_scale${E}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,a=i.gl;if(!this._emptyDepthBufferTexture){const d={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new o.Texture(i,d,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const a=this._visibleDemTiles.reduce((d,m)=>{if(!m.dem)return d;const y=m.dem.tree.minimums[0];return y>0&&i++,d+y},0);return i?a/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,a=i.gl;i.activeTexture.set(a.TEXTURE2);const d=this._getLoadedAreaMinimum(),m={width:1,height:1,data:new Uint8Array(o.DEMData.pack(d,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(m,{premultiply:!1}):y=this._emptyDEMTexture=new o.Texture(i,m,a.RGBA,{premultiply:!1}),y}setupElevationDraw(i,a,d){const m=this.painter.context,y=m.gl,b=(E=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(E),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var E;b.u_dem_size=this.sourceCache.getSource().tileSize,b.u_exaggeration=this.exaggeration();const M=this.painter.transform,k=M.projection.createTileTransform(M,M.worldSize),P=i.tileID.canonical;b.u_tile_tl_up=k.upVector(P,0,0),b.u_tile_tr_up=k.upVector(P,o.EXTENT,0),b.u_tile_br_up=k.upVector(P,o.EXTENT,o.EXTENT),b.u_tile_bl_up=k.upVector(P,0,o.EXTENT),b.u_tile_up_scale=k.upVectorScale(P);let R=null,N=null,H=1;if(d&&d.morphing&&this._useVertexMorphing){const Z=d.morphing.srcDemTile,K=d.morphing.dstDemTile;H=d.morphing.phase,Z&&K&&(this._prepareDemTileUniforms(i,Z,b,"_prev")&&(N=Z),this._prepareDemTileUniforms(i,K,b)&&(R=K))}if(N&&R?(m.activeTexture.set(y.TEXTURE2),R.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),m.activeTexture.set(y.TEXTURE4),N.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),b.u_dem_lerp=H):(R=this.terrainTileForTile[i.tileID.key],m.activeTexture.set(y.TEXTURE2),(this._prepareDemTileUniforms(i,R,b)?R.demTexture:this.emptyDEMTexture).bind(y.NEAREST,y.CLAMP_TO_EDGE)),m.activeTexture.set(y.TEXTURE3),d&&d.useDepthForOcclusion?(this._depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),b.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),b.u_depth_size_inv=[1,1]),d&&d.useMeterToDem&&R){const Z=(1<<R.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=Z}d&&d.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),a.setTerrainUniformValues(m,b)}renderToBackBuffer(i){const a=this.painter,d=this.painter.context;i.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),this.renderingToTexture=!1,function(m,y,b,E,M){if(m.transform.projection.name==="globe")(function(k,P,R,N,H){const Z=k.context,K=Z.gl;let ae,W;const re=k.options.showTerrainWireframe?2:0,ne=(Fe,Ae)=>{if(W===Fe)return;const ve=[];Ae&&ve.push(zo[re]),ve.push(zo[Fe]),ve.push("PROJECTION_GLOBE_VIEW"),ae=k.useProgram("globeRaster",null,ve),W=Fe},te=k.colorModeForRenderPass(),ie=new o.DepthMode(K.LEQUAL,o.DepthMode.ReadWrite,k.depthRangeFor3D);Rn.update(H);const se=k.transform,ge=o.calculateGlobeMatrix(se,se.worldSize),be=o.calculateGlobeMercatorMatrix(se),Xe=[o.mercatorXfromLng(se.center.lng),o.mercatorYfromLat(se.center.lat)],Ne=k.globeSharedBuffers;(re?[!1,!0]:[!1]).forEach(Fe=>{W=-1;const Ae=Fe?K.LINES:K.TRIANGLES;for(const ve of N){const Re=R.getTile(ve),ze=Math.pow(2,ve.canonical.z),[ct,mt]=o.globeBuffersForTileMesh(k,Re,ve,ze),kt=o.StencilMode.disabled,We=P.prevTerrainTileForTile[ve.key],ft=P.terrainTileForTile[ve.key];on(We,ft)&&Rn.newMorphing(ve.key,We,ft,H,250),Z.activeTexture.set(K.TEXTURE0),Re.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const xt=Rn.getMorphValuesForProxy(ve.key),ai=xt?1:0,yi={};xt&&o.extend$1(yi,{morphing:{srcDemTile:xt.from,dstDemTile:xt.to,phase:o.easeCubicInOut(xt.phase)}});const yt=o.globeMatrixForTile(ve.canonical,ge),Lt=Es(se.projMatrix,yt,be,o.globeToMercatorTransition(se.zoom),Xe);if(ne(ai,Fe),P.setupElevationDraw(Re,ae,yi),k.prepareDrawProgram(Z,ae,ve.toUnwrapped()),Ne){const[Ci,Ji]=Fe?Ne.getWirefameBuffer(k.context):[Ne.gridIndexBuffer,Ne.gridSegments];ae.draw(Z,Ae,ie,kt,te,o.CullFaceMode.backCCW,Lt,"globe_raster",ct,Ci,Ji)}if(!Fe){const Ci=[ve.canonical.y===0?o.globePoleMatrixForTile(ve.canonical,!1,se):null,ve.canonical.y===ze-1?o.globePoleMatrixForTile(ve.canonical,!0,se):null];for(const Ji of Ci){if(!Ji)continue;const kr=Es(se.projMatrix,Ji,Ji,0,Xe);Ne&&ae.draw(Z,Ae,ie,kt,te,o.CullFaceMode.disabled,kr,"globe_pole_raster",mt,Ne.poleIndexBuffer,Ne.poleSegments)}}}})})(m,y,b,E,M);else{const k=m.context,P=k.gl;let R,N;const H=m.options.showTerrainWireframe?2:0,Z=(ne,te)=>{if(N===ne)return;const ie=[zo[ne]];te&&ie.push(zo[H]),R=m.useProgram("terrainRaster",null,ie),N=ne},K=m.colorModeForRenderPass(),ae=new o.DepthMode(P.LEQUAL,o.DepthMode.ReadWrite,m.depthRangeFor3D);Rn.update(M);const W=m.transform,re=6*Math.pow(1.5,22-W.zoom)*y.exaggeration();(H?[!1,!0]:[!1]).forEach(ne=>{N=-1;const te=ne?P.LINES:P.TRIANGLES,[ie,se]=ne?y.getWirefameBuffer():[y.gridIndexBuffer,y.gridSegments];for(const ge of E){const be=b.getTile(ge),Xe=o.StencilMode.disabled,Ne=y.prevTerrainTileForTile[ge.key],Fe=y.terrainTileForTile[ge.key];on(Ne,Fe)&&Rn.newMorphing(ge.key,Ne,Fe,M,250),k.activeTexture.set(P.TEXTURE0),be.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);const Ae=Rn.getMorphValuesForProxy(ge.key),ve=Ae?1:0;let Re;Ae&&(Re={morphing:{srcDemTile:Ae.from,dstDemTile:Ae.to,phase:o.easeCubicInOut(Ae.phase)}});const ze=rr(ge.projMatrix,Rd(ge.canonical,W.renderWorldCopies)?re/10:re);Z(ve,ne),y.setupElevationDraw(be,R,Re),m.prepareDrawProgram(k,R,ge.toUnwrapped()),R.draw(k,te,ae,Xe,K,o.CullFaceMode.backCCW,ze,"terrain_raster",y.gridBuffer,ie,se)}})}}(a,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const a=this.painter,d=this.painter.context,m=this.proxySourceCache,y=this.proxiedCoords[m.id],b=this._drapedRenderBatches.shift(),E=[],M=a.style.order;let k=0;for(const P of y){const R=m.getTileByID(P.proxyTileKey),N=m.proxyCachedFBO[P.key]?m.proxyCachedFBO[P.key][i]:void 0,H=N!==void 0?m.renderCache[N]:this.pool[k++],Z=N!==void 0;if(R.texture=H.tex,Z&&!H.dirty){E.push(R.tileID);continue}let K;d.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(d.clear({color:o.Color.transparent,stencil:0}),H.dirty=!1);for(let ae=b.start;ae<=b.end;++ae){const W=a.style._layers[M[ae]];if(W.isHidden(a.transform.zoom))continue;const re=a.style._getLayerSourceCache(W),ne=re?this.proxyToSource[P.key][re.id]:[P];if(!ne)continue;const te=ne;d.viewport.set([0,0,H.fb.width,H.fb.height]),K!==(re?re.id:null)&&(this._setupStencil(H,ne,W,re),K=re?re.id:null),a.renderLayer(a,re,W,te)}this.renderedToTile?(H.dirty=!0,E.push(R.tileID)):Z||--k,k===5&&(k=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),b.end+1}postRender(){}renderCacheEfficiency(i){const a=i.order.length;if(a===0)return{efficiency:100};let d,m=0,y=0,b=!1;for(let E=0;E<a;++E){const M=i._layers[i.order[E]];this._style.isLayerDraped(M)?(b&&++m,++y):b||(b=!0,d=M.id)}return y===0?{efficiency:100}:{efficiency:100*(1-m/y),firstUndrapedLayer:d}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{i=Math.min(i,a.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,a,d){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const b=y.tileID,E=Math.pow(2,b.overscaledZ),{x:M,y:k}=b.canonical,P=M/E,R=(M+1)/E,N=k/E,H=(k+1)/E;return{minx:P,miny:N,maxx:R,maxy:H,t:y.dem.tree.raycastRoot(P,N,R,H,i,a,d),tile:y}});m.sort((y,b)=>(y.t!==null?y.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const y of m){if(y.t==null)return null;const b=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,i,a,d);if(b!=null)return b}return null}_createFBO(){const i=this.painter.context,a=i.gl,d=this.drapeBufferSize;i.activeTexture.set(a.TEXTURE0);const m=new o.Texture(i,{width:d[0],height:d[1],data:null},a.RGBA);m.bind(a.LINEAR,a.CLAMP_TO_EDGE);const y=i.createFramebuffer(d[0],d[1],!1);return y.colorAttachment.set(m.texture),y.depthAttachment=new gt(i,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&a.texParameterf(a.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:y,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const a=this._style._layers[i],d=a.isHidden(this.painter.transform.zoom),m=a.getCrossfadeParameters(),y=!!m&&m.t!==1,b=a.hasTransition();return a.type!=="custom"&&!d&&(y||b)})}_clearRasterFadeFromRenderCache(){let i=!1;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a]._source instanceof ii){i=!0;break}if(i)for(let a=0;a<this._style.order.length;++a){const d=this._style._layers[this._style.order[a]],m=d.isHidden(this.painter.transform.zoom),y=this._style._getLayerSourceCache(d);if(d.type!=="raster"||m||!y)continue;const b=d.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const M=this.proxyToSource[E.key][y.id];if(M)for(const k of M){const P=Tu(y.getTile(k),y.findLoadedParent(k,0),y,this.painter.transform,b);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(y.id,k)}}}}_setupDrapedRenderBatches(){const i=this._style.order,a=i.length;if(a===0)return;const d=[];let m,y=0,b=this._style._layers[i[y]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++y<a;)b=this._style._layers[i[y]];for(;y<a;++y){const E=this._style._layers[i[y]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?m===void 0&&(m=y):m!==void 0&&(d.push({start:m,end:y-1}),m=void 0))}m!==void 0&&d.push({start:m,end:y-1}),this._drapedRenderBatches=d}_setupRenderCache(i){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const b=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let E=0;E<b.length;++E){const M=Object.values(b[E]);a.renderCachePool.push(...M)}}return}this._clearRasterFadeFromRenderCache();const d=this.proxyCoords,m=this._tilesDirty;for(let b=d.length-1;b>=0;b--){const E=d[b];if(a.getTileByID(E.key),a.proxyCachedFBO[E.key]!==void 0){const M=i[E.key],k=this.proxyToSource[E.key];let P=0;for(const R in k){const N=k[R],H=M[R];if(!H||H.length!==N.length||N.some((Z,K)=>Z!==H[K]||m[R]&&m[R].hasOwnProperty(Z.key))){P=-1;break}++P}for(const R in a.proxyCachedFBO[E.key])a.renderCache[a.proxyCachedFBO[E.key][R]].dirty=P<0||P!==Object.values(M).length}}const y=[...this._drapedRenderBatches];y.sort((b,E)=>E.end-E.start-(b.end-b.start));for(const b of y)for(const E of d){if(a.proxyCachedFBO[E.key])continue;let M=a.renderCachePool.pop();M===void 0&&a.renderCache.length<50&&(M=a.renderCache.length,a.renderCache.push(this._createFBO())),M!==void 0&&(a.proxyCachedFBO[E.key]={},a.proxyCachedFBO[E.key][b.start]=M,a.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(i,a,d,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,b=y.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let E;if(d.isTileClipped())E=a.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(i,a){const d=this.painter,m=this.painter.context,y=m.gl;d._tileClippingMaskIDs={},m.setColorMode(o.ColorMode.disabled),m.setDepthMode(o.DepthMode.disabled);const b=d.useProgram("clippingMask");for(const E of i){const M=d._tileClippingMaskIDs[E.key]=--a;b.draw(m,y.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:y.ALWAYS,mask:0},M,255,y.KEEP,y.KEEP,y.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Bn(E.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(i){const a=this.painter.transform;if(i.x<0||i.x>a.width||i.y<0||i.y>a.height)return null;const d=[i.x,i.y,1,1];o.transformMat4$1(d,d,a.pixelMatrixInverse),o.scale$1(d,d,1/d[3]),d[0]/=a.worldSize,d[1]/=a.worldSize;const m=a._camera.position,y=o.mercatorZfromAltitude(1,a.center.lat),b=[m[0],m[1],m[2]/y,0],E=o.subtract([],d.slice(0,3),b);o.normalize(E,E);const M=this.raycast(b,E,this._exaggeration);return M!==null&&M?(o.scaleAndAdd(b,b,E,M),b[3]=b[2],b[2]*=y,b):null}drawDepth(){const i=this.painter,a=i.context,d=this.proxySourceCache,m=Math.ceil(i.width),y=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===m&&this._depthFBO.height===y||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const b=a.gl,E=a.createFramebuffer(m,y,!0);a.activeTexture.set(b.TEXTURE0);const M=new o.Texture(a,{width:m,height:y,data:null},b.RGBA);M.bind(b.NEAREST,b.CLAMP_TO_EDGE),E.colorAttachment.set(M.texture);const k=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,m,y);E.depthAttachment.set(k),this._depthFBO=E,this._depthTexture=M}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,m,y]),function(b,E,M,k){if(b.transform.projection.name==="globe")return;const P=b.context,R=P.gl;P.clear({depth:1});const N=b.useProgram("terrainDepth"),H=new o.DepthMode(R.LESS,o.DepthMode.ReadWrite,b.depthRangeFor3D);for(const Z of k){const K=M.getTile(Z),ae=rr(Z.projMatrix,0);E.setupElevationDraw(K,N),N.draw(P,R.TRIANGLES,H,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,ae,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(i,this,d,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,a,d){if(i.getSource()instanceof Ri)return this._setupProxiedCoordsForImageSource(i,a,d);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const m=this.proxiedCoords[i.id]=[],y=this.proxyCoords;for(let E=0;E<y.length;E++){const M=y[E],k=this._findTileCoveringTileID(M,i);if(k){const P=this._createProxiedId(M,k,d[M.key]&&d[M.key][i.id]);m.push(P),this.proxyToSource[M.key][i.id]=[P]}}let b=!1;for(let E=0;E<a.length;E++){const M=i.getTile(a[E]);if(!M||!M.hasData())continue;const k=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==M.tileID.canonical.z){const P=this.proxyToSource[k.tileID.key][i.id],R=this._createProxiedId(k.tileID,M,d[k.tileID.key]&&d[k.tileID.key][i.id]);P?P.splice(P.length-1,0,R):this.proxyToSource[k.tileID.key][i.id]=[R],m.push(R),b=!0}}this._sourceTilesOverlap[i.id]=b}_setupProxiedCoordsForImageSource(i,a,d){if(!i.getSource().loaded())return;const m=this.proxiedCoords[i.id]=[],y=this.proxyCoords,b=i.getSource(),E=new o.pointGeometry(b.tileID.x,b.tileID.y)._div(1<<b.tileID.z),M=b.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((P,R)=>(P.min.x=Math.min(P.min.x,R.x-E.x),P.min.y=Math.min(P.min.y,R.y-E.y),P.max.x=Math.max(P.max.x,R.x-E.x),P.max.y=Math.max(P.max.y,R.y-E.y),P),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(P,R)=>{const N=P.wrap+P.canonical.x/(1<<P.canonical.z),H=P.canonical.y/(1<<P.canonical.z),Z=o.EXTENT/(1<<P.canonical.z),K=R.wrap+R.canonical.x/(1<<R.canonical.z),ae=R.canonical.y/(1<<R.canonical.z);return N+Z<K+M.min.x||N>K+M.max.x||H+Z<ae+M.min.y||H>ae+M.max.y};for(let P=0;P<y.length;P++){const R=y[P];for(let N=0;N<a.length;N++){const H=i.getTile(a[N]);if(!H||!H.hasData()||k(R,H.tileID))continue;const Z=this._createProxiedId(R,H,d[R.key]&&d[R.key][i.id]),K=this.proxyToSource[R.key][i.id];K?K.push(Z):this.proxyToSource[R.key][i.id]=[Z],m.push(Z)}}}_createProxiedId(i,a,d){let m=this.orthoMatrix;if(d){const y=d.find(b=>b.key===a.tileID.key);if(y)return y}if(a.tileID.key!==i.key){const y=i.canonical.z-a.tileID.canonical.z;let b,E,M;m=o.create();const k=a.tileID.wrap-i.wrap<<i.overscaledZ;y>0?(b=o.EXTENT>>y,E=b*((a.tileID.canonical.x<<y)-i.canonical.x+k),M=b*((a.tileID.canonical.y<<y)-i.canonical.y)):(b=o.EXTENT<<-y,E=o.EXTENT*(a.tileID.canonical.x-(i.canonical.x+k<<-y)),M=o.EXTENT*(a.tileID.canonical.y-(i.canonical.y<<-y))),o.ortho(m,0,b,0,b,0,1),o.translate(m,m,[E,M,0])}return new za(a.tileID,i.key,m)}_findTileCoveringTileID(i,a){let d=a.getTile(i);if(d&&d.hasData())return d;const m=this._findCoveringTileCache[a.id],y=m[i.key];if(d=y?a.getTileByID(y):null,d&&d.hasData()||y===null)return d;let b=d?d.tileID:i,E=b.overscaledZ;const M=a.getSource().minzoom,k=[];if(!y){const R=a.getSource().maxzoom;if(i.canonical.z>=R){const N=i.canonical.z-R;a.getSource().reparseOverscaled?(E=Math.max(i.canonical.z+2,a.transform.tileZoom),b=new o.OverscaledTileID(E,i.wrap,R,i.canonical.x>>N,i.canonical.y>>N)):N!==0&&(E=R,b=new o.OverscaledTileID(E,i.wrap,R,i.canonical.x>>N,i.canonical.y>>N))}b.key!==i.key&&(k.push(b.key),d=a.getTile(b))}const P=R=>{k.forEach(N=>{m[N]=R}),k.length=0};for(E-=1;E>=M&&(!d||!d.hasData());E--){d&&P(d.tileID.key);const R=b.calculateScaledKey(E);if(d=a.getTileByID(R),d&&d.hasData())break;const N=m[R];if(N===null)break;N===void 0?k.push(R):d=a.getTileByID(N)}return P(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(i){this.renderedToTile=!0}_clearRenderCacheForTile(i,a){let d=this._tilesDirty[i];d||(d=this._tilesDirty[i]={}),d[a.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(a){let d,m,y;const b=new o.StructArrayLayout2ui4,E=131;for(m=1;m<129;m++){for(d=1;d<129;d++)y=m*E+d,b.emplaceBack(y,y+1),b.emplaceBack(y,y+E),b.emplaceBack(y+1,y+E),m===128&&b.emplaceBack(y+E,y+E+1);b.emplaceBack(y+1,y+1+E)}return b}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function As(h){const i=[];for(let a=0;a<h.length;a++){if(h[a]===null)continue;const d=h[a].split(" ");i.push(d.pop())}return i}class Pa{static cacheKey(i,a,d){let m=`${i}${d?d.cacheKey:""}`;for(const y of a)m+=`/${y}`;return m}constructor(i,a,d,m,y,b){const E=i.gl;this.program=E.createProgram();const M=As(d.staticAttributes),k=m?m.getBinderAttributes():[],P=M.concat(k),R=d.staticUniforms?As(d.staticUniforms):[],N=m?m.getBinderUniforms():[],H=R.concat(N),Z=[];for(const ie of H)Z.indexOf(ie)<0&&Z.push(ie);let K=m?m.defines():[];K=K.concat(b.map(ie=>`#define ${ie}`));const ae=K.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ts,Xt.fragmentSource,Yo.fragmentSource,d.fragmentSource).join(`
`),W=K.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ts,Xt.vertexSource,Yo.vertexSource,Ko.vertexSource,d.vertexSource).join(`
`),re=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(re,ae),E.compileShader(re),E.attachShader(this.program,re);const ne=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(ne,W),E.compileShader(ne),E.attachShader(this.program,ne),this.attributes={};const te={};this.numAttributes=P.length;for(let ie=0;ie<this.numAttributes;ie++)P[ie]&&(E.bindAttribLocation(this.program,ie,P[ie]),this.attributes[P[ie]]=ie);E.linkProgram(this.program),E.deleteShader(ne),E.deleteShader(re);for(let ie=0;ie<Z.length;ie++){const se=Z[ie];if(se&&!te[se]){const ge=E.getUniformLocation(this.program,se);ge&&(te[se]=ge)}}this.fixedUniforms=y(i,te),this.binderUniforms=m?m.getUniforms(i,te):[],b.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((ie,se)=>({u_dem:new o.Uniform1i(ie,se.u_dem),u_dem_prev:new o.Uniform1i(ie,se.u_dem_prev),u_dem_unpack:new o.Uniform4f(ie,se.u_dem_unpack),u_dem_tl:new o.Uniform2f(ie,se.u_dem_tl),u_dem_scale:new o.Uniform1f(ie,se.u_dem_scale),u_dem_tl_prev:new o.Uniform2f(ie,se.u_dem_tl_prev),u_dem_scale_prev:new o.Uniform1f(ie,se.u_dem_scale_prev),u_dem_size:new o.Uniform1f(ie,se.u_dem_size),u_dem_lerp:new o.Uniform1f(ie,se.u_dem_lerp),u_exaggeration:new o.Uniform1f(ie,se.u_exaggeration),u_depth:new o.Uniform1i(ie,se.u_depth),u_depth_size_inv:new o.Uniform2f(ie,se.u_depth_size_inv),u_meter_to_dem:new o.Uniform1f(ie,se.u_meter_to_dem),u_label_plane_matrix_inv:new o.UniformMatrix4f(ie,se.u_label_plane_matrix_inv),u_tile_tl_up:new o.Uniform3f(ie,se.u_tile_tl_up),u_tile_tr_up:new o.Uniform3f(ie,se.u_tile_tr_up),u_tile_br_up:new o.Uniform3f(ie,se.u_tile_br_up),u_tile_bl_up:new o.Uniform3f(ie,se.u_tile_bl_up),u_tile_up_scale:new o.Uniform1f(ie,se.u_tile_up_scale)}))(i,te)),b.indexOf("FOG")!==-1&&(this.fogUniforms=((ie,se)=>({u_fog_matrix:new o.UniformMatrix4f(ie,se.u_fog_matrix),u_fog_range:new o.Uniform2f(ie,se.u_fog_range),u_fog_color:new o.Uniform4f(ie,se.u_fog_color),u_fog_horizon_blend:new o.Uniform1f(ie,se.u_fog_horizon_blend),u_fog_temporal_offset:new o.Uniform1f(ie,se.u_fog_temporal_offset)}))(i,te))}setTerrainUniformValues(i,a){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const m in a)d[m].set(a[m])}}setFogUniformValues(i,a){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const m in a)d[m].location&&d[m].set(a[m])}}draw(i,a,d,m,y,b,E,M,k,P,R,N,H,Z,K,ae){const W=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(d),i.setStencilMode(m),i.setColorMode(y),i.setCullFace(b);for(const ne of Object.keys(this.fixedUniforms))this.fixedUniforms[ne].set(E[ne]);Z&&Z.setUniforms(i,this.binderUniforms,N,{zoom:H});const re={[W.LINES]:2,[W.TRIANGLES]:3,[W.LINE_STRIP]:1}[a];for(const ne of R.get()){const te=ne.vaos||(ne.vaos={});(te[M]||(te[M]=new nn)).bind(i,this,k,Z?Z.getPaintVertexBuffers():[],P,ne.vertexOffset,K,ae),W.drawElements(a,ne.primitiveLength*re,W.UNSIGNED_SHORT,ne.primitiveOffset*re*2)}}}function Eu(h,i,a){const d=1/qt(a,1,i.transform.tileZoom),m=Math.pow(2,a.tileID.overscaledZ),y=a.tileSize*Math.pow(2,i.transform.tileZoom)/m,b=y*(a.tileID.canonical.x+a.tileID.wrap*m),E=y*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[d,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[b>>16,E>>16],u_pixel_coord_lower:[65535&b,65535&E]}}const Au=(h,i,a,d)=>{const m=i.style.light,y=m.properties.get("position"),b=[y.x,y.y,y.z],E=o.create$1();m.properties.get("anchor")==="viewport"&&(o.fromRotation(E,-i.transform.angle),o.transformMat3(b,b,E));const M=m.properties.get("color");return{u_matrix:h,u_lightpos:b,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+a,u_opacity:d}},$l=(h,i,a,d,m,y,b)=>o.extend(Au(h,i,a,d),Eu(y,i,b),{u_height_factor:-Math.pow(2,m.overscaledZ)/b.tileSize/8}),Cu=h=>({u_matrix:h}),Gl=(h,i,a,d)=>o.extend(Cu(h),Eu(a,i,d)),Bd=(h,i)=>({u_matrix:h,u_world:i}),Iu=(h,i,a,d,m)=>o.extend(Gl(h,i,a,d),{u_world:m}),Od=(h,i,a,d)=>{const m=h.transform;let y;return y=d.paint.get("circle-pitch-alignment")==="map"?m.calculatePixelsToTileUnitsMatrix(a):new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]),{u_camera_to_center_distance:m.cameraToCenterDistance,u_matrix:h.translatePosMatrix(i.projMatrix,a,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:y}},Zl=h=>{const i=[];return h.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),h.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i},Mu=(h,i,a)=>{const d=o.EXTENT/a.tileSize;return{u_matrix:h,u_camera_to_center_distance:i.cameraToCenterDistance,u_extrude_scale:[i.pixelsToGLUnits[0]/d,i.pixelsToGLUnits[1]/d]}},ql=(h,i,a=1)=>({u_matrix:h,u_color:i,u_overlay:0,u_overlay_scale:a}),ku=(h,i,a,d)=>({u_matrix:h,u_extrude_scale:qt(i,1,a),u_intensity:d}),zu=(h,i,a,d,m,y)=>{const b=h.transform,E=b.calculatePixelsToTileUnitsMatrix(i),M={u_matrix:Da(h,i,a,m),u_pixels_to_tile_units:E,u_device_pixel_ratio:o.exported.devicePixelRatio,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(La(a)){const k=Jo(i,h.transform);M.u_texsize=i.lineAtlasTexture.size,M.u_scale=[k,d.fromScale,d.toScale],M.u_mix=d.t}return M},Po=(h,i,a,d,m)=>{const y=h.transform,b=Jo(i,y);return{u_matrix:Da(h,i,a,m),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:y.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:o.exported.devicePixelRatio,u_image:0,u_scale:[b,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Jo(h,i){return 1/qt(h,1,i.tileZoom)}function Da(h,i,a,d){return h.translatePosMatrix(d||i.tileID.projMatrix,i,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}function La(h){const i=h.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}const Cs=(h,i,a,d,m,y)=>{return{u_matrix:h,u_tl_parent:i,u_scale_parent:a,u_fade_t:d.mix,u_opacity:d.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(E=m.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(b=m.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Is(m.paint.get("raster-hue-rotate")),u_perspective_transform:y};var b,E};function Is(h){h*=Math.PI/180;const i=Math.sin(h),a=Math.cos(h);return[(2*a+1)/3,(-Math.sqrt(3)*i-a+1)/3,(Math.sqrt(3)*i-a+1)/3]}const Ms=(h,i,a,d,m,y,b,E,M,k,P,R,N,H)=>{const Z=m.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:Z.width/Z.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:b,u_coord_matrix:E,u_is_text:+M,u_pitch_with_map:+d,u_texsize:k,u_tile_id:P,u_zoom_transition:R,u_inv_rot_matrix:N,u_merc_center:H,u_texture:0}},Ra=(h,i,a,d,m,y,b,E,M,k,P,R,N,H,Z)=>{const{cameraToCenterDistance:K,_pitch:ae}=m.transform;return o.extend(Ms(h,i,a,d,m,y,b,E,M,k,R,N,H,Z),{u_gamma_scale:d?K*Math.cos(m.terrain?0:ae):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+P})},Ba=(h,i,a,d,m,y,b,E,M,k,P,R,N,H)=>o.extend(Ra(h,i,a,d,m,y,b,E,!0,M,!0,P,R,N,H),{u_texsize_icon:k,u_texture_icon:1}),ni=(h,i,a)=>({u_matrix:h,u_opacity:i,u_color:a}),ks=(h,i,a,d,m,y)=>o.extend(function(b,E,M,k){const P=M.imageManager.getPattern(b.from.toString()),R=M.imageManager.getPattern(b.to.toString()),{width:N,height:H}=M.imageManager.getPixelSize(),Z=Math.pow(2,k.tileID.overscaledZ),K=k.tileSize*Math.pow(2,M.transform.tileZoom)/Z,ae=K*(k.tileID.canonical.x+k.tileID.wrap*Z),W=K*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[N,H],u_mix:E.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/qt(k,1,M.transform.tileZoom),u_pixel_coord_upper:[ae>>16,W>>16],u_pixel_coord_lower:[65535&ae,65535&W]}}(d,y,a,m),{u_matrix:h,u_opacity:i}),Pu={fillExtrusion:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_lightpos:new o.Uniform3f(h,i.u_lightpos),u_lightintensity:new o.Uniform1f(h,i.u_lightintensity),u_lightcolor:new o.Uniform3f(h,i.u_lightcolor),u_vertical_gradient:new o.Uniform1f(h,i.u_vertical_gradient),u_opacity:new o.Uniform1f(h,i.u_opacity)}),fillExtrusionPattern:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_lightpos:new o.Uniform3f(h,i.u_lightpos),u_lightintensity:new o.Uniform1f(h,i.u_lightintensity),u_lightcolor:new o.Uniform3f(h,i.u_lightcolor),u_vertical_gradient:new o.Uniform1f(h,i.u_vertical_gradient),u_height_factor:new o.Uniform1f(h,i.u_height_factor),u_image:new o.Uniform1i(h,i.u_image),u_texsize:new o.Uniform2f(h,i.u_texsize),u_pixel_coord_upper:new o.Uniform2f(h,i.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(h,i.u_pixel_coord_lower),u_scale:new o.Uniform3f(h,i.u_scale),u_fade:new o.Uniform1f(h,i.u_fade),u_opacity:new o.Uniform1f(h,i.u_opacity)}),fill:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix)}),fillPattern:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_image:new o.Uniform1i(h,i.u_image),u_texsize:new o.Uniform2f(h,i.u_texsize),u_pixel_coord_upper:new o.Uniform2f(h,i.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(h,i.u_pixel_coord_lower),u_scale:new o.Uniform3f(h,i.u_scale),u_fade:new o.Uniform1f(h,i.u_fade)}),fillOutline:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_world:new o.Uniform2f(h,i.u_world)}),fillOutlinePattern:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_world:new o.Uniform2f(h,i.u_world),u_image:new o.Uniform1i(h,i.u_image),u_texsize:new o.Uniform2f(h,i.u_texsize),u_pixel_coord_upper:new o.Uniform2f(h,i.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(h,i.u_pixel_coord_lower),u_scale:new o.Uniform3f(h,i.u_scale),u_fade:new o.Uniform1f(h,i.u_fade)}),circle:(h,i)=>({u_camera_to_center_distance:new o.Uniform1f(h,i.u_camera_to_center_distance),u_extrude_scale:new o.UniformMatrix2f(h,i.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(h,i.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(h,i.u_matrix)}),collisionBox:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_camera_to_center_distance:new o.Uniform1f(h,i.u_camera_to_center_distance),u_extrude_scale:new o.Uniform2f(h,i.u_extrude_scale)}),collisionCircle:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_inv_matrix:new o.UniformMatrix4f(h,i.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(h,i.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(h,i.u_viewport_size)}),debug:(h,i)=>({u_color:new o.UniformColor(h,i.u_color),u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_overlay:new o.Uniform1i(h,i.u_overlay),u_overlay_scale:new o.Uniform1f(h,i.u_overlay_scale)}),clippingMask:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix)}),heatmap:(h,i)=>({u_extrude_scale:new o.Uniform1f(h,i.u_extrude_scale),u_intensity:new o.Uniform1f(h,i.u_intensity),u_matrix:new o.UniformMatrix4f(h,i.u_matrix)}),heatmapTexture:(h,i)=>({u_image:new o.Uniform1i(h,i.u_image),u_color_ramp:new o.Uniform1i(h,i.u_color_ramp),u_opacity:new o.Uniform1f(h,i.u_opacity)}),hillshade:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_image:new o.Uniform1i(h,i.u_image),u_latrange:new o.Uniform2f(h,i.u_latrange),u_light:new o.Uniform2f(h,i.u_light),u_shadow:new o.UniformColor(h,i.u_shadow),u_highlight:new o.UniformColor(h,i.u_highlight),u_accent:new o.UniformColor(h,i.u_accent)}),hillshadePrepare:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_image:new o.Uniform1i(h,i.u_image),u_dimension:new o.Uniform2f(h,i.u_dimension),u_zoom:new o.Uniform1f(h,i.u_zoom),u_unpack:new o.Uniform4f(h,i.u_unpack)}),line:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_pixels_to_tile_units:new o.UniformMatrix2f(h,i.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(h,i.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(h,i.u_units_to_pixels),u_dash_image:new o.Uniform1i(h,i.u_dash_image),u_gradient_image:new o.Uniform1i(h,i.u_gradient_image),u_image_height:new o.Uniform1f(h,i.u_image_height),u_texsize:new o.Uniform2f(h,i.u_texsize),u_scale:new o.Uniform3f(h,i.u_scale),u_mix:new o.Uniform1f(h,i.u_mix),u_alpha_discard_threshold:new o.Uniform1f(h,i.u_alpha_discard_threshold)}),linePattern:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_texsize:new o.Uniform2f(h,i.u_texsize),u_pixels_to_tile_units:new o.UniformMatrix2f(h,i.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(h,i.u_device_pixel_ratio),u_image:new o.Uniform1i(h,i.u_image),u_units_to_pixels:new o.Uniform2f(h,i.u_units_to_pixels),u_scale:new o.Uniform3f(h,i.u_scale),u_fade:new o.Uniform1f(h,i.u_fade),u_alpha_discard_threshold:new o.Uniform1f(h,i.u_alpha_discard_threshold)}),raster:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_tl_parent:new o.Uniform2f(h,i.u_tl_parent),u_scale_parent:new o.Uniform1f(h,i.u_scale_parent),u_fade_t:new o.Uniform1f(h,i.u_fade_t),u_opacity:new o.Uniform1f(h,i.u_opacity),u_image0:new o.Uniform1i(h,i.u_image0),u_image1:new o.Uniform1i(h,i.u_image1),u_brightness_low:new o.Uniform1f(h,i.u_brightness_low),u_brightness_high:new o.Uniform1f(h,i.u_brightness_high),u_saturation_factor:new o.Uniform1f(h,i.u_saturation_factor),u_contrast_factor:new o.Uniform1f(h,i.u_contrast_factor),u_spin_weights:new o.Uniform3f(h,i.u_spin_weights),u_perspective_transform:new o.Uniform2f(h,i.u_perspective_transform)}),symbolIcon:(h,i)=>({u_is_size_zoom_constant:new o.Uniform1i(h,i.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(h,i.u_is_size_feature_constant),u_size_t:new o.Uniform1f(h,i.u_size_t),u_size:new o.Uniform1f(h,i.u_size),u_camera_to_center_distance:new o.Uniform1f(h,i.u_camera_to_center_distance),u_pitch:new o.Uniform1f(h,i.u_pitch),u_rotate_symbol:new o.Uniform1i(h,i.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(h,i.u_aspect_ratio),u_fade_change:new o.Uniform1f(h,i.u_fade_change),u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(h,i.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(h,i.u_coord_matrix),u_is_text:new o.Uniform1i(h,i.u_is_text),u_pitch_with_map:new o.Uniform1i(h,i.u_pitch_with_map),u_texsize:new o.Uniform2f(h,i.u_texsize),u_tile_id:new o.Uniform3f(h,i.u_tile_id),u_zoom_transition:new o.Uniform1f(h,i.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(h,i.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(h,i.u_merc_center),u_texture:new o.Uniform1i(h,i.u_texture)}),symbolSDF:(h,i)=>({u_is_size_zoom_constant:new o.Uniform1i(h,i.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(h,i.u_is_size_feature_constant),u_size_t:new o.Uniform1f(h,i.u_size_t),u_size:new o.Uniform1f(h,i.u_size),u_camera_to_center_distance:new o.Uniform1f(h,i.u_camera_to_center_distance),u_pitch:new o.Uniform1f(h,i.u_pitch),u_rotate_symbol:new o.Uniform1i(h,i.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(h,i.u_aspect_ratio),u_fade_change:new o.Uniform1f(h,i.u_fade_change),u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(h,i.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(h,i.u_coord_matrix),u_is_text:new o.Uniform1i(h,i.u_is_text),u_pitch_with_map:new o.Uniform1i(h,i.u_pitch_with_map),u_texsize:new o.Uniform2f(h,i.u_texsize),u_texture:new o.Uniform1i(h,i.u_texture),u_gamma_scale:new o.Uniform1f(h,i.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(h,i.u_device_pixel_ratio),u_tile_id:new o.Uniform3f(h,i.u_tile_id),u_zoom_transition:new o.Uniform1f(h,i.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(h,i.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(h,i.u_merc_center),u_is_halo:new o.Uniform1i(h,i.u_is_halo)}),symbolTextAndIcon:(h,i)=>({u_is_size_zoom_constant:new o.Uniform1i(h,i.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(h,i.u_is_size_feature_constant),u_size_t:new o.Uniform1f(h,i.u_size_t),u_size:new o.Uniform1f(h,i.u_size),u_camera_to_center_distance:new o.Uniform1f(h,i.u_camera_to_center_distance),u_pitch:new o.Uniform1f(h,i.u_pitch),u_rotate_symbol:new o.Uniform1i(h,i.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(h,i.u_aspect_ratio),u_fade_change:new o.Uniform1f(h,i.u_fade_change),u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(h,i.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(h,i.u_coord_matrix),u_is_text:new o.Uniform1i(h,i.u_is_text),u_pitch_with_map:new o.Uniform1i(h,i.u_pitch_with_map),u_texsize:new o.Uniform2f(h,i.u_texsize),u_texsize_icon:new o.Uniform2f(h,i.u_texsize_icon),u_texture:new o.Uniform1i(h,i.u_texture),u_texture_icon:new o.Uniform1i(h,i.u_texture_icon),u_gamma_scale:new o.Uniform1f(h,i.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(h,i.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(h,i.u_is_halo)}),background:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_opacity:new o.Uniform1f(h,i.u_opacity),u_color:new o.UniformColor(h,i.u_color)}),backgroundPattern:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_opacity:new o.Uniform1f(h,i.u_opacity),u_image:new o.Uniform1i(h,i.u_image),u_pattern_tl_a:new o.Uniform2f(h,i.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(h,i.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(h,i.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(h,i.u_pattern_br_b),u_texsize:new o.Uniform2f(h,i.u_texsize),u_mix:new o.Uniform1f(h,i.u_mix),u_pattern_size_a:new o.Uniform2f(h,i.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(h,i.u_pattern_size_b),u_scale_a:new o.Uniform1f(h,i.u_scale_a),u_scale_b:new o.Uniform1f(h,i.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(h,i.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(h,i.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(h,i.u_tile_units_to_pixels)}),terrainRaster:ho,terrainDepth:ho,skybox:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_sun_direction:new o.Uniform3f(h,i.u_sun_direction),u_cubemap:new o.Uniform1i(h,i.u_cubemap),u_opacity:new o.Uniform1f(h,i.u_opacity),u_temporal_offset:new o.Uniform1f(h,i.u_temporal_offset)}),skyboxGradient:(h,i)=>({u_matrix:new o.UniformMatrix4f(h,i.u_matrix),u_color_ramp:new o.Uniform1i(h,i.u_color_ramp),u_center_direction:new o.Uniform3f(h,i.u_center_direction),u_radius:new o.Uniform1f(h,i.u_radius),u_opacity:new o.Uniform1f(h,i.u_opacity),u_temporal_offset:new o.Uniform1f(h,i.u_temporal_offset)}),skyboxCapture:(h,i)=>({u_matrix_3f:new o.UniformMatrix3f(h,i.u_matrix_3f),u_sun_direction:new o.Uniform3f(h,i.u_sun_direction),u_sun_intensity:new o.Uniform1f(h,i.u_sun_intensity),u_color_tint_r:new o.Uniform4f(h,i.u_color_tint_r),u_color_tint_m:new o.Uniform4f(h,i.u_color_tint_m),u_luminance:new o.Uniform1f(h,i.u_luminance)}),globeRaster:(h,i)=>({u_proj_matrix:new o.UniformMatrix4f(h,i.u_proj_matrix),u_globe_matrix:new o.UniformMatrix4f(h,i.u_globe_matrix),u_merc_matrix:new o.UniformMatrix4f(h,i.u_merc_matrix),u_zoom_transition:new o.Uniform1f(h,i.u_zoom_transition),u_merc_center:new o.Uniform2f(h,i.u_merc_center),u_image0:new o.Uniform1i(h,i.u_image0)}),globeAtmosphere:(h,i)=>({u_center:new o.Uniform2f(h,i.u_center),u_radius:new o.Uniform1f(h,i.u_radius),u_screen_size:new o.Uniform2f(h,i.u_screen_size),u_pixel_ratio:new o.Uniform1f(h,i.u_pixel_ratio),u_opacity:new o.Uniform1f(h,i.u_opacity),u_fadeout_range:new o.Uniform1f(h,i.u_fadeout_range),u_start_color:new o.Uniform3f(h,i.u_start_color),u_end_color:new o.Uniform3f(h,i.u_end_color)})};let Oa;function Wl(h,i,a,d,m,y,b){const E=h.context,M=E.gl,k=h.useProgram("collisionBox"),P=[];let R=0,N=0;for(let ne=0;ne<d.length;ne++){const te=d[ne],ie=i.getTile(te),se=ie.getBucket(a);if(!se)continue;let ge=te.projMatrix;m[0]===0&&m[1]===0||(ge=h.translatePosMatrix(te.projMatrix,ie,m,y));const be=b?se.textCollisionBox:se.iconCollisionBox,Xe=se.collisionCircleArray;if(Xe.length>0){const Ne=o.create(),Fe=ge;o.mul(Ne,se.placementInvProjMatrix,h.transform.glCoordMatrix),o.mul(Ne,Ne,se.placementViewportMatrix),P.push({circleArray:Xe,circleOffset:N,transform:Fe,invTransform:Ne}),R+=Xe.length/4,N=R}be&&(h.terrain&&h.terrain.setupElevationDraw(ie,k),k.draw(E,M.LINES,o.DepthMode.disabled,o.StencilMode.disabled,h.colorModeForRenderPass(),o.CullFaceMode.disabled,Mu(ge,h.transform,ie),a.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,null,h.transform.zoom,null,be.collisionVertexBuffer,be.collisionVertexBufferExt))}if(!b||!P.length)return;const H=h.useProgram("collisionCircle"),Z=new o.StructArrayLayout2f1f2i16;Z.resize(4*R),Z._trim();let K=0;for(const ne of P)for(let te=0;te<ne.circleArray.length/4;te++){const ie=4*te,se=ne.circleArray[ie+0],ge=ne.circleArray[ie+1],be=ne.circleArray[ie+2],Xe=ne.circleArray[ie+3];Z.emplace(K++,se,ge,be,Xe,0),Z.emplace(K++,se,ge,be,Xe,1),Z.emplace(K++,se,ge,be,Xe,2),Z.emplace(K++,se,ge,be,Xe,3)}(!Oa||Oa.length<2*R)&&(Oa=function(ne){const te=2*ne,ie=new o.StructArrayLayout3ui6;ie.resize(te),ie._trim();for(let se=0;se<te;se++){const ge=6*se;ie.uint16[ge+0]=4*se+0,ie.uint16[ge+1]=4*se+1,ie.uint16[ge+2]=4*se+2,ie.uint16[ge+3]=4*se+2,ie.uint16[ge+4]=4*se+3,ie.uint16[ge+5]=4*se+0}return ie}(R));const ae=E.createIndexBuffer(Oa,!0),W=E.createVertexBuffer(Z,o.collisionCircleLayout.members,!0);for(const ne of P){const te={u_matrix:ne.transform,u_inv_matrix:ne.invTransform,u_camera_to_center_distance:(re=h.transform).cameraToCenterDistance,u_viewport_size:[re.width,re.height]};H.draw(E,M.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,h.colorModeForRenderPass(),o.CullFaceMode.disabled,te,a.id,W,ae,o.SegmentVector.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,h.transform.zoom,null,null,null)}var re;W.destroy(),ae.destroy()}const zs=o.identity(new Float32Array(16));function Du(h,i,a,d,m,y){const{horizontalAlign:b,verticalAlign:E}=o.getAnchorAlignment(h),M=-(b-.5)*i,k=-(E-.5)*a,P=o.evaluateVariableOffset(h,d);return new o.pointGeometry((M/m+P[0])*y,(k/m+P[1])*y)}function Fd(h,i,a,d,m,y,b,E,M,k,P,R){const N=h.text.placedSymbolArray,H=h.text.dynamicLayoutVertexArray,Z=h.icon.dynamicLayoutVertexArray,K={},ae=E.projMatrix,W=y.elevation,re=W?W.getAtTileOffsetFunc(E,R):ne=>[0,0,0];H.clear();for(let ne=0;ne<N.length;ne++){const te=N.get(ne),ie=h.allowVerticalPlacement&&!te.placedOrientation,se=te.hidden||!te.crossTileID||ie?null:d[te.crossTileID];if(se){const ge=new o.pointGeometry(te.tileAnchorX,te.tileAnchorY),be=re(ge),Xe=Vi(ge,a?ae:b,be[2]),Ne=Nr(y.cameraToCenterDistance,Xe.signedDistanceFromCamera);let Fe=m.evaluateSizeForFeature(h.textSizeData,k,te)*Ne/o.ONE_EM;a&&(Fe*=h.tilePixelRatio/M);const{width:Ae,height:ve,anchor:Re,textOffset:ze,textScale:ct}=se,mt=Du(Re,Ae,ve,ze,ct,Fe),kt=a?Vi(ge.add(mt),b,be[2]).point:Xe.point.add(i?mt.rotate(-y.angle):mt),We=h.allowVerticalPlacement&&te.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let ft=0;ft<te.numGlyphs;ft++)o.addDynamicAttributes(H,kt,We);P&&te.associatedIconIndex>=0&&(K[te.associatedIconIndex]={shiftedAnchor:kt,angle:We})}else bn(te.numGlyphs,H)}if(P){Z.clear();const ne=h.icon.placedSymbolArray;for(let te=0;te<ne.length;te++){const ie=ne.get(te);if(ie.hidden)bn(ie.numGlyphs,Z);else{const se=K[te];if(se)for(let ge=0;ge<ie.numGlyphs;ge++)o.addDynamicAttributes(Z,se.shiftedAnchor,se.angle);else bn(ie.numGlyphs,Z)}}h.icon.dynamicLayoutVertexBuffer.updateData(Z)}h.text.dynamicLayoutVertexBuffer.updateData(H)}function Ud(h,i,a){return a.iconsInText&&i?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Ps(h,i,a,d,m,y,b,E,M,k,P,R){const N=h.context,H=N.gl,Z=h.transform,K=Z.projection.createTileTransform(Z,Z.worldSize),ae=E==="map",W=M==="map",re=ae&&a.layout.get("symbol-placement")!=="point",ne=ae&&!W&&!re,te=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ie=!1;const se=h.depthModeForSublayer(0,o.DepthMode.ReadOnly),ge=[o.mercatorXfromLng(Z.center.lng),o.mercatorYfromLat(Z.center.lat)],be=a.layout.get("text-variable-anchor"),Xe=Z.projection.name==="globe",Ne=Xe?o.globeToMercatorTransition(Z.zoom):0,Fe=[],Ae=[];h.terrain&&W&&Ae.push("PITCH_WITH_MAP_TERRAIN"),Xe&&Ae.push("PROJECTION_GLOBE_VIEW"),re&&Ae.push("PROJECTED_POS_ON_VIEWPORT");for(const ve of d){const Re=i.getTile(ve),ze=Re.getBucket(a);if(!ze||ze.projection!==Z.projection.name)continue;const ct=m?ze.text:ze.icon;if(!ct||ze.fullyClipped||!ct.segments.get().length)continue;const mt=ct.programConfigurations.get(a.id),kt=m||ze.sdfIcons,We=m?ze.textSizeData:ze.iconSizeData,ft=W||Z.pitch!==0,xt=h.useProgram(Ud(kt,m,ze),mt,Ae),ai=o.evaluateSizeForZoom(We,Z.zoom),yi=[ve.canonical.x,ve.canonical.y,1<<ve.canonical.z];let yt,Lt,Ci,Ji,kr=[0,0],sn=null;if(m){if(Lt=Re.glyphAtlasTexture,Ci=H.LINEAR,yt=Re.glyphAtlasTexture.size,ze.iconsInText){kr=Re.imageAtlasTexture.size,sn=Re.imageAtlasTexture;const or=We.kind==="composite"||We.kind==="camera";Ji=ft||h.options.rotating||h.options.zooming||or?H.LINEAR:H.NEAREST}}else{const or=a.layout.get("icon-size").constantOr(0)!==1||ze.iconsNeedLinear;Lt=Re.imageAtlasTexture,Ci=kt||h.options.rotating||h.options.zooming||or||ft?H.LINEAR:H.NEAREST,yt=Re.imageAtlasTexture.size}const En=h.transform.calculatePixelsToTileUnitsMatrix(Re),$t=en(ve.projMatrix,Re.tileID.canonical,W,ae,h.transform,En),bt=h.terrain&&W&&re?o.invert(new Float32Array(16),$t):zs,Ft=tn(ve.projMatrix,Re.tileID.canonical,W,ae,h.transform,En),Fi=be&&ze.hasTextData(),Vr=a.layout.get("icon-text-fit")!=="none"&&Fi&&ze.hasIconData();if(re){const or=Z.elevation,Ro=or?or.getAtTileOffsetFunc(ve,K):yo=>[0,0,0];gu(ze,ve.projMatrix,h,m,$t,Ft,W,k,Ro,ve)}const Ei=h.translatePosMatrix(ve.projMatrix,Re,y,b),$r=re||m&&be||Vr?zs:$t,Ja=h.translatePosMatrix(Ft,Re,y,b,!0),zr=kt&&a.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Lo;const nt=K.createInversionMatrix(ve.toUnwrapped());Lo=kt?ze.iconsInText?Ba(We.kind,ai,ne,W,h,Ei,$r,Ja,yt,kr,yi,Ne,nt,ge):Ra(We.kind,ai,ne,W,h,Ei,$r,Ja,m,yt,!0,yi,Ne,nt,ge):Ms(We.kind,ai,ne,W,h,Ei,$r,Ja,m,yt,yi,Ne,nt,ge);const pt={program:xt,buffers:ct,uniformValues:Lo,atlasTexture:Lt,atlasTextureIcon:sn,atlasInterpolation:Ci,atlasInterpolationIcon:Ji,isSDF:kt,hasHalo:zr,tile:Re,labelPlaneMatrixInv:bt};if(te&&ze.canOverlap){ie=!0;const or=ct.segments.get();for(const Ro of or)Fe.push({segments:new o.SegmentVector([Ro]),sortKey:Ro.sortKey,state:pt})}else Fe.push({segments:ct.segments,sortKey:0,state:pt})}ie&&Fe.sort((ve,Re)=>ve.sortKey-Re.sortKey);for(const ve of Fe){const Re=ve.state;if(h.terrain&&h.terrain.setupElevationDraw(Re.tile,Re.program,{useDepthForOcclusion:!Xe,labelPlaneMatrixInv:Re.labelPlaneMatrixInv}),N.activeTexture.set(H.TEXTURE0),Re.atlasTexture.bind(Re.atlasInterpolation,H.CLAMP_TO_EDGE),Re.atlasTextureIcon&&(N.activeTexture.set(H.TEXTURE1),Re.atlasTextureIcon&&Re.atlasTextureIcon.bind(Re.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),Re.isSDF){const ze=Re.uniformValues;Re.hasHalo&&(ze.u_is_halo=1,Ds(Re.buffers,ve.segments,a,h,Re.program,se,P,R,ze)),ze.u_is_halo=0}Ds(Re.buffers,ve.segments,a,h,Re.program,se,P,R,Re.uniformValues)}}function Ds(h,i,a,d,m,y,b,E,M){const k=d.context;m.draw(k,k.gl.TRIANGLES,y,b,E,o.CullFaceMode.disabled,M,a.id,h.layoutVertexBuffer,h.indexBuffer,i,a.paint,d.transform.zoom,h.programConfigurations.get(a.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Ls(h,i,a,d,m,y,b){const E=h.context.gl,M=a.paint.get("fill-pattern"),k=M&&M.constantOr(1),P=a.getCrossfadeParameters();let R,N,H,Z,K;b?(N=k&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=E.LINES):(N=k?"fillPattern":"fill",R=E.TRIANGLES);for(const ae of d){const W=i.getTile(ae);if(k&&!W.patternsLoaded())continue;const re=W.getBucket(a);if(!re)continue;h.prepareDrawTile(ae);const ne=re.programConfigurations.get(a.id),te=h.useProgram(N,ne);k&&(h.context.activeTexture.set(E.TEXTURE0),W.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ne.updatePaintBuffers(P));const ie=M.constantOr(null);if(ie&&W.imageAtlas){const ge=W.imageAtlas,be=ge.patternPositions[ie.to.toString()],Xe=ge.patternPositions[ie.from.toString()];be&&Xe&&ne.setConstantPatternPositions(be,Xe)}const se=h.translatePosMatrix(ae.projMatrix,W,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(b){Z=re.indexBuffer2,K=re.segments2;const ge=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];H=N==="fillOutlinePattern"&&k?Iu(se,h,P,W,ge):Bd(se,ge)}else Z=re.indexBuffer,K=re.segments,H=k?Gl(se,h,P,W):Cu(se);h.prepareDrawProgram(h.context,te,ae.toUnwrapped()),te.draw(h.context,R,m,h.stencilModeForClipping(ae),y,o.CullFaceMode.disabled,H,a.id,re.layoutVertexBuffer,Z,K,a.paint,h.transform.zoom,ne)}}function Fa(h,i,a,d,m,y,b){const E=h.context,M=E.gl,k=a.paint.get("fill-extrusion-pattern"),P=k.constantOr(1),R=a.getCrossfadeParameters(),N=a.paint.get("fill-extrusion-opacity");for(const H of d){const Z=i.getTile(H),K=Z.getBucket(a);if(!K)continue;const ae=K.programConfigurations.get(a.id),W=h.useProgram(P?"fillExtrusionPattern":"fillExtrusion",ae);if(h.terrain){const se=h.terrain;if(!K.enableTerrain)continue;if(se.setupElevationDraw(Z,W,{useMeterToDem:!0}),Lu(E,i,H,K,a,se),!K.centroidVertexBuffer){const ge=W.attributes.a_centroid_pos;ge!==void 0&&M.vertexAttrib2f(ge,0,0)}}P&&(h.context.activeTexture.set(M.TEXTURE0),Z.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),ae.updatePaintBuffers(R));const re=k.constantOr(null);if(re&&Z.imageAtlas){const se=Z.imageAtlas,ge=se.patternPositions[re.to.toString()],be=se.patternPositions[re.from.toString()];ge&&be&&ae.setConstantPatternPositions(ge,be)}const ne=h.translatePosMatrix(H.projMatrix,Z,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),te=a.paint.get("fill-extrusion-vertical-gradient"),ie=P?$l(ne,h,te,N,H,R,Z):Au(ne,h,te,N);h.prepareDrawProgram(E,W,H.toUnwrapped()),W.draw(E,E.gl.TRIANGLES,m,y,b,o.CullFaceMode.backCCW,ie,a.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,a.paint,h.transform.zoom,ae,h.terrain?K.centroidVertexBuffer:null)}}function Lu(h,i,a,d,m,y){const b=[W=>{let re=W.canonical.x-1,ne=W.wrap;return re<0&&(re=(1<<W.canonical.z)-1,ne--),new o.OverscaledTileID(W.overscaledZ,ne,W.canonical.z,re,W.canonical.y)},W=>{let re=W.canonical.x+1,ne=W.wrap;return re===1<<W.canonical.z&&(re=0,ne++),new o.OverscaledTileID(W.overscaledZ,ne,W.canonical.z,re,W.canonical.y)},W=>new o.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,(W.canonical.y===0?1<<W.canonical.z:W.canonical.y)-1),W=>new o.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y===(1<<W.canonical.z)-1?0:W.canonical.y+1)],E=W=>{const re=i.getSource().maxzoom,ne=ge=>{const be=i.getTileByID(ge);if(be&&be.hasData())return be.getBucket(m)};let te,ie,se;return(W.overscaledZ===W.canonical.z||W.overscaledZ>=re)&&(te=ne(W.key)),W.overscaledZ>=re&&(ie=ne(W.calculateScaledKey(W.overscaledZ+1))),W.overscaledZ>re&&(se=ne(W.calculateScaledKey(W.overscaledZ-1))),te||ie||se},M=[0,0,0],k=(W,re)=>(M[0]=Math.min(W.min.y,re.min.y),M[1]=Math.max(W.max.y,re.max.y),M[2]=o.EXTENT-re.min.x>W.max.x?re.min.x-o.EXTENT:W.max.x,M),P=(W,re)=>(M[0]=Math.min(W.min.x,re.min.x),M[1]=Math.max(W.max.x,re.max.x),M[2]=o.EXTENT-re.min.y>W.max.y?re.min.y-o.EXTENT:W.max.y,M),R=[(W,re)=>k(W,re),(W,re)=>k(re,W),(W,re)=>P(W,re),(W,re)=>P(re,W)],N=new o.pointGeometry(0,0);let H,Z,K;const ae=(W,re,ne,te,ie)=>{const se=[[te?ne:W,te?W:ne,0],[te?ne:re,te?re:ne,0]],ge=ie<0?o.EXTENT+ie:ie,be=[te?ge:(W+re)/2,te?(W+re)/2:ge,0];return ne===0&&ie<0||ne!==0&&ie>0?y.getForTilePoints(K,[be],!0,Z):se.push(be),y.getForTilePoints(a,se,!0,H),Math.max(se[0][2],se[1][2],be[2])/y.exaggeration()};for(let W=0;W<4;W++){const re=d.borders[W];if(re.length===0&&(d.borderDone[W]=!0),d.borderDone[W])continue;const ne=K=b[W](a),te=E(ne);if(!te||!te.enableTerrain||(Z=y.findDEMTileFor(ne),!Z||!Z.dem))continue;if(!H){const be=y.findDEMTileFor(a);if(!be||!be.dem)return;H=be}const ie=(W<2?1:5)-W,se=te.borders[ie];let ge=0;for(let be=0;be<re.length;be++){const Xe=d.featuresOnBorder[re[be]],Ne=Xe.borders[W];let Fe;for(;ge<se.length&&(Fe=te.featuresOnBorder[se[ge]],!(Fe.borders[ie][1]>Ne[0]+3));)te.borderDone[ie]||te.encodeCentroid(void 0,Fe,!1),ge++;if(Fe&&ge<se.length){const Ae=ge;let ve=0;for(;!(Fe.borders[ie][0]>Ne[1]-3)&&(ve++,++ge!==se.length);)Fe=te.featuresOnBorder[se[ge]];if(Fe=te.featuresOnBorder[se[Ae]],Xe.intersectsCount()>1||Fe.intersectsCount()>1||ve!==1){ve!==1&&(ge=Ae),d.encodeCentroid(void 0,Xe,!1),te.borderDone[ie]||te.encodeCentroid(void 0,Fe,!1);continue}const Re=R[W](Xe,Fe),ze=W%2?o.EXTENT-1:0;N.x=ae(Re[0],Math.min(o.EXTENT-1,Re[1]),ze,W<2,Re[2]),N.y=0,d.encodeCentroid(N,Xe,!1),te.borderDone[ie]||te.encodeCentroid(N,Fe,!1)}else d.encodeCentroid(void 0,Xe,!1)}d.borderDone[W]=d.needsCentroidUpdate=!0,te.borderDone[ie]||(te.borderDone[ie]=te.needsCentroidUpdate=!0)}(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(h)}const Ru=new o.Color(1,0,0,1),Nd=new o.Color(0,1,0,1),Ua=new o.Color(0,0,1,1),Na=new o.Color(1,0,1,1),Bu=new o.Color(0,1,1,1);function Mr(h,i,a,d){Do(h,0,i+a/2,h.transform.width,a,d)}function Rs(h,i,a,d){Do(h,i-a/2,0,a,h.transform.height,d)}function Do(h,i,a,d,m,y){const b=h.context,E=b.gl;E.enable(E.SCISSOR_TEST),E.scissor(i*o.exported.devicePixelRatio,a*o.exported.devicePixelRatio,d*o.exported.devicePixelRatio,m*o.exported.devicePixelRatio),b.clear({color:y}),E.disable(E.SCISSOR_TEST)}function Bs(h,i,a){const d=h.context,m=d.gl,y=a.projMatrix,b=h.useProgram("debug"),E=i.getTileByID(a.key);h.terrain&&h.terrain.setupElevationDraw(E,b);const M=o.DepthMode.disabled,k=o.StencilMode.disabled,P=h.colorModeForRenderPass(),R="$debug";d.activeTexture.set(m.TEXTURE0),h.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),E._makeDebugTileBoundsBuffers(h.context,h.transform.projection);const N=E._tileDebugBuffer||h.debugBuffer,H=E._tileDebugIndexBuffer||h.debugIndexBuffer,Z=E._tileDebugSegments||h.debugSegments;b.draw(d,m.LINE_STRIP,M,k,P,o.CullFaceMode.disabled,ql(y,o.Color.red),R,N,H,Z);const K=E.latestRawTileData,ae=Math.floor((K&&K.byteLength||0)/1024),W=i.getTile(a).tileSize,re=512/Math.min(W,512)*(a.overscaledZ/h.transform.zoom)*.5;let ne=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(ne+=` => ${a.overscaledZ}`),function(te,ie){te.initDebugOverlayCanvas();const se=te.debugOverlayCanvas,ge=te.context.gl,be=te.debugOverlayCanvas.getContext("2d");be.clearRect(0,0,se.width,se.height),be.shadowColor="white",be.shadowBlur=2,be.lineWidth=1.5,be.strokeStyle="white",be.textBaseline="top",be.font="bold 36px Open Sans, sans-serif",be.fillText(ie,5,5),be.strokeText(ie,5,5),te.debugOverlayTexture.update(se),te.debugOverlayTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)}(h,`${ne} ${ae}kb`),b.draw(d,m.TRIANGLES,M,k,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,ql(y,o.Color.transparent,re),R,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments)}const Xl=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Hl}=Xl;function wn(h,i,a,d){h.emplaceBack(i,a,d)}class Os{constructor(i){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,wn(this.vertexArray,-1,-1,1),wn(this.vertexArray,1,-1,1),wn(this.vertexArray,-1,1,1),wn(this.vertexArray,1,1,1),wn(this.vertexArray,-1,-1,-1),wn(this.vertexArray,1,-1,-1),wn(this.vertexArray,-1,1,-1),wn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Hl),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function po(h,i,a,d,m,y){const b=h.gl,E=i.paint.get("sky-atmosphere-color"),M=i.paint.get("sky-atmosphere-halo-color"),k=i.paint.get("sky-atmosphere-sun-intensity"),P=((R,N,H,Z,K)=>({u_matrix_3f:R,u_sun_direction:N,u_sun_intensity:H,u_color_tint_r:[Z.r,Z.g,Z.b,Z.a],u_color_tint_m:[K.r,K.g,K.b,K.a],u_luminance:5e-5}))(o.fromMat4([],d),m,k,E,M);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+y,i.skyboxTexture,0),a.draw(h,b.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,P,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const ja={symbol:function(h,i,a,d,m){if(h.renderPass!=="translucent")return;const y=o.StencilMode.disabled,b=h.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(E,M,k,P,R,N,H){const Z=M.transform,K=R==="map",ae=N==="map",W=Z.projection.createTileTransform(Z,Z.worldSize);for(const re of E){const ne=P.getTile(re),te=ne.getBucket(k);if(!te||te.projection!==Z.projection.name||!te.text||!te.text.segments.get().length)continue;const ie=o.evaluateSizeForZoom(te.textSizeData,Z.zoom),se=M.transform.calculatePixelsToTileUnitsMatrix(ne),ge=en(re.projMatrix,ne.tileID.canonical,ae,K,M.transform,se),be=k.layout.get("icon-text-fit")!=="none"&&te.hasIconData();if(ie){const Xe=Math.pow(2,Z.zoom-ne.tileID.overscaledZ);Fd(te,K,ae,H,o.symbolSize,Z,ge,re,Xe,ie,be,W)}}}(d,h,a,i,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),m),a.paint.get("icon-opacity").constantOr(1)!==0&&Ps(h,i,a,d,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),y,b),a.paint.get("text-opacity").constantOr(1)!==0&&Ps(h,i,a,d,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),y,b),i.map.showCollisionBoxes&&(Wl(h,i,a,d,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Wl(h,i,a,d,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(h,i,a,d){if(h.renderPass!=="translucent")return;const m=a.paint.get("circle-opacity"),y=a.paint.get("circle-stroke-width"),b=a.paint.get("circle-stroke-opacity"),E=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(m.constantOr(1)===0&&(y.constantOr(1)===0||b.constantOr(1)===0))return;const M=h.context,k=M.gl,P=h.depthModeForSublayer(0,o.DepthMode.ReadOnly),R=o.StencilMode.disabled,N=h.colorModeForRenderPass(),H=[];for(let K=0;K<d.length;K++){const ae=d[K],W=i.getTile(ae),re=W.getBucket(a);if(!re)continue;const ne=re.programConfigurations.get(a.id),te=Zl(a),ie={programConfiguration:ne,program:h.useProgram("circle",ne,te),layoutVertexBuffer:re.layoutVertexBuffer,indexBuffer:re.indexBuffer,uniformValues:Od(h,ae,W,a),tile:W};if(E){const se=re.segments.get();for(const ge of se)H.push({segments:new o.SegmentVector([ge]),sortKey:ge.sortKey,state:ie})}else H.push({segments:re.segments,sortKey:0,state:ie})}E&&H.sort((K,ae)=>K.sortKey-ae.sortKey);const Z={useDepthForOcclusion:h.transform.projection.name!=="globe"};for(const K of H){const{programConfiguration:ae,program:W,layoutVertexBuffer:re,indexBuffer:ne,uniformValues:te,tile:ie}=K.state,se=K.segments;h.terrain&&h.terrain.setupElevationDraw(ie,W,Z),h.prepareDrawProgram(M,W,ie.tileID.toUnwrapped()),W.draw(M,k.TRIANGLES,P,R,N,o.CullFaceMode.disabled,te,a.id,re,ne,se,a.paint,h.transform.zoom,ae)}},heatmap:function(h,i,a,d){if(a.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const m=h.context,y=m.gl,b=o.StencilMode.disabled,E=new o.ColorMode([y.ONE,y.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(M,k,P){const R=M.gl;M.activeTexture.set(R.TEXTURE1),M.viewport.set([0,0,k.width/4,k.height/4]);let N=P.heatmapFbo;if(N)R.bindTexture(R.TEXTURE_2D,N.colorAttachment.get()),M.bindFramebuffer.set(N.framebuffer);else{const H=R.createTexture();R.bindTexture(R.TEXTURE_2D,H),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MIN_FILTER,R.LINEAR),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MAG_FILTER,R.LINEAR),N=P.heatmapFbo=M.createFramebuffer(k.width/4,k.height/4,!1),function(Z,K,ae,W){const re=Z.gl;re.texImage2D(re.TEXTURE_2D,0,re.RGBA,K.width/4,K.height/4,0,re.RGBA,Z.extRenderToTextureHalfFloat?Z.extTextureHalfFloat.HALF_FLOAT_OES:re.UNSIGNED_BYTE,null),W.colorAttachment.set(ae)}(M,k,H,N)}})(m,h,a),m.clear({color:o.Color.transparent});for(let M=0;M<d.length;M++){const k=d[M];if(i.hasRenderableParent(k))continue;const P=i.getTile(k),R=P.getBucket(a);if(!R)continue;const N=R.programConfigurations.get(a.id),H=h.useProgram("heatmap",N),{zoom:Z}=h.transform;h.terrain&&h.terrain.setupElevationDraw(P,H),h.prepareDrawProgram(m,H,k.toUnwrapped()),H.draw(m,y.TRIANGLES,o.DepthMode.disabled,b,E,o.CullFaceMode.disabled,ku(k.projMatrix,P,Z,a.paint.get("heatmap-intensity")),a.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,a.paint,h.transform.zoom,N)}m.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(m,y){const b=m.context,E=b.gl,M=y.heatmapFbo;if(!M)return;b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,M.colorAttachment.get()),b.activeTexture.set(E.TEXTURE1);let k=y.colorRampTexture;k||(k=y.colorRampTexture=new o.Texture(b,y.colorRamp,E.RGBA)),k.bind(E.LINEAR,E.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(b,E.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,m.colorModeForRenderPass(),o.CullFaceMode.disabled,((P,R,N,H)=>({u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}))(0,y),y.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,y.paint,m.transform.zoom)}(h,a))},line:function(h,i,a,d){if(h.renderPass!=="translucent")return;const m=a.paint.get("line-opacity"),y=a.paint.get("line-width");if(m.constantOr(1)===0||y.constantOr(1)===0)return;const b=h.depthModeForSublayer(0,o.DepthMode.ReadOnly),E=h.colorModeForRenderPass(),M=a.paint.get("line-dasharray"),k=M.constantOr(1),P=a.layout.get("line-cap"),R=a.paint.get("line-pattern"),N=R.constantOr(1),H=a.paint.get("line-gradient"),Z=a.getCrossfadeParameters(),K=N?"linePattern":"line",ae=h.context,W=ae.gl,re=(te=>{const ie=[];La(te)&&ie.push("RENDER_LINE_DASH"),te.paint.get("line-gradient")&&ie.push("RENDER_LINE_GRADIENT");const se=te.paint.get("line-pattern").constantOr(1),ge=te.paint.get("line-opacity").constantOr(1)!==1;return!se&&ge&&ie.push("RENDER_LINE_ALPHA_DISCARD"),ie})(a);let ne=re.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(ne=!1);for(const te of d){const ie=i.getTile(te);if(N&&!ie.patternsLoaded())continue;const se=ie.getBucket(a);if(!se)continue;h.prepareDrawTile(te);const ge=se.programConfigurations.get(a.id),be=h.useProgram(K,ge,re),Xe=R.constantOr(null);if(Xe&&ie.imageAtlas){const ze=ie.imageAtlas,ct=ze.patternPositions[Xe.to.toString()],mt=ze.patternPositions[Xe.from.toString()];ct&&mt&&ge.setConstantPatternPositions(ct,mt)}const Ne=M.constantOr(null),Fe=P.constantOr(null);if(!N&&Ne&&Fe&&ie.lineAtlas){const ze=ie.lineAtlas,ct=ze.getDash(Ne.to,Fe),mt=ze.getDash(Ne.from,Fe);ct&&mt&&ge.setConstantPatternPositions(ct,mt)}const Ae=h.terrain?te.projMatrix:null,ve=N?Po(h,ie,a,Z,Ae):zu(h,ie,a,Z,Ae,se.lineClipsArray.length);if(H){const ze=se.gradients[a.id];let ct=ze.texture;if(a.gradientVersion!==ze.version){let mt=256;if(a.stepInterpolant){const kt=i.getSource().maxzoom,We=te.canonical.z===kt?Math.ceil(1<<h.transform.maxZoom-te.canonical.z):1;mt=o.clamp(o.nextPowerOfTwo(se.maxLineLength/o.EXTENT*1024*We),256,ae.maxTextureSize)}ze.gradient=o.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:mt,image:ze.gradient||void 0,clips:se.lineClipsArray}),ze.texture?ze.texture.update(ze.gradient):ze.texture=new o.Texture(ae,ze.gradient,W.RGBA),ze.version=a.gradientVersion,ct=ze.texture}ae.activeTexture.set(W.TEXTURE1),ct.bind(a.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}k&&(ae.activeTexture.set(W.TEXTURE0),ie.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),ge.updatePaintBuffers(Z)),N&&(ae.activeTexture.set(W.TEXTURE0),ie.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),ge.updatePaintBuffers(Z)),h.prepareDrawProgram(ae,be,te.toUnwrapped());const Re=ze=>{be.draw(ae,W.TRIANGLES,b,ze,E,o.CullFaceMode.disabled,ve,a.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,a.paint,h.transform.zoom,ge,se.layoutVertexBuffer2)};if(ne){const ze=h.stencilModeForClipping(te).ref;ze===0&&h.terrain&&ae.clear({stencil:0});const ct={func:W.EQUAL,mask:255};ve.u_alpha_discard_threshold=.8,Re(new o.StencilMode(ct,ze,255,W.KEEP,W.KEEP,W.INVERT)),ve.u_alpha_discard_threshold=0,Re(new o.StencilMode(ct,ze,255,W.KEEP,W.KEEP,W.KEEP))}else Re(h.stencilModeForClipping(te))}ne&&(h.resetStencilClippingMasks(),h.terrain&&ae.clear({stencil:0}))},fill:function(h,i,a,d){const m=a.paint.get("fill-color"),y=a.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const b=h.colorModeForRenderPass(),E=a.paint.get("fill-pattern"),M=h.opaquePassEnabledForLayer()&&!E.constantOr(1)&&m.constantOr(o.Color.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===M){const k=h.depthModeForSublayer(1,h.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);Ls(h,i,a,d,k,b,!1)}if(h.renderPass==="translucent"&&a.paint.get("fill-antialias")){const k=h.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);Ls(h,i,a,d,k,b,!0)}},"fill-extrusion":function(h,i,a,d){const m=a.paint.get("fill-extrusion-opacity");if(m!==0&&h.renderPass==="translucent"){const y=new o.DepthMode(h.context.gl.LEQUAL,o.DepthMode.ReadWrite,h.depthRangeFor3D);if(m!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))Fa(h,i,a,d,y,o.StencilMode.disabled,o.ColorMode.disabled),Fa(h,i,a,d,y,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const b=h.colorModeForRenderPass();Fa(h,i,a,d,y,o.StencilMode.disabled,b)}}},hillshade:function(h,i,a,d){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const m=h.context,y=h.depthModeForSublayer(0,o.DepthMode.ReadOnly),b=h.colorModeForRenderPass(),E=h.terrain&&h.terrain.renderingToTexture,[M,k]=h.renderPass!=="translucent"||E?[{},d]:h.stencilConfigForOverlap(d);for(const P of k){const R=i.getTile(P);if(R.needsHillshadePrepare&&h.renderPass==="offscreen")ka(h,R,a,y,o.StencilMode.disabled,b);else if(h.renderPass==="translucent"){const N=E&&h.terrain?h.terrain.stencilModeForRTTOverlap(P):M[P.overscaledZ];Ss(h,P,R,a,y,N,b)}}m.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,i,a,d,m,y){if(h.renderPass!=="translucent"||a.paint.get("raster-opacity")===0||!d.length)return;const b=h.context,E=b.gl,M=i.getSource(),k=h.useProgram("raster"),P=h.colorModeForRenderPass(),R=h.terrain&&h.terrain.renderingToTexture,[N,H]=M instanceof Ri||R?[{},d]:h.stencilConfigForOverlap(d),Z=H[H.length-1].overscaledZ,K=!h.options.moving;for(const ae of H){const W=R?o.DepthMode.disabled:h.depthModeForSublayer(ae.overscaledZ-Z,a.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,E.LESS),re=ae.toUnwrapped(),ne=i.getTile(ae);if(R&&(!ne||!ne.hasData()))continue;const te=R?ae.projMatrix:h.transform.calculateProjMatrix(re,K),ie=h.terrain&&R?h.terrain.stencilModeForRTTOverlap(ae):N[ae.overscaledZ],se=y?0:a.paint.get("raster-fade-duration");ne.registerFadeDuration(se);const ge=i.findLoadedParent(ae,0),be=Tu(ne,ge,i,h.transform,se);let Xe,Ne;h.terrain&&h.terrain.prepareDrawTile(ae);const Fe=a.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;b.activeTexture.set(E.TEXTURE0),ne.texture.bind(Fe,E.CLAMP_TO_EDGE),b.activeTexture.set(E.TEXTURE1),ge?(ge.texture.bind(Fe,E.CLAMP_TO_EDGE),Xe=Math.pow(2,ge.tileID.overscaledZ-ne.tileID.overscaledZ),Ne=[ne.tileID.canonical.x*Xe%1,ne.tileID.canonical.y*Xe%1]):ne.texture.bind(Fe,E.CLAMP_TO_EDGE);const Ae=Cs(te,Ne||[0,0],Xe||1,be,a,M instanceof Ri?M.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(b,k,re),M instanceof Ri)k.draw(b,E.TRIANGLES,W,o.StencilMode.disabled,P,o.CullFaceMode.disabled,Ae,a.id,M.boundsBuffer,h.quadTriangleIndexBuffer,M.boundsSegments);else{const{tileBoundsBuffer:ve,tileBoundsIndexBuffer:Re,tileBoundsSegments:ze}=h.getTileBoundsBuffers(ne);k.draw(b,E.TRIANGLES,W,ie,P,o.CullFaceMode.disabled,Ae,a.id,ve,Re,ze)}}h.resetStencilClippingMasks()},background:function(h,i,a,d){const m=a.paint.get("background-color"),y=a.paint.get("background-opacity");if(y===0)return;const b=h.context,E=b.gl,M=h.transform,k=M.tileSize,P=a.paint.get("background-pattern");if(h.isPatternMissing(P))return;const R=!P&&m.a===1&&y===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==R)return;const N=o.StencilMode.disabled,H=h.depthModeForSublayer(0,R==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),Z=h.colorModeForRenderPass(),K=h.useProgram(P?"backgroundPattern":"background");let ae,W=d;W||(ae=h.getBackgroundTiles(),W=Object.values(ae).map(ne=>ne.tileID)),P&&(b.activeTexture.set(E.TEXTURE0),h.imageManager.bind(h.context));const re=a.getCrossfadeParameters();for(const ne of W){const te=ne.toUnwrapped(),ie=d?ne.projMatrix:h.transform.calculateProjMatrix(te);h.prepareDrawTile(ne);const se=i?i.getTile(ne):ae?ae[ne.key]:new o.Tile(ne,k,M.zoom,h),ge=P?ks(ie,y,h,P,{tileID:ne,tileSize:k},re):ni(ie,y,m);h.prepareDrawProgram(b,K,te);const{tileBoundsBuffer:be,tileBoundsIndexBuffer:Xe,tileBoundsSegments:Ne}=h.getTileBoundsBuffers(se);K.draw(b,E.TRIANGLES,H,N,Z,o.CullFaceMode.disabled,ge,a.id,be,Xe,Ne)}},sky:function(h,i,a){const d=h.transform,m=d.projection.name==="mercator"||d.projection.name==="globe"?1:o.smoothstep(7,8,d.zoom),y=a.paint.get("sky-opacity")*m;if(y===0)return;const b=h.context,E=a.paint.get("sky-type"),M=new o.DepthMode(b.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),k=h.frameCounter/1e3%1;E==="atmosphere"?h.renderPass==="offscreen"?a.needsSkyboxCapture(h)&&(function(P,R,N,H){const Z=P.context,K=Z.gl;let ae=R.skyboxFbo;if(!ae){ae=R.skyboxFbo=Z.createFramebuffer(32,32,!1),R.skyboxGeometry=new Os(Z),R.skyboxTexture=Z.gl.createTexture(),K.bindTexture(K.TEXTURE_CUBE_MAP,R.skyboxTexture),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR);for(let te=0;te<6;++te)K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,K.RGBA,32,32,0,K.RGBA,K.UNSIGNED_BYTE,null)}Z.bindFramebuffer.set(ae.framebuffer),Z.viewport.set([0,0,32,32]);const W=R.getCenter(P,!0),re=P.useProgram("skyboxCapture"),ne=new Float64Array(16);o.identity(ne),o.rotateY(ne,ne,.5*-Math.PI),po(Z,R,re,ne,W,0),o.identity(ne),o.rotateY(ne,ne,.5*Math.PI),po(Z,R,re,ne,W,1),o.identity(ne),o.rotateX(ne,ne,.5*-Math.PI),po(Z,R,re,ne,W,2),o.identity(ne),o.rotateX(ne,ne,.5*Math.PI),po(Z,R,re,ne,W,3),o.identity(ne),po(Z,R,re,ne,W,4),o.identity(ne),o.rotateY(ne,ne,Math.PI),po(Z,R,re,ne,W,5),Z.viewport.set([0,0,P.width,P.height])}(h,a),a.markSkyboxValid(h)):h.renderPass==="sky"&&function(P,R,N,H,Z){const K=P.context,ae=K.gl,W=P.transform,re=P.useProgram("skybox");K.activeTexture.set(ae.TEXTURE0),ae.bindTexture(ae.TEXTURE_CUBE_MAP,R.skyboxTexture);const ne=((te,ie,se,ge,be)=>({u_matrix:te,u_sun_direction:ie,u_cubemap:0,u_opacity:ge,u_temporal_offset:be}))(W.skyboxMatrix,R.getCenter(P,!1),0,H,Z);P.prepareDrawProgram(K,re),re.draw(K,ae.TRIANGLES,N,o.StencilMode.disabled,P.colorModeForRenderPass(),o.CullFaceMode.backCW,ne,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(h,a,M,y,k):E==="gradient"&&h.renderPass==="sky"&&function(P,R,N,H,Z){const K=P.context,ae=K.gl,W=P.transform,re=P.useProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new Os(K)),K.activeTexture.set(ae.TEXTURE0);let ne=R.colorRampTexture;ne||(ne=R.colorRampTexture=new o.Texture(K,R.colorRamp,ae.RGBA)),ne.bind(ae.LINEAR,ae.CLAMP_TO_EDGE);const te=((ie,se,ge,be,Xe)=>({u_matrix:ie,u_color_ramp:0,u_center_direction:se,u_radius:o.degToRad(ge),u_opacity:be,u_temporal_offset:Xe}))(W.skyboxMatrix,R.getCenter(P,!1),R.paint.get("sky-gradient-radius"),H,Z);P.prepareDrawProgram(K,re),re.draw(K,ae.TRIANGLES,N,o.StencilMode.disabled,P.colorModeForRenderPass(),o.CullFaceMode.backCW,te,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(h,a,M,y,k)},debug:function(h,i,a){for(let d=0;d<a.length;d++)Bs(h,i,a[d])},custom:function(h,i,a){const d=h.context,m=a.implementation;if(h.transform.projection.unsupportedLayers&&h.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(h.renderPass==="offscreen"){const y=m.prerender;y&&(h.setCustomLayerDefaults(),d.setColorMode(h.colorModeForRenderPass()),y.call(m,d.gl,h.transform.customLayerMatrix()),d.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),d.setColorMode(h.colorModeForRenderPass()),d.setStencilMode(o.StencilMode.disabled);const y=m.renderingMode==="3d"?new o.DepthMode(h.context.gl.LEQUAL,o.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,o.DepthMode.ReadOnly);d.setDepthMode(y),m.render(d.gl,h.transform.customLayerMatrix()),d.setDirty(),h.setBaseState(),d.bindFramebuffer.set(null)}}};class Ou{constructor(i,a){this.context=new St(i),this.transform=a,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ia,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,a){const d=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new fo(this,i));const m=this._terrain;this.transform.elevation=d?m:null,m.update(i,this.transform,a)}_updateFog(i){const a=i.fog;if(!a||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,m]=a.getFovAdjustedRange(this.transform._fov);if(d>m)return void(this.transform.fogCullDistSq=null);const y=d+.78*(m-d);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,a){if(this.width=i*o.exported.devicePixelRatio,this.height=a*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._layers[d].resize()}setup(){const i=this.context,a=new o.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(o.EXTENT,0),a.emplaceBack(0,o.EXTENT),a.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(a,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const d=new o.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(o.EXTENT,0),d.emplaceBack(0,o.EXTENT),d.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=i.createVertexBuffer(d,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const m=new o.StructArrayLayout2i4;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(m,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const y=new o.StructArrayLayout4i8;y.emplaceBack(0,0,0,0),y.emplaceBack(o.EXTENT,0,o.EXTENT,0),y.emplaceBack(0,o.EXTENT,0,o.EXTENT),y.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(y,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const b=new o.StructArrayLayout3ui6;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(b);const E=new o.StructArrayLayout1ui2;for(const k of[0,1,3,2,0])E.emplaceBack(k);this.debugIndexBuffer=i.createIndexBuffer(E),this.emptyTexture=new o.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA),this.identityMat=o.create();const M=this.context.gl;this.stencilClearMode=new o.StencilMode({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(o.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,a=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,a.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Bn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,a,d){if(!a||this.currentStencilSource===a.id||!i.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const M of d)if(this._tileClippingMaskIDs[M.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=a.id;const m=this.context,y=m.gl;this.nextStencilID+d.length>256&&this.clearStencil(),m.setColorMode(o.ColorMode.disabled),m.setDepthMode(o.DepthMode.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of d){const M=a.getTile(E),k=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:R,tileBoundsSegments:N}=this.getTileBoundsBuffers(M);b.draw(m,y.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:y.ALWAYS,mask:0},k,255,y.KEEP,y.KEEP,y.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Bn(E.projMatrix),"$clipping",P,R,N)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,a=this.context.gl;return new o.StencilMode({func:a.NOTEQUAL,mask:255},i,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const a=this.context.gl;return new o.StencilMode({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(i){const a=this.context.gl,d=i.sort((b,E)=>E.overscaledZ-b.overscaledZ),m=d[d.length-1].overscaledZ,y=d[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const b={};for(let E=0;E<y;E++)b[E+m]=new o.StencilMode({func:a.GEQUAL,mask:255},E+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=y,[b,d]}return[{[m]:o.StencilMode.disabled},d]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([i.CONSTANT_COLOR,i.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(i,a,d){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new o.DepthMode(d||this.context.gl.LEQUAL,a,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,a){this.style=i,this.options=a,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const d=this.style.order,m=this.style._sourceCaches;for(const k in m){const P=m[k];P.used&&P.prepare(this.context)}const y={},b={},E={};for(const k in m){const P=m[k];y[k]=P.getVisibleCoordinates(),b[k]=y[k].slice().reverse(),E[k]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<d.length;k++)if(this.style._layers[d[k]].is3D()){this.opaquePassCutoff=k;break}if(this.terrain&&(this.terrain.updateTileBinding(E),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const k of d){const P=this.style._layers[k],R=i._getLayerSourceCache(P);if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const N=R?b[R.id]:void 0;(P.type==="custom"||P.isSky()||N&&N.length)&&this.renderLayer(this,R,P,N)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let M=o.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(M=this.style.fog.properties.get("color")),this.context.clear({color:a.showOverdrawInspector?o.Color.black:M,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[d[this.currentLayer]],P=i._getLayerSourceCache(k);if(k.isSky())continue;const R=P?b[P.id]:void 0;this._renderTileClippingMasks(k,P,R),this.renderLayer(this,P,k,R)}if(this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const k=this.style._layers[d[this.currentLayer]],P=i._getLayerSourceCache(k);k.isSky()&&this.renderLayer(this,P,k,P?b[P.id]:void 0)}for(this.transform.projection.name==="globe"&&function(k){const P=k.context,R=P.gl,N=k.transform,H=new o.DepthMode(R.LEQUAL,o.DepthMode.ReadOnly,[0,1]),Z=k.useProgram("globeAtmosphere"),K=N._camera.getWorldToCamera(N.worldSize,1),ae=N._camera.getCameraToClipPerspective(N._fov,N.width/N.height,N._nearZ,N._farZ),W=o.mul([],K,o.calculateGlobeMatrix(N,N.worldSize)),re=o.mul([],N.labelPlaneMatrix,ae),ne=o.transformMat4([],[0,0,0],W),te=o.add([],ne,[N.worldSize/Math.PI/2,0,0]),ie=o.transformMat4([],ne,re),se=o.transformMat4([],te,re),ge=o.length(o.sub([],se,ie)),be=1-o.globeToMercatorTransition(N.zoom),Xe={u_center:ie,u_radius:ge,u_screen_size:[N.width,N.height],u_pixel_ratio:o.exported.devicePixelRatio,u_opacity:be,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};k.prepareDrawProgram(P,Z);const Ne=k.globeSharedBuffers;Ne&&Z.draw(P,R.TRIANGLES,H,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,Xe,"skybox",Ne.atmosphereVertexBuffer,Ne.atmosphereIndexBuffer,Ne.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;){const k=this.style._layers[d[this.currentLayer]],P=i._getLayerSourceCache(k);if(k.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(k)){if(k.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const R=P?(k.type==="symbol"?E:b)[P.id]:void 0;this._renderTileClippingMasks(k,P,P?y[P.id]:void 0),this.renderLayer(this,P,k,R),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let k=null;o.values(this.style._layers).forEach(P=>{const R=i._getLayerSourceCache(P);R&&!P.isHidden(this.transform.zoom)&&(!k||k.getSource().maxzoom<R.getSource().maxzoom)&&(k=R)}),k&&this.options.showTileBoundaries&&ja.debug(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const P=k.transform.padding;Mr(k,k.transform.height-(P.top||0),3,Ru),Mr(k,P.bottom||0,3,Nd),Rs(k,P.left||0,3,Ua),Rs(k,k.transform.width-(P.right||0),3,Na);const R=k.transform.centerPoint;(function(N,H,Z,K){Do(N,H-1,Z-10,2,20,K),Do(N,H-10,Z-1,20,2,K)})(k,R.x,k.transform.height-R.y,Bu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,a,d,m){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||m&&m.length)&&(this.id=d.id,this.gpuTimingStart(d),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(d.type)||ja[d.type](i,a,d,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let d=this.gpuTimers[i.id];d||(d=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),d.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,d.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}queryGpuTimers(i){const a={};for(const d in i){const m=i[d],y=this.context.extTimerQuery,b=y.getQueryObjectEXT(m.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(m.query),a[d]=b}return a}translatePosMatrix(i,a,d,m,y){if(!d[0]&&!d[1])return i;const b=y?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(b){const k=Math.sin(b),P=Math.cos(b);d=[d[0]*P-d[1]*k,d[0]*k+d[1]*P]}const E=[y?d[0]:qt(a,d[0],this.transform.zoom),y?d[1]:qt(a,d[1],this.transform.zoom),0],M=new Float32Array(16);return o.translate(M,i,E),M}saveTileTexture(i){const a=this._tileTextures[i.size[0]];a?a.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const a=this._tileTextures[i];return a&&a.length>0?a.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const a=this.imageManager.getPattern(i.from.toString()),d=this.imageManager.getPattern(i.to.toString());return!a||!d}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,a=this.style&&this.style.fog,d=[];return this.terrain&&!this.terrain.renderingToTexture&&d.push("TERRAIN"),a&&!i&&a.getOpacity(this.transform.pitch)!==0&&d.push("FOG"),i&&d.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&d.push("OVERDRAW_INSPECTOR"),d}useProgram(i,a,d){this.cache=this.cache||{};const m=d||[],y=this.currentGlobalDefines().concat(m),b=Pa.cacheKey(i,y,a);return this.cache[b]||(this.cache[b]=new Pa(this.context,i,Vl[i],a,Pu[i],y)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(i){this.terrain&&this.terrain.prepareDrawTile(i)}prepareDrawProgram(i,a,d){if(this.terrain&&this.terrain.renderingToTexture)return;const m=this.style.fog;if(m){const y=m.getOpacity(this.transform.pitch);y!==0&&a.setFogUniformValues(i,((b,E,M,k)=>{const P=E.properties.get("color"),R=b.frameCounter/1e3%1,N=[P.r/P.a,P.g/P.a,P.b/P.a,k];return{u_fog_matrix:M?b.transform.calculateFogTileMatrix(M):b.identityMat,u_fog_range:E.getFovAdjustedRange(b.transform._fov),u_fog_color:N,u_fog_horizon_blend:E.properties.get("horizon-blend"),u_fog_temporal_offset:R}})(this,m,d,y))}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const i=this.context.gl,a=i.createTexture();return i.bindTexture(i.TEXTURE_2D,a),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,a=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const m of d)a[m.key]=i[m.key]||new o.Tile(m,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}}class Fs{constructor(i=0,a=0,d=0,m=0){if(isNaN(i)||i<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=a,this.left=d,this.right=m}interpolate(i,a,d){return a.top!=null&&i.top!=null&&(this.top=o.number(i.top,a.top,d)),a.bottom!=null&&i.bottom!=null&&(this.bottom=o.number(i.bottom,a.bottom,d)),a.left!=null&&i.left!=null&&(this.left=o.number(i.left,a.left,d)),a.right!=null&&i.right!=null&&(this.right=o.number(i.right,a.right,d)),this}getCenter(i,a){const d=o.clamp((this.left+i-this.right)/2,0,i),m=o.clamp((this.top+a-this.bottom)/2,0,a);return new o.pointGeometry(d,m)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Fs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function mo(h,i){const a=o.getColumn(h,3);o.fromQuat(h,i),o.setColumn(h,3,a)}function Fu(h,i){o.setColumn(h,3,[i[0],i[1],i[2],1])}function Kl(h,i){const a=o.identity$1([]);return o.rotateZ$1(a,a,-i),o.rotateX$1(a,a,-h),a}function Yl(h,i){const a=[h[0],h[1],0],d=[i[0],i[1],0];if(o.length(a)>=1e-15){const b=o.normalize([],a);o.scale$2(d,b,o.dot(d,b)),i[0]=d[0],i[1]=d[1]}const m=o.cross([],i,h);if(o.len(m)<1e-15)return null;const y=Math.atan2(-m[1],m[0]);return Kl(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),y)}class Uu{constructor(i,a){this.position=i,this.orientation=a}get position(){return this._position}set position(i){this._position=this._renderWorldCopies?function(a){if(!a)return;const d=Array.isArray(a)?new o.MercatorCoordinate(a[0],a[1],a[2]):a;return d.x=o.wrap(d.x,0,1),d}(i):i}lookAtPoint(i,a){if(this.orientation=null,!this.position)return;const d=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(i)):0,m=this.position,y=o.MercatorCoordinate.fromLngLat(i,d),b=[y.x-m.x,y.y-m.y,y.z-m.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Yl(b,a)}setPitchBearing(i,a){this.orientation=Kl(o.degToRad(i),o.degToRad(-a))}}class Jl{constructor(i,a){this._transform=o.identity([]),this._orientation=o.identity$1([]),a&&(this._orientation=a,mo(this._transform,this._orientation)),i&&Fu(this._transform,i)}get mercatorPosition(){const i=this.position;return new o.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=o.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){Fu(this._transform,i)}get orientation(){return this._orientation}set orientation(i){this._orientation=i,mo(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,a){this._orientation=Kl(i,a),mo(this._transform,this._orientation)}forward(){const i=o.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=o.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=o.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,a){const d=new Float64Array(16);return o.invert(d,this.getWorldToCamera(i,a)),d}getWorldToCameraPosition(i,a,d){const m=this.position;o.scale$2(m,m,-i);const y=new Float64Array(16);return o.fromScaling(y,[d,d,d]),o.translate(y,y,m),y[10]*=a,y}getWorldToCamera(i,a){const d=new Float64Array(16),m=new Float64Array(4),y=this.position;return o.conjugate(m,this._orientation),o.scale$2(y,y,-i),o.fromQuat(d,m),o.translate(d,d,y),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=a,d[9]*=a,d[10]*=a,d[11]*=a,d}getCameraToClipPerspective(i,a,d,m){const y=new Float64Array(16);return o.perspective(y,i,a,d,m),y}getDistanceToElevation(i){const a=i===0?0:o.mercatorZfromAltitude(i,this.position[1]),d=this.forward();return(a-this.position[2])/d[2]}clone(){return new Jl([...this.position],[...this.orientation])}}function Nu(h,i){const a=Ns(h),d=function(y,b,E,M,k){const P=new o.LngLat(E.lng-180*Tn,E.lat),R=new o.LngLat(E.lng+180*Tn,E.lat),N=y.project(P.lng,P.lat),H=y.project(R.lng,R.lat),Z=-Math.atan2(H.y-N.y,H.x-N.x),K=o.MercatorCoordinate.fromLngLat(E);K.y=o.clamp(K.y,-.999975,.999975);const ae=K.toLngLat(),W=y.project(ae.lng,ae.lat),re=o.MercatorCoordinate.fromLngLat(ae);re.x+=Tn;const ne=re.toLngLat(),te=y.project(ne.lng,ne.lat),ie=ec(te.x-W.x,te.y-W.y,Z),se=o.MercatorCoordinate.fromLngLat(ae);se.y+=Tn;const ge=se.toLngLat(),be=y.project(ge.lng,ge.lat),Xe=ec(be.x-W.x,be.y-W.y,Z),Ne=Math.abs(ie.x)/Math.abs(Xe.y),Fe=o.identity([]);o.rotateZ(Fe,Fe,-Z*(1-(k?0:M)));const Ae=o.identity([]);return o.scale(Ae,Ae,[1,1-(1-Ne)*M,1]),Ae[4]=-Xe.x/Xe.y*M,o.rotateZ(Ae,Ae,Z),o.multiply$1(Ae,Fe,Ae),Ae}(h.projection,0,h.center,a,i),m=Us(h);return o.scale(d,d,[m,m,1]),d}function Us(h){const i=h.projection,a=Ns(h),d=Ql(i,h.center),m=Ql(i,o.LngLat.convert(i.center));return Math.pow(2,d*a+(1-a)*m)}function Ns(h){const i=h.projection.range;if(!i)return 0;const a=Math.max(h.width,h.height),d=Math.log(a/1024)/Math.LN2;return o.smoothstep(i[0]+d,i[1]+d,h.zoom)}const Tn=1/4e4;function Ql(h,i){const a=o.clamp(i.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),d=new o.LngLat(i.lng-180*Tn,a),m=new o.LngLat(i.lng+180*Tn,a),y=h.project(d.lng,a),b=h.project(m.lng,a),E=o.MercatorCoordinate.fromLngLat(d),M=o.MercatorCoordinate.fromLngLat(m),k=b.x-y.x,P=b.y-y.y,R=M.x-E.x,N=M.y-E.y,H=Math.sqrt((R*R+N*N)/(k*k+P*P));return Math.log(H)/Math.LN2}function ec(h,i,a){const d=Math.cos(a),m=Math.sin(a);return{x:h*d-i*m,y:h*m+i*d}}class Va{constructor(i,a,d,m,y){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=i||0,this._maxZoom=a||22,this._minPitch=d==null?0:d,this._maxPitch=m==null?60:m,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Fs,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Jl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const i=new Va(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.setProjection(this.getProjection()),i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i.tileSize=this.tileSize,i.setMaxBounds(this.getMaxBounds()),i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._cameraZoom=this._cameraZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,i?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(i){this._terrainEnabled()&&this._cameraZoom==null&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),i&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(i){i==null&&(i={name:"mercator"}),this.projectionOptions=i;const a=this.projection?this.getProjection():void 0;return this.projection=o.getProjection(i),!J(a,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const a=-i*Math.PI/180;var d;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(d=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d),function(m,y,b){var E=y[0],M=y[1],k=y[2],P=y[3],R=Math.sin(b),N=Math.cos(b);m[0]=E*N+k*R,m[1]=M*N+P*R,m[2]=E*-R+k*N,m[3]=M*-R+P*N}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const a=o.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(i){const a=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return i===-1?(this._cameraZoom=null,!1):(this._centerAltitude=i,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let m=0,y=0;for(let b=0;b<a.length;b++){const E=new o.pointGeometry(a[b][0]*this.width,d+a[b][1]*(this.height-d)),M=i.pointCoordinate(E);if(!M)continue;const k=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);m+=M[3]*k,y+=k}return y===0?NaN:m/y}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._cameraZoom==null||!this._elevation)return;const i=this._cameraZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*a,m=this._mercatorZfromZoom(i),y=this._mercatorZfromZoom(this._maxZoom),b=Math.max(m-d,y);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let d;d=i.z<this._camera.position[2]?[a.x,a.y,a.z]:[i.x,i.y,i.z];const m=o.length(o.sub([],this._camera.position,d));return o.clamp(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let a=!1;if(i.orientation&&!o.exactEquals(i.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(i.orientation)),i.position){const d=[i.position.x,i.position.y,i.position.z];o.exactEquals$1(d,this._camera.position)||(this._setCameraPosition(d),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,a=new Uu;return a.position=new o.MercatorCoordinate(i[0],i[1],i[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(i){if(!o.length$1(i))return!1;o.normalize$1(i,i);const a=o.transformQuat([],[0,0,-1],i),d=o.transformQuat([],[0,-1,0],i);if(d[2]<0)return!1;const m=Yl(a,d);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(i){const a=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;i[2]=o.clamp(i[2],m/d,m/a),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,a,d){this._unmodified=!1,this._edgeInsets.interpolate(i,a,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const a=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(i){const a=[new o.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const d=this.pointCoordinate(new o.pointGeometry(0,0)),m=this.pointCoordinate(new o.pointGeometry(this.width,0)),y=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),b=this.pointCoordinate(new o.pointGeometry(0,this.height)),E=Math.floor(Math.min(d.x,m.x,y.x,b.x)),M=Math.floor(Math.max(d.x,m.x,y.x,b.x)),k=1;for(let P=E-k;P<=M+k;P++)P!==0&&a.push(new o.UnwrappedTileID(P,i))}return a}coveringTiles(i){let a=this.coveringZoomLevel(i);const d=a,m=this.elevation&&!i.isTerrainDEM,y=this.projection.name==="mercator";if(i.minzoom!==void 0&&a<i.minzoom)return[];i.maxzoom!==void 0&&a>i.maxzoom&&(a=i.maxzoom);const b=this.locationCoordinate(this.center),E=1<<a,M=[E*b.x,E*b.y,0],k=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,this.projection.name!=="globe"),P=this.pointCoordinate(this.getCameraPoint()),R=E*o.mercatorZfromAltitude(1,this.center.lat),N=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),H=[E*P.x,E*P.y,N],Z=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),K=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?a:0,ae=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,W=i.isTerrainDEM?-ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,re=this.projection.isReprojectedInTileSpace?Us(this):1,ne=ve=>{const ze=new o.MercatorCoordinate(ve.x+25e-6,ve.y,ve.z),ct=new o.MercatorCoordinate(ve.x,ve.y+25e-6,ve.z),mt=ve.toLngLat(),kt=ze.toLngLat(),We=ct.toLngLat(),ft=this.locationCoordinate(mt),xt=this.locationCoordinate(kt),ai=this.locationCoordinate(We),yi=Math.hypot(xt.x-ft.x,xt.y-ft.y),yt=Math.hypot(ai.x-ft.x,ai.y-ft.y);return Math.sqrt(yi*yt)*re/25e-6},te=ve=>{const Re=ae,ze=W;return{aabb:o.tileAABB(this,E,0,0,0,ve,ze,Re,this.projection),zoom:0,x:0,y:0,minZ:ze,maxZ:Re,wrap:ve,fullyVisible:!1}},ie=[];let se=[];const ge=a,be=i.reparseOverscaled?d:a,Xe=ve=>ve*ve,Ne=Xe((N-this._centerAltitude)*R),Fe=ve=>{if(!this._elevation||!ve.tileID||!y)return;const Re=this._elevation.getMinMaxForTile(ve.tileID),ze=ve.aabb;Re?(ze.min[2]=Re.min,ze.max[2]=Re.max,ze.center[2]=(ze.min[2]+ze.max[2])/2):(ve.shouldSplit=Ae(ve),ve.shouldSplit||(ze.min[2]=ze.max[2]=ze.center[2]=this._centerAltitude))},Ae=ve=>{if(ve.zoom<K)return!0;if(ve.zoom===ge)return!1;if(ve.shouldSplit!=null)return ve.shouldSplit;const Re=ve.aabb.distanceX(H),ze=ve.aabb.distanceY(H);let ct=Ne;m&&(ct=Xe(ve.aabb.distanceZ(H)*R));let mt=1;if(this.projection.isReprojectedInTileSpace&&d<=5){const We=Math.pow(2,ve.zoom),ft=ne(new o.MercatorCoordinate((ve.x+.5)/We,(ve.y+.5)/We));mt=ft>.85?1:ft}const kt=Re*Re+ze*ze+ct;return kt<Xe((1<<ge-ve.zoom)*Z*mt*((We,ft)=>{if(ft*Xe(.707)<We)return 1;const xt=Math.sqrt(ft/We);return xt/(1.4144271570014144+(Math.pow(1.1,xt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ct,Ne),kt))};if(this.renderWorldCopies)for(let ve=1;ve<=3;ve++)ie.push(te(-ve)),ie.push(te(ve));for(ie.push(te(0));ie.length>0;){const ve=ie.pop(),Re=ve.x,ze=ve.y;let ct=ve.fullyVisible;if(!ct){const mt=ve.aabb.intersects(k);if(mt===0)continue;ct=mt===2}if(ve.zoom!==ge&&Ae(ve))for(let mt=0;mt<4;mt++){const kt=(Re<<1)+mt%2,We=(ze<<1)+(mt>>1),ft={aabb:y?ve.aabb.quadrant(mt):o.tileAABB(this,E,ve.zoom+1,kt,We,ve.wrap,ve.minZ,ve.maxZ,this.projection),zoom:ve.zoom+1,x:kt,y:We,wrap:ve.wrap,fullyVisible:ct,tileID:void 0,shouldSplit:void 0,minZ:ve.minZ,maxZ:ve.maxZ};m&&(ft.tileID=new o.OverscaledTileID(ve.zoom+1===ge?be:ve.zoom+1,ve.wrap,ve.zoom+1,kt,We),Fe(ft)),ie.push(ft)}else{const mt=ve.zoom===ge?be:ve.zoom;if(i.minzoom&&i.minzoom>mt)continue;const kt=M[0]-(.5+Re+(ve.wrap<<ve.zoom))*(1<<a-ve.zoom),We=M[1]-.5-ze,ft=ve.tileID?ve.tileID:new o.OverscaledTileID(mt,ve.wrap,ve.zoom,Re,ze);se.push({tileID:ft,distanceSq:kt*kt+We*We})}}if(this.fogCullDistSq){const ve=this.fogCullDistSq,Re=this.horizonLineFromTop();se=se.filter(ze=>{const ct=[0,0,0,1],mt=[o.EXTENT,o.EXTENT,0,1],kt=this.calculateFogTileMatrix(ze.tileID.toUnwrapped());o.transformMat4$1(ct,ct,kt),o.transformMat4$1(mt,mt,kt);const We=o.getAABBPointSquareDist(ct,mt);if(We===0)return!0;let ft=!1;const xt=this._elevation;if(xt&&We>ve&&Re!==0){const ai=this.calculateProjMatrix(ze.tileID.toUnwrapped());let yi;i.isTerrainDEM||(yi=xt.getMinMaxForTile(ze.tileID)),yi||(yi={min:W,max:ae});const yt=o.furthestTileCorner(this.rotation),Lt=[yt[0]*o.EXTENT,yt[1]*o.EXTENT,yi.max];o.transformMat4(Lt,Lt,ai),ft=(1-Lt[1])*this.height*.5<Re}return We<ve||ft})}return se.sort((ve,Re)=>ve.distanceSq-Re.distanceSq).map(ve=>ve.tileID)}resize(i,a){this.width=i,this.height=a,this.pixelsToGLUnits=[2/i,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const a=o.clamp(i.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),d=this.projection.project(i.lng,a);return new o.pointGeometry(d.x*this.worldSize,d.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(i,a){const d=this.pointCoordinate(a),m=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(i);this.setLocation(new o.MercatorCoordinate(y.x-(d.x-m.x),y.y-(d.y-m.y)))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this._coordinatePoint(this.locationCoordinate(i),!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,a){const d=a?o.mercatorZfromAltitude(a,i.lat):void 0,m=this.projection.project(i.lng,i.lat);return new o.MercatorCoordinate(m.x,m.y,d)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,a){const d=a!=null?a:this._centerAltitude,m=[i.x,i.y,0,1],y=[i.x,i.y,1,1];o.transformMat4$1(m,m,this.pixelMatrixInverse),o.transformMat4$1(y,y,this.pixelMatrixInverse);const b=y[3];o.scale$1(m,m,1/m[3]),o.scale$1(y,y,1/b);const E=m[2],M=y[2];return{p0:m,p1:y,t:E===M?0:(d-E)/(M-E)}}screenPointToMercatorRay(i){const a=[i.x,i.y,0,1],d=[i.x,i.y,1,1];return o.transformMat4$1(a,a,this.pixelMatrixInverse),o.transformMat4$1(d,d,this.pixelMatrixInverse),o.scale$1(a,a,1/a[3]),o.scale$1(d,d,1/d[3]),a[2]=o.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,d[2]=o.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,o.scale$1(a,a,1/this.worldSize),o.scale$1(d,d,1/this.worldSize),new o.Ray([a[0],a[1],a[2]],o.normalize([],o.sub([],d,a)))}rayIntersectionCoordinate(i){const{p0:a,p1:d,t:m}=i,y=o.mercatorZfromAltitude(a[2],this._center.lat),b=o.mercatorZfromAltitude(d[2],this._center.lat);return new o.MercatorCoordinate(o.number(a[0],d[0],m)/this.worldSize,o.number(a[1],d[1],m)/this.worldSize,o.number(y,b,m))}pointCoordinate(i,a=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(i.x,i.y,a)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);const a=this.elevation;let d=this.elevation.pointCoordinate(i);if(d)return new o.MercatorCoordinate(d[0],d[1],d[2]);let m=0,y=this.horizonLineFromTop();if(i.y>y)return this.pointCoordinate(i);const b=.02*y,E=i.clone();for(let M=0;M<10&&y-m>b;M++){E.y=o.number(m,y,.66);const k=a.pointCoordinate(E);k?(y=E.y,d=k):m=E.y}return d?new o.MercatorCoordinate(d[0],d[1],d[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){if(this.elevation)return!this.elevation.pointCoordinate(i);{const a=this.horizonLineFromTop();return i.y<a}}_coordinatePoint(i,a){const d=a&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,m=[i.x*this.worldSize,i.y*this.worldSize,d+i.toAltitude(),1];return o.transformMat4$1(m,m,this.pixelMatrix),m[3]>0?new o.pointGeometry(m[0]/m[3],m[1]/m[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(i,a){const d=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),m=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),y=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),b=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let E=this.pointCoordinate(d,i),M=this.pointCoordinate(m,i);const k=this.pointCoordinate(y,a),P=this.pointCoordinate(b,a),R=(N,H)=>(H.y-N.y)/(H.x-N.x);return E.y>1&&M.y>=0?E=new o.MercatorCoordinate((1-P.y)/R(P,E)+P.x,1):E.y<0&&M.y<=1&&(E=new o.MercatorCoordinate(-P.y/R(P,E)+P.x,0)),M.y>1&&E.y>=0?M=new o.MercatorCoordinate((1-k.y)/R(k,M)+k.x,1):M.y<0&&E.y<=1&&(M=new o.MercatorCoordinate(-k.y/R(k,M)+k.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(E)).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(P)).extend(this.coordinateLocation(k))}_getBounds3D(){const i=this.elevation;if(!i.visibleDemTiles.length)return this._getBounds(0,0);const a=i.visibleDemTiles.reduce((d,m)=>{if(m.dem){const y=m.dem.tree;d.min=Math.min(d.min,y.minimums[0]),d.max=Math.max(d.max,y.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBounds(a.min*i.exaggeration(),a.max*i.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(i=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,d=this.height/2-a*(1-this._horizonShift);return i?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,a){return this.projection.createTileTransform(this,a).createTileMatrix(i)}calculateDistanceTileData(i){const a=i.key,d=this._distanceTileDataCache;if(d[a])return d[a];const m=i.canonical,y=1/this.height,b=this.cameraWorldSize/this.zoomScale(m.z),E=(m.x+Math.pow(2,m.z)*i.wrap)*b,M=m.y*b,k=this.point,P=this.angle,R=Math.sin(-P),N=-Math.cos(-P);return d[a]={bearing:[R,N],center:[(k.x-E)*y,(k.y-M)*y],scale:b/o.EXTENT*y},d[a]}calculateFogTileMatrix(i){const a=i.key,d=this._fogTileMatrixCache;if(d[a])return d[a];const m=this.calculatePosMatrix(i,this.cameraWorldSize);return o.multiply$1(m,this.worldToFogMatrix,m),d[a]=new Float32Array(m),d[a]}calculateProjMatrix(i,a=!1){const d=i.key,m=a?this._alignedProjMatrixCache:this._projMatrixCache;if(m[d])return m[d];const y=this.calculatePosMatrix(i,this.worldSize);return o.multiply$1(y,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:a?this.alignedProjMatrix:this.projMatrix,y),m[d]=new Float32Array(y),m[d]}calculatePixelsToTileUnitsMatrix(i){const a=i.tileID.key,d=this._pixelsToTileUnitsCache;if(d[a])return d[a];const m=function(y,b){const{scale:E}=y.tileTransform,M=E*o.EXTENT/(y.tileSize*Math.pow(2,b.zoom-y.tileID.overscaledZ+y.tileID.canonical.z));return k=new Float32Array(4),N=(P=b.inverseAdjustmentMatrix)[1],H=P[2],Z=P[3],ae=(R=[M,M])[1],k[0]=P[0]*(K=R[0]),k[1]=N*K,k[2]=H*ae,k[3]=Z*ae,k;var k,P,R,N,H,Z,K,ae}(i,this);return d[a]=m,d[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const a=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),m=this._camera.forward(),y=o.mercatorZfromAltitude(1,this._center.lat);d[2]/=y,m[2]/=y,o.normalize(m,m);const b=i.raycast(d,m,i.exaggeration());if(b){const E=o.scaleAndAdd([],d,m,b),M=new o.MercatorCoordinate(E[0],E[1],o.mercatorZfromAltitude(E[2],o.latFromMercatorY(E[1]))),k=(M.z+o.length([M.x-d[0],M.y-d[1],M.z-d[2]*y]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(k),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const a=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),m=i.getAtPointOrZero(new o.MercatorCoordinate(...d)),y=this._minimumHeightOverTerrain()*Math.cos(o.degToRad(this._maxPitch)),b=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*m;if(b<y){const E=this.locationCoordinate(this._center,this._centerAltitude),M=[E.x-d[0],E.y-d[1],E.z-d[2]],k=o.length(M);M[2]-=(y-b)/this._projectionScaler;const P=o.length(M);if(P===0)return;o.scale$2(M,M,k/P*this._projectionScaler),this._camera.position=[E.x-M[0],E.y-M[1],E.z*this._projectionScaler-M[2]],this._camera.orientation=Yl(M,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const R=this.center;return R.lat=o.clamp(R.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(R.lng=o.clamp(R.lng,this.minLng,this.maxLng)),this.center=R,void(this._constraining=!1)}const i=this._unmodified,{x:a,y:d}=this.point;let m=0,y=a,b=d;const E=this.width/2,M=this.height/2,k=this.worldMinY*this.scale,P=this.worldMaxY*this.scale;if(d-M<k&&(b=k+M),d+M>P&&(b=P-M),P-k<this.height&&(m=Math.max(m,this.height/(P-k)),b=(P+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const R=this.worldMinX*this.scale,N=this.worldMaxX*this.scale,H=this.worldSize/2-(R+N)/2;y=(a+H+this.worldSize)%this.worldSize-H,y-E<R&&(y=R+E),y+E>N&&(y=N-E),N-R<this.width&&(m=Math.max(m,this.width/(N-R)),y=(N+R)/2)}y===a&&b===d||(this.center=this.unproject(new o.pointGeometry(y,b))),m&&(this.zoom+=this.scaleZoom(m)),this._constrainCameraAltitude(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this._fov/2,a=this.centerOffset,d=this.pixelsPerMeter;this._projectionScaler=d/(o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(i)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const m=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?d:1),y=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);y[8]=2*-a.x/this.width,y[9]=2*a.y/this.height;let b=o.mul([],y,m);if(this.projection.isReprojectedInTileSpace){const te=this.locationCoordinate(this.center),ie=o.identity([]);o.translate(ie,ie,[te.x*this.worldSize,te.y*this.worldSize,0]),o.multiply$1(ie,ie,Nu(this)),o.translate(ie,ie,[-te.x*this.worldSize,-te.y*this.worldSize,0]),o.multiply$1(b,b,ie),this.inverseAdjustmentMatrix=function(se){const ge=Nu(se,!0);return $([],[ge[0],ge[1],ge[4],ge[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],b,[this.worldSize,this.worldSize,this.worldSize/d,1]),this.projMatrix=b,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const E=new Float32Array(16);o.identity(E),o.scale(E,E,[1,-1,1]),o.rotateX(E,E,this._pitch),o.rotateZ(E,E,this.angle);const M=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),k=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;M[8]=2*-a.x/this.width,M[9]=2*(a.y+k)/this.height,this.skyboxMatrix=o.multiply$1(E,M,E);const P=this.point,R=P.x,N=P.y,H=this.width%2/2,Z=this.height%2/2,K=Math.cos(this.angle),ae=Math.sin(this.angle),W=R-Math.round(R)+K*H+ae*Z,re=N-Math.round(N)+K*Z+ae*H,ne=new Float64Array(b);if(o.translate(ne,ne,[W>.5?W-1:W,re>.5?re-1:re,0]),this.alignedProjMatrix=ne,b=o.create(),o.scale(b,b,[this.width/2,-this.height/2,1]),o.translate(b,b,[1,-1,0]),this.labelPlaneMatrix=b,b=o.create(),o.scale(b,b,[1,-1,1]),o.translate(b,b,[-1,-1,0]),o.scale(b,b,[2/this.width,2/this.height,1]),this.glCoordMatrix=b,this.pixelMatrix=o.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},b=o.invert(new Float64Array(16),this.pixelMatrix),!b)throw new Error("failed to invert matrix");this.pixelMatrixInverse=b,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSize,a=this.cameraPixelsPerMeter,d=this._camera.position,m=1/this.height,y=[i,i,a];o.scale$2(y,y,m),o.scale$2(d,d,-1),o.multiply$2(d,d,y);const b=o.create();o.translate(b,b,d),o.scale(b,b,y),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,a,m)}_computeCameraPosition(i){const a=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),m=this.point,y=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*a-i/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-d[0]*y,m.y/this.worldSize-d[1]*y,i/this.worldSize*this._centerAltitude-d[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=i[2];let m=1;d>0&&(m=Math.min((a-this._camera.position[2])/d,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,i,m),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,a=this._camera.forward(),{pitch:d,bearing:m}=this._camera.getPitchBearing(),y=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),E=Math.max((i[2]-y)/Math.cos(d),b),M=this._zoomFromMercatorZ(E);o.scaleAndAdd(i,i,a,E),this._pitch=o.clamp(d,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(m,-Math.PI,Math.PI),this._setZoom(o.clamp(M,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new o.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((this._cameraZoom!=null?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(i,a){const d=Math.min(i.x,a.x),m=Math.max(i.x,a.x),y=Math.min(i.y,a.y),b=Math.max(i.y,a.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new o.pointGeometry(d,y),new o.pointGeometry(m,b),new o.pointGeometry(d,b),new o.pointGeometry(m,y)],M=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const P of E){const R=this.pointRayIntersection(P);if(R.t<0)return!0;const N=this.rayIntersectionCoordinate(R);if(N.x<M||N.y<0||N.x>k||N.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(i,a){const d=o.length(o.sub([],this._camera.position,i)),m=this._zoomFromMercatorZ(d)+a;return d-this._mercatorZfromZoom(m)}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,i))}}function _o(h,i){let a=!1,d=null;const m=()=>{d=null,a&&(h(),d=setTimeout(m,i),a=!1)};return()=>(a=!0,d||m(),d)}class ju{constructor(i){this._hashName=i&&encodeURIComponent(i),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=_o(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,o.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return o.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const a=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,m=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),b=Math.round(a.lng*y)/y,E=Math.round(a.lat*y)/y,M=this._map.getBearing(),k=this._map.getPitch();let P="";if(P+=i?`/${b}/${E}/${d}`:`${d}/${E}/${b}`,(M||k)&&(P+="/"+Math.round(10*M)/10),k&&(P+=`/${Math.round(k)}`),this._hashName){const R=this._hashName;let N=!1;const H=o.window.location.hash.slice(1).split("&").map(Z=>{const K=Z.split("=")[0];return K===R?(N=!0,`${K}=${P}`):Z}).filter(Z=>Z);return N||H.push(`${R}=${P}`),`#${H.join("&")}`}return`#${P}`}_getCurrentHash(){const i=o.window.location.hash.replace("#","");if(this._hashName){let a;return i.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(a=d)}),(a&&a[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._getCurrentHash();if(i.length>=3&&!i.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:a,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,i)}}const Vn={linearity:.3,easing:o.bezier(0,0,.3,1)},Qo=o.extend({deceleration:2500,maxSpeed:1400},Vn),Vu=o.extend({deceleration:20,maxSpeed:1400},Vn),tc=o.extend({deceleration:1e3,maxSpeed:360},Vn),Yt=o.extend({deceleration:1e3,maxSpeed:90},Vn);class js{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,a=o.exported.now();for(;i.length>0&&a-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)a.zoom+=y.zoomDelta||0,a.bearing+=y.bearingDelta||0,a.pitch+=y.pitchDelta||0,y.panDelta&&a.pan._add(y.panDelta),y.around&&(a.around=y.around),y.pinchAround&&(a.pinchAround=y.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(a.pan.mag()){const y=$a(a.pan.mag(),d,o.extend({},Qo,i||{}));m.offset=a.pan.mult(y.amount/a.pan.mag()),m.center=this._map.transform.center,Vs(m,y)}if(a.zoom){const y=$a(a.zoom,d,Vu);m.zoom=this._map.transform.zoom+y.amount,Vs(m,y)}if(a.bearing){const y=$a(a.bearing,d,tc);m.bearing=this._map.transform.bearing+o.clamp(y.amount,-179,179),Vs(m,y)}if(a.pitch){const y=$a(a.pitch,d,Yt);m.pitch=this._map.transform.pitch+y.amount,Vs(m,y)}if(m.zoom||m.bearing){const y=a.pinchAround===void 0?a.around:a.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),o.extend(m,{noMoveStart:!0})}}function Vs(h,i){(!h.duration||h.duration<i.duration)&&(h.duration=i.duration,h.easing=i.easing)}function $a(h,i,a){const{maxSpeed:d,linearity:m,deceleration:y}=a,b=o.clamp(h*m/(i/1e3),-d,d),E=Math.abs(b)/(y*m);return{easing:a.easing,duration:1e3*E,amount:b*(E/2)}}class ur extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,d,m={}){const y=G.mousePos(a.getCanvasContainer(),d),b=a.unproject(y);super(i,o.extend({point:y,lngLat:b,originalEvent:d},m)),this._defaultPrevented=!1,this.target=a}}class $s extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,d){const m=i==="touchend"?d.changedTouches:d.touches,y=G.touchPos(a.getCanvasContainer(),m),b=y.map(M=>a.unproject(M)),E=y.reduce((M,k,P,R)=>M.add(k.div(R.length)),new o.pointGeometry(0,0));super(i,{points:y,point:E,lngLats:b,lngLat:a.unproject(E),originalEvent:d}),this._defaultPrevented=!1}}class jd extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,d){super(i,{originalEvent:d}),this._defaultPrevented=!1}}class $u{constructor(i,a){this._map=i,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new jd(i.type,this._map,i))}mousedown(i,a){return this._mousedownPos=a,this._firePreventable(new ur(i.type,this._map,i))}mouseup(i){this._map.fire(new ur(i.type,this._map,i))}preclick(i){const a=o.extend({},i);a.type="preclick",this._map.fire(new ur(a.type,this._map,a))}click(i,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(i),this._map.fire(new ur(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new ur(i.type,this._map,i))}mouseover(i){this._map.fire(new ur(i.type,this._map,i))}mouseout(i){this._map.fire(new ur(i.type,this._map,i))}touchstart(i){return this._firePreventable(new $s(i.type,this._map,i))}touchmove(i){this._map.fire(new $s(i.type,this._map,i))}touchend(i){this._map.fire(new $s(i.type,this._map,i))}touchcancel(i){this._map.fire(new $s(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vd{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(i){this._map.fire(new ur(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ur("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new ur(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ic{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,a){this.isEnabled()&&i.shiftKey&&i.button===0&&(G.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(i,a){if(!this._active)return;const d=a;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=d,this._box||(this._box=G.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const y=Math.min(m.x,d.x),b=Math.max(m.x,d.x),E=Math.min(m.y,d.y),M=Math.max(m.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${E}px)`,this._box.style.width=b-y+"px",this._box.style.height=M-E+"px")})}mouseupWindow(i,a){if(!this._active||i.button!==0)return;const d=this._startPos,m=a;if(this.reset(),G.suppressClick(),d.x!==m.x||d.y!==m.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:y=>y.fitScreenCoordinates(d,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),G.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,a){return this._map.fire(new o.Event(i,{originalEvent:a}))}}function ea(h,i){const a={};for(let d=0;d<h.length;d++)a[h[d].identifier]=i[d];return a}class Ga{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),d.length===this.numTouches&&(this.centroid=function(m){const y=new o.pointGeometry(0,0);for(const b of m)y._add(b);return y.div(m.length)}(a),this.touches=ea(d,a)))}touchmove(i,a,d){if(this.aborted||!this.centroid)return;const m=ea(d,a);for(const y in this.touches){const b=this.touches[y],E=m[y];(!E||E.dist(b)>30)&&(this.aborted=!0)}}touchend(i,a,d){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Za{constructor(i){this.singleTap=new Ga(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,a,d){this.singleTap.touchstart(i,a,d)}touchmove(i,a,d){this.singleTap.touchmove(i,a,d)}touchend(i,a,d){const m=this.singleTap.touchend(i,a,d);if(m){const y=i.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(m)<30;if(y&&b||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class rc{constructor(){this._zoomIn=new Za({numTouches:1,numTaps:2}),this._zoomOut=new Za({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,a,d){this._zoomIn.touchstart(i,a,d),this._zoomOut.touchstart(i,a,d)}touchmove(i,a,d){this._zoomIn.touchmove(i,a,d),this._zoomOut.touchmove(i,a,d)}touchend(i,a,d){const m=this._zoomIn.touchend(i,a,d),y=this._zoomOut.touchend(i,a,d);return m?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(m)},{originalEvent:i})}):y?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(y)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Gu={0:1,2:2};class ta{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(i,a){return!1}_move(i,a){return{}}mousedown(i,a){if(this._lastPoint)return;const d=G.mouseButton(i);this._correctButton(i,d)&&(this._lastPoint=a,this._eventButton=d)}mousemoveWindow(i,a){const d=this._lastPoint;if(d){if(i.preventDefault(),function(m,y){const b=Gu[y];return m.buttons===void 0||(m.buttons&b)!==b}(i,this._eventButton))this.reset();else if(this._moved||!(a.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(d,a)}}mouseupWindow(i){this._lastPoint&&G.mouseButton(i)===this._eventButton&&(this._moved&&G.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gs extends ta{mousedown(i,a){super.mousedown(i,a),this._lastPoint&&(this._active=!0)}_correctButton(i,a){return a===0&&!i.ctrlKey}_move(i,a){return{around:a,panDelta:a.sub(i)}}}class an extends ta{_correctButton(i,a){return a===0&&i.ctrlKey||a===2}_move(i,a){const d=.8*(a.x-i.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(i){i.preventDefault()}}class nc extends ta{_correctButton(i,a){return a===0&&i.ctrlKey||a===2}_move(i,a){const d=-.5*(a.y-i.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(i){i.preventDefault()}}class Zu{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(i,a,d){return this._calculateTransform(i,a,d)}touchmove(i,a,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.preventDefault(),this._calculateTransform(i,a,d)}}touchend(i,a,d){this._calculateTransform(i,a,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,a,d){d.length>0&&(this._active=!0);const m=ea(d,a),y=new o.pointGeometry(0,0),b=new o.pointGeometry(0,0);let E=0;for(const k in m){const P=m[k],R=this._touches[k];R&&(y._add(P),b._add(P.sub(R)),E++,m[k]=P)}if(this._touches=m,E<this._minTouches||!b.mag())return;const M=b.div(E);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(E),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Zs{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(i){}_move(i,a,d){return{}}touchstart(i,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(i,a,d){if(!this._firstTwoTouches)return;i.preventDefault();const[m,y]=this._firstTwoTouches,b=$n(d,a,m),E=$n(d,a,y);if(!b||!E)return;const M=this._aroundCenter?null:b.add(E).div(2);return this._move([b,E],M,i)}touchend(i,a,d){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,b=$n(d,a,m),E=$n(d,a,y);b&&E||(this._active&&G.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function $n(h,i,a){for(let d=0;d<h.length;d++)if(h[d].identifier===a)return i[d]}function oc(h,i){return Math.log(h/i)/Math.LN2}class qs extends Zs{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,a){const d=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(oc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:oc(this._distance,d),pinchAround:a}}}function Ws(h,i){return 180*h.angleWith(i)/Math.PI}class Xs extends Zs{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,a){const d=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ws(this._vector,d),pinchAround:a}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const a=25/(Math.PI*this._minDiameter)*360,d=Ws(i,this._startVector);return Math.abs(d)<a}}function Hs(h){return Math.abs(h.y)>Math.abs(h.x)}class qu extends Zs{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(i){this._lastPoints=i,Hs(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,a,d){const m=i[0].sub(this._lastPoints[0]),y=i[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&d.touches.length<3)&&(this._valid=this.gestureBeginsVertically(m,y,d.timeStamp),this._valid))return this._lastPoints=i,this._active=!0,{pitchDelta:(m.y+y.y)/2*-.5}}gestureBeginsVertically(i,a,d){if(this._valid!==void 0)return this._valid;const m=i.mag()>=2,y=a.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const b=i.y>0==a.y>0;return Hs(i)&&Hs(a)&&b}}const ia={panStep:100,bearingStep:15,pitchStep:10};class $d{constructor(){const i=ia;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let a=0,d=0,m=0,y=0,b=0;switch(i.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:i.shiftKey?d=-1:(i.preventDefault(),y=-1);break;case 39:i.shiftKey?d=1:(i.preventDefault(),y=1);break;case 38:i.shiftKey?m=1:(i.preventDefault(),b=-1);break;case 40:i.shiftKey?m=-1:(i.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(d=0,m=0),{cameraAnimation:E=>{const M=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:Gd,zoom:a?Math.round(M)+a*(i.shiftKey?2:1):M,bearing:E.getBearing()+d*this._bearingStep,pitch:E.getPitch()+m*this._pitchStep,offset:[-y*this._panStep,-b*this._panStep],center:E.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Gd(h){return h*(2-h)}const ac=4.000244140625;class Ks{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=i.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const d=o.exported.now(),m=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,a!==0&&a%ac==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(m*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),i.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=i,this._delta-=a,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=G.mousePos(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform,a=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>ac?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&k!==0&&(k=1/k);const P=a(),R=Math.pow(2,P),N=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):R;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(N*k))),this._type==="wheel"&&(this._startZoom=a(),this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a(),m=this._startZoom,y=this._easing;let b,E=!1;if(this._type==="wheel"&&m&&y){const M=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),k=y(M);b=o.number(m,d,k),M<1?this._frameId||(this._frameId=!0):E=!0}else b=d,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:b-a(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let a=o.ease;if(this._prevEase){const d=this._prevEase,m=(o.exported.now()-d.start)/d.duration,y=d.easing(m+.01)-d.easing(m),b=.27/Math.sqrt(y*y+1e-4)*.01,E=Math.sqrt(.0729-b*b);a=o.bezier(b,E,.25,1)}return this._prevEase={start:o.exported.now(),duration:i,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!o.window.document.fullscreenElement||!!o.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class sc{constructor(i,a){this._clickZoom=i,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,a){return i.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(i.shiftKey?-1:1),around:d.unproject(a)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xu{constructor(){this._tap=new Za({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(i,a,d){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=a[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(i,a,d))}touchmove(i,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const m=a[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,i.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(i,a,d)}touchend(i,a,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(i,a,d)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ys{constructor(i,a,d){this._el=i,this._mousePan=a,this._touchPan=d}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class lc{constructor(i,a,d){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=a,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Hu{constructor(i,a,d,m){this._el=i,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const qa=h=>h.zoom||h.drag||h.pitch||h.rotate;class Ku extends o.Event{}class Yu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,a){const d=o.sub([],a,i);this.radius=o.length(d[2]<0?o.div([],d,this.constants):[d[0],d[1],0])}projectRay(i){o.div(i,i,this.constants),o.normalize(i,i),o.mul$1(i,i,this.constants);const a=o.scale$2([],i,this.radius);if(a[2]>0){const d=o.scale$2([],[0,0,1],o.dot(a,[0,0,1])),m=o.scale$2([],o.normalize([],[a[0],a[1],0]),this.radius),y=o.add([],a,o.scale$2([],o.sub([],o.add([],m,d),a),2));a[0]=y[0],a[1]=y[1]}return a}}function Wa(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class ra{constructor(i,a){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new js(i),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Yu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),o.bindAll(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[m,y,b]of this._listeners)m.addEventListener(y,m===o.window.document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[i,a,d]of this._listeners)i.removeEventListener(a,i===o.window.document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(i){const a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new $u(a,i));const m=a.boxZoom=new ic(a,i);this._add("boxZoom",m);const y=new rc,b=new Wu;a.doubleClickZoom=new sc(b,y),this._add("tapZoom",y),this._add("clickZoom",b);const E=new Xu;this._add("tapDragZoom",E);const M=a.touchPitch=new qu(a);this._add("touchPitch",M);const k=new an(i),P=new nc(i);a.dragRotate=new lc(i,k,P),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);const R=new Gs(i),N=new Zu(a,i);a.dragPan=new Ys(d,R,N),this._add("mousePan",R),this._add("touchPan",N,["touchZoom","touchRotate"]);const H=new Xs,Z=new qs;a.touchZoomRotate=new Hu(d,Z,H,E),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Vd(a));const K=a.scrollZoom=new Ks(a,this);this._add("scrollZoom",K,["mousePan"]);const ae=a.keyboard=new $d;this._add("keyboard",ae);for(const W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[W]&&a[W].enable(i[W])}_add(i,a,d){this._handlers.push({handlerName:i,handler:a,allowed:d}),this._handlersById[i]=a}stop(i){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(qa(this._eventsInProgress))||this.isZooming()}_blockedByActive(i,a,d){for(const m in i)if(m!==d&&(!a||a.indexOf(m)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const a=[];for(const d of i)this._el.contains(d.target)&&a.push(d);return a}handleEvent(i,a){this._updatingCamera=!0;const d=i.type==="renderFrame",m=d?void 0:i,y={needsRenderFrame:!1},b={},E={},M=i.touches?this._getMapTouches(i.touches):void 0,k=M?G.touchPos(this._el,M):d?void 0:G.mousePos(this._el,i);for(const{handlerName:N,handler:H,allowed:Z}of this._handlers){if(!H.isEnabled())continue;let K;this._blockedByActive(E,Z,N)?H.reset():H[a||i.type]&&(K=H[a||i.type](i,k,M),this.mergeHandlerResult(y,b,K,N,m),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||H.isActive())&&(E[N]=H)}const P={};for(const N in this._previousActiveHandlers)E[N]||(P[N]=m);this._previousActiveHandlers=E,(Object.keys(P).length||Wa(y))&&(this._changes.push([y,b,P]),this._triggerRenderFrame()),(Object.keys(E).length||Wa(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=y;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(i,a,d,m,y){if(!d)return;o.extend(i,d);const b={handlerName:m,originalEvent:d.originalEvent||y};d.zoomDelta!==void 0&&(a.zoom=b),d.panDelta!==void 0&&(a.drag=b),d.pitchDelta!==void 0&&(a.pitch=b),d.bearingDelta!==void 0&&(a.rotate=b)}_applyChanges(){const i={},a={},d={};for(const[m,y,b]of this._changes)m.panDelta&&(i.panDelta=(i.panDelta||new o.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(i.around=m.around),m.aroundCoord!==void 0&&(i.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(i.pinchAround=m.pinchAround),m.noInertia&&(i.noInertia=m.noInertia),o.extend(a,y),o.extend(d,b);this._updateMapTransform(i,a,d),this._changes=[]}_updateMapTransform(i,a,d){const m=this._map,y=m.transform,b=re=>[re.x,re.y,re.z];if((re=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!Wa(i)){const re=y.zoom;y.cameraElevationReference="sea",y.recenterOnTerrain(),y.cameraElevationReference="ground",re!==y.zoom&&this._map._update(!0)}if(!Wa(i))return this._fireEvents(a,d,!0);let{panDelta:E,zoomDelta:M,bearingDelta:k,pitchDelta:P,around:R,aroundCoord:N,pinchAround:H}=i;H!==void 0&&(R=H),(re=>a.drag&&!this._eventsInProgress.drag)()&&R&&(this._dragOrigin=b(y.pointCoordinate3D(R)),this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",m._stop(!0),R=R||m.transform.centerPoint,k&&(y.bearing+=k),P&&(y.pitch+=P),y._updateCameraState();const Z=[0,0,0];if(E){const re=y.pointCoordinate(R),ne=y.pointCoordinate(R.sub(E));re&&ne&&(Z[0]=ne.x-re.x,Z[1]=ne.y-re.y)}const K=y.zoom,ae=[0,0,0];if(M){const re=b(N||y.pointCoordinate3D(R)),ne={dir:o.normalize([],o.sub([],re,y._camera.position))};if(ne.dir[2]<0){const te=y.zoomDeltaToMovement(re,M);o.scale$2(ae,ne.dir,te)}}const W=o.add(Z,Z,ae);y._translateCameraConstrained(W),M&&Math.abs(y.zoom-K)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(a,d,!0)}_fireEvents(i,a,d){const m=qa(this._eventsInProgress),y=qa(i),b={};for(const P in i){const{originalEvent:R}=i[P];this._eventsInProgress[P]||(b[`${P}start`]=R),this._eventsInProgress[P]=i[P]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const P in b)this._fireEvent(P,b[P]);y&&this._fireEvent("move",y.originalEvent);for(const P in i){const{originalEvent:R}=i[P];this._fireEvent(P,R)}const E={};let M;for(const P in this._eventsInProgress){const{handlerName:R,originalEvent:N}=this._eventsInProgress[P];this._handlersById[R].isActive()||(delete this._eventsInProgress[P],M=a[R]||N,E[`${P}end`]=M)}for(const P in E)this._fireEvent(P,E[P]);const k=qa(this._eventsInProgress);if(d&&(m||y)&&!k){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;P?(R(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:M})):(this._map.fire(new o.Event("moveend",{originalEvent:M})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,a){this._map.fire(new o.Event(i,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new Ku("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const cc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ju extends o.Evented{constructor(i,a){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=a.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,a){return this.jumpTo({center:i},a)}panBy(i,a,d){return i=o.pointGeometry.convert(i).mult(-1),this.panTo(this.transform.center,o.extend({offset:i},a),d)}panTo(i,a,d){return this.easeTo(o.extend({center:i},a),d)}getZoom(){return this.transform.zoom}setZoom(i,a){return this.jumpTo({zoom:i},a),this}zoomTo(i,a,d){return this.easeTo(o.extend({zoom:i},a),d)}zoomIn(i,a){return this.zoomTo(this.getZoom()+1,i,a),this}zoomOut(i,a){return this.zoomTo(this.getZoom()-1,i,a),this}getBearing(){return this.transform.bearing}setBearing(i,a){return this.jumpTo({bearing:i},a),this}getPadding(){return this.transform.padding}setPadding(i,a){return this.jumpTo({padding:i},a),this}rotateTo(i,a,d){return this.easeTo(o.extend({bearing:i},a),d)}resetNorth(i,a){return this.rotateTo(0,o.extend({duration:1e3},i),a),this}resetNorthPitch(i,a){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},i),a),this}snapToNorth(i,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,a):this}getPitch(){return this.transform.pitch}setPitch(i,a){return this.jumpTo({pitch:i},a),this}cameraForBounds(i,a){i=o.LngLatBounds.convert(i);const d=a&&a.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),d,a)}_extendCameraOptions(i){const a={top:0,bottom:0,right:0,left:0};if(typeof(i=o.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=="number"){const d=i.padding;i.padding={top:d,bottom:d,right:d,left:d}}return i.padding=o.extend(a,i.padding),i}_cameraForBoxAndBearing(i,a,d,m){const y=this._extendCameraOptions(m),b=this.transform,E=b.padding,M=b.project(o.LngLat.convert(i)),k=b.project(o.LngLat.convert(a)),P=M.rotate(-o.degToRad(d)),R=k.rotate(-o.degToRad(d)),N=new o.pointGeometry(Math.max(P.x,R.x),Math.max(P.y,R.y)),H=new o.pointGeometry(Math.min(P.x,R.x),Math.min(P.y,R.y)),Z=N.sub(H),K=(b.width-(E.left+E.right+y.padding.left+y.padding.right))/Z.x,ae=(b.height-(E.top+E.bottom+y.padding.top+y.padding.bottom))/Z.y;if(ae<0||K<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const W=Math.min(b.scaleZoom(b.scale*Math.min(K,ae)),y.maxZoom),re=typeof y.offset.x=="number"?new o.pointGeometry(y.offset.x,y.offset.y):o.pointGeometry.convert(y.offset),ne=new o.pointGeometry((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(d*Math.PI/180),te=re.add(ne).mult(b.scale/b.zoomScale(W));return{center:b.unproject(M.add(k).div(2).sub(te)),zoom:W,bearing:d}}_cameraForBox(i,a,d,m,y){const b=this._extendCameraOptions(y);d=d||0,m=m||0,i=o.LngLat.convert(i),a=o.LngLat.convert(a);const E=this.transform.clone();E.padding=b.padding;const M=this.getFreeCameraOptions(),k=new o.LngLat(.5*(i.lng+a.lng),.5*(i.lat+a.lat)),P=.5*(d+m);if(E._camera.position[2]<o.mercatorZfromAltitude(P,k.lat))return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");M.lookAtPoint(k),E.setFreeCameraOptions(M);const R=o.MercatorCoordinate.fromLngLat(i),N=o.MercatorCoordinate.fromLngLat(a),H=E.pointRayIntersection(E.centerPoint,P),Z=[(K=E.rayIntersectionCoordinate(H)).x,K.y,K.z];var K;const ae=E.screenPointToMercatorRay(E.centerPoint),W=E.projection.name!=="globe";let re,ne=0;do{const te=Math.floor(E.zoom),ie=1<<te,se=Math.min(ie*R.x,ie*N.x),ge=Math.min(ie*R.y,ie*N.y),be=Math.max(ie*R.x,ie*N.x),Xe=Math.max(ie*R.y,ie*N.y),Ne=new o.Aabb([se,ge,d],[be,Xe,m]),Fe=o.Frustum.fromInvProjectionMatrix(E.invProjMatrix,E.worldSize,te,W);if(Ne.intersects(Fe)!==2){re&&(E._camera.position=o.scaleAndAdd([],E._camera.position,ae.dir,-re),E._updateStateFromCamera());break}const Ae=o.sub([],E._camera.position,Z);re=.5*o.length(Ae),E._camera.position=o.scaleAndAdd([],E._camera.position,ae.dir,re);try{E._updateStateFromCamera()}catch{return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ne<10);return{center:E.center,zoom:E.zoom,bearing:E.bearing,pitch:E.pitch}}fitBounds(i,a,d){return this._fitInternal(this.cameraForBounds(i,a),a,d)}_raycastElevationBox(i,a){const d=this.transform.elevation;if(!d)return;const m=new o.pointGeometry(i.x,a.y),y=new o.pointGeometry(a.x,i.y),b=d.pointCoordinate(i);if(!b)return;const E=d.pointCoordinate(a);if(!E)return;const M=d.pointCoordinate(m);if(!M)return;const k=d.pointCoordinate(y);if(!k)return;const P=new o.MercatorCoordinate(b[0],b[1]).toLngLat(),R=new o.MercatorCoordinate(E[0],E[1]).toLngLat(),N=new o.MercatorCoordinate(M[0],M[1]).toLngLat(),H=new o.MercatorCoordinate(k[0],k[1]).toLngLat(),Z=Math.min(P.lng,Math.min(R.lng,Math.min(N.lng,H.lng))),K=Math.min(P.lat,Math.min(R.lat,Math.min(N.lat,H.lat))),ae=Math.max(P.lng,Math.max(R.lng,Math.max(N.lng,H.lng))),W=Math.max(P.lat,Math.max(R.lat,Math.max(N.lat,H.lat))),re=Math.min(b[3],Math.min(E[3],Math.min(M[3],k[3]))),ne=Math.max(b[3],Math.max(E[3],Math.max(M[3],k[3])));return{minLngLat:new o.LngLat(Z,K),maxLngLat:new o.LngLat(ae,W),minAltitude:re,maxAltitude:ne}}fitScreenCoordinates(i,a,d,m,y){let b,E,M,k;const P=o.pointGeometry.convert(i),R=o.pointGeometry.convert(a),N=this._raycastElevationBox(P,R);if(N)b=N.minLngLat,E=N.maxLngLat,M=N.minAltitude,k=N.maxAltitude;else{if(this.transform.anyCornerOffEdge(P,R))return this;b=this.transform.pointLocation(P),E=this.transform.pointLocation(R)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(i)),this.transform.pointLocation(o.pointGeometry.convert(a)),d,m):this._cameraForBox(b,E,M,k,m),m,y)}_fitInternal(i,a,d){return i?(delete(a=o.extend(i,a)).padding,a.linear?this.easeTo(a,d):this.flyTo(a,d)):this}jumpTo(i,a){this.stop();const d=i.preloadOnly?this.transform.clone():this.transform;let m=!1,y=!1,b=!1;return"zoom"in i&&d.zoom!==+i.zoom&&(m=!0,d.zoom=+i.zoom),i.center!==void 0&&(d.center=o.LngLat.convert(i.center)),"bearing"in i&&d.bearing!==+i.bearing&&(y=!0,d.bearing=+i.bearing),"pitch"in i&&d.pitch!==+i.pitch&&(b=!0,d.pitch=+i.pitch),i.padding==null||d.isPaddingEqual(i.padding)||(d.padding=i.padding),i.preloadOnly?(this._preloadTiles(d),this):(this.fire(new o.Event("movestart",a)).fire(new o.Event("move",a)),m&&this.fire(new o.Event("zoomstart",a)).fire(new o.Event("zoom",a)).fire(new o.Event("zoomend",a)),y&&this.fire(new o.Event("rotatestart",a)).fire(new o.Event("rotate",a)).fire(new o.Event("rotateend",a)),b&&this.fire(new o.Event("pitchstart",a)).fire(new o.Event("pitch",a)).fire(new o.Event("pitchend",a)),this.fire(new o.Event("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(cc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,a){const d=this.transform;if(!d.projection.supportsFreeCamera)return void o.warnOnce(cc);this.stop();const m=d.zoom,y=d.pitch,b=d.bearing;d.setFreeCameraOptions(i);const E=m!==d.zoom,M=y!==d.pitch,k=b!==d.bearing;return this.fire(new o.Event("movestart",a)).fire(new o.Event("move",a)),E&&this.fire(new o.Event("zoomstart",a)).fire(new o.Event("zoom",a)).fire(new o.Event("zoomend",a)),k&&this.fire(new o.Event("rotatestart",a)).fire(new o.Event("rotate",a)).fire(new o.Event("rotateend",a)),M&&this.fire(new o.Event("pitchstart",a)).fire(new o.Event("pitch",a)).fire(new o.Event("pitchend",a)),this.fire(new o.Event("moveend",a)),this}easeTo(i,a){this._stop(!1,i.easeId),((i=o.extend({offset:[0,0],duration:500,easing:o.ease},i)).animate===!1||!i.essential&&o.exported.prefersReducedMotion)&&(i.duration=0);const d=this.transform,m=this.getZoom(),y=this.getBearing(),b=this.getPitch(),E=this.getPadding(),M="zoom"in i?+i.zoom:m,k="bearing"in i?this._normalizeBearing(i.bearing,y):y,P="pitch"in i?+i.pitch:b,R="padding"in i?i.padding:d.padding,N=o.pointGeometry.convert(i.offset);let H=d.centerPoint.add(N);const Z=d.projection.name==="globe"?d.pointCoordinate(H).toLngLat():d.pointLocation(H),K=o.LngLat.convert(i.center||Z);this._normalizeCenter(K);const ae=d.project(Z),W=d.project(K).sub(ae),re=d.zoomScale(M-m);let ne,te;i.around&&(ne=o.LngLat.convert(i.around),te=d.locationPoint(ne));const ie=this._zooming||M!==m,se=this._rotating||y!==k,ge=this._pitching||P!==b,be=!d.isPaddingEqual(R),Xe=Fe=>Ae=>{if(ie&&(Fe.zoom=o.number(m,M,Ae)),se&&(Fe.bearing=o.number(y,k,Ae)),ge&&(Fe.pitch=o.number(b,P,Ae)),be&&(Fe.interpolatePadding(E,R,Ae),H=Fe.centerPoint.add(N)),ne)Fe.setLocationAtPoint(ne,te);else{const ve=Fe.zoomScale(Fe.zoom-m),Re=M>m?Math.min(2,re):Math.max(.5,re),ze=Math.pow(Re,1-Ae),ct=Fe.unproject(ae.add(W.mult(Ae*ze)).mult(ve));Fe.setLocationAtPoint(Fe.renderWorldCopies?ct.wrap():ct,H)}return i.preloadOnly||this._fireMoveEvents(a),Fe};if(i.preloadOnly){const Fe=this._emulate(Xe,i.duration,d);return this._preloadTiles(Fe),this}const Ne={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ie,this._rotating=se,this._pitching=ge,this._padding=be,this._easeId=i.easeId,this._prepareEase(a,i.noMoveStart,Ne),this._ease(Xe(d),Fe=>{d.recenterOnTerrain(),this._afterEase(a,Fe)},i),this}_prepareEase(i,a,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",a||d.moving||this.fire(new o.Event("movestart",i)),this._zooming&&!d.zooming&&this.fire(new o.Event("zoomstart",i)),this._rotating&&!d.rotating&&this.fire(new o.Event("rotatestart",i)),this._pitching&&!d.pitching&&this.fire(new o.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new o.Event("move",i)),this._zooming&&this.fire(new o.Event("zoom",i)),this._rotating&&this.fire(new o.Event("rotate",i)),this._pitching&&this.fire(new o.Event("pitch",i))}_afterEase(i,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId,this.transform.cameraElevationReference="ground";const d=this._zooming,m=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new o.Event("zoomend",i)),m&&this.fire(new o.Event("rotateend",i)),y&&this.fire(new o.Event("pitchend",i)),this.fire(new o.Event("moveend",i))}flyTo(i,a){if(!i.essential&&o.exported.prefersReducedMotion){const We=o.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(We,a)}this.stop(),i=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},i);const d=this.transform,m=this.getZoom(),y=this.getBearing(),b=this.getPitch(),E=this.getPadding(),M="zoom"in i?o.clamp(+i.zoom,d.minZoom,d.maxZoom):m,k="bearing"in i?this._normalizeBearing(i.bearing,y):y,P="pitch"in i?+i.pitch:b,R="padding"in i?i.padding:d.padding,N=d.zoomScale(M-m),H=o.pointGeometry.convert(i.offset);let Z=d.centerPoint.add(H);const K=d.pointLocation(Z),ae=o.LngLat.convert(i.center||K);this._normalizeCenter(ae);const W=d.project(K),re=d.project(ae).sub(W);let ne=i.curve;const te=Math.max(d.width,d.height),ie=te/N,se=re.mag();if("minZoom"in i){const We=o.clamp(Math.min(i.minZoom,m,M),d.minZoom,d.maxZoom),ft=te/d.zoomScale(We-m);ne=Math.sqrt(ft/se*2)}const ge=ne*ne;function be(We){const ft=(ie*ie-te*te+(We?-1:1)*ge*ge*se*se)/(2*(We?ie:te)*ge*se);return Math.log(Math.sqrt(ft*ft+1)-ft)}function Xe(We){return(Math.exp(We)-Math.exp(-We))/2}function Ne(We){return(Math.exp(We)+Math.exp(-We))/2}const Fe=be(0);let Ae=function(We){return Ne(Fe)/Ne(Fe+ne*We)},ve=function(We){return te*((Ne(Fe)*(Xe(ft=Fe+ne*We)/Ne(ft))-Xe(Fe))/ge)/se;var ft},Re=(be(1)-Fe)/ne;if(Math.abs(se)<1e-6||!isFinite(Re)){if(Math.abs(te-ie)<1e-6)return this.easeTo(i,a);const We=ie<te?-1:1;Re=Math.abs(Math.log(ie/te))/ne,ve=function(){return 0},Ae=function(ft){return Math.exp(We*ne*ft)}}i.duration="duration"in i?+i.duration:1e3*Re/("screenSpeed"in i?+i.screenSpeed/ne:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const ze=y!==k,ct=P!==b,mt=!d.isPaddingEqual(R),kt=We=>ft=>{const xt=ft*Re,ai=1/Ae(xt);We.zoom=ft===1?M:m+We.scaleZoom(ai),ze&&(We.bearing=o.number(y,k,ft)),ct&&(We.pitch=o.number(b,P,ft)),mt&&(We.interpolatePadding(E,R,ft),Z=We.centerPoint.add(H));const yi=ft===1?ae:We.unproject(W.add(re.mult(ve(xt))).mult(ai));return We.setLocationAtPoint(We.renderWorldCopies?yi.wrap():yi,Z),We._updateCenterElevation(),i.preloadOnly||this._fireMoveEvents(a),We};if(i.preloadOnly){const We=this._emulate(kt,i.duration,d);return this._preloadTiles(We),this}return this._zooming=!0,this._rotating=ze,this._pitching=ct,this._padding=mt,this._prepareEase(a,!1),this._ease(kt(d),()=>this._afterEase(a),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,a)}if(!i){const d=this.handlers;d&&d.stop(!1)}return this}_ease(i,a,d){d.animate===!1||d.duration===0?(i(1),a()):(this._easeStart=o.exported.now(),this._easeOptions=d,this._onEaseFrame=i,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,a){i=o.wrap(i,-180,180);const d=Math.abs(i-a);return Math.abs(i-360-a)<d&&(i-=360),Math.abs(i+360-a)<d&&(i+=360),i}_normalizeCenter(i){const a=this.transform;if(!a.renderWorldCopies||a.maxBounds)return;const d=i.lng-a.center.lng;i.lng+=d>180?-360:d<-180?360:0}_emulate(i,a,d){const m=Math.ceil(15*a/1e3),y=[],b=i(d.clone());for(let E=0;E<=m;E++){const M=b(E/m);y.push(M.clone())}return y}}class uc{constructor(i={}){this.options=i,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const a=this.options&&this.options.compact;return this._map=i,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=G.create("button","mapboxgl-ctrl-attrib-button",this._container),G.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,a){const d=this._map._getUIString(`AttributionControl.${a}`);i.setAttribute("aria-label",d),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",d)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(i){const d=a.reduce((m,y,b)=>(y.value&&(m+=`${y.key}=${y.value}${b<a.length-1?"&":""}`),m),"?");i.href=`${o.config.FEEDBACK_URL}/${d}${this._map._hash?this._map._hash.getHashString(!0):""}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const a=this._map.style._sourceCaches;for(const m in a){const y=a[m];if(y.used){const b=y.getSource();b.attribution&&i.indexOf(b.attribution)<0&&i.push(b.attribution)}}i.sort((m,y)=>m.length-y.length),i=i.filter((m,y)=>{for(let b=y+1;b<i.length;b++)if(i[b].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const d=i.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,i.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class hc{constructor(){o.bindAll(["_updateLogo"],this),o.bindAll(["_updateCompact"],this)}onAdd(i){this._map=i,this._container=G.create("div","mapboxgl-ctrl");const a=G.create("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const a in i){const d=i[a].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const a=i[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class dc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const a=++this._id;return this._queue.push({callback:i,id:a,cancelled:!1}),a}remove(i){const a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(const m of d)if(m.id===i)return void(m.cancelled=!0)}run(i=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const d of a)if(!d.cancelled&&(d.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function fc(h,i,a){if(h=new o.LngLat(h.lng,h.lat),i){const d=new o.LngLat(h.lng-360,h.lat),m=new o.LngLat(h.lng+360,h.lat),y=360*Math.ceil(Math.abs(h.lng-a.center.lng)/360),b=a.locationPoint(h).distSqr(i),E=i.x<0||i.y<0||i.x>a.width||i.y>a.height;a.locationPoint(d).distSqr(i)<b&&(E||Math.abs(d.lng-a.center.lng)<y)?h=d:a.locationPoint(m).distSqr(i)<b&&(E||Math.abs(m.lng-a.center.lng)<y)&&(h=m)}for(;Math.abs(h.lng-a.center.lng)>180;){const d=a.locationPoint(h);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;h.lng>a.center.lng?h.lng-=360:h.lng+=360}return h}const nr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class pc extends o.Evented{constructor(i,a){if(super(),(i instanceof o.window.HTMLElement||a)&&(i=o.extend({element:i},a)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),i&&i.element)this._element=i.element,this._offset=o.pointGeometry.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=G.create("div");const m=41,y=27,b=G.createSVG("svg",{display:"block",height:m*this._scale+"px",width:y*this._scale+"px",viewBox:`0 0 ${y} ${m}`},this._element),E=G.createSVG("radialGradient",{id:"shadowGradient"},G.createSVG("defs",{},b));G.createSVG("stop",{offset:"10%","stop-opacity":.4},E),G.createSVG("stop",{offset:"100%","stop-opacity":.05},E),G.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},b),G.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},b),G.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},b),G.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},b),this._offset=o.pointGeometry.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()});const d=this._element.classList;for(const m in nr)d.remove(`mapboxgl-marker-anchor-${m}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=o.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const a=i.code,d=i.charCode||i.keyCode;a!=="Space"&&a!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(i){const a=i.originalEvent.target,d=this._element;this._popup&&(a===d||d.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const i=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(i))return void this._clearFadeTimer();const a=this._map.unproject(i);let d=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const y=this._map.getFreeCameraOptions();if(y.position){const b=y.position.toLngLat();d=b.distanceTo(a)<.9*b.distanceTo(this._lngLat)}}const m=(1-this._map._queryFogOpacity(a))*(d?.2:1);this._element.style.opacity=`${m}`,this._popup&&this._popup._setOpacity(`${m}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(i){const a=this._map.transform;return!!i&&i.x>=0&&i.x<a.width&&i.y>=0&&i.y<a.height}_updateDOM(){const i=this._pos||new o.pointGeometry(0,0),a=this._calculatePitch(),d=this._calculateRotation();this._element.style.transform=`${nr[this._anchor]} translate(${i.x}px, ${i.y}px) rotateX(${a}deg) rotateZ(${d}deg)`}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(i){o.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=fc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),i===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const i=this._map.transform,a=this._offset.mult(this._scale);return this._rotationAlignment==="map"&&a._rotate(i.angle),this._pitchAlignment==="map"&&(a.y*=Math.cos(i._pitch)),a}getOffset(){return this._offset}setOffset(i){return this._offset=o.pointGeometry.convert(i),this._update(),this}_onMove(i){if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(i){this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Gn{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const a=o.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,a,d){this._start=this.getValue(a),this._end=i,this._startTime=a,this._endTime=a+d}}const Qu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:Sn,HTMLElement:na,ImageBitmap:oa}=o.window,Zd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function mc(h){h.parentNode&&h.parentNode.removeChild(h)}const qd={showCompass:!0,showZoom:!0,visualizePitch:!1};class eh{constructor(i,a,d=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new an({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,d&&(this.mousePitch=new nc({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(i,a){this.mouseRotate.mousedown(i,a),this.mousePitch&&this.mousePitch.mousedown(i,a),G.disableDrag()}move(i,a){const d=this.map,m=this.mouseRotate.mousemoveWindow(i,a);if(m&&m.bearingDelta&&d.setBearing(d.getBearing()+m.bearingDelta),this.mousePitch){const y=this.mousePitch.mousemoveWindow(i,a);y&&y.pitchDelta&&d.setPitch(d.getPitch()+y.pitchDelta)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){G.enableDrag(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(o.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),G.mousePos(this.element,i)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,G.mousePos(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=G.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=G.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Xa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let br,Ha=0,aa=!1;const Ka={maxWidth:100,unit:"metric"};function it(h,i,a){const d=a&&a.maxWidth||100,m=h._containerHeight/2,y=h.unproject([0,m]),b=h.unproject([d,m]),E=y.distanceTo(b);if(a&&a.unit==="imperial"){const M=3.2808*E;M>5280?sa(i,d,M/5280,h._getUIString("ScaleControl.Miles"),h):sa(i,d,M,h._getUIString("ScaleControl.Feet"),h)}else a&&a.unit==="nautical"?sa(i,d,E/1852,h._getUIString("ScaleControl.NauticalMiles"),h):E>=1e3?sa(i,d,E/1e3,h._getUIString("ScaleControl.Kilometers"),h):sa(i,d,E,h._getUIString("ScaleControl.Meters"),h)}function sa(h,i,a,d,m){const y=function(E){const M=Math.pow(10,`${Math.floor(E)}`.length-1);let k=E/M;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(P){const R=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*R)/R}(k),M*k}(a),b=y/a;m._requestDomTask(()=>{h.style.width=i*b+"px",h.innerHTML=`${y}&nbsp;${d}`})}const th={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ya=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),go={version:o.version,supported:j,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Ju{constructor(h){if((h=o.extend({},Zd,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(h.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Va(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._renderTaskQueue=new dc,this._domRenderTaskQueue=new dc,this._controls=[],this._markers=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Qu,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Gn(0),this._requestManager=new o.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,typeof h.container=="string"){if(this._container=o.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof na))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new ra(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new ju(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,o.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new uc({customAttribution:h.customAttribution})),this._logoControl=new hc,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new o.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new o.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(h,i){if(i===void 0&&(i=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=h.onAdd(this);this._controls.push(h);const d=this._controlPositions[i];return i.indexOf("bottom")!==-1?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(h);return i>-1&&this._controls.splice(i,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new o.Event("movestart",h)).fire(new o.Event("move",h)),this.fire(new o.Event("resize",h)),i&&this.fire(new o.Event("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(o.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h==null?85:h)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}getProjection(){return this.transform.getProjection()}setProjection(h){return this._lazyInitEmptyStyle(),typeof h=="string"&&(h={name:h}),this._runtimeProjection=h,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(h){return this.transform.locationPoint3D(o.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(o.pointGeometry.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(h,i,a){if(h==="mouseenter"||h==="mouseover"){let d=!1;const m=b=>{const E=i.filter(k=>this.getLayer(k)),M=E.length?this.queryRenderedFeatures(b.point,{layers:E}):[];M.length?d||(d=!0,a.call(this,new ur(h,this,b.originalEvent,{features:M}))):d=!1},y=()=>{d=!1};return{layers:new Set(i),listener:a,delegates:{mousemove:m,mouseout:y}}}if(h==="mouseleave"||h==="mouseout"){let d=!1;const m=b=>{const E=i.filter(M=>this.getLayer(M));(E.length?this.queryRenderedFeatures(b.point,{layers:E}):[]).length?d=!0:d&&(d=!1,a.call(this,new ur(h,this,b.originalEvent)))},y=b=>{d&&(d=!1,a.call(this,new ur(h,this,b.originalEvent)))};return{layers:new Set(i),listener:a,delegates:{mousemove:m,mouseout:y}}}{const d=m=>{const y=i.filter(E=>this.getLayer(E)),b=y.length?this.queryRenderedFeatures(m.point,{layers:y}):[];b.length&&(m.features=b,a.call(this,m),delete m.features)};return{layers:new Set(i),listener:a,delegates:{[h]:d}}}}on(h,i,a){if(a===void 0)return super.on(h,i);Array.isArray(i)||(i=[i]);const d=this._createDelegatedListener(h,i,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(d);for(const m in d.delegates)this.on(m,d.delegates[m]);return this}once(h,i,a){if(a===void 0)return super.once(h,i);Array.isArray(i)||(i=[i]);const d=this._createDelegatedListener(h,i,a);for(const m in d.delegates)this.once(m,d.delegates[m]);return this}off(h,i,a){if(a===void 0)return super.off(h,i);i=new Set(Array.isArray(i)?i:[i]);const d=(y,b)=>{if(y.size!==b.size)return!1;for(const E of y)if(!b.has(E))return!1;return!0},m=this._delegatedListeners?this._delegatedListeners[h]:void 0;return m&&(y=>{for(let b=0;b<y.length;b++){const E=y[b];if(E.listener===a&&d(E.layers,i)){for(const M in E.delegates)this.off(M,E.delegates[M]);return y.splice(b,1),this}}})(m),this}queryRenderedFeatures(h,i){return this.style?(i!==void 0||h===void 0||h instanceof o.pointGeometry||Array.isArray(h)||(i=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(h,i){return this.style.querySourceFeatures(h,i)}queryTerrainElevation(h,i){const a=this.transform.elevation;return a?(i=o.extend({},{exaggerated:!0},i),a.getAtPoint(o.MercatorCoordinate.fromLngLat(h),null,i.exaggerated)):null}setStyle(h,i){return(i=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(h,i))}_getUIString(h){const i=this._locale[h];if(i==null)throw new Error(`Missing UI string '${h}'`);return i}_updateStyle(h,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),h&&(this.style=new Ir(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ir(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,i){if(typeof h=="string"){const a=this._requestManager.normalizeStyleURL(h),d=this._requestManager.transformRequest(a,o.ResourceType.Style);o.getJSON(d,(m,y)=>{m?this.fire(new o.ErrorEvent(m)):y&&this._updateDiff(y,i)})}else typeof h=="object"&&this._updateDiff(h,i)}_updateDiff(h,i){try{this.style.setState(h)&&this._update(!0)}catch(a){o.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(h,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")}addSource(h,i){return this._lazyInitEmptyStyle(),this.style.addSource(h,i),this._update(!0)}isSourceLoaded(h){const i=this.style&&this.style._getSourceCaches(h);if(i.length!==0)return i.every(a=>a.loaded());this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${h}'`)))}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const i in h){const a=h[i]._tiles;for(const d in a){const m=a[d];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(h,i,a){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,i,a)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,i,{pixelRatio:a=1,sdf:d=!1,stretchX:m,stretchY:y,content:b}={}){if(this._lazyInitEmptyStyle(),i instanceof Sn||oa&&i instanceof oa){const{width:E,height:M,data:k}=o.exported.getImageData(i);this.style.addImage(h,{data:new o.RGBAImage({width:E,height:M},k),pixelRatio:a,stretchX:m,stretchY:y,content:b,sdf:d,version:0})}else{if(i.width===void 0||i.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:M,data:k}=i,P=i;this.style.addImage(h,{data:new o.RGBAImage({width:E,height:M},new Uint8Array(k)),pixelRatio:a,stretchX:m,stretchY:y,content:b,sdf:d,version:0,userImage:P}),P.onAdd&&P.onAdd(this,h)}}}updateImage(h,i){const a=this.style.getImage(h);if(!a)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=i instanceof Sn||oa&&i instanceof oa?o.exported.getImageData(i):i,{width:m,height:y,data:b}=d;return m===void 0||y===void 0?this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):m!==a.data.width||y!==a.data.height?this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(a.data.replace(b,!(i instanceof Sn||oa&&i instanceof oa)),void this.style.updateImage(h,a))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,i){o.getImage(this._requestManager.transformRequest(h,o.ResourceType.Image),(a,d)=>{i(a,d instanceof Sn?o.exported.getImageData(d):d)})}listImages(){return this.style.listImages()}addLayer(h,i){return this._lazyInitEmptyStyle(),this.style.addLayer(h,i),this._update(!0)}moveLayer(h,i){return this.style.moveLayer(h,i),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,i,a){return this.style.setLayerZoomRange(h,i,a),this._update(!0)}setFilter(h,i,a={}){return this.style.setFilter(h,i,a),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,i,a,d={}){return this.style.setPaintProperty(h,i,a,d),this._update(!0)}getPaintProperty(h,i){return this.style.getPaintProperty(h,i)}setLayoutProperty(h,i,a,d={}){return this.style.setLayoutProperty(h,i,a,d),this._update(!0)}getLayoutProperty(h,i){return this.style.getLayoutProperty(h,i)}setLight(h,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){this.transform.projection.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(h),this.transform):0}setFeatureState(h,i){return this.style.setFeatureState(h,i),this._update()}removeFeatureState(h,i){return this.style.removeFeatureState(h,i),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let a,d=this._container;for(;d&&!a;){const m=o.window.getComputedStyle(d).transform;m&&m!=="none"&&(a=m.match(/matrix.*\((.+)\)/)[1].split(", ")),d=d.parentElement}a?(this._containerWidth=a[0]&&a[0]!=="0"?Math.abs(h/a[0]):h,this._containerHeight=a[3]&&a[3]!=="0"?Math.abs(i/a[3]):i):(this._containerWidth=h,this._containerHeight=i)}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=G.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=G.create("div","mapboxgl-canvas-container",h);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=G.create("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=G.create("div","mapboxgl-control-container",h),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(m=>{d[m]=G.create("div",`mapboxgl-ctrl-${m}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,i){const a=o.exported.devicePixelRatio||1;this._canvas.width=a*Math.ceil(h),this._canvas.height=a*Math.ceil(i),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${i}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const i=this._markers.indexOf(h);i!==-1&&this._markers.splice(i,1)}_setupPainter(){const h=o.extend({},j.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);i?(o.storeAuthState(i,!0),this.painter=new Ou(i,this.transform),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(i)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let i;const a=this.painter.context.extTimerQuery,d=o.exported.now();this.listens("gpu-timing-frame")&&(i=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,i));let m=this._updateAverageElevation(d);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjection();let y=!1;const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,k=this.transform.pitch,P=o.exported.now();this.style.zoomHistory.update(M,P);const R=new o.EvaluationParameters(M,{now:P,fadeDuration:b,pitch:k,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),N=R.crossFadingFactor();N===1&&N===this._crossFadingFactor||(y=!0,this._crossFadingFactor=N),this.style.update(R)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const M=o.exported.now()-d;a.endQueryEXT(a.TIME_ELAPSED_EXT,i),setTimeout(()=>{const k=a.getQueryObjectEXT(i,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(i),this.fire(new o.Event("gpu-timing-frame",{cpuTime:M,gpuTime:k}))},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(M);this.fire(new o.Event("gpu-timing-layer",{layerTimes:k}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||m;if(E||this._repaint)this.triggerRepaint();else{const M=!this.isMoving()&&this.loaded();if(M&&(m=this._updateAverageElevation(d,!0)),m)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const h of this._markers)h._update()}_updateAverageElevation(h,i=!1){const a=d=>(this.transform.averageElevation=d,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);if((i||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const d=this.transform.averageElevation;let m=this.transform.sampleAverageElevation();isNaN(m)?m=0:this._averageElevationLastSampledAt=h;const y=Math.abs(d-m);if(y>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(m),a(m);this._averageElevation.easeTo(m,h,300)}else if(y>1e-4)return this._averageElevation.jumpTo(m),a(m)}return!!this._averageElevation.isEasing(h)&&a(this._averageElevation.getValue(h))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===o.AUTH_ERR_MSG||h.status===401)){const i=this.painter.context.gl;o.storeAuthState(i,!1),this._logoControl instanceof hc&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const a=this.painter.context.gl,d=a.createFramebuffer();function m(y){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,y,0);const b=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,b),b}return a.bindFramebuffer(a.FRAMEBUFFER,d),this._canvasPixelComparison(m(h),i.canvasCopies.map(m),i.timeStamps)}_canvasPixelComparison(h,i,a){let d=a[1]-a[0];const m=h.length/4;for(let y=0;y<i.length;y++){const b=i[y];let E=0;for(let M=0;M<b.length;M+=4)b[M]===h[M]&&b[M+1]===h[M+1]&&b[M+2]===h[M+2]&&b[M+3]===h[M+3]&&(E+=1);d+=(a[y+2]-a[y+1])*(1-E/m)}return d}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),mc(this._canvasContainer),mc(this._controlContainer),mc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=o.exported.frame(i=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(i)}))}_preloadTiles(h){const i=this.style&&Object.values(this.style._sourceCaches)||[];return o.asyncAll(i,(a,d)=>a._preloadTiles(h,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}_setCacheLimits(h,i){o.setCacheLimits(h,i)}get version(){return o.version}},NavigationControl:class{constructor(h){this.options=o.extend({},qd,h),this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),G.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),G.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=G.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const h=this._map.getZoom(),i=h===this._map.getMaxZoom(),a=h===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())}_rotateCompassArrow(){const h=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=h)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new eh(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,i){const a=G.create("button",h,this._container);return a.type="button",a.addEventListener("click",i),a}_setButtonTitle(h,i){const a=this._map._getUIString(`NavigationControl.${i}`);h.setAttribute("aria-label",a),h.firstElementChild&&h.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends o.Evented{constructor(h){super(),this.options=o.extend({},Xa,h),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=_o(this._updateMarkerRotation,20)}onAdd(h){var i;return this._map=h,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,br!==void 0?i(br):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(a=>{br=a.state!=="denied",i(br)}):(br=!!o.window.navigator.geolocation,i(br)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,Ha=0,aa=!1}_isOutOfMapMaxBounds(h){const i=this._map.getMaxBounds(),a=h.coords;return i&&(a.longitude<i.getWest()||a.longitude>i.getEast()||a.latitude<i.getSouth()||a.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",h)),this._finish()}}_updateCamera(h){const i=new o.LngLat(h.coords.longitude,h.coords.latitude),a=h.coords.accuracy,d=this._map.getBearing(),m=o.extend({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(a),m,{geolocateSource:!0})}_updateMarker(h){if(h){const i=new o.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map._containerHeight/2,i=this._map.unproject([0,h]),a=this._map.unproject([100,h]),d=i.distanceTo(a)/100,m=Math.ceil(2*this._accuracy/d);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&aa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=G.create("button","mapboxgl-ctrl-geolocate",this._container),G.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G.create("div","mapboxgl-user-location"),this._dotElement.appendChild(G.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(G.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new pc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=G.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new pc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ha--,aa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ha++,Ha>1?(h={maximumAge:6e5,timeout:0},aa=!0):(h=this.options.positionOptions,aa=!1),this._geolocationWatchID=o.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else o.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&h()}).catch(console.error):h()}_clearWatch(){o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:uc,ScaleControl:class{constructor(h){this.options=o.extend({},Ka,h),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){it(this._map,this._container,this.options)}onAdd(h){return this._map=h,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(h){this.options.unit=h,it(this._map,this._container,this.options)}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof o.window.HTMLElement?this._container=h.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=G.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);G.create("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden",!0),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(h){super(),this.options=o.extend(Object.create(th),h),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=o.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(o.window.document.createTextNode(h))}setHTML(h){const i=o.window.document.createDocumentFragment(),a=o.window.document.createElement("body");let d;for(a.innerHTML=h;d=a.firstChild,d;)i.appendChild(d);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=G.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._container&&this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._container&&this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let i;return this._classList.delete(h)?i=!1:(this._classList.add(h),i=!0),this._container&&this._updateClassList(),i}_createCloseButton(){this.options.closeButton&&(this._closeButton=G.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(h){this._update(h.point)}_onMouseMove(h){this._update(h.point)}_onDrag(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const i=this._pos,a=this._container.offsetWidth,d=this._container.offsetHeight;let m;return m=i.y+h.bottom.y<d?["top"]:i.y>this._map.transform.height-d?["bottom"]:[],i.x<a/2?m.push("left"):i.x>this._map.transform.width-a/2&&m.push("right"),m.length===0?"bottom":m.join("-")}_updateClassList(){const h=[...this._classList];h.push("mapboxgl-popup"),this._anchor&&h.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&h.push("mapboxgl-popup-track-pointer"),this._container.className=h.join(" ")}_update(h){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=G.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=G.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=fc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h){const i=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),a=function(y){if(y||(y=new o.pointGeometry(0,0)),typeof y=="number"){const b=Math.round(Math.sqrt(.5*Math.pow(y,2)));return{center:new o.pointGeometry(0,0),top:new o.pointGeometry(0,y),"top-left":new o.pointGeometry(b,b),"top-right":new o.pointGeometry(-b,b),bottom:new o.pointGeometry(0,-y),"bottom-left":new o.pointGeometry(b,-b),"bottom-right":new o.pointGeometry(-b,-b),left:new o.pointGeometry(y,0),right:new o.pointGeometry(-y,0)}}if(y instanceof o.pointGeometry||Array.isArray(y)){const b=o.pointGeometry.convert(y);return{center:b,top:b,"top-left":b,"top-right":b,bottom:b,"bottom-left":b,"bottom-right":b,left:b,right:b}}return{center:o.pointGeometry.convert(y.center||[0,0]),top:o.pointGeometry.convert(y.top||[0,0]),"top-left":o.pointGeometry.convert(y["top-left"]||[0,0]),"top-right":o.pointGeometry.convert(y["top-right"]||[0,0]),bottom:o.pointGeometry.convert(y.bottom||[0,0]),"bottom-left":o.pointGeometry.convert(y["bottom-left"]||[0,0]),"bottom-right":o.pointGeometry.convert(y["bottom-right"]||[0,0]),left:o.pointGeometry.convert(y.left||[0,0]),right:o.pointGeometry.convert(y.right||[0,0])}}(this.options.offset),d=this._anchor=this._getAnchor(a),m=i.add(a[d]).round();this._map._requestDomTask(()=>{this._container&&d&&(this._container.style.transform=`${nr[d]} translate(${m.x}px,${m.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(Ya);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._content&&(this._content.style.opacity=h),this._tip&&(this._tip.style.opacity=h)}},Marker:pc,Style:Ir,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:Uu,Evented:o.Evented,config:o.config,prewarm:function(){ue().acquire(le)},clearPrewarmedResources:function(){const h=fe;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(le),fe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(h){o.config.ACCESS_TOKEN=h},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(h){o.config.API_URL=h},get workerCount(){return he.workerCount},set workerCount(h){he.workerCount=h},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){o.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){o.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return go});var z=x;return z})})(Gp);var q1=Gp.exports,W1=y1({__proto__:null,default:q1},[Gp.exports]);const X1=Cd(null);function zg(c){return{longitude:c.center.lng,latitude:c.center.lat,zoom:c.zoom,pitch:c.pitch,bearing:c.bearing,padding:c.padding}}function Pg(c,s){const p=s.viewState||s;let _=!1;if("longitude"in p&&"latitude"in p){const x=c.center;c.center=new x.constructor(p.longitude,p.latitude),_=_||x!==c.center}if("zoom"in p){const x=c.zoom;c.zoom=p.zoom,_=_||x!==c.zoom}if("bearing"in p){const x=c.bearing;c.bearing=p.bearing,_=_||x!==c.bearing}if("pitch"in p){const x=c.pitch;c.pitch=p.pitch,_=_||x!==c.pitch}return p.padding&&!c.isPaddingEqual(p.padding)&&(_=!0,c.padding=p.padding),_}const H1=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Dg(c){if(!c)return null;if(typeof c=="string"||("toJS"in c&&(c=c.toJS()),!c.layers))return c;const s={};for(const _ of c.layers)s[_.id]=_;const p=c.layers.map(_=>{const x=s[_.ref];let S=null;if("interactive"in _&&(S=dn({},_),delete S.interactive),x){S=S||dn({},_),delete S.ref;for(const z of H1)z in x&&(S[z]=x[z])}return S||_});return yl(dn({},c),{layers:p})}function K1(c,s){const p=Array.isArray(c)?c[0]:c?c.x:0,_=Array.isArray(c)?c[1]:c?c.y:0,x=Array.isArray(s)?s[0]:s?s.x:0,S=Array.isArray(s)?s[1]:s?s.y:0;return p===x&&_===S}function Nn(c,s){if(c===s)return!0;if(!c||!s)return!1;if(Array.isArray(c)){if(!Array.isArray(s)||c.length!==s.length)return!1;for(let p=0;p<c.length;p++)if(!Nn(c[p],s[p]))return!1;return!0}else if(Array.isArray(s))return!1;if(typeof c=="object"&&typeof s=="object"){const p=Object.keys(c),_=Object.keys(s);if(p.length!==_.length)return!1;for(const x of p)if(!s.hasOwnProperty(x)||!Nn(c[x],s[x]))return!1;return!0}return!1}const Lg={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},np={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Rg={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Y1=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],J1=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Pl{constructor(s,p,_){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=x=>{const S=this.props[Rg[x.type]];S&&S(x)},this._onPointerEvent=x=>{(x.type==="mousemove"||x.type==="mouseout")&&this._updateHover(x);const S=this.props[Lg[x.type]];if(S){if(this.props.interactiveLayerIds&&x.type!=="mouseover"&&x.type!=="mouseout"){const z=this._hoveredFeatures||this._map.queryRenderedFeatures(x.point,{layers:this.props.interactiveLayerIds});if(!z.length)return;x.features=z}S(x),delete x.features}},this._onCameraEvent=x=>{if(!this._internalUpdate){const S=this.props[np[x.type]];S&&S(x)}x.type in this._deferredEvents&&(this._deferredEvents[x.type]=!1)},this._MapClass=s,this.props=p,this._initialize(_)}get map(){return this._map}get transform(){return this._renderTransform}setProps(s){const p=this.props;this.props=s;const _=this._updateSettings(s,p);_&&(this._renderTransform=this._map.transform.clone());const x=this._updateSize(s),S=this._updateViewState(s,!0);this._updateStyle(s,p),this._updateStyleComponents(s,p),this._updateHandlers(s,p),(_||x||S&&!this._map.isMoving())&&this.redraw()}static reuse(s,p){const _=Pl.savedMaps.pop();if(!_)return null;const x=_.map,S=x.getContainer();for(p.className=S.className;S.childNodes.length>0;)p.appendChild(S.childNodes[0]);return x._container=p,s.initialViewState&&_._updateViewState(s.initialViewState,!1),x.resize(),_.setProps(yl(dn({},s),{styleDiffing:!1})),x.isStyleLoaded()?x.fire("load"):x.once("styledata",()=>x.fire("load")),_}_initialize(s){const{props:p}=this,_=yl(dn(dn({},p),p.initialViewState),{accessToken:p.mapboxAccessToken||Q1()||null,container:s,style:Dg(p.mapStyle)}),x=_.initialViewState||_.viewState||_;if(Object.assign(_,{center:[x.longitude||0,x.latitude||0],zoom:x.zoom||0,pitch:x.pitch||0,bearing:x.bearing||0}),p.gl){const U=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=U,p.gl)}const S=new this._MapClass(_);x.padding&&S.setPadding(x.padding),p.cursor&&(S.getCanvas().style.cursor=p.cursor),this._renderTransform=S.transform.clone();const z=S._render;S._render=U=>{this._inRender=!0,z.call(S,U),this._inRender=!1};const o=S._renderTaskQueue.run;S._renderTaskQueue.run=U=>{o.call(S._renderTaskQueue,U),this._onBeforeRepaint()},S.on("render",()=>this._onAfterRepaint());const j=S.fire;S.fire=this._fireEvent.bind(this,j),S.on("resize",()=>{this._renderTransform.resize(S.transform.width,S.transform.height)}),S.on("styledata",()=>this._updateStyleComponents(this.props,{})),S.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const U in Lg)S.on(U,this._onPointerEvent);for(const U in np)S.on(U,this._onCameraEvent);for(const U in Rg)S.on(U,this._onEvent);this._map=S}recycle(){Pl.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const s=this._map;!this._inRender&&s.style&&(s._frame&&(s._frame.cancel(),s._frame=null),s._render())}_updateSize(s){const{viewState:p}=s;if(p){const _=this._map;if(p.width!==_.transform.width||p.height!==_.transform.height)return _.resize(),!0}return!1}_updateViewState(s,p){if(this._internalUpdate)return!1;const _=this._map,x=this._renderTransform,{zoom:S,pitch:z,bearing:o}=x,j=Pg(x,dn(dn({},zg(_.transform)),s));if(j&&p){const U=this._deferredEvents;U.move=!0,U.zoom||(U.zoom=S!==x.zoom),U.rotate||(U.rotate=o!==x.bearing),U.pitch||(U.pitch=z!==x.pitch)}return _.isMoving()||Pg(_.transform,s),j}_updateSettings(s,p){const _=this._map;let x=!1;for(const S of Y1)S in s&&!Nn(s[S],p[S])&&(x=!0,_[`set${S[0].toUpperCase()}${S.slice(1)}`](s[S]));return x}_updateStyle(s,p){if(s.cursor!==p.cursor&&(this._map.getCanvas().style.cursor=s.cursor),s.mapStyle!==p.mapStyle){const _={diff:s.styleDiffing};return"localIdeographFontFamily"in s&&(_.localIdeographFontFamily=s.localIdeographFontFamily),this._map.setStyle(Dg(s.mapStyle),_),!0}return!1}_updateStyleComponents(s,p){const _=this._map;let x=!1;return _.style.loaded()&&("light"in s&&!Nn(s.light,p.light)&&(x=!0,_.setLight(s.light)),"fog"in s&&!Nn(s.fog,p.fog)&&(x=!0,_.setFog(s.fog)),"terrain"in s&&!Nn(s.terrain,p.terrain)&&(!s.terrain||_.getSource(s.terrain.source))&&(x=!0,_.setTerrain(s.terrain),this._renderTransform.elevation=_.transform.elevation)),x}_updateHandlers(s,p){const _=this._map;let x=!1;for(const S of J1){const z=s[S];Nn(z,p[S])||(x=!0,z?_[S].enable(z):_[S].disable())}return x}_updateHover(s){var x;const{props:p}=this;if(p.interactiveLayerIds&&(p.onMouseMove||p.onMouseEnter||p.onMouseLeave)){const S=s.type,z=((x=this._hoveredFeatures)==null?void 0:x.length)>0;let o;if(S==="mousemove")try{o=this._map.queryRenderedFeatures(s.point,{layers:p.interactiveLayerIds})}catch{o=[]}else o=[];const j=o.length>0;!j&&z&&(s.type="mouseleave",this._onPointerEvent(s)),this._hoveredFeatures=o,j&&!z&&(s.type="mouseenter",this._onPointerEvent(s)),s.type=S}else this._hoveredFeatures=null}_fireEvent(s,p,_){const x=this._map,S=x.transform,z=typeof p=="string"?p:p.type;return z==="move"&&this._updateViewState(this.props,!1),z in np&&(typeof p=="object"&&(p.viewState=zg(S)),this._map.isMoving())?(x.transform=this._renderTransform,s.call(x,p,_),x.transform=S,x):(s.call(x,p,_),x)}_onBeforeRepaint(){const s=this._map;this._internalUpdate=!0;for(const _ in this._deferredEvents)this._deferredEvents[_]&&s.fire(_);this._internalUpdate=!1;const p=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=p}}}Pl.savedMaps=[];function Q1(){let c=null;if(typeof location!="undefined"){const s=/access_token=([^&\/]*)/.exec(location.search);c=s&&s[1]}try{c=c||{}.MapboxAccessToken}catch{}try{c=c||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return c}const eb=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function tb(c,s){if(!c)return null;const p=c.map,_={getMap:()=>p,getCenter:()=>c.transform.center,getZoom:()=>c.transform.zoom,getBearing:()=>c.transform.bearing,getPitch:()=>c.transform.pitch,getPadding:()=>c.transform.padding,getBounds:()=>c.transform.getBounds(),project:x=>c.transform.locationPoint(s.LngLat.convert(x)),unproject:x=>c.transform.pointLocation(s.Point.convert(x))};for(const x of ib(p))!(x in _)&&!eb.includes(x)&&(_[x]=p[x].bind(p));return _}function ib(c){const s=new Set;let p=c;for(;p;){for(const _ of Object.getOwnPropertyNames(p))_[0]!=="_"&&typeof c[_]=="function"&&_!=="fire"&&_!=="setEventedParent"&&s.add(_);p=Object.getPrototypeOf(p)}return Array.from(s)}const rb=typeof document!="undefined"?fs:si,nb=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function ob(c,s){for(const p of nb)p in s&&(c[p]=s[p]);s.RTLTextPlugin&&c.getRTLTextPluginStatus&&c.getRTLTextPluginStatus()==="unavailable"&&c.setRTLTextPlugin(s.RTLTextPlugin,p=>{p&&console.error(p)},!1)}const Ol=Cd(null),ab={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:c=>console.error(c.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},Hy=pu((c,s)=>{const p=ps(X1),[_,x]=mn(null),S=Et(),{current:z}=Et({mapLib:null,map:null});si(()=>{const j=c.mapLib;let U=!0,F;return Promise.resolve(j||Promise.resolve().then(function(){return W1})).then($=>{if(!!U){if($.Map||($=$.default),!$||!$.Map)throw new Error("Invalid mapLib");if($.supported(c))ob($,c),c.reuseMaps&&(F=Pl.reuse(c,S.current)),F||(F=new Pl($.Map,c,S.current)),z.map=tb(F,$),z.mapLib=$,x(F),p==null||p.onMapMount(z.map,c.id);else throw new Error("Map is not supported by this browser")}}).catch($=>{c.onError({type:"error",target:null,originalEvent:null,error:$})}),()=>{U=!1,F&&(p==null||p.onMapUnmount(c.id),c.reuseMaps?F.recycle():F.destroy())}},[]),rb(()=>{_&&_.setProps(c)}),Bl(s,()=>z.map,[_]);const o=Kr(()=>dn({position:"relative",width:"100%",height:"100%"},c.style),[c.style]);return _n("div",{id:c.id,ref:S,style:o},_&&_n(Ol.Provider,{value:z},c.children))});Hy.displayName="Map";Hy.defaultProps=ab;const sb=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function ms(c,s){if(!c||!s)return;const p=c.style;for(const _ in s){const x=s[_];Number.isFinite(x)&&!sb.test(_)?p[_]=`${x}px`:p[_]=x}}const lb={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function Ky(c){const{map:s,mapLib:p}=ps(Ol),_=Et({props:c});_.current.props=c;const x=Kr(()=>{let S=!1;$p.forEach(c.children,j=>{j&&(S=!0)});const z=yl(dn({},c),{element:S?document.createElement("div"):null}),o=new p.Marker(z).setLngLat([c.longitude,c.latitude]);return o.getElement().addEventListener("click",j=>{var U,F;(F=(U=_.current.props).onClick)==null||F.call(U,{type:"click",target:o,originalEvent:j})}),o.on("dragstart",j=>{var F,$;const U=j;U.lngLat=x.getLngLat(),($=(F=_.current.props).onDragStart)==null||$.call(F,U)}),o.on("drag",j=>{var F,$;const U=j;U.lngLat=x.getLngLat(),($=(F=_.current.props).onDrag)==null||$.call(F,U)}),o.on("dragend",j=>{var F,$;const U=j;U.lngLat=x.getLngLat(),($=(F=_.current.props).onDragEnd)==null||$.call(F,U)}),o},[]);return si(()=>(x.addTo(s.getMap()),()=>{x.remove()}),[]),si(()=>{ms(x.getElement(),c.style)},[c.style]),(x.getLngLat().lng!==c.longitude||x.getLngLat().lat!==c.latitude)&&x.setLngLat([c.longitude,c.latitude]),c.offset&&!K1(x.getOffset(),c.offset)&&x.setOffset(c.offset),x.isDraggable()!==c.draggable&&x.setDraggable(c.draggable),x.getRotation()!==c.rotation&&x.setRotation(c.rotation),x.getRotationAlignment()!==c.rotationAlignment&&x.setRotationAlignment(c.rotationAlignment),x.getPitchAlignment()!==c.pitchAlignment&&x.setPitchAlignment(c.pitchAlignment),x.getPopup()!==c.popup&&x.setPopup(c.popup),Id(c.children,x.getElement())}Ky.defaultProps=lb;var CS=Ta(Ky);function Bg(c){return new Set(c?c.trim().split(/\s+/):[])}function cb(c){const{map:s,mapLib:p}=ps(Ol),_=Kr(()=>document.createElement("div"),[]),x=Et({props:c});x.current.props=c;const S=Kr(()=>{const z=dn({},c),o=new p.Popup(z).setLngLat([c.longitude,c.latitude]);return o.on("open",j=>{var U,F;(F=(U=x.current.props).onOpen)==null||F.call(U,j)}),o.on("close",j=>{var U,F;(F=(U=x.current.props).onClose)==null||F.call(U,j)}),o},[]);if(si(()=>(S.setDOMContent(_).addTo(s.getMap()),()=>{S.isOpen()&&S.remove()}),[]),si(()=>{ms(S.getElement(),c.style)},[c.style]),S.isOpen()&&((S.getLngLat().lng!==c.longitude||S.getLngLat().lat!==c.latitude)&&S.setLngLat([c.longitude,c.latitude]),c.offset&&!Nn(S.options.offset,c.offset)&&S.setOffset(c.offset),(S.options.anchor!==c.anchor||S.options.maxWidth!==c.maxWidth)&&(S.options.anchor=c.anchor,S.setMaxWidth(c.maxWidth)),S.options.className!==c.className)){const z=Bg(S.options.className),o=Bg(c.className);for(const j of z)o.has(j)||S.removeClassName(j);for(const j of o)z.has(j)||S.addClassName(j);S.options.className=c.className}return Id(c.children,_)}Ta(cb);function mu(c,s,p){const _=ps(Ol),x=Kr(()=>c(_),[]);return si(()=>{var z;const{map:S}=_;return S.hasControl(x)||S.addControl(x,(z=p||s)==null?void 0:z.position),()=>{typeof s=="function"&&s(_),S.hasControl(x)&&S.removeControl(x)}},[]),x}function ub(c){const s=mu(({mapLib:p})=>new p.AttributionControl(c),{position:c.position});return si(()=>{ms(s._container,c.style)},[c.style]),null}var IS=Ta(ub);function hb(c){const s=mu(({mapLib:p})=>new p.FullscreenControl({container:c.containerId&&document.getElementById(c.containerId)}),{position:c.position});return si(()=>{ms(s._controlContainer,c.style)},[c.style]),null}Ta(hb);const Yy=pu((c,s)=>{const p=Et({props:c}),_=mu(({mapLib:x})=>{const S=new x.GeolocateControl(c);return S.on("geolocate",z=>{var o,j;(j=(o=p.current.props).onGeolocate)==null||j.call(o,z)}),S.on("error",z=>{var o,j;(j=(o=p.current.props).onError)==null||j.call(o,z)}),S.on("outofmaxbounds",z=>{var o,j;(j=(o=p.current.props).onOutOfMaxBounds)==null||j.call(o,z)}),S.on("trackuserlocationstart",z=>{var o,j;(j=(o=p.current.props).onTrackUserLocationStart)==null||j.call(o,z)}),S.on("trackuserlocationend",z=>{var o,j;(j=(o=p.current.props).onTrackUserLocationEnd)==null||j.call(o,z)}),S},{position:c.position});return p.current.props=c,Bl(s,()=>({trigger:()=>_.trigger()}),[]),si(()=>{ms(_._container,c.style)},[c.style]),null});Yy.displayName="GeolocateControl";var MS=Ta(Yy);function db(c){const s=mu(({mapLib:p})=>new p.NavigationControl(c),{position:c.position});return si(()=>{ms(s._container,c.style)},[c.style]),null}var kS=Ta(db);const fb={unit:"metric",maxWidth:100};function Jy(c){const s=mu(({mapLib:p})=>new p.ScaleControl(c),{position:c.position});return(s.options.unit!==c.unit||s.options.maxWidth!==c.maxWidth)&&(s.options.maxWidth=c.maxWidth,s.setUnit(c.unit)),si(()=>{ms(s._container,c.style)},[c.style]),null}Jy.defaultProps=fb;Ta(Jy);function md(c,s){if(!c)throw new Error(s)}let pb=0;function mb(c,s,p){if(c.style&&c.style._loaded){const _=dn({},p);return delete _.id,delete _.children,c.addSource(s,_),c.getSource(s)}return null}function _b(c,s,p){md(s.id===p.id,"source id changed"),md(s.type===p.type,"source type changed");let _="",x=0;for(const z in s)z!=="children"&&z!=="id"&&!Nn(p[z],s[z])&&(_=z,x++);if(!x)return;const S=s.type;if(S==="geojson")c.setData(s.data);else if(S==="image")c.updateImage({url:s.url,coordinates:s.coordinates});else if((S==="canvas"||S==="video")&&x===1&&_==="coordinates")c.setCoordinates(s.coordinates);else if(S==="vector"&&"setUrl"in c)switch(_){case"url":c.setUrl(s.url);break;case"tiles":c.setTiles(s.tiles);break}else console.warn(`Unable to update <Source> prop: ${_}`)}function zS(c){const s=ps(Ol).map.getMap(),p=Et(c),[,_]=mn(0),x=Kr(()=>c.id||`jsx-source-${pb++}`,[]);si(()=>{if(s){const z=()=>_(o=>o+1);return s.on("styledata",z),z(),()=>{s.off("styledata",z),setTimeout(()=>{s.style&&s.style._loaded&&s.getSource(x)&&s.removeSource(x)},0)}}},[s]);let S=s&&s.style&&s.getSource(x);return S?_b(S,c,p.current):S=mb(s,x,c),p.current=c,S&&$p.map(c.children,z=>z&&Wy(z,{source:x}))||null}function gb(c,s,p,_){if(md(p.id===_.id,"layer id changed"),md(p.type===_.type,"layer type changed"),p.type==="custom"||_.type==="custom")return;const{layout:x={},paint:S={},filter:z,minzoom:o,maxzoom:j,beforeId:U}=p;if(U!==_.beforeId&&c.moveLayer(s,U),x!==_.layout){const F=_.layout||{};for(const $ in x)Nn(x[$],F[$])||c.setLayoutProperty(s,$,x[$]);for(const $ in F)x.hasOwnProperty($)||c.setLayoutProperty(s,$,void 0)}if(S!==_.paint){const F=_.paint||{};for(const $ in S)Nn(S[$],F[$])||c.setPaintProperty(s,$,S[$]);for(const $ in F)S.hasOwnProperty($)||c.setPaintProperty(s,$,void 0)}Nn(z,_.filter)||c.setFilter(s,z),(o!==_.minzoom||j!==_.maxzoom)&&c.setLayerZoomRange(s,o,j)}function yb(c,s,p){if(c.style&&c.style._loaded&&c.getSource(p.source)){const _=yl(dn({},p),{id:s});delete _.beforeId,c.addLayer(_,p.beforeId)}}let vb=0;function PS(c){const s=ps(Ol).map.getMap(),p=Et(c),[,_]=mn(0),x=Kr(()=>c.id||`jsx-layer-${vb++}`,[]);if(si(()=>{if(s){const z=()=>_(o=>o+1);return s.on("styledata",z),z(),()=>{s.off("styledata",z),s.style&&s.style._loaded&&s.removeLayer(x)}}},[s]),s&&s.style&&s.getLayer(x))try{gb(s,x,c,p.current)}catch(z){console.warn(z)}else yb(s,x,c);return p.current=c,null}var xb=function(s){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},x=void 0,S=void 0,z=void 0,o=[];return function(){var F=bb(p),$=new Date().getTime(),J=!x||$-x>F;x=$;for(var G=arguments.length,ye=Array(G),Te=0;Te<G;Te++)ye[Te]=arguments[Te];if(J&&_.leading)return _.accumulate?Promise.resolve(s.call(this,[ye])).then(function(Ve){return Ve[0]}):Promise.resolve(s.call.apply(s,[this].concat(ye)));if(S?clearTimeout(z):S=wb(),o.push(ye),z=setTimeout(j.bind(this),F),_.accumulate){var Ue=o.length-1;return S.promise.then(function(Ve){return Ve[Ue]})}return S.promise};function j(){var U=S;clearTimeout(z),Promise.resolve(_.accumulate?s.call(this,o):s.apply(this,o[o.length-1])).then(U.resolve,U.reject),o=[],S=null}};function bb(c){return typeof c=="function"?c():c}function wb(){var c={};return c.promise=new Promise(function(s,p){c.resolve=s,c.reject=p}),c}function Tb(c){var s=null,p=null,_=new Promise(function(x,S){s=x,p=S});return c&&c.then(function(x){s&&s(x)},function(x){p&&p(x)}),{promise:_,resolve:function(x){s&&s(x)},reject:function(x){p&&p(x)},cancel:function(){s=null,p=null}}}function Sb(c){var s=null,p=function(){for(var _=[],x=0;x<arguments.length;x++)_[x]=arguments[x];s&&s();var S=c.apply(void 0,_),z=Tb(S),o=z.promise,j=z.cancel;return s=j,o};return p}/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var vp=function(){return vp=Object.assign||function(s){for(var p,_=1,x=arguments.length;_<x;_++){p=arguments[_];for(var S in p)Object.prototype.hasOwnProperty.call(p,S)&&(s[S]=p[S])}return s},vp.apply(this,arguments)},Eb={key:function(){for(var c=[],s=0;s<arguments.length;s++)c[s]=arguments[s];return null},onlyResolvesLast:!0},Ab=function(){function c(s){this.config=s,this.debounceSingleton=null,this.debounceCache={}}return c.prototype._createDebouncedFunction=function(){var s=xb(this.config.func,this.config.wait,this.config.options);return this.config.options.onlyResolvesLast&&(s=Sb(s)),{func:s}},c.prototype.getDebouncedFunction=function(s){var p,_=(p=this.config.options).key.apply(p,s);return _===null||typeof _=="undefined"?(this.debounceSingleton||(this.debounceSingleton=this._createDebouncedFunction()),this.debounceSingleton):(this.debounceCache[_]||(this.debounceCache[_]=this._createDebouncedFunction()),this.debounceCache[_])},c}();function DS(c,s,p){var _=vp({},Eb,p),x=new Ab({func:c,wait:s,options:_}),S=function(){for(var z=[],o=0;o<arguments.length;o++)z[o]=arguments[o];var j=x.getDebouncedFunction(z).func;return j.apply(void 0,z)};return S}var Cb=Ib()?fs:si;function Ib(){return!!(typeof window!="undefined"&&window.document&&window.document.createElement)}function Mb(){var c=mn(Object.create(null)),s=c[1];return ui(function(){s(Object.create(null))},[])}var kb=function(s){var p=s.children,_=s.type,x=_===void 0?"reach-portal":_,S=Et(null),z=Et(null),o=Mb();return Cb(function(){if(!!S.current){var j=S.current.ownerDocument;return z.current=j==null?void 0:j.createElement(x),j.body.appendChild(z.current),o(),function(){z.current&&z.current.ownerDocument&&z.current.ownerDocument.body.removeChild(z.current)}}},[x,o]),z.current?Id(p,z.current):_n("span",{ref:S})};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var at=function(){return at=Object.assign||function(s){for(var p,_=1,x=arguments.length;_<x;_++){p=arguments[_];for(var S in p)Object.prototype.hasOwnProperty.call(p,S)&&(s[S]=p[S])}return s},at.apply(this,arguments)};function Zp(c,s){var p={};for(var _ in c)Object.prototype.hasOwnProperty.call(c,_)&&s.indexOf(_)<0&&(p[_]=c[_]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var x=0,_=Object.getOwnPropertySymbols(c);x<_.length;x++)s.indexOf(_[x])<0&&Object.prototype.propertyIsEnumerable.call(c,_[x])&&(p[_[x]]=c[_[x]]);return p}function hi(c){var s=typeof Symbol=="function"&&Symbol.iterator,p=s&&c[s],_=0;if(p)return p.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&_>=c.length&&(c=void 0),{value:c&&c[_++],done:!c}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ti(c,s){var p=typeof Symbol=="function"&&c[Symbol.iterator];if(!p)return c;var _=p.call(c),x,S=[],z;try{for(;(s===void 0||s-- >0)&&!(x=_.next()).done;)S.push(x.value)}catch(o){z={error:o}}finally{try{x&&!x.done&&(p=_.return)&&p.call(_)}finally{if(z)throw z.error}}return S}function er(c,s,p){if(p||arguments.length===2)for(var _=0,x=s.length,S;_<x;_++)(S||!(_ in s))&&(S||(S=Array.prototype.slice.call(s,0,_)),S[_]=s[_]);return c.concat(S||Array.prototype.slice.call(s))}var ki;(function(c){c.Start="xstate.start",c.Stop="xstate.stop",c.Raise="xstate.raise",c.Send="xstate.send",c.Cancel="xstate.cancel",c.NullEvent="",c.Assign="xstate.assign",c.After="xstate.after",c.DoneState="done.state",c.DoneInvoke="done.invoke",c.Log="xstate.log",c.Init="xstate.init",c.Invoke="xstate.invoke",c.ErrorExecution="error.execution",c.ErrorCommunication="error.communication",c.ErrorPlatform="error.platform",c.ErrorCustom="xstate.error",c.Update="xstate.update",c.Pure="xstate.pure",c.Choose="xstate.choose"})(ki||(ki={}));var lu;(function(c){c.Parent="#_parent",c.Internal="#_internal"})(lu||(lu={}));var xp=ki.Start,qp=ki.Stop,Md=ki.Raise,kd=ki.Send,Qy=ki.Cancel,zb=ki.NullEvent,bp=ki.Assign;ki.After;ki.DoneState;var ev=ki.Log,Pb=ki.Init,wp=ki.Invoke;ki.ErrorExecution;var Og=ki.ErrorPlatform,Db=ki.ErrorCustom,tv=ki.Update,Lb=ki.Choose,Rb=ki.Pure,iv=".",Fg={},Tp="xstate.guard",Bb="",Fc=!0,Nh;function Wp(c,s,p){p===void 0&&(p=iv);var _=Kc(c,p),x=Kc(s,p);return bi(x)?bi(_)?x===_:!1:bi(_)?_ in x:Object.keys(_).every(function(S){return S in x?Wp(_[S],x[S]):!1})}function rv(c){try{return bi(c)||typeof c=="number"?"".concat(c):c.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function Sp(c,s){try{return Fl(c)?c:c.toString().split(s)}catch{throw new Error("'".concat(c,"' is not a valid state path."))}}function Ob(c){return typeof c=="object"&&"value"in c&&"context"in c&&"event"in c&&"_event"in c}function Kc(c,s){if(Ob(c))return c.value;if(Fl(c))return _d(c);if(typeof c!="string")return c;var p=Sp(c,s);return _d(p)}function _d(c){if(c.length===1)return c[0];for(var s={},p=s,_=0;_<c.length-1;_++)_===c.length-2?p[c[_]]=c[_+1]:(p[c[_]]={},p=p[c[_]]);return s}function Zc(c,s){for(var p={},_=Object.keys(c),x=0;x<_.length;x++){var S=_[x];p[S]=s(c[S],S,c,x)}return p}function Ug(c,s,p){var _,x,S={};try{for(var z=hi(Object.keys(c)),o=z.next();!o.done;o=z.next()){var j=o.value,U=c[j];!p(U)||(S[j]=s(U,j,c))}}catch(F){_={error:F}}finally{try{o&&!o.done&&(x=z.return)&&x.call(z)}finally{if(_)throw _.error}}return S}var Fb=function(c){return function(s){var p,_,x=s;try{for(var S=hi(c),z=S.next();!z.done;z=S.next()){var o=z.value;x=x[o]}}catch(j){p={error:j}}finally{try{z&&!z.done&&(_=S.return)&&_.call(S)}finally{if(p)throw p.error}}return x}};function Ub(c,s){return function(p){var _,x,S=p;try{for(var z=hi(c),o=z.next();!o.done;o=z.next()){var j=o.value;S=S[s][j]}}catch(U){_={error:U}}finally{try{o&&!o.done&&(x=z.return)&&x.call(z)}finally{if(_)throw _.error}}return S}}function ad(c){if(!c)return[[]];if(bi(c))return[[c]];var s=Zi(Object.keys(c).map(function(p){var _=c[p];return typeof _!="string"&&(!_||!Object.keys(_).length)?[[p]]:ad(c[p]).map(function(x){return[p].concat(x)})}));return s}function Zi(c){var s;return(s=[]).concat.apply(s,er([],Ti(c),!1))}function nv(c){return Fl(c)?c:[c]}function Yn(c){return c===void 0?[]:nv(c)}function gd(c,s,p){var _,x;if(Mi(c))return c(s,p.data);var S={};try{for(var z=hi(Object.keys(c)),o=z.next();!o.done;o=z.next()){var j=o.value,U=c[j];Mi(U)?S[j]=U(s,p.data):S[j]=U}}catch(F){_={error:F}}finally{try{o&&!o.done&&(x=z.return)&&x.call(z)}finally{if(_)throw _.error}}return S}function Nb(c){return/^(done|error)\./.test(c)}function Ng(c){return!!(c instanceof Promise||c!==null&&(Mi(c)||typeof c=="object")&&Mi(c.then))}function jb(c){return c!==null&&typeof c=="object"&&"transition"in c&&typeof c.transition=="function"}function ov(c,s){var p,_,x=Ti([[],[]],2),S=x[0],z=x[1];try{for(var o=hi(c),j=o.next();!j.done;j=o.next()){var U=j.value;s(U)?S.push(U):z.push(U)}}catch(F){p={error:F}}finally{try{j&&!j.done&&(_=o.return)&&_.call(o)}finally{if(p)throw p.error}}return[S,z]}function av(c,s){return Zc(c.states,function(p,_){if(!!p){var x=(bi(s)?void 0:s[_])||(p?p.current:void 0);if(!!x)return{current:x,states:av(p,x)}}})}function Vb(c,s){return{current:s,states:av(c,s)}}function jg(c,s,p,_){var x=c&&p.reduce(function(S,z){var o,j,U=z.assignment,F={state:_,action:z,_event:s},$={};if(Mi(U))$=U(S,s.data,F);else try{for(var J=hi(Object.keys(U)),G=J.next();!G.done;G=J.next()){var ye=G.value,Te=U[ye];$[ye]=Mi(Te)?Te(S,s.data,F):Te}}catch(Ue){o={error:Ue}}finally{try{G&&!G.done&&(j=J.return)&&j.call(J)}finally{if(o)throw o.error}}return Object.assign({},S,$)},c);return x}var Yc=function(){};function Fl(c){return Array.isArray(c)}function Mi(c){return typeof c=="function"}function bi(c){return typeof c=="string"}function sv(c,s){if(!!c)return bi(c)?{type:Tp,name:c,predicate:s?s[c]:void 0}:Mi(c)?{type:Tp,name:c.name,predicate:c}:c}function $b(c){try{return"subscribe"in c&&Mi(c.subscribe)}catch{return!1}}var xa=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();Nh={},Nh[xa]=function(){return this},Nh[Symbol.observable]=function(){return this};function ds(c){return!!c&&"__xstatenode"in c}function Gb(c){return!!c&&typeof c.send=="function"}function Xp(c,s){return bi(c)||typeof c=="number"?at({type:c},s):c}function Rr(c,s){if(!bi(c)&&"$$type"in c&&c.$$type==="scxml")return c;var p=Xp(c);return at({name:p.type,data:p,$$type:"scxml",type:"external"},s)}function vl(c,s){var p=nv(s).map(function(_){return typeof _=="undefined"||typeof _=="string"||ds(_)?{target:_,event:c}:at(at({},_),{event:c})});return p}function Zb(c){if(!(c===void 0||c===Bb))return Yn(c)}function lv(c,s,p,_,x){var S=c.options.guards,z={state:x,cond:s,_event:_};if(s.type===Tp)return((S==null?void 0:S[s.name])||s.predicate)(p,_.data,z);var o=S==null?void 0:S[s.type];if(!o)throw new Error("Guard '".concat(s.type,"' is not implemented on machine '").concat(c.id,"'."));return o(p,_.data,z)}function cv(c){return typeof c=="string"?{type:c}:c}function Ep(c,s,p){if(typeof c=="object")return c;var _=function(){};return{next:c,error:s||_,complete:p||_}}function jh(c,s){return"".concat(c,":invocation[").concat(s,"]")}var yd=Rr({type:Pb});function Ap(c,s){return s&&s[c]||void 0}function cu(c,s){var p;if(bi(c)||typeof c=="number"){var _=Ap(c,s);Mi(_)?p={type:c,exec:_}:_?p=_:p={type:c,exec:void 0}}else if(Mi(c))p={type:c.name||c.toString(),exec:c};else{var _=Ap(c.type,s);if(Mi(_))p=at(at({},c),{exec:_});else if(_){var x=_.type||c.type;p=at(at(at({},_),c),{type:x})}else p=c}return p}var vd=function(c,s){if(!c)return[];var p=Fl(c)?c:[c];return p.map(function(_){return cu(_,s)})};function Hp(c){var s=cu(c);return at(at({id:bi(c)?c:s.id},s),{type:s.type})}function qb(c){return bi(c)?{type:Md,event:c}:uv(c,{to:lu.Internal})}function Wb(c){return{type:Md,_event:Rr(c.event)}}function uv(c,s){return{to:s?s.to:void 0,type:kd,event:Mi(c)?c:Xp(c),delay:s?s.delay:void 0,id:s&&s.id!==void 0?s.id:Mi(c)?c.name:rv(c)}}function Xb(c,s,p,_){var x={_event:p},S=Rr(Mi(c.event)?c.event(s,p.data,x):c.event),z;if(bi(c.delay)){var o=_&&_[c.delay];z=Mi(o)?o(s,p.data,x):o}else z=Mi(c.delay)?c.delay(s,p.data,x):c.delay;var j=Mi(c.to)?c.to(s,p.data,x):c.to;return at(at({},c),{to:j,_event:S,event:S.data,delay:z})}var Hb=function(c,s,p){return at(at({},c),{value:bi(c.expr)?c.expr:c.expr(s,p.data,{_event:p})})},Kb=function(c){return{type:Qy,sendId:c}};function Yb(c){var s=Hp(c);return{type:ki.Start,activity:s,exec:void 0}}function Jb(c){var s=Mi(c)?c:Hp(c);return{type:ki.Stop,activity:s,exec:void 0}}function Qb(c,s,p){var _=Mi(c.activity)?c.activity(s,p.data):c.activity,x=typeof _=="string"?{id:_}:_,S={type:ki.Stop,activity:x};return S}var ew=function(c){return{type:bp,assignment:c}};function tw(c,s){var p=s?"#".concat(s):"";return"".concat(ki.After,"(").concat(c,")").concat(p)}function Vh(c,s){var p="".concat(ki.DoneState,".").concat(c),_={type:p,data:s};return _.toString=function(){return p},_}function sd(c,s){var p="".concat(ki.DoneInvoke,".").concat(c),_={type:p,data:s};return _.toString=function(){return p},_}function qc(c,s){var p="".concat(ki.ErrorPlatform,".").concat(c),_={type:p,data:s};return _.toString=function(){return p},_}function Cp(c,s,p,_,x,S){S===void 0&&(S=!1);var z=Ti(S?[[],x]:ov(x,function(J){return J.type===bp}),2),o=z[0],j=z[1],U=o.length?jg(p,_,o,s):p,F=S?[p]:void 0,$=Zi(j.map(function(J){var G;switch(J.type){case Md:return Wb(J);case kd:var ye=Xb(J,U,_,c.options.delays);return ye;case ev:return Hb(J,U,_);case Lb:{var Te=J,Ue=(G=Te.conds.find(function(rt){var st=sv(rt.cond,c.options.guards);return!st||lv(c,st,U,_,s)}))===null||G===void 0?void 0:G.actions;if(!Ue)return[];var Ve=Ti(Cp(c,s,U,_,vd(Yn(Ue),c.options.actions),S),2),T=Ve[0],we=Ve[1];return U=we,F==null||F.push(U),T}case Rb:{var Ue=J.get(U,_.data);if(!Ue)return[];var Le=Ti(Cp(c,s,U,_,vd(Yn(Ue),c.options.actions),S),2),qe=Le[0],xe=Le[1];return U=xe,F==null||F.push(U),qe}case qp:return Qb(J,U,_);case bp:{U=jg(U,_,[J],s),F==null||F.push(U);break}default:var Se=cu(J,c.options.actions),Oe=Se.exec;if(Oe&&F){var Ye=F.length-1;Se=at(at({},Se),{exec:function(rt){for(var st=[],wt=1;wt<arguments.length;wt++)st[wt-1]=arguments[wt];Oe.apply(void 0,er([F[Ye]],Ti(st),!1))}})}return Se}}).filter(function(J){return!!J}));return[$,U]}var Wc=function(c,s){var p=s(c);return p};function hv(c){var s;return s={id:c,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:c}}},s[xa]=function(){return this},s}function iw(c,s,p,_){var x,S=cv(c.src),z=(x=s==null?void 0:s.options.services)===null||x===void 0?void 0:x[S.type],o=c.data?gd(c.data,p,_):void 0,j=z?rw(z,c.id,o):hv(c.id);return j.meta=c,j}function rw(c,s,p){var _=hv(s);if(_.deferred=!0,ds(c)){var x=_.state=Wc(void 0,function(){return(p?c.withContext(p):c).initialState});_.getSnapshot=function(){return x}}return _}function nw(c){try{return typeof c.send=="function"}catch{return!1}}function ow(c){return nw(c)&&"id"in c}function aw(c){var s;return at((s={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},s[xa]=function(){return this},s),c)}var xd=function(c){return c.type==="atomic"||c.type==="final"};function Dl(c){return Object.keys(c.states).map(function(s){return c.states[s]})}function dv(c){var s=[c];return xd(c)?s:s.concat(Zi(Dl(c).map(dv)))}function Sl(c,s){var p,_,x,S,z,o,j,U,F=new Set(c),$=Ip(F),J=new Set(s);try{for(var G=hi(J),ye=G.next();!ye.done;ye=G.next())for(var Te=ye.value,Ue=Te.parent;Ue&&!J.has(Ue);)J.add(Ue),Ue=Ue.parent}catch(Ye){p={error:Ye}}finally{try{ye&&!ye.done&&(_=G.return)&&_.call(G)}finally{if(p)throw p.error}}var Ve=Ip(J);try{for(var T=hi(J),we=T.next();!we.done;we=T.next()){var Te=we.value;if(Te.type==="compound"&&(!Ve.get(Te)||!Ve.get(Te).length))$.get(Te)?$.get(Te).forEach(function(rt){return J.add(rt)}):Te.initialStateNodes.forEach(function(rt){return J.add(rt)});else if(Te.type==="parallel")try{for(var Le=(z=void 0,hi(Dl(Te))),qe=Le.next();!qe.done;qe=Le.next()){var xe=qe.value;xe.type!=="history"&&(J.has(xe)||(J.add(xe),$.get(xe)?$.get(xe).forEach(function(rt){return J.add(rt)}):xe.initialStateNodes.forEach(function(rt){return J.add(rt)})))}}catch(rt){z={error:rt}}finally{try{qe&&!qe.done&&(o=Le.return)&&o.call(Le)}finally{if(z)throw z.error}}}}catch(Ye){x={error:Ye}}finally{try{we&&!we.done&&(S=T.return)&&S.call(T)}finally{if(x)throw x.error}}try{for(var Se=hi(J),Oe=Se.next();!Oe.done;Oe=Se.next())for(var Te=Oe.value,Ue=Te.parent;Ue&&!J.has(Ue);)J.add(Ue),Ue=Ue.parent}catch(Ye){j={error:Ye}}finally{try{Oe&&!Oe.done&&(U=Se.return)&&U.call(Se)}finally{if(j)throw j.error}}return J}function fv(c,s){var p=s.get(c);if(!p)return{};if(c.type==="compound"){var _=p[0];if(_){if(xd(_))return _.key}else return{}}var x={};return p.forEach(function(S){x[S.key]=fv(S,s)}),x}function Ip(c){var s,p,_=new Map;try{for(var x=hi(c),S=x.next();!S.done;S=x.next()){var z=S.value;_.has(z)||_.set(z,[]),z.parent&&(_.has(z.parent)||_.set(z.parent,[]),_.get(z.parent).push(z))}}catch(o){s={error:o}}finally{try{S&&!S.done&&(p=x.return)&&p.call(x)}finally{if(s)throw s.error}}return _}function sw(c,s){var p=Sl([c],s);return fv(c,Ip(p))}function ld(c,s){return Array.isArray(c)?c.some(function(p){return p===s}):c instanceof Set?c.has(s):!1}function lw(c){return er([],Ti(new Set(Zi(er([],Ti(c.map(function(s){return s.ownEvents})),!1)))),!1)}function Jc(c,s){return s.type==="compound"?Dl(s).some(function(p){return p.type==="final"&&ld(c,p)}):s.type==="parallel"?Dl(s).every(function(p){return Jc(c,p)}):!1}function cw(c){return c===void 0&&(c=[]),c.reduce(function(s,p){return p.meta!==void 0&&(s[p.id]=p.meta),s},{})}function Vg(c){return new Set(Zi(c.map(function(s){return s.tags})))}function pv(c,s){if(c===s)return!0;if(c===void 0||s===void 0)return!1;if(bi(c)||bi(s))return c===s;var p=Object.keys(c),_=Object.keys(s);return p.length===_.length&&p.every(function(x){return pv(c[x],s[x])})}function uw(c){return typeof c!="object"||c===null?!1:"value"in c&&"_event"in c}function hw(c,s){var p=c.exec,_=at(at({},c),{exec:p!==void 0?function(){return p(s.context,s.event,{action:c,state:s,_event:s._event})}:void 0});return _}var Jn=function(){function c(s){var p=this,_;this.actions=[],this.activities=Fg,this.meta={},this.events=[],this.value=s.value,this.context=s.context,this._event=s._event,this._sessionid=s._sessionid,this.event=this._event.data,this.historyValue=s.historyValue,this.history=s.history,this.actions=s.actions||[],this.activities=s.activities||Fg,this.meta=cw(s.configuration),this.events=s.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=s.configuration,this.transitions=s.transitions,this.children=s.children,this.done=!!s.done,this.tags=(_=Array.isArray(s.tags)?new Set(s.tags):s.tags)!==null&&_!==void 0?_:new Set,this.machine=s.machine,Object.defineProperty(this,"nextEvents",{get:function(){return lw(p.configuration)}})}return c.from=function(s,p){if(s instanceof c)return s.context!==p?new c({value:s.value,context:p,_event:s._event,_sessionid:null,historyValue:s.historyValue,history:s.history,actions:[],activities:s.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):s;var _=yd;return new c({value:s,context:p,_event:_,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},c.create=function(s){return new c(s)},c.inert=function(s,p){if(s instanceof c){if(!s.actions.length)return s;var _=yd;return new c({value:s.value,context:p,_event:_,_sessionid:null,historyValue:s.historyValue,history:s.history,activities:s.activities,configuration:s.configuration,transitions:[],children:{}})}return c.from(s,p)},c.prototype.toStrings=function(s,p){var _=this;if(s===void 0&&(s=this.value),p===void 0&&(p="."),bi(s))return[s];var x=Object.keys(s);return x.concat.apply(x,er([],Ti(x.map(function(S){return _.toStrings(s[S],p).map(function(z){return S+p+z})})),!1))},c.prototype.toJSON=function(){var s=this;s.configuration,s.transitions;var p=s.tags;s.machine;var _=Zp(s,["configuration","transitions","tags","machine"]);return at(at({},_),{tags:Array.from(p)})},c.prototype.matches=function(s){return Wp(s,this.value)},c.prototype.hasTag=function(s){return this.tags.has(s)},c.prototype.can=function(s){var p;Yc(!!this.machine);var _=(p=this.machine)===null||p===void 0?void 0:p.getTransitionData(this,s);return!!(_!=null&&_.transitions.length)&&_.transitions.some(function(x){return x.target!==void 0||x.actions.length})},c}(),dw={deferEvents:!1},$g=function(){function c(s){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=at(at({},dw),s)}return c.prototype.initialize=function(s){if(this.initialized=!0,s){if(!this.options.deferEvents){this.schedule(s);return}this.process(s)}this.flushEvents()},c.prototype.schedule=function(s){if(!this.initialized||this.processingEvent){this.queue.push(s);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(s),this.flushEvents()},c.prototype.clear=function(){this.queue=[]},c.prototype.flushEvents=function(){for(var s=this.queue.shift();s;)this.process(s),s=this.queue.shift()},c.prototype.process=function(s){this.processingEvent=!0;try{s()}catch(p){throw this.clear(),p}finally{this.processingEvent=!1}},c}(),op=new Map,fw=0,$h={bookId:function(){return"x:".concat(fw++)},register:function(c,s){return op.set(c,s),c},get:function(c){return op.get(c)},free:function(c){op.delete(c)}};function Kp(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global}function pw(){var c=Kp();if(c&&"__xstate__"in c)return c.__xstate__}function mw(c){if(!!Kp()){var s=pw();s&&s.register(c)}}function _w(c,s){s===void 0&&(s={});var p=c.initialState,_=new Set,x=[],S=!1,z=function(){if(!S){for(S=!0;x.length>0;){var U=x.shift();p=c.transition(p,U,j),_.forEach(function(F){return F.next(p)})}S=!1}},o=aw({id:s.id,send:function(U){x.push(U),z()},getSnapshot:function(){return p},subscribe:function(U,F,$){var J=Ep(U,F,$);return _.add(J),J.next(p),{unsubscribe:function(){_.delete(J)}}}}),j={parent:s.parent,self:o,id:s.id||"anonymous",observers:_};return p=c.start?c.start(j):p,o}var gw={sync:!1,autoForward:!1},fn;(function(c){c[c.NotStarted=0]="NotStarted",c[c.Running=1]="Running",c[c.Stopped=2]="Stopped"})(fn||(fn={}));var yw=function(){function c(s,p){var _=this;p===void 0&&(p=c.defaultOptions),this.machine=s,this.scheduler=new $g,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=fn.NotStarted,this.children=new Map,this.forwardTo=new Set,this.init=this.start,this.send=function(F,$){if(Fl(F))return _.batch(F),_.state;var J=Rr(Xp(F,$));if(_.status===fn.Stopped)return _.state;if(_.status!==fn.Running&&!_.options.deferEvents)throw new Error('Event "'.concat(J.name,'" was sent to uninitialized service "').concat(_.machine.id,`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `).concat(JSON.stringify(J.data)));return _.scheduler.schedule(function(){_.forward(J);var G=_.nextState(J);_.update(G,J)}),_._state},this.sendTo=function(F,$){var J=_.parent&&($===lu.Parent||_.parent.id===$),G=J?_.parent:bi($)?_.children.get($)||$h.get($):Gb($)?$:void 0;if(!G){if(!J)throw new Error("Unable to send event to child '".concat($,"' from service '").concat(_.id,"'."));return}"machine"in G?G.send(at(at({},F),{name:F.name===Db?"".concat(qc(_.id)):F.name,origin:_.sessionId})):G.send(F.data)};var x=at(at({},c.defaultOptions),p),S=x.clock,z=x.logger,o=x.parent,j=x.id,U=j!==void 0?j:s.id;this.id=U,this.logger=z,this.clock=S,this.parent=o,this.options=x,this.scheduler=new $g({deferEvents:this.options.deferEvents}),this.sessionId=$h.bookId()}return Object.defineProperty(c.prototype,"initialState",{get:function(){var s=this;return this._initialState?this._initialState:Wc(this,function(){return s._initialState=s.machine.initialState,s._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),c.prototype.execute=function(s,p){var _,x;try{for(var S=hi(s.actions),z=S.next();!z.done;z=S.next()){var o=z.value;this.exec(o,s,p)}}catch(j){_={error:j}}finally{try{z&&!z.done&&(x=S.return)&&x.call(S)}finally{if(_)throw _.error}}},c.prototype.update=function(s,p){var _,x,S,z,o,j,U,F,$=this;if(s._sessionid=this.sessionId,this._state=s,this.options.execute&&this.execute(this.state),this.children.forEach(function(Ye){$.state.children[Ye.id]=Ye}),this.devTools&&this.devTools.send(p.data,s),s.event)try{for(var J=hi(this.eventListeners),G=J.next();!G.done;G=J.next()){var ye=G.value;ye(s.event)}}catch(Ye){_={error:Ye}}finally{try{G&&!G.done&&(x=J.return)&&x.call(J)}finally{if(_)throw _.error}}try{for(var Te=hi(this.listeners),Ue=Te.next();!Ue.done;Ue=Te.next()){var ye=Ue.value;ye(s,s.event)}}catch(Ye){S={error:Ye}}finally{try{Ue&&!Ue.done&&(z=Te.return)&&z.call(Te)}finally{if(S)throw S.error}}try{for(var Ve=hi(this.contextListeners),T=Ve.next();!T.done;T=Ve.next()){var we=T.value;we(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(Ye){o={error:Ye}}finally{try{T&&!T.done&&(j=Ve.return)&&j.call(Ve)}finally{if(o)throw o.error}}var Le=Jc(s.configuration||[],this.machine);if(this.state.configuration&&Le){var qe=s.configuration.find(function(Ye){return Ye.type==="final"&&Ye.parent===$.machine}),xe=qe&&qe.doneData?gd(qe.doneData,s.context,p):void 0;try{for(var Se=hi(this.doneListeners),Oe=Se.next();!Oe.done;Oe=Se.next()){var ye=Oe.value;ye(sd(this.id,xe))}}catch(Ye){U={error:Ye}}finally{try{Oe&&!Oe.done&&(F=Se.return)&&F.call(Se)}finally{if(U)throw U.error}}this.stop()}},c.prototype.onTransition=function(s){return this.listeners.add(s),this.status===fn.Running&&s(this.state,this.state.event),this},c.prototype.subscribe=function(s,p,_){var x=this;if(!s)return{unsubscribe:function(){}};var S,z=_;return typeof s=="function"?S=s:(S=s.next.bind(s),z=s.complete.bind(s)),this.listeners.add(S),this.status===fn.Running&&S(this.state),z&&this.onDone(z),{unsubscribe:function(){S&&x.listeners.delete(S),z&&x.doneListeners.delete(z)}}},c.prototype.onEvent=function(s){return this.eventListeners.add(s),this},c.prototype.onSend=function(s){return this.sendListeners.add(s),this},c.prototype.onChange=function(s){return this.contextListeners.add(s),this},c.prototype.onStop=function(s){return this.stopListeners.add(s),this},c.prototype.onDone=function(s){return this.doneListeners.add(s),this},c.prototype.off=function(s){return this.listeners.delete(s),this.eventListeners.delete(s),this.sendListeners.delete(s),this.stopListeners.delete(s),this.doneListeners.delete(s),this.contextListeners.delete(s),this},c.prototype.start=function(s){var p=this;if(this.status===fn.Running)return this;this.machine._init(),$h.register(this.sessionId,this),this.initialized=!0,this.status=fn.Running;var _=s===void 0?this.initialState:Wc(this,function(){return uw(s)?p.machine.resolveState(s):p.machine.resolveState(Jn.from(s,p.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){p.update(_,yd)}),this},c.prototype.stop=function(){var s,p,_,x,S,z,o,j,U,F,$=this;try{for(var J=hi(this.listeners),G=J.next();!G.done;G=J.next()){var ye=G.value;this.listeners.delete(ye)}}catch(Oe){s={error:Oe}}finally{try{G&&!G.done&&(p=J.return)&&p.call(J)}finally{if(s)throw s.error}}try{for(var Te=hi(this.stopListeners),Ue=Te.next();!Ue.done;Ue=Te.next()){var ye=Ue.value;ye(),this.stopListeners.delete(ye)}}catch(Oe){_={error:Oe}}finally{try{Ue&&!Ue.done&&(x=Te.return)&&x.call(Te)}finally{if(_)throw _.error}}try{for(var Ve=hi(this.contextListeners),T=Ve.next();!T.done;T=Ve.next()){var ye=T.value;this.contextListeners.delete(ye)}}catch(Oe){S={error:Oe}}finally{try{T&&!T.done&&(z=Ve.return)&&z.call(Ve)}finally{if(S)throw S.error}}try{for(var we=hi(this.doneListeners),Le=we.next();!Le.done;Le=we.next()){var ye=Le.value;this.doneListeners.delete(ye)}}catch(Oe){o={error:Oe}}finally{try{Le&&!Le.done&&(j=we.return)&&j.call(we)}finally{if(o)throw o.error}}if(!this.initialized)return this;er([],Ti(this.state.configuration),!1).sort(function(Oe,Ye){return Ye.order-Oe.order}).forEach(function(Oe){var Ye,rt;try{for(var st=hi(Oe.definition.exit),wt=st.next();!wt.done;wt=st.next()){var di=wt.value;$.exec(di,$.state)}}catch(Si){Ye={error:Si}}finally{try{wt&&!wt.done&&(rt=st.return)&&rt.call(st)}finally{if(Ye)throw Ye.error}}}),this.children.forEach(function(Oe){Mi(Oe.stop)&&Oe.stop()});try{for(var qe=hi(Object.keys(this.delayedEventsMap)),xe=qe.next();!xe.done;xe=qe.next()){var Se=xe.value;this.clock.clearTimeout(this.delayedEventsMap[Se])}}catch(Oe){U={error:Oe}}finally{try{xe&&!xe.done&&(F=qe.return)&&F.call(qe)}finally{if(U)throw U.error}}return this.scheduler.clear(),this.initialized=!1,this.status=fn.Stopped,$h.free(this.sessionId),this},c.prototype.batch=function(s){var p=this;if(!(this.status===fn.NotStarted&&this.options.deferEvents)){if(this.status!==fn.Running)throw new Error("".concat(s.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'))}this.scheduler.schedule(function(){var _,x,S=p.state,z=!1,o=[],j=function(J){var G=Rr(J);p.forward(G),S=Wc(p,function(){return p.machine.transition(S,G)}),o.push.apply(o,er([],Ti(S.actions.map(function(ye){return hw(ye,S)})),!1)),z=z||!!S.changed};try{for(var U=hi(s),F=U.next();!F.done;F=U.next()){var $=F.value;j($)}}catch(J){_={error:J}}finally{try{F&&!F.done&&(x=U.return)&&x.call(U)}finally{if(_)throw _.error}}S.changed=z,S.actions=o,p.update(S,Rr(s[s.length-1]))})},c.prototype.sender=function(s){return this.send.bind(this,s)},c.prototype.nextState=function(s){var p=this,_=Rr(s);if(_.name.indexOf(Og)===0&&!this.state.nextEvents.some(function(S){return S.indexOf(Og)===0}))throw _.data.data;var x=Wc(this,function(){return p.machine.transition(p.state,_)});return x},c.prototype.forward=function(s){var p,_;try{for(var x=hi(this.forwardTo),S=x.next();!S.done;S=x.next()){var z=S.value,o=this.children.get(z);if(!o)throw new Error("Unable to forward event '".concat(s,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(z,"'."));o.send(s)}}catch(j){p={error:j}}finally{try{S&&!S.done&&(_=x.return)&&_.call(x)}finally{if(p)throw p.error}}},c.prototype.defer=function(s){var p=this;this.delayedEventsMap[s.id]=this.clock.setTimeout(function(){s.to?p.sendTo(s._event,s.to):p.send(s._event)},s.delay)},c.prototype.cancel=function(s){this.clock.clearTimeout(this.delayedEventsMap[s]),delete this.delayedEventsMap[s]},c.prototype.exec=function(s,p,_){_===void 0&&(_=this.machine.options.actions);var x=p.context,S=p._event,z=s.exec||Ap(s.type,_),o=Mi(z)?z:z?z.exec:s.exec;if(o)try{return o(x,S.data,{action:s,state:this.state,_event:S})}catch(Le){throw this.parent&&this.parent.send({type:"xstate.error",data:Le}),Le}switch(s.type){case kd:var j=s;if(typeof j.delay=="number"){this.defer(j);return}else j.to?this.sendTo(j._event,j.to):this.send(j._event);break;case Qy:this.cancel(s.sendId);break;case xp:{if(this.status!==fn.Running)return;var U=s.activity;if(!this.state.activities[U.id||U.type])break;if(U.type===ki.Invoke){var F=cv(U.src),$=this.machine.options.services?this.machine.options.services[F.type]:void 0,J=U.id,G=U.data,ye="autoForward"in U?U.autoForward:!!U.forward;if(!$)return;var Te=G?gd(G,x,S):void 0;if(typeof $=="string")return;var Ue=Mi($)?$(x,S.data,{data:Te,src:F,meta:U.meta}):$;if(!Ue)return;var Ve=void 0;ds(Ue)&&(Ue=Te?Ue.withContext(Te):Ue,Ve={autoForward:ye}),this.spawn(Ue,J,Ve)}else this.spawnActivity(U);break}case qp:{this.stopChild(s.activity.id);break}case ev:var T=s.label,we=s.value;T?this.logger(T,we):this.logger(we);break}},c.prototype.removeChild=function(s){var p;this.children.delete(s),this.forwardTo.delete(s),(p=this.state)===null||p===void 0||delete p.children[s]},c.prototype.stopChild=function(s){var p=this.children.get(s);!p||(this.removeChild(s),Mi(p.stop)&&p.stop())},c.prototype.spawn=function(s,p,_){if(Ng(s))return this.spawnPromise(Promise.resolve(s),p);if(Mi(s))return this.spawnCallback(s,p);if(ow(s))return this.spawnActor(s,p);if($b(s))return this.spawnObservable(s,p);if(ds(s))return this.spawnMachine(s,at(at({},_),{id:p}));if(jb(s))return this.spawnBehavior(s,p);throw new Error('Unable to spawn entity "'.concat(p,'" of type "').concat(typeof s,'".'))},c.prototype.spawnMachine=function(s,p){var _=this;p===void 0&&(p={});var x=new c(s,at(at({},this.options),{parent:this,id:p.id||s.id})),S=at(at({},gw),p);S.sync&&x.onTransition(function(o){_.send(tv,{state:o,id:x.id})});var z=x;return this.children.set(x.id,z),S.autoForward&&this.forwardTo.add(x.id),x.onDone(function(o){_.removeChild(x.id),_.send(Rr(o,{origin:x.id}))}).start(),z},c.prototype.spawnBehavior=function(s,p){var _=_w(s,{id:p,parent:this});return this.children.set(p,_),_},c.prototype.spawnPromise=function(s,p){var _,x=this,S=!1,z;s.then(function(j){S||(z=j,x.removeChild(p),x.send(Rr(sd(p,j),{origin:p})))},function(j){if(!S){x.removeChild(p);var U=qc(p,j);try{x.send(Rr(U,{origin:p}))}catch{x.devTools&&x.devTools.send(U,x.state),x.machine.strict&&x.stop()}}});var o=(_={id:p,send:function(){},subscribe:function(j,U,F){var $=Ep(j,U,F),J=!1;return s.then(function(G){J||($.next(G),!J&&$.complete())},function(G){J||$.error(G)}),{unsubscribe:function(){return J=!0}}},stop:function(){S=!0},toJSON:function(){return{id:p}},getSnapshot:function(){return z}},_[xa]=function(){return this},_);return this.children.set(p,o),o},c.prototype.spawnCallback=function(s,p){var _,x=this,S=!1,z=new Set,o=new Set,j,U=function(J){j=J,o.forEach(function(G){return G(J)}),!S&&x.send(Rr(J,{origin:p}))},F;try{F=s(U,function(J){z.add(J)})}catch(J){this.send(qc(p,J))}if(Ng(F))return this.spawnPromise(F,p);var $=(_={id:p,send:function(J){return z.forEach(function(G){return G(J)})},subscribe:function(J){var G=Ep(J);return o.add(G.next),{unsubscribe:function(){o.delete(G.next)}}},stop:function(){S=!0,Mi(F)&&F()},toJSON:function(){return{id:p}},getSnapshot:function(){return j}},_[xa]=function(){return this},_);return this.children.set(p,$),$},c.prototype.spawnObservable=function(s,p){var _,x=this,S,z=s.subscribe(function(j){S=j,x.send(Rr(j,{origin:p}))},function(j){x.removeChild(p),x.send(Rr(qc(p,j),{origin:p}))},function(){x.removeChild(p),x.send(Rr(sd(p),{origin:p}))}),o=(_={id:p,send:function(){},subscribe:function(j,U,F){return s.subscribe(j,U,F)},stop:function(){return z.unsubscribe()},getSnapshot:function(){return S},toJSON:function(){return{id:p}}},_[xa]=function(){return this},_);return this.children.set(p,o),o},c.prototype.spawnActor=function(s,p){return this.children.set(p,s),s},c.prototype.spawnActivity=function(s){var p=this.machine.options&&this.machine.options.activities?this.machine.options.activities[s.type]:void 0;if(!!p){var _=p(this.state.context,s);this.spawnEffect(s.id,_)}},c.prototype.spawnEffect=function(s,p){var _;this.children.set(s,(_={id:s,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:p||void 0,getSnapshot:function(){},toJSON:function(){return{id:s}}},_[xa]=function(){return this},_))},c.prototype.attachDev=function(){var s=Kp();if(this.options.devTools&&s){if(s.__REDUX_DEVTOOLS_EXTENSION__){var p=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=s.__REDUX_DEVTOOLS_EXTENSION__.connect(at(at({name:this.id,autoPause:!0,stateSanitizer:function(_){return{value:_.value,context:_.context,actions:_.actions}}},p),{features:at({jump:!1,skip:!1},p?p.features:void 0)}),this.machine),this.devTools.init(this.state)}mw(this)}},c.prototype.toJSON=function(){return{id:this.id}},c.prototype[xa]=function(){return this},c.prototype.getSnapshot=function(){return this.status===fn.NotStarted?this.initialState:this._state},c.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(s,p){return setTimeout(s,p)},clearTimeout:function(s){return clearTimeout(s)}},logger:console.log.bind(console),devTools:!1},c.interpret=mv,c}();function mv(c,s){var p=new yw(c,s);return p}function vw(c){if(typeof c=="string"){var s={type:c};return s.toString=function(){return c},s}return c}function Gh(c){return at(at({type:wp},c),{toJSON:function(){c.onDone,c.onError;var s=Zp(c,["onDone","onError"]);return at(at({},s),{type:wp,src:vw(c.src)})}})}var El="",Mp="#",Uc="*",xl={},bl=function(c){return c[0]===Mp},xw=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},bw=function(c,s,p){var _=p.slice(0,-1).some(function(S){return!("cond"in S)&&!("in"in S)&&(bi(S.target)||ds(S.target))}),x=s===El?"the transient event":"event '".concat(s,"'");Yc(!_,"One or more transitions for ".concat(x," on state '").concat(c.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")},ww=function(){function c(s,p,_,x){var S=this;_===void 0&&(_="context"in s?s.context:void 0);var z;this.config=s,this._context=_,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(xw(),p),this.parent=x==null?void 0:x.parent,this.key=this.config.key||(x==null?void 0:x.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:iv),this.id=this.config.id||er([this.machine.key],Ti(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(z=this.config.schema)!==null&&z!==void 0?z:{},this.description=this.config.description,this.initial=this.config.initial,this.states=this.config.states?Zc(this.config.states,function(U,F){var $,J=new c(U,{},void 0,{parent:S,key:F});return Object.assign(S.idMap,at(($={},$[J.id]=J,$),J.idMap)),J}):xl;var o=0;function j(U){var F,$;U.order=o++;try{for(var J=hi(Dl(U)),G=J.next();!G.done;G=J.next()){var ye=G.value;j(ye)}}catch(Te){F={error:Te}}finally{try{G&&!G.done&&($=J.return)&&$.call(J)}finally{if(F)throw F.error}}}j(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(U){var F=U.event;return F===El}):El in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=Yn(this.config.entry||this.config.onEntry).map(function(U){return cu(U)}),this.onExit=Yn(this.config.exit||this.config.onExit).map(function(U){return cu(U)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=Yn(this.config.invoke).map(function(U,F){var $,J;if(ds(U)){var G=jh(S.id,F);return S.machine.options.services=at(($={},$[G]=U,$),S.machine.options.services),Gh({src:G,id:G})}else if(bi(U.src)){var G=U.id||jh(S.id,F);return Gh(at(at({},U),{id:G,src:U.src}))}else if(ds(U.src)||Mi(U.src)){var G=U.id||jh(S.id,F);return S.machine.options.services=at((J={},J[G]=U.src,J),S.machine.options.services),Gh(at(at({id:G},U),{src:G}))}else{var ye=U.src;return Gh(at(at({id:jh(S.id,F)},U),{src:ye}))}}),this.activities=Yn(this.config.activities).concat(this.invoke).map(function(U){return Hp(U)}),this.transition=this.transition.bind(this),this.tags=Yn(this.config.tags)}return c.prototype._init=function(){this.__cache.transitions||dv(this).forEach(function(s){return s.on})},c.prototype.withConfig=function(s,p){var _=this.options,x=_.actions,S=_.activities,z=_.guards,o=_.services,j=_.delays;return new c(this.config,{actions:at(at({},x),s.actions),activities:at(at({},S),s.activities),guards:at(at({},z),s.guards),services:at(at({},o),s.services),delays:at(at({},j),s.delays)},p!=null?p:this.context)},c.prototype.withContext=function(s){return new c(this.config,this.options,s)},Object.defineProperty(c.prototype,"context",{get:function(){return Mi(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:Zc(this.states,function(s){return s.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),c.prototype.toJSON=function(){return this.definition},Object.defineProperty(c.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var s=this.transitions;return this.__cache.on=s.reduce(function(p,_){return p[_.eventType]=p[_.eventType]||[],p[_.eventType].push(_),p},{})},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),c.prototype.getCandidates=function(s){if(this.__cache.candidates[s])return this.__cache.candidates[s];var p=s===El,_=this.transitions.filter(function(x){var S=x.eventType===s;return p?S:S||x.eventType===Uc});return this.__cache.candidates[s]=_,_},c.prototype.getDelayedTransitions=function(){var s=this,p=this.config.after;if(!p)return[];var _=function(S,z){var o=Mi(S)?"".concat(s.id,":delay[").concat(z,"]"):S,j=tw(o,s.id);return s.onEntry.push(uv(j,{delay:S})),s.onExit.push(Kb(j)),j},x=Fl(p)?p.map(function(S,z){var o=_(S.delay,z);return at(at({},S),{event:o})}):Zi(Object.keys(p).map(function(S,z){var o=p[S],j=bi(o)?{target:o}:o,U=isNaN(+S)?S:+S,F=_(U,z);return Yn(j).map(function($){return at(at({},$),{event:F,delay:U})})}));return x.map(function(S){var z=S.delay;return at(at({},s.formatTransition(S)),{delay:z})})},c.prototype.getStateNodes=function(s){var p,_=this;if(!s)return[];var x=s instanceof Jn?s.value:Kc(s,this.delimiter);if(bi(x)){var S=this.getStateNode(x).initial;return S!==void 0?this.getStateNodes((p={},p[x]=S,p)):[this,this.states[x]]}var z=Object.keys(x),o=[this];return o.push.apply(o,er([],Ti(Zi(z.map(function(j){return _.getStateNode(j).getStateNodes(x[j])}))),!1)),o},c.prototype.handles=function(s){var p=rv(s);return this.events.includes(p)},c.prototype.resolveState=function(s){var p=s instanceof Jn?s:Jn.create(s),_=Array.from(Sl([],this.getStateNodes(p.value)));return new Jn(at(at({},p),{value:this.resolve(p.value),configuration:_,done:Jc(_,this),tags:Vg(_),machine:this.machine}))},c.prototype.transitionLeafNode=function(s,p,_){var x=this.getStateNode(s),S=x.next(p,_);return!S||!S.transitions.length?this.next(p,_):S},c.prototype.transitionCompoundNode=function(s,p,_){var x=Object.keys(s),S=this.getStateNode(x[0]),z=S._transition(s[x[0]],p,_);return!z||!z.transitions.length?this.next(p,_):z},c.prototype.transitionParallelNode=function(s,p,_){var x,S,z={};try{for(var o=hi(Object.keys(s)),j=o.next();!j.done;j=o.next()){var U=j.value,F=s[U];if(!!F){var $=this.getStateNode(U),J=$._transition(F,p,_);J&&(z[U]=J)}}}catch(T){x={error:T}}finally{try{j&&!j.done&&(S=o.return)&&S.call(o)}finally{if(x)throw x.error}}var G=Object.keys(z).map(function(T){return z[T]}),ye=Zi(G.map(function(T){return T.transitions})),Te=G.some(function(T){return T.transitions.length>0});if(!Te)return this.next(p,_);var Ue=Zi(G.map(function(T){return T.entrySet})),Ve=Zi(Object.keys(z).map(function(T){return z[T].configuration}));return{transitions:ye,entrySet:Ue,exitSet:Zi(G.map(function(T){return T.exitSet})),configuration:Ve,source:p,actions:Zi(Object.keys(z).map(function(T){return z[T].actions}))}},c.prototype._transition=function(s,p,_){return bi(s)?this.transitionLeafNode(s,p,_):Object.keys(s).length===1?this.transitionCompoundNode(s,p,_):this.transitionParallelNode(s,p,_)},c.prototype.getTransitionData=function(s,p){return this._transition(s.value,s,Rr(p))},c.prototype.next=function(s,p){var _,x,S=this,z=p.name,o=[],j=[],U;try{for(var F=hi(this.getCandidates(z)),$=F.next();!$.done;$=F.next()){var J=$.value,G=J.cond,ye=J.in,Te=s.context,Ue=ye?bi(ye)&&bl(ye)?s.matches(Kc(this.getStateNodeById(ye).path,this.delimiter)):Wp(Kc(ye,this.delimiter),Fb(this.path.slice(0,-2))(s.value)):!0,Ve=!1;try{Ve=!G||lv(this.machine,G,Te,p,s)}catch(qe){throw new Error("Unable to evaluate guard '".concat(G.name||G.type,"' in transition for event '").concat(z,"' in state node '").concat(this.id,`':
`).concat(qe.message))}if(Ve&&Ue){J.target!==void 0&&(j=J.target),o.push.apply(o,er([],Ti(J.actions),!1)),U=J;break}}}catch(qe){_={error:qe}}finally{try{$&&!$.done&&(x=F.return)&&x.call(F)}finally{if(_)throw _.error}}if(!!U){if(!j.length)return{transitions:[U],entrySet:[],exitSet:[],configuration:s.value?[this]:[],source:s,actions:o};var T=Zi(j.map(function(qe){return S.getRelativeStateNodes(qe,s.historyValue)})),we=!!U.internal,Le=we?[]:Zi(T.map(function(qe){return S.nodesFromChild(qe)}));return{transitions:[U],entrySet:Le,exitSet:we?[]:[this],configuration:T,source:s,actions:o}}},c.prototype.nodesFromChild=function(s){if(s.escapes(this))return[];for(var p=[],_=s;_&&_!==this;)p.push(_),_=_.parent;return p.push(this),p},c.prototype.escapes=function(s){if(this===s)return!1;for(var p=this.parent;p;){if(p===s)return!1;p=p.parent}return!0},c.prototype.getActions=function(s,p,_,x){var S,z,o,j,U=Sl([],x?this.getStateNodes(x.value):[this]),F=s.configuration.length?Sl(U,s.configuration):U;try{for(var $=hi(F),J=$.next();!J.done;J=$.next()){var G=J.value;ld(U,G)||s.entrySet.push(G)}}catch(Se){S={error:Se}}finally{try{J&&!J.done&&(z=$.return)&&z.call($)}finally{if(S)throw S.error}}try{for(var ye=hi(U),Te=ye.next();!Te.done;Te=ye.next()){var G=Te.value;(!ld(F,G)||ld(s.exitSet,G.parent))&&s.exitSet.push(G)}}catch(Se){o={error:Se}}finally{try{Te&&!Te.done&&(j=ye.return)&&j.call(ye)}finally{if(o)throw o.error}}var Ue=Zi(s.entrySet.map(function(Se){var Oe=[];if(Se.type!=="final")return Oe;var Ye=Se.parent;if(!Ye.parent)return Oe;Oe.push(Vh(Se.id,Se.doneData),Vh(Ye.id,Se.doneData?gd(Se.doneData,p,_):void 0));var rt=Ye.parent;return rt.type==="parallel"&&Dl(rt).every(function(st){return Jc(s.configuration,st)})&&Oe.push(Vh(rt.id)),Oe}));s.exitSet.sort(function(Se,Oe){return Oe.order-Se.order}),s.entrySet.sort(function(Se,Oe){return Se.order-Oe.order});var Ve=new Set(s.entrySet),T=new Set(s.exitSet),we=Ti([Zi(Array.from(Ve).map(function(Se){return er(er([],Ti(Se.activities.map(function(Oe){return Yb(Oe)})),!1),Ti(Se.onEntry),!1)})).concat(Ue.map(qb)),Zi(Array.from(T).map(function(Se){return er(er([],Ti(Se.onExit),!1),Ti(Se.activities.map(function(Oe){return Jb(Oe)})),!1)}))],2),Le=we[0],qe=we[1],xe=vd(qe.concat(s.actions).concat(Le),this.machine.options.actions);return xe},c.prototype.transition=function(s,p,_){s===void 0&&(s=this.initialState);var x=Rr(p),S;if(s instanceof Jn)S=_===void 0?s:this.resolveState(Jn.from(s,_));else{var z=bi(s)?this.resolve(_d(this.getResolvedPath(s))):this.resolve(s),o=_!=null?_:this.machine.context;S=this.resolveState(Jn.from(z,o))}if(!Fc&&x.name===Uc)throw new Error("An event cannot have the wildcard type ('".concat(Uc,"')"));if(this.strict&&!this.events.includes(x.name)&&!Nb(x.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(x.name,"'"));var j=this._transition(S.value,S,x)||{transitions:[],configuration:[],entrySet:[],exitSet:[],source:S,actions:[]},U=Sl([],this.getStateNodes(S.value)),F=j.configuration.length?Sl(U,j.configuration):U;return j.configuration=er([],Ti(F),!1),this.resolveTransition(j,S,S.context,x)},c.prototype.resolveRaisedTransition=function(s,p,_){var x,S=s.actions;return s=this.transition(s,p),s._event=_,s.event=_.data,(x=s.actions).unshift.apply(x,er([],Ti(S),!1)),s},c.prototype.resolveTransition=function(s,p,_,x){var S,z,o=this;x===void 0&&(x=yd);var j=s.configuration,U=!p||s.transitions.length>0,F=U?sw(this.machine,j):void 0,$=p?p.historyValue?p.historyValue:s.source?this.machine.historyValue(p.value):void 0:void 0,J=this.getActions(s,_,x,p),G=p?at({},p.activities):{};try{for(var ye=hi(J),Te=ye.next();!Te.done;Te=ye.next()){var Ue=Te.value;Ue.type===xp?G[Ue.activity.id||Ue.activity.type]=Ue:Ue.type===qp&&(G[Ue.activity.id||Ue.activity.type]=!1)}}catch(Ct){S={error:Ct}}finally{try{Te&&!Te.done&&(z=ye.return)&&z.call(ye)}finally{if(S)throw S.error}}var Ve=Ti(Cp(this,p,_,x,J,this.machine.config.preserveActionOrder),2),T=Ve[0],we=Ve[1],Le=Ti(ov(T,function(Ct){return Ct.type===Md||Ct.type===kd&&Ct.to===lu.Internal}),2),qe=Le[0],xe=Le[1],Se=T.filter(function(Ct){var fi;return Ct.type===xp&&((fi=Ct.activity)===null||fi===void 0?void 0:fi.type)===wp}),Oe=Se.reduce(function(Ct,fi){return Ct[fi.activity.id]=iw(fi.activity,o.machine,we,x),Ct},p?at({},p.children):{}),Ye=U?s.configuration:p?p.configuration:[],rt=Jc(Ye,this),st=new Jn({value:F||p.value,context:we,_event:x,_sessionid:p?p._sessionid:null,historyValue:F?$?Vb($,F):void 0:p?p.historyValue:void 0,history:!F||s.source?p:void 0,actions:F?xe:[],activities:F?G:p?p.activities:{},events:[],configuration:Ye,transitions:s.transitions,children:Oe,done:rt,tags:p==null?void 0:p.tags,machine:this}),wt=_!==we;st.changed=x.name===tv||wt;var di=st.history;di&&delete di.history;var Si=!rt&&(this._transient||j.some(function(Ct){return Ct._transient}));if(!U&&(!Si||x.name===El))return st;var Nt=st;if(!rt)for(Si&&(Nt=this.resolveRaisedTransition(Nt,{type:zb},x));qe.length;){var Ni=qe.shift();Nt=this.resolveRaisedTransition(Nt,Ni._event,x)}var qt=Nt.changed||(di?!!Nt.actions.length||wt||typeof di.value!=typeof Nt.value||!pv(Nt.value,di.value):void 0);return Nt.changed=qt,Nt.history=di,Nt.tags=Vg(Nt.configuration),Nt},c.prototype.getStateNode=function(s){if(bl(s))return this.machine.getStateNodeById(s);if(!this.states)throw new Error("Unable to retrieve child state '".concat(s,"' from '").concat(this.id,"'; no child states exist."));var p=this.states[s];if(!p)throw new Error("Child state '".concat(s,"' does not exist on '").concat(this.id,"'"));return p},c.prototype.getStateNodeById=function(s){var p=bl(s)?s.slice(Mp.length):s;if(p===this.id)return this;var _=this.machine.idMap[p];if(!_)throw new Error("Child state node '#".concat(p,"' does not exist on machine '").concat(this.id,"'"));return _},c.prototype.getStateNodeByPath=function(s){if(typeof s=="string"&&bl(s))try{return this.getStateNodeById(s.slice(1))}catch{}for(var p=Sp(s,this.delimiter).slice(),_=this;p.length;){var x=p.shift();if(!x.length)break;_=_.getStateNode(x)}return _},c.prototype.resolve=function(s){var p,_=this;if(!s)return this.initialStateValue||xl;switch(this.type){case"parallel":return Zc(this.initialStateValue,function(S,z){return S?_.getStateNode(z).resolve(s[z]||S):xl});case"compound":if(bi(s)){var x=this.getStateNode(s);return x.type==="parallel"||x.type==="compound"?(p={},p[s]=x.initialStateValue,p):s}return Object.keys(s).length?Zc(s,function(S,z){return S?_.getStateNode(z).resolve(S):xl}):this.initialStateValue||{};default:return s||xl}},c.prototype.getResolvedPath=function(s){if(bl(s)){var p=this.machine.idMap[s.slice(Mp.length)];if(!p)throw new Error("Unable to find state node '".concat(s,"'"));return p.path}return Sp(s,this.delimiter)},Object.defineProperty(c.prototype,"initialStateValue",{get:function(){var s;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var p;if(this.type==="parallel")p=Ug(this.states,function(_){return _.initialStateValue||xl},function(_){return _.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));p=xd(this.states[this.initial])?this.initial:(s={},s[this.initial]=this.states[this.initial].initialStateValue,s)}else p={};return this.__cache.initialStateValue=p,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),c.prototype.getInitialState=function(s,p){this._init();var _=this.getStateNodes(s);return this.resolveTransition({configuration:_,entrySet:_,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,p!=null?p:this.machine.context,void 0)},Object.defineProperty(c.prototype,"initialState",{get:function(){var s=this.initialStateValue;if(!s)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(s)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"target",{get:function(){var s;if(this.type==="history"){var p=this.config;bi(p.target)?s=bl(p.target)?_d(this.machine.getStateNodeById(p.target).path.slice(this.path.length-1)):p.target:s=p.target}return s},enumerable:!1,configurable:!0}),c.prototype.getRelativeStateNodes=function(s,p,_){return _===void 0&&(_=!0),_?s.type==="history"?s.resolveHistory(p):s.initialStateNodes:[s]},Object.defineProperty(c.prototype,"initialStateNodes",{get:function(){var s=this;if(xd(this))return[this];if(this.type==="compound"&&!this.initial)return Fc||Yc(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this];var p=ad(this.initialStateValue);return Zi(p.map(function(_){return s.getFromRelativePath(_)}))},enumerable:!1,configurable:!0}),c.prototype.getFromRelativePath=function(s){if(!s.length)return[this];var p=Ti(s),_=p[0],x=p.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(_,"' from node with no states"));var S=this.getStateNode(_);if(S.type==="history")return S.resolveHistory();if(!this.states[_])throw new Error("Child state '".concat(_,"' does not exist on '").concat(this.id,"'"));return this.states[_].getFromRelativePath(x)},c.prototype.historyValue=function(s){if(!!Object.keys(this.states).length)return{current:s||this.initialStateValue,states:Ug(this.states,function(p,_){if(!s)return p.historyValue();var x=bi(s)?void 0:s[_];return p.historyValue(x||p.initialStateValue)},function(p){return!p.history})}},c.prototype.resolveHistory=function(s){var p=this;if(this.type!=="history")return[this];var _=this.parent;if(!s){var x=this.target;return x?Zi(ad(x).map(function(z){return _.getFromRelativePath(z)})):_.initialStateNodes}var S=Ub(_.path,"states")(s).current;return bi(S)?[_.getStateNode(S)]:Zi(ad(S).map(function(z){return p.history==="deep"?_.getFromRelativePath(z):[_.states[z[0]]]}))},Object.defineProperty(c.prototype,"stateIds",{get:function(){var s=this,p=Zi(Object.keys(this.states).map(function(_){return s.states[_].stateIds}));return[this.id].concat(p)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"events",{get:function(){var s,p,_,x;if(this.__cache.events)return this.__cache.events;var S=this.states,z=new Set(this.ownEvents);if(S)try{for(var o=hi(Object.keys(S)),j=o.next();!j.done;j=o.next()){var U=j.value,F=S[U];if(F.states)try{for(var $=(_=void 0,hi(F.events)),J=$.next();!J.done;J=$.next()){var G=J.value;z.add("".concat(G))}}catch(ye){_={error:ye}}finally{try{J&&!J.done&&(x=$.return)&&x.call($)}finally{if(_)throw _.error}}}}catch(ye){s={error:ye}}finally{try{j&&!j.done&&(p=o.return)&&p.call(o)}finally{if(s)throw s.error}}return this.__cache.events=Array.from(z)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"ownEvents",{get:function(){var s=new Set(this.transitions.filter(function(p){return!(!p.target&&!p.actions.length&&p.internal)}).map(function(p){return p.eventType}));return Array.from(s)},enumerable:!1,configurable:!0}),c.prototype.resolveTarget=function(s){var p=this;if(s!==void 0)return s.map(function(_){if(!bi(_))return _;var x=_[0]===p.delimiter;if(x&&!p.parent)return p.getStateNodeByPath(_.slice(1));var S=x?p.key+_:_;if(p.parent)try{var z=p.parent.getStateNodeByPath(S);return z}catch(o){throw new Error("Invalid transition definition for state node '".concat(p.id,`':
`).concat(o.message))}else return p.getStateNodeByPath(S)})},c.prototype.formatTransition=function(s){var p=this,_=Zb(s.target),x="internal"in s?s.internal:_?_.some(function(j){return bi(j)&&j[0]===p.delimiter}):!0,S=this.machine.options.guards,z=this.resolveTarget(_),o=at(at({},s),{actions:vd(Yn(s.actions)),cond:sv(s.cond,S),target:z,source:this,internal:x,eventType:s.event,toJSON:function(){return at(at({},o),{target:o.target?o.target.map(function(j){return"#".concat(j.id)}):void 0,source:"#".concat(p.id)})}});return o},c.prototype.formatTransitions=function(){var s,p,_=this,x;if(!this.config.on)x=[];else if(Array.isArray(this.config.on))x=this.config.on;else{var S=this.config.on,z=Uc,o=S[z],j=o===void 0?[]:o,U=Zp(S,[typeof z=="symbol"?z:z+""]);x=Zi(Object.keys(U).map(function(T){!Fc&&T===El&&Yc(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(_.id,'".'));var we=vl(T,U[T]);return Fc||bw(_,T,we),we}).concat(vl(Uc,j)))}var F=this.config.always?vl("",this.config.always):[],$=this.config.onDone?vl(String(Vh(this.id)),this.config.onDone):[];Fc||Yc(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var J=Zi(this.invoke.map(function(T){var we=[];return T.onDone&&we.push.apply(we,er([],Ti(vl(String(sd(T.id)),T.onDone)),!1)),T.onError&&we.push.apply(we,er([],Ti(vl(String(qc(T.id)),T.onError)),!1)),we})),G=this.after,ye=Zi(er(er(er(er([],Ti($),!1),Ti(J),!1),Ti(x),!1),Ti(F),!1).map(function(T){return Yn(T).map(function(we){return _.formatTransition(we)})}));try{for(var Te=hi(G),Ue=Te.next();!Ue.done;Ue=Te.next()){var Ve=Ue.value;ye.push(Ve)}}catch(T){s={error:T}}finally{try{Ue&&!Ue.done&&(p=Te.return)&&p.call(Te)}finally{if(s)throw s.error}}return ye},c}();function Tw(c,s,p){return p===void 0&&(p=c.context),new ww(c,s,p)}var Sw=ew,kp;(function(c){c[c.Effect=1]="Effect",c[c.LayoutEffect=2]="LayoutEffect"})(kp||(kp={}));var Qc=fs;function Gg(c){var s=Et();return s.current||(s.current={v:c()}),s.current.v}var Ew=globalThis&&globalThis.__read||function(c,s){var p=typeof Symbol=="function"&&c[Symbol.iterator];if(!p)return c;var _=p.call(c),x,S=[],z;try{for(;(s===void 0||s-- >0)&&!(x=_.next()).done;)S.push(x.value)}catch(o){z={error:o}}finally{try{x&&!x.done&&(p=_.return)&&p.call(_)}finally{if(z)throw z.error}}return S},Aw=globalThis&&globalThis.__values||function(c){var s=typeof Symbol=="function"&&Symbol.iterator,p=s&&c[s],_=0;if(p)return p.call(c);if(c&&typeof c.length=="number")return{next:function(){return c&&_>=c.length&&(c=void 0),{value:c&&c[_++],done:!c}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};function Cw(c,s){var p,_,x=Ew([[],[]],2),S=x[0],z=x[1];try{for(var o=Aw(c),j=o.next();!j.done;j=o.next()){var U=j.value;s(U)?S.push(U):z.push(U)}}catch(F){p={error:F}}finally{try{j&&!j.done&&(_=o.return)&&_.call(o)}finally{if(p)throw p.error}}return[S,z]}var Nc=globalThis&&globalThis.__read||function(c,s){var p=typeof Symbol=="function"&&c[Symbol.iterator];if(!p)return c;var _=p.call(c),x,S=[],z;try{for(;(s===void 0||s-- >0)&&!(x=_.next()).done;)S.push(x.value)}catch(o){z={error:o}}finally{try{x&&!x.done&&(p=_.return)&&p.call(_)}finally{if(z)throw z.error}}return S},Zg=globalThis&&globalThis.__spreadArray||function(c,s,p){if(p||arguments.length===2)for(var _=0,x=s.length,S;_<x;_++)(S||!(_ in s))&&(S||(S=Array.prototype.slice.call(s,0,_)),S[_]=s[_]);return c.concat(S||Array.prototype.slice.call(s))};function qg(c,s){var p=c.exec,_=p(s.context,s._event.data,{action:c,state:s,_event:s._event});_()}function Iw(c){var s=Et([]),p=Et([]);Qc(function(){var _=c.subscribe(function(x){var S,z;if(x.actions.length){var o=x.actions.filter(function($){return typeof $.exec=="function"&&"__effect"in $.exec}),j=Nc(Cw(o,function($){return $.exec.__effect===kp.Effect}),2),U=j[0],F=j[1];(S=s.current).push.apply(S,Zg([],Nc(U.map(function($){return[$,x]})),!1)),(z=p.current).push.apply(z,Zg([],Nc(F.map(function($){return[$,x]})),!1))}});return function(){_.unsubscribe()}},[]),Qc(function(){for(;p.current.length;){var _=Nc(p.current.shift(),2),x=_[0],S=_[1];qg(x,S)}}),si(function(){for(;s.current.length;){var _=Nc(s.current.shift(),2),x=_[0],S=_[1];qg(x,S)}})}var eu=globalThis&&globalThis.__assign||function(){return eu=Object.assign||function(c){for(var s,p=1,_=arguments.length;p<_;p++){s=arguments[p];for(var x in s)Object.prototype.hasOwnProperty.call(s,x)&&(c[x]=s[x])}return c},eu.apply(this,arguments)},Mw=globalThis&&globalThis.__rest||function(c,s){var p={};for(var _ in c)Object.prototype.hasOwnProperty.call(c,_)&&s.indexOf(_)<0&&(p[_]=c[_]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function")for(var x=0,_=Object.getOwnPropertySymbols(c);x<_.length;x++)s.indexOf(_[x])<0&&Object.prototype.propertyIsEnumerable.call(c,_[x])&&(p[_[x]]=c[_[x]]);return p};globalThis&&globalThis.__read;function kw(c,s,p){if(typeof c=="object")return c;var _=function(){};return{next:c,error:s||_,complete:p||_}}function zw(c,s,p){s===void 0&&(s={});var _=Gg(function(){return typeof c=="function"?c():c}),x=s.context,S=s.guards,z=s.actions,o=s.activities,j=s.services,U=s.delays,F=s.state,$=Mw(s,["context","guards","actions","activities","services","delays","state"]),J=Gg(function(){var G={context:x,guards:S,actions:z,activities:o,services:j,delays:U},ye=_.withConfig(G,function(){return eu(eu({},_.context),x)});return mv(ye,eu({deferEvents:!0},$))});return Qc(function(){var G;return p&&(G=J.subscribe(kw(p))),function(){G==null||G.unsubscribe()}},[p]),Qc(function(){return J.start(F?Jn.create(F):void 0),function(){J.stop()}},[]),Qc(function(){Object.assign(J.machine.options.actions,z),Object.assign(J.machine.options.guards,S),Object.assign(J.machine.options.activities,o),Object.assign(J.machine.options.services,j),Object.assign(J.machine.options.delays,U)},[z,S,o,j,U]),Iw(J),J}var Pw=globalThis&&globalThis.__read||function(c,s){var p=typeof Symbol=="function"&&c[Symbol.iterator];if(!p)return c;var _=p.call(c),x,S=[],z;try{for(;(s===void 0||s-- >0)&&!(x=_.next()).done;)S.push(x.value)}catch(o){z={error:o}}finally{try{x&&!x.done&&(p=_.return)&&p.call(_)}finally{if(z)throw z.error}}return S};globalThis&&globalThis.__spreadArray;function Dw(c,s){s===void 0&&(s={});var p=ui(function(o){var j=o.changed===void 0&&Object.keys(o.children).length;(o.changed||j)&&z(o)},[]),_=zw(c,s,p),x=Pw(mn(function(){var o=_.machine.initialState;return s.state?Jn.create(s.state):o}),2),S=x[0],z=x[1];return[S,_.send,_]}function tr(){return tr=Object.assign||function(c){for(var s=1;s<arguments.length;s++){var p=arguments[s];for(var _ in p)Object.prototype.hasOwnProperty.call(p,_)&&(c[_]=p[_])}return c},tr.apply(this,arguments)}function Cl(c,s){if(c==null)return{};var p={},_=Object.keys(c),x,S;for(S=0;S<_.length;S++)x=_[S],!(s.indexOf(x)>=0)&&(p[x]=c[x]);return p}const Kt={arr:Array.isArray,obj:c=>Object.prototype.toString.call(c)==="[object Object]",fun:c=>typeof c=="function",str:c=>typeof c=="string",num:c=>typeof c=="number",und:c=>c===void 0,nul:c=>c===null,set:c=>c instanceof Set,map:c=>c instanceof Map,equ(c,s){if(typeof c!=typeof s)return!1;if(Kt.str(c)||Kt.num(c))return c===s;if(Kt.obj(c)&&Kt.obj(s)&&Object.keys(c).length+Object.keys(s).length===0)return!0;let p;for(p in c)if(!(p in s))return!1;for(p in s)if(c[p]!==s[p])return!1;return Kt.und(p)?c===s:!0}};function Lw(c,s){return s===void 0&&(s=!0),p=>(Kt.arr(p)?p:Object.keys(p)).reduce((_,x)=>{const S=s?x[0].toLowerCase()+x.substring(1):x;return _[S]=c(S),_},c)}function Rw(){const c=mn(!1),s=c[1];return ui(()=>s(_=>!_),[])}function ss(c,s){return Kt.und(c)||Kt.nul(c)?s:c}function Zh(c){return Kt.und(c)?[]:Kt.arr(c)?c:[c]}function Al(c){for(var s=arguments.length,p=new Array(s>1?s-1:0),_=1;_<s;_++)p[_-1]=arguments[_];return Kt.fun(c)?c(...p):c}function Bw(c){return c.to,c.from,c.config,c.onStart,c.onRest,c.onFrame,c.children,c.reset,c.reverse,c.force,c.immediate,c.delay,c.attach,c.destroyed,c.interpolateTo,c.ref,c.lazy,Cl(c,["to","from","config","onStart","onRest","onFrame","children","reset","reverse","force","immediate","delay","attach","destroyed","interpolateTo","ref","lazy"])}function ap(c){const s=Bw(c);if(Kt.und(s))return tr({to:s},c);const p=Object.keys(c).reduce((_,x)=>Kt.und(s[x])?tr({},_,{[x]:c[x]}):_,{});return tr({to:s},p)}function Ow(c,s){return s&&(Kt.fun(s)?s(c):Kt.obj(s)&&(s.current=c)),c}class Qn{constructor(){this.payload=void 0,this.children=[]}getAnimatedValue(){return this.getValue()}getPayload(){return this.payload||this}attach(){}detach(){}getChildren(){return this.children}addChild(s){this.children.length===0&&this.attach(),this.children.push(s)}removeChild(s){const p=this.children.indexOf(s);this.children.splice(p,1),this.children.length===0&&this.detach()}}class zp extends Qn{constructor(){super(...arguments);this.payload=[],this.attach=()=>this.payload.forEach(s=>s instanceof Qn&&s.addChild(this)),this.detach=()=>this.payload.forEach(s=>s instanceof Qn&&s.removeChild(this))}}class _v extends Qn{constructor(){super(...arguments);this.payload={},this.attach=()=>Object.values(this.payload).forEach(s=>s instanceof Qn&&s.addChild(this)),this.detach=()=>Object.values(this.payload).forEach(s=>s instanceof Qn&&s.removeChild(this))}getValue(s){s===void 0&&(s=!1);const p={};for(const _ in this.payload){const x=this.payload[_];s&&!(x instanceof Qn)||(p[_]=x instanceof Qn?x[s?"getAnimatedValue":"getValue"]():x)}return p}getAnimatedValue(){return this.getValue(!0)}}let Yp;function Fw(c,s){Yp={fn:c,transform:s}}let gv;function Uw(c){gv=c}let yv=c=>typeof window!="undefined"?window.requestAnimationFrame(c):-1,bd;function Nw(c){bd=c}let vv=()=>Date.now(),jw=c=>c.current,xv;function Vw(c){xv=c}class $w extends _v{constructor(s,p){super();this.update=void 0,this.payload=s.style?tr({},s,{style:xv(s.style)}):s,this.update=p,this.attach()}}const Gw=c=>Kt.fun(c)&&!(c.prototype instanceof pn.Component),Zw=c=>pu((p,_)=>{const x=Rw(),S=Et(!0),z=Et(null),o=Et(null),j=ui(J=>{const G=z.current,ye=()=>{let Te=!1;o.current&&(Te=Yp.fn(o.current,z.current.getAnimatedValue())),(!o.current||Te===!1)&&x()};z.current=new $w(J,ye),G&&G.detach()},[]);si(()=>()=>{S.current=!1,z.current&&z.current.detach()},[]),Bl(_,()=>jw(o)),j(p);const U=z.current.getValue();U.scrollTop,U.scrollLeft;const F=Cl(U,["scrollTop","scrollLeft"]),$=Gw(c)?void 0:J=>o.current=Ow(J,_);return pn.createElement(c,tr({},F,{ref:$}))});let tu=!1;const cs=new Set,bv=()=>{if(!tu)return!1;let c=vv();for(let s of cs){let p=!1;for(let _=0;_<s.configs.length;_++){let x=s.configs[_],S,z;for(let o=0;o<x.animatedValues.length;o++){let j=x.animatedValues[o];if(j.done)continue;let U=x.fromValues[o],F=x.toValues[o],$=j.lastPosition,J=F instanceof Qn,G=Array.isArray(x.initialVelocity)?x.initialVelocity[o]:x.initialVelocity;if(J&&(F=F.getValue()),x.immediate){j.setValue(F),j.done=!0;continue}if(typeof U=="string"||typeof F=="string"){j.setValue(F),j.done=!0;continue}if(x.duration!==void 0)$=U+x.easing((c-j.startTime)/x.duration)*(F-U),S=c>=j.startTime+x.duration;else if(x.decay)$=U+G/(1-.998)*(1-Math.exp(-(1-.998)*(c-j.startTime))),S=Math.abs(j.lastPosition-$)<.1,S&&(F=$);else{z=j.lastTime!==void 0?j.lastTime:c,G=j.lastVelocity!==void 0?j.lastVelocity:x.initialVelocity,c>z+64&&(z=c);let ye=Math.floor(c-z);for(let T=0;T<ye;++T){let we=-x.tension*($-F),Le=-x.friction*G,qe=(we+Le)/x.mass;G=G+qe*1/1e3,$=$+G*1/1e3}let Te=x.clamp&&x.tension!==0?U<F?$>F:$<F:!1,Ue=Math.abs(G)<=x.precision,Ve=x.tension!==0?Math.abs(F-$)<=x.precision:!0;S=Te||Ue&&Ve,j.lastVelocity=G,j.lastTime=c}J&&!x.toValues[o].done&&(S=!1),S?(j.value!==F&&($=F),j.done=!0):p=!0,j.setValue($),j.lastPosition=$}s.props.onFrame&&(s.values[x.name]=x.interpolation.getValue())}s.props.onFrame&&s.props.onFrame(s.values),p||(cs.delete(s),s.stop(!0))}return cs.size?yv(bv):tu=!1,tu},qw=c=>{cs.has(c)||cs.add(c),tu||(tu=!0,yv(bv))},Ww=c=>{cs.has(c)&&cs.delete(c)};function wd(c,s,p){if(typeof c=="function")return c;if(Array.isArray(c))return wd({range:c,output:s,extrapolate:p});if(bd&&typeof c.output[0]=="string")return bd(c);const _=c,x=_.output,S=_.range||[0,1],z=_.extrapolateLeft||_.extrapolate||"extend",o=_.extrapolateRight||_.extrapolate||"extend",j=_.easing||(U=>U);return U=>{const F=Hw(U,S);return Xw(U,S[F],S[F+1],x[F],x[F+1],j,z,o,_.map)}}function Xw(c,s,p,_,x,S,z,o,j){let U=j?j(c):c;if(U<s){if(z==="identity")return U;z==="clamp"&&(U=s)}if(U>p){if(o==="identity")return U;o==="clamp"&&(U=p)}return _===x?_:s===p?c<=s?_:x:(s===-1/0?U=-U:p===1/0?U=U-s:U=(U-s)/(p-s),U=S(U),_===-1/0?U=-U:x===1/0?U=U+_:U=U*(x-_)+_,U)}function Hw(c,s){for(var p=1;p<s.length-1&&!(s[p]>=c);++p);return p-1}class Ll extends zp{constructor(s,p,_,x){super();this.calc=void 0,this.payload=s instanceof zp&&!(s instanceof Ll)?s.getPayload():Array.isArray(s)?s:[s],this.calc=wd(p,_,x)}getValue(){return this.calc(...this.payload.map(s=>s.getValue()))}updateConfig(s,p,_){this.calc=wd(s,p,_)}interpolate(s,p,_){return new Ll(this,s,p,_)}}const wl=(c,s,p)=>c&&new Ll(c,s,p),Kw={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}};function wv(c,s){"update"in c?s.add(c):c.getChildren().forEach(p=>wv(p,s))}class Pp extends Qn{constructor(s){var p;super();p=this,this.animatedStyles=new Set,this.value=void 0,this.startPosition=void 0,this.lastPosition=void 0,this.lastVelocity=void 0,this.startTime=void 0,this.lastTime=void 0,this.done=!1,this.setValue=function(_,x){x===void 0&&(x=!0),p.value=_,x&&p.flush()},this.value=s,this.startPosition=s,this.lastPosition=s}flush(){this.animatedStyles.size===0&&wv(this,this.animatedStyles),this.animatedStyles.forEach(s=>s.update())}clearStyles(){this.animatedStyles.clear()}getValue(){return this.value}interpolate(s,p,_){return new Ll(this,s,p,_)}}class Yw extends zp{constructor(s){super();this.payload=s.map(p=>new Pp(p))}setValue(s,p){p===void 0&&(p=!0),Array.isArray(s)?s.length===this.payload.length&&s.forEach((_,x)=>this.payload[x].setValue(_,p)):this.payload.forEach(_=>_.setValue(s,p))}getValue(){return this.payload.map(s=>s.getValue())}interpolate(s,p){return new Ll(this,s,p)}}let Jw=0;class Qw{constructor(){this.id=void 0,this.idle=!0,this.hasChanged=!1,this.guid=0,this.local=0,this.props={},this.merged={},this.animations={},this.interpolations={},this.values={},this.configs=[],this.listeners=[],this.queue=[],this.localQueue=void 0,this.getValues=()=>this.interpolations,this.id=Jw++}update(s){if(!s)return this;const p=ap(s),_=p.delay,x=_===void 0?0:_,S=p.to,z=Cl(p,["delay","to"]);if(Kt.arr(S)||Kt.fun(S))this.queue.push(tr({},z,{delay:x,to:S}));else if(S){let o={};Object.entries(S).forEach(j=>{let U=j[0],F=j[1];const $=tr({to:{[U]:F},delay:Al(x,U)},z),J=o[$.delay]&&o[$.delay].to;o[$.delay]=tr({},o[$.delay],$,{to:tr({},J,$.to)})}),this.queue=Object.values(o)}return this.queue=this.queue.sort((o,j)=>o.delay-j.delay),this.diff(z),this}start(s){if(this.queue.length){this.idle=!1,this.localQueue&&this.localQueue.forEach(x=>{let S=x.from,z=S===void 0?{}:S,o=x.to,j=o===void 0?{}:o;Kt.obj(z)&&(this.merged=tr({},z,this.merged)),Kt.obj(j)&&(this.merged=tr({},this.merged,j))});const p=this.local=++this.guid,_=this.localQueue=this.queue;this.queue=[],_.forEach((x,S)=>{let z=x.delay,o=Cl(x,["delay"]);const j=F=>{S===_.length-1&&p===this.guid&&F&&(this.idle=!0,this.props.onRest&&this.props.onRest(this.merged)),s&&s()};let U=Kt.arr(o.to)||Kt.fun(o.to);z?setTimeout(()=>{p===this.guid&&(U?this.runAsync(o,j):this.diff(o).start(j))},z):U?this.runAsync(o,j):this.diff(o).start(j)})}else Kt.fun(s)&&this.listeners.push(s),this.props.onStart&&this.props.onStart(),qw(this);return this}stop(s){return this.listeners.forEach(p=>p(s)),this.listeners=[],this}pause(s){return this.stop(!0),s&&Ww(this),this}runAsync(s,p){var _=this;s.delay;let x=Cl(s,["delay"]);const S=this.local;let z=Promise.resolve(void 0);if(Kt.arr(x.to))for(let o=0;o<x.to.length;o++){const j=o,U=tr({},x,ap(x.to[j]));Kt.arr(U.config)&&(U.config=U.config[j]),z=z.then(()=>{if(S===this.guid)return new Promise(F=>this.diff(U).start(F))})}else if(Kt.fun(x.to)){let o=0,j;z=z.then(()=>x.to(U=>{const F=tr({},x,ap(U));if(Kt.arr(F.config)&&(F.config=F.config[o]),o++,S===this.guid)return j=new Promise($=>this.diff(F).start($))},function(U){return U===void 0&&(U=!0),_.stop(U)}).then(()=>j))}z.then(p)}diff(s){this.props=tr({},this.props,s);let p=this.props,_=p.from,x=_===void 0?{}:_,S=p.to,z=S===void 0?{}:S,o=p.config,j=o===void 0?{}:o,U=p.reverse,F=p.attach,$=p.reset,J=p.immediate;if(U){var G=[z,x];x=G[0],z=G[1]}this.merged=tr({},x,this.merged,z),this.hasChanged=!1;let ye=F&&F(this);if(this.animations=Object.entries(this.merged).reduce((Te,Ue)=>{let Ve=Ue[0],T=Ue[1],we=Te[Ve]||{};const Le=Kt.num(T),qe=Kt.str(T)&&!T.startsWith("#")&&!/\d/.test(T)&&!gv[T],xe=Kt.arr(T),Se=!Le&&!xe&&!qe;let Oe=Kt.und(x[Ve])?T:x[Ve],Ye=Le||xe||qe?T:1,rt=Al(j,Ve);ye&&(Ye=ye.animations[Ve].parent);let st=we.parent,wt=we.interpolation,di=Zh(ye?Ye.getPayload():Ye),Si,Nt=T;Se&&(Nt=bd({range:[0,1],output:[T,T]})(1));let Ni=wt&&wt.getValue();const Ct=!Kt.und(st)&&we.animatedValues.some(pi=>!pi.done),fi=!Kt.equ(Nt,Ni),Li=!Kt.equ(Nt,we.previous),Tt=!Kt.equ(rt,we.config);if($||Li&&fi||Tt){if(Le||qe)st=wt=we.parent||new Pp(Oe);else if(xe)st=wt=we.parent||new Yw(Oe);else if(Se){let pi=we.interpolation&&we.interpolation.calc(we.parent.value);pi=pi!==void 0&&!$?pi:Oe,we.parent?(st=we.parent,st.setValue(0,!1)):st=new Pp(0);const Br={output:[pi,T]};we.interpolation?(wt=we.interpolation,we.interpolation.updateConfig(Br)):wt=st.interpolate(Br)}return di=Zh(ye?Ye.getPayload():Ye),Si=Zh(st.getPayload()),$&&!Se&&st.setValue(Oe,!1),this.hasChanged=!0,Si.forEach(pi=>{pi.startPosition=pi.value,pi.lastPosition=pi.value,pi.lastVelocity=Ct?pi.lastVelocity:void 0,pi.lastTime=Ct?pi.lastTime:void 0,pi.startTime=vv(),pi.done=!1,pi.animatedStyles.clear()}),Al(J,Ve)&&st.setValue(Se?Ye:T,!1),tr({},Te,{[Ve]:tr({},we,{name:Ve,parent:st,interpolation:wt,animatedValues:Si,toValues:di,previous:Nt,config:rt,fromValues:Zh(st.getValue()),immediate:Al(J,Ve),initialVelocity:ss(rt.velocity,0),clamp:ss(rt.clamp,!1),precision:ss(rt.precision,.01),tension:ss(rt.tension,170),friction:ss(rt.friction,26),mass:ss(rt.mass,1),duration:rt.duration,easing:ss(rt.easing,pi=>pi),decay:rt.decay})})}else return fi?Te:(Se&&(st.setValue(1,!1),wt.updateConfig({output:[Nt,Nt]})),st.done=!0,this.hasChanged=!0,tr({},Te,{[Ve]:tr({},Te[Ve],{previous:Nt})}))},this.animations),this.hasChanged){this.configs=Object.values(this.animations),this.values={},this.interpolations={};for(let Te in this.animations)this.interpolations[Te]=this.animations[Te].interpolation,this.values[Te]=this.animations[Te].interpolation.getValue()}return this}destroy(){this.stop(),this.props={},this.merged={},this.animations={},this.interpolations={},this.values={},this.configs=[],this.local=0}}const e2=(c,s)=>{const p=Et(!1),_=Et(),x=Kt.fun(s),S=Kr(()=>{_.current&&(_.current.map($=>$.destroy()),_.current=void 0);let F;return[new Array(c).fill().map(($,J)=>{const G=new Qw,ye=x?Al(s,J,G):s[J];return J===0&&(F=ye.ref),G.update(ye),F||G.start(),G}),F]},[c]),z=S[0],o=S[1];_.current=z,Bl(o,()=>({start:()=>Promise.all(_.current.map(F=>new Promise($=>F.start($)))),stop:F=>_.current.forEach($=>$.stop(F)),get controllers(){return _.current}}));const j=Kr(()=>F=>_.current.map(($,J)=>{$.update(x?Al(F,J,$):F[J]),o||$.start()}),[c]);si(()=>{p.current?x||j(s):o||_.current.forEach(F=>F.start())}),si(()=>(p.current=!0,()=>_.current.forEach(F=>F.destroy())),[]);const U=_.current.map(F=>F.getValues());return x?[U,j,F=>_.current.forEach($=>$.pause(F))]:U},t2=c=>{const s=Kt.fun(c),p=e2(1,s?c:[c]),_=p[0],x=p[1],S=p[2];return s?[_[0],x,S]:_};class i2 extends _v{constructor(s){s===void 0&&(s={});super();s.transform&&!(s.transform instanceof Qn)&&(s=Yp.transform(s)),this.payload=s}}const Td={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},eo="[-+]?\\d*\\.?\\d+",Sd=eo+"%";function zd(){for(var c=arguments.length,s=new Array(c),p=0;p<c;p++)s[p]=arguments[p];return"\\(\\s*("+s.join(")\\s*,\\s*(")+")\\s*\\)"}const r2=new RegExp("rgb"+zd(eo,eo,eo)),n2=new RegExp("rgba"+zd(eo,eo,eo,eo)),o2=new RegExp("hsl"+zd(eo,Sd,Sd)),a2=new RegExp("hsla"+zd(eo,Sd,Sd,eo)),s2=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,l2=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,c2=/^#([0-9a-fA-F]{6})$/,u2=/^#([0-9a-fA-F]{8})$/;function h2(c){let s;return typeof c=="number"?c>>>0===c&&c>=0&&c<=4294967295?c:null:(s=c2.exec(c))?parseInt(s[1]+"ff",16)>>>0:Td.hasOwnProperty(c)?Td[c]:(s=r2.exec(c))?(Tl(s[1])<<24|Tl(s[2])<<16|Tl(s[3])<<8|255)>>>0:(s=n2.exec(c))?(Tl(s[1])<<24|Tl(s[2])<<16|Tl(s[3])<<8|Hg(s[4]))>>>0:(s=s2.exec(c))?parseInt(s[1]+s[1]+s[2]+s[2]+s[3]+s[3]+"ff",16)>>>0:(s=u2.exec(c))?parseInt(s[1],16)>>>0:(s=l2.exec(c))?parseInt(s[1]+s[1]+s[2]+s[2]+s[3]+s[3]+s[4]+s[4],16)>>>0:(s=o2.exec(c))?(Wg(Xg(s[1]),qh(s[2]),qh(s[3]))|255)>>>0:(s=a2.exec(c))?(Wg(Xg(s[1]),qh(s[2]),qh(s[3]))|Hg(s[4]))>>>0:null}function sp(c,s,p){return p<0&&(p+=1),p>1&&(p-=1),p<1/6?c+(s-c)*6*p:p<1/2?s:p<2/3?c+(s-c)*(2/3-p)*6:c}function Wg(c,s,p){const _=p<.5?p*(1+s):p+s-p*s,x=2*p-_,S=sp(x,_,c+1/3),z=sp(x,_,c),o=sp(x,_,c-1/3);return Math.round(S*255)<<24|Math.round(z*255)<<16|Math.round(o*255)<<8}function Tl(c){const s=parseInt(c,10);return s<0?0:s>255?255:s}function Xg(c){return(parseFloat(c)%360+360)%360/360}function Hg(c){const s=parseFloat(c);return s<0?0:s>1?255:Math.round(s*255)}function qh(c){const s=parseFloat(c);return s<0?0:s>100?1:s/100}function Kg(c){let s=h2(c);if(s===null)return c;s=s||0;let p=(s&4278190080)>>>24,_=(s&16711680)>>>16,x=(s&65280)>>>8,S=(s&255)/255;return`rgba(${p}, ${_}, ${x}, ${S})`}const Wh=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,d2=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,f2=new RegExp(`(${Object.keys(Td).join("|")})`,"g"),p2=c=>{const s=c.output.map(x=>x.replace(d2,Kg)).map(x=>x.replace(f2,Kg)),p=s[0].match(Wh).map(()=>[]);s.forEach(x=>{x.match(Wh).forEach((S,z)=>p[z].push(+S))});const _=s[0].match(Wh).map((x,S)=>wd(tr({},c,{output:p[S]})));return x=>{let S=0;return s[0].replace(Wh,()=>_[S++](x)).replace(/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,(z,o,j,U,F)=>`rgba(${Math.round(o)}, ${Math.round(j)}, ${Math.round(U)}, ${F})`)}};let iu={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};const m2=(c,s)=>c+s.charAt(0).toUpperCase()+s.substring(1),_2=["Webkit","Ms","Moz","O"];iu=Object.keys(iu).reduce((c,s)=>(_2.forEach(p=>c[m2(p,s)]=c[s]),c),iu);function g2(c,s,p){return s==null||typeof s=="boolean"||s===""?"":!p&&typeof s=="number"&&s!==0&&!(iu.hasOwnProperty(c)&&iu[c])?s+"px":(""+s).trim()}const Yg={};Vw(c=>new i2(c));Nw(p2);Uw(Td);Fw((c,s)=>{if(c.nodeType&&c.setAttribute!==void 0){const x=s.style,S=s.children,z=s.scrollTop,o=s.scrollLeft,j=Cl(s,["style","children","scrollTop","scrollLeft"]),U=c.nodeName==="filter"||c.parentNode&&c.parentNode.nodeName==="filter";z!==void 0&&(c.scrollTop=z),o!==void 0&&(c.scrollLeft=o),S!==void 0&&(c.textContent=S);for(let F in x)if(!!x.hasOwnProperty(F)){var p=F.indexOf("--")===0,_=g2(F,x[F],p);F==="float"&&(F="cssFloat"),p?c.style.setProperty(F,_):c.style[F]=_}for(let F in j){const $=U?F:Yg[F]||(Yg[F]=F.replace(/([A-Z])/g,J=>"-"+J.toLowerCase()));typeof c.getAttribute($)!="undefined"&&c.setAttribute($,j[F])}return}else return!1},c=>c);const y2=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],v2=Lw(Zw,!1),x2=v2(y2);function Jg(c,s){return c.map(function(p,_){return p+s[_]})}function Tv(c,s){return c.map(function(p,_){return p-s[_]})}function Dp(c){return Math.hypot.apply(Math,c)}function b2(c,s,p){var _=Dp(s),x=_===0?0:1/_,S=p===0?0:1/p,z=S*_,o=s.map(function(F){return S*F}),j=s.map(function(F){return x*F}),U=Dp(c);return{velocities:o,velocity:z,distance:U,direction:j}}function Lp(c){return Math.sign?Math.sign(c):Number(c>0)-Number(c<0)||+c}function w2(c,s,p){return Math.max(s,Math.min(c,p))}function T2(c,s){return Math.pow(c,s*5)}function Qg(c,s,p){return s===0||Math.abs(s)===1/0?T2(c,p):c*s*p/(s+p*c)}function ru(c,s,p,_){return _===void 0&&(_=.15),_===0?w2(c,s,p):c<s?-Qg(s-c,p-s,_)+s:c>p?+Qg(c-p,p-s,_)+p:c}function ey(c,s){for(var p=0;p<s.length;p++){var _=s[p];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(c,_.key,_)}}function S2(c,s,p){return s&&ey(c.prototype,s),p&&ey(c,p),c}function Xr(){return Xr=Object.assign||function(c){for(var s=1;s<arguments.length;s++){var p=arguments[s];for(var _ in p)Object.prototype.hasOwnProperty.call(p,_)&&(c[_]=p[_])}return c},Xr.apply(this,arguments)}function Sv(c,s){c.prototype=Object.create(s.prototype),c.prototype.constructor=c,c.__proto__=s}function E2(c,s){if(c==null)return{};var p={},_=Object.keys(c),x,S;for(S=0;S<_.length;S++)x=_[S],!(s.indexOf(x)>=0)&&(p[x]=c[x]);return p}function Xh(c){if(c===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return c}function A2(c,s){if(!!c){if(typeof c=="string")return ty(c,s);var p=Object.prototype.toString.call(c).slice(8,-1);if(p==="Object"&&c.constructor&&(p=c.constructor.name),p==="Map"||p==="Set")return Array.from(c);if(p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p))return ty(c,s)}}function ty(c,s){(s==null||s>c.length)&&(s=c.length);for(var p=0,_=new Array(s);p<s;p++)_[p]=c[p];return _}function Pd(c,s){var p;if(typeof Symbol=="undefined"||c[Symbol.iterator]==null){if(Array.isArray(c)||(p=A2(c))||s&&c&&typeof c.length=="number"){p&&(c=p);var _=0;return function(){return _>=c.length?{done:!0}:{done:!1,value:c[_++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return p=c[Symbol.iterator](),p.next.bind(p)}function Ev(){}function Av(){for(var c=arguments.length,s=new Array(c),p=0;p<c;p++)s[p]=arguments[p];return s.length===0?Ev:s.length===1?s[0]:function(){for(var _,x=Pd(s),S;!(S=x()).done;){var z=S.value;_=z.apply(this,arguments)||_}return _}}function ba(c,s){if(c===void 0){if(s===void 0)throw new Error("Must define fallback value if undefined is expected");c=s}return Array.isArray(c)?c:[c,c]}function Hh(c){if(typeof c=="function"){for(var s=arguments.length,p=new Array(s>1?s-1:0),_=1;_<s;_++)p[_-1]=arguments[_];return c.apply(void 0,p)}else return c}function Jp(c,s){c===void 0&&(c={});for(var p={},_=0,x=Object.entries(s);_<x.length;_++){var S=x[_],z=S[0],o=S[1];switch(typeof o){case"function":p[z]=o.call(p,c[z],z,c);break;case"object":p[z]=Jp(c[z],o);break;case"boolean":o&&(p[z]=c[z]);break}}return p}var C2=180,I2=.15,M2=.5,k2=60,z2={threshold:function(s){return s===void 0&&(s=0),ba(s)},rubberband:function(s){switch(s===void 0&&(s=0),s){case!0:return ba(I2);case!1:return ba(0);default:return ba(s)}},enabled:function(s){return s===void 0&&(s=!0),s},triggerAllEvents:function(s){return s===void 0&&(s=!1),s},initial:function(s){return s===void 0&&(s=0),typeof s=="function"?s:ba(s)}},Cv=Xr({},z2,{axis:!0,lockDirection:function(s){return s===void 0&&(s=!1),s},bounds:function(s){if(s===void 0&&(s={}),typeof s=="function")return function($){return Cv.bounds(s($))};var p=s,_=p.left,x=_===void 0?-1/0:_,S=p.right,z=S===void 0?1/0:S,o=p.top,j=o===void 0?-1/0:o,U=p.bottom,F=U===void 0?1/0:U;return[[x,z],[j,F]]}}),P2=typeof window!="undefined"&&window.document&&window.document.createElement,D2={enabled:function(s){return s===void 0&&(s=!0),s},domTarget:!0,window:function(c){function s(p){return c.apply(this,arguments)}return s.toString=function(){return c.toString()},s}(function(c){return c===void 0&&(c=P2?window:void 0),c}),eventOptions:function(s){var p=s===void 0?{}:s,_=p.passive,x=_===void 0?!0:_,S=p.capture,z=S===void 0?!1:S;return{passive:x,capture:z}}},L2=Xr({},Cv,{threshold:function(s,p,_){var x=_.filterTaps,S=x===void 0?!1:x,z=_.lockDirection,o=z===void 0?!1:z,j=_.axis,U=j===void 0?void 0:j,F=ba(s,S?3:o||U?1:0);return this.filterTaps=S||F[0]+F[1]>0,F},swipeVelocity:function(s){return s===void 0&&(s=M2),ba(s)},swipeDistance:function(s){return s===void 0&&(s=k2),ba(s)},delay:function(s){switch(s===void 0&&(s=0),s){case!0:return C2;case!1:return 0;default:return s}}});function R2(c){return c===void 0&&(c={}),Jp(c,D2)}function B2(c){return c===void 0&&(c={}),Jp(c,L2)}function O2(c){var s=c.domTarget,p=c.eventOptions,_=c.window,x=c.enabled,S=E2(c,["domTarget","eventOptions","window","enabled"]),z=R2({domTarget:s,eventOptions:p,window:_,enabled:x});return z.drag=B2(S),z}function jc(c){return Xr({_active:!1,_blocked:!1,_intentional:[!1,!1],_movement:[0,0],_initial:[0,0],_bounds:[[-1/0,1/0],[-1/0,1/0]],_lastEventType:void 0,event:void 0,intentional:!1,values:[0,0],velocities:[0,0],delta:[0,0],movement:[0,0],offset:[0,0],lastOffset:[0,0],direction:[0,0],initial:[0,0],previous:[0,0],first:!1,last:!1,active:!1,timeStamp:0,startTime:0,elapsedTime:0,cancel:Ev,canceled:!1,memo:void 0,args:void 0},c)}function Iv(){var c={hovering:!1,scrolling:!1,wheeling:!1,dragging:!1,moving:!1,pinching:!1,touches:0,buttons:0,down:!1,shiftKey:!1,altKey:!1,metaKey:!1,ctrlKey:!1},s=jc({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0,_isTap:!0,_delayedEvent:!1,_pointerId:void 0,tap:!1,swipe:[0,0]}),p=jc({da:[0,0],vdva:[0,0],origin:void 0,turns:0}),_=jc({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),x=jc({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),S=jc({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0});return{shared:c,drag:s,pinch:p,wheel:_,move:x,scroll:S}}var ls=new Map,F2=function(){function c(p,_){var x=this;_===void 0&&(_=[]),this.controller=p,this.args=_,this.debounced=!0,this.setTimeout=function(S,z){var o;z===void 0&&(z=140),clearTimeout(x.controller.timeouts[x.stateKey]);for(var j=arguments.length,U=new Array(j>2?j-2:0),F=2;F<j;F++)U[F-2]=arguments[F];x.controller.timeouts[x.stateKey]=(o=window).setTimeout.apply(o,[S,z].concat(U))},this.clearTimeout=function(){clearTimeout(x.controller.timeouts[x.stateKey])},this.fireGestureHandler=function(S){if(S===void 0&&(S=!1),x.state._blocked)return x.debounced||(x.state._active=!1,x.clean()),null;if(!S&&!x.state.intentional&&!x.config.triggerAllEvents)return null;if(x.state.intentional){var z=x.state.active,o=x.state._active;x.state.active=o,x.state.first=o&&!z,x.state.last=z&&!o,x.controller.state.shared[x.ingKey]=o}var j=Xr({},x.controller.state.shared,x.state,x.mapStateValues(x.state)),U=x.handler(j);return x.state.memo=U!==void 0?U:x.state.memo,x.state._active||x.clean(),j}}var s=c.prototype;return s.updateSharedState=function(_){Object.assign(this.controller.state.shared,_)},s.updateGestureState=function(_){Object.assign(this.state,_)},s.checkIntentionality=function(_,x){return{_intentional:_,_blocked:!1}},s.getMovement=function(_){var x=this.config,S=x.initial,z=x.bounds,o=x.rubberband,j=x.threshold,U=this.state,F=U._bounds,$=U._initial,J=U._active,G=U._intentional,ye=U.lastOffset,Te=U.movement,Ue=this.getInternalMovement(_,this.state),Ve=G[0]===!1?iy(Ue[0],j[0]):G[0],T=G[1]===!1?iy(Ue[1],j[1]):G[1],we=this.checkIntentionality([Ve,T],Ue);if(we._blocked)return Xr({},we,{_movement:Ue,delta:[0,0]});var Le=we._intentional,qe=Ue,xe,Se;if(Le[0]!==!1&&G[0]===!1&&(Se=Hh(S,this.state),xe=Hh(z,this.state),$[0]=Se[0],F[0]=xe[0]),Le[1]!==!1&&G[1]===!1){var Oe,Ye;Se=(Oe=Se)!=null?Oe:Hh(S,this.state),xe=(Ye=xe)!=null?Ye:Hh(z,this.state),$[1]=Se[1],F[1]=xe[1]}var rt=[Le[0]!==!1?Ue[0]-Le[0]:$[0],Le[1]!==!1?Ue[1]-Le[1]:$[1]],st=Jg(rt,ye),wt=J?o:[0,0];return rt=ry(F,Jg(rt,$),wt),Xr({},we,{intentional:Le[0]!==!1||Le[1]!==!1,_initial:$,_movement:qe,movement:rt,values:_,offset:ry(F,st,wt),delta:Tv(rt,Te)})},s.clean=function(){this.clearTimeout()},S2(c,[{key:"config",get:function(){return this.controller.config[this.stateKey]}},{key:"enabled",get:function(){return this.controller.config.enabled&&this.config.enabled}},{key:"state",get:function(){return this.controller.state[this.stateKey]}},{key:"handler",get:function(){return this.controller.handlers[this.stateKey]}}]),c}();function iy(c,s){return Math.abs(c)>=s?Lp(c)*s:!1}function ry(c,s,p){var _=s[0],x=s[1],S=p[0],z=p[1],o=c[0],j=o[0],U=o[1],F=c[1],$=F[0],J=F[1];return[ru(_,j,U,S),ru(x,$,J,z)]}function lp(c,s,p){var _=c.state,x=c.args,S=s.timeStamp,z=s.type,o=_.values,j=p?0:S-_.startTime;return{_lastEventType:z,event:s,timeStamp:S,elapsedTime:j,args:x,previous:o}}function U2(c,s,p){var _=c.state.offset,x=p.timeStamp;return Xr({},Iv()[c.stateKey],{_active:!0,values:s,initial:s,offset:_,lastOffset:_,startTime:x})}function N2(c,s){return function(p){for(var _=arguments.length,x=new Array(_>1?_-1:0),S=1;S<_;S++)x[S-1]=arguments[S];return c.call.apply(c,[this,Xr({},s,{event:p})].concat(x))}}var j2=function(s){var p=this;this.classes=s,this.bind=function(){for(var _={},x=arguments.length,S=new Array(x),z=0;z<x;z++)S[z]=arguments[z];for(var o=Pd(p.classes),j;!(j=o()).done;){var U=j.value;new U(p,S).addBindings(_)}for(var F=0,$=Object.entries(p.nativeRefs);F<$.length;F++){var J=$[F],G=J[0],ye=J[1];Rp(_,G,N2(ye,Xr({},p.state.shared,{args:S})))}return p.config.domTarget?Z2(p,_):q2(p,_)},this.effect=function(){return p.config.domTarget&&p.bind(),p.clean},this.clean=function(){var _=kv(p.config),x=p.config.eventOptions;_&&_u(_,Mv(p.domListeners),x),Object.values(p.timeouts).forEach(clearTimeout),V2(p)},this.state=Iv(),this.timeouts={},this.domListeners=[],this.windowListeners={}};function V2(c){var s=c.config,p=s.window,_=s.eventOptions,x=c.windowListeners;if(!!p){for(var S in x){var z=x[S];_u(p,z,_)}c.windowListeners={}}}function $2(c,s){var p=c.config,_=c.windowListeners;!p.window||(_u(p.window,_[s],p.eventOptions),delete _[s])}function G2(c,s,p){var _=c.config,x=c.windowListeners;p===void 0&&(p=[]),_.window&&(_u(_.window,x[s],_.eventOptions),zv(_.window,x[s]=p,_.eventOptions))}function Z2(c,s){var p=c.config,_=c.domListeners,x=kv(p);if(!x)throw new Error("domTarget must be defined");var S=p.eventOptions;_u(x,Mv(_),S);for(var z=0,o=Object.entries(s);z<o.length;z++){var j=o[z],U=j[0],F=j[1],$=U.slice(2).toLowerCase();_.push([$,Av.apply(void 0,F)])}zv(x,_,S)}function q2(c,s){for(var p=c.config,_={},x=p.eventOptions.capture?"Capture":"",S=0,z=Object.entries(s);S<z.length;S++){var o=z[S],j=o[0],U=o[1],F=Array.isArray(U)?U:[U],$=j+x;_[$]=Av.apply(void 0,F)}return _}function Mv(c){return c===void 0&&(c=[]),c.splice(0,c.length)}function kv(c){var s=c.domTarget;return s&&"current"in s?s.current:s}function Rp(c,s,p){c[s]||(c[s]=[]),c[s].push(p)}function zv(c,s,p){s===void 0&&(s=[]),p===void 0&&(p={});for(var _=Pd(s),x;!(x=_()).done;){var S=x.value,z=S[0],o=S[1];c.addEventListener(z,o,p)}}function _u(c,s,p){s===void 0&&(s=[]),p===void 0&&(p={});for(var _=Pd(s),x;!(x=_()).done;){var S=x.value,z=S[0],o=S[1];c.removeEventListener(z,o,p)}}function W2(c,s,p){p===void 0&&(p={});var _=H2(c),x=pn.useMemo(function(){return new j2(_)},[]);return x.config=s,x.handlers=c,x.nativeRefs=p,pn.useEffect(x.effect,[]),x.config.domTarget?X2:x.bind}function X2(){}function H2(c){var s=new Set;return c.drag&&s.add(ls.get("drag")),c.wheel&&s.add(ls.get("wheel")),c.scroll&&s.add(ls.get("scroll")),c.move&&s.add(ls.get("move")),c.pinch&&s.add(ls.get("pinch")),c.hover&&s.add(ls.get("hover")),s}var K2=function(c){Sv(s,c);function s(){return c.apply(this,arguments)||this}var p=s.prototype;return p.getInternalMovement=function(x,S){return Tv(x,S.initial)},p.checkIntentionality=function(x,S){if(x[0]===!1&&x[1]===!1)return{_intentional:x,axis:this.state.axis};var z=S.map(Math.abs),o=z[0],j=z[1],U=this.state.axis||(o>j?"x":o<j?"y":void 0);return!this.config.axis&&!this.config.lockDirection?{_intentional:x,_blocked:!1,axis:U}:U?!!this.config.axis&&U!==this.config.axis?{_intentional:x,_blocked:!0,axis:U}:(x[U==="x"?1:0]=!1,{_intentional:x,_blocked:!1,axis:U}):{_intentional:[!1,!1],_blocked:!1,axis:U}},p.getKinematics=function(x,S){var z=this.getMovement(x);if(!z._blocked){var o=S.timeStamp-this.state.timeStamp;Object.assign(z,b2(z.movement,z.delta,o))}return z},p.mapStateValues=function(x){return{xy:x.values,vxvy:x.velocities}},s}(F2);function Pv(c){if("touches"in c){var s=c.targetTouches,p=c.changedTouches;return s.length>0?s:p}return null}function ny(c){var s="buttons"in c?c.buttons:0,p=Pv(c),_=p&&p.length||0,x=_>0||s>0,S=c.shiftKey,z=c.altKey,o=c.metaKey,j=c.ctrlKey;return{touches:_,down:x,buttons:s,shiftKey:S,altKey:z,metaKey:o,ctrlKey:j}}function oy(c){var s=Pv(c),p=s?s[0]:c,_=p.clientX,x=p.clientY;return[_,x]}var Y2=3,J2=220,Q2=function(c){Sv(s,c);function s(){var _;return _=c.apply(this,arguments)||this,_.ingKey="dragging",_.stateKey="drag",_.onDragStart=function(x){!_.enabled||_.state._active||(G2(_.controller,_.stateKey,[["pointermove",_.onDragChange],["pointerup",_.onDragEnd],["pointercancel",_.onDragEnd]]),_.updateGestureState({_pointerId:x.pointerId}),_.config.delay>0?(_.state._delayedEvent=!0,"persist"in x&&typeof x.persist=="function"&&x.persist(),_.setTimeout(_.startDrag.bind(Xh(_)),_.config.delay,x)):_.startDrag(x))},_.onDragChange=function(x){if(!_.state.canceled&&x.pointerId===_.state._pointerId){if(!_.state._active){_.state._delayedEvent&&(_.clearTimeout(),_.startDrag(x));return}var S=ny(x);if(!S.down){_.onDragEnd(x);return}_.updateSharedState(S);var z=oy(x),o=_.getKinematics(z,x),j=lp(Xh(_),x),U=_.state._isTap,F=Dp(o._movement);U&&F>=Y2&&(U=!1),_.updateGestureState(Xr({},j,o,{_isTap:U})),_.fireGestureHandler()}},_.onDragEnd=function(x){if(x.pointerId===_.state._pointerId){_.state._active=!1,_.updateSharedState({down:!1,buttons:0,touches:0});var S=_.state._isTap,z=_.state.velocities,o=z[0],j=z[1],U=_.state.movement,F=U[0],$=U[1],J=_.state._intentional,G=J[0],ye=J[1],Te=_.config.swipeVelocity,Ue=Te[0],Ve=Te[1],T=_.config.swipeDistance,we=T[0],Le=T[1],qe=Xr({},lp(Xh(_),x),_.getMovement(_.state.values)),xe=[0,0];qe.elapsedTime<J2&&(G!==!1&&Math.abs(o)>Ue&&Math.abs(F)>we&&(xe[0]=Lp(o)),ye!==!1&&Math.abs(j)>Ve&&Math.abs($)>Le&&(xe[1]=Lp(j))),_.updateGestureState(Xr({},qe,{tap:S,swipe:xe})),_.fireGestureHandler(S===!0)}},_.clean=function(){c.prototype.clean.call(Xh(_)),_.state._delayedEvent=!1,$2(_.controller,_.stateKey)},_.onCancel=function(){_.state.canceled||(_.updateGestureState({canceled:!0}),_.state._active=!1,_.updateSharedState({down:!1,buttons:0,touches:0}),requestAnimationFrame(function(){return _.fireGestureHandler()}))},_.onClick=function(x){_.state._isTap||x.stopPropagation()},_}var p=s.prototype;return p.startDrag=function(x){var S=oy(x);this.updateSharedState(ny(x)),this.updateGestureState(Xr({},U2(this,S,x),lp(this,x,!0),{_pointerId:x.pointerId,cancel:this.onCancel})),this.updateGestureState(this.getMovement(S)),this.fireGestureHandler()},p.addBindings=function(x){if(Rp(x,"onPointerDown",this.onDragStart),this.config.filterTaps){var S=this.controller.config.eventOptions.capture?"onClick":"onClickCapture";Rp(x,S,this.onClick)}},s}(K2);function eT(c,s){var p,_=[],x,S=!1;function z(){for(var o=arguments.length,j=new Array(o),U=0;U<o;U++)j[U]=arguments[U];return S&&p===this&&s(j,_)||(x=c.apply(this,j),S=!0,p=this,_=j),x}return z}function cd(c,s){if(c===s)return!0;if(c&&s&&typeof c=="object"&&typeof s=="object"){if(c.constructor!==s.constructor)return!1;var p,_,x;if(Array.isArray(c)){if(p=c.length,p!==s.length)return!1;for(_=p;_--!==0;)if(!cd(c[_],s[_]))return!1;return!0}var S;if(typeof Map=="function"&&c instanceof Map&&s instanceof Map){if(c.size!==s.size)return!1;for(S=c.entries();!(_=S.next()).done;)if(!s.has(_.value[0]))return!1;for(S=c.entries();!(_=S.next()).done;)if(!cd(_.value[1],s.get(_.value[0])))return!1;return!0}if(typeof Set=="function"&&c instanceof Set&&s instanceof Set){if(c.size!==s.size)return!1;for(S=c.entries();!(_=S.next()).done;)if(!s.has(_.value[0]))return!1;return!0}if(c.constructor===RegExp)return c.source===s.source&&c.flags===s.flags;if(c.valueOf!==Object.prototype.valueOf)return c.valueOf()===s.valueOf();if(c.toString!==Object.prototype.toString)return c.toString()===s.toString();if(x=Object.keys(c),p=x.length,p!==Object.keys(s).length)return!1;for(_=p;_--!==0;)if(!Object.prototype.hasOwnProperty.call(s,x[_]))return!1;if(typeof Element!="undefined"&&c instanceof Element)return!1;for(_=p;_--!==0;)if(!(x[_]==="_owner"&&c.$$typeof)&&!cd(c[x[_]],s[x[_]]))return!1;return!0}return c!==c&&s!==s}function tT(c,s){try{return cd(c,s)}catch(p){if((p.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw p}}function iT(c,s){s===void 0&&(s={}),ls.set("drag",Q2);var p=Et();return p.current||(p.current=eT(O2,tT)),W2({drag:c},p.current(s))}/*!
* tabbable 5.2.1
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var Dv=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],Bp=Dv.join(","),uu=typeof Element=="undefined"?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Lv=function(s,p,_){var x=Array.prototype.slice.apply(s.querySelectorAll(Bp));return p&&uu.call(s,Bp)&&x.unshift(s),x=x.filter(_),x},rT=function(s){return s.contentEditable==="true"},Rv=function(s){var p=parseInt(s.getAttribute("tabindex"),10);return isNaN(p)?rT(s)||(s.nodeName==="AUDIO"||s.nodeName==="VIDEO"||s.nodeName==="DETAILS")&&s.getAttribute("tabindex")===null?0:s.tabIndex:p},nT=function(s,p){return s.tabIndex===p.tabIndex?s.documentOrder-p.documentOrder:s.tabIndex-p.tabIndex},Qp=function(s){return s.tagName==="INPUT"},oT=function(s){return Qp(s)&&s.type==="hidden"},aT=function(s){var p=s.tagName==="DETAILS"&&Array.prototype.slice.apply(s.children).some(function(_){return _.tagName==="SUMMARY"});return p},sT=function(s,p){for(var _=0;_<s.length;_++)if(s[_].checked&&s[_].form===p)return s[_]},lT=function(s){if(!s.name)return!0;var p=s.form||s.ownerDocument,_=function(o){return p.querySelectorAll('input[type="radio"][name="'+o+'"]')},x;if(typeof window!="undefined"&&typeof window.CSS!="undefined"&&typeof window.CSS.escape=="function")x=_(window.CSS.escape(s.name));else try{x=_(s.name)}catch(z){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",z.message),!1}var S=sT(x,s.form);return!S||S===s},cT=function(s){return Qp(s)&&s.type==="radio"},uT=function(s){return cT(s)&&!lT(s)},hT=function(s,p){if(getComputedStyle(s).visibility==="hidden")return!0;var _=uu.call(s,"details>summary:first-of-type"),x=_?s.parentElement:s;if(uu.call(x,"details:not([open]) *"))return!0;if(!p||p==="full")for(;s;){if(getComputedStyle(s).display==="none")return!0;s=s.parentElement}else if(p==="non-zero-area"){var S=s.getBoundingClientRect(),z=S.width,o=S.height;return z===0&&o===0}return!1},dT=function(s){if(Qp(s)||s.tagName==="SELECT"||s.tagName==="TEXTAREA"||s.tagName==="BUTTON")for(var p=s.parentElement;p;){if(p.tagName==="FIELDSET"&&p.disabled){for(var _=0;_<p.children.length;_++){var x=p.children.item(_);if(x.tagName==="LEGEND")return!x.contains(s)}return!0}p=p.parentElement}return!1},em=function(s,p){return!(p.disabled||oT(p)||hT(p,s.displayCheck)||aT(p)||dT(p))},Bv=function(s,p){return!(!em(s,p)||uT(p)||Rv(p)<0)},fT=function(s,p){p=p||{};var _=[],x=[],S=Lv(s,p.includeContainer,Bv.bind(null,p));S.forEach(function(o,j){var U=Rv(o);U===0?_.push(o):x.push({documentOrder:j,tabIndex:U,node:o})});var z=x.sort(nT).map(function(o){return o.node}).concat(_);return z},pT=function(s,p){p=p||{};var _=Lv(s,p.includeContainer,em.bind(null,p));return _},Kh=function(s,p){if(p=p||{},!s)throw new Error("No node provided");return uu.call(s,Bp)===!1?!1:Bv(p,s)},mT=Dv.concat("iframe").join(","),cp=function(s,p){if(p=p||{},!s)throw new Error("No node provided");return uu.call(s,mT)===!1?!1:em(p,s)};/*!
* focus-trap 6.7.3
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function ay(c,s){var p=Object.keys(c);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(c);s&&(_=_.filter(function(x){return Object.getOwnPropertyDescriptor(c,x).enumerable})),p.push.apply(p,_)}return p}function _T(c){for(var s=1;s<arguments.length;s++){var p=arguments[s]!=null?arguments[s]:{};s%2?ay(Object(p),!0).forEach(function(_){gT(c,_,p[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(p)):ay(Object(p)).forEach(function(_){Object.defineProperty(c,_,Object.getOwnPropertyDescriptor(p,_))})}return c}function gT(c,s,p){return s in c?Object.defineProperty(c,s,{value:p,enumerable:!0,configurable:!0,writable:!0}):c[s]=p,c}var sy=function(){var c=[];return{activateTrap:function(p){if(c.length>0){var _=c[c.length-1];_!==p&&_.pause()}var x=c.indexOf(p);x===-1||c.splice(x,1),c.push(p)},deactivateTrap:function(p){var _=c.indexOf(p);_!==-1&&c.splice(_,1),c.length>0&&c[c.length-1].unpause()}}}(),yT=function(s){return s.tagName&&s.tagName.toLowerCase()==="input"&&typeof s.select=="function"},vT=function(s){return s.key==="Escape"||s.key==="Esc"||s.keyCode===27},xT=function(s){return s.key==="Tab"||s.keyCode===9},ly=function(s){return setTimeout(s,0)},up=function(s,p){var _=-1;return s.every(function(x,S){return p(x)?(_=S,!1):!0}),_},Vc=function(s){for(var p=arguments.length,_=new Array(p>1?p-1:0),x=1;x<p;x++)_[x-1]=arguments[x];return typeof s=="function"?s.apply(void 0,_):s},Yh=function(s){return s.target.shadowRoot&&typeof s.composedPath=="function"?s.composedPath()[0]:s.target},bT=function(s,p){var _=(p==null?void 0:p.document)||document,x=_T({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},p),S={containers:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0},z,o=function(xe,Se,Oe){return xe&&xe[Se]!==void 0?xe[Se]:x[Oe||Se]},j=function(xe){return!!(xe&&S.containers.some(function(Se){return Se.contains(xe)}))},U=function(xe){var Se=x[xe];if(typeof Se=="function"){for(var Oe=arguments.length,Ye=new Array(Oe>1?Oe-1:0),rt=1;rt<Oe;rt++)Ye[rt-1]=arguments[rt];Se=Se.apply(void 0,Ye)}if(!Se){if(Se===void 0||Se===!1)return Se;throw new Error("`".concat(xe,"` was specified but was not a node, or did not return a node"))}var st=Se;if(typeof Se=="string"&&(st=_.querySelector(Se),!st))throw new Error("`".concat(xe,"` as selector refers to no known node"));return st},F=function(){var xe=U("initialFocus");if(xe===!1)return!1;if(xe===void 0)if(j(_.activeElement))xe=_.activeElement;else{var Se=S.tabbableGroups[0],Oe=Se&&Se.firstTabbableNode;xe=Oe||U("fallbackFocus")}if(!xe)throw new Error("Your focus-trap needs to have at least one focusable element");return xe},$=function(){if(S.tabbableGroups=S.containers.map(function(xe){var Se=fT(xe),Oe=pT(xe);if(Se.length>0)return{container:xe,firstTabbableNode:Se[0],lastTabbableNode:Se[Se.length-1],nextTabbableNode:function(rt){var st=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,wt=Oe.findIndex(function(di){return di===rt});return st?Oe.slice(wt+1).find(function(di){return Kh(di)}):Oe.slice(0,wt).reverse().find(function(di){return Kh(di)})}}}).filter(function(xe){return!!xe}),S.tabbableGroups.length<=0&&!U("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},J=function qe(xe){if(xe!==!1&&xe!==_.activeElement){if(!xe||!xe.focus){qe(F());return}xe.focus({preventScroll:!!x.preventScroll}),S.mostRecentlyFocusedNode=xe,yT(xe)&&xe.select()}},G=function(xe){var Se=U("setReturnFocus",xe);return Se||(Se===!1?!1:xe)},ye=function(xe){var Se=Yh(xe);if(!j(Se)){if(Vc(x.clickOutsideDeactivates,xe)){z.deactivate({returnFocus:x.returnFocusOnDeactivate&&!cp(Se)});return}Vc(x.allowOutsideClick,xe)||xe.preventDefault()}},Te=function(xe){var Se=Yh(xe),Oe=j(Se);Oe||Se instanceof Document?Oe&&(S.mostRecentlyFocusedNode=Se):(xe.stopImmediatePropagation(),J(S.mostRecentlyFocusedNode||F()))},Ue=function(xe){var Se=Yh(xe);$();var Oe=null;if(S.tabbableGroups.length>0){var Ye=up(S.tabbableGroups,function(qt){var Ct=qt.container;return Ct.contains(Se)}),rt=Ye>=0?S.tabbableGroups[Ye]:void 0;if(Ye<0)xe.shiftKey?Oe=S.tabbableGroups[S.tabbableGroups.length-1].lastTabbableNode:Oe=S.tabbableGroups[0].firstTabbableNode;else if(xe.shiftKey){var st=up(S.tabbableGroups,function(qt){var Ct=qt.firstTabbableNode;return Se===Ct});if(st<0&&(rt.container===Se||cp(Se)&&!Kh(Se)&&!rt.nextTabbableNode(Se,!1))&&(st=Ye),st>=0){var wt=st===0?S.tabbableGroups.length-1:st-1,di=S.tabbableGroups[wt];Oe=di.lastTabbableNode}}else{var Si=up(S.tabbableGroups,function(qt){var Ct=qt.lastTabbableNode;return Se===Ct});if(Si<0&&(rt.container===Se||cp(Se)&&!Kh(Se)&&!rt.nextTabbableNode(Se))&&(Si=Ye),Si>=0){var Nt=Si===S.tabbableGroups.length-1?0:Si+1,Ni=S.tabbableGroups[Nt];Oe=Ni.firstTabbableNode}}}else Oe=U("fallbackFocus");Oe&&(xe.preventDefault(),J(Oe))},Ve=function(xe){if(vT(xe)&&Vc(x.escapeDeactivates,xe)!==!1){xe.preventDefault(),z.deactivate();return}if(xT(xe)){Ue(xe);return}},T=function(xe){if(!Vc(x.clickOutsideDeactivates,xe)){var Se=Yh(xe);j(Se)||Vc(x.allowOutsideClick,xe)||(xe.preventDefault(),xe.stopImmediatePropagation())}},we=function(){if(!!S.active)return sy.activateTrap(z),S.delayInitialFocusTimer=x.delayInitialFocus?ly(function(){J(F())}):J(F()),_.addEventListener("focusin",Te,!0),_.addEventListener("mousedown",ye,{capture:!0,passive:!1}),_.addEventListener("touchstart",ye,{capture:!0,passive:!1}),_.addEventListener("click",T,{capture:!0,passive:!1}),_.addEventListener("keydown",Ve,{capture:!0,passive:!1}),z},Le=function(){if(!!S.active)return _.removeEventListener("focusin",Te,!0),_.removeEventListener("mousedown",ye,!0),_.removeEventListener("touchstart",ye,!0),_.removeEventListener("click",T,!0),_.removeEventListener("keydown",Ve,!0),z};return z={activate:function(xe){if(S.active)return this;var Se=o(xe,"onActivate"),Oe=o(xe,"onPostActivate"),Ye=o(xe,"checkCanFocusTrap");Ye||$(),S.active=!0,S.paused=!1,S.nodeFocusedBeforeActivation=_.activeElement,Se&&Se();var rt=function(){Ye&&$(),we(),Oe&&Oe()};return Ye?(Ye(S.containers.concat()).then(rt,rt),this):(rt(),this)},deactivate:function(xe){if(!S.active)return this;clearTimeout(S.delayInitialFocusTimer),S.delayInitialFocusTimer=void 0,Le(),S.active=!1,S.paused=!1,sy.deactivateTrap(z);var Se=o(xe,"onDeactivate"),Oe=o(xe,"onPostDeactivate"),Ye=o(xe,"checkCanReturnFocus");Se&&Se();var rt=o(xe,"returnFocus","returnFocusOnDeactivate"),st=function(){ly(function(){rt&&J(G(S.nodeFocusedBeforeActivation)),Oe&&Oe()})};return rt&&Ye?(Ye(G(S.nodeFocusedBeforeActivation)).then(st,st),this):(st(),this)},pause:function(){return S.paused||!S.active?this:(S.paused=!0,Le(),this)},unpause:function(){return!S.paused||!S.active?this:(S.paused=!1,$(),we(),this)},updateContainerElements:function(xe){var Se=[].concat(xe).filter(Boolean);return S.containers=Se.map(function(Oe){return typeof Oe=="string"?_.querySelector(Oe):Oe}),S.active&&$(),this}},z.updateContainerElements(s),z};function wT(c){if(Array.isArray(c)){for(var s=0,p=Array(c.length);s<c.length;s++)p[s]=c[s];return p}else return Array.from(c)}var tm=!1;if(typeof window!="undefined"){var cy={get passive(){tm=!0}};window.addEventListener("testPassive",null,cy),window.removeEventListener("testPassive",null,cy)}var Ov=typeof window!="undefined"&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||window.navigator.platform==="MacIntel"&&window.navigator.maxTouchPoints>1),wa=[],Ed=!1,Fv=-1,nu=void 0,ou=void 0,Uv=function(s){return wa.some(function(p){return!!(p.options.allowTouchMove&&p.options.allowTouchMove(s))})},Ad=function(s){var p=s||window.event;return Uv(p.target)||p.touches.length>1?!0:(p.preventDefault&&p.preventDefault(),!1)},TT=function(s){if(ou===void 0){var p=!!s&&s.reserveScrollBarGap===!0,_=window.innerWidth-document.documentElement.clientWidth;p&&_>0&&(ou=document.body.style.paddingRight,document.body.style.paddingRight=_+"px")}nu===void 0&&(nu=document.body.style.overflow,document.body.style.overflow="hidden")},ST=function(){ou!==void 0&&(document.body.style.paddingRight=ou,ou=void 0),nu!==void 0&&(document.body.style.overflow=nu,nu=void 0)},ET=function(s){return s?s.scrollHeight-s.scrollTop<=s.clientHeight:!1},AT=function(s,p){var _=s.targetTouches[0].clientY-Fv;return Uv(s.target)?!1:p&&p.scrollTop===0&&_>0||ET(p)&&_<0?Ad(s):(s.stopPropagation(),!0)},CT=function(s,p){if(!s){console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.");return}if(!wa.some(function(x){return x.targetElement===s})){var _={targetElement:s,options:p||{}};wa=[].concat(wT(wa),[_]),Ov?(s.ontouchstart=function(x){x.targetTouches.length===1&&(Fv=x.targetTouches[0].clientY)},s.ontouchmove=function(x){x.targetTouches.length===1&&AT(x,s)},Ed||(document.addEventListener("touchmove",Ad,tm?{passive:!1}:void 0),Ed=!0)):TT(p)}},IT=function(s){if(!s){console.error("enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.");return}wa=wa.filter(function(p){return p.targetElement!==s}),Ov?(s.ontouchstart=null,s.ontouchmove=null,Ed&&wa.length===0&&(document.removeEventListener("touchmove",Ad,tm?{passive:!1}:void 0),Ed=!1)):wa.length||ST()},us=[],MT=function(){return us.some(function(c){return c.activeTargets.length>0})},kT=function(){return us.some(function(c){return c.skippedTargets.length>0})},uy="ResizeObserver loop completed with undelivered notifications.",zT=function(){var c;typeof ErrorEvent=="function"?c=new ErrorEvent("error",{message:uy}):(c=document.createEvent("Event"),c.initEvent("error",!1,!1),c.message=uy),window.dispatchEvent(c)},hu;(function(c){c.BORDER_BOX="border-box",c.CONTENT_BOX="content-box",c.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"})(hu||(hu={}));var hs=function(c){return Object.freeze(c)},PT=function(){function c(s,p){this.inlineSize=s,this.blockSize=p,hs(this)}return c}(),Nv=function(){function c(s,p,_,x){return this.x=s,this.y=p,this.width=_,this.height=x,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,hs(this)}return c.prototype.toJSON=function(){var s=this,p=s.x,_=s.y,x=s.top,S=s.right,z=s.bottom,o=s.left,j=s.width,U=s.height;return{x:p,y:_,top:x,right:S,bottom:z,left:o,width:j,height:U}},c.fromRect=function(s){return new c(s.x,s.y,s.width,s.height)},c}(),im=function(c){return c instanceof SVGElement&&"getBBox"in c},jv=function(c){if(im(c)){var s=c.getBBox(),p=s.width,_=s.height;return!p&&!_}var x=c,S=x.offsetWidth,z=x.offsetHeight;return!(S||z||c.getClientRects().length)},hy=function(c){var s,p;if(c instanceof Element)return!0;var _=(p=(s=c)===null||s===void 0?void 0:s.ownerDocument)===null||p===void 0?void 0:p.defaultView;return!!(_&&c instanceof _.Element)},DT=function(c){switch(c.tagName){case"INPUT":if(c.type!=="image")break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1},au=typeof window!="undefined"?window:{},Jh=new WeakMap,dy=/auto|scroll/,LT=/^tb|vertical/,RT=/msie|trident/i.test(au.navigator&&au.navigator.userAgent),Eo=function(c){return parseFloat(c||"0")},Il=function(c,s,p){return c===void 0&&(c=0),s===void 0&&(s=0),p===void 0&&(p=!1),new PT((p?s:c)||0,(p?c:s)||0)},fy=hs({devicePixelContentBoxSize:Il(),borderBoxSize:Il(),contentBoxSize:Il(),contentRect:new Nv(0,0,0,0)}),Vv=function(c,s){if(s===void 0&&(s=!1),Jh.has(c)&&!s)return Jh.get(c);if(jv(c))return Jh.set(c,fy),fy;var p=getComputedStyle(c),_=im(c)&&c.ownerSVGElement&&c.getBBox(),x=!RT&&p.boxSizing==="border-box",S=LT.test(p.writingMode||""),z=!_&&dy.test(p.overflowY||""),o=!_&&dy.test(p.overflowX||""),j=_?0:Eo(p.paddingTop),U=_?0:Eo(p.paddingRight),F=_?0:Eo(p.paddingBottom),$=_?0:Eo(p.paddingLeft),J=_?0:Eo(p.borderTopWidth),G=_?0:Eo(p.borderRightWidth),ye=_?0:Eo(p.borderBottomWidth),Te=_?0:Eo(p.borderLeftWidth),Ue=$+U,Ve=j+F,T=Te+G,we=J+ye,Le=o?c.offsetHeight-we-c.clientHeight:0,qe=z?c.offsetWidth-T-c.clientWidth:0,xe=x?Ue+T:0,Se=x?Ve+we:0,Oe=_?_.width:Eo(p.width)-xe-qe,Ye=_?_.height:Eo(p.height)-Se-Le,rt=Oe+Ue+qe+T,st=Ye+Ve+Le+we,wt=hs({devicePixelContentBoxSize:Il(Math.round(Oe*devicePixelRatio),Math.round(Ye*devicePixelRatio),S),borderBoxSize:Il(rt,st,S),contentBoxSize:Il(Oe,Ye,S),contentRect:new Nv($,j,Oe,Ye)});return Jh.set(c,wt),wt},$v=function(c,s,p){var _=Vv(c,p),x=_.borderBoxSize,S=_.contentBoxSize,z=_.devicePixelContentBoxSize;switch(s){case hu.DEVICE_PIXEL_CONTENT_BOX:return z;case hu.BORDER_BOX:return x;default:return S}},BT=function(){function c(s){var p=Vv(s);this.target=s,this.contentRect=p.contentRect,this.borderBoxSize=hs([p.borderBoxSize]),this.contentBoxSize=hs([p.contentBoxSize]),this.devicePixelContentBoxSize=hs([p.devicePixelContentBoxSize])}return c}(),Gv=function(c){if(jv(c))return 1/0;for(var s=0,p=c.parentNode;p;)s+=1,p=p.parentNode;return s},OT=function(){var c=1/0,s=[];us.forEach(function(z){if(z.activeTargets.length!==0){var o=[];z.activeTargets.forEach(function(U){var F=new BT(U.target),$=Gv(U.target);o.push(F),U.lastReportedSize=$v(U.target,U.observedBox),$<c&&(c=$)}),s.push(function(){z.callback.call(z.observer,o,z.observer)}),z.activeTargets.splice(0,z.activeTargets.length)}});for(var p=0,_=s;p<_.length;p++){var x=_[p];x()}return c},py=function(c){us.forEach(function(p){p.activeTargets.splice(0,p.activeTargets.length),p.skippedTargets.splice(0,p.skippedTargets.length),p.observationTargets.forEach(function(x){x.isActive()&&(Gv(x.target)>c?p.activeTargets.push(x):p.skippedTargets.push(x))})})},FT=function(){var c=0;for(py(c);MT();)c=OT(),py(c);return kT()&&zT(),c>0},hp,Zv=[],UT=function(){return Zv.splice(0).forEach(function(c){return c()})},NT=function(c){if(!hp){var s=0,p=document.createTextNode(""),_={characterData:!0};new MutationObserver(function(){return UT()}).observe(p,_),hp=function(){p.textContent=""+(s?s--:s++)}}Zv.push(c),hp()},jT=function(c){NT(function(){requestAnimationFrame(c)})},ud=0,VT=function(){return!!ud},$T=250,GT={attributes:!0,characterData:!0,childList:!0,subtree:!0},my=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],_y=function(c){return c===void 0&&(c=0),Date.now()+c},dp=!1,ZT=function(){function c(){var s=this;this.stopped=!0,this.listener=function(){return s.schedule()}}return c.prototype.run=function(s){var p=this;if(s===void 0&&(s=$T),!dp){dp=!0;var _=_y(s);jT(function(){var x=!1;try{x=FT()}finally{if(dp=!1,s=_-_y(),!VT())return;x?p.run(1e3):s>0?p.run(s):p.start()}})}},c.prototype.schedule=function(){this.stop(),this.run()},c.prototype.observe=function(){var s=this,p=function(){return s.observer&&s.observer.observe(document.body,GT)};document.body?p():au.addEventListener("DOMContentLoaded",p)},c.prototype.start=function(){var s=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),my.forEach(function(p){return au.addEventListener(p,s.listener,!0)}))},c.prototype.stop=function(){var s=this;this.stopped||(this.observer&&this.observer.disconnect(),my.forEach(function(p){return au.removeEventListener(p,s.listener,!0)}),this.stopped=!0)},c}(),Op=new ZT,gy=function(c){!ud&&c>0&&Op.start(),ud+=c,!ud&&Op.stop()},qT=function(c){return!im(c)&&!DT(c)&&getComputedStyle(c).display==="inline"},WT=function(){function c(s,p){this.target=s,this.observedBox=p||hu.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return c.prototype.isActive=function(){var s=$v(this.target,this.observedBox,!0);return qT(this.target)&&(this.lastReportedSize=s),this.lastReportedSize.inlineSize!==s.inlineSize||this.lastReportedSize.blockSize!==s.blockSize},c}(),XT=function(){function c(s,p){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=s,this.callback=p}return c}(),Qh=new WeakMap,yy=function(c,s){for(var p=0;p<c.length;p+=1)if(c[p].target===s)return p;return-1},ed=function(){function c(){}return c.connect=function(s,p){var _=new XT(s,p);Qh.set(s,_)},c.observe=function(s,p,_){var x=Qh.get(s),S=x.observationTargets.length===0;yy(x.observationTargets,p)<0&&(S&&us.push(x),x.observationTargets.push(new WT(p,_&&_.box)),gy(1),Op.schedule())},c.unobserve=function(s,p){var _=Qh.get(s),x=yy(_.observationTargets,p),S=_.observationTargets.length===1;x>=0&&(S&&us.splice(us.indexOf(_),1),_.observationTargets.splice(x,1),gy(-1))},c.disconnect=function(s){var p=this,_=Qh.get(s);_.observationTargets.slice().forEach(function(x){return p.unobserve(s,x.target)}),_.activeTargets.splice(0,_.activeTargets.length)},c}(),HT=function(){function c(s){if(arguments.length===0)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if(typeof s!="function")throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");ed.connect(this,s)}return c.prototype.observe=function(s,p){if(arguments.length===0)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!hy(s))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");ed.observe(this,s,p)},c.prototype.unobserve=function(s){if(arguments.length===0)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!hy(s))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");ed.unobserve(this,s)},c.prototype.disconnect=function(){ed.disconnect(this)},c.toString=function(){return"function ResizeObserver () { [polyfill code] }"},c}();function Wr(){return(Wr=Object.assign||function(c){for(var s=1;s<arguments.length;s++){var p=arguments[s];for(var _ in p)Object.prototype.hasOwnProperty.call(p,_)&&(c[_]=p[_])}return c}).apply(this,arguments)}function hd(c,s){if(c==null)return{};var p,_,x={},S=Object.keys(c);for(_=0;_<S.length;_++)s.indexOf(p=S[_])>=0||(x[p]=c[p]);return x}var su=typeof window!="undefined"?fs:si;function $c(c,s,p){return s=(s=+s)==s?s:0,p=(p=+p)==p?p:0,(c=+c)==c&&(c=(c=c<=p?c:p)>=s?c:s),c}function td(c){var s=Math.round(c);if(Number.isNaN(c))throw new TypeError("Found a NaN! Check your snapPoints / defaultSnap / snapTo ");return s}var KT={box:"border-box"};function fp(c,s){var p=s.label,_=s.enabled,x=s.resizeSourceRef,S=mn(0),z=S[0],o=S[1];$o(p+": "+z);var j=ui(function(U){o(U[0].borderBoxSize[0].blockSize),x.current="element"},[x]);return su(function(){if(c.current&&_){var U=new HT(j);return U.observe(c.current,KT),function(){U.disconnect()}}},[c,j,_]),_?z:0}function Lr(c){return c===void 0&&(c=1e3),new Promise(function(s){return setTimeout(s,c)})}var vy={DRAG:{target:"#overlay.dragging",actions:"onOpenEnd"}},xy={RESIZE:{target:"#overlay.resizing",actions:"onOpenEnd"}},YT=Tw({id:"overlay",initial:"closed",context:{initialState:"CLOSED"},states:{closed:{on:{OPEN:"opening",CLOSE:void 0}},opening:{initial:"start",states:{start:{invoke:{src:"onOpenStart",onDone:"transition"}},transition:{always:[{target:"immediately",cond:"initiallyOpen"},{target:"smoothly",cond:"initiallyClosed"}]},immediately:{initial:"open",states:{open:{invoke:{src:"openImmediately",onDone:"activating"}},activating:{invoke:{src:"activate",onDone:"#overlay.opening.end"},on:Wr({},vy,xy)}}},smoothly:{initial:"visuallyHidden",states:{visuallyHidden:{invoke:{src:"renderVisuallyHidden",onDone:"activating"}},activating:{invoke:{src:"activate",onDone:"open"}},open:{invoke:{src:"openSmoothly",onDone:"#overlay.opening.end"},on:Wr({},vy,xy)}}},end:{invoke:{src:"onOpenEnd",onDone:"done"},on:{CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:Wr({},{CLOSE:{target:"#overlay.closing",actions:"onOpenCancel"}}),onDone:"open"},open:{on:{DRAG:"#overlay.dragging",SNAP:"snapping",RESIZE:"resizing"}},dragging:{on:{SNAP:"snapping"}},snapping:{initial:"start",states:{start:{invoke:{src:"onSnapStart",onDone:"snappingSmoothly"},entry:[Sw({y:function(c,s){return s.payload.y},velocity:function(c,s){return s.payload.velocity},snapSource:function(c,s){var p=s.payload.source;return p===void 0?"custom":p}})]},snappingSmoothly:{invoke:{src:"snapSmoothly",onDone:"end"}},end:{invoke:{src:"onSnapEnd",onDone:"done"},on:{RESIZE:"#overlay.resizing",SNAP:"#overlay.snapping",CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:{SNAP:{target:"snapping",actions:"onSnapEnd"},RESIZE:{target:"#overlay.resizing",actions:"onSnapCancel"},DRAG:{target:"#overlay.dragging",actions:"onSnapCancel"},CLOSE:{target:"#overlay.closing",actions:"onSnapCancel"}},onDone:"open"},resizing:{initial:"start",states:{start:{invoke:{src:"onResizeStart",onDone:"resizingSmoothly"}},resizingSmoothly:{invoke:{src:"resizeSmoothly",onDone:"end"}},end:{invoke:{src:"onResizeEnd",onDone:"done"},on:{SNAP:"#overlay.snapping",CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:{RESIZE:{target:"resizing",actions:"onResizeEnd"},SNAP:{target:"snapping",actions:"onResizeCancel"},DRAG:{target:"#overlay.dragging",actions:"onResizeCancel"},CLOSE:{target:"#overlay.closing",actions:"onResizeCancel"}},onDone:"open"},closing:{initial:"start",states:{start:{invoke:{src:"onCloseStart",onDone:"deactivating"},on:{OPEN:{target:"#overlay.open",actions:"onCloseCancel"}}},deactivating:{invoke:{src:"deactivate",onDone:"closingSmoothly"}},closingSmoothly:{invoke:{src:"closeSmoothly",onDone:"end"}},end:{invoke:{src:"onCloseEnd",onDone:"done"},on:{OPEN:{target:"#overlay.opening",actions:"onCloseCancel"}}},done:{type:"final"}},on:{CLOSE:void 0,OPEN:{target:"#overlay.opening",actions:"onCloseCancel"}},onDone:"closed"}},on:{CLOSE:"closing"}},{actions:{onOpenCancel:function(c,s){},onSnapCancel:function(c,s){},onResizeCancel:function(c,s){},onCloseCancel:function(c,s){},onOpenEnd:function(c,s){},onSnapEnd:function(c,s){},onRezizeEnd:function(c,s){}},services:{onSnapStart:function(){try{return Promise.resolve(Lr()).then(function(){})}catch(c){return Promise.reject(c)}},onOpenStart:function(){try{return Promise.resolve(Lr()).then(function(){})}catch(c){return Promise.reject(c)}},onCloseStart:function(){try{return Promise.resolve(Lr()).then(function(){})}catch(c){return Promise.reject(c)}},onResizeStart:function(){try{return Promise.resolve(Lr()).then(function(){})}catch(c){return Promise.reject(c)}},onSnapEnd:function(){try{return Promise.resolve(Lr()).then(function(){})}catch(c){return Promise.reject(c)}},onOpenEnd:function(){try{return Promise.resolve(Lr()).then(function(){})}catch(c){return Promise.reject(c)}},onCloseEnd:function(){try{return Promise.resolve(Lr()).then(function(){})}catch(c){return Promise.reject(c)}},onResizeEnd:function(){try{return Promise.resolve(Lr()).then(function(){})}catch(c){return Promise.reject(c)}},renderVisuallyHidden:function(c,s){try{return Promise.resolve(Lr()).then(function(){})}catch(p){return Promise.reject(p)}},activate:function(c,s){try{return Promise.resolve(Lr()).then(function(){})}catch(p){return Promise.reject(p)}},deactivate:function(c,s){try{return Promise.resolve(Lr()).then(function(){})}catch(p){return Promise.reject(p)}},openSmoothly:function(c,s){try{return Promise.resolve(Lr()).then(function(){})}catch(p){return Promise.reject(p)}},openImmediately:function(c,s){try{return Promise.resolve(Lr()).then(function(){})}catch(p){return Promise.reject(p)}},snapSmoothly:function(c,s){try{return Promise.resolve(Lr()).then(function(){})}catch(p){return Promise.reject(p)}},resizeSmoothly:function(c,s){try{return Promise.resolve(Lr()).then(function(){})}catch(p){return Promise.reject(p)}},closeSmoothly:function(c,s){try{return Promise.resolve(Lr()).then(function(){})}catch(p){return Promise.reject(p)}}},guards:{initiallyClosed:function(c){return c.initialState==="CLOSED"},initiallyOpen:function(c){return c.initialState==="OPEN"}}}),JT=["children","sibling","className","footer","header","open","initialState","lastSnapRef","initialFocusRef","onDismiss","maxHeight","defaultSnap","snapPoints","blocking","scrollLocking","style","onSpringStart","onSpringCancel","onSpringEnd","reserveScrollBarGap","expandOnContentDrag"],QT=["velocity"],eS=["onRest","config"],qv=Kw.default,tS=qv.tension,id=qv.friction,iS=pn.forwardRef(function(c,s){var p=c.children,_=c.sibling,x=c.className,S=c.footer,z=c.header,o=c.open,j=c.initialState,U=c.lastSnapRef,F=c.initialFocusRef,$=c.onDismiss,J=c.maxHeight,G=c.defaultSnap,ye=G===void 0?nS:G,Te=c.snapPoints,Ue=Te===void 0?oS:Te,Ve=c.blocking,T=Ve===void 0||Ve,we=c.scrollLocking,Le=we===void 0||we,qe=c.style,xe=c.onSpringStart,Se=c.onSpringCancel,Oe=c.onSpringEnd,Ye=c.reserveScrollBarGap,rt=Ye===void 0?T:Ye,st=c.expandOnContentDrag,wt=st!==void 0&&st,di=hd(c,JT),Si=function(){var je=mn(!1),gt=je[0],Je=je[1],St=mn({}),li=St[0],Dt=St[1],ei=ui(function(ti){return Dt(function(ii){var vt;return Wr({},ii,((vt={})[ti]=!1,vt))}),function(){Dt(function(ii){var vt;return Wr({},ii,((vt={})[ti]=!0,vt))})}},[]);return si(function(){var ti=Object.values(li);ti.length!==0&&ti.every(Boolean)&&Je(!0)},[li]),{ready:gt,registerReady:ei}}(),Nt=Si.ready,Ni=Si.registerReady,qt=Et(!1),Ct=Et(xe),fi=Et(Se),Li=Et(Oe);si(function(){Ct.current=xe,fi.current=Se,Li.current=Oe},[Se,xe,Oe]);var Tt,pi,Br=t2(function(){return{y:0,ready:0,maxHeight:0,minSnap:0,maxSnap:0}}),xn=Br[0],Co=Br[1],Mn=Et(null),pr=Et(null),io=Et(null),Io=Et(null),Mo=Et(null),ro=Et(null),Er=Et(0),Or=Et(),It=Et(!1),ji=(Tt=Kr(function(){return typeof window!="undefined"?window.matchMedia("(prefers-reduced-motion: reduce)"):null},[]),pi=Et(Tt==null?void 0:Tt.matches),$o(pi.current?"reduce":"no-preference"),si(function(){var je=function(gt){pi.current=gt.matches};return Tt==null||Tt.addListener(je),function(){return Tt==null?void 0:Tt.removeListener(je)}},[Tt]),pi),Ar=function(je){var gt=je.targetRef,Je=je.enabled,St=je.reserveScrollBarGap,li=Et({activate:function(){throw new TypeError("Tried to activate scroll lock too early")},deactivate:function(){}});return $o(Je?"Enabled":"Disabled"),si(function(){if(!Je)return li.current.deactivate(),void(li.current={activate:function(){},deactivate:function(){}});var Dt=gt.current,ei=!1;li.current={activate:function(){ei||(ei=!0,CT(Dt,{allowTouchMove:function(ti){return ti.closest("[data-body-scroll-lock-ignore]")},reserveScrollBarGap:St}))},deactivate:function(){ei&&(ei=!1,IT(Dt))}}},[Je,gt,St]),li}({targetRef:pr,enabled:Nt&&Le,reserveScrollBarGap:rt}),Yr=function(je){var gt=je.targetRef,Je=je.enabled,St=Et({activate:function(){throw new TypeError("Tried to activate aria hider too early")},deactivate:function(){}});return $o(Je?"Enabled":"Disabled"),si(function(){if(!Je)return St.current.deactivate(),void(St.current={activate:function(){},deactivate:function(){}});var li=gt.current,Dt=!1,ei=[],ti=[];St.current={activate:function(){if(!Dt){Dt=!0;var ii=li.parentNode;document.querySelectorAll("body > *").forEach(function(vt){if(vt!==ii){var Bt=vt.getAttribute("aria-hidden");Bt!==null&&Bt!=="false"||(ei.push(Bt),ti.push(vt),vt.setAttribute("aria-hidden","true"))}})}},deactivate:function(){Dt&&(Dt=!1,ti.forEach(function(ii,vt){var Bt=ei[vt];Bt===null?ii.removeAttribute("aria-hidden"):ii.setAttribute("aria-hidden",Bt)}),ei=[],ti=[])}}},[gt,Je]),St}({targetRef:Mn,enabled:Nt&&T}),Jr=function(je){var gt=je.targetRef,Je=je.fallbackRef,St=je.initialFocusRef,li=je.enabled,Dt=Et({activate:function(){throw new TypeError("Tried to activate focus trap too early")},deactivate:function(){}});return $o(li?"Enabled":"Disabled"),si(function(){if(!li)return Dt.current.deactivate(),void(Dt.current={activate:function(){},deactivate:function(){}});var ei=Je.current,ti=bT(gt.current,{onActivate:void 0,initialFocus:St?function(){return(St==null?void 0:St.current)||ei}:void 0,fallbackFocus:ei,escapeDeactivates:!1,clickOutsideDeactivates:!1}),ii=!1;Dt.current={activate:function(){try{return ii?Promise.resolve():(ii=!0,Promise.resolve(ti.activate()).then(function(){return Promise.resolve(new Promise(function(vt){return setTimeout(function(){return vt(void 0)},0)})).then(function(){})}))}catch(vt){return Promise.reject(vt)}},deactivate:function(){ii&&(ii=!1,ti.deactivate())}}},[li,Je,St,gt]),Dt}({targetRef:Mn,fallbackRef:ro,initialFocusRef:F||void 0,enabled:Nt&&T&&F!==!1}),kn=function(je){var gt=je.getSnapPoints,Je=je.heightRef,St=je.lastSnapRef,li=je.ready,Dt=function(Y){var D=Y.contentRef,O=Y.controlledMaxHeight,X=Y.footerEnabled,ee=Y.footerRef,le=Y.headerEnabled,he=Y.headerRef,fe=Y.registerReady,ue=Y.resizeSourceRef,_e=Kr(function(){return fe("contentHeight")},[fe]),Ie=function(dt,Mt,ri){var ci=Kr(function(){return Mt("maxHeight")},[Mt]),oi=mn(function(){return td(dt)||typeof window!="undefined"?window.innerHeight:0}),gi=oi[0],en=oi[1],tn=gi>0,Vi=Et(0);return $o(dt?"controlled":"auto"),si(function(){tn&&ci()},[tn,ci]),su(function(){if(dt)return en(td(dt)),void(ri.current="maxheightprop");var Nr=function(){Vi.current||(Vi.current=requestAnimationFrame(function(){en(window.innerHeight),ri.current="window",Vi.current=0}))};return window.addEventListener("resize",Nr),en(window.innerHeight),ri.current="window",ci(),function(){window.removeEventListener("resize",Nr),cancelAnimationFrame(Vi.current)}},[dt,ci,ri]),gi}(O,fe,ue),Pe=fp(he,{label:"headerHeight",enabled:le,resizeSourceRef:ue}),Be=fp(D,{label:"contentHeight",enabled:!0,resizeSourceRef:ue}),lt=fp(ee,{label:"footerHeight",enabled:X,resizeSourceRef:ue}),ut=Math.min(Ie-Pe-lt,Be)+Pe+lt;$o("minHeight: "+ut);var ht=Be>0;return si(function(){ht&&_e()},[ht,_e]),{maxHeight:Ie,minHeight:ut,headerHeight:Pe,footerHeight:lt}}({contentRef:je.contentRef,controlledMaxHeight:je.controlledMaxHeight,footerEnabled:je.footerEnabled,footerRef:je.footerRef,headerEnabled:je.headerEnabled,headerRef:je.headerRef,registerReady:je.registerReady,resizeSourceRef:je.resizeSourceRef}),ei=Dt.maxHeight,ti=Dt.minHeight,ii=Dt.headerHeight,vt=Dt.footerHeight,Bt=function(Y,D){var O=[].concat(Y).map(td).reduce(function(he,fe){return he.add($c(fe,0,D)),he},new Set),X=Array.from(O),ee=Math.min.apply(Math,X);if(Number.isNaN(ee))throw new TypeError("minSnap is NaN");var le=Math.max.apply(Math,X);if(Number.isNaN(le))throw new TypeError("maxSnap is NaN");return{snapPoints:X,minSnap:ee,maxSnap:le}}(li?gt({height:Je.current,footerHeight:vt,headerHeight:ii,minHeight:ti,maxHeight:ei}):[0],ei),Ri=Bt.snapPoints,Ur=Bt.minSnap,zi=Bt.maxSnap;return $o("minSnap: "+Ur+", maxSnap:"+zi),{minSnap:Ur,maxSnap:zi,findSnap:function(Y){var D=td(typeof Y=="function"?Y({footerHeight:vt,headerHeight:ii,height:Je.current,minHeight:ti,maxHeight:ei,snapPoints:Ri,lastSnap:St.current}):Y);return Ri.reduce(function(O,X){return Math.abs(X-D)<Math.abs(O-D)?X:O},Ur)},maxHeight:ei}}({contentRef:io,controlledMaxHeight:J,footerEnabled:!!S,footerRef:Mo,getSnapPoints:Ue,headerEnabled:z!==!1,headerRef:Io,heightRef:Er,lastSnapRef:U,ready:Nt,registerReady:Ni,resizeSourceRef:Or}),Vt=kn.minSnap,Cr=kn.maxSnap,vr=kn.maxHeight,Qr=kn.findSnap,mr=Et(vr),Wt=Et(Vt),Ai=Et(Cr),zn=Et(Qr),_r=Et(0);su(function(){mr.current=vr,Ai.current=Cr,Wt.current=Vt,zn.current=Qr,_r.current=Qr(ye)},[Qr,ye,vr,Cr,Vt]);var wi=ui(function(je){var gt=je.onRest,Je=je.config,St=(Je=Je===void 0?{}:Je).velocity,li=St===void 0?1:St,Dt=hd(Je,QT),ei=hd(je,eS);return new Promise(function(ti){return Co(Wr({},ei,{config:Wr({velocity:li},Dt,{mass:1,tension:tS,friction:Math.max(id,id+(id-id*li))}),onRest:function(){var ii=[].slice.call(arguments);ti.apply(void 0,ii),gt==null||gt.apply(void 0,ii)}}))})},[Co]),ko=Dw(YT,{devTools:!1,actions:{onOpenCancel:ui(function(){return fi.current==null?void 0:fi.current({type:"OPEN"})},[]),onSnapCancel:ui(function(je){return fi.current==null?void 0:fi.current({type:"SNAP",source:je.snapSource})},[]),onCloseCancel:ui(function(){return fi.current==null?void 0:fi.current({type:"CLOSE"})},[]),onResizeCancel:ui(function(){return fi.current==null?void 0:fi.current({type:"RESIZE",source:Or.current})},[]),onOpenEnd:ui(function(){return Li.current==null?void 0:Li.current({type:"OPEN"})},[]),onSnapEnd:ui(function(je,gt){return Li.current==null?void 0:Li.current({type:"SNAP",source:je.snapSource})},[]),onResizeEnd:ui(function(){return Li.current==null?void 0:Li.current({type:"RESIZE",source:Or.current})},[])},context:{initialState:j},services:{onSnapStart:ui(function(je,gt){try{return Promise.resolve(Ct.current==null?void 0:Ct.current({type:"SNAP",source:gt.payload.source||"custom"}))}catch(Je){return Promise.reject(Je)}},[]),onOpenStart:ui(function(){try{return Promise.resolve(Ct.current==null?void 0:Ct.current({type:"OPEN"}))}catch(je){return Promise.reject(je)}},[]),onCloseStart:ui(function(){try{return Promise.resolve(Ct.current==null?void 0:Ct.current({type:"CLOSE"}))}catch(je){return Promise.reject(je)}},[]),onResizeStart:ui(function(){try{return Promise.resolve(Ct.current==null?void 0:Ct.current({type:"RESIZE",source:Or.current}))}catch(je){return Promise.reject(je)}},[]),onSnapEnd:ui(function(je,gt){try{return Promise.resolve(Li.current==null?void 0:Li.current({type:"SNAP",source:je.snapSource}))}catch(Je){return Promise.reject(Je)}},[]),onOpenEnd:ui(function(){try{return Promise.resolve(Li.current==null?void 0:Li.current({type:"OPEN"}))}catch(je){return Promise.reject(je)}},[]),onCloseEnd:ui(function(){try{return Promise.resolve(Li.current==null?void 0:Li.current({type:"CLOSE"}))}catch(je){return Promise.reject(je)}},[]),onResizeEnd:ui(function(){try{return Promise.resolve(Li.current==null?void 0:Li.current({type:"RESIZE",source:Or.current}))}catch(je){return Promise.reject(je)}},[]),renderVisuallyHidden:ui(function(je,gt){try{return Promise.resolve(wi({y:_r.current,ready:0,maxHeight:mr.current,maxSnap:Ai.current,minSnap:_r.current,immediate:!0})).then(function(){})}catch(Je){return Promise.reject(Je)}},[wi]),activate:ui(function(je,gt){try{return qt.current=!0,Promise.resolve(Promise.all([Ar.current.activate(),Jr.current.activate(),Yr.current.activate()])).then(function(){})}catch(Je){return Promise.reject(Je)}},[Yr,Jr,Ar]),deactivate:ui(function(){try{return Ar.current.deactivate(),Jr.current.deactivate(),Yr.current.deactivate(),qt.current=!1,Promise.resolve()}catch(je){return Promise.reject(je)}},[Yr,Jr,Ar]),openImmediately:ui(function(){try{return Er.current=_r.current,Promise.resolve(wi({y:_r.current,ready:1,maxHeight:mr.current,maxSnap:Ai.current,minSnap:_r.current,immediate:!0})).then(function(){})}catch(je){return Promise.reject(je)}},[wi]),openSmoothly:ui(function(){try{return Promise.resolve(wi({y:0,ready:1,maxHeight:mr.current,maxSnap:Ai.current,minSnap:_r.current,immediate:!0})).then(function(){return Er.current=_r.current,Promise.resolve(wi({y:_r.current,ready:1,maxHeight:mr.current,maxSnap:Ai.current,minSnap:_r.current,immediate:ji.current})).then(function(){})})}catch(je){return Promise.reject(je)}},[wi,ji]),snapSmoothly:ui(function(je,gt){try{var Je=zn.current(je.y);return Er.current=Je,U.current=Je,Promise.resolve(wi({y:Je,ready:1,maxHeight:mr.current,maxSnap:Ai.current,minSnap:Wt.current,immediate:ji.current,config:{velocity:je.velocity}})).then(function(){})}catch(St){return Promise.reject(St)}},[wi,U,ji]),resizeSmoothly:ui(function(){try{var je=zn.current(Er.current);return Er.current=je,U.current=je,Promise.resolve(wi({y:je,ready:1,maxHeight:mr.current,maxSnap:Ai.current,minSnap:Wt.current,immediate:Or.current!=="element"||ji.current})).then(function(){})}catch(gt){return Promise.reject(gt)}},[wi,U,ji]),closeSmoothly:ui(function(je,gt){try{return wi({minSnap:Er.current,immediate:!0}),Er.current=0,Promise.resolve(wi({y:0,maxHeight:mr.current,maxSnap:Ai.current,immediate:ji.current})).then(function(){return Promise.resolve(wi({ready:0,immediate:!0})).then(function(){})})}catch(Je){return Promise.reject(Je)}},[wi,ji])}}),no=ko[0],xr=ko[1];si(function(){Nt&&xr(o?"OPEN":"CLOSE")},[o,xr,Nt]),su(function(){(vr||Cr||Vt)&&xr("RESIZE")},[vr,Cr,Vt,xr]),si(function(){return function(){Ar.current.deactivate(),Jr.current.deactivate(),Yr.current.deactivate()}},[Yr,Jr,Ar]),Bl(s,function(){return{snapTo:function(je,gt){var Je=gt===void 0?{}:gt,St=Je.velocity,li=St===void 0?1:St,Dt=Je.source,ei=Dt===void 0?"custom":Dt;xr("SNAP",{payload:{y:zn.current(je),velocity:li,source:ei}})},get height(){return Er.current}}},[xr]),si(function(){var je=pr.current,gt=function(St){It.current&&St.preventDefault()},Je=function(St){je.scrollTop<0&&(requestAnimationFrame(function(){je.style.overflow="hidden",je.scrollTop=0,je.style.removeProperty("overflow")}),St.preventDefault())};return wt&&(je.addEventListener("scroll",gt),je.addEventListener("touchmove",gt),je.addEventListener("touchstart",Je)),function(){je.removeEventListener("scroll",gt),je.removeEventListener("touchmove",gt),je.removeEventListener("touchstart",Je)}},[wt,pr]);var Fr=iT(function(je){var gt=je.args,Je=(gt=gt===void 0?[]:gt)[0],St=(Je=Je===void 0?{}:Je).closeOnTap,li=St!==void 0&&St,Dt=Je.isContentDragging,ei=Dt!==void 0&&Dt,ti=je.cancel,ii=je.direction[1],vt=je.down,Bt=je.first,Ri=je.last,Ur=je.memo,zi=Ur===void 0?xn.y.getValue():Ur,Y=je.tap,D=je.velocity,O=-1*je.movement[1];if(!qt.current)return ti(),zi;if($&&li&&Y)return ti(),setTimeout(function(){return $()},0),zi;if(Y)return zi;var X=zi+O,ee=O*D,le=Math.max(Wt.current,Math.min(Ai.current,X+2*ee));if(!vt&&$&&ii>0&&X+ee<Wt.current/2)return ti(),$(),zi;var he=vt?$||Wt.current!==Ai.current?ru(X,$?0:Wt.current,Ai.current,.55):X<Wt.current?ru(X,Wt.current,2*Ai.current,.55):ru(X,Wt.current/2,Ai.current,.55):le;return wt&&ei?(he>=Ai.current&&(he=Ai.current),zi===Ai.current&&pr.current.scrollTop>0&&(he=Ai.current),It.current=he<Ai.current):It.current=!1,Bt&&xr("DRAG"),Ri?(xr("SNAP",{payload:{y:he,velocity:D>.05?D:1,source:"dragging"}}),zi):(Co({y:he,ready:1,maxHeight:mr.current,maxSnap:Ai.current,minSnap:Wt.current,immediate:!0,config:{velocity:D}}),zi)},{filterTaps:!0});if(Number.isNaN(Ai.current))throw new TypeError("maxSnapRef is NaN!!");if(Number.isNaN(Wt.current))throw new TypeError("minSnapRef is NaN!!");var oo=function(je){var gt,Je=je.spring,St=wl([Je.y,Je.maxHeight],function(vt,Bt){return Math.round($c(Bt-vt,0,16))+"px"}),li=wl([Je.y,Je.minSnap,Je.maxSnap],function(vt,Bt,Ri){return $c(vt,Bt,Ri)+"px"}),Dt=wl([Je.y,Je.minSnap,Je.maxSnap],function(vt,Bt,Ri){return vt<Bt?Bt-vt+"px":vt>Ri?Ri-vt+"px":"0px"}),ei=wl([Je.y,Je.maxSnap],function(vt,Bt){return vt>=Bt?Math.ceil(vt-Bt):0}),ti=wl([Je.y,Je.minSnap],function(vt,Bt){if(!Bt)return 0;var Ri=Math.max(Bt/2-45,0);return $c((vt-Ri)*(1/(Math.min(Bt/2+45,Bt)-Ri)+0),0,1)}),ii=wl([Je.y,Je.minSnap],function(vt,Bt){return Bt?$c(vt/Bt,0,1):0});return(gt={})["--rsbs-content-opacity"]=ti,gt["--rsbs-backdrop-opacity"]=ii,gt["--rsbs-antigap-scale-y"]=ei,gt["--rsbs-overlay-translate-y"]=Dt,gt["--rsbs-overlay-rounded"]=St,gt["--rsbs-overlay-h"]=li,gt}({spring:xn});return pn.createElement(x2.div,Wr({},di,{"data-rsbs-root":!0,"data-rsbs-state":rS.find(no.matches),"data-rsbs-is-blocking":T,"data-rsbs-is-dismissable":!!$,"data-rsbs-has-header":!!z,"data-rsbs-has-footer":!!S,className:x,ref:Mn,style:Wr({},oo,qe,{opacity:xn.ready})}),_,T&&pn.createElement("div",Wr({key:"backdrop","data-rsbs-backdrop":!0},Fr({closeOnTap:!0}))),pn.createElement("div",{key:"overlay","aria-modal":"true",role:"dialog","data-rsbs-overlay":!0,tabIndex:-1,ref:ro,onKeyDown:function(je){je.key==="Escape"&&(je.stopPropagation(),$&&$())}},z!==!1&&pn.createElement("div",Wr({key:"header","data-rsbs-header":!0,ref:Io},Fr()),z),pn.createElement("div",Wr({key:"scroll","data-rsbs-scroll":!0,ref:pr},wt?Fr({isContentDragging:!0}):{}),pn.createElement("div",{"data-rsbs-content":!0,ref:io},p)),S&&pn.createElement("div",Wr({key:"footer",ref:Mo,"data-rsbs-footer":!0},Fr()),S)))}),rS=["closed","opening","open","closing","dragging","snapping","resizing"];function nS(c){var s=c.lastSnap;return s!=null?s:Math.min.apply(Math,c.snapPoints)}function oS(c){return c.minHeight}var aS=["onSpringStart","onSpringEnd","skipInitialTransition"],LS=pu(function(c,s){var p=c.onSpringStart,_=c.onSpringEnd,x=c.skipInitialTransition,S=hd(c,aS),z=mn(!1),o=z[0],j=z[1],U=Et(),F=Et(null),$=Et(x&&S.open?"OPEN":"CLOSED");su(function(){if(S.open)return cancelAnimationFrame(U.current),j(!0),function(){$.current="CLOSED"}},[S.open]);var J=ui(function(ye){try{return Promise.resolve(p==null?void 0:p(ye)).then(function(){ye.type==="OPEN"&&cancelAnimationFrame(U.current)})}catch(Te){return Promise.reject(Te)}},[p]),G=ui(function(ye){try{return Promise.resolve(_==null?void 0:_(ye)).then(function(){ye.type==="CLOSE"&&(U.current=requestAnimationFrame(function(){return j(!1)}))})}catch(Te){return Promise.reject(Te)}},[_]);return o?pn.createElement(kb,{"data-rsbs-portal":!0},pn.createElement(iS,Wr({},S,{lastSnapRef:F,ref:s,initialState:$.current,onSpringStart:J,onSpringEnd:G}))):null});function gn(c,s){if(!s)return c;var p=+(Math.round(c+"e+2")+"e-2"),_=p.toString().split(".");return _[0]=_[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),_.join(".")}function yn(c,s){if(c!==s){var p=c==="area"?"an area measurement to a length measurement":"a length measurement to an area measurement";throw new Error(`Invalid conversion. You are trying to convert ${p}.`)}}var vn={km:.001,km2:1e-6,hm:.01,hm2:1e-4,dam:.1,dam2:.01,m:1,m2:1,dm:10,dm2:100,cm:100,cm2:1e4,mm:1e3,mm2:1e6},Fp={km:{value:1e3,category:"length"},km2:{value:1e6,category:"area"},hm:{value:100,category:"length"},hm2:{value:1e4,category:"area"},dam:{value:10,category:"length"},dam2:{value:100,category:"area"},m:{value:1,category:"length"},m2:{value:1,category:"area"},dm:{value:.1,category:"length"},dm2:{value:.01,category:"area"},cm:{value:.01,category:"length"},cm2:{value:1e-4,category:"area"},mm:{value:.001,category:"length"},mm2:{value:1e-6,category:"area"}};function fr(c){if(!(this instanceof fr))return new fr(c);this.value=c===0?0:c||1,this.type=Fp.m}fr.prototype.input=function(c){if(!c in Fp)throw new Error("type "+c+" is not valid");return this.type=Fp[c],this};fr.prototype.km=function(){return yn(this.type.category,"length"),gn(this.value*this.type.value*vn.km,this.prettify)+"km"};fr.prototype.km2=function(){return yn(this.type.category,"area"),gn(this.value*this.type.value*vn.km2,this.prettify)+"km2"};fr.prototype.hm=function(){return yn(this.type.category,"length"),gn(this.value*this.type.value*vn.hm,this.prettify)+"hm"};fr.prototype.hm2=function(){return yn(this.type.category,"area"),gn(this.value*this.type.value*vn.hm2,this.prettify)+"hm2"};fr.prototype.dam=function(){return yn(this.type.category,"length"),gn(this.value*this.type.value*vn.dam,this.prettify)+"dam"};fr.prototype.dam2=function(){return yn(this.type.category,"area"),gn(this.value*this.type.value*vn.dam2,this.prettify)+"dam2"};fr.prototype.m=function(){return yn(this.type.category,"length"),gn(this.value*this.type.value*vn.m,this.prettify)+"m"};fr.prototype.m2=function(){return yn(this.type.category,"area"),gn(this.value*this.type.value*vn.m2,this.prettify)+"m2"};fr.prototype.dm=function(){return yn(this.type.category,"length"),gn(this.value*this.type.value*vn.dm,this.prettify)+"dm"};fr.prototype.dm2=function(){return yn(this.type.category,"area"),gn(this.value*this.type.value*vn.dm2,this.prettify)+"dm2"};fr.prototype.cm=function(){return yn(this.type.category,"length"),gn(this.value*this.type.value*vn.cm,this.prettify)+"cm"};fr.prototype.cm2=function(){return yn(this.type.category,"area"),gn(this.value*this.type.value*vn.cm2,this.prettify)+"cm2"};fr.prototype.mm=function(){return yn(this.type.category,"length"),gn(this.value*this.type.value*vn.mm,this.prettify)+"mm"};fr.prototype.mm2=function(){return yn(this.type.category,"area"),gn(this.value*this.type.value*vn.mm2,this.prettify)+"mm2"};fr.prototype.humanize=function(){var c=this.type.value*this.value,s=this.type.category;return this.prettify=!0,s==="area"?c>=1e6?this.km2():c>=1?this.m2():c>=.5?this.m2():c>=.1?this.cm2():this.mm2():c>=1e3?this.km():c>=1?this.m():c>=.5?this.m():c>=.1?this.cm():this.mm()};var RS=fr,Wv={exports:{}};(function(c){(function(){var s={y:function(T){return T===1?"\u03C7\u03C1\u03CC\u03BD\u03BF\u03C2":"\u03C7\u03C1\u03CC\u03BD\u03B9\u03B1"},mo:function(T){return T===1?"\u03BC\u03AE\u03BD\u03B1\u03C2":"\u03BC\u03AE\u03BD\u03B5\u03C2"},w:function(T){return T===1?"\u03B5\u03B2\u03B4\u03BF\u03BC\u03AC\u03B4\u03B1":"\u03B5\u03B2\u03B4\u03BF\u03BC\u03AC\u03B4\u03B5\u03C2"},d:function(T){return T===1?"\u03BC\u03AD\u03C1\u03B1":"\u03BC\u03AD\u03C1\u03B5\u03C2"},h:function(T){return T===1?"\u03CE\u03C1\u03B1":"\u03CE\u03C1\u03B5\u03C2"},m:function(T){return T===1?"\u03BB\u03B5\u03C0\u03C4\u03CC":"\u03BB\u03B5\u03C0\u03C4\u03AC"},s:function(T){return T===1?"\u03B4\u03B5\u03C5\u03C4\u03B5\u03C1\u03CC\u03BB\u03B5\u03C0\u03C4\u03BF":"\u03B4\u03B5\u03C5\u03C4\u03B5\u03C1\u03CC\u03BB\u03B5\u03C0\u03C4\u03B1"},ms:function(T){return T===1?"\u03C7\u03B9\u03BB\u03B9\u03BF\u03C3\u03C4\u03CC \u03C4\u03BF\u03C5 \u03B4\u03B5\u03C5\u03C4\u03B5\u03C1\u03BF\u03BB\u03AD\u03C0\u03C4\u03BF\u03C5":"\u03C7\u03B9\u03BB\u03B9\u03BF\u03C3\u03C4\u03AC \u03C4\u03BF\u03C5 \u03B4\u03B5\u03C5\u03C4\u03B5\u03C1\u03BF\u03BB\u03AD\u03C0\u03C4\u03BF\u03C5"},decimal:","},p=["\u06F0","\u0661","\u0662","\u0663","\u0664","\u0665","\u0666","\u0667","\u0668","\u0669"],_={af:{y:"jaar",mo:function(T){return"maand"+(T===1?"":"e")},w:function(T){return T===1?"week":"weke"},d:function(T){return T===1?"dag":"dae"},h:function(T){return T===1?"uur":"ure"},m:function(T){return T===1?"minuut":"minute"},s:function(T){return"sekonde"+(T===1?"":"s")},ms:function(T){return"millisekonde"+(T===1?"":"s")},decimal:","},ar:{y:function(T){return["\u0633\u0646\u0629","\u0633\u0646\u062A\u0627\u0646","\u0633\u0646\u0648\u0627\u062A"][F(T)]},mo:function(T){return["\u0634\u0647\u0631","\u0634\u0647\u0631\u0627\u0646","\u0623\u0634\u0647\u0631"][F(T)]},w:function(T){return["\u0623\u0633\u0628\u0648\u0639","\u0623\u0633\u0628\u0648\u0639\u064A\u0646","\u0623\u0633\u0627\u0628\u064A\u0639"][F(T)]},d:function(T){return["\u064A\u0648\u0645","\u064A\u0648\u0645\u064A\u0646","\u0623\u064A\u0627\u0645"][F(T)]},h:function(T){return["\u0633\u0627\u0639\u0629","\u0633\u0627\u0639\u062A\u064A\u0646","\u0633\u0627\u0639\u0627\u062A"][F(T)]},m:function(T){return["\u062F\u0642\u064A\u0642\u0629","\u062F\u0642\u064A\u0642\u062A\u0627\u0646","\u062F\u0642\u0627\u0626\u0642"][F(T)]},s:function(T){return["\u062B\u0627\u0646\u064A\u0629","\u062B\u0627\u0646\u064A\u062A\u0627\u0646","\u062B\u0648\u0627\u0646\u064A"][F(T)]},ms:function(T){return["\u062C\u0632\u0621 \u0645\u0646 \u0627\u0644\u062B\u0627\u0646\u064A\u0629","\u062C\u0632\u0622\u0646 \u0645\u0646 \u0627\u0644\u062B\u0627\u0646\u064A\u0629","\u0623\u062C\u0632\u0627\u0621 \u0645\u0646 \u0627\u0644\u062B\u0627\u0646\u064A\u0629"][F(T)]},decimal:",",delimiter:" \u0648 ",_formatCount:function(T,we){for(var Le=U(p,{".":we}),qe=T.toString().split(""),xe=0;xe<qe.length;xe++){var Se=qe[xe];Ve(Le,Se)&&(qe[xe]=Le[Se])}return qe.join("")}},bg:{y:function(T){return["\u0433\u043E\u0434\u0438\u043D\u0438","\u0433\u043E\u0434\u0438\u043D\u0430","\u0433\u043E\u0434\u0438\u043D\u0438"][J(T)]},mo:function(T){return["\u043C\u0435\u0441\u0435\u0446\u0430","\u043C\u0435\u0441\u0435\u0446","\u043C\u0435\u0441\u0435\u0446\u0430"][J(T)]},w:function(T){return["\u0441\u0435\u0434\u043C\u0438\u0446\u0438","\u0441\u0435\u0434\u043C\u0438\u0446\u0430","\u0441\u0435\u0434\u043C\u0438\u0446\u0438"][J(T)]},d:function(T){return["\u0434\u043D\u0438","\u0434\u0435\u043D","\u0434\u043D\u0438"][J(T)]},h:function(T){return["\u0447\u0430\u0441\u0430","\u0447\u0430\u0441","\u0447\u0430\u0441\u0430"][J(T)]},m:function(T){return["\u043C\u0438\u043D\u0443\u0442\u0438","\u043C\u0438\u043D\u0443\u0442\u0430","\u043C\u0438\u043D\u0443\u0442\u0438"][J(T)]},s:function(T){return["\u0441\u0435\u043A\u0443\u043D\u0434\u0438","\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u0441\u0435\u043A\u0443\u043D\u0434\u0438"][J(T)]},ms:function(T){return["\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0438","\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0438"][J(T)]},decimal:","},bn:{y:"\u09AC\u099B\u09B0",mo:"\u09AE\u09BE\u09B8",w:"\u09B8\u09AA\u09CD\u09A4\u09BE\u09B9",d:"\u09A6\u09BF\u09A8",h:"\u0998\u09A8\u09CD\u099F\u09BE",m:"\u09AE\u09BF\u09A8\u09BF\u099F",s:"\u09B8\u09C7\u0995\u09C7\u09A8\u09CD\u09A1",ms:"\u09AE\u09BF\u09B2\u09BF\u09B8\u09C7\u0995\u09C7\u09A8\u09CD\u09A1"},ca:{y:function(T){return"any"+(T===1?"":"s")},mo:function(T){return"mes"+(T===1?"":"os")},w:function(T){return"setman"+(T===1?"a":"es")},d:function(T){return"di"+(T===1?"a":"es")},h:function(T){return"hor"+(T===1?"a":"es")},m:function(T){return"minut"+(T===1?"":"s")},s:function(T){return"segon"+(T===1?"":"s")},ms:function(T){return"milisegon"+(T===1?"":"s")},decimal:","},cs:{y:function(T){return["rok","roku","roky","let"][G(T)]},mo:function(T){return["m\u011Bs\xEDc","m\u011Bs\xEDce","m\u011Bs\xEDce","m\u011Bs\xEDc\u016F"][G(T)]},w:function(T){return["t\xFDden","t\xFDdne","t\xFDdny","t\xFDdn\u016F"][G(T)]},d:function(T){return["den","dne","dny","dn\xED"][G(T)]},h:function(T){return["hodina","hodiny","hodiny","hodin"][G(T)]},m:function(T){return["minuta","minuty","minuty","minut"][G(T)]},s:function(T){return["sekunda","sekundy","sekundy","sekund"][G(T)]},ms:function(T){return["milisekunda","milisekundy","milisekundy","milisekund"][G(T)]},decimal:","},cy:{y:"flwyddyn",mo:"mis",w:"wythnos",d:"diwrnod",h:"awr",m:"munud",s:"eiliad",ms:"milieiliad"},da:{y:"\xE5r",mo:function(T){return"m\xE5ned"+(T===1?"":"er")},w:function(T){return"uge"+(T===1?"":"r")},d:function(T){return"dag"+(T===1?"":"e")},h:function(T){return"time"+(T===1?"":"r")},m:function(T){return"minut"+(T===1?"":"ter")},s:function(T){return"sekund"+(T===1?"":"er")},ms:function(T){return"millisekund"+(T===1?"":"er")},decimal:","},de:{y:function(T){return"Jahr"+(T===1?"":"e")},mo:function(T){return"Monat"+(T===1?"":"e")},w:function(T){return"Woche"+(T===1?"":"n")},d:function(T){return"Tag"+(T===1?"":"e")},h:function(T){return"Stunde"+(T===1?"":"n")},m:function(T){return"Minute"+(T===1?"":"n")},s:function(T){return"Sekunde"+(T===1?"":"n")},ms:function(T){return"Millisekunde"+(T===1?"":"n")},decimal:","},el:s,en:{y:function(T){return"year"+(T===1?"":"s")},mo:function(T){return"month"+(T===1?"":"s")},w:function(T){return"week"+(T===1?"":"s")},d:function(T){return"day"+(T===1?"":"s")},h:function(T){return"hour"+(T===1?"":"s")},m:function(T){return"minute"+(T===1?"":"s")},s:function(T){return"second"+(T===1?"":"s")},ms:function(T){return"millisecond"+(T===1?"":"s")},decimal:"."},eo:{y:function(T){return"jaro"+(T===1?"":"j")},mo:function(T){return"monato"+(T===1?"":"j")},w:function(T){return"semajno"+(T===1?"":"j")},d:function(T){return"tago"+(T===1?"":"j")},h:function(T){return"horo"+(T===1?"":"j")},m:function(T){return"minuto"+(T===1?"":"j")},s:function(T){return"sekundo"+(T===1?"":"j")},ms:function(T){return"milisekundo"+(T===1?"":"j")},decimal:","},es:{y:function(T){return"a\xF1o"+(T===1?"":"s")},mo:function(T){return"mes"+(T===1?"":"es")},w:function(T){return"semana"+(T===1?"":"s")},d:function(T){return"d\xEDa"+(T===1?"":"s")},h:function(T){return"hora"+(T===1?"":"s")},m:function(T){return"minuto"+(T===1?"":"s")},s:function(T){return"segundo"+(T===1?"":"s")},ms:function(T){return"milisegundo"+(T===1?"":"s")},decimal:","},et:{y:function(T){return"aasta"+(T===1?"":"t")},mo:function(T){return"kuu"+(T===1?"":"d")},w:function(T){return"n\xE4dal"+(T===1?"":"at")},d:function(T){return"p\xE4ev"+(T===1?"":"a")},h:function(T){return"tund"+(T===1?"":"i")},m:function(T){return"minut"+(T===1?"":"it")},s:function(T){return"sekund"+(T===1?"":"it")},ms:function(T){return"millisekund"+(T===1?"":"it")},decimal:","},eu:{y:"urte",mo:"hilabete",w:"aste",d:"egun",h:"ordu",m:"minutu",s:"segundo",ms:"milisegundo",decimal:","},fa:{y:"\u0633\u0627\u0644",mo:"\u0645\u0627\u0647",w:"\u0647\u0641\u062A\u0647",d:"\u0631\u0648\u0632",h:"\u0633\u0627\u0639\u062A",m:"\u062F\u0642\u06CC\u0642\u0647",s:"\u062B\u0627\u0646\u06CC\u0647",ms:"\u0645\u06CC\u0644\u06CC \u062B\u0627\u0646\u06CC\u0647",decimal:"."},fi:{y:function(T){return T===1?"vuosi":"vuotta"},mo:function(T){return T===1?"kuukausi":"kuukautta"},w:function(T){return"viikko"+(T===1?"":"a")},d:function(T){return"p\xE4iv\xE4"+(T===1?"":"\xE4")},h:function(T){return"tunti"+(T===1?"":"a")},m:function(T){return"minuutti"+(T===1?"":"a")},s:function(T){return"sekunti"+(T===1?"":"a")},ms:function(T){return"millisekunti"+(T===1?"":"a")},decimal:","},fo:{y:"\xE1r",mo:function(T){return T===1?"m\xE1na\xF0ur":"m\xE1na\xF0ir"},w:function(T){return T===1?"vika":"vikur"},d:function(T){return T===1?"dagur":"dagar"},h:function(T){return T===1?"t\xEDmi":"t\xEDmar"},m:function(T){return T===1?"minuttur":"minuttir"},s:"sekund",ms:"millisekund",decimal:","},fr:{y:function(T){return"an"+(T>=2?"s":"")},mo:"mois",w:function(T){return"semaine"+(T>=2?"s":"")},d:function(T){return"jour"+(T>=2?"s":"")},h:function(T){return"heure"+(T>=2?"s":"")},m:function(T){return"minute"+(T>=2?"s":"")},s:function(T){return"seconde"+(T>=2?"s":"")},ms:function(T){return"milliseconde"+(T>=2?"s":"")},decimal:","},gr:s,he:{y:function(T){return T===1?"\u05E9\u05E0\u05D4":"\u05E9\u05E0\u05D9\u05DD"},mo:function(T){return T===1?"\u05D7\u05D5\u05D3\u05E9":"\u05D7\u05D5\u05D3\u05E9\u05D9\u05DD"},w:function(T){return T===1?"\u05E9\u05D1\u05D5\u05E2":"\u05E9\u05D1\u05D5\u05E2\u05D5\u05EA"},d:function(T){return T===1?"\u05D9\u05D5\u05DD":"\u05D9\u05DE\u05D9\u05DD"},h:function(T){return T===1?"\u05E9\u05E2\u05D4":"\u05E9\u05E2\u05D5\u05EA"},m:function(T){return T===1?"\u05D3\u05E7\u05D4":"\u05D3\u05E7\u05D5\u05EA"},s:function(T){return T===1?"\u05E9\u05E0\u05D9\u05D4":"\u05E9\u05E0\u05D9\u05D5\u05EA"},ms:function(T){return T===1?"\u05DE\u05D9\u05DC\u05D9\u05E9\u05E0\u05D9\u05D9\u05D4":"\u05DE\u05D9\u05DC\u05D9\u05E9\u05E0\u05D9\u05D5\u05EA"},decimal:"."},hr:{y:function(T){return T%10===2||T%10===3||T%10===4?"godine":"godina"},mo:function(T){return T===1?"mjesec":T===2||T===3||T===4?"mjeseca":"mjeseci"},w:function(T){return T%10===1&&T!==11?"tjedan":"tjedna"},d:function(T){return T===1?"dan":"dana"},h:function(T){return T===1?"sat":T===2||T===3||T===4?"sata":"sati"},m:function(T){var we=T%10;return(we===2||we===3||we===4)&&(T<10||T>14)?"minute":"minuta"},s:function(T){var we=T%10;return we===5||Math.floor(T)===T&&T>=10&&T<=19?"sekundi":we===1?"sekunda":we===2||we===3||we===4?"sekunde":"sekundi"},ms:function(T){return T===1?"milisekunda":T%10===2||T%10===3||T%10===4?"milisekunde":"milisekundi"},decimal:","},hi:{y:"\u0938\u093E\u0932",mo:function(T){return T===1?"\u092E\u0939\u0940\u0928\u093E":"\u092E\u0939\u0940\u0928\u0947"},w:function(T){return T===1?"\u0939\u095E\u094D\u0924\u093E":"\u0939\u092B\u094D\u0924\u0947"},d:"\u0926\u093F\u0928",h:function(T){return T===1?"\u0918\u0902\u091F\u093E":"\u0918\u0902\u091F\u0947"},m:"\u092E\u093F\u0928\u091F",s:"\u0938\u0947\u0915\u0902\u0921",ms:"\u092E\u093F\u0932\u0940\u0938\u0947\u0915\u0902\u0921",decimal:"."},hu:{y:"\xE9v",mo:"h\xF3nap",w:"h\xE9t",d:"nap",h:"\xF3ra",m:"perc",s:"m\xE1sodperc",ms:"ezredm\xE1sodperc",decimal:","},id:{y:"tahun",mo:"bulan",w:"minggu",d:"hari",h:"jam",m:"menit",s:"detik",ms:"milidetik",decimal:"."},is:{y:"\xE1r",mo:function(T){return"m\xE1nu\xF0"+(T===1?"ur":"ir")},w:function(T){return"vik"+(T===1?"a":"ur")},d:function(T){return"dag"+(T===1?"ur":"ar")},h:function(T){return"klukkut\xEDm"+(T===1?"i":"ar")},m:function(T){return"m\xEDn\xFAt"+(T===1?"a":"ur")},s:function(T){return"sek\xFAnd"+(T===1?"a":"ur")},ms:function(T){return"millisek\xFAnd"+(T===1?"a":"ur")},decimal:"."},it:{y:function(T){return"ann"+(T===1?"o":"i")},mo:function(T){return"mes"+(T===1?"e":"i")},w:function(T){return"settiman"+(T===1?"a":"e")},d:function(T){return"giorn"+(T===1?"o":"i")},h:function(T){return"or"+(T===1?"a":"e")},m:function(T){return"minut"+(T===1?"o":"i")},s:function(T){return"second"+(T===1?"o":"i")},ms:function(T){return"millisecond"+(T===1?"o":"i")},decimal:","},ja:{y:"\u5E74",mo:"\u30F6\u6708",w:"\u9031",d:"\u65E5",h:"\u6642\u9593",m:"\u5206",s:"\u79D2",ms:"\u30DF\u30EA\u79D2",decimal:"."},km:{y:"\u1786\u17D2\u1793\u17B6\u17C6",mo:"\u1781\u17C2",w:"\u179F\u1794\u17D2\u178F\u17B6\u17A0\u17CD",d:"\u1790\u17D2\u1784\u17C3",h:"\u1798\u17C9\u17C4\u1784",m:"\u1793\u17B6\u1791\u17B8",s:"\u179C\u17B7\u1793\u17B6\u1791\u17B8",ms:"\u1798\u17B7\u179B\u17D2\u179B\u17B8\u179C\u17B7\u1793\u17B6\u1791\u17B8"},kn:{y:function(T){return T===1?"\u0CB5\u0CB0\u0CCD\u0CB7":"\u0CB5\u0CB0\u0CCD\u0CB7\u0C97\u0CB3\u0CC1"},mo:function(T){return T===1?"\u0CA4\u0CBF\u0C82\u0C97\u0CB3\u0CC1":"\u0CA4\u0CBF\u0C82\u0C97\u0CB3\u0CC1\u0C97\u0CB3\u0CC1"},w:function(T){return T===1?"\u0CB5\u0CBE\u0CB0":"\u0CB5\u0CBE\u0CB0\u0C97\u0CB3\u0CC1"},d:function(T){return T===1?"\u0CA6\u0CBF\u0CA8":"\u0CA6\u0CBF\u0CA8\u0C97\u0CB3\u0CC1"},h:function(T){return T===1?"\u0C97\u0C82\u0C9F\u0CC6":"\u0C97\u0C82\u0C9F\u0CC6\u0C97\u0CB3\u0CC1"},m:function(T){return T===1?"\u0CA8\u0CBF\u0CAE\u0CBF\u0CB7":"\u0CA8\u0CBF\u0CAE\u0CBF\u0CB7\u0C97\u0CB3\u0CC1"},s:function(T){return T===1?"\u0CB8\u0CC6\u0C95\u0CC6\u0C82\u0CA1\u0CCD":"\u0CB8\u0CC6\u0C95\u0CC6\u0C82\u0CA1\u0CC1\u0C97\u0CB3\u0CC1"},ms:function(T){return T===1?"\u0CAE\u0CBF\u0CB2\u0CBF\u0CB8\u0CC6\u0C95\u0CC6\u0C82\u0CA1\u0CCD":"\u0CAE\u0CBF\u0CB2\u0CBF\u0CB8\u0CC6\u0C95\u0CC6\u0C82\u0CA1\u0CC1\u0C97\u0CB3\u0CC1"}},ko:{y:"\uB144",mo:"\uAC1C\uC6D4",w:"\uC8FC\uC77C",d:"\uC77C",h:"\uC2DC\uAC04",m:"\uBD84",s:"\uCD08",ms:"\uBC00\uB9AC \uCD08",decimal:"."},ku:{y:"sal",mo:"meh",w:"hefte",d:"roj",h:"seet",m:"deqe",s:"saniye",ms:"m\xEEl\xEE\xE7irk",decimal:","},lo:{y:"\u0E9B\u0EB5",mo:"\u0EC0\u0E94\u0EB7\u0EAD\u0E99",w:"\u0EAD\u0EB2\u0E97\u0EB4\u0E94",d:"\u0EA1\u0EB7\u0EC9",h:"\u0E8A\u0EBB\u0EC8\u0EA7\u0EC2\u0EA1\u0E87",m:"\u0E99\u0EB2\u0E97\u0EB5",s:"\u0EA7\u0EB4\u0E99\u0EB2\u0E97\u0EB5",ms:"\u0EA1\u0EB4\u0E99\u0EA5\u0EB4\u0EA7\u0EB4\u0E99\u0EB2\u0E97\u0EB5",decimal:","},lt:{y:function(T){return T%10===0||T%100>=10&&T%100<=20?"met\u0173":"metai"},mo:function(T){return["m\u0117nuo","m\u0117nesiai","m\u0117nesi\u0173"][ye(T)]},w:function(T){return["savait\u0117","savait\u0117s","savai\u010Di\u0173"][ye(T)]},d:function(T){return["diena","dienos","dien\u0173"][ye(T)]},h:function(T){return["valanda","valandos","valand\u0173"][ye(T)]},m:function(T){return["minut\u0117","minut\u0117s","minu\u010Di\u0173"][ye(T)]},s:function(T){return["sekund\u0117","sekund\u0117s","sekund\u017Ei\u0173"][ye(T)]},ms:function(T){return["milisekund\u0117","milisekund\u0117s","milisekund\u017Ei\u0173"][ye(T)]},decimal:","},lv:{y:function(T){return Te(T)?"gads":"gadi"},mo:function(T){return Te(T)?"m\u0113nesis":"m\u0113ne\u0161i"},w:function(T){return Te(T)?"ned\u0113\u013Ca":"ned\u0113\u013Cas"},d:function(T){return Te(T)?"diena":"dienas"},h:function(T){return Te(T)?"stunda":"stundas"},m:function(T){return Te(T)?"min\u016Bte":"min\u016Btes"},s:function(T){return Te(T)?"sekunde":"sekundes"},ms:function(T){return Te(T)?"milisekunde":"milisekundes"},decimal:","},mk:{y:function(T){return T===1?"\u0433\u043E\u0434\u0438\u043D\u0430":"\u0433\u043E\u0434\u0438\u043D\u0438"},mo:function(T){return T===1?"\u043C\u0435\u0441\u0435\u0446":"\u043C\u0435\u0441\u0435\u0446\u0438"},w:function(T){return T===1?"\u043D\u0435\u0434\u0435\u043B\u0430":"\u043D\u0435\u0434\u0435\u043B\u0438"},d:function(T){return T===1?"\u0434\u0435\u043D":"\u0434\u0435\u043D\u0430"},h:function(T){return T===1?"\u0447\u0430\u0441":"\u0447\u0430\u0441\u0430"},m:function(T){return T===1?"\u043C\u0438\u043D\u0443\u0442\u0430":"\u043C\u0438\u043D\u0443\u0442\u0438"},s:function(T){return T===1?"\u0441\u0435\u043A\u0443\u043D\u0434\u0430":"\u0441\u0435\u043A\u0443\u043D\u0434\u0438"},ms:function(T){return T===1?"\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0430":"\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0438"},decimal:","},mr:{y:function(T){return T===1?"\u0935\u0930\u094D\u0937":"\u0935\u0930\u094D\u0937\u0947"},mo:function(T){return T===1?"\u092E\u0939\u093F\u0928\u093E":"\u092E\u0939\u093F\u0928\u0947"},w:function(T){return T===1?"\u0906\u0920\u0935\u0921\u093E":"\u0906\u0920\u0935\u0921\u0947"},d:"\u0926\u093F\u0935\u0938",h:"\u0924\u093E\u0938",m:function(T){return T===1?"\u092E\u093F\u0928\u093F\u091F":"\u092E\u093F\u0928\u093F\u091F\u0947"},s:"\u0938\u0947\u0915\u0902\u0926",ms:"\u092E\u093F\u0932\u093F\u0938\u0947\u0915\u0902\u0926"},ms:{y:"tahun",mo:"bulan",w:"minggu",d:"hari",h:"jam",m:"minit",s:"saat",ms:"milisaat",decimal:"."},nl:{y:"jaar",mo:function(T){return T===1?"maand":"maanden"},w:function(T){return T===1?"week":"weken"},d:function(T){return T===1?"dag":"dagen"},h:"uur",m:function(T){return T===1?"minuut":"minuten"},s:function(T){return T===1?"seconde":"seconden"},ms:function(T){return T===1?"milliseconde":"milliseconden"},decimal:","},no:{y:"\xE5r",mo:function(T){return"m\xE5ned"+(T===1?"":"er")},w:function(T){return"uke"+(T===1?"":"r")},d:function(T){return"dag"+(T===1?"":"er")},h:function(T){return"time"+(T===1?"":"r")},m:function(T){return"minutt"+(T===1?"":"er")},s:function(T){return"sekund"+(T===1?"":"er")},ms:function(T){return"millisekund"+(T===1?"":"er")},decimal:","},pl:{y:function(T){return["rok","roku","lata","lat"][$(T)]},mo:function(T){return["miesi\u0105c","miesi\u0105ca","miesi\u0105ce","miesi\u0119cy"][$(T)]},w:function(T){return["tydzie\u0144","tygodnia","tygodnie","tygodni"][$(T)]},d:function(T){return["dzie\u0144","dnia","dni","dni"][$(T)]},h:function(T){return["godzina","godziny","godziny","godzin"][$(T)]},m:function(T){return["minuta","minuty","minuty","minut"][$(T)]},s:function(T){return["sekunda","sekundy","sekundy","sekund"][$(T)]},ms:function(T){return["milisekunda","milisekundy","milisekundy","milisekund"][$(T)]},decimal:","},pt:{y:function(T){return"ano"+(T===1?"":"s")},mo:function(T){return T===1?"m\xEAs":"meses"},w:function(T){return"semana"+(T===1?"":"s")},d:function(T){return"dia"+(T===1?"":"s")},h:function(T){return"hora"+(T===1?"":"s")},m:function(T){return"minuto"+(T===1?"":"s")},s:function(T){return"segundo"+(T===1?"":"s")},ms:function(T){return"milissegundo"+(T===1?"":"s")},decimal:","},ro:{y:function(T){return T===1?"an":"ani"},mo:function(T){return T===1?"lun\u0103":"luni"},w:function(T){return T===1?"s\u0103pt\u0103m\xE2n\u0103":"s\u0103pt\u0103m\xE2ni"},d:function(T){return T===1?"zi":"zile"},h:function(T){return T===1?"or\u0103":"ore"},m:function(T){return T===1?"minut":"minute"},s:function(T){return T===1?"secund\u0103":"secunde"},ms:function(T){return T===1?"milisecund\u0103":"milisecunde"},decimal:","},ru:{y:function(T){return["\u043B\u0435\u0442","\u0433\u043E\u0434","\u0433\u043E\u0434\u0430"][J(T)]},mo:function(T){return["\u043C\u0435\u0441\u044F\u0446\u0435\u0432","\u043C\u0435\u0441\u044F\u0446","\u043C\u0435\u0441\u044F\u0446\u0430"][J(T)]},w:function(T){return["\u043D\u0435\u0434\u0435\u043B\u044C","\u043D\u0435\u0434\u0435\u043B\u044F","\u043D\u0435\u0434\u0435\u043B\u0438"][J(T)]},d:function(T){return["\u0434\u043D\u0435\u0439","\u0434\u0435\u043D\u044C","\u0434\u043D\u044F"][J(T)]},h:function(T){return["\u0447\u0430\u0441\u043E\u0432","\u0447\u0430\u0441","\u0447\u0430\u0441\u0430"][J(T)]},m:function(T){return["\u043C\u0438\u043D\u0443\u0442","\u043C\u0438\u043D\u0443\u0442\u0430","\u043C\u0438\u043D\u0443\u0442\u044B"][J(T)]},s:function(T){return["\u0441\u0435\u043A\u0443\u043D\u0434","\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u0441\u0435\u043A\u0443\u043D\u0434\u044B"][J(T)]},ms:function(T){return["\u043C\u0438\u043B\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434","\u043C\u0438\u043B\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u043C\u0438\u043B\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u044B"][J(T)]},decimal:","},sq:{y:function(T){return T===1?"vit":"vjet"},mo:"muaj",w:"jav\xEB",d:"dit\xEB",h:"or\xEB",m:function(T){return"minut"+(T===1?"\xEB":"a")},s:function(T){return"sekond"+(T===1?"\xEB":"a")},ms:function(T){return"milisekond"+(T===1?"\xEB":"a")},decimal:","},sr:{y:function(T){return["\u0433\u043E\u0434\u0438\u043D\u0438","\u0433\u043E\u0434\u0438\u043D\u0430","\u0433\u043E\u0434\u0438\u043D\u0435"][J(T)]},mo:function(T){return["\u043C\u0435\u0441\u0435\u0446\u0438","\u043C\u0435\u0441\u0435\u0446","\u043C\u0435\u0441\u0435\u0446\u0430"][J(T)]},w:function(T){return["\u043D\u0435\u0434\u0435\u0459\u0438","\u043D\u0435\u0434\u0435\u0459\u0430","\u043D\u0435\u0434\u0435\u0459\u0435"][J(T)]},d:function(T){return["\u0434\u0430\u043D\u0438","\u0434\u0430\u043D","\u0434\u0430\u043D\u0430"][J(T)]},h:function(T){return["\u0441\u0430\u0442\u0438","\u0441\u0430\u0442","\u0441\u0430\u0442\u0430"][J(T)]},m:function(T){return["\u043C\u0438\u043D\u0443\u0442\u0430","\u043C\u0438\u043D\u0443\u0442","\u043C\u0438\u043D\u0443\u0442\u0430"][J(T)]},s:function(T){return["\u0441\u0435\u043A\u0443\u043D\u0434\u0438","\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u0441\u0435\u043A\u0443\u043D\u0434\u0435"][J(T)]},ms:function(T){return["\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0438","\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0435"][J(T)]},decimal:","},ta:{y:function(T){return T===1?"\u0BB5\u0BB0\u0BC1\u0B9F\u0BAE\u0BCD":"\u0B86\u0BA3\u0BCD\u0B9F\u0BC1\u0B95\u0BB3\u0BCD"},mo:function(T){return T===1?"\u0BAE\u0BBE\u0BA4\u0BAE\u0BCD":"\u0BAE\u0BBE\u0BA4\u0B99\u0BCD\u0B95\u0BB3\u0BCD"},w:function(T){return T===1?"\u0BB5\u0BBE\u0BB0\u0BAE\u0BCD":"\u0BB5\u0BBE\u0BB0\u0B99\u0BCD\u0B95\u0BB3\u0BCD"},d:function(T){return T===1?"\u0BA8\u0BBE\u0BB3\u0BCD":"\u0BA8\u0BBE\u0B9F\u0BCD\u0B95\u0BB3\u0BCD"},h:function(T){return T===1?"\u0BAE\u0BA3\u0BBF":"\u0BAE\u0BA3\u0BBF\u0BA8\u0BC7\u0BB0\u0BAE\u0BCD"},m:function(T){return"\u0BA8\u0BBF\u0BAE\u0BBF\u0B9F"+(T===1?"\u0BAE\u0BCD":"\u0B99\u0BCD\u0B95\u0BB3\u0BCD")},s:function(T){return"\u0BB5\u0BBF\u0BA9\u0BBE\u0B9F\u0BBF"+(T===1?"":"\u0B95\u0BB3\u0BCD")},ms:function(T){return"\u0BAE\u0BBF\u0BB2\u0BCD\u0BB2\u0BBF \u0BB5\u0BBF\u0BA8\u0BBE\u0B9F\u0BBF"+(T===1?"":"\u0B95\u0BB3\u0BCD")}},te:{y:function(T){return"\u0C38\u0C02\u0C35\u0C24\u0C4D\u0C38"+(T===1?"\u0C30\u0C02":"\u0C30\u0C3E\u0C32")},mo:function(T){return"\u0C28\u0C46\u0C32"+(T===1?"":"\u0C32")},w:function(T){return T===1?"\u0C35\u0C3E\u0C30\u0C02":"\u0C35\u0C3E\u0C30\u0C3E\u0C32\u0C41"},d:function(T){return"\u0C30\u0C4B\u0C1C\u0C41"+(T===1?"":"\u0C32\u0C41")},h:function(T){return"\u0C17\u0C02\u0C1F"+(T===1?"":"\u0C32\u0C41")},m:function(T){return T===1?"\u0C28\u0C3F\u0C2E\u0C3F\u0C37\u0C02":"\u0C28\u0C3F\u0C2E\u0C3F\u0C37\u0C3E\u0C32\u0C41"},s:function(T){return T===1?"\u0C38\u0C46\u0C15\u0C28\u0C41":"\u0C38\u0C46\u0C15\u0C28\u0C4D\u0C32\u0C41"},ms:function(T){return T===1?"\u0C2E\u0C3F\u0C32\u0C4D\u0C32\u0C40\u0C38\u0C46\u0C15\u0C28\u0C4D":"\u0C2E\u0C3F\u0C32\u0C4D\u0C32\u0C40\u0C38\u0C46\u0C15\u0C28\u0C4D\u0C32\u0C41"}},uk:{y:function(T){return["\u0440\u043E\u043A\u0456\u0432","\u0440\u0456\u043A","\u0440\u043E\u043A\u0438"][J(T)]},mo:function(T){return["\u043C\u0456\u0441\u044F\u0446\u0456\u0432","\u043C\u0456\u0441\u044F\u0446\u044C","\u043C\u0456\u0441\u044F\u0446\u0456"][J(T)]},w:function(T){return["\u0442\u0438\u0436\u043D\u0456\u0432","\u0442\u0438\u0436\u0434\u0435\u043D\u044C","\u0442\u0438\u0436\u043D\u0456"][J(T)]},d:function(T){return["\u0434\u043D\u0456\u0432","\u0434\u0435\u043D\u044C","\u0434\u043D\u0456"][J(T)]},h:function(T){return["\u0433\u043E\u0434\u0438\u043D","\u0433\u043E\u0434\u0438\u043D\u0430","\u0433\u043E\u0434\u0438\u043D\u0438"][J(T)]},m:function(T){return["\u0445\u0432\u0438\u043B\u0438\u043D","\u0445\u0432\u0438\u043B\u0438\u043D\u0430","\u0445\u0432\u0438\u043B\u0438\u043D\u0438"][J(T)]},s:function(T){return["\u0441\u0435\u043A\u0443\u043D\u0434","\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u0441\u0435\u043A\u0443\u043D\u0434\u0438"][J(T)]},ms:function(T){return["\u043C\u0456\u043B\u0456\u0441\u0435\u043A\u0443\u043D\u0434","\u043C\u0456\u043B\u0456\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u043C\u0456\u043B\u0456\u0441\u0435\u043A\u0443\u043D\u0434\u0438"][J(T)]},decimal:","},ur:{y:"\u0633\u0627\u0644",mo:function(T){return T===1?"\u0645\u06C1\u06CC\u0646\u06C1":"\u0645\u06C1\u06CC\u0646\u06D2"},w:function(T){return T===1?"\u06C1\u0641\u062A\u06C1":"\u06C1\u0641\u062A\u06D2"},d:"\u062F\u0646",h:function(T){return T===1?"\u06AF\u06BE\u0646\u0679\u06C1":"\u06AF\u06BE\u0646\u0679\u06D2"},m:"\u0645\u0646\u0679",s:"\u0633\u06CC\u06A9\u0646\u0688",ms:"\u0645\u0644\u06CC \u0633\u06CC\u06A9\u0646\u0688",decimal:"."},sk:{y:function(T){return["rok","roky","roky","rokov"][G(T)]},mo:function(T){return["mesiac","mesiace","mesiace","mesiacov"][G(T)]},w:function(T){return["t\xFD\u017Ede\u0148","t\xFD\u017Edne","t\xFD\u017Edne","t\xFD\u017Ed\u0148ov"][G(T)]},d:function(T){return["de\u0148","dni","dni","dn\xED"][G(T)]},h:function(T){return["hodina","hodiny","hodiny","hod\xEDn"][G(T)]},m:function(T){return["min\xFAta","min\xFAty","min\xFAty","min\xFAt"][G(T)]},s:function(T){return["sekunda","sekundy","sekundy","sek\xFAnd"][G(T)]},ms:function(T){return["milisekunda","milisekundy","milisekundy","milisek\xFAnd"][G(T)]},decimal:","},sl:{y:function(T){return T%10===1?"leto":T%100===2?"leti":T%100===3||T%100===4||Math.floor(T)!==T&&T%100<=5?"leta":"let"},mo:function(T){return T%10===1?"mesec":T%100===2||Math.floor(T)!==T&&T%100<=5?"meseca":T%10===3||T%10===4?"mesece":"mesecev"},w:function(T){return T%10===1?"teden":T%10===2||Math.floor(T)!==T&&T%100<=4?"tedna":T%10===3||T%10===4?"tedne":"tednov"},d:function(T){return T%100===1?"dan":"dni"},h:function(T){return T%10===1?"ura":T%100===2?"uri":T%10===3||T%10===4||Math.floor(T)!==T?"ure":"ur"},m:function(T){return T%10===1?"minuta":T%10===2?"minuti":T%10===3||T%10===4||Math.floor(T)!==T&&T%100<=4?"minute":"minut"},s:function(T){return T%10===1?"sekunda":T%100===2?"sekundi":T%100===3||T%100===4||Math.floor(T)!==T?"sekunde":"sekund"},ms:function(T){return T%10===1?"milisekunda":T%100===2?"milisekundi":T%100===3||T%100===4||Math.floor(T)!==T?"milisekunde":"milisekund"},decimal:","},sv:{y:"\xE5r",mo:function(T){return"m\xE5nad"+(T===1?"":"er")},w:function(T){return"veck"+(T===1?"a":"or")},d:function(T){return"dag"+(T===1?"":"ar")},h:function(T){return"timm"+(T===1?"e":"ar")},m:function(T){return"minut"+(T===1?"":"er")},s:function(T){return"sekund"+(T===1?"":"er")},ms:function(T){return"millisekund"+(T===1?"":"er")},decimal:","},sw:{y:function(T){return T===1?"mwaka":"miaka"},mo:function(T){return T===1?"mwezi":"miezi"},w:"wiki",d:function(T){return T===1?"siku":"masiku"},h:function(T){return T===1?"saa":"masaa"},m:"dakika",s:"sekunde",ms:"milisekunde",decimal:"."},tr:{y:"y\u0131l",mo:"ay",w:"hafta",d:"g\xFCn",h:"saat",m:"dakika",s:"saniye",ms:"milisaniye",decimal:","},th:{y:"\u0E1B\u0E35",mo:"\u0E40\u0E14\u0E37\u0E2D\u0E19",w:"\u0E2A\u0E31\u0E1B\u0E14\u0E32\u0E2B\u0E4C",d:"\u0E27\u0E31\u0E19",h:"\u0E0A\u0E31\u0E48\u0E27\u0E42\u0E21\u0E07",m:"\u0E19\u0E32\u0E17\u0E35",s:"\u0E27\u0E34\u0E19\u0E32\u0E17\u0E35",ms:"\u0E21\u0E34\u0E25\u0E25\u0E34\u0E27\u0E34\u0E19\u0E32\u0E17\u0E35",decimal:"."},vi:{y:"n\u0103m",mo:"th\xE1ng",w:"tu\u1EA7n",d:"ng\xE0y",h:"gi\u1EDD",m:"ph\xFAt",s:"gi\xE2y",ms:"mili gi\xE2y",decimal:","},zh_CN:{y:"\u5E74",mo:"\u4E2A\u6708",w:"\u5468",d:"\u5929",h:"\u5C0F\u65F6",m:"\u5206\u949F",s:"\u79D2",ms:"\u6BEB\u79D2",decimal:"."},zh_TW:{y:"\u5E74",mo:"\u500B\u6708",w:"\u5468",d:"\u5929",h:"\u5C0F\u6642",m:"\u5206\u9418",s:"\u79D2",ms:"\u6BEB\u79D2",decimal:"."}};function x(T){var we=function(qe,xe){var Se=U({},we,xe||{});return o(qe,Se)};return U(we,{language:"en",spacer:" ",conjunction:"",serialComma:!0,units:["y","mo","w","d","h","m","s"],languages:{},round:!1,unitMeasures:{y:315576e5,mo:26298e5,w:6048e5,d:864e5,h:36e5,m:6e4,s:1e3,ms:1}},T)}var S=x({});function z(T){var we=[T.language];if(Ve(T,"fallbacks"))if(Ue(T.fallbacks)&&T.fallbacks.length)we=we.concat(T.fallbacks);else throw new Error("fallbacks must be an array with at least one element");for(var Le=0;Le<we.length;Le++){var qe=we[Le];if(Ve(T.languages,qe))return T.languages[qe];if(Ve(_,qe))return _[qe]}throw new Error("No language found.")}function o(T,we){var Le,qe,xe;T=Math.abs(T);var Se=z(we),Oe=[],Ye,rt,st;for(Le=0,qe=we.units.length;Le<qe;Le++){if(Ye=we.units[Le],rt=we.unitMeasures[Ye],Le+1===qe)if(Ve(we,"maxDecimalPoints")){var wt=Math.pow(10,we.maxDecimalPoints),di=T/rt;st=parseFloat((Math.floor(wt*di)/wt).toFixed(we.maxDecimalPoints))}else st=T/rt;else st=Math.floor(T/rt);Oe.push({unitCount:st,unitName:Ye}),T-=st*rt}var Si=0;for(Le=0;Le<Oe.length;Le++)if(Oe[Le].unitCount){Si=Le;break}if(we.round){var Nt,Ni;for(Le=Oe.length-1;Le>=0&&(xe=Oe[Le],xe.unitCount=Math.round(xe.unitCount),Le!==0);Le--)Ni=Oe[Le-1],Nt=we.unitMeasures[Ni.unitName]/we.unitMeasures[xe.unitName],(xe.unitCount%Nt===0||we.largest&&we.largest-1<Le-Si)&&(Ni.unitCount+=xe.unitCount/Nt,xe.unitCount=0)}var qt=[];for(Le=0,Oe.length;Le<qe&&(xe=Oe[Le],xe.unitCount&&qt.push(j(xe.unitCount,xe.unitName,Se,we)),qt.length!==we.largest);Le++);if(qt.length){var Ct;if(Ve(we,"delimiter")?Ct=we.delimiter:Ve(Se,"delimiter")?Ct=Se.delimiter:Ct=", ",!we.conjunction||qt.length===1)return qt.join(Ct);if(qt.length===2)return qt.join(we.conjunction);if(qt.length>2)return qt.slice(0,-1).join(Ct)+(we.serialComma?",":"")+we.conjunction+qt.slice(-1)}else return j(0,we.units[we.units.length-1],Se,we)}function j(T,we,Le,qe){var xe;Ve(qe,"decimal")?xe=qe.decimal:Ve(Le,"decimal")?xe=Le.decimal:xe=".";var Se;typeof Le._formatCount=="function"?Se=Le._formatCount(T,xe):Se=T.toString().replace(".",xe);var Oe=Le[we],Ye;return typeof Oe=="function"?Ye=Oe(T):Ye=Oe,Se+qe.spacer+Ye}function U(T){for(var we,Le=1;Le<arguments.length;Le++){we=arguments[Le];for(var qe in we)Ve(we,qe)&&(T[qe]=we[qe])}return T}function F(T){return T===1?0:T===2?1:T>2&&T<11?2:0}function $(T){return T===1?0:Math.floor(T)!==T?1:T%10>=2&&T%10<=4&&!(T%100>10&&T%100<20)?2:3}function J(T){return Math.floor(T)!==T?2:T%100>=5&&T%100<=20||T%10>=5&&T%10<=9||T%10===0?0:T%10===1?1:T>1?2:0}function G(T){return T===1?0:Math.floor(T)!==T?1:T%10>=2&&T%10<=4&&T%100<10?2:3}function ye(T){return T===1||T%10===1&&T%100>20?0:Math.floor(T)!==T||T%10>=2&&T%100>20||T%10>=2&&T%100<10?1:2}function Te(T){return T%10===1&&T%100!==11}var Ue=Array.isArray||function(T){return Object.prototype.toString.call(T)==="[object Array]"};function Ve(T,we){return Object.prototype.hasOwnProperty.call(T,we)}S.getSupportedLanguages=function(){var we=[];for(var Le in _)Ve(_,Le)&&Le!=="gr"&&we.push(Le);return we},S.humanizer=x,c.exports?c.exports=S:this.humanizeDuration=S})()})(Wv);var BS=Wv.exports;const sS=Math.asin,by=Math.cos,lS=Math.sin,cS=Math.sqrt,uS=Math.PI,hS=6378137;function dS(c){return c*c}function rd(c){return c*uS/180}function wy(c){return dS(lS(c/2))}function fS(c,s){const p=rd(Array.isArray(c)?c[1]:c.latitude||c.lat),_=rd(Array.isArray(s)?s[1]:s.latitude||s.lat),x=rd(Array.isArray(c)?c[0]:c.longitude||c.lng||c.lon),S=rd(Array.isArray(s)?s[0]:s.longitude||s.lng||s.lon),z=wy(_-p)+by(p)*by(_)*wy(S-x);return 2*hS*sS(cS(z))}var OS=fS,pS=["bottom","height","left","right","top","width"],mS=function(s,p){return s===void 0&&(s={}),p===void 0&&(p={}),pS.some(function(_){return s[_]!==p[_]})},va=new Map,Xv,_S=function c(){var s=[];va.forEach(function(p,_){var x=_.getBoundingClientRect();mS(x,p.rect)&&(p.rect=x,s.push(p))}),s.forEach(function(p){p.callbacks.forEach(function(_){return _(p.rect)})}),Xv=window.requestAnimationFrame(c)};function gS(c,s){return{observe:function(){var _=va.size===0;va.has(c)?va.get(c).callbacks.push(s):va.set(c,{rect:void 0,hasRectChanged:!1,callbacks:[s]}),_&&_S()},unobserve:function(){var _=va.get(c);if(_){var x=_.callbacks.indexOf(s);x>=0&&_.callbacks.splice(x,1),_.callbacks.length||va.delete(c),va.size||cancelAnimationFrame(Xv)}}}}function yS(){return!!(typeof window!="undefined"&&window.document&&window.document.createElement)}var pp=yS()?fs:si;function vS(c){return typeof c=="boolean"}function xS(c){return!!(c&&{}.toString.call(c)=="[object Function]")}function FS(c,s,p){var _,x;if(vS(s))_=s;else{var S;_=(S=s==null?void 0:s.observe)!=null?S:!0,x=s==null?void 0:s.onChange}xS(p)&&(x=p);var z=mn(c.current),o=z[0],j=z[1],U=Et(!1),F=Et(!1),$=mn(null),J=$[0],G=$[1],ye=Et(x);return pp(function(){ye.current=x,c.current!==o&&j(c.current)}),pp(function(){o&&!U.current&&(U.current=!0,G(o.getBoundingClientRect()))},[o]),pp(function(){if(!!_){var Te=o;if(F.current||(F.current=!0,Te=c.current),!!Te){var Ue=gS(Te,function(Ve){ye.current==null||ye.current(Ve),G(Ve)});return Ue.observe(),function(){Ue.unobserve()}}}},[_,o,c]),J}function US(c,s){const p=Et(null),_=()=>{let S,z;return"hidden"in document?(S="hidden",z="visibilitychange"):"mozHidden"in document?(S="mozHidden",z="mozvisibilitychange"):"webkitHidden"in document&&(S="webkitHidden",z="webkitvisibilitychange"),{hidden:S,visibilityChange:z}},x=()=>clearTimeout(p.current);si(()=>{const{hidden:S,visibilityChange:z}=_();if(typeof c!="function")throw new Error("callback must be a function");const o=()=>{if(s){if(typeof s!="number"||s<0)throw new Error("delay must be a positive integer");p.current&&x(),p.current=setTimeout(()=>c(!document[S]),s)}else c(!document[S])};return document.addEventListener(z,o),()=>{document.removeEventListener(z,o)}},[c])}var bS=Z1(T1),wS,TS,SS,Up=bS,ES=0;function Ty(c,s,p,_,x){var S,z,o={};for(z in s)z=="ref"?S=s[z]:o[z]=s[z];var j={type:c,props:o,key:p,ref:S,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--ES,__source:_,__self:x};if(typeof c=="function"&&(S=c.defaultProps))for(z in S)o[z]===void 0&&(o[z]=S[z]);return Up.options.vnode&&Up.options.vnode(j),j}SS=Up.Fragment,TS=Ty,wS=Ty;export{DS as A,SS as F,MS as G,LS as J,PS as L,Hy as M,kS as N,zS as S,wS as a,ui as b,US as c,Kr as d,IS as e,CS as f,od as g,OS as h,BS as i,TS as j,C1 as k,mn as l,q1 as m,kl as n,G1 as o,RS as p,Z1 as q,mu as r,Et as s,FS as u,si as y};
//# sourceMappingURL=vendor.2e68580d.js.map
