var Pb=Object.defineProperty,Db=Object.defineProperties;var Lb=Object.getOwnPropertyDescriptors;var jg=Object.getOwnPropertySymbols;var Rb=Object.prototype.hasOwnProperty,Ob=Object.prototype.propertyIsEnumerable;var Vg=(n,s,h)=>s in n?Pb(n,s,{enumerable:!0,configurable:!0,writable:!0,value:h}):n[s]=h,_n=(n,s)=>{for(var h in s||(s={}))Rb.call(s,h)&&Vg(n,h,s[h]);if(jg)for(var h of jg(s))Ob.call(s,h)&&Vg(n,h,s[h]);return n},Cl=(n,s)=>Db(n,Lb(s));function Bb(n,s){return s.forEach(function(h){h&&typeof h!="string"&&!Array.isArray(h)&&Object.keys(h).forEach(function(m){if(m!=="default"&&!(m in n)){var v=Object.getOwnPropertyDescriptor(h,m);Object.defineProperty(n,m,v.get?v:{enumerable:!0,get:function(){return h[m]}})}})}),Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var Au,_t,lv,cv,lu,uv,$g,hv,Cd={},dv=[],Fb=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function Ko(n,s){for(var h in s)n[h]=s[h];return n}function fv(n){var s=n.parentNode;s&&s.removeChild(n)}function vn(n,s,h){var m,v,b,M={};for(b in s)b=="key"?m=s[b]:b=="ref"?v=s[b]:M[b]=s[b];if(arguments.length>2&&(M.children=arguments.length>3?Au.call(arguments,2):h),typeof n=="function"&&n.defaultProps!=null)for(b in n.defaultProps)M[b]===void 0&&(M[b]=n.defaultProps[b]);return cu(n,M,m,v,null)}function cu(n,s,h,m,v){var b={type:n,props:s,key:h,ref:m,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:v==null?++lv:v};return v==null&&_t.vnode!=null&&_t.vnode(b),b}function pv(){return{current:null}}function Yo(n){return n.children}function ao(n,s){this.props=n,this.context=s}function Ul(n,s){if(s==null)return n.__?Ul(n.__,n.__.__k.indexOf(n)+1):null;for(var h;s<n.__k.length;s++)if((h=n.__k[s])!=null&&h.__e!=null)return h.__e;return typeof n.type=="function"?Ul(n):null}function mv(n){var s,h;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,s=0;s<n.__k.length;s++)if((h=n.__k[s])!=null&&h.__e!=null){n.__e=n.__c.base=h.__e;break}return mv(n)}}function Np(n){(!n.__d&&(n.__d=!0)&&lu.push(n)&&!Md.__r++||$g!==_t.debounceRendering)&&(($g=_t.debounceRendering)||uv)(Md)}function Md(){for(var n;Md.__r=lu.length;)n=lu.sort(function(s,h){return s.__v.__b-h.__v.__b}),lu=[],n.some(function(s){var h,m,v,b,M,a;s.__d&&(M=(b=(h=s).__v).__e,(a=h.__P)&&(m=[],(v=Ko({},b)).__v=b.__v+1,dm(a,b,v,h.__n,a.ownerSVGElement!==void 0,b.__h!=null?[M]:null,m,M==null?Ul(b):M,b.__h),vv(m,b),b.__e!=M&&mv(b)))})}function _v(n,s,h,m,v,b,M,a,L,F){var B,j,q,G,he,be,we,Ie=m&&m.__k||dv,E=Ie.length;for(h.__k=[],B=0;B<s.length;B++)if((G=h.__k[B]=(G=s[B])==null||typeof G=="boolean"?null:typeof G=="string"||typeof G=="number"||typeof G=="bigint"?cu(null,G,null,null,G):Array.isArray(G)?cu(Yo,{children:G},null,null,null):G.__b>0?cu(G.type,G.props,G.key,null,G.__v):G)!=null){if(G.__=h,G.__b=h.__b+1,(q=Ie[B])===null||q&&G.key==q.key&&G.type===q.type)Ie[B]=void 0;else for(j=0;j<E;j++){if((q=Ie[j])&&G.key==q.key&&G.type===q.type){Ie[j]=void 0;break}q=null}dm(n,G,q=q||Cd,v,b,M,a,L,F),he=G.__e,(j=G.ref)&&q.ref!=j&&(we||(we=[]),q.ref&&we.push(q.ref,null,G),we.push(j,G.__c||he,G)),he!=null?(be==null&&(be=he),typeof G.type=="function"&&G.__k===q.__k?G.__d=L=gv(G,L,n):L=yv(n,G,q,Ie,he,L),typeof h.type=="function"&&(h.__d=L)):L&&q.__e==L&&L.parentNode!=n&&(L=Ul(q))}for(h.__e=be,B=E;B--;)Ie[B]!=null&&(typeof h.type=="function"&&Ie[B].__e!=null&&Ie[B].__e==h.__d&&(h.__d=Ul(m,B+1)),bv(Ie[B],Ie[B]));if(we)for(B=0;B<we.length;B++)xv(we[B],we[++B],we[++B])}function gv(n,s,h){for(var m,v=n.__k,b=0;v&&b<v.length;b++)(m=v[b])&&(m.__=n,s=typeof m.type=="function"?gv(m,s,h):yv(h,m,m,v,m.__e,s));return s}function Po(n,s){return s=s||[],n==null||typeof n=="boolean"||(Array.isArray(n)?n.some(function(h){Po(h,s)}):s.push(n)),s}function yv(n,s,h,m,v,b){var M,a,L;if(s.__d!==void 0)M=s.__d,s.__d=void 0;else if(h==null||v!=b||v.parentNode==null)e:if(b==null||b.parentNode!==n)n.appendChild(v),M=null;else{for(a=b,L=0;(a=a.nextSibling)&&L<m.length;L+=2)if(a==v)break e;n.insertBefore(v,b),M=b}return M!==void 0?M:v.nextSibling}function Nb(n,s,h,m,v){var b;for(b in h)b==="children"||b==="key"||b in s||Id(n,b,null,h[b],m);for(b in s)v&&typeof s[b]!="function"||b==="children"||b==="key"||b==="value"||b==="checked"||h[b]===s[b]||Id(n,b,s[b],h[b],m)}function Gg(n,s,h){s[0]==="-"?n.setProperty(s,h):n[s]=h==null?"":typeof h!="number"||Fb.test(s)?h:h+"px"}function Id(n,s,h,m,v){var b;e:if(s==="style")if(typeof h=="string")n.style.cssText=h;else{if(typeof m=="string"&&(n.style.cssText=m=""),m)for(s in m)h&&s in h||Gg(n.style,s,"");if(h)for(s in h)m&&h[s]===m[s]||Gg(n.style,s,h[s])}else if(s[0]==="o"&&s[1]==="n")b=s!==(s=s.replace(/Capture$/,"")),s=s.toLowerCase()in n?s.toLowerCase().slice(2):s.slice(2),n.l||(n.l={}),n.l[s+b]=h,h?m||n.addEventListener(s,b?Zg:qg,b):n.removeEventListener(s,b?Zg:qg,b);else if(s!=="dangerouslySetInnerHTML"){if(v)s=s.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if(s!=="href"&&s!=="list"&&s!=="form"&&s!=="tabIndex"&&s!=="download"&&s in n)try{n[s]=h==null?"":h;break e}catch{}typeof h=="function"||(h!=null&&(h!==!1||s[0]==="a"&&s[1]==="r")?n.setAttribute(s,h):n.removeAttribute(s))}}function qg(n){this.l[n.type+!1](_t.event?_t.event(n):n)}function Zg(n){this.l[n.type+!0](_t.event?_t.event(n):n)}function dm(n,s,h,m,v,b,M,a,L){var F,B,j,q,G,he,be,we,Ie,E,ye,Le=s.type;if(s.constructor!==void 0)return null;h.__h!=null&&(L=h.__h,a=s.__e=h.__e,s.__h=null,b=[a]),(F=_t.__b)&&F(s);try{e:if(typeof Le=="function"){if(we=s.props,Ie=(F=Le.contextType)&&m[F.__c],E=F?Ie?Ie.props.value:F.__:m,h.__c?be=(B=s.__c=h.__c).__=B.__E:("prototype"in Le&&Le.prototype.render?s.__c=B=new Le(we,E):(s.__c=B=new ao(we,E),B.constructor=Le,B.render=jb),Ie&&Ie.sub(B),B.props=we,B.state||(B.state={}),B.context=E,B.__n=m,j=B.__d=!0,B.__h=[]),B.__s==null&&(B.__s=B.state),Le.getDerivedStateFromProps!=null&&(B.__s==B.state&&(B.__s=Ko({},B.__s)),Ko(B.__s,Le.getDerivedStateFromProps(we,B.__s))),q=B.props,G=B.state,j)Le.getDerivedStateFromProps==null&&B.componentWillMount!=null&&B.componentWillMount(),B.componentDidMount!=null&&B.__h.push(B.componentDidMount);else{if(Le.getDerivedStateFromProps==null&&we!==q&&B.componentWillReceiveProps!=null&&B.componentWillReceiveProps(we,E),!B.__e&&B.shouldComponentUpdate!=null&&B.shouldComponentUpdate(we,B.__s,E)===!1||s.__v===h.__v){B.props=we,B.state=B.__s,s.__v!==h.__v&&(B.__d=!1),B.__v=s,s.__e=h.__e,s.__k=h.__k,s.__k.forEach(function(Re){Re&&(Re.__=s)}),B.__h.length&&M.push(B);break e}B.componentWillUpdate!=null&&B.componentWillUpdate(we,B.__s,E),B.componentDidUpdate!=null&&B.__h.push(function(){B.componentDidUpdate(q,G,he)})}B.context=E,B.props=we,B.state=B.__s,(F=_t.__r)&&F(s),B.__d=!1,B.__v=s,B.__P=n,F=B.render(B.props,B.state,B.context),B.state=B.__s,B.getChildContext!=null&&(m=Ko(Ko({},m),B.getChildContext())),j||B.getSnapshotBeforeUpdate==null||(he=B.getSnapshotBeforeUpdate(q,G)),ye=F!=null&&F.type===Yo&&F.key==null?F.props.children:F,_v(n,Array.isArray(ye)?ye:[ye],s,h,m,v,b,M,a,L),B.base=s.__e,s.__h=null,B.__h.length&&M.push(B),be&&(B.__E=B.__=null),B.__e=!1}else b==null&&s.__v===h.__v?(s.__k=h.__k,s.__e=h.__e):s.__e=Ub(h.__e,s,h,m,v,b,M,L);(F=_t.diffed)&&F(s)}catch(Re){s.__v=null,(L||b!=null)&&(s.__e=a,s.__h=!!L,b[b.indexOf(a)]=null),_t.__e(Re,s,h)}}function vv(n,s){_t.__c&&_t.__c(s,n),n.some(function(h){try{n=h.__h,h.__h=[],n.some(function(m){m.call(h)})}catch(m){_t.__e(m,h.__v)}})}function Ub(n,s,h,m,v,b,M,a){var L,F,B,j=h.props,q=s.props,G=s.type,he=0;if(G==="svg"&&(v=!0),b!=null){for(;he<b.length;he++)if((L=b[he])&&"setAttribute"in L==!!G&&(G?L.localName===G:L.nodeType===3)){n=L,b[he]=null;break}}if(n==null){if(G===null)return document.createTextNode(q);n=v?document.createElementNS("http://www.w3.org/2000/svg",G):document.createElement(G,q.is&&q),b=null,a=!1}if(G===null)j===q||a&&n.data===q||(n.data=q);else{if(b=b&&Au.call(n.childNodes),F=(j=h.props||Cd).dangerouslySetInnerHTML,B=q.dangerouslySetInnerHTML,!a){if(b!=null)for(j={},he=0;he<n.attributes.length;he++)j[n.attributes[he].name]=n.attributes[he].value;(B||F)&&(B&&(F&&B.__html==F.__html||B.__html===n.innerHTML)||(n.innerHTML=B&&B.__html||""))}if(Nb(n,q,j,v,a),B)s.__k=[];else if(he=s.props.children,_v(n,Array.isArray(he)?he:[he],s,h,m,v&&G!=="foreignObject",b,M,b?b[0]:h.__k&&Ul(h,0),a),b!=null)for(he=b.length;he--;)b[he]!=null&&fv(b[he]);a||("value"in q&&(he=q.value)!==void 0&&(he!==n.value||G==="progress"&&!he||G==="option"&&he!==j.value)&&Id(n,"value",he,j.value,!1),"checked"in q&&(he=q.checked)!==void 0&&he!==n.checked&&Id(n,"checked",he,j.checked,!1))}return n}function xv(n,s,h){try{typeof n=="function"?n(s):n.current=s}catch(m){_t.__e(m,h)}}function bv(n,s,h){var m,v;if(_t.unmount&&_t.unmount(n),(m=n.ref)&&(m.current&&m.current!==n.__e||xv(m,null,s)),(m=n.__c)!=null){if(m.componentWillUnmount)try{m.componentWillUnmount()}catch(b){_t.__e(b,s)}m.base=m.__P=null}if(m=n.__k)for(v=0;v<m.length;v++)m[v]&&bv(m[v],s,typeof n.type!="function");h||n.__e==null||fv(n.__e),n.__e=n.__d=void 0}function jb(n,s,h){return this.constructor(n,h)}function jl(n,s,h){var m,v,b;_t.__&&_t.__(n,s),v=(m=typeof h=="function")?null:h&&h.__k||s.__k,b=[],dm(s,n=(!m&&h||s).__k=vn(Yo,null,[n]),v||Cd,Cd,s.ownerSVGElement!==void 0,!m&&h?[h]:v?null:s.firstChild?Au.call(s.childNodes):null,b,!m&&h?h:v?v.__e:s.firstChild,m),vv(b,n)}function fm(n,s){jl(n,s,fm)}function wv(n,s,h){var m,v,b,M=Ko({},n.props);for(b in s)b=="key"?m=s[b]:b=="ref"?v=s[b]:M[b]=s[b];return arguments.length>2&&(M.children=arguments.length>3?Au.call(arguments,2):h),cu(n.type,M,m||n.key,v||n.ref,null)}function Gd(n,s){var h={__c:s="__cC"+hv++,__:n,Consumer:function(m,v){return m.children(v)},Provider:function(m){var v,b;return this.getChildContext||(v=[],(b={})[s]=this,this.getChildContext=function(){return b},this.shouldComponentUpdate=function(M){this.props.value!==M.value&&v.some(Np)},this.sub=function(M){v.push(M);var a=M.componentWillUnmount;M.componentWillUnmount=function(){v.splice(v.indexOf(M),1),a&&a.call(M)}}),m.children}};return h.Provider.__=h.Consumer.contextType=h}Au=dv.slice,_t={__e:function(n,s){for(var h,m,v;s=s.__;)if((h=s.__c)&&!h.__)try{if((m=h.constructor)&&m.getDerivedStateFromError!=null&&(h.setState(m.getDerivedStateFromError(n)),v=h.__d),h.componentDidCatch!=null&&(h.componentDidCatch(n),v=h.__d),v)return h.__E=h}catch(b){n=b}throw n}},lv=0,cv=function(n){return n!=null&&n.constructor===void 0},ao.prototype.setState=function(n,s){var h;h=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=Ko({},this.state),typeof n=="function"&&(n=n(Ko({},h),this.props)),n&&Ko(h,n),n!=null&&this.__v&&(s&&this.__h.push(s),Np(this))},ao.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),Np(this))},ao.prototype.render=Yo,lu=[],uv=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Md.__r=0,hv=0;var Vb=Object.freeze(Object.defineProperty({__proto__:null,render:jl,hydrate:fm,createElement:vn,h:vn,Fragment:Yo,createRef:pv,get isValidElement(){return cv},Component:ao,cloneElement:wv,createContext:Gd,toChildArray:Po,get options(){return _t}},Symbol.toStringTag,{value:"Module"})),Wl,Qi,Wg,Vl=0,Tv=[],Xg=_t.__b,Hg=_t.__r,Kg=_t.diffed,Yg=_t.__c,Jg=_t.unmount;function Cu(n,s){_t.__h&&_t.__h(Qi,n,Vl||s),Vl=0;var h=Qi.__H||(Qi.__H={__:[],__h:[]});return n>=h.__.length&&h.__.push({}),h.__[n]}function qn(n){return Vl=1,Ev(Sv,n)}function Ev(n,s,h){var m=Cu(Wl++,2);return m.t=n,m.__c||(m.__=[h?h(s):Sv(void 0,s),function(v){var b=m.t(m.__[0],v);m.__[0]!==b&&(m.__=[b,m.__[1]],m.__c.setState({}))}],m.__c=Qi),m.__}function gr(n,s){var h=Cu(Wl++,3);!_t.__s&&pm(h.__H,s)&&(h.__=n,h.__H=s,Qi.__H.__h.push(h))}function Xl(n,s){var h=Cu(Wl++,4);!_t.__s&&pm(h.__H,s)&&(h.__=n,h.__H=s,Qi.__h.push(h))}function kt(n){return Vl=5,en(function(){return{current:n}},[])}function Hl(n,s,h){Vl=6,Xl(function(){typeof n=="function"?n(s()):n&&(n.current=s())},h==null?h:h.concat(n))}function en(n,s){var h=Cu(Wl++,7);return pm(h.__H,s)&&(h.__=n(),h.__H=s,h.__h=n),h.__}function ur(n,s){return Vl=8,en(function(){return n},s)}function Ta(n){var s=Qi.context[n.__c],h=Cu(Wl++,9);return h.c=n,s?(h.__==null&&(h.__=!0,s.sub(Qi)),s.props.value):n.__}function Ho(n,s){_t.useDebugValue&&_t.useDebugValue(s?s(n):n)}function $b(){for(var n;n=Tv.shift();)if(n.__P)try{n.__H.__h.forEach(yd),n.__H.__h.forEach(Up),n.__H.__h=[]}catch(s){n.__H.__h=[],_t.__e(s,n.__v)}}_t.__b=function(n){Qi=null,Xg&&Xg(n)},_t.__r=function(n){Hg&&Hg(n),Wl=0;var s=(Qi=n.__c).__H;s&&(s.__h.forEach(yd),s.__h.forEach(Up),s.__h=[])},_t.diffed=function(n){Kg&&Kg(n);var s=n.__c;s&&s.__H&&s.__H.__h.length&&(Tv.push(s)!==1&&Wg===_t.requestAnimationFrame||((Wg=_t.requestAnimationFrame)||function(h){var m,v=function(){clearTimeout(b),Qg&&cancelAnimationFrame(m),setTimeout(h)},b=setTimeout(v,100);Qg&&(m=requestAnimationFrame(v))})($b)),Qi=null},_t.__c=function(n,s){s.some(function(h){try{h.__h.forEach(yd),h.__h=h.__h.filter(function(m){return!m.__||Up(m)})}catch(m){s.some(function(v){v.__h&&(v.__h=[])}),s=[],_t.__e(m,h.__v)}}),Yg&&Yg(n,s)},_t.unmount=function(n){Jg&&Jg(n);var s,h=n.__c;h&&h.__H&&(h.__H.__.forEach(function(m){try{yd(m)}catch(v){s=v}}),s&&_t.__e(s,h.__v))};var Qg=typeof requestAnimationFrame=="function";function yd(n){var s=Qi,h=n.__c;typeof h=="function"&&(n.__c=void 0,h()),Qi=s}function Up(n){var s=Qi;n.__c=n.__(),Qi=s}function pm(n,s){return!n||n.length!==s.length||s.some(function(h,m){return h!==n[m]})}function Sv(n,s){return typeof s=="function"?s(n):s}var oo=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Av(n){if(n.__esModule)return n;var s=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(n).forEach(function(h){var m=Object.getOwnPropertyDescriptor(n,h);Object.defineProperty(s,h,m.get?m:{enumerable:!0,get:function(){return n[h]}})}),s}var mm={exports:{}};(function(n,s){(function(h,m){n.exports=m()})(oo,function(){var h,m,v;function b(a,L){if(!h)h=L;else if(!m)m=L;else{var F="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+h+")(sharedChunk); ("+m+")(sharedChunk); self.onerror = null;",B={};h(B),v=L(B),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(v.workerUrl=window.URL.createObjectURL(new Blob([F],{type:"text/javascript"})))}}b(["exports"],function(a){var L="2.7.1",F=B;function B(t,e,i,o){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=o,this.p2x=i,this.p2y=o}B.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},B.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},B.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},B.prototype.solveCurveX=function(t,e){var i,o,c,u,p;for(e===void 0&&(e=1e-6),c=t,p=0;p<8;p++){if(u=this.sampleCurveX(c)-t,Math.abs(u)<e)return c;var g=this.sampleCurveDerivativeX(c);if(Math.abs(g)<1e-6)break;c-=u/g}if((c=t)<(i=0))return i;if(c>(o=1))return o;for(;i<o;){if(u=this.sampleCurveX(c),Math.abs(u-t)<e)return c;t>u?i=c:o=c,c=.5*(o-i)+i}return c},B.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var j=q;function q(t,e){this.x=t,this.y=e}q.prototype={clone:function(){return new q(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround:function(t,e){var i=Math.cos(t),o=Math.sin(t),c=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},q.convert=function(t){return t instanceof q?t:Array.isArray(t)?new q(t[0],t[1]):t};var G=typeof self!="undefined"?self:{},he=1e-6,be=typeof Float32Array!="undefined"?Float32Array:Array;function we(){var t=new be(9);return be!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Ie(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function E(t,e,i){var o=e[0],c=e[1],u=e[2],p=e[3],g=e[4],x=e[5],T=e[6],A=e[7],C=e[8],I=e[9],R=e[10],N=e[11],$=e[12],W=e[13],Q=e[14],oe=e[15],ce=i[0],fe=i[1],me=i[2],_e=i[3];return t[0]=ce*o+fe*g+me*C+_e*$,t[1]=ce*c+fe*x+me*I+_e*W,t[2]=ce*u+fe*T+me*R+_e*Q,t[3]=ce*p+fe*A+me*N+_e*oe,t[4]=(ce=i[4])*o+(fe=i[5])*g+(me=i[6])*C+(_e=i[7])*$,t[5]=ce*c+fe*x+me*I+_e*W,t[6]=ce*u+fe*T+me*R+_e*Q,t[7]=ce*p+fe*A+me*N+_e*oe,t[8]=(ce=i[8])*o+(fe=i[9])*g+(me=i[10])*C+(_e=i[11])*$,t[9]=ce*c+fe*x+me*I+_e*W,t[10]=ce*u+fe*T+me*R+_e*Q,t[11]=ce*p+fe*A+me*N+_e*oe,t[12]=(ce=i[12])*o+(fe=i[13])*g+(me=i[14])*C+(_e=i[15])*$,t[13]=ce*c+fe*x+me*I+_e*W,t[14]=ce*u+fe*T+me*R+_e*Q,t[15]=ce*p+fe*A+me*N+_e*oe,t}function ye(t,e,i){var o,c,u,p,g,x,T,A,C,I,R,N,$=i[0],W=i[1],Q=i[2];return e===t?(t[12]=e[0]*$+e[4]*W+e[8]*Q+e[12],t[13]=e[1]*$+e[5]*W+e[9]*Q+e[13],t[14]=e[2]*$+e[6]*W+e[10]*Q+e[14],t[15]=e[3]*$+e[7]*W+e[11]*Q+e[15]):(c=e[1],u=e[2],p=e[3],g=e[4],x=e[5],T=e[6],A=e[7],C=e[8],I=e[9],R=e[10],N=e[11],t[0]=o=e[0],t[1]=c,t[2]=u,t[3]=p,t[4]=g,t[5]=x,t[6]=T,t[7]=A,t[8]=C,t[9]=I,t[10]=R,t[11]=N,t[12]=o*$+g*W+C*Q+e[12],t[13]=c*$+x*W+I*Q+e[13],t[14]=u*$+T*W+R*Q+e[14],t[15]=p*$+A*W+N*Q+e[15]),t}function Le(t,e,i){var o=i[0],c=i[1],u=i[2];return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Re(t,e,i){var o=Math.sin(i),c=Math.cos(i),u=e[4],p=e[5],g=e[6],x=e[7],T=e[8],A=e[9],C=e[10],I=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*c+T*o,t[5]=p*c+A*o,t[6]=g*c+C*o,t[7]=x*c+I*o,t[8]=T*c-u*o,t[9]=A*c-p*o,t[10]=C*c-g*o,t[11]=I*c-x*o,t}function xe(t,e,i){var o=Math.sin(i),c=Math.cos(i),u=e[0],p=e[1],g=e[2],x=e[3],T=e[8],A=e[9],C=e[10],I=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*c-T*o,t[1]=p*c-A*o,t[2]=g*c-C*o,t[3]=x*c-I*o,t[8]=u*o+T*c,t[9]=p*o+A*c,t[10]=g*o+C*c,t[11]=x*o+I*c,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Se=E;function Be(){var t=new be(3);return be!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ye(t){var e=new be(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function it(t){return Math.hypot(t[0],t[1],t[2])}function at(t,e,i){var o=new be(3);return o[0]=t,o[1]=e,o[2]=i,o}function wt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function dr(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Sr(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Ut(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function $r(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Zt(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t}function At(t,e){var i=e[0],o=e[1],c=e[2],u=i*i+o*o+c*c;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t[2]=e[2]*u,t}function fr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Or(t,e,i){var o=e[0],c=e[1],u=e[2],p=i[0],g=i[1],x=i[2];return t[0]=c*x-u*g,t[1]=u*p-o*x,t[2]=o*g-c*p,t}function Tt(t,e,i){var o=e[0],c=e[1],u=e[2],p=i[3]*o+i[7]*c+i[11]*u+i[15];return t[0]=(i[0]*o+i[4]*c+i[8]*u+i[12])/(p=p||1),t[1]=(i[1]*o+i[5]*c+i[9]*u+i[13])/p,t[2]=(i[2]*o+i[6]*c+i[10]*u+i[14])/p,t}function pr(t,e,i){var o=i[0],c=i[1],u=i[2],p=e[0],g=e[1],x=e[2],T=c*x-u*g,A=u*p-o*x,C=o*g-c*p,I=c*C-u*A,R=u*T-o*C,N=o*A-c*T,$=2*i[3];return A*=$,C*=$,R*=2,N*=2,t[0]=p+(T*=$)+(I*=2),t[1]=g+A+R,t[2]=x+C+N,t}var Ui,En=dr,Do=Sr,Dn=it;function gi(t,e,i){var o=e[0],c=e[1],u=e[2],p=e[3];return t[0]=i[0]*o+i[4]*c+i[8]*u+i[12]*p,t[1]=i[1]*o+i[5]*c+i[9]*u+i[13]*p,t[2]=i[2]*o+i[6]*c+i[10]*u+i[14]*p,t[3]=i[3]*o+i[7]*c+i[11]*u+i[15]*p,t}function lo(){var t=new be(4);return be!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Lo(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Ro(t,e,i){i*=.5;var o=e[0],c=e[1],u=e[2],p=e[3],g=Math.sin(i),x=Math.cos(i);return t[0]=o*x+p*g,t[1]=c*x+u*g,t[2]=u*x-c*g,t[3]=p*x-o*g,t}function co(t,e){return t[0]===e[0]&&t[1]===e[1]}Be(),Ui=new be(4),be!=Float32Array&&(Ui[0]=0,Ui[1]=0,Ui[2]=0,Ui[3]=0),Be(),at(1,0,0),at(0,1,0),lo(),lo(),we(),function(){var t;t=new be(2),be!=Float32Array&&(t[0]=0,t[1]=0)}();const Mi=Math.PI/180,ji=180/Math.PI;function Ct(t){return t*Mi}function Gr(t){return t*ji}const Ii=[[0,0],[1,0],[1,1],[0,1]];function tn(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function rn(t,e,i,o){const c=new F(t,e,i,o);return function(u){return c.solve(u)}}const Ln=rn(.25,.1,.25,1);function Vt(t,e,i){return Math.min(i,Math.max(e,t))}function ki(t,e,i){return(i=Vt((i-t)/(e-t),0,1))*i*(3-2*i)}function wi(t,e,i){const o=i-e,c=((t-e)%o+o)%o+e;return c===e?i:c}function nn(t,e,i){if(!t.length)return i(null,[]);let o=t.length;const c=new Array(t.length);let u=null;t.forEach((p,g)=>{e(p,(x,T)=>{x&&(u=x),c[g]=T,--o==0&&i(u,c)})})}function yi(t){const e=[];for(const i in t)e.push(t[i]);return e}function Wt(t,...e){for(const i of e)for(const o in i)t[o]=i[o];return t}let Cr=1;function Rn(){return Cr++}function vi(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Tr(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Oo(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function uo(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Ti(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Vi(t,e,i){const o={};for(const c in t)o[c]=e.call(i||this,t[c],c,t);return o}function ho(t,e,i){const o={};for(const c in t)e.call(i||this,t[c],c,t)&&(o[c]=t[c]);return o}function $e(t){return Array.isArray(t)?t.map($e):typeof t=="object"&&t?Vi(t,$e):t}const gt={};function Je(t){gt[t]||(typeof console!="undefined"&&console.warn(t),gt[t]=!0)}function Et(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function lr(t){let e=0;for(let i,o,c=0,u=t.length,p=u-1;c<u;p=c++)i=t[c],o=t[p],e+=(o.x-i.x)*(i.y+o.y);return e}function Dt(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function er(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,c,u)=>{const p=c||u;return e[o]=!p||p.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let tr,rr,vt,Ot=null;function Br(t){if(Ot==null){const e=t.navigator?t.navigator.userAgent:null;Ot=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ot}function $i(t){try{const e=G[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const Dr={now:()=>vt!==void 0?vt:G.performance.now(),setNow(t){vt=t},restoreNow(){vt=void 0},frame(t){const e=G.requestAnimationFrame(t);return{cancel:()=>G.cancelAnimationFrame(e)}},getImageData(t,e=0){const i=G.document.createElement("canvas"),o=i.getContext("2d");if(!o)throw new Error("failed to create canvas 2d context");return i.width=t.width,i.height=t.height,o.drawImage(t,0,0,t.width,t.height),o.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:t=>(tr||(tr=G.document.createElement("a")),tr.href=t,tr.href),get devicePixelRatio(){return G.devicePixelRatio},get prefersReducedMotion(){return!!G.matchMedia&&(rr==null&&(rr=G.matchMedia("(prefers-reduced-motion: reduce)")),rr.matches)}};let J;const D={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(J==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{J={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):t}catch{J=t}}return J},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},U={supported:!1,testSupport:function(t){!le&&ee&&(de?pe(t):H=t)}};let H,ee,le=!1,de=!1;function pe(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ee),t.isContextLost())return;U.supported=!0}catch{}t.deleteTexture(e),le=!0}G.document&&(ee=G.document.createElement("img"),ee.onload=function(){H&&pe(H),H=null,de=!0},ee.onerror=function(){le=!0,H=null},ee.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ue="01",ge="NO_ACCESS_TOKEN";function ke(t){return t.indexOf("mapbox:")===0}function Oe(t){return D.API_URL_REGEX.test(t)}const Ue=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function lt(t){const e=t.match(Ue);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ut(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function ht(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(G.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class dt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=ht(D.ACCESS_TOKEN);let o="";return o=i&&i.u?G.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(c,u)=>String.fromCharCode(Number("0x"+u)))):D.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${o}`:`mapbox.eventData:${o}`}fetchEventData(){const e=$i("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{const c=G.localStorage.getItem(i);c&&(this.eventData=JSON.parse(c));const u=G.localStorage.getItem(o);u&&(this.anonId=u)}catch{Je("Unable to read from LocalStorage")}}saveEventData(){const e=$i("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{G.localStorage.setItem(o,this.anonId),Object.keys(this.eventData).length>=1&&G.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Je("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,o,c){if(!D.EVENTS_URL)return;const u=lt(D.EVENTS_URL);u.params.push(`access_token=${c||D.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:L,skuId:ue,userId:this.anonId},g=i?Wt(p,i):p,x={url:ut(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=On(x,T=>{this.pendingRequest=null,o(T),this.saveEventData(),this.processRequests(c)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const Mt=new class extends dt{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){D.EVENTS_URL&&D.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>ke(i)||Oe(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=ht(D.ACCESS_TOKEN),i=e?e.u:D.ACCESS_TOKEN;let o=i!==this.eventData.tokenU;Oo(this.anonId)||(this.anonId=vi(),o=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),p=new Date(c),g=(c-this.eventData.lastSuccess)/864e5;o=o||g>=1||g<-1||u.getDate()!==p.getDate()}else o=!0;if(!o)return this.processRequests();this.postEvent(c,{"enabled.telemetry":!1},u=>{u||(this.eventData.lastSuccess=c,this.eventData.tokenU=i)},t)}},ir=Mt.postTurnstileEvent.bind(Mt),cr=new class extends dt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,o){this.skuToken=e,this.errorCb=o,D.EVENTS_URL&&(i||D.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(ge)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Oo(this.anonId)||(this.anonId=vi()),this.postEvent(i,{skuToken:this.skuToken},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t))}},sr=cr.postMapLoadEvent.bind(cr),yr=new class extends dt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,o){if(!D.API_URL||!D.SESSION_PATH)return;const c=lt(D.API_URL+D.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${o||D.ACCESS_TOKEN||""}`);const u={url:ut(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Jd(u,p=>{this.pendingRequest=null,i(p),this.saveEventData(),this.processRequests(o)})}getSessionAPI(t,e,i,o){this.skuToken=e,this.errorCb=o,D.SESSION_PATH&&D.API_URL&&(i||D.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(ge)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t)}},on=yr.getSessionAPI.bind(yr),sn=new Set,qr="mapbox-tiles";let Gi,Sa,zu=500,Ql=50;function Ps(){G.caches&&!Gi&&(Gi=G.caches.open(qr))}function ec(t){const e=t.indexOf("?");return e<0?t:t.slice(0,e)}let Aa=1/0;const Ca={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ca);class Ds extends Error{constructor(e,i,o){i===401&&Oe(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const tc=Dt()?()=>self.worker&&self.worker.referrer:()=>(G.location.protocol==="blob:"?G.parent:G).location.href,Sn=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(tc())&&!/^\w+:/.test(i))){if(G.fetch&&G.Request&&G.AbortController&&G.Request.prototype.hasOwnProperty("signal"))return function(o,c){const u=new G.AbortController,p=new G.Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:tc(),signal:u.signal});let g=!1,x=!1;const T=(A=p.url).indexOf("sku=")>0&&Oe(A);var A;o.type==="json"&&p.headers.set("Accept","application/json");const C=(R,N,$)=>{if(x)return;if(R&&R.message!=="SecurityError"&&Je(R),N&&$)return I(N);const W=Date.now();G.fetch(p).then(Q=>{if(Q.ok){const oe=T?Q.clone():null;return I(Q,oe,W)}return c(new Ds(Q.statusText,Q.status,o.url))}).catch(Q=>{Q.code!==20&&c(new Error(Q.message))})},I=(R,N,$)=>{(o.type==="arrayBuffer"?R.arrayBuffer():o.type==="json"?R.json():R.text()).then(W=>{x||(N&&$&&function(Q,oe,ce){if(Ps(),!Gi)return;const fe={status:oe.status,statusText:oe.statusText,headers:new G.Headers};oe.headers.forEach((_e,Pe)=>fe.headers.set(Pe,_e));const me=er(oe.headers.get("Cache-Control")||"");me["no-store"]||(me["max-age"]&&fe.headers.set("Expires",new Date(ce+1e3*me["max-age"]).toUTCString()),new Date(fe.headers.get("Expires")).getTime()-ce<42e4||function(_e,Pe){if(Sa===void 0)try{new Response(new ReadableStream),Sa=!0}catch{Sa=!1}Sa?Pe(_e.body):_e.blob().then(Pe)}(oe,_e=>{const Pe=new G.Response(_e,fe);Ps(),Gi&&Gi.then(Me=>Me.put(ec(Q.url),Pe)).catch(Me=>Je(Me.message))}))}(p,N,$),g=!0,c(null,W,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(W=>{x||c(new Error(W.message))})};return T?function(R,N){if(Ps(),!Gi)return N(null);const $=ec(R.url);Gi.then(W=>{W.match($).then(Q=>{const oe=function(ce){if(!ce)return!1;const fe=new Date(ce.headers.get("Expires")||0),me=er(ce.headers.get("Cache-Control")||"");return fe>Date.now()&&!me["no-cache"]}(Q);W.delete($),oe&&W.put($,Q.clone()),N(null,Q,oe)}).catch(N)}).catch(N)}(p,C):C(null,null),{cancel:()=>{x=!0,g||u.abort()}}}(t,e);if(Dt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(o,c){const u=new G.XMLHttpRequest;u.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const p in o.headers)u.setRequestHeader(p,o.headers[p]);return o.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=o.credentials==="include",u.onerror=()=>{c(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let p=u.response;if(o.type==="json")try{p=JSON.parse(u.response)}catch(g){return c(g)}c(null,p,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else c(new Ds(u.statusText,u.status,o.url))},u.send(o.body),{cancel:()=>u.abort()}}(t,e)},Ls=function(t,e){return Sn(Wt(t,{type:"arrayBuffer"}),e)},On=function(t,e){return Sn(Wt(t,{method:"POST"}),e)},Jd=function(t,e){return Sn(Wt(t,{method:"GET"}),e)};function Pu(t){const e=G.document.createElement("a");return e.href=t,e.protocol===G.document.location.protocol&&e.host===G.document.location.host}const Jo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Qo,Rs;Qo=[],Rs=0;const Du=function(t,e){if(U.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Rs>=D.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Qo.push(u),u}Rs++;let i=!1;const o=()=>{if(!i)for(i=!0,Rs--;Qo.length&&Rs<D.MAX_PARALLEL_IMAGE_REQUESTS;){const u=Qo.shift(),{requestParameters:p,callback:g,cancelled:x}=u;x||(u.cancel=Du(p,g).cancel)}},c=Ls(t,(u,p,g,x)=>{o(),u?e(u):p&&(G.createImageBitmap?function(T,A){const C=new G.Blob([new Uint8Array(T)],{type:"image/png"});G.createImageBitmap(C).then(I=>{A(null,I)}).catch(I=>{A(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(T,A)=>e(T,A,g,x)):function(T,A){const C=new G.Image,I=G.URL;C.onload=()=>{A(null,C),I.revokeObjectURL(C.src),C.onload=null,G.requestAnimationFrame(()=>{C.src=Jo})},C.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const R=new G.Blob([new Uint8Array(T)],{type:"image/png"});C.src=T.byteLength?I.createObjectURL(R):Jo}(p,(T,A)=>e(T,A,g,x)))});return{cancel:()=>{c.cancel(),o()}}};function Lu(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function Ma(t,e,i){if(i&&i[t]){const o=i[t].indexOf(e);o!==-1&&i[t].splice(o,1)}}class fo{constructor(e,i={}){Wt(this,i),this.type=e}}class Ia extends fo{constructor(e,i={}){super("error",Wt({error:e},i))}}class po{on(e,i){return this._listeners=this._listeners||{},Lu(e,i,this._listeners),this}off(e,i){return Ma(e,i,this._listeners),Ma(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Lu(e,i,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,i){typeof e=="string"&&(e=new fo(e,i||{}));const o=e.type;if(this.listens(o)){e.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const g of c)g.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const g of u)Ma(o,g,this._oneTimeListeners),g.call(this,e);const p=this._eventedParent;p&&(Wt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof Ia&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var Ae=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class et{constructor(e,i,o,c){this.message=(e?`${e}: `:"")+o,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function Ru(t){const e=t.value;return e?[new et(t.key,e,"constants have been deprecated as of v8")]:[]}function mo(t,...e){for(const i of e)for(const o in i)t[o]=i[o];return t}function Zr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Zn(t){if(Array.isArray(t))return t.map(Zn);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=Zn(t[i]);return e}return Zr(t)}class Bn extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class ka{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,c]of i)this.bindings[o]=c}concat(e){return new ka(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const _o={kind:"null"},Qe={kind:"number"},Bt={kind:"string"},zt={kind:"boolean"},Fn={kind:"color"},es={kind:"object"},Pt={kind:"value"},Os={kind:"collator"},go={kind:"formatted"},Bs={kind:"resolvedImage"};function an(t,e){return{kind:"array",itemType:t,N:e}}function Fr(t){if(t.kind==="array"){const e=Fr(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const Qd=[_o,Qe,Bt,zt,Fn,go,es,an(Pt),Bs];function zi(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!zi(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of Qd)if(!zi(i,e))return null}}return`Expected ${Fr(t)} but found ${Fr(e)} instead.`}function za(t,e){return e.some(i=>i.kind===t.kind)}function ts(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}function rs(t){var e={exports:{}};return t(e,e.exports),e.exports}var is=rs(function(t,e){var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(g){return(g=Math.round(g))<0?0:g>255?255:g}function c(g){return o(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function u(g){return(x=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:x>1?1:x;var x}function p(g,x,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?g+(x-g)*T*6:2*T<1?x:3*T<2?g+(x-g)*(2/3-T)*6:g}try{e.parseCSSColor=function(g){var x,T=g.replace(/ /g,"").toLowerCase();if(T in i)return i[T].slice();if(T[0]==="#")return T.length===4?(x=parseInt(T.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:T.length===7&&(x=parseInt(T.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var A=T.indexOf("("),C=T.indexOf(")");if(A!==-1&&C+1===T.length){var I=T.substr(0,A),R=T.substr(A+1,C-(A+1)).split(","),N=1;switch(I){case"rgba":if(R.length!==4)return null;N=u(R.pop());case"rgb":return R.length!==3?null:[c(R[0]),c(R[1]),c(R[2]),N];case"hsla":if(R.length!==4)return null;N=u(R.pop());case"hsl":if(R.length!==3)return null;var $=(parseFloat(R[0])%360+360)%360/360,W=u(R[1]),Q=u(R[2]),oe=Q<=.5?Q*(W+1):Q+W-Q*W,ce=2*Q-oe;return[o(255*p(ce,oe,$+1/3)),o(255*p(ce,oe,$)),o(255*p(ce,oe,$-1/3)),N];default:return null}}return null}}catch{}});class Xt{constructor(e,i,o,c=1){this.r=e,this.g=i,this.b=o,this.a=c}static parse(e){if(!e)return;if(e instanceof Xt)return e;if(typeof e!="string")return;const i=is.parseCSSColor(e);return i?new Xt(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,o,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(o)},${c})`}toArray(){const{r:e,g:i,b:o,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*i/c,255*o/c,c]}}Xt.black=new Xt(0,0,0,1),Xt.white=new Xt(1,1,1,1),Xt.transparent=new Xt(0,0,0,0),Xt.red=new Xt(1,0,0,1),Xt.blue=new Xt(0,0,1,1);class Pa{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class rc{constructor(e,i,o,c,u){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=c,this.textColor=u}}class St{constructor(e){this.sections=e}static fromString(e){return new St([new rc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof St?e:St.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(o)}return e}}class ln{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ln({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Ou(t,e,i,o){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[t,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[t,e,i,o]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Da(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Xt||t instanceof Pa||t instanceof St||t instanceof ln)return!0;if(Array.isArray(t)){for(const e of t)if(!Da(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Da(t[e]))return!1;return!0}return!1}function Hr(t){if(t===null)return _o;if(typeof t=="string")return Bt;if(typeof t=="boolean")return zt;if(typeof t=="number")return Qe;if(t instanceof Xt)return Fn;if(t instanceof Pa)return Os;if(t instanceof St)return go;if(t instanceof ln)return Bs;if(Array.isArray(t)){const e=t.length;let i;for(const o of t){const c=Hr(o);if(i){if(i===c)continue;i=Pt;break}i=c}return an(i||Pt,e)}return es}function Fs(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Xt||t instanceof St||t instanceof ln?t.toString():JSON.stringify(t)}class yo{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Da(e[1]))return i.error("invalid value");const o=e[1];let c=Hr(o);const u=i.expectedType;return c.kind!=="array"||c.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(c=u),new yo(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Xt?["rgba"].concat(this.value.toArray()):this.value instanceof St?this.value.serialize():this.value}}class si{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const La={string:Bt,number:Qe,boolean:zt,object:es};class cn{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,c=1;const u=e[0];if(u==="array"){let g,x;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in La)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);g=La[T],c++}else g=Pt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=e[2],c++}o=an(g,x)}else o=La[u];const p=[];for(;c<e.length;c++){const g=i.parse(e[c],c,Pt);if(!g)return null;p.push(g)}return new cn(o,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!zi(this.type,Hr(o)))return o;if(i===this.args.length-1)throw new si(`Expected value to be of type ${Fr(this.type)}, but found ${Fr(Hr(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(o=>o.serialize()))}}class Nn{constructor(e){this.type=go,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const c=[];let u=!1;for(let p=1;p<=e.length-1;++p){const g=e[p];if(u&&typeof g=="object"&&!Array.isArray(g)){u=!1;let x=null;if(g["font-scale"]&&(x=i.parse(g["font-scale"],1,Qe),!x))return null;let T=null;if(g["text-font"]&&(T=i.parse(g["text-font"],1,an(Bt)),!T))return null;let A=null;if(g["text-color"]&&(A=i.parse(g["text-color"],1,Fn),!A))return null;const C=c[c.length-1];C.scale=x,C.font=T,C.textColor=A}else{const x=i.parse(e[p],1,Pt);if(!x)return null;const T=x.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new Nn(c)}evaluate(e){return new St(this.sections.map(i=>{const o=i.content.evaluate(e);return Hr(o)===Bs?new rc("",o,null,null,null):new rc(Fs(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class Bo{constructor(e){this.type=Bs,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Bt);return o?new Bo(o):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),o=ln.fromString(i);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(i)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ef={"to-boolean":zt,"to-color":Fn,"to-number":Qe,"to-string":Bt};class Un{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0];if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");const c=ef[o],u=[];for(let p=1;p<e.length;p++){const g=i.parse(e[p],p,Pt);if(!g)return null;u.push(g)}return new Un(c,u)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let i,o;for(const c of this.args){if(i=c.evaluate(e),o=null,i instanceof Xt)return i;if(typeof i=="string"){const u=e.parseColor(i);if(u)return u}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Ou(i[0],i[1],i[2],i[3]),!o))return new Xt(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new si(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new si(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?St.fromString(Fs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ln.fromString(Fs(this.args[0].evaluate(e))):Fs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Nn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Bo(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Bu=["Unknown","Point","LineString","Polygon"];class Fu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Bu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-e[0])+this.featureDistanceData.bearing[1]*(c*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Xt.parse(e)),i}}class qi{constructor(e,i,o,c){this.name=e,this.type=i,this._evaluate=o,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const o=e[0],c=qi.definitions[o];if(!c)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(c)?c[0]:c.type,p=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,g=p.filter(([T])=>!Array.isArray(T)||T.length===e.length-1);let x=null;for(const[T,A]of g){x=new Ba(i.registry,i.path,null,i.scope);const C=[];let I=!1;for(let R=1;R<e.length;R++){const N=e[R],$=Array.isArray(T)?T[R-1]:T.type,W=x.parse(N,1+C.length,$);if(!W){I=!0;break}C.push(W)}if(!I)if(Array.isArray(T)&&T.length!==C.length)x.error(`Expected ${T.length} arguments, but found ${C.length} instead.`);else{for(let R=0;R<C.length;R++){const N=Array.isArray(T)?T[R]:T.type,$=C[R];x.concat(R+1).checkSubtype(N,$.type)}if(x.errors.length===0)return new qi(o,u,A,C)}}if(g.length===1)i.errors.push(...x.errors);else{const T=(g.length?g:p).map(([C])=>{return I=C,Array.isArray(I)?`(${I.map(Fr).join(", ")})`:`(${Fr(I.type)}...)`;var I}).join(" | "),A=[];for(let C=1;C<e.length;C++){const I=i.parse(e[C],1+A.length);if(!I)return null;A.push(Fr(I.type))}i.error(`Expected arguments of type ${T}, but found (${A.join(", ")}) instead.`)}return null}static register(e,i){qi.definitions=i;for(const o in i)e[o]=qi}}class Ns{constructor(e,i,o){this.type=Os,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const c=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,zt);if(!c)return null;const u=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,zt);if(!u)return null;let p=null;return o.locale&&(p=i.parse(o.locale,1,Bt),!p)?null:new Ns(c,u,p)}evaluate(e){return new Pa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const vo=8192;function Ra(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Us(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Nu(t,e){const i=(180+t[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*vo),Math.round(o*c*vo)]}function Uu(t,e,i){const o=t[0]-e[0],c=t[1]-e[1],u=t[0]-i[0],p=t[1]-i[1];return o*p-u*c==0&&o*u<=0&&c*p<=0}function ic(t,e){let i=!1;for(let p=0,g=e.length;p<g;p++){const x=e[p];for(let T=0,A=x.length;T<A-1;T++){if(Uu(t,x[T],x[T+1]))return!1;(c=x[T])[1]>(o=t)[1]!=(u=x[T+1])[1]>o[1]&&o[0]<(u[0]-c[0])*(o[1]-c[1])/(u[1]-c[1])+c[0]&&(i=!i)}}var o,c,u;return i}function ju(t,e){for(let i=0;i<e.length;i++)if(ic(t,e[i]))return!0;return!1}function nc(t,e,i,o){const c=o[0]-i[0],u=o[1]-i[1],p=(t[0]-i[0])*u-c*(t[1]-i[1]),g=(e[0]-i[0])*u-c*(e[1]-i[1]);return p>0&&g<0||p<0&&g>0}function tf(t,e,i){for(const T of i)for(let A=0;A<T.length-1;++A)if((g=[(p=T[A+1])[0]-(u=T[A])[0],p[1]-u[1]])[0]*(x=[(c=e)[0]-(o=t)[0],c[1]-o[1]])[1]-g[1]*x[0]!=0&&nc(o,c,u,p)&&nc(u,p,o,c))return!0;var o,c,u,p,g,x;return!1}function Vu(t,e){for(let i=0;i<t.length;++i)if(!ic(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(tf(t[i],t[i+1],e))return!1;return!0}function rf(t,e){for(let i=0;i<e.length;i++)if(Vu(t,e[i]))return!0;return!1}function oc(t,e,i){const o=[];for(let c=0;c<t.length;c++){const u=[];for(let p=0;p<t[c].length;p++){const g=Nu(t[c][p],i);Ra(e,g),u.push(g)}o.push(u)}return o}function $u(t,e,i){const o=[];for(let c=0;c<t.length;c++){const u=oc(t[c],e,i);o.push(u)}return o}function sc(t,e,i,o){if(t[0]<i[0]||t[0]>i[2]){const c=.5*o;let u=t[0]-i[0]>c?-o:i[0]-t[0]>c?o:0;u===0&&(u=t[0]-i[2]>c?-o:i[2]-t[0]>c?o:0),t[0]+=u}Ra(e,t)}function Gu(t,e,i,o){const c=Math.pow(2,o.z)*vo,u=[o.x*vo,o.y*vo],p=[];for(const g of t)for(const x of g){const T=[x.x+u[0],x.y+u[1]];sc(T,e,i,c),p.push(T)}return p}function qu(t,e,i,o){const c=Math.pow(2,o.z)*vo,u=[o.x*vo,o.y*vo],p=[];for(const x of t){const T=[];for(const A of x){const C=[A.x+u[0],A.y+u[1]];Ra(e,C),T.push(C)}p.push(T)}if(e[2]-e[0]<=c/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const x of p)for(const T of x)sc(T,e,i,c)}var g;return p}class Fo{constructor(e,i){this.type=zt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Da(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let c=0;c<o.features.length;++c){const u=o.features[c].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Fo(o,o.features[c].geometry)}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Fo(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Fo(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const c=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const g=oc(o.coordinates,u,p),x=Gu(i.geometry(),c,u,p);if(!Us(c,u))return!1;for(const T of x)if(!ic(T,g))return!1}if(o.type==="MultiPolygon"){const g=$u(o.coordinates,u,p),x=Gu(i.geometry(),c,u,p);if(!Us(c,u))return!1;for(const T of x)if(!ju(T,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const c=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const g=oc(o.coordinates,u,p),x=qu(i.geometry(),c,u,p);if(!Us(c,u))return!1;for(const T of x)if(!Vu(T,g))return!1}if(o.type==="MultiPolygon"){const g=$u(o.coordinates,u,p),x=qu(i.geometry(),c,u,p);if(!Us(c,u))return!1;for(const T of x)if(!rf(T,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function ns(t){if(t instanceof qi&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Fo)return!1;let e=!0;return t.eachChild(i=>{e&&!ns(i)&&(e=!1)}),e}function js(t){if(t instanceof qi&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!js(i)&&(e=!1)}),e}function Vs(t,e){if(t instanceof qi&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(o=>{i&&!Vs(o,e)&&(i=!1)}),i}class Oa{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new Oa(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ba{constructor(e,i=[],o,c=new ka,u=[]){this.registry=e,this.path=i,this.key=i.map(p=>`[${p}]`).join(""),this.scope=c,this.errors=u,this.expectedType=o}parse(e,i,o,c,u={}){return i?this.concat(i,o,c)._parse(e,u):this._parse(e,u)}_parse(e,i){function o(c,u,p){return p==="assert"?new cn(u,[c]):p==="coerce"?new Un(u,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const u=this.registry[c];if(u){let p=u.parse(e,this);if(!p)return null;if(this.expectedType){const g=this.expectedType,x=p.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||x.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(g,x))return null}else p=o(p,g,i.typeAnnotation||"coerce");else p=o(p,g,i.typeAnnotation||"assert")}if(!(p instanceof yo)&&p.type.kind!=="resolvedImage"&&Fa(p)){const g=new Fu;try{p=new yo(p.type,p.evaluate(g))}catch(x){return this.error(x.message),null}}return p}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){const c=typeof e=="number"?this.path.concat(e):this.path,u=o?this.scope.concat(o):this.scope;return new Ba(this.registry,c,i||null,u,this.errors)}error(e,...i){const o=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new Bn(o,e))}checkSubtype(e,i){const o=zi(e,i);return o&&this.error(o),o}}function Fa(t){if(t instanceof Oa)return Fa(t.boundExpression);if(t instanceof qi&&t.name==="error"||t instanceof Ns||t instanceof Fo)return!1;const e=t instanceof Un||t instanceof cn;let i=!0;return t.eachChild(o=>{i=e?i&&Fa(o):i&&o instanceof yo}),!!i&&ns(t)&&Vs(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function $s(t,e){const i=t.length-1;let o,c,u=0,p=i,g=0;for(;u<=p;)if(g=Math.floor((u+p)/2),o=t[g],c=t[g+1],o<=e){if(g===i||e<c)return g;u=g+1}else{if(!(o>e))throw new si("Input is not a number.");p=g-1}return 0}class Gs{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,u]of o)this.labels.push(c),this.outputs.push(u)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,Qe);if(!o)return null;const c=[];let u=null;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);for(let p=1;p<e.length;p+=2){const g=p===1?-1/0:e[p],x=e[p+1],T=p,A=p+1;if(typeof g!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(c.length&&c[c.length-1][0]>=g)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const C=i.parse(x,A,u);if(!C)return null;u=u||C.type,c.push([g,C])}return new Gs(u,o,c)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return o[0].evaluate(e);const u=i.length;return c>=i[u-1]?o[u-1].evaluate(e):o[$s(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}function nr(t,e,i){return t*(1-i)+e*i}var Na=Object.freeze({__proto__:null,number:nr,color:function(t,e,i){return new Xt(nr(t.r,e.r,i),nr(t.g,e.g,i),nr(t.b,e.b,i),nr(t.a,e.a,i))},array:function(t,e,i){return t.map((o,c)=>nr(o,e[c],i))}});const Zu=.95047,qs=1.08883,ac=4/29,Ua=6/29,Wu=3*Ua*Ua,nf=Math.PI/180,of=180/Math.PI;function ja(t){return t>.008856451679035631?Math.pow(t,1/3):t/Wu+ac}function Va(t){return t>Ua?t*t*t:Wu*(t-ac)}function $a(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Zs(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Xu(t){const e=Zs(t.r),i=Zs(t.g),o=Zs(t.b),c=ja((.4124564*e+.3575761*i+.1804375*o)/Zu),u=ja((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*u-16,a:500*(c-u),b:200*(u-ja((.0193339*e+.119192*i+.9503041*o)/qs)),alpha:t.a}}function Hu(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,o=isNaN(t.b)?e:e-t.b/200;return e=1*Va(e),i=Zu*Va(i),o=qs*Va(o),new Xt($a(3.2404542*i-1.5371385*e-.4985314*o),$a(-.969266*i+1.8760108*e+.041556*o),$a(.0556434*i-.2040259*e+1.0572252*o),t.alpha)}function sf(t,e,i){const o=e-t;return t+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const Ws={forward:Xu,reverse:Hu,interpolate:function(t,e,i){return{l:nr(t.l,e.l,i),a:nr(t.a,e.a,i),b:nr(t.b,e.b,i),alpha:nr(t.alpha,e.alpha,i)}}},Xs={forward:function(t){const{l:e,a:i,b:o}=Xu(t),c=Math.atan2(o,i)*of;return{h:c<0?c+360:c,c:Math.sqrt(i*i+o*o),l:e,alpha:t.a}},reverse:function(t){const e=t.h*nf,i=t.c;return Hu({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:sf(t.h,e.h,i),c:nr(t.c,e.c,i),l:nr(t.l,e.l,i),alpha:nr(t.alpha,e.alpha,i)}}};var Ku=Object.freeze({__proto__:null,lab:Ws,hcl:Xs});class Pi{constructor(e,i,o,c,u){this.type=e,this.operator=i,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[p,g]of u)this.labels.push(p),this.outputs.push(g)}static interpolationFactor(e,i,o,c){let u=0;if(e.name==="exponential")u=Ga(i,e.base,o,c);else if(e.name==="linear")u=Ga(i,1,o,c);else if(e.name==="cubic-bezier"){const p=e.controlPoints;u=new F(p[0],p[1],p[2],p[3]).solve(Ga(i,1,o,c))}return u}static parse(e,i){let[o,c,u,...p]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const T=c[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:T}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const T=c.slice(1);if(T.length!==4||T.some(A=>typeof A!="number"||A<0||A>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(u=i.parse(u,2,Qe),!u)return null;const g=[];let x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=Fn:i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType);for(let T=0;T<p.length;T+=2){const A=p[T],C=p[T+1],I=T+3,R=T+4;if(typeof A!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(g.length&&g[g.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const N=i.parse(C,R,x);if(!N)return null;x=x||N.type,g.push([A,N])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new Pi(x,o,c,u,g):i.error(`Type ${Fr(x)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return o[0].evaluate(e);const u=i.length;if(c>=i[u-1])return o[u-1].evaluate(e);const p=$s(i,c),g=Pi.interpolationFactor(this.interpolation,c,i[p],i[p+1]),x=o[p].evaluate(e),T=o[p+1].evaluate(e);return this.operator==="interpolate"?Na[this.type.kind.toLowerCase()](x,T,g):this.operator==="interpolate-hcl"?Xs.reverse(Xs.interpolate(Xs.forward(x),Xs.forward(T),g)):Ws.reverse(Ws.interpolate(Ws.forward(x),Ws.forward(T),g))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function Ga(t,e,i,o){const c=o-i,u=t-i;return c===0?0:e===1?u/c:(Math.pow(e,u)-1)/(Math.pow(e,c)-1)}class No{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const c=i.expectedType;c&&c.kind!=="value"&&(o=c);const u=[];for(const g of e.slice(1)){const x=i.parse(g,1+u.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,u.push(x)}const p=c&&u.some(g=>zi(c,g.type));return new No(p?Pt:o,u)}evaluate(e){let i,o=null,c=0;for(const u of this.args){if(c++,o=u.evaluate(e),o&&o instanceof ln&&!o.available&&(i||(i=o),o=null,c===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class qa{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let u=1;u<e.length-1;u+=2){const p=e[u];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,u);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",u);const g=i.parse(e[u+1],u+1);if(!g)return null;o.push([p,g])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return c?new qa(o,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class lc{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Qe),c=i.parse(e[2],2,an(i.expectedType||Pt));return o&&c?new lc(c.type.itemType,o,c):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new si(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new si(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new si(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class cc{constructor(e,i){this.type=zt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Pt),c=i.parse(e[2],2,Pt);return o&&c?za(o.type,[zt,Bt,Qe,_o,Pt])?new cc(o,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fr(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!ts(i,["boolean","string","number","null"]))throw new si(`Expected first argument to be of type boolean, string, number or null, but found ${Fr(Hr(i))} instead.`);if(!ts(o,["string","array"]))throw new si(`Expected second argument to be of type array or string, but found ${Fr(Hr(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class An{constructor(e,i,o){this.type=Qe,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Pt),c=i.parse(e[2],2,Pt);if(!o||!c)return null;if(!za(o.type,[zt,Bt,Qe,_o,Pt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fr(o.type)} instead`);if(e.length===4){const u=i.parse(e[3],3,Qe);return u?new An(o,c,u):null}return new An(o,c)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!ts(i,["boolean","string","number","null"]))throw new si(`Expected first argument to be of type boolean, string, number or null, but found ${Fr(Hr(i))} instead.`);if(!ts(o,["string","array"]))throw new si(`Expected second argument to be of type array or string, but found ${Fr(Hr(o))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return o.indexOf(i,c)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Za{constructor(e,i,o,c,u,p){this.inputType=e,this.type=i,this.input=o,this.cases=c,this.outputs=u,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const u={},p=[];for(let T=2;T<e.length-1;T+=2){let A=e[T];const C=e[T+1];Array.isArray(A)||(A=[A]);const I=i.concat(T);if(A.length===0)return I.error("Expected at least one branch label.");for(const N of A){if(typeof N!="number"&&typeof N!="string")return I.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return I.error("Numeric branch labels must be integer values.");if(o){if(I.checkSubtype(o,Hr(N)))return null}else o=Hr(N);if(u[String(N)]!==void 0)return I.error("Branch labels must be unique.");u[String(N)]=p.length}const R=i.parse(C,T,c);if(!R)return null;c=c||R.type,p.push(R)}const g=i.parse(e[1],1,Pt);if(!g)return null;const x=i.parse(e[e.length-1],e.length-1,c);return x?g.type.kind!=="value"&&i.concat(1).checkSubtype(o,g.type)?null:new Za(o,c,g,u,p,x):null}evaluate(e){const i=this.input.evaluate(e);return(Hr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],c={};for(const p of i){const g=c[this.cases[p]];g===void 0?(c[this.cases[p]]=o.length,o.push([this.cases[p],[p]])):o[g][1].push(p)}const u=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,g]of o)e.push(g.length===1?u(g[0]):g.map(u)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class xo{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const c=[];for(let p=1;p<e.length-1;p+=2){const g=i.parse(e[p],p,zt);if(!g)return null;const x=i.parse(e[p+1],p+1,o);if(!x)return null;c.push([g,x]),o=o||x.type}const u=i.parse(e[e.length-1],e.length-1,o);return u?new xo(o,c,u):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Hs{constructor(e,i,o,c){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Pt),c=i.parse(e[2],2,Qe);if(!o||!c)return null;if(!za(o.type,[an(Pt),Bt,Pt]))return i.error(`Expected first argument to be of type array or string, but found ${Fr(o.type)} instead`);if(e.length===4){const u=i.parse(e[3],3,Qe);return u?new Hs(o.type,o,c,u):null}return new Hs(o.type,o,c)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!ts(i,["string","array"]))throw new si(`Expected first argument to be of type array or string, but found ${Fr(Hr(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return i.slice(o,c)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Yu(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Wa(t,e,i,o){return o.compare(e,i)===0}function bo(t,e,i){const o=t!=="=="&&t!=="!=";return class Cv{constructor(u,p,g){this.type=zt,this.lhs=u,this.rhs=p,this.collator=g,this.hasUntypedArgument=u.type.kind==="value"||p.type.kind==="value"}static parse(u,p){if(u.length!==3&&u.length!==4)return p.error("Expected two or three arguments.");const g=u[0];let x=p.parse(u[1],1,Pt);if(!x)return null;if(!Yu(g,x.type))return p.concat(1).error(`"${g}" comparisons are not supported for type '${Fr(x.type)}'.`);let T=p.parse(u[2],2,Pt);if(!T)return null;if(!Yu(g,T.type))return p.concat(2).error(`"${g}" comparisons are not supported for type '${Fr(T.type)}'.`);if(x.type.kind!==T.type.kind&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error(`Cannot compare types '${Fr(x.type)}' and '${Fr(T.type)}'.`);o&&(x.type.kind==="value"&&T.type.kind!=="value"?x=new cn(T.type,[x]):x.type.kind!=="value"&&T.type.kind==="value"&&(T=new cn(x.type,[T])));let A=null;if(u.length===4){if(x.type.kind!=="string"&&T.type.kind!=="string"&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(A=p.parse(u[3],3,Os),!A)return null}return new Cv(x,T,A)}evaluate(u){const p=this.lhs.evaluate(u),g=this.rhs.evaluate(u);if(o&&this.hasUntypedArgument){const x=Hr(p),T=Hr(g);if(x.kind!==T.kind||x.kind!=="string"&&x.kind!=="number")throw new si(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${x.kind}, ${T.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=Hr(p),T=Hr(g);if(x.kind!=="string"||T.kind!=="string")return e(u,p,g)}return this.collator?i(u,p,g,this.collator.evaluate(u)):e(u,p,g)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[t];return this.eachChild(p=>{u.push(p.serialize())}),u}}}const Ju=bo("==",function(t,e,i){return e===i},Wa),uc=bo("!=",function(t,e,i){return e!==i},function(t,e,i,o){return!Wa(0,e,i,o)}),hc=bo("<",function(t,e,i){return e<i},function(t,e,i,o){return o.compare(e,i)<0}),Qu=bo(">",function(t,e,i){return e>i},function(t,e,i,o){return o.compare(e,i)>0}),dc=bo("<=",function(t,e,i){return e<=i},function(t,e,i,o){return o.compare(e,i)<=0}),eh=bo(">=",function(t,e,i){return e>=i},function(t,e,i,o){return o.compare(e,i)>=0});class Xa{constructor(e,i,o,c,u){this.type=Bt,this.number=e,this.locale=i,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=u}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Qe);if(!o)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let u=null;if(c.locale&&(u=i.parse(c.locale,1,Bt),!u))return null;let p=null;if(c.currency&&(p=i.parse(c.currency,1,Bt),!p))return null;let g=null;if(c["min-fraction-digits"]&&(g=i.parse(c["min-fraction-digits"],1,Qe),!g))return null;let x=null;return c["max-fraction-digits"]&&(x=i.parse(c["max-fraction-digits"],1,Qe),!x)?null:new Xa(o,u,p,g,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ha{constructor(e){this.type=Qe,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Fr(o.type)} instead.`):new Ha(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new si(`Expected value to be of type string or array, but found ${Fr(Hr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Cn={"==":Ju,"!=":uc,">":Qu,"<":hc,">=":eh,"<=":dc,array:cn,at:lc,boolean:cn,case:xo,coalesce:No,collator:Ns,format:Nn,image:Bo,in:cc,"index-of":An,interpolate:Pi,"interpolate-hcl":Pi,"interpolate-lab":Pi,length:Ha,let:qa,literal:yo,match:Za,number:cn,"number-format":Xa,object:cn,slice:Hs,step:Gs,string:cn,"to-boolean":Un,"to-color":Un,"to-number":Un,"to-string":Un,var:Oa,within:Fo};function fc(t,[e,i,o,c]){e=e.evaluate(t),i=i.evaluate(t),o=o.evaluate(t);const u=c?c.evaluate(t):1,p=Ou(e,i,o,u);if(p)throw new si(p);return new Xt(e/255*u,i/255*u,o/255*u,u)}function pc(t,e){return t in e}function Ks(t,e){const i=e[t];return i===void 0?null:i}function wo(t){return{type:t}}function th(t){return{result:"success",value:t}}function Wn(t){return{result:"error",value:t}}function os(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function rh(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function mc(t){return!!t.expression&&t.expression.interpolated}function Yt(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Ka(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Ya(t){return t}function Ys(t,e){const i=e.type==="color",o=t.stops&&typeof t.stops[0][0]=="object",c=o||!(o||t.property!==void 0),u=t.type||(mc(e)?"exponential":"interval");if(i&&((t=mo({},t)).stops&&(t.stops=t.stops.map(T=>[T[0],Xt.parse(T[1])])),t.default=Xt.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Ku[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let p,g,x;if(u==="exponential")p=ih;else if(u==="interval")p=af;else if(u==="categorical"){p=Ja,g=Object.create(null);for(const T of t.stops)g[T[0]]=T[1];x=typeof t.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);p=lf}if(o){const T={},A=[];for(let R=0;R<t.stops.length;R++){const N=t.stops[R],$=N[0].zoom;T[$]===void 0&&(T[$]={zoom:$,type:t.type,property:t.property,default:t.default,stops:[]},A.push($)),T[$].stops.push([N[0].value,N[1]])}const C=[];for(const R of A)C.push([T[R].zoom,Ys(T[R],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:Pi.interpolationFactor.bind(void 0,I),zoomStops:C.map(R=>R[0]),evaluate:({zoom:R},N)=>ih({stops:C,base:t.base},e,R).evaluate(R,N)}}if(c){const T=u==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:Pi.interpolationFactor.bind(void 0,T),zoomStops:t.stops.map(A=>A[0]),evaluate:({zoom:A})=>p(t,e,A,g,x)}}return{kind:"source",evaluate(T,A){const C=A&&A.properties?A.properties[t.property]:void 0;return C===void 0?fi(t.default,e.default):p(t,e,C,g,x)}}}function fi(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function Ja(t,e,i,o,c){return fi(typeof i===c?o[i]:void 0,t.default,e.default)}function af(t,e,i){if(Yt(i)!=="number")return fi(t.default,e.default);const o=t.stops.length;if(o===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[o-1][0])return t.stops[o-1][1];const c=$s(t.stops.map(u=>u[0]),i);return t.stops[c][1]}function ih(t,e,i){const o=t.base!==void 0?t.base:1;if(Yt(i)!=="number")return fi(t.default,e.default);const c=t.stops.length;if(c===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[c-1][0])return t.stops[c-1][1];const u=$s(t.stops.map(A=>A[0]),i),p=function(A,C,I,R){const N=R-I,$=A-I;return N===0?0:C===1?$/N:(Math.pow(C,$)-1)/(Math.pow(C,N)-1)}(i,o,t.stops[u][0],t.stops[u+1][0]),g=t.stops[u][1],x=t.stops[u+1][1];let T=Na[e.type]||Ya;if(t.colorSpace&&t.colorSpace!=="rgb"){const A=Ku[t.colorSpace];T=(C,I)=>A.reverse(A.interpolate(A.forward(C),A.forward(I),p))}return typeof g.evaluate=="function"?{evaluate(...A){const C=g.evaluate.apply(void 0,A),I=x.evaluate.apply(void 0,A);if(C!==void 0&&I!==void 0)return T(C,I,p)}}:T(g,x,p)}function lf(t,e,i){return e.type==="color"?i=Xt.parse(i):e.type==="formatted"?i=St.fromString(i.toString()):e.type==="resolvedImage"?i=ln.fromString(i.toString()):Yt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),fi(i,t.default,e.default)}qi.register(Cn,{error:[{kind:"error"},[Bt],(t,[e])=>{throw new si(e.evaluate(t))}],typeof:[Bt,[Pt],(t,[e])=>Fr(Hr(e.evaluate(t)))],"to-rgba":[an(Qe,4),[Fn],(t,[e])=>e.evaluate(t).toArray()],rgb:[Fn,[Qe,Qe,Qe],fc],rgba:[Fn,[Qe,Qe,Qe,Qe],fc],has:{type:zt,overloads:[[[Bt],(t,[e])=>pc(e.evaluate(t),t.properties())],[[Bt,es],(t,[e,i])=>pc(e.evaluate(t),i.evaluate(t))]]},get:{type:Pt,overloads:[[[Bt],(t,[e])=>Ks(e.evaluate(t),t.properties())],[[Bt,es],(t,[e,i])=>Ks(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Pt,[Bt],(t,[e])=>Ks(e.evaluate(t),t.featureState||{})],properties:[es,[],t=>t.properties()],"geometry-type":[Bt,[],t=>t.geometryType()],id:[Pt,[],t=>t.id()],zoom:[Qe,[],t=>t.globals.zoom],pitch:[Qe,[],t=>t.globals.pitch||0],"distance-from-center":[Qe,[],t=>t.distanceFromCenter()],"heatmap-density":[Qe,[],t=>t.globals.heatmapDensity||0],"line-progress":[Qe,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Qe,[],t=>t.globals.skyRadialProgress||0],accumulated:[Pt,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Qe,wo(Qe),(t,e)=>{let i=0;for(const o of e)i+=o.evaluate(t);return i}],"*":[Qe,wo(Qe),(t,e)=>{let i=1;for(const o of e)i*=o.evaluate(t);return i}],"-":{type:Qe,overloads:[[[Qe,Qe],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Qe],(t,[e])=>-e.evaluate(t)]]},"/":[Qe,[Qe,Qe],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Qe,[Qe,Qe],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Qe,[],()=>Math.LN2],pi:[Qe,[],()=>Math.PI],e:[Qe,[],()=>Math.E],"^":[Qe,[Qe,Qe],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Qe,[Qe],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Qe,[Qe],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Qe,[Qe],(t,[e])=>Math.log(e.evaluate(t))],log2:[Qe,[Qe],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Qe,[Qe],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Qe,[Qe],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Qe,[Qe],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Qe,[Qe],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Qe,[Qe],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Qe,[Qe],(t,[e])=>Math.atan(e.evaluate(t))],min:[Qe,wo(Qe),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[Qe,wo(Qe),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[Qe,[Qe],(t,[e])=>Math.abs(e.evaluate(t))],round:[Qe,[Qe],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Qe,[Qe],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Qe,[Qe],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[zt,[Bt,Pt],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[zt,[Pt],(t,[e])=>t.id()===e.value],"filter-type-==":[zt,[Bt],(t,[e])=>t.geometryType()===e.value],"filter-<":[zt,[Bt,Pt],(t,[e,i])=>{const o=t.properties()[e.value],c=i.value;return typeof o==typeof c&&o<c}],"filter-id-<":[zt,[Pt],(t,[e])=>{const i=t.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[zt,[Bt,Pt],(t,[e,i])=>{const o=t.properties()[e.value],c=i.value;return typeof o==typeof c&&o>c}],"filter-id->":[zt,[Pt],(t,[e])=>{const i=t.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[zt,[Bt,Pt],(t,[e,i])=>{const o=t.properties()[e.value],c=i.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[zt,[Pt],(t,[e])=>{const i=t.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[zt,[Bt,Pt],(t,[e,i])=>{const o=t.properties()[e.value],c=i.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[zt,[Pt],(t,[e])=>{const i=t.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[zt,[Pt],(t,[e])=>e.value in t.properties()],"filter-has-id":[zt,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[zt,[an(Bt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[zt,[an(Pt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[zt,[Bt,an(Pt)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[zt,[Bt,an(Pt)],(t,[e,i])=>function(o,c,u,p){for(;u<=p;){const g=u+p>>1;if(c[g]===o)return!0;c[g]>o?p=g-1:u=g+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:zt,overloads:[[[zt,zt],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[wo(zt),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:zt,overloads:[[[zt,zt],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[wo(zt),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[zt,[zt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[zt,[Bt],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Bt,[Bt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Bt,[Bt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Bt,wo(Pt),(t,e)=>e.map(i=>Fs(i.evaluate(t))).join("")],"resolved-locale":[Bt,[Os],(t,[e])=>e.evaluate(t).resolvedLocale()]});class _c{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new Fu,this._defaultValue=i?function(o){return o.type==="color"&&Ka(o.default)?new Xt(0,0,0,0):o.type==="color"?Xt.parse(o.default)||null:o.default===void 0?null:o.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,o,c,u,p,g,x){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,c,u,p,g,x){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=x||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new si(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console!="undefined"&&console.warn(T.message)),this._defaultValue}}}function ss(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Cn}function Js(t,e){const i=new Ba(Cn,[],e?function(c){const u={color:Fn,string:Bt,number:Qe,enum:Bt,boolean:zt,formatted:go,resolvedImage:Bs};return c.type==="array"?an(u[c.value]||Pt,c.length):u[c.type]}(e):void 0),o=i.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?th(new _c(o,e)):Wn(i.errors)}class Qs{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!js(i.expression)}evaluateWithoutErrorHandling(e,i,o,c,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,c,u,p)}evaluate(e,i,o,c,u,p){return this._styleExpression.evaluate(e,i,o,c,u,p)}}class gc{constructor(e,i,o,c){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!js(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,i,o,c,u,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,c,u,p)}evaluate(e,i,o,c,u,p){return this._styleExpression.evaluate(e,i,o,c,u,p)}interpolationFactor(e,i,o){return this.interpolationType?Pi.interpolationFactor(this.interpolationType,e,i,o):0}}function nh(t,e){if((t=Js(t,e)).result==="error")return t;const i=t.value.expression,o=ns(i);if(!o&&!os(e))return Wn([new Bn("","data expressions not supported")]);const c=Vs(i,["zoom","pitch","distance-from-center"]);if(!c&&!rh(e))return Wn([new Bn("","zoom expressions not supported")]);const u=Qa(i);return u||c?u instanceof Bn?Wn([u]):u instanceof Pi&&!mc(e)?Wn([new Bn("",'"interpolate" expressions cannot be used with this property')]):th(u?new gc(o?"camera":"composite",t.value,u.labels,u instanceof Pi?u.interpolation:void 0):new Qs(o?"constant":"source",t.value)):Wn([new Bn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class as{constructor(e,i){this._parameters=e,this._specification=i,mo(this,Ys(this._parameters,this._specification))}static deserialize(e){return new as(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Qa(t){let e=null;if(t instanceof qa)e=Qa(t.result);else if(t instanceof No){for(const i of t.args)if(e=Qa(i),e)break}else(t instanceof Gs||t instanceof Pi)&&t.input instanceof qi&&t.input.name==="zoom"&&(e=t);return e instanceof Bn||t.eachChild(i=>{const o=Qa(i);o instanceof Bn?e=o:!e&&o?e=new Bn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Bn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function un(t){const e=t.key,i=t.value,o=t.valueSpec||{},c=t.objectElementValidators||{},u=t.style,p=t.styleSpec;let g=[];const x=Yt(i);if(x!=="object")return[new et(e,i,`object expected, ${x} found`)];for(const T in i){const A=T.split(".")[0],C=o[A]||o["*"];let I;if(c[A])I=c[A];else if(o[A])I=ai;else if(c["*"])I=c["*"];else{if(!o["*"]){g.push(new et(e,i[T],`unknown property "${T}"`));continue}I=ai}g=g.concat(I({key:(e&&`${e}.`)+T,value:i[T],valueSpec:C,style:u,styleSpec:p,object:i,objectKey:T},i))}for(const T in o)c[T]||o[T].required&&o[T].default===void 0&&i[T]===void 0&&g.push(new et(e,i,`missing required property "${T}"`));return g}function yc(t){const e=t.value,i=t.valueSpec,o=t.style,c=t.styleSpec,u=t.key,p=t.arrayElementValidator||ai;if(Yt(e)!=="array")return[new et(u,e,`array expected, ${Yt(e)} found`)];if(i.length&&e.length!==i.length)return[new et(u,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new et(u,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let g={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum};c.$version<7&&(g.function=i.function),Yt(i.value)==="object"&&(g=i.value);let x=[];for(let T=0;T<e.length;T++)x=x.concat(p({array:e,arrayIndex:T,value:e[T],valueSpec:g,style:o,styleSpec:c,key:`${u}[${T}]`}));return x}function oh(t){const e=t.key,i=t.value,o=t.valueSpec;let c=Yt(i);if(c==="number"&&i!=i&&(c="NaN"),c!=="number")return[new et(e,i,`number expected, ${c} found`)];if("minimum"in o){let u=o.minimum;if(Yt(o.minimum)==="array"&&(u=o.minimum[t.arrayIndex]),i<u)return[new et(e,i,`${i} is less than the minimum value ${u}`)]}if("maximum"in o){let u=o.maximum;if(Yt(o.maximum)==="array"&&(u=o.maximum[t.arrayIndex]),i>u)return[new et(e,i,`${i} is greater than the maximum value ${u}`)]}return[]}function el(t){const e=t.valueSpec,i=Zr(t.value.type);let o,c,u,p={};const g=i!=="categorical"&&t.value.property===void 0,x=!g,T=Yt(t.value.stops)==="array"&&Yt(t.value.stops[0])==="array"&&Yt(t.value.stops[0][0])==="object",A=un({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(R){if(i==="identity")return[new et(R.key,R.value,'identity function may not have a "stops" property')];let N=[];const $=R.value;return N=N.concat(yc({key:R.key,value:$,valueSpec:R.valueSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:C})),Yt($)==="array"&&$.length===0&&N.push(new et(R.key,$,"array must have at least one stop")),N},default:function(R){return ai({key:R.key,value:R.value,valueSpec:e,style:R.style,styleSpec:R.styleSpec})}}});return i==="identity"&&g&&A.push(new et(t.key,t.value,'missing required property "property"')),i==="identity"||t.value.stops||A.push(new et(t.key,t.value,'missing required property "stops"')),i==="exponential"&&t.valueSpec.expression&&!mc(t.valueSpec)&&A.push(new et(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(x&&!os(t.valueSpec)?A.push(new et(t.key,t.value,"property functions not supported")):g&&!rh(t.valueSpec)&&A.push(new et(t.key,t.value,"zoom functions not supported"))),i!=="categorical"&&!T||t.value.property!==void 0||A.push(new et(t.key,t.value,'"property" property is required')),A;function C(R){let N=[];const $=R.value,W=R.key;if(Yt($)!=="array")return[new et(W,$,`array expected, ${Yt($)} found`)];if($.length!==2)return[new et(W,$,`array length 2 expected, length ${$.length} found`)];if(T){if(Yt($[0])!=="object")return[new et(W,$,`object expected, ${Yt($[0])} found`)];if($[0].zoom===void 0)return[new et(W,$,"object stop key must have zoom")];if($[0].value===void 0)return[new et(W,$,"object stop key must have value")];if(u&&u>Zr($[0].zoom))return[new et(W,$[0].zoom,"stop zoom values must appear in ascending order")];Zr($[0].zoom)!==u&&(u=Zr($[0].zoom),c=void 0,p={}),N=N.concat(un({key:`${W}[0]`,value:$[0],valueSpec:{zoom:{}},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:oh,value:I}}))}else N=N.concat(I({key:`${W}[0]`,value:$[0],valueSpec:{},style:R.style,styleSpec:R.styleSpec},$));return ss(Zn($[1]))?N.concat([new et(`${W}[1]`,$[1],"expressions are not allowed in function stops.")]):N.concat(ai({key:`${W}[1]`,value:$[1],valueSpec:e,style:R.style,styleSpec:R.styleSpec}))}function I(R,N){const $=Yt(R.value),W=Zr(R.value),Q=R.value!==null?R.value:N;if(o){if($!==o)return[new et(R.key,Q,`${$} stop domain type must match previous stop domain type ${o}`)]}else o=$;if($!=="number"&&$!=="string"&&$!=="boolean")return[new et(R.key,Q,"stop domain value must be a number, string, or boolean")];if($!=="number"&&i!=="categorical"){let oe=`number expected, ${$} found`;return os(e)&&i===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new et(R.key,Q,oe)]}return i!=="categorical"||$!=="number"||isFinite(W)&&Math.floor(W)===W?i!=="categorical"&&$==="number"&&c!==void 0&&W<c?[new et(R.key,Q,"stop domain values must appear in ascending order")]:(c=W,i==="categorical"&&W in p?[new et(R.key,Q,"stop domain values must be unique")]:(p[W]=!0,[])):[new et(R.key,Q,`integer expected, found ${W}`)]}}function Xn(t){const e=(t.expressionContext==="property"?nh:Js)(Zn(t.value),t.valueSpec);if(e.result==="error")return e.value.map(o=>new et(`${t.key}${o.key}`,t.value,o.message));const i=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!i.outputDefined())return[new et(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!js(i))return[new et(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return vc(i,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Vs(i,["zoom","feature-state"]))return[new et(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!ns(i))return[new et(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vc(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const c of e.valueSpec.expression.parameters)i.delete(c);if(i.size===0)return[];const o=[];return t instanceof qi&&i.has(t.name)?[new et(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(c=>{o.push(...vc(c,e))}),o)}function tl(t){const e=t.key,i=t.value,o=t.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(Zr(i))===-1&&c.push(new et(e,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(Zr(i))===-1&&c.push(new et(e,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),c}function rl(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!rl(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function il(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};rl(t)||(t=ol(t));const i=t;let o=!0;try{o=function(T){if(!ls(T))return T;let A=Zn(T);return sh(A),A=nl(A),A}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const c=Ae[`filter_${e}`],u=Js(o,c);let p=null;if(u.result==="error")throw new Error(u.value.map(T=>`${T.key}: ${T.message}`).join(", "));p=(T,A,C)=>u.value.evaluate(T,A,{},C);let g=null,x=null;if(o!==i){const T=Js(i,c);if(T.result==="error")throw new Error(T.value.map(A=>`${A.key}: ${A.message}`).join(", "));g=(A,C,I,R,N)=>T.value.evaluate(A,C,{},I,void 0,void 0,R,N),x=!ns(T.value.expression)}return p=p,{filter:p,dynamicFilter:g||void 0,needGeometry:xc(o),needFeature:!!x}}function nl(t){if(!Array.isArray(t))return t;const e=function(i){if(cf.has(i[0])){for(let o=1;o<i.length;o++)if(ls(i[o]))return!0}return i}(t);return e===!0?e:e.map(i=>nl(i))}function sh(t){let e=!1;const i=[];if(t[0]==="case"){for(let o=1;o<t.length-1;o+=2)e=e||ls(t[o]),i.push(t[o+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||ls(t[1]);for(let o=2;o<t.length-1;o+=2)i.push(t[o+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||ls(t[1]);for(let o=1;o<t.length-1;o+=2)i.push(t[o+1])}e&&(t.length=0,t.push("any",...i));for(let o=1;o<t.length;o++)sh(t[o])}function ls(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(ls(t[i]))return!0;return!1}const cf=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function uf(t,e){return t<e?-1:t>e?1:0}function xc(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(xc(t[e]))return!0;return!1}function ol(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?bc(t[1],t[2],"=="):e==="!="?sl(bc(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?bc(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(ol))):e==="all"?["all"].concat(t.slice(1).map(ol)):e==="none"?["all"].concat(t.slice(1).map(ol).map(sl)):e==="in"?ah(t[1],t.slice(2)):e==="!in"?sl(ah(t[1],t.slice(2))):e==="has"?lh(t[1]):e==="!has"?sl(lh(t[1])):e!=="within"||t;var i}function bc(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function ah(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(uf)]]:["filter-in-small",t,["literal",e]]}}function lh(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function sl(t){return["!",t]}function wc(t){if(rl(Zn(t.value))){const e=Zn(t.layerType);return Xn(mo({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${e||"fill"}`]}))}return ch(t)}function ch(t){const e=t.value,i=t.key;if(Yt(e)!=="array")return[new et(i,e,`array expected, ${Yt(e)} found`)];const o=t.styleSpec;let c,u=[];if(e.length<1)return[new et(i,e,"filter array must have at least 1 element")];switch(u=u.concat(tl({key:`${i}[0]`,value:e[0],valueSpec:o.filter_operator,style:t.style,styleSpec:t.styleSpec})),Zr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Zr(e[1])==="$type"&&u.push(new et(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&u.push(new et(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Yt(e[1]),c!=="string"&&u.push(new et(`${i}[1]`,e[1],`string expected, ${c} found`)));for(let p=2;p<e.length;p++)c=Yt(e[p]),Zr(e[1])==="$type"?u=u.concat(tl({key:`${i}[${p}]`,value:e[p],valueSpec:o.geometry_type,style:t.style,styleSpec:t.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&u.push(new et(`${i}[${p}]`,e[p],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)u=u.concat(ch({key:`${i}[${p}]`,value:e[p],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":c=Yt(e[1]),e.length!==2?u.push(new et(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&u.push(new et(`${i}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=Yt(e[1]),e.length!==2?u.push(new et(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&u.push(new et(`${i}[1]`,e[1],`object expected, ${c} found`))}return u}function ea(t,e){const i=t.key,o=t.style,c=t.styleSpec,u=t.value,p=t.objectKey,g=c[`${e}_${t.layerType}`];if(!g)return[];const x=p.match(/^(.*)-transition$/);if(e==="paint"&&x&&g[x[1]]&&g[x[1]].transition)return ai({key:i,value:u,valueSpec:c.transition,style:o,styleSpec:c});const T=t.valueSpec||g[p];if(!T)return[new et(i,u,`unknown property "${p}"`)];let A;if(Yt(u)==="string"&&os(T)&&!T.tokens&&(A=/^{([^}]+)}$/.exec(u)))return[new et(i,u,`"${p}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const C=[];return t.layerType==="symbol"&&(p==="text-field"&&o&&!o.glyphs&&C.push(new et(i,u,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&Ka(Zn(u))&&Zr(u.type)==="identity"&&C.push(new et(i,u,'"text-font" does not support identity functions'))),C.concat(ai({key:t.key,value:u,valueSpec:T,style:o,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:p}))}function uh(t){return ea(t,"paint")}function hh(t){return ea(t,"layout")}function ta(t){let e=[];const i=t.value,o=t.key,c=t.style,u=t.styleSpec;i.type||i.ref||e.push(new et(o,i,'either "type" or "ref" is required'));let p=Zr(i.type);const g=Zr(i.ref);if(i.id){const x=Zr(i.id);for(let T=0;T<t.arrayIndex;T++){const A=c.layers[T];Zr(A.id)===x&&e.push(new et(o,i.id,`duplicate layer id "${i.id}", previously used at line ${A.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach(T=>{T in i&&e.push(new et(o,i[T],`"${T}" is prohibited for ref layers`))}),c.layers.forEach(T=>{Zr(T.id)===g&&(x=T)}),x?x.ref?e.push(new et(o,i.ref,"ref cannot reference another ref layer")):p=Zr(x.type):e.push(new et(o,i.ref,`ref layer "${g}" not found`))}else if(p!=="background"&&p!=="sky")if(i.source){const x=c.sources&&c.sources[i.source],T=x&&Zr(x.type);x?T==="vector"&&p==="raster"?e.push(new et(o,i.source,`layer "${i.id}" requires a raster source`)):T==="raster"&&p!=="raster"?e.push(new et(o,i.source,`layer "${i.id}" requires a vector source`)):T!=="vector"||i["source-layer"]?T==="raster-dem"&&p!=="hillshade"?e.push(new et(o,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!i.paint||!i.paint["line-gradient"]||T==="geojson"&&x.lineMetrics||e.push(new et(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new et(o,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new et(o,i.source,`source "${i.source}" not found`))}else e.push(new et(o,i,'missing required property "source"'));return e=e.concat(un({key:o,value:i,valueSpec:u.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ai({key:`${o}.type`,value:i.type,valueSpec:u.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:x=>wc(mo({layerType:p},x)),layout:x=>un({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":T=>hh(mo({layerType:p},T))}}),paint:x=>un({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":T=>uh(mo({layerType:p},T))}})}})),e}function cs(t){const e=t.value,i=t.key,o=Yt(e);return o!=="string"?[new et(i,e,`string expected, ${o} found`)]:[]}const Tc={promoteId:function({key:t,value:e}){if(Yt(e)==="string")return cs({key:t,value:e});{const i=[];for(const o in e)i.push(...cs({key:`${t}.${o}`,value:e[o]}));return i}}};function dh(t){const e=t.value,i=t.key,o=t.styleSpec,c=t.style;if(!e.type)return[new et(i,e,'"type" is required')];const u=Zr(e.type);let p;switch(u){case"vector":case"raster":case"raster-dem":return p=un({key:i,value:e,valueSpec:o[`source_${u.replace("-","_")}`],style:t.style,styleSpec:o,objectElementValidators:Tc}),p;case"geojson":if(p=un({key:i,value:e,valueSpec:o.source_geojson,style:c,styleSpec:o,objectElementValidators:Tc}),e.cluster)for(const g in e.clusterProperties){const[x,T]=e.clusterProperties[g],A=typeof x=="string"?[x,["accumulated"],["get",g]]:x;p.push(...Xn({key:`${i}.${g}.map`,value:T,expressionContext:"cluster-map"})),p.push(...Xn({key:`${i}.${g}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return p;case"video":return un({key:i,value:e,valueSpec:o.source_video,style:c,styleSpec:o});case"image":return un({key:i,value:e,valueSpec:o.source_image,style:c,styleSpec:o});case"canvas":return[new et(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return tl({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,styleSpec:o})}}function Ec(t){const e=t.value,i=t.styleSpec,o=i.light,c=t.style;let u=[];const p=Yt(e);if(e===void 0)return u;if(p!=="object")return u=u.concat([new et("light",e,`object expected, ${p} found`)]),u;for(const g in e){const x=g.match(/^(.*)-transition$/);u=u.concat(x&&o[x[1]]&&o[x[1]].transition?ai({key:g,value:e[g],valueSpec:i.transition,style:c,styleSpec:i}):o[g]?ai({key:g,value:e[g],valueSpec:o[g],style:c,styleSpec:i}):[new et(g,e[g],`unknown property "${g}"`)])}return u}function Sc(t){const e=t.value,i=t.key,o=t.style,c=t.styleSpec,u=c.terrain;let p=[];const g=Yt(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new et("terrain",e,`object expected, ${g} found`)]),p;for(const x in e){const T=x.match(/^(.*)-transition$/);p=p.concat(T&&u[T[1]]&&u[T[1]].transition?ai({key:x,value:e[x],valueSpec:c.transition,style:o,styleSpec:c}):u[x]?ai({key:x,value:e[x],valueSpec:u[x],style:o,styleSpec:c}):[new et(x,e[x],`unknown property "${x}"`)])}if(e.source){const x=o.sources&&o.sources[e.source],T=x&&Zr(x.type);x?T!=="raster-dem"&&p.push(new et(i,e.source,`terrain cannot be used with a source of type ${T}, it only be used with a "raster-dem" source type`)):p.push(new et(i,e.source,`source "${e.source}" not found`))}else p.push(new et(i,e,'terrain is missing required property "source"'));return p}function Ac(t){const e=t.value,i=t.style,o=t.styleSpec,c=o.fog;let u=[];const p=Yt(e);if(e===void 0)return u;if(p!=="object")return u=u.concat([new et("fog",e,`object expected, ${p} found`)]),u;for(const g in e){const x=g.match(/^(.*)-transition$/);u=u.concat(x&&c[x[1]]&&c[x[1]].transition?ai({key:g,value:e[g],valueSpec:o.transition,style:i,styleSpec:o}):c[g]?ai({key:g,value:e[g],valueSpec:c[g],style:i,styleSpec:o}):[new et(g,e[g],`unknown property "${g}"`)])}return u}const Cc={"*":()=>[],array:yc,boolean:function(t){const e=t.value,i=t.key,o=Yt(e);return o!=="boolean"?[new et(i,e,`boolean expected, ${o} found`)]:[]},number:oh,color:function(t){const e=t.key,i=t.value,o=Yt(i);return o!=="string"?[new et(e,i,`color expected, ${o} found`)]:is.parseCSSColor(i)===null?[new et(e,i,`color expected, "${i}" found`)]:[]},constants:Ru,enum:tl,filter:wc,function:el,layer:ta,object:un,source:dh,light:Ec,terrain:Sc,fog:Ac,string:cs,formatted:function(t){return cs(t).length===0?[]:Xn(t)},resolvedImage:function(t){return cs(t).length===0?[]:Xn(t)},projection:function(t){const e=t.value,i=t.styleSpec,o=i.projection,c=t.style;let u=[];const p=Yt(e);if(p==="object")for(const g in e)u=u.concat(ai({key:g,value:e[g],valueSpec:o[g],style:c,styleSpec:i}));else p!=="string"&&(u=u.concat([new et("projection",e,`object or string expected, ${p} found`)]));return u}};function ai(t){const e=t.value,i=t.valueSpec,o=t.styleSpec;return i.expression&&Ka(Zr(e))?el(t):i.expression&&ss(Zn(e))?Xn(t):i.type&&Cc[i.type]?Cc[i.type](t):un(mo({},t,{valueSpec:i.type?o[i.type]:i}))}function Mc(t){const e=t.value,i=t.key,o=cs(t);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new et(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new et(i,e,'"glyphs" url must include a "{range}" token'))),o}function Hn(t,e=Ae){let i=[];return i=i.concat(ai({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Mc,"*":()=>[]}})),t.constants&&(i=i.concat(Ru({key:"constants",value:t.constants,style:t,styleSpec:e}))),fh(i)}function fh(t){return[].concat(t).sort((e,i)=>e.line-i.line)}function Mn(t){return function(...e){return fh(t.apply(this,e))}}Hn.source=Mn(dh),Hn.light=Mn(Ec),Hn.terrain=Mn(Sc),Hn.fog=Mn(Ac),Hn.layer=Mn(ta),Hn.filter=Mn(wc),Hn.paintProperty=Mn(uh),Hn.layoutProperty=Mn(hh);const us=Hn,hs=us.light,hf=us.fog,Ic=us.paintProperty,df=us.layoutProperty;function ph(t,e){let i=!1;if(e&&e.length)for(const o of e)t.fire(new Ia(new Error(o.message))),i=!0;return i}var ra=Ei;function Ei(t,e,i){var o=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(i=c[2]);for(var u=0;u<this.d*this.d;u++){var p=c[3+u],g=c[3+u+1];o.push(p===g?null:c.subarray(p,g))}var x=c[3+o.length+1];this.keys=c.subarray(c[3+o.length],x),this.bboxes=c.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var T=0;T<this.d*this.d;T++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var A=i/e*t;this.min=-A,this.max=t+A}Ei.prototype.insert=function(t,e,i,o,c){this._forEachCell(e,i,o,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(c)},Ei.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ei.prototype._insertCell=function(t,e,i,o,c,u){this.cells[c].push(u)},Ei.prototype.query=function(t,e,i,o,c){var u=this.min,p=this.max;if(t<=u&&e<=u&&p<=i&&p<=o&&!c)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(t,e,i,o,this._queryCell,g,{},c),g},Ei.prototype._queryCell=function(t,e,i,o,c,u,p,g){var x=this.cells[c];if(x!==null)for(var T=this.keys,A=this.bboxes,C=0;C<x.length;C++){var I=x[C];if(p[I]===void 0){var R=4*I;(g?g(A[R+0],A[R+1],A[R+2],A[R+3]):t<=A[R+2]&&e<=A[R+3]&&i>=A[R+0]&&o>=A[R+1])?(p[I]=!0,u.push(T[I])):p[I]=!1}}},Ei.prototype._forEachCell=function(t,e,i,o,c,u,p,g){for(var x=this._convertToCellCoord(t),T=this._convertToCellCoord(e),A=this._convertToCellCoord(i),C=this._convertToCellCoord(o),I=x;I<=A;I++)for(var R=T;R<=C;R++){var N=this.d*R+I;if((!g||g(this._convertFromCellCoord(I),this._convertFromCellCoord(R),this._convertFromCellCoord(I+1),this._convertFromCellCoord(R+1)))&&c.call(this,t,e,i,o,N,u,p,g))return}},Ei.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Ei.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Ei.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,i=0,o=0;o<this.cells.length;o++)i+=this.cells[o].length;var c=new Int32Array(e+i+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var u=e,p=0;p<t.length;p++){var g=t[p];c[3+p]=u,c.set(g,u),u+=g.length}return c[3+t.length]=u,c.set(this.keys,u),c[3+t.length+1]=u+=this.keys.length,c.set(this.bboxes,u),u+=this.bboxes.length,c.buffer};const{ImageData:ia,ImageBitmap:ds}=G,na={};function rt(t,e,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),na[t]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}rt("Object",Object),ra.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},ra.deserialize=function(t){return new ra(t.buffer)},rt("Grid",ra),rt("Color",Xt),rt("Error",Error),rt("ResolvedImage",ln),rt("StylePropertyFunction",as),rt("StyleExpression",_c,{omit:["_evaluator"]}),rt("ZoomDependentExpression",gc),rt("ZoomConstantExpression",Qs),rt("CompoundExpression",qi,{omit:["_evaluate"]});for(const t in Cn)Cn[t]._classRegistryKey||rt(`Expression_${t}`,Cn[t]);function fs(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function mh(t){return ds&&t instanceof ds}function oa(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(fs(t)||mh(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof ia)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const o of t)i.push(oa(o,e));return i}if(typeof t=="object"){const i=t.constructor,o=i._classRegistryKey;if(!o)throw new Error("can't serialize object of unregistered class");const c=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const u in t){if(!t.hasOwnProperty(u)||na[o].omit.indexOf(u)>=0)continue;const p=t[u];c[u]=na[o].shallow.indexOf(u)>=0?p:oa(p,e)}t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof t)}function To(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||fs(t)||mh(t)||ArrayBuffer.isView(t)||t instanceof ia)return t;if(Array.isArray(t))return t.map(To);if(typeof t=="object"){const e=t.$name||"Object",{klass:i}=na[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const o=Object.create(i.prototype);for(const c of Object.keys(t)){if(c==="$name")continue;const u=t[c];o[c]=na[e].shallow.indexOf(c)>=0?u:To(u)}return o}throw new Error("can't deserialize object of type "+typeof t)}class d{constructor(){this.first=!0}update(e,i){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const r=t=>t>=1536&&t<=1791,l=t=>t>=1872&&t<=1919,f=t=>t>=2208&&t<=2303,_=t=>t>=11904&&t<=12031,y=t=>t>=12032&&t<=12255,w=t=>t>=12272&&t<=12287,S=t=>t>=12288&&t<=12351,k=t=>t>=12352&&t<=12447,z=t=>t>=12448&&t<=12543,P=t=>t>=12544&&t<=12591,O=t=>t>=12704&&t<=12735,V=t=>t>=12736&&t<=12783,K=t=>t>=12784&&t<=12799,Z=t=>t>=12800&&t<=13055,Y=t=>t>=13056&&t<=13311,se=t=>t>=13312&&t<=19903,X=t=>t>=19968&&t<=40959,ie=t=>t>=40960&&t<=42127,ne=t=>t>=42128&&t<=42191,te=t=>t>=44032&&t<=55215,re=t=>t>=63744&&t<=64255,ae=t=>t>=64336&&t<=65023,ve=t=>t>=65040&&t<=65055,Ee=t=>t>=65072&&t<=65103,Xe=t=>t>=65104&&t<=65135,Ve=t=>t>=65136&&t<=65279,je=t=>t>=65280&&t<=65519;function Ce(t){for(const e of t)if(De(e.charCodeAt(0)))return!0;return!1}function Te(t){for(const e of t)if(!Ne(e.charCodeAt(0)))return!1;return!0}function Ne(t){return!(r(t)||l(t)||f(t)||ae(t)||Ve(t))}function De(t){return!(t!==746&&t!==747&&(t<4352||!(O(t)||P(t)||Ee(t)&&!(t>=65097&&t<=65103)||re(t)||Y(t)||_(t)||V(t)||!(!S(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||se(t)||X(t)||Z(t)||(e=>e>=12592&&e<=12687)(t)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||te(t)||k(t)||w(t)||(e=>e>=12688&&e<=12703)(t)||y(t)||K(t)||z(t)&&t!==12540||!(!je(t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Xe(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||ve(t)||(e=>e>=19904&&e<=19967)(t)||ie(t)||ne(t))))}function ct(t){return!(De(t)||function(e){return!!((i=>i>=128&&i<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(i=>i>=8192&&i<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&e!==9251||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||S(e)||z(e)||(i=>i>=57344&&i<=63743)(e)||Ee(e)||Xe(e)||je(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function mt(t){return t>=1424&&t<=2303||ae(t)||Ve(t)}function It(t,e){return!(!e&&mt(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(i=>i>=6016&&i<=6143)(t))}function We(t){for(const e of t)if(mt(e.charCodeAt(0)))return!0;return!1}const ft="deferred",xt="loading",ar="loaded";let vr=null,yt="unavailable",Lt=null;const Mr=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(yt="error"),vr&&vr(t)};function ti(){Di.fire(new fo("pluginStateChange",{pluginStatus:yt,pluginURL:Lt}))}const Di=new po,hn=function(){return yt},In=function(){if(yt!==ft||!Lt)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");yt=xt,ti(),Lt&&Ls({url:Lt},t=>{t?Mr(t):(yt=ar,ti())})},$t={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>yt===ar||$t.applyArabicShaping!=null,isLoading:()=>yt===xt,setState(t){yt=t.pluginStatus,Lt=t.pluginURL},isParsed:()=>$t.applyArabicShaping!=null&&$t.processBidirectionalText!=null&&$t.processStyledBidirectionalText!=null,getPluginURL:()=>Lt};class bt{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new d,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,o){for(const c of i)if(!It(c.charCodeAt(0),o))return!1;return!0}(e,$t.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}class Ft{constructor(e,i){this.property=e,this.value=i,this.expression=function(o,c){if(Ka(o))return new as(o,c);if(ss(o)){const u=nh(o,c);if(u.result==="error")throw new Error(u.value.map(p=>`${p.key}: ${p.message}`).join(", "));return u.value}{let u=o;return typeof o=="string"&&c.type==="color"&&(u=Xt.parse(o)),{kind:"constant",evaluate:()=>u}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class jr{constructor(e){this.property=e,this.value=new Ft(e,void 0)}transitioned(e,i){return new Ar(this.property,this.value,i,Wt({},e.transition,this.transition),e.now)}untransitioned(){return new Ar(this.property,this.value,null,{},0)}}class Zi{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return $e(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new jr(this._values[e].property)),this._values[e].value=new Ft(this._values[e].property,i===null?void 0:$e(i))}getTransition(e){return $e(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new jr(this._values[e].property)),this._values[e].transition=$e(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const c=this.getTransition(i);c!==void 0&&(e[`${i}-transition`]=c)}return e}transitioned(e,i){const o=new Wi(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,i._values[c]);return o}untransitioned(){const e=new Wi(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Ar{constructor(e,i,o,c,u){const p=c.delay||0,g=c.duration||0;u=u||0,this.property=e,this.value=i,this.begin=u+p,this.end=this.begin+g,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const c=e.now||0,u=this.value.possiblyEvaluate(e,i,o),p=this.prior;if(p){if(c>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(c<this.begin)return p.possiblyEvaluate(e,i,o);{const g=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,o),u,tn(g))}}return u}}class Wi{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const c=new Uo(this._properties);for(const u of Object.keys(this._values))c._values[u]=this._values[u].possiblyEvaluate(e,i,o);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class sa{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return $e(this._values[e].value)}setValue(e,i){this._values[e]=new Ft(this._values[e].property,i===null?void 0:$e(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const c=new Uo(this._properties);for(const u of Object.keys(this._values))c._values[u]=this._values[u].possiblyEvaluate(e,i,o);return c}}class Li{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,c){return this.property.evaluate(this.value,this.parameters,e,i,o,c)}}class Uo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class nt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const c=Na[this.specification.type];return c?c(e,i,o):e}}class pt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,c){return new Li(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,c)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Li(this,{kind:"constant",value:void 0},e.parameters);const c=Na[this.specification.type];return c?new Li(this,{kind:"constant",value:c(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,c,u,p){return e.kind==="constant"?e.value:e.evaluate(i,o,c,u,p)}}class li extends pt{possiblyEvaluate(e,i,o,c){if(e.value===void 0)return new Li(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const u=e.expression.evaluate(i,null,{},o,c),p=e.property.specification.type==="resolvedImage"&&typeof u!="string"?u.name:u,g=this._calculate(p,p,p,i);return new Li(this,{kind:"constant",value:g},i)}if(e.expression.kind==="camera"){const u=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new Li(this,{kind:"constant",value:u},i)}return new Li(this,e.expression,i)}evaluate(e,i,o,c,u,p){if(e.kind==="source"){const g=e.evaluate(i,o,c,u,p);return this._calculate(g,g,g,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},o,c),e.evaluate({zoom:Math.floor(i.zoom)},o,c),e.evaluate({zoom:Math.floor(i.zoom)+1},o,c),i):e.value}_calculate(e,i,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:i,other:o}:{from:o,to:i,other:e}}interpolate(e){return e}}class jo{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const u=e.expression.evaluate(i,null,{},o,c);return this._calculate(u,u,u,i)}return this._calculate(e.expression.evaluate(new bt(Math.floor(i.zoom-1),i)),e.expression.evaluate(new bt(Math.floor(i.zoom),i)),e.expression.evaluate(new bt(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class Eo{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,c){return!!e.expression.evaluate(i,null,{},o,c)}interpolate(){return!1}}class pi{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const o=e[i];o.specification.overridable&&this.overridableProperties.push(i);const c=this.defaultPropertyValues[i]=new Ft(o,void 0),u=this.defaultTransitionablePropertyValues[i]=new jr(o);this.defaultTransitioningPropertyValues[i]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=c.possiblyEvaluate({})}}}function Lm(t,e){return 256*(t=Vt(Math.floor(t),0,255))+Vt(Math.floor(e),0,255)}rt("DataDrivenProperty",pt),rt("DataConstantProperty",nt),rt("CrossFadedDataDrivenProperty",li),rt("CrossFadedProperty",jo),rt("ColorRampProperty",Eo);const p0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class kc{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Kr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Nr(t,e=1){let i=0,o=0;return{members:t.map(c=>{const u=p0[c.type].BYTES_PER_ELEMENT,p=i=Rm(i,Math.max(e,u)),g=c.components||1;return o=Math.max(o,u),i+=u*g,{name:c.name,type:c.type,components:g,offset:p}}),size:Rm(i,Math.max(o,e)),alignment:e}}function Rm(t,e){return Math.ceil(t/e)*e}class al extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=o,e}}al.prototype.bytesPerElement=4,rt("StructArrayLayout2i4",al);class ll extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o,c)}emplace(e,i,o,c,u){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=o,this.int16[p+2]=c,this.int16[p+3]=u,e}}ll.prototype.bytesPerElement=8,rt("StructArrayLayout4i8",ll);class ff extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,u,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,c,u,p,g)}emplace(e,i,o,c,u,p,g,x){const T=6*e,A=12*e,C=3*e;return this.int16[T+0]=i,this.int16[T+1]=o,this.uint8[A+4]=c,this.uint8[A+5]=u,this.uint8[A+6]=p,this.uint8[A+7]=g,this.float32[C+2]=x,e}}ff.prototype.bytesPerElement=12,rt("StructArrayLayout2i4ub1f12",ff);class cl extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const u=3*e;return this.float32[u+0]=i,this.float32[u+1]=o,this.float32[u+2]=c,e}}cl.prototype.bytesPerElement=12,rt("StructArrayLayout3f12",cl);class ps extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,u,p,g,x,T,A){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,c,u,p,g,x,T,A)}emplace(e,i,o,c,u,p,g,x,T,A,C){const I=10*e;return this.uint16[I+0]=i,this.uint16[I+1]=o,this.uint16[I+2]=c,this.uint16[I+3]=u,this.uint16[I+4]=p,this.uint16[I+5]=g,this.uint16[I+6]=x,this.uint16[I+7]=T,this.uint16[I+8]=A,this.uint16[I+9]=C,e}}ps.prototype.bytesPerElement=20,rt("StructArrayLayout10ui20",ps);class _h extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,u,p,g,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,o,c,u,p,g,x)}emplace(e,i,o,c,u,p,g,x,T){const A=8*e;return this.uint16[A+0]=i,this.uint16[A+1]=o,this.uint16[A+2]=c,this.uint16[A+3]=u,this.uint16[A+4]=p,this.uint16[A+5]=g,this.uint16[A+6]=x,this.uint16[A+7]=T,e}}_h.prototype.bytesPerElement=16,rt("StructArrayLayout8ui16",_h);class pf extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,u,p,g,x,T,A,C,I,R,N,$,W){const Q=this.length;return this.resize(Q+1),this.emplace(Q,e,i,o,c,u,p,g,x,T,A,C,I,R,N,$,W)}emplace(e,i,o,c,u,p,g,x,T,A,C,I,R,N,$,W,Q){const oe=16*e;return this.int16[oe+0]=i,this.int16[oe+1]=o,this.int16[oe+2]=c,this.int16[oe+3]=u,this.uint16[oe+4]=p,this.uint16[oe+5]=g,this.uint16[oe+6]=x,this.uint16[oe+7]=T,this.int16[oe+8]=A,this.int16[oe+9]=C,this.int16[oe+10]=I,this.int16[oe+11]=R,this.int16[oe+12]=N,this.int16[oe+13]=$,this.int16[oe+14]=W,this.int16[oe+15]=Q,e}}pf.prototype.bytesPerElement=32,rt("StructArrayLayout4i4ui4i4i32",pf);class mf extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}mf.prototype.bytesPerElement=4,rt("StructArrayLayout1ul4",mf);class _f extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,u,p,g,x,T,A,C,I,R){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,o,c,u,p,g,x,T,A,C,I,R)}emplace(e,i,o,c,u,p,g,x,T,A,C,I,R,N){const $=20*e,W=10*e;return this.int16[$+0]=i,this.int16[$+1]=o,this.int16[$+2]=c,this.int16[$+3]=u,this.int16[$+4]=p,this.float32[W+3]=g,this.float32[W+4]=x,this.float32[W+5]=T,this.float32[W+6]=A,this.int16[$+14]=C,this.uint32[W+8]=I,this.uint16[$+18]=R,this.uint16[$+19]=N,e}}_f.prototype.bytesPerElement=40,rt("StructArrayLayout5i4f1i1ul2ui40",_f);class gh extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,u,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,c,u,p,g)}emplace(e,i,o,c,u,p,g,x){const T=8*e;return this.int16[T+0]=i,this.int16[T+1]=o,this.int16[T+2]=c,this.int16[T+4]=u,this.int16[T+5]=p,this.int16[T+6]=g,this.int16[T+7]=x,e}}gh.prototype.bytesPerElement=16,rt("StructArrayLayout3i2i2i16",gh);class gf extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,c,u)}emplace(e,i,o,c,u,p){const g=4*e,x=8*e;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=c,this.int16[x+6]=u,this.int16[x+7]=p,e}}gf.prototype.bytesPerElement=16,rt("StructArrayLayout2f1f2i16",gf);class yf extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o,c)}emplace(e,i,o,c,u){const p=12*e,g=3*e;return this.uint8[p+0]=i,this.uint8[p+1]=o,this.float32[g+1]=c,this.float32[g+2]=u,e}}yf.prototype.bytesPerElement=12,rt("StructArrayLayout2ub2f12",yf);class kn extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const u=3*e;return this.uint16[u+0]=i,this.uint16[u+1]=o,this.uint16[u+2]=c,e}}kn.prototype.bytesPerElement=6,rt("StructArrayLayout3ui6",kn);class vf extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,u,p,g,x,T,A,C,I,R,N,$,W,Q,oe,ce,fe,me){const _e=this.length;return this.resize(_e+1),this.emplace(_e,e,i,o,c,u,p,g,x,T,A,C,I,R,N,$,W,Q,oe,ce,fe,me)}emplace(e,i,o,c,u,p,g,x,T,A,C,I,R,N,$,W,Q,oe,ce,fe,me,_e){const Pe=30*e,Me=15*e,He=60*e;return this.int16[Pe+0]=i,this.int16[Pe+1]=o,this.int16[Pe+2]=c,this.float32[Me+2]=u,this.float32[Me+3]=p,this.uint16[Pe+8]=g,this.uint16[Pe+9]=x,this.uint32[Me+5]=T,this.uint32[Me+6]=A,this.uint32[Me+7]=C,this.uint16[Pe+16]=I,this.uint16[Pe+17]=R,this.uint16[Pe+18]=N,this.float32[Me+10]=$,this.float32[Me+11]=W,this.uint8[He+48]=Q,this.uint8[He+49]=oe,this.uint8[He+50]=ce,this.uint32[Me+13]=fe,this.int16[Pe+28]=me,this.uint8[He+58]=_e,e}}vf.prototype.bytesPerElement=60,rt("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",vf);class xf extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,u,p,g,x,T,A,C,I,R,N,$,W,Q,oe,ce,fe,me,_e,Pe,Me,He,qe,ze,Ze,Ke,Fe){const tt=this.length;return this.resize(tt+1),this.emplace(tt,e,i,o,c,u,p,g,x,T,A,C,I,R,N,$,W,Q,oe,ce,fe,me,_e,Pe,Me,He,qe,ze,Ze,Ke,Fe)}emplace(e,i,o,c,u,p,g,x,T,A,C,I,R,N,$,W,Q,oe,ce,fe,me,_e,Pe,Me,He,qe,ze,Ze,Ke,Fe,tt){const ot=38*e,jt=19*e;return this.int16[ot+0]=i,this.int16[ot+1]=o,this.int16[ot+2]=c,this.float32[jt+2]=u,this.float32[jt+3]=p,this.int16[ot+8]=g,this.int16[ot+9]=x,this.int16[ot+10]=T,this.int16[ot+11]=A,this.int16[ot+12]=C,this.int16[ot+13]=I,this.uint16[ot+14]=R,this.uint16[ot+15]=N,this.uint16[ot+16]=$,this.uint16[ot+17]=W,this.uint16[ot+18]=Q,this.uint16[ot+19]=oe,this.uint16[ot+20]=ce,this.uint16[ot+21]=fe,this.uint16[ot+22]=me,this.uint16[ot+23]=_e,this.uint16[ot+24]=Pe,this.uint16[ot+25]=Me,this.uint16[ot+26]=He,this.uint16[ot+27]=qe,this.uint16[ot+28]=ze,this.uint32[jt+15]=Ze,this.float32[jt+16]=Ke,this.float32[jt+17]=Fe,this.float32[jt+18]=tt,e}}xf.prototype.bytesPerElement=76,rt("StructArrayLayout3i2f6i15ui1ul3f76",xf);class yh extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}yh.prototype.bytesPerElement=4,rt("StructArrayLayout1f4",yh);class bf extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const u=3*e;return this.int16[u+0]=i,this.int16[u+1]=o,this.int16[u+2]=c,e}}bf.prototype.bytesPerElement=6,rt("StructArrayLayout3i6",bf);class zc extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,u,p,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,c,u,p,g)}emplace(e,i,o,c,u,p,g,x){const T=7*e;return this.float32[T+0]=i,this.float32[T+1]=o,this.float32[T+2]=c,this.float32[T+3]=u,this.float32[T+4]=p,this.float32[T+5]=g,this.float32[T+6]=x,e}}zc.prototype.bytesPerElement=28,rt("StructArrayLayout7f28",zc);class wf extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o,c)}emplace(e,i,o,c,u){const p=6*e;return this.uint32[3*e+0]=i,this.uint16[p+2]=o,this.uint16[p+3]=c,this.uint16[p+4]=u,e}}wf.prototype.bytesPerElement=12,rt("StructArrayLayout1ul3ui12",wf);class ms extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=o,e}}ms.prototype.bytesPerElement=4,rt("StructArrayLayout2ui4",ms);class vh extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}vh.prototype.bytesPerElement=2,rt("StructArrayLayout1ui2",vh);class xh extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=o,e}}xh.prototype.bytesPerElement=8,rt("StructArrayLayout2f8",xh);class Tf extends Kr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o,c)}emplace(e,i,o,c,u){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=c,this.float32[p+3]=u,e}}Tf.prototype.bytesPerElement=16,rt("StructArrayLayout4f16",Tf);class Om extends kc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Om.prototype.size=40;class Ef extends _f{get(e){return new Om(this,e)}}rt("CollisionBoxArray",Ef);class Bm extends kc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Bm.prototype.size=60;class Fm extends vf{get(e){return new Bm(this,e)}}rt("PlacedSymbolArray",Fm);class Nm extends kc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Nm.prototype.size=76;class Um extends xf{get(e){return new Nm(this,e)}}rt("SymbolInstanceArray",Um);class jm extends yh{getoffsetX(e){return this.float32[1*e+0]}}rt("GlyphOffsetArray",jm);class Vm extends bf{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}rt("SymbolLineVertexArray",Vm);class $m extends kc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}$m.prototype.size=12;class Gm extends wf{get(e){return new $m(this,e)}}rt("FeatureIndexArray",Gm);class qm extends kc{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}qm.prototype.size=4;class Zm extends ms{get(e){return new qm(this,e)}}rt("FillExtrusionCentroidArray",Zm);const m0=Nr([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),_0=Nr([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Wm=rs(function(t){t.exports=function(e,i){var o,c,u,p,g,x,T,A;for(c=e.length-(o=3&e.length),u=i,g=3432918353,x=461845907,A=0;A<c;)T=255&e.charCodeAt(A)|(255&e.charCodeAt(++A))<<8|(255&e.charCodeAt(++A))<<16|(255&e.charCodeAt(++A))<<24,++A,u=27492+(65535&(p=5*(65535&(u=(u^=T=(65535&(T=(T=(65535&T)*g+(((T>>>16)*g&65535)<<16)&4294967295)<<15|T>>>17))*x+(((T>>>16)*x&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(T=0,o){case 3:T^=(255&e.charCodeAt(A+2))<<16;case 2:T^=(255&e.charCodeAt(A+1))<<8;case 1:u^=T=(65535&(T=(T=(65535&(T^=255&e.charCodeAt(A)))*g+(((T>>>16)*g&65535)<<16)&4294967295)<<15|T>>>17))*x+(((T>>>16)*x&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}}),g0=rs(function(t){t.exports=function(e,i){for(var o,c=e.length,u=i^c,p=0;c>=4;)o=1540483477*(65535&(o=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(o>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),c-=4,++p;switch(c){case 3:u^=(255&e.charCodeAt(p+2))<<16;case 2:u^=(255&e.charCodeAt(p+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(p)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}}),Pc=Wm,y0=g0;Pc.murmur3=Wm,Pc.murmur2=y0;class bh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,o,c){this.ids.push(Xm(e)),this.positions.push(i,o,c)}getPositions(e){const i=Xm(e);let o=0,c=this.ids.length-1;for(;o<c;){const p=o+c>>1;this.ids[p]>=i?c=p:o=p+1}const u=[];for(;this.ids[o]===i;)u.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return u}static serialize(e,i){const o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return Sf(o,c,0,o.length-1),i&&i.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(e){const i=new bh;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function Xm(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Pc(String(t))}function Sf(t,e,i,o){for(;i<o;){const c=t[i+o>>1];let u=i-1,p=o+1;for(;;){do u++;while(t[u]<c);do p--;while(t[p]>c);if(u>=p)break;wh(t,u,p),wh(e,3*u,3*p),wh(e,3*u+1,3*p+1),wh(e,3*u+2,3*p+2)}p-i<o-p?(Sf(t,e,i,p),i=p+1):(Sf(t,e,p+1,o),o=p)}}function wh(t,e,i){const o=t[e];t[e]=t[i],t[i]=o}rt("FeaturePositionMap",bh);class Vo{constructor(e,i){this.gl=e.gl,this.location=i}}class Th extends Vo{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Hm extends Vo{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Km extends Vo{constructor(e,i){super(e,i),this.current=Xt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const v0=new Float32Array(16),x0=new Float32Array(9),b0=new Float32Array(4);function Af(t){return[Lm(255*t.r,255*t.g),Lm(255*t.b,255*t.a)]}class Dc{constructor(e,i,o){this.value=e,this.uniformNames=i.map(c=>`u_${c}`),this.type=o}setUniform(e,i,o){e.set(o.constantOr(this.value))}getBinding(e,i,o){return this.type==="color"?new Km(e,i):new Th(e,i)}}class ul{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tl.concat(i.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,i,o,c){const u=c==="u_pattern_to"||c==="u_dash_to"?this.patternTo:c==="u_pattern_from"||c==="u_dash_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;u&&e.set(u)}getBinding(e,i,o){return o==="u_pattern_from"||o==="u_pattern_to"||o==="u_dash_from"||o==="u_dash_to"?new Hm(e,i):new Th(e,i)}}class $o{constructor(e,i,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(u=>({name:`a_${u}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,i,o,c,u,p){const g=this.paintVertexArray.length,x=this.expression.evaluate(new bt(0),i,{},u,c,p);this.paintVertexArray.resize(e),this._setPaintValue(g,e,x)}updatePaintArray(e,i,o,c,u){const p=this.expression.evaluate({zoom:0},o,c,void 0,u);this._setPaintValue(e,i,p)}_setPaintValue(e,i,o){if(this.type==="color"){const c=Af(o);for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,c[0],c[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Kn{constructor(e,i,o,c,u,p){this.expression=e,this.uniformNames=i.map(g=>`u_${g}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=i.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,i,o,c,u,p){const g=this.expression.evaluate(new bt(this.zoom),i,{},u,c,p),x=this.expression.evaluate(new bt(this.zoom+1),i,{},u,c,p),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,g,x)}updatePaintArray(e,i,o,c,u){const p=this.expression.evaluate({zoom:this.zoom},o,c,void 0,u),g=this.expression.evaluate({zoom:this.zoom+1},o,c,void 0,u);this._setPaintValue(e,i,p,g)}_setPaintValue(e,i,o,c){if(this.type==="color"){const u=Af(o),p=Af(c);for(let g=e;g<i;g++)this.paintVertexArray.emplace(g,u[0],u[1],p[0],p[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,c=Vt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,i,o){return new Th(e,i)}}class _s{constructor(e,i,o,c,u,p,g){this.expression=e,this.type=o,this.useIntegerZoom=c,this.zoom=u,this.layerId=g,this.paintVertexAttributes=(o==="array"?_0:m0).members;for(let x=0;x<i.length;++x);this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,i,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,c,u,p){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],p)}_setPaintValues(e,i,o,c){if(!c||!o)return;const{min:u,mid:p,max:g}=o,x=c[u],T=c[p],A=c[g];if(x&&T&&A)for(let C=e;C<i;C++)this._setPaintValue(this.zoomInPaintVertexArray,C,T,x),this._setPaintValue(this.zoomOutPaintVertexArray,C,T,A)}_setPaintValue(e,i,o,c){e.emplace(i,o.tl[0],o.tl[1],o.br[0],o.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],o.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Go{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[];const c=[];for(const u in e.paint._values){if(!o(u))continue;const p=e.paint.get(u);if(!(p instanceof Li&&os(p.property.specification)))continue;const g=T0(u,e.type),x=p.value,T=p.property.specification.type,A=p.property.useIntegerZoom,C=p.property.specification["property-type"],I=C==="cross-faded"||C==="cross-faded-data-driven",R=String(u)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||R)if(x.kind==="source"||R||I){const N=Ym(u,T,"source");this.binders[u]=I?new _s(x,g,T,A,i,N,e.id):new $o(x,g,T,N),c.push(`/a_${u}`)}else{const N=Ym(u,T,"composite");this.binders[u]=new Kn(x,g,T,A,i,N),c.push(`/z_${u}`)}else this.binders[u]=I?new ul(x.value,g):new Dc(x.value,g,T),c.push(`/u_${u}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof $o||i instanceof Kn?i.maxValue:0}populatePaintArrays(e,i,o,c,u,p){for(const g in this.binders){const x=this.binders[g];(x instanceof $o||x instanceof Kn||x instanceof _s)&&x.populatePaintArray(e,i,o,c,u,p)}}setConstantPatternPositions(e,i){for(const o in this.binders){const c=this.binders[o];c instanceof ul&&c.setConstantPatternPositions(e,i)}}updatePaintArrays(e,i,o,c,u,p){let g=!1;for(const x in e){const T=i.getPositions(x);for(const A of T){const C=o.feature(A.index);for(const I in this.binders){const R=this.binders[I];if((R instanceof $o||R instanceof Kn||R instanceof _s)&&R.expression.isStateDependent===!0){const N=c.paint.get(I);R.expression=N.value,R.updatePaintArray(A.start,A.end,C,e[x],u,p),g=!0}}}}return g}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Dc||o instanceof ul)&&e.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof $o||o instanceof Kn||o instanceof _s)for(let c=0;c<o.paintVertexAttributes.length;c++)e.push(o.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Dc||o instanceof ul||o instanceof Kn)for(const c of o.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const o=[];for(const c in this.binders){const u=this.binders[c];if(u instanceof Dc||u instanceof ul||u instanceof Kn){for(const p of u.uniformNames)if(i[p]){const g=u.getBinding(e,i[p],p);o.push({name:p,property:c,binding:g})}}}return o}setUniforms(e,i,o,c){for(const{name:u,property:p,binding:g}of i)this.binders[p].setUniform(g,c,o.get(p),u)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(e&&o instanceof _s){const c=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof $o||o instanceof Kn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof $o||o instanceof Kn||o instanceof _s)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof $o||i instanceof Kn||i instanceof _s)&&i.destroy()}}}class aa{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new Go(c,i,o);this.needsUpload=!1,this._featureMap=new bh,this._bufferOffset=0}populatePaintArrays(e,i,o,c,u,p,g){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,i,c,u,p,g);i.id!==void 0&&this._featureMap.add(i.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,c,u){for(const p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(e,this._featureMap,i,p,c,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const w0={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function T0(t,e){return w0[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const E0={"line-pattern":{source:ps,composite:ps},"fill-pattern":{source:ps,composite:ps},"fill-extrusion-pattern":{source:ps,composite:ps},"line-dasharray":{source:_h,composite:_h}},S0={color:{source:xh,composite:Tf},number:{source:yh,composite:xh}};function Ym(t,e,i){const o=E0[t];return o&&o[i]||S0[e][i]}rt("ConstantBinder",Dc),rt("CrossFadedConstantBinder",ul),rt("SourceExpressionBinder",$o),rt("CrossFadedCompositeBinder",_s),rt("CompositeExpressionBinder",Kn),rt("ProgramConfiguration",Go,{omit:["_buffers"]}),rt("ProgramConfigurationSet",aa);const Eh="-transition";class Yn extends po{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new sa(i.layout)),i.paint)){this._transitionablePaint=new Zi(i.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Uo(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,o={}){i!=null&&this._validate(df,`layers.${this.id}.layout.${e}`,e,i,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return Ti(e,Eh)?this._transitionablePaint.getTransition(e.slice(0,-Eh.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,o={}){if(i!=null&&this._validate(Ic,`layers.${this.id}.paint.${e}`,e,i,o))return!1;if(Ti(e,Eh))return this._transitionablePaint.setTransition(e.slice(0,-Eh.length),i||void 0),!1;{const c=this._transitionablePaint._values[e],u=c.property.specification["property-type"]==="cross-faded-data-driven",p=c.value.isDataDriven(),g=c.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||p||u||this._handleOverridablePaintPropertyUpdate(e,g,x)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ho(e,(i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length))}_validate(e,i,o,c,u={}){return(!u||u.validate!==!1)&&ph(this,e.call(us,{key:i,layerType:this.type,objectKey:o,value:c,styleSpec:Ae,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Li&&os(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=il(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const A0=Nr([{name:"a_pos",components:2,type:"Int16"}],4),{members:C0}=A0;class Yr{constructor(e=[]){this.segments=e}prepareSegment(e,i,o,c){let u=this.segments[this.segments.length-1];return e>Yr.MAX_VERTEX_ARRAY_LENGTH&&Je(`Max vertices per segment is ${Yr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>Yr.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==c)&&(u={vertexOffset:i.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},c!==void 0&&(u.sortKey=c),this.segments.push(u)),u}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,c){return new Yr([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}Yr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,rt("SegmentVector",Yr);var Rt=8192;class la{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof mr?new mr(e.lng,e.lat):mr.convert(e),this}setSouthWest(e){return this._sw=e instanceof mr?new mr(e.lng,e.lat):mr.convert(e),this}extend(e){const i=this._sw,o=this._ne;let c,u;if(e instanceof mr)c=e,u=e;else{if(!(e instanceof la))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(la.convert(e)):this.extend(mr.convert(e)):this;if(c=e._sw,u=e._ne,!c||!u)return this}return i||o?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),o.lng=Math.max(u.lng,o.lng),o.lat=Math.max(u.lat,o.lat)):(this._sw=new mr(c.lng,c.lat),this._ne=new mr(u.lng,u.lat)),this}getCenter(){return new mr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new mr(this.getWest(),this.getNorth())}getSouthEast(){return new mr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=mr.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&c}static convert(e){return!e||e instanceof la?e:new la(e)}}const Jm=63710088e-1;class mr{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new mr(wi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,c=e.lat*i,u=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return Jm*Math.acos(Math.min(u,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new la(new mr(this.lng-o,this.lat-i),new mr(this.lng+o,this.lat+i))}static convert(e){if(e instanceof mr)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new mr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new mr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Qm=2*Math.PI*Jm;function e_(t){return Qm*Math.cos(t*Math.PI/180)}function hl(t){return(180+t)/360}function dl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Jn(t,e){return t/e_(e)}function qo(t){return 360*t-180}function jn(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function t_(t,e){return t*e_(jn(e))}const So=85.051129;class Sh{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=mr.convert(e);return new Sh(hl(o.lng),dl(o.lat),Jn(i,o.lat))}toLngLat(){return new mr(qo(this.x),jn(this.y))}toAltitude(){return t_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Qm*(e=jn(this.y),1/Math.cos(e*Math.PI/180));var e}}function Cf(t,e,i,o,c,u,p,g,x){const T=(e+o)/2,A=(i+c)/2,C=new j(T,A);g(C),function(I,R,N,$,W,Q){const oe=N-W,ce=$-Q;return Math.abs(($-R)*oe-(N-I)*ce)/Math.hypot(oe,ce)}(C.x,C.y,u.x,u.y,p.x,p.y)>=x?(Cf(t,e,i,T,A,u,C,g,x),Cf(t,T,A,o,c,C,p,g,x)):t.push(p)}function M0(t,e,i){const o=[];let c,u,p;for(const g of t){const{x,y:T}=g;e(g),p?Cf(o,c,u,x,T,p,g,e,i):o.push(g),c=x,u=T,p=g}return o}const Mf=Math.pow(2,14)-1,r_=-Mf-1;function I0(t,e){const i=Math.round(t.x*e),o=Math.round(t.y*e);return t.x=Vt(i,r_,Mf),t.y=Vt(o,r_,Mf),(i<t.x||i>t.x+1||o<t.y||o>t.y+1)&&Je("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Zo(t,e,i){const o=t.loadGeometry(),c=t.extent,u=Rt/c;if(e&&i&&i.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:g,x,y:T,projection:A}=i,C=I=>{const R=qo((e.x+I.x/c)/p),N=jn((e.y+I.y/c)/p),$=A.project(R,N);I.x=($.x*g-x)*c,I.y=($.y*g-T)*c};for(let I=0;I<o.length;I++)if(t.type!==1)o[I]=M0(o[I],C,1);else{const R=[];for(const N of o[I])N.x<0||N.x>=c||N.y<0||N.y>=c||(C(N),R.push(N));o[I]=R}}for(const p of o)for(const g of p)I0(g,u);return o}function ca(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Zo(t):[]}}function Ah(t,e,i,o,c){t.emplaceBack(2*e+(o+1)/2,2*i+(c+1)/2)}class If{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new al,this.indexArray=new kn,this.segments=new Yr,this.programConfigurations=new aa(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o,c){const u=this.layers[0],p=[];let g=null;u.type==="circle"&&(g=u.layout.get("circle-sort-key"));for(const{feature:x,id:T,index:A,sourceLayerIndex:C}of e){const I=this.layers[0]._featureFilter.needGeometry,R=ca(x,I);if(!this.layers[0]._featureFilter.filter(new bt(this.zoom),R,o))continue;const N=g?g.evaluate(R,{},o):void 0,$={id:T,properties:x.properties,type:x.type,sourceLayerIndex:C,index:A,geometry:I?R.geometry:Zo(x,o,c),patterns:{},sortKey:N};p.push($)}g&&p.sort((x,T)=>x.sortKey-T.sortKey);for(const x of p){const{geometry:T,index:A,sourceLayerIndex:C}=x,I=e[A].feature;this.addFeature(x,T,A,i.availableImages,o),i.featureIndex.insert(I,T,A,C,this.index)}}update(e,i,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,C0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,c,u){for(const p of i)for(const g of p){const x=g.x,T=g.y;if(x<0||x>=Rt||T<0||T>=Rt)continue;const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),C=A.vertexLength;Ah(this.layoutVertexArray,x,T,-1,-1),Ah(this.layoutVertexArray,x,T,1,-1),Ah(this.layoutVertexArray,x,T,1,1),Ah(this.layoutVertexArray,x,T,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+3,C+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},c,u)}}function i_(t,e){for(let i=0;i<t.length;i++)if(fl(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(fl(t,e[i]))return!0;return!!kf(t,e)}function k0(t,e,i){return!!fl(t,e)||!!zf(e,t,i)}function n_(t,e){if(t.length===1)return s_(e,t[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let c=0;c<o.length;c++)if(fl(t,o[c]))return!0}for(let i=0;i<t.length;i++)if(s_(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(kf(t,e[i]))return!0;return!1}function z0(t,e,i){if(t.length>1){if(kf(t,e))return!0;for(let o=0;o<e.length;o++)if(zf(e[o],t,i))return!0}for(let o=0;o<t.length;o++)if(zf(t[o],e,i))return!0;return!1}function kf(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const o=t[i],c=t[i+1];for(let u=0;u<e.length-1;u++)if(P0(o,c,e[u],e[u+1]))return!0}return!1}function P0(t,e,i,o){return Et(t,i,o)!==Et(e,i,o)&&Et(t,e,i)!==Et(t,e,o)}function zf(t,e,i){const o=i*i;if(e.length===1)return t.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(o_(t,e[c-1],e[c])<o)return!0;return!1}function o_(t,e,i){const o=e.distSqr(i);if(o===0)return t.distSqr(e);const c=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/o;return t.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function s_(t,e){let i,o,c,u=!1;for(let p=0;p<t.length;p++){i=t[p];for(let g=0,x=i.length-1;g<i.length;x=g++)o=i[g],c=i[x],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(u=!u)}return u}function fl(t,e){let i=!1;for(let o=0,c=t.length-1;o<t.length;c=o++){const u=t[o],p=t[c];u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(i=!i)}return i}function a_(t,e,i,o,c){for(const p of t)if(e<=p.x&&i<=p.y&&o>=p.x&&c>=p.y)return!0;const u=[new j(e,i),new j(e,c),new j(o,c),new j(o,i)];if(t.length>2){for(const p of u)if(fl(t,p))return!0}for(let p=0;p<t.length-1;p++)if(D0(t[p],t[p+1],u))return!0;return!1}function D0(t,e,i){const o=i[0],c=i[2];if(t.x<o.x&&e.x<o.x||t.x>c.x&&e.x>c.x||t.y<o.y&&e.y<o.y||t.y>c.y&&e.y>c.y)return!1;const u=Et(t,e,i[0]);return u!==Et(t,e,i[1])||u!==Et(t,e,i[2])||u!==Et(t,e,i[3])}function pl(t,e,i){const o=e.paint.get(t).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(t)}function Ch(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function l_(t,e,i,o,c){if(!e[0]&&!e[1])return t;const u=j.convert(e)._mult(c);i==="viewport"&&u._rotate(-o);const p=[];for(let g=0;g<t.length;g++)p.push(t[g].sub(u));return p}function c_(t,e,i,o){const c=j.convert(t)._mult(o);return e==="viewport"&&c._rotate(-i),c}rt("CircleBucket",If,{omit:["layers"]});const L0=new pi({"circle-sort-key":new pt(Ae.layout_circle["circle-sort-key"])});var R0={paint:new pi({"circle-radius":new pt(Ae.paint_circle["circle-radius"]),"circle-color":new pt(Ae.paint_circle["circle-color"]),"circle-blur":new pt(Ae.paint_circle["circle-blur"]),"circle-opacity":new pt(Ae.paint_circle["circle-opacity"]),"circle-translate":new nt(Ae.paint_circle["circle-translate"]),"circle-translate-anchor":new nt(Ae.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new nt(Ae.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new nt(Ae.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pt(Ae.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pt(Ae.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pt(Ae.paint_circle["circle-stroke-opacity"])}),layout:L0};class Pf{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,o,c){const u=Math.pow(2,o),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const T=gi([],x,e),A=1/T[3]/i*u;return function(C,I,R){return C[0]=I[0]*R[0],C[1]=I[1]*R[1],C[2]=I[2]*R[2],C[3]=I[3]*R[3],C}(T,T,[A,A,c?1/T[3]:A,A])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const T=At([],Or([],En([],p[x[0]],p[x[1]]),En([],p[x[2]],p[x[1]]))),A=-fr(T,p[x[1]]);return T.concat(A)});return new Pf(p,g)}}class Qn{constructor(e,i){this.min=e,this.max=i,this.center=$r([],wt([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],o=Ye(this.min),c=Ye(this.max);for(let u=0;u<i.length;u++)o[u]=i[u]?this.min[u]:this.center[u],c[u]=i[u]?this.center[u]:this.max[u];return c[2]=this.max[2],new Qn(o,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let o=!0;for(let c=0;c<e.planes.length;c++){const u=e.planes[c];let p=0;for(let g=0;g<i.length;g++)p+=fr(u,i[g])+u[3]>=0;if(p===0)return 0;p!==i.length&&(o=!1)}if(o)return 2;for(let c=0;c<3;c++){let u=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let g=0;g<e.points.length;g++){const x=e.points[g][c]-this.min[c];u=Math.min(u,x),p=Math.max(p,x)}if(p<0||u>this.max[c]-this.min[c])return 0}return 1}}function u_(t,e,i,o,c,u,p,g,x){if(u&&t.queryGeometry.isAboveHorizon)return!1;u&&(x*=t.pixelToTileUnitsFactor);for(const T of e)for(const A of T){const C=A.add(g),I=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(C.x,C.y,!0):0,R=u?C:O0(C,I,o),N=u?t.tilespaceRays.map(W=>F0(W,I)):t.queryGeometry.screenGeometry,$=gi([],[A.x,A.y,I,1],o);if(!p&&u?x*=$[3]/i.cameraToCenterDistance:p&&!u&&(x*=i.cameraToCenterDistance/$[3]),k0(N,R,x))return!0}return!1}function O0(t,e,i){const o=gi([],[t.x,t.y,e,1],i);return new j(o[0]/o[3],o[1]/o[3])}const h_=at(0,0,0),B0=at(0,0,1);function F0(t,e){const i=Be();return h_[2]=e,t.intersectsPlane(h_,B0,i),new j(i[0],i[1])}class d_ extends If{}function Df(t,{width:e,height:i},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*o)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*i*o);return t.width=e,t.height=i,t.data=c,t}function f_(t,{width:e,height:i},o){if(e===t.width&&i===t.height)return;const c=Df({},{width:e,height:i},o);Lf(t,c,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,i)},o),t.width=e,t.height=i,t.data=c.data}function Lf(t,e,i,o,c,u){if(c.width===0||c.height===0)return e;if(c.width>t.width||c.height>t.height||i.x>t.width-c.width||i.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const p=t.data,g=e.data;for(let x=0;x<c.height;x++){const T=((i.y+x)*t.width+i.x)*u,A=((o.y+x)*e.width+o.x)*u;for(let C=0;C<c.width*u;C++)g[A+C]=p[T+C]}return e}rt("HeatmapBucket",d_,{omit:["layers"]});class gs{constructor(e,i){Df(this,e,1,i)}resize(e){f_(this,e,1)}clone(){return new gs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,c,u){Lf(e,i,o,c,u,1)}}class zn{constructor(e,i){Df(this,e,4,i)}resize(e){f_(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new zn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,c,u){Lf(e,i,o,c,u,4)}}rt("AlphaImage",gs),rt("RGBAImage",zn);var N0={paint:new pi({"heatmap-radius":new pt(Ae.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pt(Ae.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new nt(Ae.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Eo(Ae.paint_heatmap["heatmap-color"]),"heatmap-opacity":new nt(Ae.paint_heatmap["heatmap-opacity"])})};function Rf(t){const e={},i=t.resolution||256,o=t.clips?t.clips.length:1,c=t.image||new zn({width:i,height:o}),u=(p,g,x)=>{e[t.evaluationKey]=x;const T=t.expression.evaluate(e);c.data[p+g+0]=Math.floor(255*T.r/T.a),c.data[p+g+1]=Math.floor(255*T.g/T.a),c.data[p+g+2]=Math.floor(255*T.b/T.a),c.data[p+g+3]=Math.floor(255*T.a)};if(t.clips)for(let p=0,g=0;p<o;++p,g+=4*i)for(let x=0,T=0;x<i;x++,T+=4){const A=x/(i-1),{start:C,end:I}=t.clips[p];u(g,T,C*(1-A)+I*A)}else for(let p=0,g=0;p<i;p++,g+=4)u(0,g,p/(i-1));return c}var U0={paint:new pi({"hillshade-illumination-direction":new nt(Ae.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new nt(Ae.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new nt(Ae.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new nt(Ae.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new nt(Ae.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new nt(Ae.paint_hillshade["hillshade-accent-color"])})};const j0=Nr([{name:"a_pos",components:2,type:"Int16"}],4),{members:V0}=j0;var Mh=Ih,$0=Ih;function Ih(t,e,i){i=i||2;var o,c,u,p,g,x,T,A=e&&e.length,C=A?e[0]*i:t.length,I=p_(t,0,C,i,!0),R=[];if(!I||I.next===I.prev)return R;if(A&&(I=function($,W,Q,oe){var ce,fe,me,_e=[];for(ce=0,fe=W.length;ce<fe;ce++)(me=p_($,W[ce]*oe,ce<fe-1?W[ce+1]*oe:$.length,oe,!1))===me.next&&(me.steiner=!0),_e.push(Y0(me));for(_e.sort(X0),ce=0;ce<_e.length;ce++)Q=ys(Q=H0(_e[ce],Q),Q.next);return Q}(t,e,I,i)),t.length>80*i){o=u=t[0],c=p=t[1];for(var N=i;N<C;N+=i)(g=t[N])<o&&(o=g),(x=t[N+1])<c&&(c=x),g>u&&(u=g),x>p&&(p=x);T=(T=Math.max(u-o,p-c))!==0?1/T:0}return Lc(I,R,i,o,c,T),R}function p_(t,e,i,o,c){var u,p;if(c===Ff(t,e,i,o)>0)for(u=e;u<i;u+=o)p=g_(u,t[u],t[u+1],p);else for(u=i-o;u>=e;u-=o)p=g_(u,t[u],t[u+1],p);return p&&kh(p,p.next)&&(Oc(p),p=p.next),p}function ys(t,e){if(!t)return t;e||(e=t);var i,o=t;do if(i=!1,o.steiner||!kh(o,o.next)&&Jr(o.prev,o,o.next)!==0)o=o.next;else{if(Oc(o),(o=e=o.prev)===o.next)break;i=!0}while(i||o!==e);return e}function Lc(t,e,i,o,c,u,p){if(t){!p&&u&&function(A,C,I,R){var N=A;do N.z===null&&(N.z=Of(N.x,N.y,C,I,R)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==A);N.prevZ.nextZ=null,N.prevZ=null,function($){var W,Q,oe,ce,fe,me,_e,Pe,Me=1;do{for(Q=$,$=null,fe=null,me=0;Q;){for(me++,oe=Q,_e=0,W=0;W<Me&&(_e++,oe=oe.nextZ);W++);for(Pe=Me;_e>0||Pe>0&&oe;)_e!==0&&(Pe===0||!oe||Q.z<=oe.z)?(ce=Q,Q=Q.nextZ,_e--):(ce=oe,oe=oe.nextZ,Pe--),fe?fe.nextZ=ce:$=ce,ce.prevZ=fe,fe=ce;Q=oe}fe.nextZ=null,Me*=2}while(me>1)}(N)}(t,o,c,u);for(var g,x,T=t;t.prev!==t.next;)if(g=t.prev,x=t.next,u?q0(t,o,c,u):G0(t))e.push(g.i/i),e.push(t.i/i),e.push(x.i/i),Oc(t),t=x.next,T=x.next;else if((t=x)===T){p?p===1?Lc(t=Z0(ys(t),e,i),e,i,o,c,u,2):p===2&&W0(t,e,i,o,c,u):Lc(ys(t),e,i,o,c,u,1);break}}}function G0(t){var e=t.prev,i=t,o=t.next;if(Jr(e,i,o)>=0)return!1;for(var c=t.next.next;c!==t.prev;){if(ml(e.x,e.y,i.x,i.y,o.x,o.y,c.x,c.y)&&Jr(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function q0(t,e,i,o){var c=t.prev,u=t,p=t.next;if(Jr(c,u,p)>=0)return!1;for(var g=c.x>u.x?c.x>p.x?c.x:p.x:u.x>p.x?u.x:p.x,x=c.y>u.y?c.y>p.y?c.y:p.y:u.y>p.y?u.y:p.y,T=Of(c.x<u.x?c.x<p.x?c.x:p.x:u.x<p.x?u.x:p.x,c.y<u.y?c.y<p.y?c.y:p.y:u.y<p.y?u.y:p.y,e,i,o),A=Of(g,x,e,i,o),C=t.prevZ,I=t.nextZ;C&&C.z>=T&&I&&I.z<=A;){if(C!==t.prev&&C!==t.next&&ml(c.x,c.y,u.x,u.y,p.x,p.y,C.x,C.y)&&Jr(C.prev,C,C.next)>=0||(C=C.prevZ,I!==t.prev&&I!==t.next&&ml(c.x,c.y,u.x,u.y,p.x,p.y,I.x,I.y)&&Jr(I.prev,I,I.next)>=0))return!1;I=I.nextZ}for(;C&&C.z>=T;){if(C!==t.prev&&C!==t.next&&ml(c.x,c.y,u.x,u.y,p.x,p.y,C.x,C.y)&&Jr(C.prev,C,C.next)>=0)return!1;C=C.prevZ}for(;I&&I.z<=A;){if(I!==t.prev&&I!==t.next&&ml(c.x,c.y,u.x,u.y,p.x,p.y,I.x,I.y)&&Jr(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function Z0(t,e,i){var o=t;do{var c=o.prev,u=o.next.next;!kh(c,u)&&m_(c,o,o.next,u)&&Rc(c,u)&&Rc(u,c)&&(e.push(c.i/i),e.push(o.i/i),e.push(u.i/i),Oc(o),Oc(o.next),o=t=u),o=o.next}while(o!==t);return ys(o)}function W0(t,e,i,o,c,u){var p=t;do{for(var g=p.next.next;g!==p.prev;){if(p.i!==g.i&&J0(p,g)){var x=__(p,g);return p=ys(p,p.next),x=ys(x,x.next),Lc(p,e,i,o,c,u),void Lc(x,e,i,o,c,u)}g=g.next}p=p.next}while(p!==t)}function X0(t,e){return t.x-e.x}function H0(t,e){var i=function(u,p){var g,x=p,T=u.x,A=u.y,C=-1/0;do{if(A<=x.y&&A>=x.next.y&&x.next.y!==x.y){var I=x.x+(A-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(I<=T&&I>C){if(C=I,I===T){if(A===x.y)return x;if(A===x.next.y)return x.next}g=x.x<x.next.x?x:x.next}}x=x.next}while(x!==p);if(!g)return null;if(T===C)return g;var R,N=g,$=g.x,W=g.y,Q=1/0;x=g;do T>=x.x&&x.x>=$&&T!==x.x&&ml(A<W?T:C,A,$,W,A<W?C:T,A,x.x,x.y)&&(R=Math.abs(A-x.y)/(T-x.x),Rc(x,u)&&(R<Q||R===Q&&(x.x>g.x||x.x===g.x&&K0(g,x)))&&(g=x,Q=R)),x=x.next;while(x!==N);return g}(t,e);if(!i)return e;var o=__(i,t),c=ys(i,i.next);return ys(o,o.next),e===i?c:e}function K0(t,e){return Jr(t.prev,t,e.prev)<0&&Jr(e.next,t,t.next)<0}function Of(t,e,i,o,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*c)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-o)*c)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Y0(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function ml(t,e,i,o,c,u,p,g){return(c-p)*(e-g)-(t-p)*(u-g)>=0&&(t-p)*(o-g)-(i-p)*(e-g)>=0&&(i-p)*(u-g)-(c-p)*(o-g)>=0}function J0(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,o){var c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==o.i&&c.next.i!==o.i&&m_(c,c.next,i,o))return!0;c=c.next}while(c!==i);return!1}(t,e)&&(Rc(t,e)&&Rc(e,t)&&function(i,o){var c=i,u=!1,p=(i.x+o.x)/2,g=(i.y+o.y)/2;do c.y>g!=c.next.y>g&&c.next.y!==c.y&&p<(c.next.x-c.x)*(g-c.y)/(c.next.y-c.y)+c.x&&(u=!u),c=c.next;while(c!==i);return u}(t,e)&&(Jr(t.prev,t,e.prev)||Jr(t,e.prev,e))||kh(t,e)&&Jr(t.prev,t,t.next)>0&&Jr(e.prev,e,e.next)>0)}function Jr(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function kh(t,e){return t.x===e.x&&t.y===e.y}function m_(t,e,i,o){var c=Ph(Jr(t,e,i)),u=Ph(Jr(t,e,o)),p=Ph(Jr(i,o,t)),g=Ph(Jr(i,o,e));return c!==u&&p!==g||!(c!==0||!zh(t,i,e))||!(u!==0||!zh(t,o,e))||!(p!==0||!zh(i,t,o))||!(g!==0||!zh(i,e,o))}function zh(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Ph(t){return t>0?1:t<0?-1:0}function Rc(t,e){return Jr(t.prev,t,t.next)<0?Jr(t,e,t.next)>=0&&Jr(t,t.prev,e)>=0:Jr(t,e,t.prev)<0||Jr(t,t.next,e)<0}function __(t,e){var i=new Bf(t.i,t.x,t.y),o=new Bf(e.i,e.x,e.y),c=t.next,u=e.prev;return t.next=e,e.prev=t,i.next=c,c.prev=i,o.next=i,i.prev=o,u.next=o,o.prev=u,o}function g_(t,e,i,o){var c=new Bf(t,e,i);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function Oc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Bf(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ff(t,e,i,o){for(var c=0,u=e,p=i-o;u<i;u+=o)c+=(t[p]-t[u])*(t[u+1]+t[p+1]),p=u;return c}function Q0(t,e,i,o,c){y_(t,e,i||0,o||t.length-1,c||e1)}function y_(t,e,i,o,c){for(;o>i;){if(o-i>600){var u=o-i+1,p=e-i+1,g=Math.log(u),x=.5*Math.exp(2*g/3),T=.5*Math.sqrt(g*x*(u-x)/u)*(p-u/2<0?-1:1);y_(t,e,Math.max(i,Math.floor(e-p*x/u+T)),Math.min(o,Math.floor(e+(u-p)*x/u+T)),c)}var A=t[e],C=i,I=o;for(Bc(t,i,e),c(t[o],A)>0&&Bc(t,i,o);C<I;){for(Bc(t,C,I),C++,I--;c(t[C],A)<0;)C++;for(;c(t[I],A)>0;)I--}c(t[i],A)===0?Bc(t,i,I):Bc(t,++I,o),I<=e&&(i=I+1),e<=I&&(o=I-1)}}function Bc(t,e,i){var o=t[e];t[e]=t[i],t[i]=o}function e1(t,e){return t<e?-1:t>e?1:0}function Nf(t,e){const i=t.length;if(i<=1)return[t];const o=[];let c,u;for(let p=0;p<i;p++){const g=lr(t[p]);g!==0&&(t[p].area=Math.abs(g),u===void 0&&(u=g<0),u===g<0?(c&&o.push(c),c=[t[p]]):c.push(t[p]))}if(c&&o.push(c),e>1)for(let p=0;p<o.length;p++)o[p].length<=e||(Q0(o[p],e,1,o[p].length-1,t1),o[p]=o[p].slice(0,e));return o}function t1(t,e){return e.area-t.area}function Uf(t,e,i){const o=i.patternDependencies;let c=!1;for(const u of e){const p=u.paint.get(`${t}-pattern`);p.isConstant()||(c=!0);const g=p.constantOr(null);g&&(c=!0,o[g.to]=!0,o[g.from]=!0)}return c}function jf(t,e,i,o,c){const u=c.patternDependencies;for(const p of e){const g=p.paint.get(`${t}-pattern`).value;if(g.kind!=="constant"){let x=g.evaluate({zoom:o-1},i,{},c.availableImages),T=g.evaluate({zoom:o},i,{},c.availableImages),A=g.evaluate({zoom:o+1},i,{},c.availableImages);x=x&&x.name?x.name:x,T=T&&T.name?T.name:T,A=A&&A.name?A.name:A,u[x]=!0,u[T]=!0,u[A]=!0,i.patterns[p.id]={min:x,mid:T,max:A}}}return i}Ih.deviation=function(t,e,i,o){var c=e&&e.length,u=Math.abs(Ff(t,0,c?e[0]*i:t.length,i));if(c)for(var p=0,g=e.length;p<g;p++)u-=Math.abs(Ff(t,e[p]*i,p<g-1?e[p+1]*i:t.length,i));var x=0;for(p=0;p<o.length;p+=3){var T=o[p]*i,A=o[p+1]*i,C=o[p+2]*i;x+=Math.abs((t[T]-t[C])*(t[A+1]-t[T+1])-(t[T]-t[A])*(t[C+1]-t[T+1]))}return u===0&&x===0?0:Math.abs((x-u)/u)},Ih.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},o=0,c=0;c<t.length;c++){for(var u=0;u<t[c].length;u++)for(var p=0;p<e;p++)i.vertices.push(t[c][u][p]);c>0&&i.holes.push(o+=t[c-1].length)}return i},Mh.default=$0;class Dh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new al,this.indexArray=new kn,this.indexArray2=new ms,this.programConfigurations=new aa(e.layers,e.zoom),this.segments=new Yr,this.segments2=new Yr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o,c){this.hasPattern=Uf("fill",this.layers,i);const u=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:g,id:x,index:T,sourceLayerIndex:A}of e){const C=this.layers[0]._featureFilter.needGeometry,I=ca(g,C);if(!this.layers[0]._featureFilter.filter(new bt(this.zoom),I,o))continue;const R=u?u.evaluate(I,{},o,i.availableImages):void 0,N={id:x,properties:g.properties,type:g.type,sourceLayerIndex:A,index:T,geometry:C?I.geometry:Zo(g,o,c),patterns:{},sortKey:R};p.push(N)}u&&p.sort((g,x)=>g.sortKey-x.sortKey);for(const g of p){const{geometry:x,index:T,sourceLayerIndex:A}=g;if(this.hasPattern){const C=jf("fill",this.layers,g,this.zoom,i);this.patternFeatures.push(C)}else this.addFeature(g,x,T,o,{},i.availableImages);i.featureIndex.insert(e[T].feature,x,T,A,this.index)}}update(e,i,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o,c)}addFeatures(e,i,o,c){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,i,o,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,V0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,c,u,p=[]){for(const g of Nf(i,500)){let x=0;for(const N of g)x+=N.length;const T=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),A=T.vertexLength,C=[],I=[];for(const N of g){if(N.length===0)continue;N!==g[0]&&I.push(C.length/2);const $=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),W=$.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(W+N.length-1,W),C.push(N[0].x),C.push(N[0].y);for(let Q=1;Q<N.length;Q++)this.layoutVertexArray.emplaceBack(N[Q].x,N[Q].y),this.indexArray2.emplaceBack(W+Q-1,W+Q),C.push(N[Q].x),C.push(N[Q].y);$.vertexLength+=N.length,$.primitiveLength+=N.length}const R=Mh(C,I);for(let N=0;N<R.length;N+=3)this.indexArray.emplaceBack(A+R[N],A+R[N+1],A+R[N+2]);T.vertexLength+=x,T.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,p,c)}}rt("FillBucket",Dh,{omit:["layers","patternFeatures"]});const r1=new pi({"fill-sort-key":new pt(Ae.layout_fill["fill-sort-key"])});var i1={paint:new pi({"fill-antialias":new nt(Ae.paint_fill["fill-antialias"]),"fill-opacity":new pt(Ae.paint_fill["fill-opacity"]),"fill-color":new pt(Ae.paint_fill["fill-color"]),"fill-outline-color":new pt(Ae.paint_fill["fill-outline-color"]),"fill-translate":new nt(Ae.paint_fill["fill-translate"]),"fill-translate-anchor":new nt(Ae.paint_fill["fill-translate-anchor"]),"fill-pattern":new li(Ae.paint_fill["fill-pattern"])}),layout:r1};const n1=Nr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),o1=Nr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:s1}=n1;var v_=_l;function _l(t,e,i,o,c){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=o,this._values=c,t.readFields(a1,this,e)}function a1(t,e,i){t==1?e.id=i.readVarint():t==2?function(o,c){for(var u=o.readVarint()+o.pos;o.pos<u;){var p=c._keys[o.readVarint()],g=c._values[o.readVarint()];c.properties[p]=g}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function l1(t){for(var e,i,o=0,c=0,u=t.length,p=u-1;c<u;p=c++)o+=((i=t[p]).x-(e=t[c]).x)*(e.y+i.y);return o}_l.types=["Unknown","Point","LineString","Polygon"],_l.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,o=1,c=0,u=0,p=0,g=[];t.pos<i;){if(c<=0){var x=t.readVarint();o=7&x,c=x>>3}if(c--,o===1||o===2)u+=t.readSVarint(),p+=t.readSVarint(),o===1&&(e&&g.push(e),e=[]),e.push(new j(u,p));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&g.push(e),g},_l.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,o=0,c=0,u=0,p=1/0,g=-1/0,x=1/0,T=-1/0;t.pos<e;){if(o<=0){var A=t.readVarint();i=7&A,o=A>>3}if(o--,i===1||i===2)(c+=t.readSVarint())<p&&(p=c),c>g&&(g=c),(u+=t.readSVarint())<x&&(x=u),u>T&&(T=u);else if(i!==7)throw new Error("unknown command "+i)}return[p,x,g,T]},_l.prototype.toGeoJSON=function(t,e,i){var o,c,u=this.extent*Math.pow(2,i),p=this.extent*t,g=this.extent*e,x=this.loadGeometry(),T=_l.types[this.type];function A(R){for(var N=0;N<R.length;N++){var $=R[N];R[N]=[360*($.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+g)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(o=0;o<x.length;o++)C[o]=x[o][0];A(x=C);break;case 2:for(o=0;o<x.length;o++)A(x[o]);break;case 3:for(x=function(R){var N=R.length;if(N<=1)return[R];for(var $,W,Q=[],oe=0;oe<N;oe++){var ce=l1(R[oe]);ce!==0&&(W===void 0&&(W=ce<0),W===ce<0?($&&Q.push($),$=[R[oe]]):$.push(R[oe]))}return $&&Q.push($),Q}(x),o=0;o<x.length;o++)for(c=0;c<x[o].length;c++)A(x[o][c])}x.length===1?x=x[0]:T="Multi"+T;var I={type:"Feature",geometry:{type:T,coordinates:x},properties:this.properties};return"id"in this&&(I.id=this.id),I};var x_=b_;function b_(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(c1,this,e),this.length=this._features.length}function c1(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(o){for(var c=null,u=o.readVarint()+o.pos;o.pos<u;){var p=o.readVarint()>>3;c=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}return c}(i))}function u1(t,e,i){if(t===3){var o=new x_(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}b_.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new v_(this._pbf,e,this.extent,this._keys,this._values)};var ua={VectorTile:function(t,e){this.layers=t.readFields(u1,{},e)},VectorTileFeature:v_,VectorTileLayer:x_};const h1=ua.VectorTileFeature.types,d1=Math.pow(2,13);function Fc(t,e,i,o,c,u,p,g){t.emplaceBack((e<<1)+p,(i<<1)+u,(Math.floor(o*d1)<<1)+c,Math.round(g))}class w_{constructor(){this.acc=new j(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new j(e.x,e.y),this.max=new j(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);let o=!!this.borders;const c=this.min,u=this.max;e.x<c.x?(c.x=e.x,o=!0):e.x>u.x&&(u.x=e.x,o=!0),e.y<c.y?(c.y=e.y,o=!0):e.y>u.y&&(u.y=e.y,o=!0),((e.x===0||e.x===Rt)&&e.x===i.x)!=((e.y===0||e.y===Rt)&&e.y===i.y)&&this.processBorderOverlap(e,i),o&&this.checkBorderIntersection(e,i)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,nr(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Rt!=e.x>Rt&&this.addBorderIntersection(1,nr(i.y,e.y,(Rt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,nr(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Rt!=e.y>Rt&&this.addBorderIntersection(3,nr(i.x,e.x,(Rt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){const e=this.polyCount.reduce((i,o)=>i+o.edges,0);return e!==0?this.acc.div(e)._round():new j(0,0)}span(){return new j(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class Vf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ll,this.centroidVertexArray=new Zm,this.indexArray=new kn,this.programConfigurations=new aa(e.layers,e.zoom),this.segments=new Yr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,o,c){this.features=[],this.hasPattern=Uf("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(u){const p=Math.exp(Math.PI*(1-u.y/(1<<u.z)*2));return 80150034*p/(p*p+1)/Rt/(1<<u.z)}(o);for(const{feature:u,id:p,index:g,sourceLayerIndex:x}of e){const T=this.layers[0]._featureFilter.needGeometry,A=ca(u,T);if(!this.layers[0]._featureFilter.filter(new bt(this.zoom),A,o))continue;const C={id:p,sourceLayerIndex:x,index:g,geometry:T?A.geometry:Zo(u,o,c),properties:u.properties,type:u.type,patterns:{}},I=this.layoutVertexArray.length;this.hasPattern?this.features.push(jf("fill-extrusion",this.layers,C,this.zoom,i)):this.addFeature(C,C.geometry,g,o,{},i.availableImages),i.featureIndex.insert(u,C.geometry,g,x,this.index,I)}this.sortBorders()}addFeatures(e,i,o,c){for(const u of this.features){const{geometry:p}=u;this.addFeature(u,p,u.index,i,o,c)}this.sortBorders()}update(e,i,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,s1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,o1.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,c,u,p){const g=this.enableTerrain?new w_:null;for(const T of Nf(i,500)){let A=0,C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(T.length===0||(x=T[0]).every(W=>W.x<=0)||x.every(W=>W.x>=Rt)||x.every(W=>W.y<=0)||x.every(W=>W.y>=Rt))continue;for(let W=0;W<T.length;W++){const Q=T[W];if(Q.length===0)continue;A+=Q.length;let oe=0;g&&g.startRing(Q[0]);for(let ce=0;ce<Q.length;ce++){const fe=Q[ce];if(ce>=1){const me=Q[ce-1];if(!f1(fe,me)){g&&g.append(fe,me),C.vertexLength+4>Yr.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const _e=fe.sub(me)._perp(),Pe=_e.x/(Math.abs(_e.x)+Math.abs(_e.y)),Me=_e.y>0?1:0,He=me.dist(fe);oe+He>32768&&(oe=0),Fc(this.layoutVertexArray,fe.x,fe.y,Pe,Me,0,0,oe),Fc(this.layoutVertexArray,fe.x,fe.y,Pe,Me,0,1,oe),oe+=He,Fc(this.layoutVertexArray,me.x,me.y,Pe,Me,0,0,oe),Fc(this.layoutVertexArray,me.x,me.y,Pe,Me,0,1,oe);const qe=C.vertexLength;this.indexArray.emplaceBack(qe,qe+2,qe+1),this.indexArray.emplaceBack(qe+1,qe+2,qe+3),C.vertexLength+=4,C.primitiveLength+=2}}}}if(C.vertexLength+A>Yr.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray)),h1[e.type]!=="Polygon")continue;const I=[],R=[],N=C.vertexLength;for(let W=0;W<T.length;W++){const Q=T[W];if(Q.length!==0){Q!==T[0]&&R.push(I.length/2);for(let oe=0;oe<Q.length;oe++){const ce=Q[oe];Fc(this.layoutVertexArray,ce.x,ce.y,0,0,1,1,0),I.push(ce.x),I.push(ce.y),g&&g.currentPolyCount.top++}}}const $=Mh(I,R);for(let W=0;W<$.length;W+=3)this.indexArray.emplaceBack(N+$[W],N+$[W+2],N+$[W+1]);C.primitiveLength+=$.length/3,C.vertexLength+=A}var x;if(g&&g.polyCount.length>0){if(g.borders){g.vertexArrayOffset=this.centroidVertexArray.length;const T=g.borders,A=this.featuresOnBorder.push(g)-1;for(let C=0;C<4;C++)T[C][0]!==Number.MAX_VALUE&&this.borders[C].push(A)}this.encodeCentroid(g.borders?void 0:g.centroid(),g)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,p,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}encodeCentroid(e,i,o=!0){let c,u;if(e)if(e.y!==0){const g=i.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(g.x/10)),u=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(g.y/10))}else c=Math.ceil(7*(e.x+450)),u=0;else c=0,u=+o;let p=o?this.centroidVertexArray.length:i.vertexArrayOffset;for(const g of i.polyCount){o&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*g.edges+g.top);for(let x=0;x<2*g.edges;x++)this.centroidVertexArray.emplace(p++,0,u),this.centroidVertexArray.emplace(p++,c,u);for(let x=0;x<g.top;x++)this.centroidVertexArray.emplace(p++,c,u)}}}function f1(t,e){return t.x===e.x&&(t.x<0||t.x>Rt)||t.y===e.y&&(t.y<0||t.y>Rt)}rt("FillExtrusionBucket",Vf,{omit:["layers","features"]}),rt("PartMetadata",w_);var p1={paint:new pi({"fill-extrusion-opacity":new nt(Ae["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pt(Ae["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new nt(Ae["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new nt(Ae["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new li(Ae["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new pt(Ae["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pt(Ae["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new nt(Ae["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Nc(t,e){return t.x*e.x+t.y*e.y}function T_(t,e){if(t.length===1){let i=0;const o=e[i++];let c;for(;!c||o.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const u=e[i],p=t[0],g=c.sub(o),x=u.sub(o),T=p.sub(o),A=Nc(g,g),C=Nc(g,x),I=Nc(x,x),R=Nc(T,g),N=Nc(T,x),$=A*I-C*C,W=(I*R-C*N)/$,Q=(A*N-C*R)/$,oe=o.z*(1-W-Q)+c.z*W+u.z*Q;if(isFinite(oe))return oe}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function E_(t){const e=new j(t[0],t[1]);return e.z=t[2],e}function m1(t,e,i,o,c,u,p,g){const x=p*c.getElevationAt(t,e,!0,!0),T=u[0]!==0,A=T?u[1]===0?p*(u[0]/7-450):p*function(C,I,R){const N=Math.floor(I[0]/8),$=Math.floor(I[1]/8),W=10*(I[0]-8*N),Q=10*(I[1]-8*$),oe=C.getElevationAt(N,$,!0,!0),ce=C.getMeterToDEM(R),fe=Math.floor(.5*(W*ce-1)),me=Math.floor(.5*(Q*ce-1)),_e=C.tileCoordToPixel(N,$),Pe=2*fe+1,Me=2*me+1,He=function(tt,ot,jt,br,Gt){return[tt.getElevationAtPixel(ot,jt,!0),tt.getElevationAtPixel(ot+Gt,jt,!0),tt.getElevationAtPixel(ot,jt+Gt,!0),tt.getElevationAtPixel(ot+br,jt+Gt,!0)]}(C,_e.x-fe,_e.y-me,Pe,Me),qe=Math.abs(He[0]-He[1]),ze=Math.abs(He[2]-He[3]),Ze=Math.abs(He[0]-He[2])+Math.abs(He[1]-He[3]),Ke=Math.min(.25,.5*ce*(qe+ze)/Pe),Fe=Math.min(.25,.5*ce*Ze/Me);return oe+Math.max(Ke*W,Fe*Q)}(c,u,g):x;return{base:x+(i===0)?-1:i,top:T?Math.max(A+o,x+i+2):x+o}}const _1=Nr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:g1}=_1,y1=Nr([{name:"a_packed",components:3,type:"Float32"}]),{members:v1}=y1,x1=ua.VectorTileFeature.types,b1=Math.cos(Math.PI/180*37.5);class Lh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new ff,this.layoutVertexArray2=new cl,this.indexArray=new kn,this.programConfigurations=new aa(e.layers,e.zoom),this.segments=new Yr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o,c){this.hasPattern=Uf("line",this.layers,i);const u=this.layers[0].layout.get("line-sort-key"),p=[];for(const{feature:A,id:C,index:I,sourceLayerIndex:R}of e){const N=this.layers[0]._featureFilter.needGeometry,$=ca(A,N);if(!this.layers[0]._featureFilter.filter(new bt(this.zoom),$,o))continue;const W=u?u.evaluate($,{},o):void 0,Q={id:C,properties:A.properties,type:A.type,sourceLayerIndex:R,index:I,geometry:N?$.geometry:Zo(A,o,c),patterns:{},sortKey:W};p.push(Q)}u&&p.sort((A,C)=>A.sortKey-C.sortKey);const{lineAtlas:g,featureIndex:x}=i,T=this.addConstantDashes(g);for(const A of p){const{geometry:C,index:I,sourceLayerIndex:R}=A;if(T&&this.addFeatureDashes(A,g),this.hasPattern){const N=jf("line",this.layers,A,this.zoom,i);this.patternFeatures.push(N)}else this.addFeature(A,C,I,o,g.positions,i.availableImages);x.insert(e[I].feature,C,I,R,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const c=o.paint.get("line-dasharray").value,u=o.layout.get("line-cap").value;if(c.kind!=="constant"||u.kind!=="constant")i=!0;else{const p=u.value,g=c.value;if(!g)continue;e.addDash(g.from,p),e.addDash(g.to,p),g.other&&e.addDash(g.other,p)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const c of this.layers){const u=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(u.kind==="constant"&&p.kind==="constant")continue;let g,x,T,A,C,I;if(u.kind==="constant"){const W=u.value;if(!W)continue;g=W.other||W.to,x=W.to,T=W.from}else g=u.evaluate({zoom:o-1},e),x=u.evaluate({zoom:o},e),T=u.evaluate({zoom:o+1},e);p.kind==="constant"?A=C=I=p.value:(A=p.evaluate({zoom:o-1},e),C=p.evaluate({zoom:o},e),I=p.evaluate({zoom:o+1},e)),i.addDash(g,A),i.addDash(x,C),i.addDash(T,I);const R=i.getKey(g,A),N=i.getKey(x,C),$=i.getKey(T,I);e.patterns[c.id]={min:R,mid:N,max:$}}}update(e,i,o,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,o,c)}addFeatures(e,i,o,c){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,i,o,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,v1)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,g1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,c,u,p){const g=this.layers[0].layout,x=g.get("line-join").evaluate(e,{}),T=g.get("line-cap").evaluate(e,{}),A=g.get("line-miter-limit"),C=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const I of i)this.addLine(I,e,x,T,A,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,p,c)}addLine(e,i,o,c,u,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<e.length-1;Q++)this.totalDistance+=e[Q].dist(e[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g=x1[i.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let T=0;for(;T<x-1&&e[T].equals(e[T+1]);)T++;if(x<(g?3:2))return;o==="bevel"&&(u=1.05);const A=this.overscaling<=16?122880/(512*this.overscaling):0,C=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let I,R,N,$,W;this.e1=this.e2=-1,g&&(I=e[x-2],W=e[T].sub(I)._unit()._perp());for(let Q=T;Q<x;Q++){if(N=Q===x-1?g?e[T+1]:void 0:e[Q+1],N&&e[Q].equals(N))continue;W&&($=W),I&&(R=I),I=e[Q],W=N?N.sub(I)._unit()._perp():$,$=$||W;let oe=$.add(W);oe.x===0&&oe.y===0||oe._unit();const ce=$.x*W.x+$.y*W.y,fe=oe.x*W.x+oe.y*W.y,me=fe!==0?1/fe:1/0,_e=2*Math.sqrt(2-2*fe),Pe=fe<b1&&R&&N,Me=$.x*W.y-$.y*W.x>0;if(Pe&&Q>T){const ze=I.dist(R);if(ze>2*A){const Ze=I.sub(I.sub(R)._mult(A/ze)._round());this.updateDistance(R,Ze),this.addCurrentVertex(Ze,$,0,0,C),R=Ze}}const He=R&&N;let qe=He?o:g?"butt":c;if(He&&qe==="round"&&(me<p?qe="miter":me<=2&&(qe="fakeround")),qe==="miter"&&me>u&&(qe="bevel"),qe==="bevel"&&(me>2&&(qe="flipbevel"),me<u&&(qe="miter")),R&&this.updateDistance(R,I),qe==="miter")oe._mult(me),this.addCurrentVertex(I,oe,0,0,C);else if(qe==="flipbevel"){if(me>100)oe=W.mult(-1);else{const ze=me*$.add(W).mag()/$.sub(W).mag();oe._perp()._mult(ze*(Me?-1:1))}this.addCurrentVertex(I,oe,0,0,C),this.addCurrentVertex(I,oe.mult(-1),0,0,C)}else if(qe==="bevel"||qe==="fakeround"){const ze=-Math.sqrt(me*me-1),Ze=Me?ze:0,Ke=Me?0:ze;if(R&&this.addCurrentVertex(I,$,Ze,Ke,C),qe==="fakeround"){const Fe=Math.round(180*_e/Math.PI/20);for(let tt=1;tt<Fe;tt++){let ot=tt/Fe;if(ot!==.5){const br=ot-.5;ot+=ot*br*(ot-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*br*br+(.848013+ce*(.215638*ce-1.06021)))}const jt=W.sub($)._mult(ot)._add($)._unit()._mult(Me?-1:1);this.addHalfVertex(I,jt.x,jt.y,!1,Me,0,C)}}N&&this.addCurrentVertex(I,W,-Ze,-Ke,C)}else if(qe==="butt")this.addCurrentVertex(I,oe,0,0,C);else if(qe==="square"){const ze=R?1:-1;R||this.addCurrentVertex(I,oe,ze,ze,C),this.addCurrentVertex(I,oe,0,0,C),R&&this.addCurrentVertex(I,oe,ze,ze,C)}else qe==="round"&&(R&&(this.addCurrentVertex(I,$,0,0,C),this.addCurrentVertex(I,$,1,1,C,!0)),N&&(this.addCurrentVertex(I,W,-1,-1,C,!0),this.addCurrentVertex(I,W,0,0,C)));if(Pe&&Q<x-1){const ze=I.dist(N);if(ze>2*A){const Ze=I.add(N.sub(I)._mult(A/ze)._round());this.updateDistance(I,Ze),this.addCurrentVertex(Ze,W,0,0,C),I=Ze}}}}addCurrentVertex(e,i,o,c,u,p=!1){const g=i.y*c-i.x,x=-i.y-i.x*c;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,p,!1,o,u),this.addHalfVertex(e,g,x,p,!0,-c,u)}addHalfVertex({x:e,y:i},o,c,u,p,g,x){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(i<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const T=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),x.primitiveLength++),p?this.e2=T:this.e1=T}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}rt("LineBucket",Lh,{omit:["layers","patternFeatures"]});const w1=new pi({"line-cap":new pt(Ae.layout_line["line-cap"]),"line-join":new pt(Ae.layout_line["line-join"]),"line-miter-limit":new nt(Ae.layout_line["line-miter-limit"]),"line-round-limit":new nt(Ae.layout_line["line-round-limit"]),"line-sort-key":new pt(Ae.layout_line["line-sort-key"])});var S_={paint:new pi({"line-opacity":new pt(Ae.paint_line["line-opacity"]),"line-color":new pt(Ae.paint_line["line-color"]),"line-translate":new nt(Ae.paint_line["line-translate"]),"line-translate-anchor":new nt(Ae.paint_line["line-translate-anchor"]),"line-width":new pt(Ae.paint_line["line-width"]),"line-gap-width":new pt(Ae.paint_line["line-gap-width"]),"line-offset":new pt(Ae.paint_line["line-offset"]),"line-blur":new pt(Ae.paint_line["line-blur"]),"line-dasharray":new li(Ae.paint_line["line-dasharray"]),"line-pattern":new li(Ae.paint_line["line-pattern"]),"line-gradient":new Eo(Ae.paint_line["line-gradient"])}),layout:w1};const A_=new class extends pt{possiblyEvaluate(t,e){return e=new bt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,o){return e=Wt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,o)}}(S_.paint.properties["line-width"].specification);function C_(t,e){return e>0?e+2*t:t}A_.useIntegerZoom=!0;const T1=Nr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),E1=Nr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Nr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const S1=Nr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),A1=Nr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Nr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const M_=Nr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),C1=Nr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Nr([{name:"triangle",components:3,type:"Uint16"}]),Nr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Nr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Nr([{type:"Float32",name:"offsetX"}]),Nr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var xi=24;const Ao=128;function $f(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new bt(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=i;let u=0;for(;u<o.length&&o[u]<=t;)u++;u=Math.max(0,u-1);let p=u;for(;p<o.length&&o[p]<t+1;)p++;p=Math.min(o.length-1,p);const g=o[u],x=o[p];return i.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:g,maxZoom:x,minSize:i.evaluate(new bt(g)),maxSize:i.evaluate(new bt(x)),interpolationType:c}}}function Rh(t,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:c}){return t.kind==="source"?o/Ao:t.kind==="composite"?nr(o/Ao,c/Ao,i):e}function gl(t,e){let i=0,o=0;if(t.kind==="constant")o=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:c,minZoom:u,maxZoom:p}=t,g=c?Vt(Pi.interpolationFactor(c,e,u,p),0,1):0;t.kind==="camera"?o=nr(t.minSize,t.maxSize,g):i=g}return{uSizeT:i,uSize:o}}var M1=Object.freeze({__proto__:null,getSizeData:$f,evaluateSizeForFeature:Rh,evaluateSizeForZoom:gl,SIZE_PACK_FACTOR:Ao});function I1(t,e,i){return t.sections.forEach(o=>{o.text=function(c,u,p){const g=u.layout.get("text-transform").evaluate(p,{});return g==="uppercase"?c=c.toLocaleUpperCase():g==="lowercase"&&(c=c.toLocaleLowerCase()),$t.applyArabicShaping&&(c=$t.applyArabicShaping(c)),c}(o.text,e,i)}),t}const Uc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function k1(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function z1(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}var I_=function(t,e,i,o,c){var u,p,g=8*c-o-1,x=(1<<g)-1,T=x>>1,A=-7,C=i?c-1:0,I=i?-1:1,R=t[e+C];for(C+=I,u=R&(1<<-A)-1,R>>=-A,A+=g;A>0;u=256*u+t[e+C],C+=I,A-=8);for(p=u&(1<<-A)-1,u>>=-A,A+=o;A>0;p=256*p+t[e+C],C+=I,A-=8);if(u===0)u=1-T;else{if(u===x)return p?NaN:1/0*(R?-1:1);p+=Math.pow(2,o),u-=T}return(R?-1:1)*p*Math.pow(2,u-o)},k_=function(t,e,i,o,c,u){var p,g,x,T=8*u-c-1,A=(1<<T)-1,C=A>>1,I=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=o?0:u-1,N=o?1:-1,$=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,p=A):(p=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-p))<1&&(p--,x*=2),(e+=p+C>=1?I/x:I*Math.pow(2,1-C))*x>=2&&(p++,x/=2),p+C>=A?(g=0,p=A):p+C>=1?(g=(e*x-1)*Math.pow(2,c),p+=C):(g=e*Math.pow(2,C-1)*Math.pow(2,c),p=0));c>=8;t[i+R]=255&g,R+=N,g/=256,c-=8);for(p=p<<c|g,T+=c;T>0;t[i+R]=255&p,R+=N,p/=256,T-=8);t[i+R-N]|=128*$},jc=xr;function xr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}xr.Varint=0,xr.Fixed64=1,xr.Bytes=2,xr.Fixed32=5;var Gf=4294967296,z_=1/Gf,P_=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Wo(t){return t.type===xr.Bytes?t.readVarint()+t.pos:t.pos+1}function yl(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function D_(t,e,i){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(var c=i.pos-1;c>=t;c--)i.buf[c+o]=i.buf[c]}function P1(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function D1(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function L1(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function R1(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function O1(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function B1(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function F1(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function N1(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function U1(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Oh(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function vl(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function L_(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function j1(t,e,i){e.glyphs=[],t===1&&i.readMessage(V1,e)}function V1(t,e,i){if(t===3){const{id:o,bitmap:c,width:u,height:p,left:g,top:x,advance:T}=i.readMessage($1,{});e.glyphs.push({id:o,bitmap:new gs({width:u+6,height:p+6},c),metrics:{width:u,height:p,left:g,top:x,advance:T}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function $1(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}function qf(t){let e=0,i=0;for(const p of t)e+=p.w*p.h,i=Math.max(i,p.w);t.sort((p,g)=>g.h-p.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,u=0;for(const p of t)for(let g=o.length-1;g>=0;g--){const x=o[g];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,u=Math.max(u,p.y+p.h),c=Math.max(c,p.x+p.w),p.w===x.w&&p.h===x.h){const T=o.pop();g<o.length&&(o[g]=T)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(o.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:c,h:u,fill:e/(c*u)||0}}xr.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var o=this.readVarint(),c=o>>3,u=this.pos;this.type=7&o,t(c,e,this),this.pos===u&&this.skip(o)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Oh(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=L_(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Oh(this.buf,this.pos)+Oh(this.buf,this.pos+4)*Gf;return this.pos+=8,t},readSFixed64:function(){var t=Oh(this.buf,this.pos)+L_(this.buf,this.pos+4)*Gf;return this.pos+=8,t},readFloat:function(){var t=I_(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=I_(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,o=this.buf;return e=127&(i=o[this.pos++]),i<128?e:(e|=(127&(i=o[this.pos++]))<<7,i<128?e:(e|=(127&(i=o[this.pos++]))<<14,i<128?e:(e|=(127&(i=o[this.pos++]))<<21,i<128?e:function(c,u,p){var g,x,T=p.buf;if(g=(112&(x=T[p.pos++]))>>4,x<128||(g|=(127&(x=T[p.pos++]))<<3,x<128)||(g|=(127&(x=T[p.pos++]))<<10,x<128)||(g|=(127&(x=T[p.pos++]))<<17,x<128)||(g|=(127&(x=T[p.pos++]))<<24,x<128)||(g|=(1&(x=T[p.pos++]))<<31,x<128))return yl(c,g,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=o[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&P_?function(i,o,c){return P_.decode(i.subarray(o,c))}(this.buf,e,t):function(i,o,c){for(var u="",p=o;p<c;){var g,x,T,A=i[p],C=null,I=A>239?4:A>223?3:A>191?2:1;if(p+I>c)break;I===1?A<128&&(C=A):I===2?(192&(g=i[p+1]))==128&&(C=(31&A)<<6|63&g)<=127&&(C=null):I===3?(x=i[p+2],(192&(g=i[p+1]))==128&&(192&x)==128&&((C=(15&A)<<12|(63&g)<<6|63&x)<=2047||C>=55296&&C<=57343)&&(C=null)):I===4&&(x=i[p+2],T=i[p+3],(192&(g=i[p+1]))==128&&(192&x)==128&&(192&T)==128&&((C=(15&A)<<18|(63&g)<<12|(63&x)<<6|63&T)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,I=1):C>65535&&(C-=65536,u+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),u+=String.fromCharCode(C),p+=I}return u}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==xr.Bytes)return t.push(this.readVarint(e));var i=Wo(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==xr.Bytes)return t.push(this.readSVarint());var e=Wo(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==xr.Bytes)return t.push(this.readBoolean());var e=Wo(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==xr.Bytes)return t.push(this.readFloat());var e=Wo(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==xr.Bytes)return t.push(this.readDouble());var e=Wo(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==xr.Bytes)return t.push(this.readFixed32());var e=Wo(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==xr.Bytes)return t.push(this.readSFixed32());var e=Wo(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==xr.Bytes)return t.push(this.readFixed64());var e=Wo(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==xr.Bytes)return t.push(this.readSFixed64());var e=Wo(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===xr.Varint)for(;this.buf[this.pos++]>127;);else if(e===xr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===xr.Fixed32)this.pos+=4;else{if(e!==xr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),vl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),vl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),vl(this.buf,-1&t,this.pos),vl(this.buf,Math.floor(t*z_),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),vl(this.buf,-1&t,this.pos),vl(this.buf,Math.floor(t*z_),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var o,c;if(e>=0?(o=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(u,p,g){g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,u>>>=7,g.buf[g.pos++]=127&u|128,g.buf[g.pos]=127&(u>>>=7)}(o,0,i),function(u,p){var g=(7&u)<<4;p.buf[p.pos++]|=g|((u>>>=3)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u|((u>>>=7)?128:0),u&&(p.buf[p.pos++]=127&u)))))}(c,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(o,c,u){for(var p,g,x=0;x<c.length;x++){if((p=c.charCodeAt(x))>55295&&p<57344){if(!g){p>56319||x+1===c.length?(o[u++]=239,o[u++]=191,o[u++]=189):g=p;continue}if(p<56320){o[u++]=239,o[u++]=191,o[u++]=189,g=p;continue}p=g-55296<<10|p-56320|65536,g=null}else g&&(o[u++]=239,o[u++]=191,o[u++]=189,g=null);p<128?o[u++]=p:(p<2048?o[u++]=p>>6|192:(p<65536?o[u++]=p>>12|224:(o[u++]=p>>18|240,o[u++]=p>>12&63|128),o[u++]=p>>6&63|128),o[u++]=63&p|128)}return u}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&D_(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),k_(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),k_(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var o=this.pos-i;o>=128&&D_(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o},writeMessage:function(t,e,i){this.writeTag(t,xr.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,P1,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,D1,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,O1,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,L1,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,R1,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,B1,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,F1,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,N1,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,U1,e)},writeBytesField:function(t,e){this.writeTag(t,xr.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,xr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,xr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,xr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,xr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,xr.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,xr.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,xr.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,xr.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,xr.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Zf{constructor(e,{pixelRatio:i,version:o,stretchX:c,stretchY:u,content:p}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=c,this.stretchY=u,this.content=p,this.version=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class R_{constructor(e,i){const o={},c={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,o,u),this.addImages(i,c,u);const{w:p,h:g}=qf(u),x=new zn({width:p||1,height:g||1});for(const T in e){const A=e[T],C=o[T].paddedRect;zn.copy(A.data,x,{x:0,y:0},{x:C.x+1,y:C.y+1},A.data)}for(const T in i){const A=i[T],C=c[T].paddedRect,I=C.x+1,R=C.y+1,N=A.data.width,$=A.data.height;zn.copy(A.data,x,{x:0,y:0},{x:I,y:R},A.data),zn.copy(A.data,x,{x:0,y:$-1},{x:I,y:R-1},{width:N,height:1}),zn.copy(A.data,x,{x:0,y:0},{x:I,y:R+$},{width:N,height:1}),zn.copy(A.data,x,{x:N-1,y:0},{x:I-1,y:R},{width:1,height:$}),zn.copy(A.data,x,{x:0,y:0},{x:I+N,y:R},{width:1,height:$})}this.image=x,this.iconPositions=o,this.patternPositions=c}addImages(e,i,o){for(const c in e){const u=e[c],p={x:0,y:0,w:u.data.width+2,h:u.data.height+2};o.push(p),i[c]=new Zf(p,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[c,u]=e.tl;o.update(i.data,void 0,{x:c,y:u})}}rt("ImagePosition",Zf),rt("ImageAtlas",R_);const Pn={horizontal:1,vertical:2,horizontalOnly:3};class Vc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const o=new Vc;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new Vc;return i.imageName=e,i}}class xl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const o=new xl;for(let c=0;c<e.sections.length;c++){const u=e.sections[c];u.image?o.addImageSection(u):o.addTextSection(u,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,o){let c="";for(let u=0;u<i.length;u++){const p=i.charCodeAt(u+1)||null,g=i.charCodeAt(u-1)||null;c+=!o&&(p&&ct(p)&&!Uc[i[u+1]]||g&&ct(g)&&!Uc[i[u-1]])||!Uc[i[u]]?i[u]:Uc[i[u]]}return c}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&Bh[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Bh[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new xl;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Vc.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(o)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void Je("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Vc.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Je("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Wf(t,e,i,o,c,u,p,g,x,T,A,C,I,R,N,$){const W=xl.fromFeature(t,c);let Q;C===Pn.vertical&&W.verticalizePunctuation(I);const{processBidirectionalText:oe,processStyledBidirectionalText:ce}=$t;if(oe&&W.sections.length===1){Q=[];const _e=oe(W.toString(),Xf(W,T,u,e,o,R,N));for(const Pe of _e){const Me=new xl;Me.text=Pe,Me.sections=W.sections;for(let He=0;He<Pe.length;He++)Me.sectionIndex.push(0);Q.push(Me)}}else if(ce){Q=[];const _e=ce(W.text,W.sectionIndex,Xf(W,T,u,e,o,R,N));for(const Pe of _e){const Me=new xl;Me.text=Pe[0],Me.sectionIndex=Pe[1],Me.sections=W.sections,Q.push(Me)}}else Q=function(_e,Pe){const Me=[],He=_e.text;let qe=0;for(const ze of Pe)Me.push(_e.substring(qe,ze)),qe=ze;return qe<He.length&&Me.push(_e.substring(qe,He.length)),Me}(W,Xf(W,T,u,e,o,R,N));const fe=[],me={positionedLines:fe,text:W.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(_e,Pe,Me,He,qe,ze,Ze,Ke,Fe,tt,ot,jt){let br=0,Gt=0,qt=0;const Ge=Ke==="right"?1:Ke==="left"?0:.5;let Jt=!1;for(const Qt of qe){const Nt=Qt.getSections();for(const Lr of Nt){if(Lr.imageName)continue;const ei=Pe[Lr.fontStack];if(ei&&(Jt=ei.ascender!==void 0&&ei.descender!==void 0,!Jt))break}if(!Jt)break}let Ht=0;for(const Qt of qe){Qt.trim();const Nt=Qt.getMaxScale(),Lr=(Nt-1)*xi,ei={positionedGlyphs:[],lineOffset:0};_e.positionedLines[Ht]=ei;const Wr=ei.positionedGlyphs;let ri=0;if(!Qt.length()){Gt+=ze,++Ht;continue}let bi=0,Hi=0;for(let Ir=0;Ir<Qt.length();Ir++){const ui=Qt.getSection(Ir),$n=Qt.getSectionIndex(Ir),mi=Qt.getCharCode(Ir);let _r=ui.scale,hi=null,Rr=null,Ai=null,oi=xi,Ci=0;const Ri=!(Fe===Pn.horizontal||!ot&&!De(mi)||ot&&(Bh[mi]||(Qr=mi,r(Qr)||l(Qr)||f(Qr)||ae(Qr)||Ve(Qr))));if(ui.imageName){const Oi=He[ui.imageName];if(!Oi)continue;Ai=ui.imageName,_e.iconsInText=_e.iconsInText||!0,Rr=Oi.paddedRect;const di=Oi.displaySize;_r=_r*xi/jt,hi={width:di[0],height:di[1],left:1,top:-3,advance:Ri?di[1]:di[0],localGlyph:!1},Ci=Jt?-hi.height*_r:Nt*xi-17-di[1]*_r,oi=hi.advance;const to=(Ri?di[0]:di[1])*_r-xi*Nt;to>0&&to>ri&&(ri=to)}else{const Oi=Me[ui.fontStack];if(!Oi)continue;Oi[mi]&&(Rr=Oi[mi]);const di=Pe[ui.fontStack];if(!di)continue;const to=di.glyphs[mi];if(!to)continue;if(hi=to.metrics,oi=mi!==8203?xi:0,Jt){const Al=di.ascender!==void 0?Math.abs(di.ascender):0,Hc=di.descender!==void 0?Math.abs(di.descender):0,Kc=(Al+Hc)*_r;bi<Kc&&(bi=Kc,Hi=(Al-Hc)/2*_r),Ci=-Al*_r}else Ci=(Nt-_r)*xi-17}Ri?(_e.verticalizable=!0,Wr.push({glyph:mi,imageName:Ai,x:br,y:Gt+Ci,vertical:Ri,scale:_r,localGlyph:hi.localGlyph,fontStack:ui.fontStack,sectionIndex:$n,metrics:hi,rect:Rr}),br+=oi*_r+tt):(Wr.push({glyph:mi,imageName:Ai,x:br,y:Gt+Ci,vertical:Ri,scale:_r,localGlyph:hi.localGlyph,fontStack:ui.fontStack,sectionIndex:$n,metrics:hi,rect:Rr}),br+=hi.advance*_r+tt)}Wr.length!==0&&(qt=Math.max(br-tt,qt),Jt?U_(Wr,Ge,ri,Hi,ze*Nt/2):U_(Wr,Ge,ri,0,ze/2)),br=0;const Ki=ze*Nt+ri;ei.lineOffset=Math.max(ri,Lr),Gt+=Ki,++Ht}var Qr;const Vr=Gt,{horizontalAlign:ci,verticalAlign:Si}=Hf(Ze);(function(Qt,Nt,Lr,ei,Wr,ri){const bi=(Nt-Lr)*Wr,Hi=-ri*ei;for(const Ki of Qt)for(const Ir of Ki.positionedGlyphs)Ir.x+=bi,Ir.y+=Hi})(_e.positionedLines,Ge,ci,Si,qt,Vr),_e.top+=-Si*Vr,_e.bottom=_e.top+Vr,_e.left+=-ci*qt,_e.right=_e.left+qt,_e.hasBaseline=Jt}(me,e,i,o,Q,p,g,x,C,T,I,$),!function(_e){for(const Pe of _e)if(Pe.positionedGlyphs.length!==0)return!1;return!0}(fe)&&me}const Bh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},G1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function O_(t,e,i,o,c,u){if(e.imageName){const p=o[e.imageName];return p?p.displaySize[0]*e.scale*xi/u+c:0}{const p=i[e.fontStack],g=p&&p.glyphs[t];return g?g.metrics.advance*e.scale+c:0}}function B_(t,e,i,o){const c=Math.pow(t-e,2);return o?t<e?c/2:2*c:c+Math.abs(i)*i}function q1(t,e,i){let o=0;return t===10&&(o-=1e4),i&&(o+=150),t!==40&&t!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function F_(t,e,i,o,c,u){let p=null,g=B_(e,i,c,u);for(const x of o){const T=B_(e-x.x,i,c,u)+x.badness;T<=g&&(p=x,g=T)}return{index:t,x:e,priorBreak:p,badness:g}}function N_(t){return t?N_(t.priorBreak).concat(t.index):[]}function Xf(t,e,i,o,c,u,p){if(u!=="point")return[];if(!t)return[];const g=[],x=function(I,R,N,$,W,Q){let oe=0;for(let ce=0;ce<I.length();ce++){const fe=I.getSection(ce);oe+=O_(I.getCharCode(ce),fe,$,W,R,Q)}return oe/Math.max(1,Math.ceil(oe/N))}(t,e,i,o,c,p),T=t.text.indexOf("\u200B")>=0;let A=0;for(let I=0;I<t.length();I++){const R=t.getSection(I),N=t.getCharCode(I);if(Bh[N]||(A+=O_(N,R,o,c,e,p)),I<t.length()-1){const $=!((C=N)<11904||!(O(C)||P(C)||Ee(C)||re(C)||Y(C)||_(C)||V(C)||S(C)||se(C)||X(C)||Z(C)||je(C)||k(C)||w(C)||y(C)||K(C)||z(C)||ve(C)||ne(C)||ie(C)));(G1[N]||$||R.imageName)&&g.push(F_(I+1,A,x,g,q1(N,t.getCharCode(I+1),$&&T),!1))}}var C;return N_(F_(t.length(),A,x,g,0,!0))}function Hf(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function U_(t,e,i,o,c){if(!(e||i||o||c))return;const u=t.length-1,p=t[u],g=(p.x+p.metrics.advance*p.scale)*e;for(let x=0;x<=u;x++)t[x].x-=g,t[x].y+=i+o+c}function Z1(t,e,i){const{horizontalAlign:o,verticalAlign:c}=Hf(i),u=e[0]-t.displaySize[0]*o,p=e[1]-t.displaySize[1]*c;return{image:t,top:p,bottom:p+t.displaySize[1],left:u,right:u+t.displaySize[0]}}function j_(t,e,i,o,c,u){const p=t.image;let g;if(p.content){const W=p.content,Q=p.pixelRatio||1;g=[W[0]/Q,W[1]/Q,p.displaySize[0]-W[2]/Q,p.displaySize[1]-W[3]/Q]}const x=e.left*u,T=e.right*u;let A,C,I,R;i==="width"||i==="both"?(R=c[0]+x-o[3],C=c[0]+T+o[1]):(R=c[0]+(x+T-p.displaySize[0])/2,C=R+p.displaySize[0]);const N=e.top*u,$=e.bottom*u;return i==="height"||i==="both"?(A=c[1]+N-o[0],I=c[1]+$+o[2]):(A=c[1]+(N+$-p.displaySize[1])/2,I=A+p.displaySize[1]),{image:p,top:A,right:C,bottom:I,left:R,collisionPadding:g}}class Xo extends j{constructor(e,i,o,c,u){super(e,i),this.angle=c,this.z=o,u!==void 0&&(this.segment=u)}clone(){return new Xo(this.x,this.y,this.z,this.angle,this.segment)}}function V_(t,e,i,o,c){if(e.segment===void 0)return!0;let u=e,p=e.segment+1,g=0;for(;g>-i/2;){if(p--,p<0)return!1;g-=t[p].dist(u),u=t[p]}g+=t[p].dist(t[p+1]),p++;const x=[];let T=0;for(;g<i/2;){const A=t[p],C=t[p+1];if(!C)return!1;let I=t[p-1].angleTo(A)-A.angleTo(C);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:g,angleDelta:I}),T+=I;g-x[0].distance>o;)T-=x.shift().angleDelta;if(T>c)return!1;p++,g+=A.dist(C)}return!0}function $_(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function G_(t,e,i){return t?.6*e*i:0}function q_(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function W1(t,e,i,o,c,u){const p=G_(i,c,u),g=q_(i,o)*u;let x=0;const T=$_(t)/2;for(let A=0;A<t.length-1;A++){const C=t[A],I=t[A+1],R=C.dist(I);if(x+R>T){const N=(T-x)/R,$=nr(C.x,I.x,N),W=nr(C.y,I.y,N),Q=new Xo($,W,0,I.angleTo(C),A);return!p||V_(t,Q,g,p,e)?Q:void 0}x+=R}}function X1(t,e,i,o,c,u,p,g,x){const T=G_(o,u,p),A=q_(o,c),C=A*p,I=t[0].x===0||t[0].x===x||t[0].y===0||t[0].y===x;return e-C<e/4&&(e=C+e/4),Z_(t,I?e/2*g%e:(A/2+2*u)*p*g%e,e,T,i,C,I,!1,x)}function Z_(t,e,i,o,c,u,p,g,x){const T=u/2,A=$_(t);let C=0,I=e-i,R=[];for(let N=0;N<t.length-1;N++){const $=t[N],W=t[N+1],Q=$.dist(W),oe=W.angleTo($);for(;I+i<C+Q;){I+=i;const ce=(I-C)/Q,fe=nr($.x,W.x,ce),me=nr($.y,W.y,ce);if(fe>=0&&fe<x&&me>=0&&me<x&&I-T>=0&&I+T<=A){const _e=new Xo(fe,me,0,oe,N);_e._round(),o&&!V_(t,_e,u,o,c)||R.push(_e)}}C+=Q}return g||R.length||p||(R=Z_(t,C/2,i,o,c,u,p,!0,x)),R}function W_(t,e,i,o,c){const u=[];for(let p=0;p<t.length;p++){const g=t[p];let x;for(let T=0;T<g.length-1;T++){let A=g[T],C=g[T+1];A.x<e&&C.x<e||(A.x<e?A=new j(e,A.y+(e-A.x)/(C.x-A.x)*(C.y-A.y))._round():C.x<e&&(C=new j(e,A.y+(e-A.x)/(C.x-A.x)*(C.y-A.y))._round()),A.y<i&&C.y<i||(A.y<i?A=new j(A.x+(i-A.y)/(C.y-A.y)*(C.x-A.x),i)._round():C.y<i&&(C=new j(A.x+(i-A.y)/(C.y-A.y)*(C.x-A.x),i)._round()),A.x>=o&&C.x>=o||(A.x>=o?A=new j(o,A.y+(o-A.x)/(C.x-A.x)*(C.y-A.y))._round():C.x>=o&&(C=new j(o,A.y+(o-A.x)/(C.x-A.x)*(C.y-A.y))._round()),A.y>=c&&C.y>=c||(A.y>=c?A=new j(A.x+(c-A.y)/(C.y-A.y)*(C.x-A.x),c)._round():C.y>=c&&(C=new j(A.x+(c-A.y)/(C.y-A.y)*(C.x-A.x),c)._round()),x&&A.equals(x[x.length-1])||(x=[A],u.push(x)),x.push(C)))))}}return u}rt("Anchor",Xo);const $c=1e20;function X_(t,e,i,o,c,u,p,g,x){for(let T=e;T<e+o;T++)H_(t,i*u+T,u,c,p,g,x);for(let T=i;T<i+c;T++)H_(t,T*u+e,1,o,p,g,x)}function H_(t,e,i,o,c,u,p){u[0]=0,p[0]=-$c,p[1]=$c,c[0]=t[e];for(let g=1,x=0,T=0;g<o;g++){c[g]=t[e+g*i];const A=g*g;do{const C=u[x];T=(c[g]-c[C]+A-C*C)/(g-C)/2}while(T<=p[x]&&--x>-1);x++,u[x]=g,p[x]=T,p[x+1]=$c}for(let g=0,x=0;g<o;g++){for(;p[x+1]<g;)x++;const T=u[x],A=g-T;t[e+g*i]=c[T]+A*A}}const Kf={none:0,ideographs:1,all:2};class bl{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const o=[];for(const c in e)for(const u of e[c])o.push({stack:c,id:u});nn(o,({stack:c,id:u},p)=>{let g=this.entries[c];g||(g=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=g.glyphs[u];if(x!==void 0)return void p(null,{stack:c,id:u,glyph:x});if(x=this._tinySDF(g,c,u),x)return g.glyphs[u]=x,void p(null,{stack:c,id:u,glyph:x});const T=Math.floor(u/256);if(256*T>65535)return void p(new Error("glyphs > 65535 not supported"));if(g.ranges[T])return void p(null,{stack:c,id:u,glyph:x});let A=g.requests[T];A||(A=g.requests[T]=[],bl.loadGlyphRange(c,T,this.url,this.requestManager,(C,I)=>{if(I){g.ascender=I.ascender,g.descender=I.descender;for(const R in I.glyphs)this._doesCharSupportLocalGlyph(+R)||(g.glyphs[+R]=I.glyphs[+R]);g.ranges[T]=!0}for(const R of A)R(C,I);delete g.requests[T]})),A.push((C,I)=>{C?p(C):I&&p(null,{stack:c,id:u,glyph:I.glyphs[u]||null})})},(c,u)=>{if(c)i(c);else if(u){const p={};for(const{stack:g,id:x,glyph:T}of u)p[g]===void 0&&(p[g]={}),p[g].glyphs===void 0&&(p[g].glyphs={}),p[g].glyphs[x]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},p[g].ascender=this.entries[g].ascender,p[g].descender=this.entries[g].descender;i(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Kf.none&&(this.localGlyphMode===Kf.all?!!this.localFontFamily:!!this.localFontFamily&&(X(e)||te(e)||k(e)||z(e))||S(e))}_tinySDF(e,i,o){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(o))return;let u=e.tinySDF;if(!u){let $="400";/bold/i.test(i)?$="900":/medium/i.test(i)?$="500":/light/i.test(i)&&($="200"),u=e.tinySDF=new bl.TinySDF({fontFamily:c,fontWeight:$,fontSize:48,buffer:6,radius:16}),u.fontWeight=$}if(this.localGlyphs[u.fontWeight][o])return this.localGlyphs[u.fontWeight][o];const p=String.fromCharCode(o),{data:g,width:x,height:T,glyphWidth:A,glyphHeight:C,glyphLeft:I,glyphTop:R,glyphAdvance:N}=u.draw(p);return this.localGlyphs[u.fontWeight][o]={id:o,bitmap:new gs({width:x,height:T},g),metrics:{width:A/2,height:C/2,left:I/2,top:R/2-27,advance:N/2,localGlyph:!0}}}}function K_(t,e,i,o){const c=[],u=t.image,p=u.pixelRatio,g=u.paddedRect.w-2,x=u.paddedRect.h-2,T=t.right-t.left,A=t.bottom-t.top,C=u.stretchX||[[0,g]],I=u.stretchY||[[0,x]],R=(ze,Ze)=>ze+Ze[1]-Ze[0],N=C.reduce(R,0),$=I.reduce(R,0),W=g-N,Q=x-$;let oe=0,ce=N,fe=0,me=$,_e=0,Pe=W,Me=0,He=Q;if(u.content&&o){const ze=u.content;oe=Fh(C,0,ze[0]),fe=Fh(I,0,ze[1]),ce=Fh(C,ze[0],ze[2]),me=Fh(I,ze[1],ze[3]),_e=ze[0]-oe,Me=ze[1]-fe,Pe=ze[2]-ze[0]-ce,He=ze[3]-ze[1]-me}const qe=(ze,Ze,Ke,Fe)=>{const tt=Nh(ze.stretch-oe,ce,T,t.left),ot=Uh(ze.fixed-_e,Pe,ze.stretch,N),jt=Nh(Ze.stretch-fe,me,A,t.top),br=Uh(Ze.fixed-Me,He,Ze.stretch,$),Gt=Nh(Ke.stretch-oe,ce,T,t.left),qt=Uh(Ke.fixed-_e,Pe,Ke.stretch,N),Ge=Nh(Fe.stretch-fe,me,A,t.top),Jt=Uh(Fe.fixed-Me,He,Fe.stretch,$),Ht=new j(tt,jt),Qr=new j(Gt,jt),Vr=new j(Gt,Ge),ci=new j(tt,Ge),Si=new j(ot/p,br/p),Qt=new j(qt/p,Jt/p),Nt=e*Math.PI/180;if(Nt){const Wr=Math.sin(Nt),ri=Math.cos(Nt),bi=[ri,-Wr,Wr,ri];Ht._matMult(bi),Qr._matMult(bi),ci._matMult(bi),Vr._matMult(bi)}const Lr=ze.stretch+ze.fixed,ei=Ze.stretch+Ze.fixed;return{tl:Ht,tr:Qr,bl:ci,br:Vr,tex:{x:u.paddedRect.x+1+Lr,y:u.paddedRect.y+1+ei,w:Ke.stretch+Ke.fixed-Lr,h:Fe.stretch+Fe.fixed-ei},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Si,pixelOffsetBR:Qt,minFontScaleX:Pe/p/T,minFontScaleY:He/p/A,isSDF:i}};if(o&&(u.stretchX||u.stretchY)){const ze=Y_(C,W,N),Ze=Y_(I,Q,$);for(let Ke=0;Ke<ze.length-1;Ke++){const Fe=ze[Ke],tt=ze[Ke+1];for(let ot=0;ot<Ze.length-1;ot++)c.push(qe(Fe,Ze[ot],tt,Ze[ot+1]))}}else c.push(qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:x+1}));return c}function Fh(t,e,i){let o=0;for(const c of t)o+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return o}function Y_(t,e,i){const o=[{fixed:-1,stretch:0}];for(const[c,u]of t){const p=o[o.length-1];o.push({fixed:c-p.stretch,stretch:p.stretch}),o.push({fixed:c-p.stretch,stretch:p.stretch+(u-c)})}return o.push({fixed:e+1,stretch:i}),o}function Nh(t,e,i,o){return t/e*i+o}function Uh(t,e,i,o){return t-e*i/o}function H1(t,e,i,o){const c=e+t.positionedLines[o].lineOffset;return o===0?i+c/2:i+(c+(e+t.positionedLines[o-1].lineOffset))/2}bl.loadGlyphRange=function(t,e,i,o,c){const u=256*e,p=u+255,g=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${u}-${p}`),Ca.Glyphs);Ls(g,(x,T)=>{if(x)c(x);else if(T){const A={},C=function(I){return new jc(I).readFields(j1,{})}(T);for(const I of C.glyphs)A[I.id]=I;c(null,{glyphs:A,ascender:C.ascender,descender:C.descender})}})},bl.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:c="sans-serif",fontWeight:u="normal",fontStyle:p="normal"}){this.buffer=e,this.cutoff=o,this.radius=i;const g=this.size=t+4*e,x=this._createCanvas(g),T=this.ctx=x.getContext("2d",{willReadFrequently:!0});T.font=`${p} ${u} ${t}px ${c}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:c,actualBoundingBoxRight:u}=this.ctx.measureText(t),p=Math.floor(i),g=Math.min(this.size-this.buffer,Math.ceil(u-c)),x=Math.min(this.size-this.buffer,Math.ceil(i)+Math.ceil(o)),T=g+2*this.buffer,A=x+2*this.buffer,C=T*A,I=new Uint8ClampedArray(C),R={data:I,width:T,height:A,glyphWidth:g,glyphHeight:x,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(g===0||x===0)return R;const{ctx:N,buffer:$,gridInner:W,gridOuter:Q}=this;N.clearRect($,$,g,x),N.fillText(t,$,$+p+1);const oe=N.getImageData($,$,g,x);Q.fill($c,0,C),W.fill(0,0,C);for(let ce=0;ce<x;ce++)for(let fe=0;fe<g;fe++){const me=oe.data[4*(ce*g+fe)+3]/255;if(me===0)continue;const _e=(ce+$)*T+fe+$;if(me===1)Q[_e]=0,W[_e]=$c;else{const Pe=.5-me;Q[_e]=Pe>0?Pe*Pe:0,W[_e]=Pe<0?Pe*Pe:0}}X_(Q,0,0,T,A,T,this.f,this.v,this.z),X_(W,$,$,g,x,T,this.f,this.v,this.z);for(let ce=0;ce<C;ce++){const fe=Math.sqrt(Q[ce])-Math.sqrt(W[ce]);I[ce]=Math.round(255-255*(fe/this.radius+this.cutoff))}return R}};class K1{constructor(e=[],i=Y1){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,c=i[e];for(;e>0;){const u=e-1>>1,p=i[u];if(o(c,p)>=0)break;i[e]=p,e=u}i[e]=c}_down(e){const{data:i,compare:o}=this,c=this.length>>1,u=i[e];for(;e<c;){let p=1+(e<<1),g=i[p];const x=p+1;if(x<this.length&&o(i[x],g)<0&&(p=x,g=i[x]),o(g,u)>=0)break;i[e]=g,e=p}i[e]=u}}function Y1(t,e){return t<e?-1:t>e?1:0}function J1(t,e=1,i=!1){let o=1/0,c=1/0,u=-1/0,p=-1/0;const g=t[0];for(let R=0;R<g.length;R++){const N=g[R];(!R||N.x<o)&&(o=N.x),(!R||N.y<c)&&(c=N.y),(!R||N.x>u)&&(u=N.x),(!R||N.y>p)&&(p=N.y)}const x=Math.min(u-o,p-c);let T=x/2;const A=new K1([],Q1);if(x===0)return new j(o,c);for(let R=o;R<u;R+=x)for(let N=c;N<p;N+=x)A.push(new wl(R+T,N+T,T,t));let C=function(R){let N=0,$=0,W=0;const Q=R[0];for(let oe=0,ce=Q.length,fe=ce-1;oe<ce;fe=oe++){const me=Q[oe],_e=Q[fe],Pe=me.x*_e.y-_e.x*me.y;$+=(me.x+_e.x)*Pe,W+=(me.y+_e.y)*Pe,N+=3*Pe}return new wl($/N,W/N,0,R)}(t),I=A.length;for(;A.length;){const R=A.pop();(R.d>C.d||!C.d)&&(C=R,i&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,I)),R.max-C.d<=e||(T=R.h/2,A.push(new wl(R.p.x-T,R.p.y-T,T,t)),A.push(new wl(R.p.x+T,R.p.y-T,T,t)),A.push(new wl(R.p.x-T,R.p.y+T,T,t)),A.push(new wl(R.p.x+T,R.p.y+T,T,t)),I+=4)}return i&&(console.log(`num probes: ${I}`),console.log(`best distance: ${C.d}`)),C.p}function Q1(t,e){return e.max-t.max}function wl(t,e,i,o){this.p=new j(t,e),this.h=i,this.d=function(c,u){let p=!1,g=1/0;for(let x=0;x<u.length;x++){const T=u[x];for(let A=0,C=T.length,I=C-1;A<C;I=A++){const R=T[A],N=T[I];R.y>c.y!=N.y>c.y&&c.x<(N.x-R.x)*(c.y-R.y)/(N.y-R.y)+R.x&&(p=!p),g=Math.min(g,o_(c,R,N))}}return(p?1:-1)*Math.sqrt(g)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const Yf=Number.POSITIVE_INFINITY,eb=Math.sqrt(2);function J_(t,e){return e[1]!==Yf?function(i,o,c){let u=0,p=0;switch(o=Math.abs(o),c=Math.abs(c),i){case"top-right":case"top-left":case"top":p=c-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-c}switch(i){case"top-right":case"bottom-right":case"right":u=-o;break;case"top-left":case"bottom-left":case"left":u=o}return[u,p]}(t,e[0],e[1]):function(i,o){let c=0,u=0;o<0&&(o=0);const p=o/eb;switch(i){case"top-right":case"top-left":u=p-7;break;case"bottom-right":case"bottom-left":u=7-p;break;case"bottom":u=7-o;break;case"top":u=o-7}switch(i){case"top-right":case"bottom-right":c=-p;break;case"top-left":case"bottom-left":c=p;break;case"left":c=o;break;case"right":c=-o}return[c,u]}(t,e[0])}function tb(t,e,i,o,c,u,p,g,x,T){t.createArrays(),t.tilePixelRatio=Rt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const A=t.layers[0].layout,C=t.layers[0]._unevaluatedLayout._values,I={};if(t.textSizeData.kind==="composite"){const{minZoom:$,maxZoom:W}=t.textSizeData;I.compositeTextSizes=[C["text-size"].possiblyEvaluate(new bt($),g),C["text-size"].possiblyEvaluate(new bt(W),g)]}if(t.iconSizeData.kind==="composite"){const{minZoom:$,maxZoom:W}=t.iconSizeData;I.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new bt($),g),C["icon-size"].possiblyEvaluate(new bt(W),g)]}I.layoutTextSize=C["text-size"].possiblyEvaluate(new bt(x+1),g),I.layoutIconSize=C["icon-size"].possiblyEvaluate(new bt(x+1),g),I.textMaxSize=C["text-size"].possiblyEvaluate(new bt(18),g);const R=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",N=A.get("text-size");for(const $ of t.features){const W=A.get("text-font").evaluate($,{},g).join(","),Q=N.evaluate($,{},g),oe=I.layoutTextSize.evaluate($,{},g),ce=(I.layoutIconSize.evaluate($,{},g),{horizontal:{},vertical:void 0}),fe=$.text;let me,_e=[0,0];if(fe){const He=fe.toString(),qe=A.get("text-letter-spacing").evaluate($,{},g)*xi,ze=A.get("text-line-height").evaluate($,{},g)*xi,Ze=Te(He)?qe:0,Ke=A.get("text-anchor").evaluate($,{},g),Fe=A.get("text-variable-anchor");if(!Fe){const qt=A.get("text-radial-offset").evaluate($,{},g);_e=qt?J_(Ke,[qt*xi,Yf]):A.get("text-offset").evaluate($,{},g).map(Ge=>Ge*xi)}let tt=R?"center":A.get("text-justify").evaluate($,{},g);const ot=A.get("symbol-placement"),jt=ot==="point",br=ot==="point"?A.get("text-max-width").evaluate($,{},g)*xi:0,Gt=qt=>{t.allowVerticalPlacement&&Ce(He)&&(ce.vertical=Wf(fe,e,i,c,W,br,ze,Ke,qt,Ze,_e,Pn.vertical,!0,ot,oe,Q))};if(!R&&Fe){const qt=tt==="auto"?Fe.map(Jt=>Jf(Jt)):[tt];let Ge=!1;for(let Jt=0;Jt<qt.length;Jt++){const Ht=qt[Jt];if(!ce.horizontal[Ht])if(Ge)ce.horizontal[Ht]=ce.horizontal[0];else{const Qr=Wf(fe,e,i,c,W,br,ze,"center",Ht,Ze,_e,Pn.horizontal,!1,ot,oe,Q);Qr&&(ce.horizontal[Ht]=Qr,Ge=Qr.positionedLines.length===1)}}Gt("left")}else{if(tt==="auto"&&(tt=Jf(Ke)),jt||A.get("text-writing-mode").indexOf("horizontal")>=0||!Ce(He)){const qt=Wf(fe,e,i,c,W,br,ze,Ke,tt,Ze,_e,Pn.horizontal,!1,ot,oe,Q);qt&&(ce.horizontal[tt]=qt)}Gt(ot==="point"?"left":tt)}}let Pe=!1;if($.icon&&$.icon.name){const He=o[$.icon.name];He&&(me=Z1(c[$.icon.name],A.get("icon-offset").evaluate($,{},g),A.get("icon-anchor").evaluate($,{},g)),Pe=He.sdf,t.sdfIcons===void 0?t.sdfIcons=He.sdf:t.sdfIcons!==He.sdf&&Je("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(He.pixelRatio!==t.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Me=eg(ce.horizontal)||ce.vertical;t.iconsInText||(t.iconsInText=!!Me&&Me.iconsInText),(Me||me)&&rb(t,$,ce,me,o,I,oe,0,_e,Pe,p,g,T)}u&&t.generateCollisionDebugBuffers(x,t.collisionBoxArray)}function Jf(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function rb(t,e,i,o,c,u,p,g,x,T,A,C,I){let R=u.textMaxSize.evaluate(e,{},C);R===void 0&&(R=p);const N=t.layers[0].layout,$=N.get("icon-offset").evaluate(e,{},C),W=eg(i.horizontal)||i.vertical,Q=p/24,oe=t.tilePixelRatio*R/24,ce=t.tilePixelRatio*N.get("symbol-spacing"),fe=N.get("text-padding")*t.tilePixelRatio,me=N.get("icon-padding")*t.tilePixelRatio,_e=Ct(N.get("text-max-angle")),Pe=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Me=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",He=N.get("symbol-placement"),qe=ce/2,ze=N.get("icon-text-fit");let Ze;o&&ze!=="none"&&(t.allowVerticalPlacement&&i.vertical&&(Ze=j_(o,i.vertical,ze,N.get("icon-text-fit-padding"),$,Q)),W&&(o=j_(o,W,ze,N.get("icon-text-fit-padding"),$,Q)));const Ke=(Fe,tt,ot)=>{if(tt.x<0||tt.x>=Rt||tt.y<0||tt.y>=Rt)return;const{x:jt,y:br,z:Gt}=I.projectTilePoint(tt.x,tt.y,ot),qt=new Xo(jt,br,Gt,0,void 0);(function(Ge,Jt,Ht,Qr,Vr,ci,Si,Qt,Nt,Lr,ei,Wr,ri,bi,Hi,Ki,Ir,ui,$n,mi,_r,hi,Rr,Ai,oi){const Ci=Ge.addToLineVertexArray(Jt,Qr);let Ri,Oi,di,to,Al,Hc,Kc,Rg=0,Og=0,Bg=0,Fg=0,gp=-1,yp=-1;const ko={};let Ng=Pc(""),vp=0,xp=0;if(Nt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[vp,xp]=Nt.layout.get("text-offset").evaluate(_r,{},oi).map(pn=>pn*xi):(vp=Nt.layout.get("text-radial-offset").evaluate(_r,{},oi)*xi,xp=Yf),Ge.allowVerticalPlacement&&Vr.vertical){const pn=Vr.vertical;if(Hi)Hc=Qf(pn),Qt&&(Kc=Qf(Qt));else{const mn=Nt.layout.get("text-rotate").evaluate(_r,{},oi)+90;di=jh(Lr,Ht,Jt,ei,Wr,ri,pn,bi,mn,Ki),Qt&&(to=jh(Lr,Ht,Jt,ei,Wr,ri,Qt,ui,mn))}}if(ci){const pn=Nt.layout.get("icon-rotate").evaluate(_r,{},oi),mn=Nt.layout.get("icon-text-fit")!=="none",Yc=K_(ci,pn,Rr,mn),wp=Qt?K_(Qt,pn,Rr,mn):void 0;Oi=jh(Lr,Ht,Jt,ei,Wr,ri,ci,ui,pn),Rg=4*Yc.length;const Ug=Ge.iconSizeData;let pa=null;Ug.kind==="source"?(pa=[Ao*Nt.layout.get("icon-size").evaluate(_r,{},oi)],pa[0]>vs&&Je(`${Ge.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ug.kind==="composite"&&(pa=[Ao*hi.compositeIconSizes[0].evaluate(_r,{},oi),Ao*hi.compositeIconSizes[1].evaluate(_r,{},oi)],(pa[0]>vs||pa[1]>vs)&&Je(`${Ge.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ge.addSymbols(Ge.icon,Yc,pa,mi,$n,_r,!1,Ht,Jt,Ci.lineStartIndex,Ci.lineLength,-1,Ai,oi),gp=Ge.icon.placedSymbolArray.length-1,wp&&(Og=4*wp.length,Ge.addSymbols(Ge.icon,wp,pa,mi,$n,_r,Pn.vertical,Ht,Jt,Ci.lineStartIndex,Ci.lineLength,-1,Ai,oi),yp=Ge.icon.placedSymbolArray.length-1)}for(const pn in Vr.horizontal){const mn=Vr.horizontal[pn];Ri||(Ng=Pc(mn.text),Hi?Al=Qf(mn):Ri=jh(Lr,Ht,Jt,ei,Wr,ri,mn,bi,Nt.layout.get("text-rotate").evaluate(_r,{},oi),Ki));const Yc=mn.positionedLines.length===1;if(Bg+=Q_(Ge,Ht,Jt,mn,Si,Nt,Hi,_r,Ki,Ci,Vr.vertical?Pn.horizontal:Pn.horizontalOnly,Yc?Object.keys(Vr.horizontal):[pn],ko,gp,hi,Ai,oi),Yc)break}Vr.vertical&&(Fg+=Q_(Ge,Ht,Jt,Vr.vertical,Si,Nt,Hi,_r,Ki,Ci,Pn.vertical,["vertical"],ko,yp,hi,Ai,oi));let Es=-1;const bp=(pn,mn)=>pn?Math.max(pn,mn):mn;Es=bp(Al,Es),Es=bp(Hc,Es),Es=bp(Kc,Es);const zb=Es>-1?1:0;Ge.glyphOffsetArray.length>=xs.MAX_GLYPHS&&Je("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),_r.sortKey!==void 0&&Ge.addToSortKeyRanges(Ge.symbolInstances.length,_r.sortKey),Ge.symbolInstances.emplaceBack(Ht.x,Ht.y,Ht.z,Jt.x,Jt.y,ko.right>=0?ko.right:-1,ko.center>=0?ko.center:-1,ko.left>=0?ko.left:-1,ko.vertical>=0?ko.vertical:-1,gp,yp,Ng,Ri!==void 0?Ri:Ge.collisionBoxArray.length,Ri!==void 0?Ri+1:Ge.collisionBoxArray.length,di!==void 0?di:Ge.collisionBoxArray.length,di!==void 0?di+1:Ge.collisionBoxArray.length,Oi!==void 0?Oi:Ge.collisionBoxArray.length,Oi!==void 0?Oi+1:Ge.collisionBoxArray.length,to||Ge.collisionBoxArray.length,to?to+1:Ge.collisionBoxArray.length,ei,Bg,Fg,Rg,Og,zb,0,vp,xp,Es)})(t,tt,qt,Fe,i,o,c,Ze,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,fe,Pe,x,0,me,Me,$,e,u,T,A,C)};if(He==="line")for(const Fe of W_(e.geometry,0,0,Rt,Rt)){const tt=X1(Fe,ce,_e,i.vertical||W,o,24,oe,t.overscaling,Rt);for(const ot of tt){const jt=W;jt&&ib(t,jt.text,qe,ot)||Ke(Fe,ot,C)}}else if(He==="line-center"){for(const Fe of e.geometry)if(Fe.length>1){const tt=W1(Fe,_e,i.vertical||W,o,24,oe);tt&&Ke(Fe,tt,C)}}else if(e.type==="Polygon")for(const Fe of Nf(e.geometry,0)){const tt=J1(Fe,16);Ke(Fe[0],new Xo(tt.x,tt.y,0,0,void 0),C)}else if(e.type==="LineString")for(const Fe of e.geometry)Ke(Fe,new Xo(Fe[0].x,Fe[0].y,0,0,void 0),C);else if(e.type==="Point")for(const Fe of e.geometry)for(const tt of Fe)Ke([tt],new Xo(tt.x,tt.y,0,0,void 0),C)}const vs=32640;function Q_(t,e,i,o,c,u,p,g,x,T,A,C,I,R,N,$,W){const Q=function(fe,me,_e,Pe,Me,He,qe,ze){const Ze=[];if(me.positionedLines.length===0)return Ze;const Ke=Pe.layout.get("text-rotate").evaluate(He,{})*Math.PI/180,Fe=function(Gt){const qt=Gt[0],Ge=Gt[1],Jt=qt*Ge;return Jt>0?[qt,-Ge]:Jt<0?[-qt,Ge]:qt===0?[Ge,qt]:[Ge,-qt]}(_e);let tt=Math.abs(me.top-me.bottom);for(const Gt of me.positionedLines)tt-=Gt.lineOffset;const ot=me.positionedLines.length,jt=tt/ot;let br=me.top-_e[1];for(let Gt=0;Gt<ot;++Gt){const qt=me.positionedLines[Gt];br=H1(me,jt,br,Gt);for(const Ge of qt.positionedGlyphs){if(!Ge.rect)continue;const Jt=Ge.rect||{};let Ht=4,Qr=!0,Vr=1,ci=0;if(Ge.imageName){const Rr=qe[Ge.imageName];if(!Rr)continue;if(Rr.sdf){Je("SDF images are not supported in formatted text and will be ignored.");continue}Qr=!1,Vr=Rr.pixelRatio,Ht=1/Vr}const Si=(Me||ze)&&Ge.vertical,Qt=Ge.metrics.advance*Ge.scale/2,Nt=Ge.metrics,Lr=Ge.rect;if(Lr===null)continue;ze&&me.verticalizable&&(ci=Ge.imageName?Qt-Ge.metrics.width*Ge.scale/2:0);const ei=Me?[Ge.x+Qt,Ge.y]:[0,0];let Wr=[0,0],ri=[0,0],bi=!1;Me||(Si?(ri=[Ge.x+Qt+Fe[0],Ge.y+Fe[1]-ci],bi=!0):Wr=[Ge.x+Qt+_e[0],Ge.y+_e[1]-ci]);const Hi=Lr.w*Ge.scale/(Vr*(Ge.localGlyph?2:1)),Ki=Lr.h*Ge.scale/(Vr*(Ge.localGlyph?2:1));let Ir,ui,$n,mi;if(Si){const Rr=Ge.y-br,Ai=new j(-Qt,Qt-Rr),oi=-Math.PI/2,Ci=new j(...ri);Ir=new j(-Qt+Wr[0],Wr[1]),Ir._rotateAround(oi,Ai)._add(Ci),Ir.x+=-Rr+Qt,Ir.y-=(Nt.left-Ht)*Ge.scale;const Ri=Ge.imageName?Nt.advance*Ge.scale:xi*Ge.scale,Oi=String.fromCharCode(Ge.glyph);k1(Oi)?Ir.x+=(1-Ht)*Ge.scale:z1(Oi)?Ir.x+=Ri-Nt.height*Ge.scale+(-Ht-1)*Ge.scale:Ir.x+=Ge.imageName||Nt.width+2*Ht===Lr.w&&Nt.height+2*Ht===Lr.h?(Ri-Ki)/2:(Ri-(Nt.height+2*Ht)*Ge.scale)/2,ui=new j(Ir.x,Ir.y-Hi),$n=new j(Ir.x+Ki,Ir.y),mi=new j(Ir.x+Ki,Ir.y-Hi)}else{const Rr=(Nt.left-Ht)*Ge.scale-Qt+Wr[0],Ai=(-Nt.top-Ht)*Ge.scale+Wr[1],oi=Rr+Hi,Ci=Ai+Ki;Ir=new j(Rr,Ai),ui=new j(oi,Ai),$n=new j(Rr,Ci),mi=new j(oi,Ci)}if(Ke){let Rr;Rr=Me?new j(0,0):bi?new j(Fe[0],Fe[1]):new j(_e[0],_e[1]),Ir._rotateAround(Ke,Rr),ui._rotateAround(Ke,Rr),$n._rotateAround(Ke,Rr),mi._rotateAround(Ke,Rr)}const _r=new j(0,0),hi=new j(0,0);Ze.push({tl:Ir,tr:ui,bl:$n,br:mi,tex:Jt,writingMode:me.writingMode,glyphOffset:ei,sectionIndex:Ge.sectionIndex,isSDF:Qr,pixelOffsetTL:_r,pixelOffsetBR:hi,minFontScaleX:0,minFontScaleY:0})}}return Ze}(0,o,x,u,p,g,c,t.allowVerticalPlacement),oe=t.textSizeData;let ce=null;oe.kind==="source"?(ce=[Ao*u.layout.get("text-size").evaluate(g,{},W)],ce[0]>vs&&Je(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):oe.kind==="composite"&&(ce=[Ao*N.compositeTextSizes[0].evaluate(g,{},W),Ao*N.compositeTextSizes[1].evaluate(g,{},W)],(ce[0]>vs||ce[1]>vs)&&Je(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,Q,ce,x,p,g,A,e,i,T.lineStartIndex,T.lineLength,R,$,W);for(const fe of C)I[fe]=t.text.placedSymbolArray.length-1;return 4*Q.length}function eg(t){for(const e in t)return t[e];return null}function jh(t,e,i,o,c,u,p,g,x,T){let A=p.top,C=p.bottom,I=p.left,R=p.right;const N=p.collisionPadding;if(N&&(I-=N[0],A-=N[1],R+=N[2],C+=N[3]),x){const $=new j(I,A),W=new j(R,A),Q=new j(I,C),oe=new j(R,C),ce=Ct(x);let fe=new j(0,0);T&&(fe=new j(T[0],T[1])),$._rotateAround(ce,fe),W._rotateAround(ce,fe),Q._rotateAround(ce,fe),oe._rotateAround(ce,fe),I=Math.min($.x,W.x,Q.x,oe.x),R=Math.max($.x,W.x,Q.x,oe.x),A=Math.min($.y,W.y,Q.y,oe.y),C=Math.max($.y,W.y,Q.y,oe.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,I,A,R,C,g,o,c,u),t.length-1}function Qf(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function ib(t,e,i,o){const c=t.compareText;if(e in c){const u=c[e];for(let p=u.length-1;p>=0;p--)if(o.dist(u[p])<i)return!0}else c[e]=[];return c[e].push(o),!1}const nb=ua.VectorTileFeature.types,ob=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Vh(t,e,i,o,c,u,p,g,x,T,A,C,I,R,N,$){const W=A?Math.min(vs,Math.round(A[0])):0,Q=A?Math.min(vs,Math.round(A[1])):0;t.emplaceBack(e,i,Math.round(32*p),Math.round(32*g),x,T,(W<<1)+(C?1:0),Q,16*I,16*R,256*N,256*$,o,c,u,0)}function ep(t,e,i){t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i),t.emplaceBack(e.x,e.y,i)}function sb(t){for(const e of t.sections)if(We(e.text))return!0;return!1}class tp{constructor(e){this.layoutVertexArray=new pf,this.indexArray=new kn,this.programConfigurations=e,this.segments=new Yr,this.dynamicLayoutVertexArray=new cl,this.opacityVertexArray=new mf,this.placedSymbolArray=new Fm}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,T1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,E1.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ob,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}rt("SymbolBuffers",tp);class rp{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new Yr,this.collisionVertexArray=new yf,this.collisionVertexArrayExt=new cl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,S1.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,A1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}rt("CollisionBuffers",rp);class xs{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ie([]),this.placementViewportMatrix=Ie([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=$f(this.zoom,i["text-size"]),this.iconSizeData=$f(this.zoom,i["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),u=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(p=>Pn[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID}createArrays(){this.text=new tp(new aa(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new tp(new aa(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new jm,this.lineVertexArray=new Vm,this.symbolInstances=new Um}calculateGlyphDependencies(e,i,o,c,u){for(let p=0;p<e.length;p++)if(i[e.charCodeAt(p)]=!0,c&&u){const g=Uc[e.charAt(p)];g&&(i[g.charCodeAt(0)]=!0)}}populate(e,i,o,c){const u=this.layers[0],p=u.layout,g=p.get("text-font"),x=p.get("text-field"),T=p.get("icon-image"),A=(x.value.kind!=="constant"||x.value.value instanceof St&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),C=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,I=p.get("symbol-sort-key");if(this.features=[],!A&&!C)return;const R=i.iconDependencies,N=i.glyphDependencies,$=i.availableImages,W=new bt(this.zoom);for(const{feature:Q,id:oe,index:ce,sourceLayerIndex:fe}of e){const me=u._featureFilter.needGeometry,_e=ca(Q,me);if(!u._featureFilter.filter(W,_e,o))continue;let Pe,Me;if(me||(_e.geometry=Zo(Q,o,c)),A){const qe=u.getValueAndResolveTokens("text-field",_e,o,$),ze=St.factory(qe);sb(ze)&&(this.hasRTLText=!0),(!this.hasRTLText||hn()==="unavailable"||this.hasRTLText&&$t.isParsed())&&(Pe=I1(ze,u,_e))}if(C){const qe=u.getValueAndResolveTokens("icon-image",_e,o,$);Me=qe instanceof ln?qe:ln.fromString(qe)}if(!Pe&&!Me)continue;const He=this.sortFeaturesByKey?I.evaluate(_e,{},o):void 0;if(this.features.push({id:oe,text:Pe,icon:Me,index:ce,sourceLayerIndex:fe,geometry:_e.geometry,properties:Q.properties,type:nb[Q.type],sortKey:He}),Me&&(R[Me.name]=!0),Pe){const qe=g.evaluate(_e,{},o).join(","),ze=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Pn.vertical)>=0;for(const Ze of Pe.sections)if(Ze.image)R[Ze.image.name]=!0;else{const Ke=Ce(Pe.toString()),Fe=Ze.fontStack||qe,tt=N[Fe]=N[Fe]||{};this.calculateGlyphDependencies(Ze.text,tt,ze,this.allowVerticalPlacement,Ke)}}}p.get("symbol-placement")==="line"&&(this.features=function(Q){const oe={},ce={},fe=[];let me=0;function _e(qe){fe.push(Q[qe]),me++}function Pe(qe,ze,Ze){const Ke=ce[qe];return delete ce[qe],ce[ze]=Ke,fe[Ke].geometry[0].pop(),fe[Ke].geometry[0]=fe[Ke].geometry[0].concat(Ze[0]),Ke}function Me(qe,ze,Ze){const Ke=oe[ze];return delete oe[ze],oe[qe]=Ke,fe[Ke].geometry[0].shift(),fe[Ke].geometry[0]=Ze[0].concat(fe[Ke].geometry[0]),Ke}function He(qe,ze,Ze){const Ke=Ze?ze[0][ze[0].length-1]:ze[0][0];return`${qe}:${Ke.x}:${Ke.y}`}for(let qe=0;qe<Q.length;qe++){const ze=Q[qe],Ze=ze.geometry,Ke=ze.text?ze.text.toString():null;if(!Ke){_e(qe);continue}const Fe=He(Ke,Ze),tt=He(Ke,Ze,!0);if(Fe in ce&&tt in oe&&ce[Fe]!==oe[tt]){const ot=Me(Fe,tt,Ze),jt=Pe(Fe,tt,fe[ot].geometry);delete oe[Fe],delete ce[tt],ce[He(Ke,fe[jt].geometry,!0)]=jt,fe[ot].geometry=null}else Fe in ce?Pe(Fe,tt,Ze):tt in oe?Me(Fe,tt,Ze):(_e(qe),oe[Fe]=me-1,ce[tt]=me-1)}return fe.filter(qe=>qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Q,oe)=>Q.sortKey-oe.sortKey)}update(e,i,o,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,o,c),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,o,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(i[e.segment+1]),u=e.dist(i[e.segment]);const p={};for(let g=e.segment+1;g<i.length;g++)p[g]={x:i[g].x,y:i[g].y,tileUnitDistanceFromAnchor:c},g<i.length-1&&(c+=i[g+1].dist(i[g]));for(let g=e.segment||0;g>=0;g--)p[g]={x:i[g].x,y:i[g].y,tileUnitDistanceFromAnchor:u},g>0&&(u+=i[g-1].dist(i[g]));for(let g=0;g<i.length;g++){const x=p[g];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,c,u,p,g,x,T,A,C,I,R,N){const $=e.indexArray,W=e.layoutVertexArray,Q=e.segments.prepareSegment(4*i.length,W,$,this.canOverlap?p.sortKey:void 0),oe=this.glyphOffsetArray.length,ce=Q.vertexLength,fe=this.allowVerticalPlacement&&g===Pn.vertical?Math.PI/2:0,me=p.text&&p.text.sections;for(let _e=0;_e<i.length;_e++){const{tl:Pe,tr:Me,bl:He,br:qe,tex:ze,pixelOffsetTL:Ze,pixelOffsetBR:Ke,minFontScaleX:Fe,minFontScaleY:tt,glyphOffset:ot,isSDF:jt,sectionIndex:br}=i[_e],Gt=Q.vertexLength,qt=ot[1];Vh(W,x.x,x.y,x.z,T.x,T.y,Pe.x,qt+Pe.y,ze.x,ze.y,o,jt,Ze.x,Ze.y,Fe,tt),Vh(W,x.x,x.y,x.z,T.x,T.y,Me.x,qt+Me.y,ze.x+ze.w,ze.y,o,jt,Ke.x,Ze.y,Fe,tt),Vh(W,x.x,x.y,x.z,T.x,T.y,He.x,qt+He.y,ze.x,ze.y+ze.h,o,jt,Ze.x,Ke.y,Fe,tt),Vh(W,x.x,x.y,x.z,T.x,T.y,qe.x,qt+qe.y,ze.x+ze.w,ze.y+ze.h,o,jt,Ke.x,Ke.y,Fe,tt),ep(e.dynamicLayoutVertexArray,x,fe),$.emplaceBack(Gt,Gt+1,Gt+2),$.emplaceBack(Gt+1,Gt+2,Gt+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ot[0]),_e!==i.length-1&&br===i[_e+1].sectionIndex||e.programConfigurations.populatePaintArrays(W.length,p,p.index,{},R,N,me&&me[br])}e.placedSymbolArray.emplaceBack(x.x,x.y,x.z,T.x,T.y,oe,this.glyphOffsetArray.length-oe,ce,A,C,T.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],g,0,!1,0,I,0)}_commitLayoutVertex(e,i,o,c,u,p,g){e.emplaceBack(i,o,c,u,p,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,i,o,c,u,p,g){const x=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),T=x.vertexLength,A=g.tileAnchorX,C=g.tileAnchorY;for(let R=0;R<4;R++)o.collisionVertexArray.emplaceBack(0,0,0,0);o.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),o.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(o.layoutVertexArray,c,u,p,A,C,new j(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,u,p,A,C,new j(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,u,p,A,C,new j(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,c,u,p,A,C,new j(e.x1,e.y2)),x.vertexLength+=4;const I=o.indexArray;I.emplaceBack(T,T+1),I.emplaceBack(T+1,T+2),I.emplaceBack(T+2,T+3),I.emplaceBack(T+3,T),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,c,u,p){for(let g=c;g<u;g++){const x=o.get(g),T=this.getSymbolInstanceTextSize(e,p,i,g);this._addCollisionDebugVertices(x,T,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,i,o,c,u,p){for(let g=c;g<u;g++){const x=o.get(g),T=this.getSymbolInstanceIconSize(e,i,g);this._addCollisionDebugVertices(x,T,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new rp(gh,M_.members,ms),this.iconCollisionBox=new rp(gh,M_.members,ms);const o=gl(this.iconSizeData,e),c=gl(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(c,e,i,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(c,e,i,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(o,e,i,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(o,e,i,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,i,o,c){const u=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),p=Rh(this.textSizeData,e,u)/xi;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,i,o){const c=this.icon.placedSymbolArray.get(o),u=Rh(this.iconSizeData,e,c);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,i,o){e.emplaceBack(i,-o,-o),e.emplaceBack(i,o,-o),e.emplaceBack(i,o,o),e.emplaceBack(i,-o,o)}_updateTextDebugCollisionBoxes(e,i,o,c,u,p){for(let g=c;g<u;g++){const x=o.get(g),T=this.getSymbolInstanceTextSize(e,p,i,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,x.padding)}}_updateIconDebugCollisionBoxes(e,i,o,c,u){for(let p=c;p<u;p++){const g=o.get(p),x=this.getSymbolInstanceIconSize(e,i,p);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,g.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const o=gl(this.iconSizeData,e),c=gl(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const p=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(c,e,i,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(c,e,i,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(o,e,i,p.iconBoxStartIndex,p.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(o,e,i,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,c,u,p,g,x,T){const A={};for(let C=i;C<o;C++){const I=e.get(C);A.textBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},A.textFeatureIndex=I.featureIndex;break}for(let C=c;C<u;C++){const I=e.get(C);A.verticalTextBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},A.verticalTextFeatureIndex=I.featureIndex;break}for(let C=p;C<g;C++){const I=e.get(C);A.iconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},A.iconFeatureIndex=I.featureIndex;break}for(let C=x;C<T;C++){const I=e.get(C);A.verticalIconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,padding:I.padding,projectedAnchorX:I.projectedAnchorX,projectedAnchorY:I.projectedAnchorY,projectedAnchorZ:I.projectedAnchorZ,tileAnchorX:I.tileAnchorX,tileAnchorY:I.tileAnchorY},A.verticalIconFeatureIndex=I.featureIndex;break}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),c=o.vertexStartIndex+4*o.numGlyphs;for(let u=o.vertexStartIndex;u<c;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),c=[],u=[],p=[];for(let g=0;g<this.symbolInstances.length;++g){p.push(g);const x=this.symbolInstances.get(g);c.push(0|Math.round(i*x.tileAnchorX+o*x.tileAnchorY)),u.push(x.featureIndex)}return p.sort((g,x)=>c[g]-c[x]||u[x]-u[g]),p}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((c,u,p)=>{c>=0&&p.indexOf(c)===u&&this.addIndicesForPlacedSymbol(this.text,c)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}rt("SymbolBucket",xs,{omit:["layers","collisionBoxArray","features","compareText"]}),xs.MAX_GLYPHS=65535,xs.addDynamicAttributes=ep;const ab=new pi({"symbol-placement":new nt(Ae.layout_symbol["symbol-placement"]),"symbol-spacing":new nt(Ae.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new nt(Ae.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pt(Ae.layout_symbol["symbol-sort-key"]),"symbol-z-order":new nt(Ae.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new nt(Ae.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new nt(Ae.layout_symbol["icon-ignore-placement"]),"icon-optional":new nt(Ae.layout_symbol["icon-optional"]),"icon-rotation-alignment":new nt(Ae.layout_symbol["icon-rotation-alignment"]),"icon-size":new pt(Ae.layout_symbol["icon-size"]),"icon-text-fit":new nt(Ae.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new nt(Ae.layout_symbol["icon-text-fit-padding"]),"icon-image":new pt(Ae.layout_symbol["icon-image"]),"icon-rotate":new pt(Ae.layout_symbol["icon-rotate"]),"icon-padding":new nt(Ae.layout_symbol["icon-padding"]),"icon-keep-upright":new nt(Ae.layout_symbol["icon-keep-upright"]),"icon-offset":new pt(Ae.layout_symbol["icon-offset"]),"icon-anchor":new pt(Ae.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new nt(Ae.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new nt(Ae.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new nt(Ae.layout_symbol["text-rotation-alignment"]),"text-field":new pt(Ae.layout_symbol["text-field"]),"text-font":new pt(Ae.layout_symbol["text-font"]),"text-size":new pt(Ae.layout_symbol["text-size"]),"text-max-width":new pt(Ae.layout_symbol["text-max-width"]),"text-line-height":new pt(Ae.layout_symbol["text-line-height"]),"text-letter-spacing":new pt(Ae.layout_symbol["text-letter-spacing"]),"text-justify":new pt(Ae.layout_symbol["text-justify"]),"text-radial-offset":new pt(Ae.layout_symbol["text-radial-offset"]),"text-variable-anchor":new nt(Ae.layout_symbol["text-variable-anchor"]),"text-anchor":new pt(Ae.layout_symbol["text-anchor"]),"text-max-angle":new nt(Ae.layout_symbol["text-max-angle"]),"text-writing-mode":new nt(Ae.layout_symbol["text-writing-mode"]),"text-rotate":new pt(Ae.layout_symbol["text-rotate"]),"text-padding":new nt(Ae.layout_symbol["text-padding"]),"text-keep-upright":new nt(Ae.layout_symbol["text-keep-upright"]),"text-transform":new pt(Ae.layout_symbol["text-transform"]),"text-offset":new pt(Ae.layout_symbol["text-offset"]),"text-allow-overlap":new nt(Ae.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new nt(Ae.layout_symbol["text-ignore-placement"]),"text-optional":new nt(Ae.layout_symbol["text-optional"])});var ip={paint:new pi({"icon-opacity":new pt(Ae.paint_symbol["icon-opacity"]),"icon-color":new pt(Ae.paint_symbol["icon-color"]),"icon-halo-color":new pt(Ae.paint_symbol["icon-halo-color"]),"icon-halo-width":new pt(Ae.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pt(Ae.paint_symbol["icon-halo-blur"]),"icon-translate":new nt(Ae.paint_symbol["icon-translate"]),"icon-translate-anchor":new nt(Ae.paint_symbol["icon-translate-anchor"]),"text-opacity":new pt(Ae.paint_symbol["text-opacity"]),"text-color":new pt(Ae.paint_symbol["text-color"],{runtimeType:Fn,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new pt(Ae.paint_symbol["text-halo-color"]),"text-halo-width":new pt(Ae.paint_symbol["text-halo-width"]),"text-halo-blur":new pt(Ae.paint_symbol["text-halo-blur"]),"text-translate":new nt(Ae.paint_symbol["text-translate"]),"text-translate-anchor":new nt(Ae.paint_symbol["text-translate-anchor"])}),layout:ab};class tg{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:_o,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}rt("FormatSectionOverride",tg,{omit:["defaultValue"]});class $h extends Yn{constructor(e){super(e,ip)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const u of o)c.indexOf(u)<0&&c.push(u);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,o,c){const u=this.layout.get(e).evaluate(i,{},o,c),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||ss(p.value)||!u?u:function(g,x){return x.replace(/{([^{}]+)}/g,(T,A)=>A in g?String(g[A]):"")}(i.properties,u)}createBucket(e){return new xs(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of ip.paint.overridableProperties){if(!$h.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new tg(i),c=new _c(o,i.property.specification);let u=null;u=i.value.kind==="constant"||i.value.kind==="source"?new Qs("source",c):new gc("composite",c,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Li(i.property,u,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&$h.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),c=ip.paint.properties[i];let u=!1;const p=g=>{for(const x of g)if(c.overrides&&c.overrides.hasOverride(x))return void(u=!0)};if(o.value.kind==="constant"&&o.value.value instanceof St)p(o.value.value.sections);else if(o.value.kind==="source"){const g=T=>{u||(T instanceof yo&&Hr(T.value)===go?p(T.value.sections):T instanceof Nn?p(T.sections):T.eachChild(g))},x=o.value;x._styleExpression&&g(x._styleExpression.expression)}return u}getProgramConfiguration(e){return new Go(this,e)}}var lb={paint:new pi({"background-color":new nt(Ae.paint_background["background-color"]),"background-pattern":new jo(Ae.paint_background["background-pattern"]),"background-opacity":new nt(Ae.paint_background["background-opacity"])})},cb={paint:new pi({"raster-opacity":new nt(Ae.paint_raster["raster-opacity"]),"raster-hue-rotate":new nt(Ae.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new nt(Ae.paint_raster["raster-brightness-min"]),"raster-brightness-max":new nt(Ae.paint_raster["raster-brightness-max"]),"raster-saturation":new nt(Ae.paint_raster["raster-saturation"]),"raster-contrast":new nt(Ae.paint_raster["raster-contrast"]),"raster-resampling":new nt(Ae.paint_raster["raster-resampling"]),"raster-fade-duration":new nt(Ae.paint_raster["raster-fade-duration"])})};class ub extends Yn{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var hb={paint:new pi({"sky-type":new nt(Ae.paint_sky["sky-type"]),"sky-atmosphere-sun":new nt(Ae.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new nt(Ae.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new nt(Ae.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new nt(Ae.paint_sky["sky-gradient-radius"]),"sky-gradient":new Eo(Ae.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new nt(Ae.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new nt(Ae.paint_sky["sky-atmosphere-color"]),"sky-opacity":new nt(Ae.paint_sky["sky-opacity"])})};function np(t,e,i){const o=at(0,0,1),c=Lo(lo());return function(u,p,g){g*=.5;var x=p[0],T=p[1],A=p[2],C=p[3],I=Math.sin(g),R=Math.cos(g);u[0]=x*R-A*I,u[1]=T*R+C*I,u[2]=A*R+x*I,u[3]=C*R-T*I}(c,c,i?-Ct(t)+Math.PI:Ct(t)),Ro(c,c,-Ct(e)),pr(o,o,c),At(o,o)}const db={circle:class extends Yn{constructor(t){super(t,R0)}createBucket(t){return new If(t)}queryRadius(t){const e=t;return pl("circle-radius",this,e)+pl("circle-stroke-width",this,e)+Ch(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,o,c,u,p,g){const x=c_(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return u_(t,o,u,p,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,T)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Go(this,t)}},heatmap:class extends Yn{createBucket(t){return new d_(t)}constructor(t){super(t,N0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Rf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return pl("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,o,c,u,p,g){const x=this.paint.get("heatmap-radius").evaluate(e,i);return u_(t,o,u,p,g,!0,!0,new j(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Go(this,t)}},hillshade:class extends Yn{constructor(t){super(t,U0)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(t){return new Go(this,t)}},fill:class extends Yn{constructor(t){super(t,i1)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new Go(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Dh(t)}queryRadius(){return Ch(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,o,c,u){return!t.queryGeometry.isAboveHorizon&&n_(l_(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends Yn{constructor(t){super(t,p1)}createBucket(t){return new Vf(t)}queryRadius(){return Ch(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Go(this,t)}queryIntersectsFeature(t,e,i,o,c,u,p,g,x){const T=c_(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(e,i),C=this.paint.get("fill-extrusion-base").evaluate(e,i),I=[0,0],R=g&&u.elevation,N=u.elevation?u.elevation.exaggeration():1;if(R){const Q=t.tile.getBucket(this).centroidVertexArray,oe=x+1;if(oe<Q.length){const ce=Q.get(oe);I[0]=ce.a_centroid_pos0,I[1]=ce.a_centroid_pos1}}if(I[0]===0&&I[1]===1)return!1;const $=function(Q,oe,ce,fe,me,_e,Pe,Me,He){return _e?function(qe,ze,Ze,Ke,Fe,tt,ot,jt,br){const Gt=[],qt=[],Ge=[0,0,0,1];for(const Jt of qe){const Ht=[],Qr=[];for(const Vr of Jt){const ci=Vr.x+Ke.x,Si=Vr.y+Ke.y,Qt=m1(ci,Si,ze,Ze,tt,ot,jt,br);Ge[0]=ci,Ge[1]=Si,Ge[2]=Qt.base,Ge[3]=1,gi(Ge,Ge,Fe),Ge[3]=Math.max(Ge[3],1e-5);const Nt=E_([Ge[0]/Ge[3],Ge[1]/Ge[3],Ge[2]/Ge[3]]);Ge[0]=ci,Ge[1]=Si,Ge[2]=Qt.top,Ge[3]=1,gi(Ge,Ge,Fe),Ge[3]=Math.max(Ge[3],1e-5);const Lr=E_([Ge[0]/Ge[3],Ge[1]/Ge[3],Ge[2]/Ge[3]]);Ht.push(Nt),Qr.push(Lr)}Gt.push(Ht),qt.push(Qr)}return[Gt,qt]}(Q,oe,ce,fe,me,_e,Pe,Me,He):function(qe,ze,Ze,Ke,Fe){const tt=[],ot=[],jt=Fe[8]*ze,br=Fe[9]*ze,Gt=Fe[10]*ze,qt=Fe[11]*ze,Ge=Fe[8]*Ze,Jt=Fe[9]*Ze,Ht=Fe[10]*Ze,Qr=Fe[11]*Ze;for(const Vr of qe){const ci=[],Si=[];for(const Qt of Vr){const Nt=Qt.x+Ke.x,Lr=Qt.y+Ke.y,ei=Fe[0]*Nt+Fe[4]*Lr+Fe[12],Wr=Fe[1]*Nt+Fe[5]*Lr+Fe[13],ri=Fe[2]*Nt+Fe[6]*Lr+Fe[14],bi=Fe[3]*Nt+Fe[7]*Lr+Fe[15],Hi=ei+jt,Ki=Wr+br,Ir=ri+Gt,ui=Math.max(bi+qt,1e-5),$n=ei+Ge,mi=Wr+Jt,_r=ri+Ht,hi=Math.max(bi+Qr,1e-5),Rr=new j(Hi/ui,Ki/ui);Rr.z=Ir/ui,ci.push(Rr);const Ai=new j($n/hi,mi/hi);Ai.z=_r/hi,Si.push(Ai)}tt.push(ci),ot.push(Si)}return[tt,ot]}(Q,oe,ce,fe,me)}(o,C,A,T,p,R?g:null,I,N,u.center.lat),W=t.queryGeometry;return function(Q,oe,ce){let fe=1/0;n_(ce,oe)&&(fe=T_(ce,oe[0]));for(let me=0;me<oe.length;me++){const _e=oe[me],Pe=Q[me];for(let Me=0;Me<_e.length-1;Me++){const He=_e[Me],qe=[He,_e[Me+1],Pe[Me+1],Pe[Me],He];i_(ce,qe)&&(fe=Math.min(fe,T_(ce,qe)))}}return fe!==1/0&&fe}($[0],$[1],W.isPointQuery()?W.screenBounds:W.screenGeometry)}},line:class extends Yn{constructor(t){super(t,S_),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Gs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=A_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Lh(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Go(this,t)}queryRadius(t){const e=t,i=C_(pl("line-width",this,e),pl("line-gap-width",this,e)),o=pl("line-offset",this,e);return i/2+Math.abs(o)+Ch(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,o,c,u){if(t.queryGeometry.isAboveHorizon)return!1;const p=l_(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),g=t.pixelToTileUnitsFactor/2*C_(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),x=this.paint.get("line-offset").evaluate(e,i);return x&&(o=function(T,A){const C=[],I=new j(0,0);for(let R=0;R<T.length;R++){const N=T[R],$=[];for(let W=0;W<N.length;W++){const Q=N[W-1],oe=N[W],ce=N[W+1],fe=W===0?I:oe.sub(Q)._unit()._perp(),me=W===N.length-1?I:ce.sub(oe)._unit()._perp(),_e=fe._add(me)._unit();_e._mult(1/(_e.x*me.x+_e.y*me.y)),$.push(_e._mult(A)._add(oe))}C.push($)}return C}(o,x*t.pixelToTileUnitsFactor)),function(T,A,C){for(let I=0;I<A.length;I++){const R=A[I];if(T.length>=3){for(let N=0;N<R.length;N++)if(fl(T,R[N]))return!0}if(z0(T,R,C))return!0}return!1}(p,o,g)}isTileClipped(){return!0}},symbol:$h,background:class extends Yn{constructor(t){super(t,lb)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Yn{constructor(t){super(t,cb)}getProgramIds(){return["raster"]}},sky:class extends Yn{constructor(t){super(t,hb),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Rf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(t,e){const i=this.paint.get("sky-type");if(i==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),c=!o,u=t.style.light,p=u.properties.get("position");return c&&u.properties.get("anchor")==="viewport"&&Je("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?np(p.azimuthal,90-p.polar,e):np(o[0],90-o[1],e)}if(i==="gradient"){const o=this.paint.get("sky-gradient-center");return np(o[0],90-o[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}},{HTMLImageElement:rg,HTMLCanvasElement:ig,HTMLVideoElement:ng,ImageData:og,ImageBitmap:Gh}=G;class qh{constructor(e,i,o,c){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(i,c)}update(e,i,o){const{width:c,height:u}=e,{context:p}=this,{gl:g}=p;if(g.bindTexture(g.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!i||i.premultiply!==!1)),o||this.size&&this.size[0]===c&&this.size[1]===u){const{x,y:T}=o||{x:0,y:0};e instanceof rg||e instanceof ig||e instanceof ng||e instanceof og||Gh&&e instanceof Gh?g.texSubImage2D(g.TEXTURE_2D,0,x,T,g.RGBA,g.UNSIGNED_BYTE,e):g.texSubImage2D(g.TEXTURE_2D,0,x,T,c,u,g.RGBA,g.UNSIGNED_BYTE,e.data)}else this.size=[c,u],e instanceof rg||e instanceof ig||e instanceof ng||e instanceof og||Gh&&e instanceof Gh?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,g.UNSIGNED_BYTE,e):g.texImage2D(g.TEXTURE_2D,0,this.format,c,u,0,this.format,g.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,i){const{context:o}=this,{gl:c}=o;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class op{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new gs({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=Tr(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const c=[];let u=e.length%2==1?-e[e.length-1]*o:0,p=e[0]*o,g=!0;c.push({left:u,right:p,isDash:g,zeroLength:e[0]===0});let x=e[0];for(let T=1;T<e.length;T++){g=!g;const A=e[T];u=x*o,x+=A,p=x*o,c.push({left:u,right:p,isDash:g,zeroLength:A===0})}return c}addRoundDash(e,i,o){const c=i/2;for(let u=-o;u<=o;u++){const p=this.width*(this.nextRow+o+u);let g=0,x=e[g];for(let T=0;T<this.width;T++){T/x.right>1&&(x=e[++g]);const A=Math.abs(T-x.left),C=Math.abs(T-x.right),I=Math.min(A,C);let R;const N=u/o*(c+1);if(x.isDash){const $=c-Math.abs(N);R=Math.sqrt(I*I+$*$)}else R=c-Math.sqrt(I*I+N*N);this.image.data[p+T]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,i){for(let x=e.length-1;x>=0;--x){const T=e[x],A=e[x+1];T.zeroLength?e.splice(x,1):A&&A.isDash===T.isDash&&(A.left=T.left,e.splice(x,1))}const o=e[0],c=e[e.length-1];o.isDash===c.isDash&&(o.left=c.left-this.width,c.right=o.right+this.width);const u=this.width*this.nextRow;let p=0,g=e[p];for(let x=0;x<this.width;x++){x/g.right>1&&(g=e[++p]);const T=Math.abs(x-g.left),A=Math.abs(x-g.right),C=Math.min(T,A);this.image.data[u+x]=Math.max(0,Math.min(255,(g.isDash?C:-C)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const c=i==="round",u=c?7:0,p=2*u+1;if(this.nextRow+p>this.height)return Je("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let A=0;A<e.length;A++)e[A]<0&&(Je("Negative value is found in line dasharray, replacing values with 0"),e[A]=0),g+=e[A];if(g!==0){const A=this.width/g,C=this.getDashRanges(e,this.width,A);c?this.addRoundDash(C,A,u):this.addRegularDash(C,i==="square"?.5*A:0)}const x=this.nextRow+u;this.nextRow+=p;const T={tl:[x,u],br:[g,0]};return this.positions[o]=T,T}}rt("LineAtlas",op);class fb{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const pb=G.performance;function sg(t){const e=t?t.url.toString():void 0;return pb.getEntriesByName(e)}class mb{constructor(){this.tasks={},this.taskQueue=[],uo(["process"],this),this.invoker=new fb(this.process),this.nextId=0}add(e,i){const o=this.nextId++,c=function({type:u,isSymbolTile:p,zoom:g}){return g=g||0,u==="message"?0:u!=="maybePrepare"||p?u!=="parseTile"||p?u==="parseTile"&&p?300-g:u==="maybePrepare"&&p?400-g:500:200-g:100-g}(i);if(c===0){Dt();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[o]={fn:e,metadata:i,priority:c,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){Dt();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const u=this.tasks[this.taskQueue[c]];u.priority<i&&(i=u.priority,e=c)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}function ag(t,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[t*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class Zh{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=Gc(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const o=function(u,p,g){var x=ag(256*u,256*(p=Math.pow(2,g)-p-1),g),T=ag(256*(u+1),256*(p+1),g);return x[0]+","+x[1]+","+T[0]+","+T[1]}(this.x,this.y,this.z),c=function(u,p,g){let x,T="";for(let A=u;A>0;A--)x=1<<A-1,T+=(p&x?1:0)+(g&x?2:0);return T}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class sp{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Gc(e,i.z,i.z,i.x,i.y)}}class Xi{constructor(e,i,o,c,u){this.overscaledZ=e,this.wrap=i,this.canonical=new Zh(o,+c,+u),this.key=i===0&&e===o?this.canonical.key:Gc(i,e,o,c,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Xi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xi(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Gc(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return Gc(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Xi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new Xi(i,this.wrap,i,o,c),new Xi(i,this.wrap,i,o+1,c),new Xi(i,this.wrap,i,o,c+1),new Xi(i,this.wrap,i,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Xi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Xi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Gc(t,e,i,o,c){const u=1<<Math.min(i,22);let p=u*(c%u)+o%u;return t&&i<22&&(p+=u*u*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*p+i)+(e-i)}rt("CanonicalTileID",Zh),rt("OverscaledTileID",Xi,{omit:["projMatrix"]});class Tl{constructor(e,i,o){this.func=e,this.mask=i,this.range=o}}Tl.ReadOnly=!1,Tl.ReadWrite=!0,Tl.disabled=new Tl(519,Tl.ReadOnly,[0,1]);const ap=7680;class lp{constructor(e,i,o,c,u,p){this.test=e,this.ref=i,this.mask=o,this.fail=c,this.depthFail=u,this.pass=p}}lp.disabled=new lp({func:519,mask:0},0,0,ap,ap,ap);class Co{constructor(e,i,o){this.blendFunction=e,this.blendColor=i,this.mask=o}}Co.Replace=[1,0],Co.disabled=new Co(Co.Replace,Xt.transparent,[!1,!1,!1,!1]),Co.unblended=new Co(Co.Replace,Xt.transparent,[!0,!0,!0,!0]),Co.alphaBlended=new Co([1,771],Xt.transparent,[!0,!0,!0,!0]);const cp=1029,up=2305;class eo{constructor(e,i,o){this.enable=e,this.mode=i,this.frontFace=o}}eo.disabled=new eo(!1,cp,up),eo.backCCW=new eo(!0,cp,up),eo.backCW=new eo(!0,cp,2304),eo.frontCW=new eo(!0,1028,2304),eo.frontCCW=new eo(!0,1028,up);class lg{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class cg{constructor(e,i,o,c,u){this.type="Feature",this._vectorTileFeature=e,e._z=i,e._x=o,e._y=c,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(e[i]=this[i]);return e}}class _b{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,o){const c=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},Wt(this.stateChanges[e][c],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(const u in this.state[e])u!==c&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const u in this.state[e][c])o[u]||(this.deletedStates[e][c][u]=null)}else for(const u in o)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][u]===null&&delete this.deletedStates[e][c][u]}removeFeatureState(e,i,o){if(this.deletedStates[e]===null)return;const c=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&i!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][o]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(o in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][o]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,i){const o=String(i),c=Wt({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const u=this.deletedStates[e][i];if(u===null)return{};for(const p in u)delete c[p]}return c}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const o={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const u={};for(const p in this.stateChanges[c])this.state[c][p]||(this.state[c][p]={}),Wt(this.state[c][p],this.stateChanges[c][p]),u[p]=this.state[c][p];o[c]=u}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const u={};if(this.deletedStates[c]===null)for(const p in this.state[c])u[p]={},this.state[c][p]={};else for(const p in this.deletedStates[c]){if(this.deletedStates[c][p]===null)this.state[c][p]={};else for(const g of Object.keys(this.deletedStates[c][p]))delete this.state[c][p][g];u[p]=this.state[c][p]}o[c]=o[c]||{},Wt(o[c],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const c in e)e[c].setFeatureState(o,i)}}class ug{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function hg(t,e,i,o){let c=0,u=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(o[p])<1e-15){if(i[p]<t[p]||i[p]>e[p])return null}else{const g=1/o[p];let x=(t[p]-i[p])*g,T=(e[p]-i[p])*g;if(x>T){const A=x;x=T,T=A}if(x>c&&(c=x),T<u&&(u=T),c>u)return null}return c}function dg(t,e,i,o,c,u,p,g,x,T,A){const C=o-t,I=c-e,R=u-i,N=p-t,$=g-e,W=x-i,Q=A[1]*W-A[2]*$,oe=A[2]*N-A[0]*W,ce=A[0]*$-A[1]*N,fe=C*Q+I*oe+R*ce;if(Math.abs(fe)<1e-15)return null;const me=1/fe,_e=T[0]-t,Pe=T[1]-e,Me=T[2]-i,He=(_e*Q+Pe*oe+Me*ce)*me;if(He<0||He>1)return null;const qe=Pe*R-Me*I,ze=Me*C-_e*R,Ze=_e*I-Pe*C,Ke=(A[0]*qe+A[1]*ze+A[2]*Ze)*me;return Ke<0||He+Ke>1?null:(N*qe+$*ze+W*Ze)*me}function fg(t,e,i){return(t-e)/(i-e)}function pg(t,e,i,o,c,u,p,g,x){const T=1<<i,A=u-o,C=p-c,I=(t+1)/T*A+o,R=(e+0)/T*C+c,N=(e+1)/T*C+c;g[0]=(t+0)/T*A+o,g[1]=R,x[0]=I,x[1]=N}class mg{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(u){const p=Math.ceil(Math.log2(u.dim/8)),g=[];let x=Math.ceil(Math.pow(2,p));const T=1/x,A=(R,N,$,W,Q)=>{const oe=W?1:0,ce=(R+1)*$-oe,fe=N*$,me=(N+1)*$-oe;Q[0]=R*$,Q[1]=fe,Q[2]=ce,Q[3]=me};let C=new ug(x);const I=[];for(let R=0;R<x*x;R++){A(R%x,Math.floor(R/x),T,!1,I);const N=bs(I[0],I[1],u),$=bs(I[2],I[1],u),W=bs(I[2],I[3],u),Q=bs(I[0],I[3],u);C.minimums.push(Math.min(N,$,W,Q)),C.maximums.push(Math.max(N,$,W,Q)),C.leaves.push(1)}for(g.push(C),x/=2;x>=1;x/=2){const R=g[g.length-1];C=new ug(x);for(let N=0;N<x*x;N++){A(N%x,Math.floor(N/x),2,!0,I);const $=R.getElevation(I[0],I[1]),W=R.getElevation(I[2],I[1]),Q=R.getElevation(I[2],I[3]),oe=R.getElevation(I[0],I[3]),ce=R.isLeaf(I[0],I[1]),fe=R.isLeaf(I[2],I[1]),me=R.isLeaf(I[2],I[3]),_e=R.isLeaf(I[0],I[3]),Pe=Math.min($.min,W.min,Q.min,oe.min),Me=Math.max($.max,W.max,Q.max,oe.max),He=ce&&fe&&me&&_e;C.maximums.push(Me),C.minimums.push(Pe),C.leaves.push(Me-Pe<=5&&He?1:0)}g.push(C)}return g}(this.dem),o=i.length-1,c=i[o];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,c,u,p,g=1){return hg([e,i,-100],[o,c,this.maximums[0]*g],u,p)}raycast(e,i,o,c,u,p,g=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,i,o,c,u,p,g);if(x==null)return null;const T=[],A=[],C=[],I=[],R=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;R.length>0;){const{idx:N,t:$,nodex:W,nodey:Q,depth:oe}=R.pop();if(this.leaves[N]){pg(W,Q,oe,e,i,o,c,C,I);const fe=1<<oe,me=(W+0)/fe,_e=(W+1)/fe,Pe=(Q+0)/fe,Me=(Q+1)/fe,He=bs(me,Pe,this.dem)*g,qe=bs(_e,Pe,this.dem)*g,ze=bs(_e,Me,this.dem)*g,Ze=bs(me,Me,this.dem)*g,Ke=dg(C[0],C[1],He,I[0],C[1],qe,I[0],I[1],ze,u,p),Fe=dg(I[0],I[1],ze,C[0],I[1],Ze,C[0],C[1],He,u,p),tt=Math.min(Ke!==null?Ke:Number.MAX_VALUE,Fe!==null?Fe:Number.MAX_VALUE);if(tt!==Number.MAX_VALUE)return tt;{const ot=Zt([],u,p,$);if(_g(He,qe,Ze,ze,fg(ot[0],C[0],I[0]),fg(ot[1],C[1],I[1]))>=ot[2])return $}continue}let ce=0;for(let fe=0;fe<this._siblingOffset.length;fe++){pg((W<<1)+this._siblingOffset[fe][0],(Q<<1)+this._siblingOffset[fe][1],oe+1,e,i,o,c,C,I),C[2]=-100,I[2]=this.maximums[this.childOffsets[N]+fe]*g;const me=hg(C,I,u,p);if(me!=null){const _e=me;T[fe]=_e;let Pe=!1;for(let Me=0;Me<ce&&!Pe;Me++)_e>=T[A[Me]]&&(A.splice(Me,0,fe),Pe=!0);Pe||(A[ce]=fe),ce++}}for(let fe=0;fe<ce;fe++){const me=A[fe];R.push({idx:this.childOffsets[N]+me,t:T[me],nodex:(W<<1)+this._siblingOffset[me][0],nodey:(Q<<1)+this._siblingOffset[me][1],depth:oe+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,c,u){if(e[c].isLeaf(i,o)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const p=c-1,g=e[p];let x,T=0;for(let A=0;A<this._siblingOffset.length;A++){const C=2*i+this._siblingOffset[A][0],I=2*o+this._siblingOffset[A][1],R=g.getElevation(C,I),N=g.isLeaf(C,I),$=this._addNode(R.min,R.max,N);N&&(T|=1<<A),x||(x=$)}for(let A=0;A<this._siblingOffset.length;A++)T&1<<A||this._construct(e,2*i+this._siblingOffset[A][0],2*o+this._siblingOffset[A][1],p,x+A)}}function _g(t,e,i,o,c,u){return nr(nr(t,i,u),nr(e,o,u),c)}function bs(t,e,i){const o=i.dim,c=Vt(t*o-.5,0,o-1),u=Vt(e*o-.5,0,o-1),p=Math.floor(c),g=Math.floor(u),x=Math.min(p+1,o-1),T=Math.min(g+1,o-1);return _g(i.get(p,g),i.get(x,g),i.get(p,T),i.get(x,T),c-p,u-g)}const gg={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Wh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,c=!1,u=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return Je(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const p=this.dim=i.height-2;if(this.data=new Uint32Array(i.data.buffer),this.encoding=o||"mapbox",this.borderReady=c,!c){for(let g=0;g<p;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(p,g)]=this.data[this._idx(p-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,p)]=this.data[this._idx(g,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)],u&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new mg(this)}get(e,i,o=!1){const c=new Uint8Array(this.data.buffer);o&&(e=Vt(e,-1,this.dim),i=Vt(i,-1,this.dim));const u=4*this._idx(e,i);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[u],c[u+1],c[u+2])}static getUnpackVector(e){return gg[e]}get unpackVector(){return gg[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,o){return(256*e*256+256*i+o)/10-1e4}_unpackTerrarium(e,i,o){return 256*e+i+o/256-32768}static pack(e,i){const o=[0,0,0,0],c=Wh.getUnpackVector(i);let u=Math.floor((e+c[3])/c[2]);return o[2]=u%256,u=Math.floor(u/256),o[1]=u%256,u=Math.floor(u/256),o[0]=u,o}getPixels(){return new zn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,u=i*this.dim+this.dim,p=o*this.dim,g=o*this.dim+this.dim;switch(i){case-1:c=u-1;break;case 1:u=c+1}switch(o){case-1:p=g-1;break;case 1:g=p+1}const x=-i*this.dim,T=-o*this.dim;for(let A=p;A<g;A++)for(let C=c;C<u;C++)this.data[this._idx(C,A)]=e.data[this._idx(C+x,A+T)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}rt("DEMData",Wh),rt("DemMinMaxQuadTree",mg,{omit:["dem"]});class gb{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,o){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const u={value:i,timeout:void 0};if(o!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},o)),this.data[c].push(u),this.order.push(c),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const o=e.wrapped().key,c=i===void 0?0:this.data[o].indexOf(i),u=this.data[o][c];return this.data[o].splice(c,1),u.timeout&&clearTimeout(u.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(u.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const o in this.data)for(const c of this.data[o])e(c.value)||i.push(c);for(const o of i)this.remove(o.value.tileID,o)}}class ha extends po{constructor(e,i,o){super(),this.id=e,this._onlySymbols=o,i.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new gb(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _b}onAdd(e){this.map=e,this._minTileCacheSize=e?e._minTileCacheSize:null,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const o=this._tiles[i];o.upload(e),o.prepare(this.map.style.imageManager)}}getIds(){return yi(this._tiles).map(e=>e.tileID).sort(yg).map(e=>e.key)}getRenderableIds(e){const i=[];for(const o in this._tiles)this._isIdRenderable(+o,e)&&i.push(this._tiles[o]);return e?i.sort((o,c)=>{const u=o.tileID,p=c.tileID,g=new j(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),x=new j(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-p.overscaledZ||x.y-g.y||x.x-g.x}).map(o=>o.tileID.key):i.map(o=>o.tileID).sort(yg).map(o=>o.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=i),this._loadTile(o,this._tileLoaded.bind(this,o,e,i)))}_tileLoaded(e,i,o,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new Ia(c,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Dr.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new fo("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let c=0;c<i.length;c++){const u=i[c];if(e.neighboringTiles&&e.neighboringTiles[u]){const p=this.getTileByID(u);o(e,p),o(p,e)}}function o(c,u){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let p=u.tileID.canonical.x-c.tileID.canonical.x;const g=u.tileID.canonical.y-c.tileID.canonical.y,x=Math.pow(2,c.tileID.canonical.z),T=u.tileID.key;p===0&&g===0||Math.abs(g)>1||(Math.abs(p)>1&&(Math.abs(p+x)===1?p+=x:Math.abs(p-x)===1&&(p-=x)),u.dem&&c.dem&&(c.dem.backfillBorder(u.dem,p,g),c.neighboringTiles&&c.neighboringTiles[T]&&(c.neighboringTiles[T].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,o,c){for(const u in this._tiles){let p=this._tiles[u];if(c[u]||!p.hasData()||p.tileID.overscaledZ<=i||p.tileID.overscaledZ>o)continue;let g=p.tileID;for(;p&&p.tileID.overscaledZ>i+1;){const T=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[T.key],p&&p.hasData()&&(g=T)}let x=g;for(;x.overscaledZ>i;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]){c[g.key]=g;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=i?o:null}for(let o=e.overscaledZ-1;o>=i;o--){const c=e.scaledTo(o),u=this._getLoadedTile(c);if(u)return u}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const o=Math.ceil(e.width/i)+1,c=Math.ceil(e.height/i)+1,u=Math.floor(o*c*5),p=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(g)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const o={};for(const c in this._tiles){const u=this._tiles[c];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+i),o[u.tileID.key]=u}this._tiles=o;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,i,o){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!o)return;let c;this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(g=>new Xi(g.canonical.z,g.wrap,g.canonical.z,g.canonical.x,g.canonical.y)):(c=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(g=>this._source.hasTile(g)))):c=[];const u=this._updateRetainedTiles(c);if(vg(this._source.type)&&c.length!==0){const g={},x={},T=Object.keys(u);for(const C of T){const I=u[C],R=this._tiles[C];if(!R||R.fadeEndTime&&R.fadeEndTime<=Dr.now())continue;const N=this.findLoadedParent(I,Math.max(I.overscaledZ-ha.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),g[N.tileID.key]=N.tileID),x[C]=I}const A=c[c.length-1].overscaledZ;for(const C in this._tiles){const I=this._tiles[C];if(u[C]||!I.hasData())continue;let R=I.tileID;for(;R.overscaledZ>A;){R=R.scaledTo(R.overscaledZ-1);const N=this._tiles[R.key];if(N&&N.hasData()&&x[R.key]){u[C]=I.tileID;break}}}for(const C in g)u[C]||(this._coveredTiles[C]=!0,u[C]=g[C])}for(const g in u)this._tiles[g].clearFadeHold();const p=function(g,x){const T=[];for(const A in g)A in x||T.push(A);return T}(this._tiles,u);for(const g of p){const x=this._tiles[g];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+g)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const o={},c=e.reduce((T,A)=>Math.min(T,A.overscaledZ),1/0),u=e[0].overscaledZ,p=Math.max(u-ha.maxOverzooming,this._source.minzoom),g=Math.max(u+ha.maxUnderzooming,this._source.minzoom),x={};for(const T of e){const A=this._addTile(T);i[T.key]=T,A.hasData()||c<this._source.maxzoom&&(x[T.key]=T)}this._retainLoadedChildren(x,c,g,i);for(const T of e){let A=this._tiles[T.key];if(A.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const I=T.children(this._source.maxzoom)[0],R=this.getTile(I);if(R&&R.hasData()){i[I.key]=I;continue}}else{const I=T.children(this._source.maxzoom);if(i[I[0].key]&&i[I[1].key]&&i[I[2].key]&&i[I[3].key])continue}let C=A.wasRequested();for(let I=T.overscaledZ-1;I>=p;--I){const R=T.scaledTo(I);if(o[R.key]||(o[R.key]=!0,A=this.getTile(R),!A&&C&&(A=this._addTile(R)),A&&(i[R.key]=R,C=A.wasRequested(),A.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let o,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){o=this._loadedParentTiles[c.key];break}i.push(c.key);const u=c.scaledTo(c.overscaledZ-1);if(o=this._getLoadedTile(u),o)break;c=u}for(const u of i)this._loadedParentTiles[u]=o}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const o=Boolean(i);if(!o){const c=this.map?this.map.painter:null,u=this._source.type==="raster"||this._source.type==="raster-dem";i=new dp(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,u),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,o||this._source.fire(new fo("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const o=i.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,i,o){const c=[],u=this.transform;if(!u)return c;for(const p in this._tiles){const g=this._tiles[p];if(o&&g.clearQueryDebugViz(),g.holdingForFade())continue;const x=e.containsTile(g,u,i);x&&c.push(x)}return c}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(o=>this._tiles[o].tileID);for(const o of i)o.projMatrix=this.transform.calculateProjMatrix(o.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(vg(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=Dr.now())return!0}return!1}setFeatureState(e,i,o){this._state.updateState(e=e||"_geojsonTileLayer",i,o)}removeFeatureState(e,i,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,o)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,o){const c=this._tiles[e];c&&c.setDependencies(i,o)}reloadTilesForDependencies(e,i){for(const o in this._tiles)this._tiles[o].hasDependency(e,i)&&this._reloadTile(+o,"reloading");this._cache.filter(o=>!o.hasDependency(e,i))}_preloadTiles(e,i){const o=new Map,c=Array.isArray(e)?e:[e],u=this.map.painter.terrain,p=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(const T of c){const A=T.coveringTiles({tileSize:p,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const C of A)o.set(C.key,C);this.usedForTerrain&&T.updateElevation(!1)}const g=Array.from(o.values()),x=this._source.type==="raster"||this._source.type==="raster-dem";nn(g,(T,A)=>{const C=new dp(T,this._source.tileSize*T.overscaleFactor(),this.transform.tileZoom,this.map.painter,x);this._loadTile(C,I=>{this._source.type==="raster-dem"&&C.dem&&this._backfillDEM(C),A(I,C)})},i)}}function yg(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||o-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function vg(t){return t==="raster"||t==="image"||t==="video"}ha.maxOverzooming=10,ha.maxUnderzooming=3;class Xh{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const c=o||e.findDEMTileFor(i);if(!c||!c.dem)return;const u=c.dem,p=c.tileID,g=1<<i.canonical.z-p.canonical.z;return new Xh(c,c.tileSize/Rt/g,[(i.canonical.x/g-p.canonical.x)*u.dim,(i.canonical.y/g-p.canonical.y)*u.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(o);return new j(c,u)}getElevationAt(e,i,o,c){const u=e*this._scale+this._offset[0],p=i*this._scale+this._offset[1],g=Math.floor(u),x=Math.floor(p),T=this._dem;return c=!!c,o?nr(nr(T.get(g,x,c),T.get(g,x+1,c),p-x),nr(T.get(g+1,x,c),T.get(g+1,x+1,c),p-x),u-g):T.get(g,x,c)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Jn(1,e)*this._dem.stride}}class xg{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ra(Rt,16,0),this.featureIndexArray=new Gm,this.promoteId=i}insert(e,i,o,c,u,p=0){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,u,p);const x=this.grid;for(let T=0;T<i.length;T++){const A=i[T],C=[1/0,1/0,-1/0,-1/0];for(let I=0;I<A.length;I++){const R=A[I];C[0]=Math.min(C[0],R.x),C[1]=Math.min(C[1],R.y),C[2]=Math.max(C[2],R.x),C[3]=Math.max(C[3],R.y)}C[0]<Rt&&C[1]<Rt&&C[2]>=0&&C[3]>=0&&x.insert(g,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ua.VectorTile(new jc(this.rawTileData)).layers,this.sourceLayerCoder=new lg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,o,c){this.loadVTLayers();const u=e.params||{},p=il(u.filter),g=e.tileResult,x=e.transform,T=g.bufferedTilespaceBounds,A=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(N,$,W,Q)=>a_(g.bufferedTilespaceGeometry,N,$,W,Q));A.sort(yb);let C=null;x.elevation&&A.length>0&&(C=Xh.create(x.elevation,this.tileID));const I={};let R;for(let N=0;N<A.length;N++){const $=A[N];if($===R)continue;R=$;const W=this.featureIndexArray.get($);let Q=null;this.loadMatchingFeature(I,W,p,u.layers,u.availableImages,i,o,c,(oe,ce,fe,me=0)=>(Q||(Q=Zo(oe,this.tileID.canonical,e.tileTransform)),ce.queryIntersectsFeature(g,oe,fe,Q,this.z,e.transform,e.pixelPosMatrix,C,me)))}return I}loadMatchingFeature(e,i,o,c,u,p,g,x,T){const{featureIndex:A,bucketIndex:C,sourceLayerIndex:I,layoutVertexArrayOffset:R}=i,N=this.bucketLayerIDs[C];if(c&&!function(oe,ce){for(let fe=0;fe<oe.length;fe++)if(ce.indexOf(oe[fe])>=0)return!0;return!1}(c,N))return;const $=this.sourceLayerCoder.decode(I),W=this.vtLayers[$].feature(A);if(o.needGeometry){const oe=ca(W,!0);if(!o.filter(new bt(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!o.filter(new bt(this.tileID.overscaledZ),W))return;const Q=this.getId(W,$);for(let oe=0;oe<N.length;oe++){const ce=N[oe];if(c&&c.indexOf(ce)<0)continue;const fe=p[ce];if(!fe)continue;let me={};Q!==void 0&&x&&(me=x.getState(fe.sourceLayer||"_geojsonTileLayer",Q));const _e=Wt({},g[ce]);_e.paint=bg(_e.paint,fe.paint,W,me,u),_e.layout=bg(_e.layout,fe.layout,W,me,u);const Pe=!T||T(W,fe,me,R);if(!Pe)continue;const Me=new cg(W,this.z,this.x,this.y,Q);Me.layer=_e;let He=e[ce];He===void 0&&(He=e[ce]=[]),He.push({featureIndex:A,feature:Me,intersectionZ:Pe})}}lookupSymbolFeatures(e,i,o,c,u,p,g,x){const T={};this.loadVTLayers();const A=il(u);for(const C of e)this.loadMatchingFeature(T,{bucketIndex:o,sourceLayerIndex:c,featureIndex:C,layoutVertexArrayOffset:0},A,p,g,x,i);return T}loadFeature(e){const{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(o),u=this.vtFeatures[c];if(u[i])return u[i];const p=this.vtLayers[c].feature(i);return u[i]=p,p}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof o=="boolean"&&(o=Number(o))),o}}function bg(t,e,i,o,c){return Vi(t,(u,p)=>{const g=e instanceof Uo?e.get(p):null;return g&&g.evaluate?g.evaluate(i,o,c):g})}function yb(t,e){return e-t}rt("FeatureIndex",xg,{omit:["rawTileData","sourceLayerCoder"]});var vb=Nr([{name:"a_pos",type:"Int16",components:2}]);const Vn=32,Mo=33,ws=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,o=0,c=0,u=0,p=0,g=0;for(1&e?c=u=p=Vn:i=o=g=Vn;(e>>=1)>1;){const T=i+c>>1,A=o+u>>1;1&e?(c=i,u=o,i=p,o=g):(i=c,o=u,c=p,u=g),p=T,g=A}const x=4*t;ws[x+0]=i,ws[x+1]=o,ws[x+2]=c,ws[x+3]=u}const Io=new Uint16Array(2178),Ts=new Uint8Array(1089),Hh=new Uint16Array(1089);function wg(t){return t===0?-.03125:t===32?.03125:0}var hp=Nr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Tg={type:2,extent:Rt,loadGeometry:()=>[[new j(0,0),new j(8193,0),new j(8193,8193),new j(0,8193),new j(0,0)]]};class dp{constructor(e,i,o,c,u){this.tileID=e,this.uid=Rn(),this.uses=0,this.tileSize=i,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Dr.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=El(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,o){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,u){const p={};if(!u)return p;for(const g of c){const x=g.layerIds.map(T=>u.getLayer(T)).filter(Boolean);if(x.length!==0){g.layers=x,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(T=>x.filter(A=>A.id===T)[0]));for(const T of x)p[T.id]=g}}return p}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const u=this.buckets[c];if(u instanceof xs){if(this.hasSymbolBuckets=!0,!o)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const u=this.buckets[c];if(u instanceof xs&&u.hasRTLText){this.hasRTLText=!0,$t.isLoading()||$t.isLoaded()||hn()!=="deferred"||In();break}}this.queryPadding=0;for(const c in this.buckets){const u=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(c).queryRadius(u))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Ef}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const o in this.buckets){const c=this.buckets[o];c.uploadPending()&&c.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new qh(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new qh(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new qh(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,o,c,u,p,g,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:g,transform:p,params:u,tileTransform:this.tileTransform},e,i,o):{}}querySourceFeatures(e,i){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const c=o.loadVTLayers(),u=i?i.sourceLayer:"",p=c._geojsonTileLayer||c[u];if(!p)return;const g=il(i&&i.filter),{z:x,x:T,y:A}=this.tileID.canonical,C={z:x,x:T,y:A};for(let I=0;I<p.length;I++){const R=p.feature(I);if(g.needGeometry){const W=ca(R,!0);if(!g.filter(new bt(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!g.filter(new bt(this.tileID.overscaledZ),R))continue;const N=o.getId(R,u),$=new cg(R,x,T,A,N);$.tile=C,e.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const o=er(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const o=Date.now();let c=!1;if(this.expirationTime>o)c=!1;else if(i)if(this.expirationTime<i)c=!0;else{const u=this.expirationTime-i;u?this.expirationTime=o+Math.max(u,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!i)return;const o=this.latestFeatureIndex.loadVTLayers(),c=i.style.listImages();for(const u in this.buckets){if(!i.style.hasLayer(u))continue;const p=this.buckets[u],g=p.layers[0].sourceLayer||"_geojsonTileLayer",x=o[g],T=e[g];if(!x||!T||Object.keys(T).length===0)continue;if(p.update(T,x,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),p instanceof Lh||p instanceof Dh){const C=i.style._getSourceCache(p.layers[0].source);i._terrain&&i._terrain.enabled&&C&&p.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(C.id,this.tileID)}const A=i&&i.style&&i.style.getLayer(u);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Dr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Dr.now()+e}setDependencies(e,i){const o={};for(const c of i)o[c]=!0;this.dependencies[e]=o}hasDependency(e,i){for(const o of e){const c=this.dependencies[o];if(c){for(const u of i)if(c[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const o=Zo(Tg,this.tileID.canonical,this.tileTransform)[0],c=new al,u=new vh;for(let p=0;p<o.length;p++){const{x:g,y:x}=o[p];c.emplaceBack(g,x),u.emplaceBack(p)}u.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(c,hp.members),this._tileDebugSegments=Yr.simpleSegment(0,0,c.length,u.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const o=Zo(Tg,this.tileID.canonical,this.tileTransform)[0];let c,u;if(this.isRaster){const p=function(g,x){const T=El(g,x),A=Math.pow(2,g.z);for(let W=0;W<Mo;W++)for(let Q=0;Q<Mo;Q++){const oe=qo((g.x+(Q+wg(Q))/Vn)/A),ce=jn((g.y+(W+wg(W))/Vn)/A),fe=x.project(oe,ce),me=W*Mo+Q;Io[2*me+0]=Math.round((fe.x*T.scale-T.x)*Rt),Io[2*me+1]=Math.round((fe.y*T.scale-T.y)*Rt)}Ts.fill(0),Hh.fill(0);for(let W=2045;W>=0;W--){const Q=4*W,oe=ws[Q+0],ce=ws[Q+1],fe=ws[Q+2],me=ws[Q+3],_e=oe+fe>>1,Pe=ce+me>>1,Me=_e+Pe-ce,He=Pe+oe-_e,qe=ce*Mo+oe,ze=me*Mo+fe,Ze=Pe*Mo+_e,Ke=Math.hypot((Io[2*qe+0]+Io[2*ze+0])/2-Io[2*Ze+0],(Io[2*qe+1]+Io[2*ze+1])/2-Io[2*Ze+1])>=16;if(Ts[Ze]=Ts[Ze]||(Ke?1:0),W<1022){const Fe=(ce+He>>1)*Mo+(oe+Me>>1),tt=(me+He>>1)*Mo+(fe+Me>>1);Ts[Ze]=Ts[Ze]||Ts[Fe]||Ts[tt]}}const C=new ll,I=new kn;let R=0;function N(W,Q){const oe=Q*Mo+W;return Hh[oe]===0&&(C.emplaceBack(Io[2*oe+0],Io[2*oe+1],W*Rt/Vn,Q*Rt/Vn),Hh[oe]=++R),Hh[oe]-1}function $(W,Q,oe,ce,fe,me){const _e=W+oe>>1,Pe=Q+ce>>1;if(Math.abs(W-fe)+Math.abs(Q-me)>1&&Ts[Pe*Mo+_e])$(fe,me,W,Q,_e,Pe),$(oe,ce,fe,me,_e,Pe);else{const Me=N(W,Q),He=N(oe,ce),qe=N(fe,me);I.emplaceBack(Me,He,qe)}}return $(0,0,Vn,Vn,Vn,0),$(Vn,Vn,0,0,0,Vn),{vertices:C,indices:I}}(this.tileID.canonical,i);c=p.vertices,u=p.indices}else{c=new ll,u=new kn;for(const{x:g,y:x}of o)c.emplaceBack(g,x,0,0);const p=Mh(c.int16,void 0,4);for(let g=0;g<p.length;g+=3)u.emplaceBack(p[g],p[g+1],p[g+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,hp.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(u),this._tileBoundsSegments=Yr.simpleSegment(0,0,c.length,u.length)}}const xb=Nr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),bb=Nr([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Eg}=xb;function da(t,e){const i=t.fovAboveCenter,o=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-o)/Math.cos(t._pitch),u=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),p=Math.sin(t._pitch)*u+c;return Math.min(1.01*p,c*(1/t._horizonShift))}const fp=Rt/Math.PI/2,dn=-fp,fn=fp,wb=[new Qn([dn,dn,dn],[fn,fn,fn]),new Qn([dn,dn,dn],[0,0,fn]),new Qn([0,dn,dn],[fn,0,fn]),new Qn([dn,0,dn],[0,fn,fn]),new Qn([0,0,dn],[fn,fn,fn])];function Kh(t){if(t.z<=1)return wb[t.z+2*t.y+t.x];const[e,i]=Sg(t),o=[Yh(e[0],e[1]),Yh(e[0],i[1]),Yh(i[0],e[1]),Yh(i[0],i[1])],c=[fn,fn,fn],u=[dn,dn,dn];for(const p of o)c[0]=Math.min(c[0],p[0]),c[1]=Math.min(c[1],p[1]),c[2]=Math.min(c[2],p[2]),u[0]=Math.max(u[0],p[0]),u[1]=Math.max(u[1],p[1]),u[2]=Math.max(u[2],p[2]);return new Qn(c,u)}function Sg(t){const e=Math.pow(2,t.z),i=t.x/e,o=(t.x+1)/e,c=(t.y+1)/e;return[[jn(t.y/e),qo(i)],[jn(c),qo(o)]]}function pp(t,e,i,o){return i=Ct(i),o||(o=fp),[t*Math.sin(i)*o,-e*o,t*Math.cos(i)*o]}function Yh(t,e,i){return pp(Math.cos(Ct(t)),Math.sin(Ct(t)),e,i)}function Ag(t){return 16383/Math.max(...En([],t.max,t.min))}function Cg(t){const e=Ie(new Float64Array(16)),i=1/Ag(t);return ye(e,e,t.min),Le(e,e,[i,i,i]),e}function Mg(t,e,i){const o=e/(2*Math.PI),c=function(p){const g=Rt/(2*Math.PI);return p/(2*Math.PI)/g}(e);if(!i){const p=Vt(t.center.lat,-85.051129,So);i=[hl(t.center.lng)*e,dl(p)*e]}const u=Ie(new Float64Array(16));return ye(u,u,[i[0],i[1],-o]),Le(u,u,[c,c,c]),Re(u,u,Ct(-t._center.lat)),xe(u,u,Ct(-t._center.lng)),u}class mp{constructor(e){const i=this._createGridIndices();this.gridIndexBuffer=e.createIndexBuffer(i,!0),this.gridSegments=Yr.simpleSegment(0,0,4225,8192);const o=this._createPoleTriangleIndices();this.poleIndexBuffer=e.createIndexBuffer(o,!0),this.poleSegments=Yr.simpleSegment(0,0,66,64);const c=new zc;c.emplaceBack(-1,1,1,0,0,0,0),c.emplaceBack(1,1,1,0,0,1,0),c.emplaceBack(1,-1,1,0,0,1,1),c.emplaceBack(-1,-1,1,0,0,0,1);const u=new kn;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.atmosphereVertexBuffer=e.createVertexBuffer(c,bb.members),this.atmosphereIndexBuffer=e.createIndexBuffer(u),this.atmosphereSegments=Yr.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(e,i,o){const c=new zc,u=i/Math.PI/2;c.emplaceBack(0,-u,0,0,0,.5,o?0:1);const p=360/e,g=Math.cos(Ct(85)),x=Math.sin(Ct(85));for(let A=0;A<=64;A++){const C=A/64,I=pp(g,x,0*(1-(T=C))+p*T,u);c.emplaceBack(I[0],I[1],I[2],0,0,C,o?0:1)}var T;return c}_createPoleTriangleIndices(){const e=new kn;for(let i=0;i<=64;i++)e.emplaceBack(0,i+1,i+2);return e}static createGridVertices(e){const i=Math.pow(2,e.z),o=(x,T,A)=>x*(1-A)+T*A,[c,u]=Sg(e),p=new zc,g=function(x){const T=Ie(new Float64Array(16)),A=Ag(x);var C,I;return Le(T,T,[A,A,A]),ye(T,T,((C=[])[0]=-(I=x.min)[0],C[1]=-I[1],C[2]=-I[2],C)),T}(Kh(e));p.reserve(4096);for(let x=0;x<65;x++){const T=o(c[0],u[0],x/64),A=dl(T),C=A*i-e.y,I=Math.sin(Ct(T)),R=Math.cos(Ct(T));for(let N=0;N<65;N++){const $=N/64,W=o(c[1],u[1],$),Q=pp(R,I,W);Tt(Q,Q,g);const oe=hl(W);p.emplaceBack(Q[0],Q[1],Q[2],oe,A,$,C)}}return p}_createGridIndices(){const e=new kn,i=(o,c)=>{const u=65*c+o;e.emplaceBack(u+1,u,u+65),e.emplaceBack(u+65,u+65+1,u+1)};for(let o=0;o<64;o++)for(let c=0;c<64;c++)i(c,o);return e}getWirefameBuffer(e){if(!this.wireframeSegments){const i=this._createWireframeGrid();this.wireframeIndexBuffer=e.createIndexBuffer(i),this.wireframeSegments=Yr.simpleSegment(0,0,4096,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const e=new ms,i=(o,c)=>{const u=65*c+o;e.emplaceBack(u,u+1),e.emplaceBack(u,u+65),e.emplaceBack(u,u+65+1)};for(let o=0;o<64;o++)for(let c=0;c<64;c++)i(c,o);return e}}function El(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),o=t.x*i,c=(t.x+1)*i,u=t.y*i,p=(t.y+1)*i,g=qo(o),x=qo(c),T=jn(u),A=jn(p),C=e.project(g,T),I=e.project(x,T),R=e.project(x,A),N=e.project(g,A);let $=Math.min(C.x,I.x,R.x,N.x),W=Math.min(C.y,I.y,R.y,N.y),Q=Math.max(C.x,I.x,R.x,N.x),oe=Math.max(C.y,I.y,R.y,N.y);const ce=i/16;function fe(_e,Pe,Me,He,qe,ze){const Ze=(Me+qe)/2,Ke=(He+ze)/2,Fe=e.project(qo(Ze),jn(Ke)),tt=Math.max(0,$-Fe.x,W-Fe.y,Fe.x-Q,Fe.y-oe);$=Math.min($,Fe.x),Q=Math.max(Q,Fe.x),W=Math.min(W,Fe.y),oe=Math.max(oe,Fe.y),tt>ce&&(fe(_e,Fe,Me,He,Ze,Ke),fe(Fe,Pe,Ze,Ke,qe,ze))}fe(C,I,o,u,c,u),fe(I,R,c,u,c,p),fe(R,N,c,p,o,p),fe(N,C,o,p,o,u),$-=ce,W-=ce,Q+=ce,oe+=ce;const me=1/Math.max(Q-$,oe-W);return{scale:me,x:$*me,y:W*me,x2:Q*me,y2:oe*me,projection:e}}class Ig{constructor(e){const i={},o=[];for(const g in e){const x=e[g],T=i[g]={};for(const A in x.glyphs){const C=x.glyphs[+A];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const I=C.metrics.localGlyph?2:1,R={x:0,y:0,w:C.bitmap.width+2*I,h:C.bitmap.height+2*I};o.push(R),T[A]=R}}const{w:c,h:u}=qf(o),p=new gs({width:c||1,height:u||1});for(const g in e){const x=e[g];for(const T in x.glyphs){const A=x.glyphs[+T];if(!A||A.bitmap.width===0||A.bitmap.height===0)continue;const C=i[g][T],I=A.metrics.localGlyph?2:1;gs.copy(A.bitmap,p,{x:0,y:0},{x:C.x+I,y:C.y+I},A.bitmap)}}this.image=p,this.positions=i}}rt("GlyphAtlas",Ig);class Tb{constructor(e){this.tileID=new Xi(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=El(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,o,c,u){this.status="parsing",this.data=e,this.collisionBoxArray=new Ef;const p=new lg(Object.keys(e.layers).sort()),g=new xg(this.tileID,this.promoteId);g.bucketLayerIDs=[];const x={},T=new op(256,256),A={featureIndex:g,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:T,availableImages:o},C=i.familiesBySource[this.source];for(const me in C){const _e=e.layers[me];if(!_e)continue;let Pe=!1,Me=!1;for(const ze of C[me])ze[0].type==="symbol"?Pe=!0:Me=!0;if(this.isSymbolTile===!0&&!Pe||this.isSymbolTile===!1&&!Me)continue;_e.version===1&&Je(`Vector tile source "${this.source}" layer "${me}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const He=p.encode(me),qe=[];for(let ze=0;ze<_e.length;ze++){const Ze=_e.feature(ze),Ke=g.getId(Ze,me);qe.push({feature:Ze,id:Ke,index:ze,sourceLayerIndex:He})}for(const ze of C[me]){const Ze=ze[0];this.isSymbolTile!==void 0&&Ze.type==="symbol"!==this.isSymbolTile||Ze.minzoom&&this.zoom<Math.floor(Ze.minzoom)||Ze.maxzoom&&this.zoom>=Ze.maxzoom||Ze.visibility!=="none"&&(_p(ze,this.zoom,o),(x[Ze.id]=Ze.createBucket({index:g.bucketLayerIDs.length,layers:ze,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:He,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:o})).populate(qe,A,this.tileID.canonical,this.tileTransform),g.bucketLayerIDs.push(ze.map(Ke=>Ke.id)))}}let I,R,N,$;T.trim();const W={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Q=Vi(A.glyphDependencies,me=>Object.keys(me).map(Number));Object.keys(Q).length?c.send("getGlyphs",{uid:this.uid,stacks:Q},(me,_e)=>{I||(I=me,R=_e,fe.call(this))},void 0,!1,W):R={};const oe=Object.keys(A.iconDependencies);oe.length?c.send("getImages",{icons:oe,source:this.source,tileID:this.tileID,type:"icons"},(me,_e)=>{I||(I=me,N=_e,fe.call(this))},void 0,!1,W):N={};const ce=Object.keys(A.patternDependencies);function fe(){if(I)return u(I);if(R&&N&&$){const me=new Ig(R),_e=new R_(N,$);for(const Pe in x){const Me=x[Pe];Me instanceof xs?(_p(Me.layers,this.zoom,o),tb(Me,R,me.positions,N,_e.iconPositions,this.showCollisionBoxes,o,this.tileID.canonical,this.tileZoom,this.projection),Me.projection=this.projection.name):Me.hasPattern&&(Me instanceof Lh||Me instanceof Dh||Me instanceof Vf)&&(_p(Me.layers,this.zoom,o),Me.addFeatures(A,this.tileID.canonical,_e.patternPositions,o))}this.status="done",u(null,{buckets:yi(x).filter(Pe=>!Pe.isEmpty()),featureIndex:g,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:me.image,lineAtlas:T,imageAtlas:_e,glyphMap:this.returnDependencies?R:null,iconMap:this.returnDependencies?N:null,glyphPositions:this.returnDependencies?me.positions:null})}}ce.length?c.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"patterns"},(me,_e)=>{I||(I=me,$=_e,fe.call(this))},void 0,!1,W):$={},fe.call(this)}}function _p(t,e,i){const o=new bt(e);for(const c of t)c.recalculate(o,i)}class kg{constructor(e){this.entries={},this.scheduler=e}request(e,i,o,c){const u=this.entries[e]=this.entries[e]||{callbacks:[]};if(u.result){const[p,g]=u.result;return this.scheduler?this.scheduler.add(()=>{c(p,g)},i):c(p,g),()=>{}}return u.callbacks.push(c),u.cancel||(u.cancel=o((p,g)=>{u.result=[p,g];for(const x of u.callbacks)this.scheduler?this.scheduler.add(()=>{x(p,g)},i):x(p,g);setTimeout(()=>delete this.entries[e],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(p=>p!==c),u.callbacks.length||(u.cancel(),delete this.entries[e]))}}}function zg(t,e,i){const o=JSON.stringify(t.request);return t.data&&(this.deduped.entries[o]={result:[null,t.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{const u=Ls(t.request,(p,g,x,T)=>{p?c(p):g&&c(null,{vectorTile:i?void 0:new ua.VectorTile(new jc(g)),rawData:g,cacheControl:x,expires:T})});return()=>{u.cancel(),c()}},e)}const Eb=Ie(new Float64Array(16));class fa{constructor(e,i){this._tr=e,this._worldSize=i}createInversionMatrix(){return Eb}createTileMatrix(e){let i,o,c;const u=e.canonical,p=Ie(new Float64Array(16)),g=this._tr.projection;if(g.isReprojectedInTileSpace){const x=El(u,g);i=1,o=x.x+e.wrap*x.scale,c=x.y,Le(p,p,[i/x.scale,i/x.scale,this._tr.pixelsPerMeter/this._worldSize])}else i=this._worldSize/this._tr.zoomScale(u.z),o=(u.x+Math.pow(2,u.z)*e.wrap)*i,c=u.y*i;return ye(p,p,[o,c,0]),Le(p,p,[i/Rt,i/Rt,1]),p}pointCoordinate(e,i,o){const c=this._tr.horizonLineFromTop(!1),u=new j(e,Math.max(c,i));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(u,o))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var Sb={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&co(this.parallels,this.constants.parallels))return;const t=Math.sin(Ct(this.parallels[0])),e=(t+Math.sin(Ct(this.parallels[1])))/2,i=1+t*(2*e-t),o=Math.sqrt(i)/e;this.constants={n:e,c:i,r0:o,parallels:this.parallels}},project(t,e){this.initializeConstants();const i=Ct(t-this.center[0]),o=Ct(e),{n:c,c:u,r0:p}=this.constants,g=Math.sqrt(u-2*c*Math.sin(o))/c;return{x:g*Math.sin(i*c),y:g*Math.cos(i*c)-p,z:0}},unproject(t,e){this.initializeConstants();const{n:i,c:o,r0:c}=this.constants,u=c+e;let p=Math.atan2(t,Math.abs(u))*Math.sign(u);u*i<0&&(p-=Math.PI*Math.sign(t)*Math.sign(u));const g=Ct(this.center[0])*i;p=wi(p,-Math.PI-g,Math.PI-g);const x=Gr(p/i)+this.center[0],T=Math.asin(Vt((o-(t*t+u*u)*i*i)/(2*i),-1,1)),A=Vt(Gr(T),-85.051129,So);return new mr(x,A)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Jn(1,t)*e,farthestPixelDistance(t){return da(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new fa(t,e)};const qc=1.340264,Zc=-.081106,Wc=893e-6,Xc=.003796,Jh=Math.sqrt(3)/2;var Ab={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const i=Math.asin(Jh*Math.sin(e)),o=i*i,c=o*o*o;return{x:.5*(t*Math.cos(i)/(Jh*(qc+3*Zc*o+c*(7*Wc+9*Xc*o)))/Math.PI+.5),y:1-.5*(i*(qc+Zc*o+c*(Wc+Xc*o))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,o=i*i,c=o*o*o;for(let T,A,C,I=0;I<12&&(A=i*(qc+Zc*o+c*(Wc+Xc*o))-e,C=qc+3*Zc*o+c*(7*Wc+9*Xc*o),T=A/C,i=Vt(i-T,-Math.PI/3,Math.PI/3),o=i*i,c=o*o*o,!(Math.abs(T)<1e-12));++I);const u=Jh*t*(qc+3*Zc*o+c*(7*Wc+9*Xc*o))/Math.cos(i),p=Math.asin(Math.sin(i)/Jh),g=Vt(180*u/Math.PI,-180,180),x=Vt(180*p/Math.PI,-85.051129,So);return new mr(g,x)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Jn(1,t)*e,farthestPixelDistance(t){return da(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new fa(t,e)},Cb={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(t,e)=>({x:.5+t/360,y:.5-e/360,z:0}),unproject(t,e){const i=360*(t-.5),o=Vt(360*(.5-e),-85.051129,So);return new mr(i,o)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Jn(1,t)*e,farthestPixelDistance(t){return da(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new fa(t,e)};const Sl=Math.PI/2;function Qh(t){return Math.tan((Sl+t)/2)}var Mb={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&co(this.parallels,this.constants.parallels))return;const t=Ct(this.parallels[0]),e=Ct(this.parallels[1]),i=Math.cos(t),o=t===e?Math.sin(t):Math.log(i/Math.cos(e))/Math.log(Qh(e)/Qh(t)),c=i*Math.pow(Qh(t),o)/o;this.constants={n:o,f:c,parallels:this.parallels}},project(t,e){this.initializeConstants(),e=Ct(e),t=Ct(t-this.center[0]);const i=1e-6,{n:o,f:c}=this.constants;c>0?e<-Sl+i&&(e=-Sl+i):e>Sl-i&&(e=Sl-i);const u=c/Math.pow(Qh(e),o),p=u*Math.sin(o*t),g=c-u*Math.cos(o*t);return{x:.5*(p/Math.PI+.5),y:1-.5*(g/Math.PI+.5),z:0}},unproject(t,e){this.initializeConstants(),t=(2*t-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:i,f:o}=this.constants,c=o-e,u=Math.sign(c),p=Math.sign(i)*Math.sqrt(t*t+c*c);let g=Math.atan2(t,Math.abs(c))*u;c*i<0&&(g-=Math.PI*Math.sign(t)*u);const x=Vt(Gr(g/i)+this.center[0],-180,180),T=Vt(Gr(2*Math.atan(Math.pow(o/p,1/i))-Sl),-85.051129,So);return new mr(x,T)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Jn(1,t)*e,farthestPixelDistance(t){return da(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new fa(t,e)},Ib={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(t,e)=>({x:hl(t),y:dl(e),z:0}),unproject(t,e){const i=qo(t),o=jn(e);return new mr(i,o)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Jn(1,t)*e,farthestPixelDistance(t){return da(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new fa(t,e)};const Pg=Ct(So);var kb={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(t,e){const i=(e=Ct(e))*e,o=i*i;return{x:.5*((t=Ct(t))*(.8707-.131979*i+o*(o*(.003971*i-.001529*o)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+i*(.015085+o*(.028874*i-.044475-.005916*o)))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,o=25,c=0,u=i*i;do{u=i*i;const x=u*u;c=(i*(1.007226+u*(.015085+x*(.028874*u-.044475-.005916*x)))-e)/(1.007226+u*(.045255+x*(.259866*u-.311325-.005916*11*x))),i=Vt(i-c,-Pg,Pg)}while(Math.abs(c)>1e-6&&--o>0);u=i*i;const p=Vt(Gr(t/(.8707+u*(u*(u*u*u*(.003971-.001529*u)-.013791)-.131979))),-180,180),g=Gr(i);return new mr(p,g)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Jn(1,t)*e,farthestPixelDistance(t){return da(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new fa(t,e)};const Dg=Ct(So),Lg={albers:Sb,equalEarth:Ab,equirectangular:Cb,lambertConformalConic:Mb,mercator:Ib,naturalEarth:kb,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=Ct(e),t=Ct(t);const i=Math.cos(e),o=2/Math.PI,c=Math.acos(i*Math.cos(t/2)),u=Math.sin(c)/c,p=.5*(t*o+2*i*Math.sin(t/2)/u)||0,g=.5*(e+Math.sin(e)/u)||0;return{x:.5*(p/Math.PI+.5),y:1-.5*(g/Math.PI+1),z:0}},unproject(t,e){let i=t=(2*t-.5)*Math.PI,o=e=(2*(1-e)-1)*Math.PI,c=25;const u=1e-6;let p=0,g=0;do{const x=Math.cos(o),T=Math.sin(o),A=2*T*x,C=T*T,I=x*x,R=Math.cos(i/2),N=Math.sin(i/2),$=2*R*N,W=N*N,Q=1-I*R*R,oe=Q?1/Q:0,ce=Q?Math.acos(x*R)*Math.sqrt(1/Q):0,fe=.5*(2*ce*x*N+2*i/Math.PI)-t,me=.5*(ce*T+o)-e,_e=.5*oe*(I*W+ce*x*R*C)+1/Math.PI,Pe=oe*($*A/4-ce*T*N),Me=.125*oe*(A*N-ce*T*I*$),He=.5*oe*(C*R+ce*W*x)+.5,qe=Pe*Me-He*_e;p=(me*Pe-fe*He)/qe,g=(fe*Me-me*_e)/qe,i=Vt(i-p,-Math.PI,Math.PI),o=Vt(o-g,-Dg,Dg)}while((Math.abs(p)>u||Math.abs(g)>u)&&--c>0);return new mr(Gr(i),Gr(o))},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>Jn(1,t)*e,farthestPixelDistance(t){return da(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new fa(t,e)}};a.ARRAY_TYPE=be,a.AUTH_ERR_MSG=ge,a.Aabb=Qn,a.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},uo(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Dt()?t:G,this.scheduler=new mb}send(t,e,i,o,c=!1,u){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=u,this.callbacks[p]=i);const g=Br(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:t,hasCallback:!!i,targetMapId:o,mustQueue:c,sourceMapId:this.mapId,data:oa(e,g)},g),{cancel:()=>{i&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const o=this.cancelCallbacks[i];delete this.cancelCallbacks[i],o&&o.cancel()}else if(e.mustQueue||Dt()){const o=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),o&&o.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if(e.type==="<response>"){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(To(e.error)):i(null,To(e.data)))}else{const i=Br(this.globalScope)?void 0:[],o=e.hasCallback?(u,p)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:u?oa(u):null,data:oa(p,i)},i)}:u=>{},c=To(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,o);else if(this.parent.getWorkerSource){const u=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,u[0],c.source)[u[1]](c,o)}else o(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=Zh,a.Color=Xt,a.ColorMode=Co,a.CullFaceMode=eo,a.DEMData=Wh,a.DataConstantProperty=nt,a.DedupedRequest=kg,a.DepthMode=Tl,a.EXTENT=Rt,a.Elevation=class{getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){e==null&&(e=null);const o=this._source();if(!o||t.y<0||t.y>1)return e;const c=o.getSource().maxzoom,u=1<<c,p=Math.floor(t.x),g=t.x-p,x=new Xi(c,p,c,Math.floor(g*u),Math.floor(t.y*u)),T=this.findDEMTileFor(x);if(!T||!T.dem)return e;const A=T.dem,C=1<<T.tileID.canonical.z,I=(g*C-T.tileID.canonical.x)*A.dim,R=(t.y*C-T.tileID.canonical.y)*A.dim,N=Math.floor(I),$=Math.floor(R);return(i?this.exaggeration():1)*nr(nr(A.get(N,$),A.get(N,$+1),R-$),nr(A.get(N+1,$),A.get(N+1,$+1),R-$),I-N)}getAtTileOffset(t,e,i){const o=1<<t.canonical.z;return this.getAtPointOrZero(new Sh(t.wrap+(t.canonical.x+e/Rt)/o,(t.canonical.y+i/Rt)/o))}getAtTileOffsetFunc(t,e){return i=>{const o=this.getAtTileOffset(t,i.x,i.y),c=e.upVector(t.canonical,i.x,i.y);return $r(c,c,o*e.upVectorScale(t.canonical)),c}}getForTilePoints(t,e,i,o){const c=Xh.create(this,t,o);return!!c&&(e.forEach(u=>{u[2]=this.exaggeration()*c.getElevationAt(u[0],u[1],i)}),!0)}getMinMaxForTile(t){const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,c=1<<t.canonical.z-o.canonical.z;let u=t.canonical.x/c-o.canonical.x,p=t.canonical.y/c-o.canonical.y,g=0;for(let x=0;x<t.canonical.z-o.canonical.z&&!i.leaves[g];x++){u*=2,p*=2;const T=2*Math.floor(p)+Math.floor(u);g=i.childOffsets[g]+T,u%=1,p%=1}return{min:this.exaggeration()*i.minimums[g],max:this.exaggeration()*i.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=Ia,a.EvaluationParameters=bt,a.Event=fo,a.Evented=po,a.Frustum=Pf,a.GLOBE_ZOOM_THRESHOLD_MAX=6,a.GlobeSharedBuffers=mp,a.GlyphManager=bl,a.ImagePosition=Zf,a.LineAtlas=op,a.LngLat=mr,a.LngLatBounds=la,a.LocalGlyphMode=Kf,a.MAX_MERCATOR_LATITUDE=So,a.MercatorCoordinate=Sh,a.ONE_EM=xi,a.OverscaledTileID=Xi,a.Properties=pi,a.RGBAImage=zn,a.Ray=class{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,i){const o=fr(e,this.dir);if(Math.abs(o)<1e-6)return!1;const c=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1]+(t[2]-this.pos[2])*e[2])/o;return i[0]=this.pos[0]+this.dir[0]*c,i[1]=this.pos[1]+this.dir[1]*c,i[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(t,e,i){if(function(I,R){var N=I[0],$=I[1],W=I[2],Q=R[0],oe=R[1],ce=R[2];return Math.abs(N-Q)<=he*Math.max(1,Math.abs(N),Math.abs(Q))&&Math.abs($-oe)<=he*Math.max(1,Math.abs($),Math.abs(oe))&&Math.abs(W-ce)<=he*Math.max(1,Math.abs(W),Math.abs(ce))}(this.pos,t)||e===0)return i[0]=i[1]=i[2]=0,!1;const[o,c,u]=this.dir,p=this.pos[0]-t[0],g=this.pos[1]-t[1],x=this.pos[2]-t[2],T=o*o+c*c+u*u,A=2*(p*o+g*c+x*u),C=A*A-4*T*(p*p+g*g+x*x-e*e);if(C<0){const I=Math.max(-A/2,0),R=p+o*I,N=g+c*I,$=x+u*I,W=Math.hypot(R,N,$);return i[0]=R*e/W,i[1]=N*e/W,i[2]=$*e/W,!1}{const I=(-A-Math.sqrt(C))/(2*T);if(I<0){const R=Math.hypot(p,g,x);return i[0]=p*e/R,i[1]=g*e/R,i[2]=x*e/R,!1}return i[0]=p+o*I,i[1]=g+c*I,i[2]=x+u*I,!0}}},a.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ue,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!ke(t))return t;const i=lt(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!ke(t))return t;const i=lt(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e){if(!ke(t))return t;const i=lt(t);return i.path=`/v4/${i.authority}.json`,i.params.push("secure"),this._makeAPIURL(i,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,o){const c=lt(t);return ke(t)?(c.path=`/styles/v1${c.path}/sprite${e}${i}`,this._makeAPIURL(c,this._customAccessToken||o)):(c.path+=`${e}${i}`,ut(c))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ke(t))return t;const o=lt(t);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&o.authority!=="raster"&&i===512?"@2x":""}${U.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${D.RASTER_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${D.TILE_URL_VERSION}${o.path}`);const c=this._customAccessToken||function(u){for(const p of u){const g=p.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(o.params)||D.ACCESS_TOKEN;return D.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,c)}canonicalizeTileURL(t,e){const i=lt(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let o="mapbox://";i.path.match(/^\/raster\/v1\//)?o+=`raster/${i.path.replace(`/${D.RASTER_URL_PREFIX}/`,"")}`:o+=`tiles/${i.path.replace(`/${D.TILE_URL_VERSION}/`,"")}`;let c=i.params;return e&&(c=c.filter(u=>!u.match(/^access_token=/))),c.length&&(o+=`?${c.join("&")}`),o}canonicalizeTileset(t,e){const i=!!e&&ke(e),o=[];for(const c of t.tiles||[])Oe(c)?o.push(this.canonicalizeTileURL(c,i)):o.push(c);return o}_makeAPIURL(t,e){const i="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",o=lt(D.API_URL);if(t.protocol=o.protocol,t.authority=o.authority,t.protocol==="http"){const c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if(o.path!=="/"&&(t.path=`${o.path}${t.path}`),!D.REQUIRE_ACCESS_TOKEN)return ut(t);if(e=e||D.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(c=>c.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),ut(t)}},a.ResourceType=Ca,a.SegmentVector=Yr,a.SourceCache=ha,a.StencilMode=lp,a.StructArrayLayout1ui2=vh,a.StructArrayLayout2f1f2i16=gf,a.StructArrayLayout2i4=al,a.StructArrayLayout2ui4=ms,a.StructArrayLayout3f12=cl,a.StructArrayLayout3ui6=kn,a.StructArrayLayout4i8=ll,a.Texture=qh,a.Tile=dp,a.Transitionable=Zi,a.Uniform1f=Th,a.Uniform1i=class extends Vo{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},a.Uniform2f=class extends Vo{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},a.Uniform3f=class extends Vo{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},a.Uniform4f=Hm,a.UniformColor=Km,a.UniformMatrix2f=class extends Vo{constructor(t,e){super(t,e),this.current=b0}set(t){for(let e=0;e<4;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}},a.UniformMatrix3f=class extends Vo{constructor(t,e){super(t,e),this.current=x0}set(t){for(let e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},a.UniformMatrix4f=class extends Vo{constructor(t,e){super(t,e),this.current=v0}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},a.UnwrappedTileID=sp,a.ValidationError=et,a.VectorTileWorkerSource=class extends po{constructor(t,e,i,o,c){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=c||zg,this.loading={},this.loaded={},this.deduped=new kg(t.scheduler),this.isSpriteLoaded=o,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,o=t&&t.request,c=o&&o.collectResourceTiming,u=this.loading[i]=new Tb(t);u.abort=this.loadVectorData(t,(p,g)=>{const x=!this.loading[i];if(delete this.loading[i],x||p||!g)return u.status="done",x||(this.loaded[i]=u),e(p);const T=g.rawData,A={};g.expires&&(A.expires=g.expires),g.cacheControl&&(A.cacheControl=g.cacheControl),u.vectorTile=g.vectorTile||new ua.VectorTile(new jc(T));const C=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(I,R)=>{if(I||!R)return e(I);const N={};if(c){const $=sg(o);$.length>0&&(N.resourceTiming=JSON.parse(JSON.stringify($)))}e(null,Wt({rawTileData:T.slice(0)},R,A,N))})};this.isSpriteLoaded?C():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(C,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):C()}),this.loaded=this.loaded||{},this.loaded[i]=u})}reloadTile(t,e){const i=this.loaded,o=t.uid,c=this;if(i&&i[o]){const u=i[o];u.showCollisionBoxes=t.showCollisionBoxes,u.enableTerrain=!!t.enableTerrain,u.projection=t.projection;const p=(g,x)=>{const T=u.reloadCallback;T&&(delete u.reloadCallback,u.parse(u.vectorTile,c.layerIndex,this.availableImages,c.actor,T)),e(g,x)};u.status==="parsing"?u.reloadCallback=p:u.status==="done"&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}}abortTile(t,e){const i=t.uid,o=this.loading[i];o&&(o.abort&&o.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,o=t.uid;i&&i[o]&&delete i[o],e()}},a.WritingMode=Pn,a.ZoomHistory=d,a.add=wt,a.addDynamicAttributes=ep,a.adjoint=function(t,e){var i=e[0],o=e[1],c=e[2],u=e[3],p=e[4],g=e[5],x=e[6],T=e[7],A=e[8];return t[0]=p*A-g*T,t[1]=c*T-o*A,t[2]=o*g-c*p,t[3]=g*x-u*A,t[4]=i*A-c*x,t[5]=c*u-i*g,t[6]=u*T-p*x,t[7]=o*x-i*T,t[8]=i*p-o*u,t},a.asyncAll=nn,a.bezier=rn,a.bindAll=uo,a.boundsAttributes=hp,a.bufferConvexPolygon=function(t,e){const i=[];for(let o=0;o<t.length;o++){const c=wi(o-1,-1,t.length-1),u=wi(o+1,-1,t.length-1),p=t[o],g=t[u],x=t[c].sub(p).unit(),T=g.sub(p).unit(),A=T.angleWithSep(x.x,x.y),C=x.add(T).unit().mult(-1*e/Math.sin(A/2));i.push(p.add(C))}return i},a.cacheEntryPossiblyAdded=function(t){Aa++,Aa>Ql&&(t.getActor().send("enforceCacheSizeLimit",zu),Aa=0)},a.calculateGlobeMatrix=Mg,a.calculateGlobeMercatorMatrix=function(t){const e=t.worldSize,i=Vt(t.center.lat,-85.051129,So),o=new j(hl(t.center.lng)*e,dl(i)*e),c=Jn(1,t.center.lat)*e,u=t.pixelsPerMeter,p=e/(c/t.pixelsPerMeter),g=Ie(new Float64Array(16));return ye(g,g,[o.x,o.y,0]),Le(g,g,[p,p,u]),g},a.clamp=Vt,a.clearTileCache=function(t){const e=G.caches.delete(qr);t&&e.catch(t).then(()=>t())},a.clipLine=W_,a.clone=function(t){var e=new be(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},a.clone$1=$e,a.collisionCircleLayout=C1,a.config=D,a.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},a.create=function(){var t=new be(16);return be!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},a.create$1=we,a.createExpression=Js,a.createLayout=Nr,a.createStyleLayer=function(t){return t.type==="custom"?new ub(t):new db[t.type](t)},a.cross=Or,a.degToRad=Ct,a.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},a.dot=fr,a.ease=Ln,a.easeCubicInOut=tn,a.emitValidationErrors=ph,a.endsWith=Ti,a.enforceCacheSizeLimit=function(t){Ps(),Gi&&Gi.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-t;o++)e.delete(i[o])})})},a.evaluateSizeForFeature=Rh,a.evaluateSizeForZoom=gl,a.evaluateVariableOffset=J_,a.evented=Di,a.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},a.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},a.exported=Dr,a.exported$1=U,a.extend=Wt,a.extend$1=mo,a.filterObject=ho,a.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},a.fromQuat=function(t,e){var i=e[0],o=e[1],c=e[2],u=e[3],p=i+i,g=o+o,x=c+c,T=i*p,A=o*p,C=o*g,I=c*p,R=c*g,N=c*x,$=u*p,W=u*g,Q=u*x;return t[0]=1-C-N,t[1]=A+Q,t[2]=I-W,t[3]=0,t[4]=A-Q,t[5]=1-T-N,t[6]=R+$,t[7]=0,t[8]=I+W,t[9]=R-$,t[10]=1-T-C,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.fromRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=0,t[3]=-i,t[4]=o,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},a.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},a.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return Ii[e]},a.getAABBPointSquareDist=function(t,e,i){let o=0;for(let c=0;c<2;++c){const u=i?i[c]:0;t[c]>u&&(o+=(t[c]-u)*(t[c]-u)),e[c]<u&&(o+=(u-e[c])*(u-e[c]))}return o},a.getAnchorAlignment=Hf,a.getAnchorJustification=Jf,a.getBounds=function(t){let e=1/0,i=1/0,o=-1/0,c=-1/0;for(const u of t)e=Math.min(e,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),c=Math.max(c,u.y);return{min:new j(e,i),max:new j(o,c)}},a.getColumn=function(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]},a.getImage=Du,a.getJSON=function(t,e){return Sn(Wt(t,{type:"json"}),e)},a.getMapSessionAPI=on,a.getPerformanceMeasurement=sg,a.getProjection=function(t){const e=Lg[t.name];if(!e)throw new Error(`Invalid projection name: ${t.name}`);return e.conic?function(i,o){if(o.parallels&&Math.abs(o.parallels[0]+o.parallels[1])<.01){let c=function(u){const p=Math.max(.01,Math.cos(Ct(u))),g=1/(2*Math.max(Math.PI*p,1/p));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(x,T){const A=Ct(x)*p,C=Math.sin(Ct(T))/p;return{x:A*g+.5,y:-C*g+.5,z:0}},unproject(x,T){const A=-(T-.5)/g,C=Vt(Gr((x-.5)/g)/p,-180,180),I=Math.asin(Vt(A*p,-1,1)),R=Vt(Gr(I),-85.051129,So);return new mr(C,R)}}}(o.parallels[0]);if(o.name==="lambertConformalConic"){const{project:u,unproject:p}=Lg.mercator;c={wrap:!0,supportsWorldCopies:!0,project:u,unproject:p}}return Wt({},i,o,c)}return Wt({},i,o)}(e,t):e},a.getRTLTextPluginStatus=hn,a.getReferrer=tc,a.getTilePoint=function(t,{x:e,y:i},o=0){return new j(((e-o)*t.scale-t.x)*Rt,(i*t.scale-t.y)*Rt)},a.getTileVec3=function(t,e,i=0){return at(((e.x-i)*t.scale-t.x)*Rt,(e.y*t.scale-t.y)*Rt,t_(e.z,e.y))},a.getVideo=function(t,e){const i=G.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<t.length;o++){const c=G.document.createElement("source");Pu(t[o])||(i.crossOrigin="Anonymous"),c.src=t[o],i.appendChild(c)}return{cancel:()=>{}}},a.globeBuffersForTileMesh=function(t,e,i,o){const c=t.context,u=t.transform;let p=e.globeGridBuffer,g=e.globePoleBuffer;if(!p){const x=mp.createGridVertices(i.canonical);p=e.globeGridBuffer=c.createVertexBuffer(x,Eg,!1)}if(!g){const x=mp.createPoleTriangleVertices(o,u.tileSize*o,i.canonical.y===0);g=e.globePoleBuffer=c.createVertexBuffer(x,Eg,!1)}return[p,g]},a.globeDenormalizeECEF=Cg,a.globeMatrixForTile=function(t,e){const i=Cg(Kh(t)),o=((c=new Float64Array(16))[0]=(u=e)[0],c[1]=u[1],c[2]=u[2],c[3]=u[3],c[4]=u[4],c[5]=u[5],c[6]=u[6],c[7]=u[7],c[8]=u[8],c[9]=u[9],c[10]=u[10],c[11]=u[11],c[12]=u[12],c[13]=u[13],c[14]=u[14],c[15]=u[15],c);var c,u;return Se(o,o,i),o},a.globePoleMatrixForTile=function(t,e,i){const o=Ie(new Float64Array(16)),c=Math.pow(2,t.z),u=(t.x-c/2)/c*Math.PI*2,p=i.point,g=i.worldSize/(i.tileSize*c);return ye(o,o,[p.x,p.y,-i.worldSize/Math.PI/2]),Le(o,o,[g,g,g]),Re(o,o,Ct(-i._center.lat)),xe(o,o,Ct(-i._center.lng)),xe(o,o,u),e&&Le(o,o,[1,-1,1]),o},a.globeTileBounds=Kh,a.globeToMercatorTransition=function(t){return ki(5,6,t)},a.identity=Ie,a.identity$1=Lo,a.invert=function(t,e){var i=e[0],o=e[1],c=e[2],u=e[3],p=e[4],g=e[5],x=e[6],T=e[7],A=e[8],C=e[9],I=e[10],R=e[11],N=e[12],$=e[13],W=e[14],Q=e[15],oe=i*g-o*p,ce=i*x-c*p,fe=i*T-u*p,me=o*x-c*g,_e=o*T-u*g,Pe=c*T-u*x,Me=A*$-C*N,He=A*W-I*N,qe=A*Q-R*N,ze=C*W-I*$,Ze=C*Q-R*$,Ke=I*Q-R*W,Fe=oe*Ke-ce*Ze+fe*ze+me*qe-_e*He+Pe*Me;return Fe?(t[0]=(g*Ke-x*Ze+T*ze)*(Fe=1/Fe),t[1]=(c*Ze-o*Ke-u*ze)*Fe,t[2]=($*Pe-W*_e+Q*me)*Fe,t[3]=(I*_e-C*Pe-R*me)*Fe,t[4]=(x*qe-p*Ke-T*He)*Fe,t[5]=(i*Ke-c*qe+u*He)*Fe,t[6]=(W*fe-N*Pe-Q*ce)*Fe,t[7]=(A*Pe-I*fe+R*ce)*Fe,t[8]=(p*Ze-g*qe+T*Me)*Fe,t[9]=(o*qe-i*Ze-u*Me)*Fe,t[10]=(N*_e-$*fe+Q*oe)*Fe,t[11]=(C*fe-A*_e-R*oe)*Fe,t[12]=(g*He-p*ze-x*Me)*Fe,t[13]=(i*ze-o*He+c*Me)*Fe,t[14]=($*ce-N*me-W*oe)*Fe,t[15]=(A*me-C*ce+I*oe)*Fe,t):null},a.isMapAuthenticated=function(t){return sn.has(t)},a.isMapboxURL=ke,a.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Br(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=jn,a.len=Dn,a.length=it,a.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},a.loadVectorTile=zg,a.makeRequest=Sn,a.mercatorXfromLng=hl,a.mercatorYfromLat=dl,a.mercatorZfromAltitude=Jn,a.mul=Se,a.mul$1=Do,a.multiply=function(t,e,i){var o=e[0],c=e[1],u=e[2],p=e[3],g=e[4],x=e[5],T=e[6],A=e[7],C=e[8],I=i[0],R=i[1],N=i[2],$=i[3],W=i[4],Q=i[5],oe=i[6],ce=i[7],fe=i[8];return t[0]=I*o+R*p+N*T,t[1]=I*c+R*g+N*A,t[2]=I*u+R*x+N*C,t[3]=$*o+W*p+Q*T,t[4]=$*c+W*g+Q*A,t[5]=$*u+W*x+Q*C,t[6]=oe*o+ce*p+fe*T,t[7]=oe*c+ce*g+fe*A,t[8]=oe*u+ce*x+fe*C,t},a.multiply$1=E,a.multiply$2=Sr,a.nextPowerOfTwo=Tr,a.normalize=At,a.normalize$1=function(t,e){var i=e[0],o=e[1],c=e[2],u=e[3],p=i*i+o*o+c*c+u*u;return p>0&&(p=1/Math.sqrt(p)),t[0]=i*p,t[1]=o*p,t[2]=c*p,t[3]=u*p,t},a.number=nr,a.ortho=function(t,e,i,o,c,u,p){var g=1/(e-i),x=1/(o-c),T=1/(u-p);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*T,t[11]=0,t[12]=(e+i)*g,t[13]=(c+o)*x,t[14]=(p+u)*T,t[15]=1,t},a.pbf=jc,a.perspective=function(t,e,i,o,c){var u,p=1/Math.tan(e/2);return t[0]=p/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(t[10]=(c+o)*(u=1/(o-c)),t[14]=2*c*o*u):(t[10]=-1,t[14]=-2*o),t},a.pick=function(t,e){const i={};for(let o=0;o<e.length;o++){const c=e[o];c in t&&(i[c]=t[c])}return i},a.plugin=$t,a.pointGeometry=j,a.polygonIntersectsBox=a_,a.polygonIntersectsPolygon=i_,a.polygonizeBounds=function(t,e,i=0,o=!0){const c=new j(i,i),u=t.sub(c),p=e.add(c),g=[u,new j(p.x,u.y),p,new j(u.x,p.y)];return o&&g.push(u),g},a.posAttributes=vb,a.postMapLoadEvent=sr,a.postTurnstileEvent=ir,a.potpack=qf,a.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},a.radToDeg=Gr,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(t){return t({pluginStatus:yt,pluginURL:Lt}),Di.on("pluginStateChange",t),t},a.removeAuthState=function(t){sn.delete(t)},a.renderColorRamp=Rf,a.rotateX=Re,a.rotateX$1=Ro,a.rotateY=xe,a.rotateZ=function(t,e,i){var o=Math.sin(i),c=Math.cos(i),u=e[0],p=e[1],g=e[2],x=e[3],T=e[4],A=e[5],C=e[6],I=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*c+T*o,t[1]=p*c+A*o,t[2]=g*c+C*o,t[3]=x*c+I*o,t[4]=T*c-u*o,t[5]=A*c-p*o,t[6]=C*c-g*o,t[7]=I*c-x*o,t},a.rotateZ$1=function(t,e,i){i*=.5;var o=e[0],c=e[1],u=e[2],p=e[3],g=Math.sin(i),x=Math.cos(i);return t[0]=o*x+c*g,t[1]=c*x-o*g,t[2]=u*x+p*g,t[3]=p*x-u*g,t},a.scale=Le,a.scale$1=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},a.scale$2=$r,a.scaleAndAdd=Zt,a.setCacheLimits=function(t,e){zu=t,Ql=e},a.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},a.setRTLTextPlugin=function(t,e,i=!1){if(yt===ft||yt===xt||yt===ar)throw new Error("setRTLTextPlugin cannot be called multiple times.");Lt=Dr.resolveURL(t),yt=ft,vr=e,ti(),i||In()},a.smoothstep=ki,a.spec=Ae,a.storeAuthState=function(t,e){e?sn.add(t):sn.delete(t)},a.sub=En,a.subtract=dr,a.symbolSize=M1,a.tileAABB=function(t,e,i,o,c,u,p,g,x){if(x.name==="globe"){const R=Kh(new sp(u,new Zh(i,o,c)).canonical).getCorners(),N=Number.MAX_VALUE,$=[-N,-N,-N],W=[N,N,N],Q=Mg(t,e);for(let oe=0;oe<R.length;oe++)Tt(R[oe],R[oe],Q),A=W,C=R[oe],(T=W)[0]=Math.min(A[0],C[0]),T[1]=Math.min(A[1],C[1]),T[2]=Math.min(A[2],C[2]),Ut($,$,R[oe]);return new Qn(W,$)}var T,A,C;const I=El({z:i,x:o,y:c},x);return new Qn([(u+I.x/I.scale)*e,e*(I.y/I.scale),p],[(u+I.x2/I.scale)*e,e*(I.y2/I.scale),g])},a.tileTransform=El,a.transformMat3=function(t,e,i){var o=e[0],c=e[1],u=e[2];return t[0]=o*i[0]+c*i[3]+u*i[6],t[1]=o*i[1]+c*i[4]+u*i[7],t[2]=o*i[2]+c*i[5]+u*i[8],t},a.transformMat4=Tt,a.transformMat4$1=gi,a.transformQuat=pr,a.translate=ye,a.transpose=function(t,e){if(t===e){var i=e[1],o=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=o,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},a.triggerPluginCompletionEvent=Mr,a.uniqueId=Rn,a.validateCustomStyleLayer=function(t){const e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateFog=hf,a.validateLight=hs,a.validateStyle=us,a.values=yi,a.vectorTile=ua,a.version=L,a.warnOnce=Je,a.window=G,a.wrap=wi}),b(["./shared"],function(a){function L(J){const D=typeof J;if(D==="number"||D==="boolean"||D==="string"||J==null)return JSON.stringify(J);if(Array.isArray(J)){let ee="[";for(const le of J)ee+=`${L(le)},`;return`${ee}]`}const U=Object.keys(J).sort();let H="{";for(let ee=0;ee<U.length;ee++)H+=`${JSON.stringify(U[ee])}:${L(J[U[ee]])},`;return`${H}}`}function F(J){let D="";for(const U of a.refProperties)D+=`/${L(J[U])}`;return D}class B{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,U){for(const ee of D)this._layerConfigs[ee.id]=ee,(this._layers[ee.id]=a.createStyleLayer(ee)).compileFilter(),this.keyCache[ee.id]&&delete this.keyCache[ee.id];for(const ee of U)delete this.keyCache[ee],delete this._layerConfigs[ee],delete this._layers[ee];this.familiesBySource={};const H=function(ee,le){const de={};for(let ue=0;ue<ee.length;ue++){const ge=le&&le[ee[ue].id]||F(ee[ue]);le&&(le[ee[ue].id]=ge);let ke=de[ge];ke||(ke=de[ge]=[]),ke.push(ee[ue])}const pe=[];for(const ue in de)pe.push(de[ue]);return pe}(a.values(this._layerConfigs),this.keyCache);for(const ee of H){const le=ee.map(Oe=>this._layers[Oe.id]),de=le[0];if(de.visibility==="none")continue;const pe=de.source||"";let ue=this.familiesBySource[pe];ue||(ue=this.familiesBySource[pe]={});const ge=de.sourceLayer||"_geojsonTileLayer";let ke=ue[ge];ke||(ke=ue[ge]=[]),ke.push(le)}}}const{ImageBitmap:j}=a.window;class q{loadTile(D,U){const{uid:H,encoding:ee,rawImageData:le,padding:de,buildQuadTree:pe}=D,ue=j&&le instanceof j?this.getImageData(le,de):le;U(null,new a.DEMData(H,ue,ee,de<1,pe))}getImageData(D,U){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(D.width,D.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=D.width,this.offscreenCanvas.height=D.height,this.offscreenCanvasContext.drawImage(D,0,0,D.width,D.height);const H=this.offscreenCanvasContext.getImageData(-U,-U,D.width+2*U,D.height+2*U);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new a.RGBAImage({width:H.width,height:H.height},H.data)}}var G=function J(D,U){var H,ee=D&&D.type;if(ee==="FeatureCollection")for(H=0;H<D.features.length;H++)J(D.features[H],U);else if(ee==="GeometryCollection")for(H=0;H<D.geometries.length;H++)J(D.geometries[H],U);else if(ee==="Feature")J(D.geometry,U);else if(ee==="Polygon")he(D.coordinates,U);else if(ee==="MultiPolygon")for(H=0;H<D.coordinates.length;H++)he(D.coordinates[H],U);return D};function he(J,D){if(J.length!==0){be(J[0],D);for(var U=1;U<J.length;U++)be(J[U],!D)}}function be(J,D){for(var U=0,H=0,ee=0,le=J.length,de=le-1;ee<le;de=ee++){var pe=(J[ee][0]-J[de][0])*(J[de][1]+J[ee][1]),ue=U+pe;H+=Math.abs(U)>=Math.abs(pe)?U-ue+pe:pe-ue+U,U=ue}U+H>=0!=!!D&&J.reverse()}const we=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ie{constructor(D){this._feature=D,this.extent=a.EXTENT,this.type=D.type,this.properties=D.tags,"id"in D&&!isNaN(D.id)&&(this.id=parseInt(D.id,10))}loadGeometry(){if(this._feature.type===1){const D=[];for(const U of this._feature.geometry)D.push([new a.pointGeometry(U[0],U[1])]);return D}{const D=[];for(const U of this._feature.geometry){const H=[];for(const ee of U)H.push(new a.pointGeometry(ee[0],ee[1]));D.push(H)}return D}}toGeoJSON(D,U,H){return we.call(this,D,U,H)}}class E{constructor(D){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=D.length,this._features=D}feature(D){return new Ie(this._features[D])}}var ye=a.vectorTile.VectorTileFeature,Le=Re;function Re(J,D){this.options=D||{},this.features=J,this.length=J.length}function xe(J,D){this.id=typeof J.id=="number"?J.id:void 0,this.type=J.type,this.rawGeometry=J.type===1?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=D||4096}Re.prototype.feature=function(J){return new xe(this.features[J],this.options.extent)},xe.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var D=0;D<J.length;D++){for(var U=J[D],H=[],ee=0;ee<U.length;ee++)H.push(new a.pointGeometry(U[ee][0],U[ee][1]));this.geometry.push(H)}return this.geometry},xe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,D=1/0,U=-1/0,H=1/0,ee=-1/0,le=0;le<J.length;le++)for(var de=J[le],pe=0;pe<de.length;pe++){var ue=de[pe];D=Math.min(D,ue.x),U=Math.max(U,ue.x),H=Math.min(H,ue.y),ee=Math.max(ee,ue.y)}return[D,H,U,ee]},xe.prototype.toGeoJSON=ye.prototype.toGeoJSON;var Se=Ye,Be=Le;function Ye(J){var D=new a.pbf;return function(U,H){for(var ee in U.layers)H.writeMessage(3,it,U.layers[ee])}(J,D),D.finish()}function it(J,D){var U;D.writeVarintField(15,J.version||1),D.writeStringField(1,J.name||""),D.writeVarintField(5,J.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<J.length;U++)H.feature=J.feature(U),D.writeMessage(2,at,H);var ee=H.keys;for(U=0;U<ee.length;U++)D.writeStringField(3,ee[U]);var le=H.values;for(U=0;U<le.length;U++)D.writeMessage(4,$r,le[U])}function at(J,D){var U=J.feature;U.id!==void 0&&D.writeVarintField(1,U.id),D.writeMessage(2,wt,J),D.writeVarintField(3,U.type),D.writeMessage(4,Ut,U)}function wt(J,D){var U=J.feature,H=J.keys,ee=J.values,le=J.keycache,de=J.valuecache;for(var pe in U.properties){var ue=U.properties[pe],ge=le[pe];if(ue!==null){ge===void 0&&(H.push(pe),le[pe]=ge=H.length-1),D.writeVarint(ge);var ke=typeof ue;ke!=="string"&&ke!=="boolean"&&ke!=="number"&&(ue=JSON.stringify(ue));var Oe=ke+":"+ue,Ue=de[Oe];Ue===void 0&&(ee.push(ue),de[Oe]=Ue=ee.length-1),D.writeVarint(Ue)}}}function dr(J,D){return(D<<3)+(7&J)}function Sr(J){return J<<1^J>>31}function Ut(J,D){for(var U=J.loadGeometry(),H=J.type,ee=0,le=0,de=U.length,pe=0;pe<de;pe++){var ue=U[pe],ge=1;H===1&&(ge=ue.length),D.writeVarint(dr(1,ge));for(var ke=H===3?ue.length-1:ue.length,Oe=0;Oe<ke;Oe++){Oe===1&&H!==1&&D.writeVarint(dr(2,ke-1));var Ue=ue[Oe].x-ee,lt=ue[Oe].y-le;D.writeVarint(Sr(Ue)),D.writeVarint(Sr(lt)),ee+=Ue,le+=lt}H===3&&D.writeVarint(dr(7,1))}}function $r(J,D){var U=typeof J;U==="string"?D.writeStringField(1,J):U==="boolean"?D.writeBooleanField(7,J):U==="number"&&(J%1!=0?D.writeDoubleField(3,J):J<0?D.writeSVarintField(6,J):D.writeVarintField(5,J))}function Zt(J,D,U,H,ee,le){if(ee-H<=U)return;const de=H+ee>>1;At(J,D,de,H,ee,le%2),Zt(J,D,U,H,de-1,le+1),Zt(J,D,U,de+1,ee,le+1)}function At(J,D,U,H,ee,le){for(;ee>H;){if(ee-H>600){const ge=ee-H+1,ke=U-H+1,Oe=Math.log(ge),Ue=.5*Math.exp(2*Oe/3),lt=.5*Math.sqrt(Oe*Ue*(ge-Ue)/ge)*(ke-ge/2<0?-1:1);At(J,D,U,Math.max(H,Math.floor(U-ke*Ue/ge+lt)),Math.min(ee,Math.floor(U+(ge-ke)*Ue/ge+lt)),le)}const de=D[2*U+le];let pe=H,ue=ee;for(fr(J,D,H,U),D[2*ee+le]>de&&fr(J,D,H,ee);pe<ue;){for(fr(J,D,pe,ue),pe++,ue--;D[2*pe+le]<de;)pe++;for(;D[2*ue+le]>de;)ue--}D[2*H+le]===de?fr(J,D,H,ue):(ue++,fr(J,D,ue,ee)),ue<=U&&(H=ue+1),U<=ue&&(ee=ue-1)}}function fr(J,D,U,H){Or(J,U,H),Or(D,2*U,2*H),Or(D,2*U+1,2*H+1)}function Or(J,D,U){const H=J[D];J[D]=J[U],J[U]=H}function Tt(J,D,U,H){const ee=J-U,le=D-H;return ee*ee+le*le}Se.fromVectorTileJs=Ye,Se.fromGeojsonVt=function(J,D){D=D||{};var U={};for(var H in J)U[H]=new Le(J[H].features,D),U[H].name=H,U[H].version=D.version,U[H].extent=D.extent;return Ye({layers:U})},Se.GeoJSONWrapper=Be;const pr=J=>J[0],Ui=J=>J[1];class En{constructor(D,U=pr,H=Ui,ee=64,le=Float64Array){this.nodeSize=ee,this.points=D;const de=D.length<65536?Uint16Array:Uint32Array,pe=this.ids=new de(D.length),ue=this.coords=new le(2*D.length);for(let ge=0;ge<D.length;ge++)pe[ge]=ge,ue[2*ge]=U(D[ge]),ue[2*ge+1]=H(D[ge]);Zt(pe,ue,ee,0,pe.length-1,0)}range(D,U,H,ee){return function(le,de,pe,ue,ge,ke,Oe){const Ue=[0,le.length-1,0],lt=[];let ut,ht;for(;Ue.length;){const dt=Ue.pop(),Mt=Ue.pop(),ir=Ue.pop();if(Mt-ir<=Oe){for(let yr=ir;yr<=Mt;yr++)ut=de[2*yr],ht=de[2*yr+1],ut>=pe&&ut<=ge&&ht>=ue&&ht<=ke&&lt.push(le[yr]);continue}const cr=Math.floor((ir+Mt)/2);ut=de[2*cr],ht=de[2*cr+1],ut>=pe&&ut<=ge&&ht>=ue&&ht<=ke&&lt.push(le[cr]);const sr=(dt+1)%2;(dt===0?pe<=ut:ue<=ht)&&(Ue.push(ir),Ue.push(cr-1),Ue.push(sr)),(dt===0?ge>=ut:ke>=ht)&&(Ue.push(cr+1),Ue.push(Mt),Ue.push(sr))}return lt}(this.ids,this.coords,D,U,H,ee,this.nodeSize)}within(D,U,H){return function(ee,le,de,pe,ue,ge){const ke=[0,ee.length-1,0],Oe=[],Ue=ue*ue;for(;ke.length;){const lt=ke.pop(),ut=ke.pop(),ht=ke.pop();if(ut-ht<=ge){for(let sr=ht;sr<=ut;sr++)Tt(le[2*sr],le[2*sr+1],de,pe)<=Ue&&Oe.push(ee[sr]);continue}const dt=Math.floor((ht+ut)/2),Mt=le[2*dt],ir=le[2*dt+1];Tt(Mt,ir,de,pe)<=Ue&&Oe.push(ee[dt]);const cr=(lt+1)%2;(lt===0?de-ue<=Mt:pe-ue<=ir)&&(ke.push(ht),ke.push(dt-1),ke.push(cr)),(lt===0?de+ue>=Mt:pe+ue>=ir)&&(ke.push(dt+1),ke.push(ut),ke.push(cr))}return Oe}(this.ids,this.coords,D,U,H,this.nodeSize)}}const Do={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:J=>J},Dn=Math.fround||(gi=new Float32Array(1),J=>(gi[0]=+J,gi[0]));var gi;class lo{constructor(D){this.options=Ii(Object.create(Do),D),this.trees=new Array(this.options.maxZoom+1)}load(D){const{log:U,minZoom:H,maxZoom:ee,nodeSize:le}=this.options;U&&console.time("total time");const de=`prepare ${D.length} points`;U&&console.time(de),this.points=D;let pe=[];for(let ue=0;ue<D.length;ue++)D[ue].geometry&&pe.push(Ro(D[ue],ue));this.trees[ee+1]=new En(pe,tn,rn,le,Float32Array),U&&console.timeEnd(de);for(let ue=ee;ue>=H;ue--){const ge=+Date.now();pe=this._cluster(pe,ue),this.trees[ue]=new En(pe,tn,rn,le,Float32Array),U&&console.log("z%d: %d clusters in %dms",ue,pe.length,+Date.now()-ge)}return U&&console.timeEnd("total time"),this}getClusters(D,U){let H=((D[0]+180)%360+360)%360-180;const ee=Math.max(-90,Math.min(90,D[1]));let le=D[2]===180?180:((D[2]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)H=-180,le=180;else if(H>le){const ke=this.getClusters([H,ee,180,de],U),Oe=this.getClusters([-180,ee,le,de],U);return ke.concat(Oe)}const pe=this.trees[this._limitZoom(U)],ue=pe.range(ji(H),Ct(de),ji(le),Ct(ee)),ge=[];for(const ke of ue){const Oe=pe.points[ke];ge.push(Oe.numPoints?co(Oe):this.points[Oe.index])}return ge}getChildren(D){const U=this._getOriginId(D),H=this._getOriginZoom(D),ee="No cluster with the specified id.",le=this.trees[H];if(!le)throw new Error(ee);const de=le.points[U];if(!de)throw new Error(ee);const pe=this.options.radius/(this.options.extent*Math.pow(2,H-1)),ue=le.within(de.x,de.y,pe),ge=[];for(const ke of ue){const Oe=le.points[ke];Oe.parentId===D&&ge.push(Oe.numPoints?co(Oe):this.points[Oe.index])}if(ge.length===0)throw new Error(ee);return ge}getLeaves(D,U,H){const ee=[];return this._appendLeaves(ee,D,U=U||10,H=H||0,0),ee}getTile(D,U,H){const ee=this.trees[this._limitZoom(D)],le=Math.pow(2,D),{extent:de,radius:pe}=this.options,ue=pe/de,ge=(H-ue)/le,ke=(H+1+ue)/le,Oe={features:[]};return this._addTileFeatures(ee.range((U-ue)/le,ge,(U+1+ue)/le,ke),ee.points,U,H,le,Oe),U===0&&this._addTileFeatures(ee.range(1-ue/le,ge,1,ke),ee.points,le,H,le,Oe),U===le-1&&this._addTileFeatures(ee.range(0,ge,ue/le,ke),ee.points,-1,H,le,Oe),Oe.features.length?Oe:null}getClusterExpansionZoom(D){let U=this._getOriginZoom(D)-1;for(;U<=this.options.maxZoom;){const H=this.getChildren(D);if(U++,H.length!==1)break;D=H[0].properties.cluster_id}return U}_appendLeaves(D,U,H,ee,le){const de=this.getChildren(U);for(const pe of de){const ue=pe.properties;if(ue&&ue.cluster?le+ue.point_count<=ee?le+=ue.point_count:le=this._appendLeaves(D,ue.cluster_id,H,ee,le):le<ee?le++:D.push(pe),D.length===H)break}return le}_addTileFeatures(D,U,H,ee,le,de){for(const pe of D){const ue=U[pe],ge=ue.numPoints;let ke,Oe,Ue;if(ge)ke=Mi(ue),Oe=ue.x,Ue=ue.y;else{const ht=this.points[ue.index];ke=ht.properties,Oe=ji(ht.geometry.coordinates[0]),Ue=Ct(ht.geometry.coordinates[1])}const lt={type:1,geometry:[[Math.round(this.options.extent*(Oe*le-H)),Math.round(this.options.extent*(Ue*le-ee))]],tags:ke};let ut;ge?ut=ue.id:this.options.generateId?ut=ue.index:this.points[ue.index].id&&(ut=this.points[ue.index].id),ut!==void 0&&(lt.id=ut),de.features.push(lt)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(+D,this.options.maxZoom+1))}_cluster(D,U){const H=[],{radius:ee,extent:le,reduce:de,minPoints:pe}=this.options,ue=ee/(le*Math.pow(2,U));for(let ge=0;ge<D.length;ge++){const ke=D[ge];if(ke.zoom<=U)continue;ke.zoom=U;const Oe=this.trees[U+1],Ue=Oe.within(ke.x,ke.y,ue),lt=ke.numPoints||1;let ut=lt;for(const ht of Ue){const dt=Oe.points[ht];dt.zoom>U&&(ut+=dt.numPoints||1)}if(ut>lt&&ut>=pe){let ht=ke.x*lt,dt=ke.y*lt,Mt=de&&lt>1?this._map(ke,!0):null;const ir=(ge<<5)+(U+1)+this.points.length;for(const cr of Ue){const sr=Oe.points[cr];if(sr.zoom<=U)continue;sr.zoom=U;const yr=sr.numPoints||1;ht+=sr.x*yr,dt+=sr.y*yr,sr.parentId=ir,de&&(Mt||(Mt=this._map(ke,!0)),de(Mt,this._map(sr)))}ke.parentId=ir,H.push(Lo(ht/ut,dt/ut,ir,ut,Mt))}else if(H.push(ke),ut>1)for(const ht of Ue){const dt=Oe.points[ht];dt.zoom<=U||(dt.zoom=U,H.push(dt))}}return H}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,U){if(D.numPoints)return U?Ii({},D.properties):D.properties;const H=this.points[D.index].properties,ee=this.options.map(H);return U&&ee===H?Ii({},ee):ee}}function Lo(J,D,U,H,ee){return{x:Dn(J),y:Dn(D),zoom:1/0,id:U,parentId:-1,numPoints:H,properties:ee}}function Ro(J,D){const[U,H]=J.geometry.coordinates;return{x:Dn(ji(U)),y:Dn(Ct(H)),zoom:1/0,index:D,parentId:-1}}function co(J){return{type:"Feature",id:J.id,properties:Mi(J),geometry:{type:"Point",coordinates:[(D=J.x,360*(D-.5)),Gr(J.y)]}};var D}function Mi(J){const D=J.numPoints,U=D>=1e4?`${Math.round(D/1e3)}k`:D>=1e3?Math.round(D/100)/10+"k":D;return Ii(Ii({},J.properties),{cluster:!0,cluster_id:J.id,point_count:D,point_count_abbreviated:U})}function ji(J){return J/360+.5}function Ct(J){const D=Math.sin(J*Math.PI/180),U=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return U<0?0:U>1?1:U}function Gr(J){const D=(180-360*J)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function Ii(J,D){for(const U in D)J[U]=D[U];return J}function tn(J){return J.x}function rn(J){return J.y}function Ln(J,D,U,H){for(var ee,le=H,de=U-D>>1,pe=U-D,ue=J[D],ge=J[D+1],ke=J[U],Oe=J[U+1],Ue=D+3;Ue<U;Ue+=3){var lt=Vt(J[Ue],J[Ue+1],ue,ge,ke,Oe);if(lt>le)ee=Ue,le=lt;else if(lt===le){var ut=Math.abs(Ue-de);ut<pe&&(ee=Ue,pe=ut)}}le>H&&(ee-D>3&&Ln(J,D,ee,H),J[ee+2]=le,U-ee>3&&Ln(J,ee,U,H))}function Vt(J,D,U,H,ee,le){var de=ee-U,pe=le-H;if(de!==0||pe!==0){var ue=((J-U)*de+(D-H)*pe)/(de*de+pe*pe);ue>1?(U=ee,H=le):ue>0&&(U+=de*ue,H+=pe*ue)}return(de=J-U)*de+(pe=D-H)*pe}function ki(J,D,U,H){var ee={id:J===void 0?null:J,type:D,geometry:U,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(le){var de=le.geometry,pe=le.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")wi(le,de);else if(pe==="Polygon"||pe==="MultiLineString")for(var ue=0;ue<de.length;ue++)wi(le,de[ue]);else if(pe==="MultiPolygon")for(ue=0;ue<de.length;ue++)for(var ge=0;ge<de[ue].length;ge++)wi(le,de[ue][ge])}(ee),ee}function wi(J,D){for(var U=0;U<D.length;U+=3)J.minX=Math.min(J.minX,D[U]),J.minY=Math.min(J.minY,D[U+1]),J.maxX=Math.max(J.maxX,D[U]),J.maxY=Math.max(J.maxY,D[U+1])}function nn(J,D,U,H){if(D.geometry){var ee=D.geometry.coordinates,le=D.geometry.type,de=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),pe=[],ue=D.id;if(U.promoteId?ue=D.properties[U.promoteId]:U.generateId&&(ue=H||0),le==="Point")yi(ee,pe);else if(le==="MultiPoint")for(var ge=0;ge<ee.length;ge++)yi(ee[ge],pe);else if(le==="LineString")Wt(ee,pe,de,!1);else if(le==="MultiLineString"){if(U.lineMetrics){for(ge=0;ge<ee.length;ge++)Wt(ee[ge],pe=[],de,!1),J.push(ki(ue,"LineString",pe,D.properties));return}Cr(ee,pe,de,!1)}else if(le==="Polygon")Cr(ee,pe,de,!0);else{if(le!=="MultiPolygon"){if(le==="GeometryCollection"){for(ge=0;ge<D.geometry.geometries.length;ge++)nn(J,{id:ue,geometry:D.geometry.geometries[ge],properties:D.properties},U,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ge=0;ge<ee.length;ge++){var ke=[];Cr(ee[ge],ke,de,!0),pe.push(ke)}}J.push(ki(ue,le,pe,D.properties))}}function yi(J,D){D.push(Rn(J[0])),D.push(vi(J[1])),D.push(0)}function Wt(J,D,U,H){for(var ee,le,de=0,pe=0;pe<J.length;pe++){var ue=Rn(J[pe][0]),ge=vi(J[pe][1]);D.push(ue),D.push(ge),D.push(0),pe>0&&(de+=H?(ee*ge-ue*le)/2:Math.sqrt(Math.pow(ue-ee,2)+Math.pow(ge-le,2))),ee=ue,le=ge}var ke=D.length-3;D[2]=1,Ln(D,0,ke,U),D[ke+2]=1,D.size=Math.abs(de),D.start=0,D.end=D.size}function Cr(J,D,U,H){for(var ee=0;ee<J.length;ee++){var le=[];Wt(J[ee],le,U,H),D.push(le)}}function Rn(J){return J/360+.5}function vi(J){var D=Math.sin(J*Math.PI/180),U=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return U<0?0:U>1?1:U}function Tr(J,D,U,H,ee,le,de,pe){if(H/=D,le>=(U/=D)&&de<H)return J;if(de<U||le>=H)return null;for(var ue=[],ge=0;ge<J.length;ge++){var ke=J[ge],Oe=ke.geometry,Ue=ke.type,lt=ee===0?ke.minX:ke.minY,ut=ee===0?ke.maxX:ke.maxY;if(lt>=U&&ut<H)ue.push(ke);else if(!(ut<U||lt>=H)){var ht=[];if(Ue==="Point"||Ue==="MultiPoint")Oo(Oe,ht,U,H,ee);else if(Ue==="LineString")uo(Oe,ht,U,H,ee,!1,pe.lineMetrics);else if(Ue==="MultiLineString")Vi(Oe,ht,U,H,ee,!1);else if(Ue==="Polygon")Vi(Oe,ht,U,H,ee,!0);else if(Ue==="MultiPolygon")for(var dt=0;dt<Oe.length;dt++){var Mt=[];Vi(Oe[dt],Mt,U,H,ee,!0),Mt.length&&ht.push(Mt)}if(ht.length){if(pe.lineMetrics&&Ue==="LineString"){for(dt=0;dt<ht.length;dt++)ue.push(ki(ke.id,Ue,ht[dt],ke.tags));continue}Ue!=="LineString"&&Ue!=="MultiLineString"||(ht.length===1?(Ue="LineString",ht=ht[0]):Ue="MultiLineString"),Ue!=="Point"&&Ue!=="MultiPoint"||(Ue=ht.length===3?"Point":"MultiPoint"),ue.push(ki(ke.id,Ue,ht,ke.tags))}}}return ue.length?ue:null}function Oo(J,D,U,H,ee){for(var le=0;le<J.length;le+=3){var de=J[le+ee];de>=U&&de<=H&&(D.push(J[le]),D.push(J[le+1]),D.push(J[le+2]))}}function uo(J,D,U,H,ee,le,de){for(var pe,ue,ge=Ti(J),ke=ee===0?$e:gt,Oe=J.start,Ue=0;Ue<J.length-3;Ue+=3){var lt=J[Ue],ut=J[Ue+1],ht=J[Ue+2],dt=J[Ue+3],Mt=J[Ue+4],ir=ee===0?lt:ut,cr=ee===0?dt:Mt,sr=!1;de&&(pe=Math.sqrt(Math.pow(lt-dt,2)+Math.pow(ut-Mt,2))),ir<U?cr>U&&(ue=ke(ge,lt,ut,dt,Mt,U),de&&(ge.start=Oe+pe*ue)):ir>H?cr<H&&(ue=ke(ge,lt,ut,dt,Mt,H),de&&(ge.start=Oe+pe*ue)):ho(ge,lt,ut,ht),cr<U&&ir>=U&&(ue=ke(ge,lt,ut,dt,Mt,U),sr=!0),cr>H&&ir<=H&&(ue=ke(ge,lt,ut,dt,Mt,H),sr=!0),!le&&sr&&(de&&(ge.end=Oe+pe*ue),D.push(ge),ge=Ti(J)),de&&(Oe+=pe)}var yr=J.length-3;lt=J[yr],ut=J[yr+1],ht=J[yr+2],(ir=ee===0?lt:ut)>=U&&ir<=H&&ho(ge,lt,ut,ht),yr=ge.length-3,le&&yr>=3&&(ge[yr]!==ge[0]||ge[yr+1]!==ge[1])&&ho(ge,ge[0],ge[1],ge[2]),ge.length&&D.push(ge)}function Ti(J){var D=[];return D.size=J.size,D.start=J.start,D.end=J.end,D}function Vi(J,D,U,H,ee,le){for(var de=0;de<J.length;de++)uo(J[de],D,U,H,ee,le,!1)}function ho(J,D,U,H){J.push(D),J.push(U),J.push(H)}function $e(J,D,U,H,ee,le){var de=(le-D)/(H-D);return J.push(le),J.push(U+(ee-U)*de),J.push(1),de}function gt(J,D,U,H,ee,le){var de=(le-U)/(ee-U);return J.push(D+(H-D)*de),J.push(le),J.push(1),de}function Je(J,D){for(var U=[],H=0;H<J.length;H++){var ee,le=J[H],de=le.type;if(de==="Point"||de==="MultiPoint"||de==="LineString")ee=Et(le.geometry,D);else if(de==="MultiLineString"||de==="Polygon"){ee=[];for(var pe=0;pe<le.geometry.length;pe++)ee.push(Et(le.geometry[pe],D))}else if(de==="MultiPolygon")for(ee=[],pe=0;pe<le.geometry.length;pe++){for(var ue=[],ge=0;ge<le.geometry[pe].length;ge++)ue.push(Et(le.geometry[pe][ge],D));ee.push(ue)}U.push(ki(le.id,de,ee,le.tags))}return U}function Et(J,D){var U=[];U.size=J.size,J.start!==void 0&&(U.start=J.start,U.end=J.end);for(var H=0;H<J.length;H+=3)U.push(J[H]+D,J[H+1],J[H+2]);return U}function lr(J,D){if(J.transformed)return J;var U,H,ee,le=1<<J.z,de=J.x,pe=J.y;for(U=0;U<J.features.length;U++){var ue=J.features[U],ge=ue.geometry,ke=ue.type;if(ue.geometry=[],ke===1)for(H=0;H<ge.length;H+=2)ue.geometry.push(Dt(ge[H],ge[H+1],D,le,de,pe));else for(H=0;H<ge.length;H++){var Oe=[];for(ee=0;ee<ge[H].length;ee+=2)Oe.push(Dt(ge[H][ee],ge[H][ee+1],D,le,de,pe));ue.geometry.push(Oe)}}return J.transformed=!0,J}function Dt(J,D,U,H,ee,le){return[Math.round(U*(J*H-ee)),Math.round(U*(D*H-le))]}function er(J,D,U,H,ee){for(var le=D===ee.maxZoom?0:ee.tolerance/((1<<D)*ee.extent),de={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:H,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pe=0;pe<J.length;pe++){de.numFeatures++,tr(de,J[pe],le,ee);var ue=J[pe].minX,ge=J[pe].minY,ke=J[pe].maxX,Oe=J[pe].maxY;ue<de.minX&&(de.minX=ue),ge<de.minY&&(de.minY=ge),ke>de.maxX&&(de.maxX=ke),Oe>de.maxY&&(de.maxY=Oe)}return de}function tr(J,D,U,H){var ee=D.geometry,le=D.type,de=[];if(le==="Point"||le==="MultiPoint")for(var pe=0;pe<ee.length;pe+=3)de.push(ee[pe]),de.push(ee[pe+1]),J.numPoints++,J.numSimplified++;else if(le==="LineString")rr(de,ee,J,U,!1,!1);else if(le==="MultiLineString"||le==="Polygon")for(pe=0;pe<ee.length;pe++)rr(de,ee[pe],J,U,le==="Polygon",pe===0);else if(le==="MultiPolygon")for(var ue=0;ue<ee.length;ue++){var ge=ee[ue];for(pe=0;pe<ge.length;pe++)rr(de,ge[pe],J,U,!0,pe===0)}if(de.length){var ke=D.tags||null;if(le==="LineString"&&H.lineMetrics){for(var Oe in ke={},D.tags)ke[Oe]=D.tags[Oe];ke.mapbox_clip_start=ee.start/ee.size,ke.mapbox_clip_end=ee.end/ee.size}var Ue={geometry:de,type:le==="Polygon"||le==="MultiPolygon"?3:le==="LineString"||le==="MultiLineString"?2:1,tags:ke};D.id!==null&&(Ue.id=D.id),J.features.push(Ue)}}function rr(J,D,U,H,ee,le){var de=H*H;if(H>0&&D.size<(ee?de:H))U.numPoints+=D.length/3;else{for(var pe=[],ue=0;ue<D.length;ue+=3)(H===0||D[ue+2]>de)&&(U.numSimplified++,pe.push(D[ue]),pe.push(D[ue+1])),U.numPoints++;ee&&function(ge,ke){for(var Oe=0,Ue=0,lt=ge.length,ut=lt-2;Ue<lt;ut=Ue,Ue+=2)Oe+=(ge[Ue]-ge[ut])*(ge[Ue+1]+ge[ut+1]);if(Oe>0===ke)for(Ue=0,lt=ge.length;Ue<lt/2;Ue+=2){var ht=ge[Ue],dt=ge[Ue+1];ge[Ue]=ge[lt-2-Ue],ge[Ue+1]=ge[lt-1-Ue],ge[lt-2-Ue]=ht,ge[lt-1-Ue]=dt}}(pe,le),J.push(pe)}}function vt(J,D){var U=(D=this.options=function(ee,le){for(var de in le)ee[de]=le[de];return ee}(Object.create(this.options),D)).debug;if(U&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var H=function(ee,le){var de=[];if(ee.type==="FeatureCollection")for(var pe=0;pe<ee.features.length;pe++)nn(de,ee.features[pe],le,pe);else nn(de,ee.type==="Feature"?ee:{geometry:ee},le);return de}(J,D);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(H=function(ee,le){var de=le.buffer/le.extent,pe=ee,ue=Tr(ee,1,-1-de,de,0,-1,2,le),ge=Tr(ee,1,1-de,2+de,0,-1,2,le);return(ue||ge)&&(pe=Tr(ee,1,-de,1+de,0,-1,2,le)||[],ue&&(pe=Je(ue,1).concat(pe)),ge&&(pe=pe.concat(Je(ge,-1)))),pe}(H,D)).length&&this.splitTile(H,0,0,0),U&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ot(J,D,U){return 32*((1<<J)*U+D)+J}function Br(J,D){const U=J.tileID.canonical;if(!this._geoJSONIndex)return D(null,null);const H=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!H)return D(null,null);const ee=new E(H.features);let le=Se(ee);le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),D(null,{vectorTile:ee,rawData:le.buffer})}vt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},vt.prototype.splitTile=function(J,D,U,H,ee,le,de){for(var pe=[J,D,U,H],ue=this.options,ge=ue.debug;pe.length;){H=pe.pop(),U=pe.pop(),D=pe.pop(),J=pe.pop();var ke=1<<D,Oe=Ot(D,U,H),Ue=this.tiles[Oe];if(!Ue&&(ge>1&&console.time("creation"),Ue=this.tiles[Oe]=er(J,D,U,H,ue),this.tileCoords.push({z:D,x:U,y:H}),ge)){ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,U,H,Ue.numFeatures,Ue.numPoints,Ue.numSimplified),console.timeEnd("creation"));var lt="z"+D;this.stats[lt]=(this.stats[lt]||0)+1,this.total++}if(Ue.source=J,ee){if(D===ue.maxZoom||D===ee)continue;var ut=1<<ee-D;if(U!==Math.floor(le/ut)||H!==Math.floor(de/ut))continue}else if(D===ue.indexMaxZoom||Ue.numPoints<=ue.indexMaxPoints)continue;if(Ue.source=null,J.length!==0){ge>1&&console.time("clipping");var ht,dt,Mt,ir,cr,sr,yr=.5*ue.buffer/ue.extent,on=.5-yr,sn=.5+yr,qr=1+yr;ht=dt=Mt=ir=null,cr=Tr(J,ke,U-yr,U+sn,0,Ue.minX,Ue.maxX,ue),sr=Tr(J,ke,U+on,U+qr,0,Ue.minX,Ue.maxX,ue),J=null,cr&&(ht=Tr(cr,ke,H-yr,H+sn,1,Ue.minY,Ue.maxY,ue),dt=Tr(cr,ke,H+on,H+qr,1,Ue.minY,Ue.maxY,ue),cr=null),sr&&(Mt=Tr(sr,ke,H-yr,H+sn,1,Ue.minY,Ue.maxY,ue),ir=Tr(sr,ke,H+on,H+qr,1,Ue.minY,Ue.maxY,ue),sr=null),ge>1&&console.timeEnd("clipping"),pe.push(ht||[],D+1,2*U,2*H),pe.push(dt||[],D+1,2*U,2*H+1),pe.push(Mt||[],D+1,2*U+1,2*H),pe.push(ir||[],D+1,2*U+1,2*H+1)}}},vt.prototype.getTile=function(J,D,U){var H=this.options,ee=H.extent,le=H.debug;if(J<0||J>24)return null;var de=1<<J,pe=Ot(J,D=(D%de+de)%de,U);if(this.tiles[pe])return lr(this.tiles[pe],ee);le>1&&console.log("drilling down to z%d-%d-%d",J,D,U);for(var ue,ge=J,ke=D,Oe=U;!ue&&ge>0;)ge--,ke=Math.floor(ke/2),Oe=Math.floor(Oe/2),ue=this.tiles[Ot(ge,ke,Oe)];return ue&&ue.source?(le>1&&console.log("found parent tile z%d-%d-%d",ge,ke,Oe),le>1&&console.time("drilling down"),this.splitTile(ue.source,ge,ke,Oe,J,D,U),le>1&&console.timeEnd("drilling down"),this.tiles[pe]?lr(this.tiles[pe],ee):null):null};class $i extends a.VectorTileWorkerSource{constructor(D,U,H,ee,le){super(D,U,H,ee,Br),le&&(this.loadGeoJSON=le)}loadData(D,U){const H=D&&D.request,ee=H&&H.collectResourceTiming;this.loadGeoJSON(D,(le,de)=>{if(le||!de)return U(le);if(typeof de!="object")return U(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));{G(de,!0);try{if(D.filter){const ue=a.createExpression(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ue.result==="error")throw new Error(ue.value.map(ke=>`${ke.key}: ${ke.message}`).join(", "));const ge=de.features.filter(ke=>ue.value.evaluate({zoom:0},ke));de={type:"FeatureCollection",features:ge}}this._geoJSONIndex=D.cluster?new lo(function({superclusterOptions:ue,clusterProperties:ge}){if(!ge||!ue)return ue;const ke={},Oe={},Ue={accumulated:null,zoom:0},lt={properties:null},ut=Object.keys(ge);for(const ht of ut){const[dt,Mt]=ge[ht],ir=a.createExpression(Mt),cr=a.createExpression(typeof dt=="string"?[dt,["accumulated"],["get",ht]]:dt);ke[ht]=ir.value,Oe[ht]=cr.value}return ue.map=ht=>{lt.properties=ht;const dt={};for(const Mt of ut)dt[Mt]=ke[Mt].evaluate(Ue,lt);return dt},ue.reduce=(ht,dt)=>{lt.properties=dt;for(const Mt of ut)Ue.accumulated=ht[Mt],ht[Mt]=Oe[Mt].evaluate(Ue,lt)},ue}(D)).load(de.features):function(ue,ge){return new vt(ue,ge)}(de,D.geojsonVtOptions)}catch(ue){return U(ue)}this.loaded={};const pe={};if(ee){const ue=a.getPerformanceMeasurement(H);ue&&(pe.resourceTiming={},pe.resourceTiming[D.source]=JSON.parse(JSON.stringify(ue)))}U(null,pe)}})}reloadTile(D,U){const H=this.loaded;return H&&H[D.uid]?super.reloadTile(D,U):this.loadTile(D,U)}loadGeoJSON(D,U){if(D.request)a.getJSON(D.request,U);else{if(typeof D.data!="string")return U(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));try{return U(null,JSON.parse(D.data))}catch{return U(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(D,U){try{U(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(H){U(H)}}getClusterChildren(D,U){try{U(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(H){U(H)}}getClusterLeaves(D,U){try{U(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(H){U(H)}}}class Dr{constructor(D){this.self=D,this.actor=new a.Actor(D,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:$i},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(U,H)=>{if(this.workerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.workerSourceTypes[U]=H},this.self.registerRTLTextPlugin=U=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=U.applyArabicShaping,a.plugin.processBidirectionalText=U.processBidirectionalText,a.plugin.processStyledBidirectionalText=U.processStyledBidirectionalText}}clearCaches(D,U,H){delete this.layerIndexes[D],delete this.availableImages[D],delete this.workerSources[D],delete this.demWorkerSources[D],H()}checkIfReady(D,U,H){H()}setReferrer(D,U){this.referrer=U}spriteLoaded(D,U){this.isSpriteLoaded[D]=U;for(const H in this.workerSources[D]){const ee=this.workerSources[D][H];for(const le in ee)ee[le]instanceof a.VectorTileWorkerSource&&(ee[le].isSpriteLoaded=U,ee[le].fire(new a.Event("isSpriteLoaded")))}}setImages(D,U,H){this.availableImages[D]=U;for(const ee in this.workerSources[D]){const le=this.workerSources[D][ee];for(const de in le)le[de].availableImages=U}H()}enableTerrain(D,U,H){this.terrain=U,H()}setProjection(D,U){this.projections[D]=a.getProjection(U)}setLayers(D,U,H){this.getLayerIndex(D).replace(U),H()}updateLayers(D,U,H){this.getLayerIndex(D).update(U.layers,U.removedIds),H()}loadTile(D,U,H){const ee=this.enableTerrain?a.extend({enableTerrain:this.terrain},U):U;ee.projection=this.projections[D]||this.defaultProjection,this.getWorkerSource(D,U.type,U.source).loadTile(ee,H)}loadDEMTile(D,U,H){const ee=this.enableTerrain?a.extend({buildQuadTree:this.terrain},U):U;this.getDEMWorkerSource(D,U.source).loadTile(ee,H)}reloadTile(D,U,H){const ee=this.enableTerrain?a.extend({enableTerrain:this.terrain},U):U;ee.projection=this.projections[D]||this.defaultProjection,this.getWorkerSource(D,U.type,U.source).reloadTile(ee,H)}abortTile(D,U,H){this.getWorkerSource(D,U.type,U.source).abortTile(U,H)}removeTile(D,U,H){this.getWorkerSource(D,U.type,U.source).removeTile(U,H)}removeSource(D,U,H){if(!this.workerSources[D]||!this.workerSources[D][U.type]||!this.workerSources[D][U.type][U.source])return;const ee=this.workerSources[D][U.type][U.source];delete this.workerSources[D][U.type][U.source],ee.removeSource!==void 0?ee.removeSource(U,H):H()}loadWorkerSource(D,U,H){try{this.self.importScripts(U.url),H()}catch(ee){H(ee.toString())}}syncRTLPluginState(D,U,H){try{a.plugin.setState(U);const ee=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&ee!=null){this.self.importScripts(ee);const le=a.plugin.isParsed();H(le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ee}`),le)}}catch(ee){H(ee.toString())}}getAvailableImages(D){let U=this.availableImages[D];return U||(U=[]),U}getLayerIndex(D){let U=this.layerIndexes[D];return U||(U=this.layerIndexes[D]=new B),U}getWorkerSource(D,U,H){return this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][U]||(this.workerSources[D][U]={}),this.workerSources[D][U][H]||(this.workerSources[D][U][H]=new this.workerSourceTypes[U]({send:(ee,le,de,pe,ue,ge)=>{this.actor.send(ee,le,de,D,ue,ge)},scheduler:this.actor.scheduler},this.getLayerIndex(D),this.getAvailableImages(D),this.isSpriteLoaded[D])),this.workerSources[D][U][H]}getDEMWorkerSource(D,U){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][U]||(this.demWorkerSources[D][U]=new q),this.demWorkerSources[D][U]}enforceCacheSizeLimit(D,U){a.enforceCacheSizeLimit(U)}getWorkerPerformanceMetrics(D,U,H){H(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Dr(self)),Dr}),b(["./shared"],function(a){var L=F;function F(d){return!function(r){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,_,y=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(y);try{_=new Worker(w),f=!0}catch{f=!1}return _&&_.terminate(),URL.revokeObjectURL(w),f}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var f=document.createElement("canvas");f.width=f.height=1;var _=f.getContext("2d");if(!_)return!1;var y=_.getImageData(0,0,1,1);return y&&y.width===f.width}()?(B[l=r&&r.failIfMajorPerformanceCaveat]===void 0&&(B[l]=function(f){var _,y=function(w){var S=document.createElement("canvas"),k=Object.create(F.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=w,S.getContext("webgl",k)||S.getContext("experimental-webgl",k)}(f);if(!y)return!1;try{_=y.createShader(y.VERTEX_SHADER)}catch{return!1}return!(!_||y.isContextLost())&&(y.shaderSource(_,"void main() {}"),y.compileShader(_),y.getShaderParameter(_,y.COMPILE_STATUS)===!0)}(l)),B[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(d)}var B={};function j(d,r){var l=r[0],f=r[1],_=r[2],y=r[3],w=l*y-_*f;return w?(d[0]=y*(w=1/w),d[1]=-f*w,d[2]=-_*w,d[3]=l*w,d):null}function q(d,r){if(Array.isArray(d)){if(!Array.isArray(r)||d.length!==r.length)return!1;for(let l=0;l<d.length;l++)if(!q(d[l],r[l]))return!1;return!0}if(typeof d=="object"&&d!==null&&r!==null){if(typeof r!="object"||Object.keys(d).length!==Object.keys(r).length)return!1;for(const l in d)if(!q(d[l],r[l]))return!1;return!0}return d===r}F.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const G={create:function(d,r,l){const f=a.window.document.createElement(d);return r!==void 0&&(f.className=r),l&&l.appendChild(f),f},createSVG:function(d,r,l){const f=a.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(const _ of Object.keys(r))f.setAttributeNS(null,_,r[_]);return l&&l.appendChild(f),f}},he=a.window.document&&a.window.document.documentElement.style,be=he&&he.userSelect!==void 0?"userSelect":"WebkitUserSelect";let we;G.disableDrag=function(){he&&be&&(we=he[be],he[be]="none")},G.enableDrag=function(){he&&be&&(he[be]=we)};const Ie=function(d){d.preventDefault(),d.stopPropagation(),a.window.removeEventListener("click",Ie,!0)};function E(d,r,l){const f=d.offsetWidth===r.width?1:d.offsetWidth/r.width;return new a.pointGeometry((l.clientX-r.left)*f,(l.clientY-r.top)*f)}function ye(d){const{userImage:r}=d;return!!(r&&r.render&&r.render())&&(d.data.replace(new Uint8Array(r.data.buffer)),!0)}G.suppressClick=function(){a.window.addEventListener("click",Ie,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",Ie,!0)},0)},G.mousePos=function(d,r){const l=d.getBoundingClientRect();return E(d,l,r)},G.touchPos=function(d,r){const l=d.getBoundingClientRect(),f=[];for(let _=0;_<r.length;_++)f.push(E(d,l,r[_]));return f},G.mouseButton=function(d){return a.window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button};class Le extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:l,callback:f}of this.requestors)this._notify(l,f);this.requestors=[]}}getImage(r){return this.images[r]}addImage(r,l){this._validate(r,l)&&(this.images[r]=l)}_validate(r,l){let f=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),f=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),f=!1),this._validateContent(l.content,l)||(this.fire(new a.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),f=!1),f}_validateStretch(r,l){if(!r)return!0;let f=0;for(const _ of r){if(_[0]<f||_[1]<_[0]||l<_[1])return!1;f=_[1]}return!0}_validateContent(r,l){return!(r&&(r.length!==4||r[0]<0||l.data.width<r[0]||r[1]<0||l.data.height<r[1]||r[2]<0||l.data.width<r[2]||r[3]<0||l.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,l){l.version=this.images[r].version+1,this.images[r]=l,this.updatedImages[r]=!0}removeImage(r){const l=this.images[r];delete this.images[r],delete this.patterns[r],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,l){let f=!0;if(!this.isLoaded())for(const _ of r)this.images[_]||(f=!1);this.isLoaded()||f?this._notify(r,l):this.requestors.push({ids:r,callback:l})}_notify(r,l){const f={};for(const _ of r){this.images[_]||this.fire(new a.Event("styleimagemissing",{id:_}));const y=this.images[_];y?f[_]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:Boolean(y.userImage&&y.userImage.render)}:a.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,f)}getPixelSize(){const{width:r,height:l}=this.atlasImage;return{width:r,height:l}}getPattern(r){const l=this.patterns[r],f=this.getImage(r);if(!f)return null;if(l&&l.position.version===f.version)return l.position;if(l)l.position.version=f.version;else{const _={w:f.data.width+2,h:f.data.height+2,x:0,y:0},y=new a.ImagePosition(_,f);this.patterns[r]={bin:_,position:y}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const l=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(r,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const y in this.patterns)r.push(this.patterns[y].bin);const{w:l,h:f}=a.potpack(r),_=this.atlasImage;_.resize({width:l||1,height:f||1});for(const y in this.patterns){const{bin:w}=this.patterns[y],S=w.x+1,k=w.y+1,z=this.images[y].data,P=z.width,O=z.height;a.RGBAImage.copy(z,_,{x:0,y:0},{x:S,y:k},{width:P,height:O}),a.RGBAImage.copy(z,_,{x:0,y:O-1},{x:S,y:k-1},{width:P,height:1}),a.RGBAImage.copy(z,_,{x:0,y:0},{x:S,y:k+O},{width:P,height:1}),a.RGBAImage.copy(z,_,{x:P-1,y:0},{x:S-1,y:k},{width:1,height:O}),a.RGBAImage.copy(z,_,{x:0,y:0},{x:S+P,y:k},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const l of r){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const f=this.images[l];ye(f)&&this.updateImage(l,f)}}}const Re=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(d,r){return function([l,f,_]){const y=a.degToRad(f+90),w=a.degToRad(_);return{x:l*Math.cos(y)*Math.sin(w),y:l*Math.sin(y)*Math.sin(w),z:l*Math.cos(w),azimuthal:f,polar:_}}(d.expression.evaluate(r))}interpolate(d,r,l){return{x:a.number(d.x,r.x,l),y:a.number(d.y,r.y,l),z:a.number(d.z,r.z,l),azimuthal:a.number(d.azimuthal,r.azimuthal,l),polar:a.number(d.polar,r.polar,l)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),xe="-transition";class Se extends a.Evented{constructor(r){super(),this._transitionable=new a.Transitionable(Re),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l={}){if(!this._validate(a.validateLight,r,l))for(const f in r){const _=r[f];a.endsWith(f,xe)?this._transitionable.setTransition(f.slice(0,-xe.length),_):this._transitionable.setValue(f,_)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,f){return(!f||f.validate!==!1)&&a.emitValidationErrors(this,r.call(a.validateStyle,a.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const Be=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)}),Ye="-transition";class it extends a.Evented{constructor(r,l){super(),this._transitionable=new a.Transitionable(Be),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(r){for(const l in r){const f=r[l];a.endsWith(l,Ye)?this._transitionable.setTransition(l.slice(0,-Ye.length),f):this._transitionable.setValue(l,f)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function at(d,r,l,f){const _=a.smoothstep(45,65,l),[y,w]=wt(d,f),S=a.length(r);let k=1-Math.min(1,Math.exp((S-y)/(w-y)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*_*d.alpha}function wt(d,r){const l=.5/Math.tan(.5*r);return[d.range[0]+l,d.range[1]+l]}const dr=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"])}),Sr="-transition";class Ut extends a.Evented{constructor(r,l){super(),this._transitionable=new a.Transitionable(dr),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,l={}){if(!this._validate(a.validateFog,r,l))for(const f in r){const _=r[f];a.endsWith(f,Sr)?this._transitionable.setTransition(f.slice(0,-Sr.length),_):this._transitionable.setValue(f,_)}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return a.smoothstep(45,65,r)*l.a}getOpacityAtLatLng(r,l){return this._transform.projection.supportsFog?function(f,_,y){const w=a.MercatorCoordinate.fromLngLat(_),S=y.elevation?y.elevation.getAtPointOrZero(w):0,k=[w.x,w.y,S];return a.transformMat4(k,k,y.mercatorFogMatrix),at(f,k,y.pitch,y._fov)}(this.state,r,l):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?wt(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,f){return(!f||f.validate!==!1)&&a.emitValidationErrors(this,r.call(a.validateStyle,a.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class $r{constructor(r,l){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const f=this.workerPool.acquire(this.id);for(let _=0;_<f.length;_++){const y=new $r.Actor(f[_],l,this.id);y.name=`Worker ${_}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,l,f){a.asyncAll(this.actors,(_,y)=>{_.send(r,l,y)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Zt(d,r,l){return r*(a.EXTENT/(d.tileSize*Math.pow(2,l-d.tileID.overscaledZ)))}$r.Actor=a.Actor;class At{constructor(r,l,f){this.context=r;const _=r.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(f),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Or{constructor(r,l,f,_){this.length=l.length,this.attributes=f,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.context=r;const y=r.gl;this.buffer=y.createBuffer(),r.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let f=0;f<this.attributes.length;f++){const _=l.attributes[this.attributes[f].name];_!==void 0&&r.enableVertexAttribArray(_)}}setVertexAttribPointers(r,l,f){for(let _=0;_<this.attributes.length;_++){const y=this.attributes[_],w=l.attributes[y.name];w!==void 0&&r.vertexAttribPointer(w,y.components,r[fr[y.type]],!1,this.itemSize,y.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Tt{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pr extends Tt{getDefault(){return a.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ui extends Tt{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class En extends Tt{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Do extends Tt{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Dn extends Tt{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class gi extends Tt{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class lo extends Tt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Lo extends Tt{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Ro extends Tt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class co extends Tt{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Mi extends Tt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class ji extends Tt{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Ct extends Tt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class Gr extends Tt{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Ii extends Tt{getDefault(){return a.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class tn extends Tt{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class rn extends Tt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class Ln extends Tt{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Vt extends Tt{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class ki extends Tt{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class wi extends Tt{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class nn extends Tt{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class yi extends Tt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Wt extends Tt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Cr extends Tt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Rn extends Tt{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class vi extends Tt{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Tr extends Tt{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class Oo extends Tt{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class uo extends Tt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Ti extends Tt{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Vi extends Tt{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class ho extends Vi{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class $e extends Vi{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class gt extends $e{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Je{constructor(r,l,f,_){this.context=r,this.width=l,this.height=f;const y=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new ho(r,y),_&&(this.depthAttachment=new $e(r,y))}destroy(){const r=this.context.gl,l=this.colorAttachment.get();if(l&&r.deleteTexture(l),this.depthAttachment){const f=this.depthAttachment.get();f&&r.deleteRenderbuffer(f)}r.deleteFramebuffer(this.framebuffer)}}class Et{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new pr(this),this.clearDepth=new Ui(this),this.clearStencil=new En(this),this.colorMask=new Do(this),this.depthMask=new Dn(this),this.stencilMask=new gi(this),this.stencilFunc=new lo(this),this.stencilOp=new Lo(this),this.stencilTest=new Ro(this),this.depthRange=new co(this),this.depthTest=new Mi(this),this.depthFunc=new ji(this),this.blend=new Ct(this),this.blendFunc=new Gr(this),this.blendColor=new Ii(this),this.blendEquation=new tn(this),this.cullFace=new rn(this),this.cullFaceSide=new Ln(this),this.frontFace=new Vt(this),this.program=new ki(this),this.activeTexture=new wi(this),this.viewport=new nn(this),this.bindFramebuffer=new yi(this),this.bindRenderbuffer=new Wt(this),this.bindTexture=new Cr(this),this.bindVertexBuffer=new Rn(this),this.bindElementBuffer=new vi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Tr(this),this.pixelStoreUnpack=new Oo(this),this.pixelStoreUnpackPremultiplyAlpha=new uo(this),this.pixelStoreUnpackFlipY=new Ti(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l){return new At(this,r,l)}createVertexBuffer(r,l,f){return new Or(this,r,l,f)}createRenderbuffer(r,l,f){const _=this.gl,y=_.createRenderbuffer();return this.bindRenderbuffer.set(y),_.renderbufferStorage(_.RENDERBUFFER,r,l,f),this.bindRenderbuffer.set(null),y}createFramebuffer(r,l,f){return new Je(this,r,l,f)}clear({color:r,depth:l,stencil:f}){const _=this.gl;let y=0;r&&(y|=_.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(y|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),f!==void 0&&(y|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),_.clear(y)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){q(r.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class lr{constructor(r,l,f,_){this.screenBounds=r,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(y=>_.pointCoordinate3D(y)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(r,l){let f,_;if(r instanceof a.pointGeometry||typeof r[0]=="number"){const y=a.pointGeometry.convert(r);f=[a.pointGeometry.convert(r)],_=l.isPointAboveHorizon(y)}else{const y=a.pointGeometry.convert(r[0]),w=a.pointGeometry.convert(r[1]);f=[y,w],_=a.polygonizeBounds(y,w).every(S=>l.isPointAboveHorizon(S))}return new lr(f,l.getCameraPoint(),_,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const l=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],_=a.polygonizeBounds(l,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<f.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),a.bufferConvexPolygon(_,r)}containsTile(r,l,f){const _=r.queryPadding+1,y=r.tileID.wrap,w=f?this._bufferedCameraMercator(_,l).map(Z=>a.getTilePoint(r.tileTransform,Z,y)):this._bufferedScreenMercator(_,l).map(Z=>a.getTilePoint(r.tileTransform,Z,y)),S=this.screenGeometryMercator.map(Z=>a.getTileVec3(r.tileTransform,Z,y)),k=S.map(Z=>new a.pointGeometry(Z[0],Z[1])),z=l.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),P=a.getTileVec3(r.tileTransform,z,y),O=S.map(Z=>{const Y=a.sub(Z,Z,P);return a.normalize(Y,Y),new a.Ray(P,Y)}),V=Zt(r,1,l.zoom);if(a.polygonIntersectsBox(w,0,0,a.EXTENT,a.EXTENT))return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:O,bufferedTilespaceGeometry:w,bufferedTilespaceBounds:(K=a.getBounds(w),K.min.x=a.clamp(K.min.x,0,a.EXTENT),K.min.y=a.clamp(K.min.y,0,a.EXTENT),K.max.x=a.clamp(K.max.x,0,a.EXTENT),K.max.y=a.clamp(K.max.y,0,a.EXTENT),K),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:V};var K}_bufferedScreenMercator(r,l){const f=Dt(r);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{const _=this.bufferedScreenGeometry(r).map(y=>l.pointCoordinate3D(y));return this._screenRaycastCache[f]=_,_}}_bufferedCameraMercator(r,l){const f=Dt(r);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{const _=this.bufferedCameraGeometry(r).map(y=>l.pointCoordinate3D(y));return this._cameraRaycastCache[f]=_,_}}}function Dt(d){return 100*d|0}function er(d,r,l){const f=function(_,y){if(_)return l(_);if(y){const w=a.pick(a.extend(y,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(w.vectorLayers=y.vector_layers,w.vectorLayerIds=w.vectorLayers.map(S=>S.id)),w.tiles=r.canonicalizeTileset(w,d.url),l(null,w)}};return d.url?a.getJSON(r.transformRequest(r.normalizeSourceURL(d.url),a.ResourceType.Source),f):a.exported.frame(()=>f(null,d))}class tr{constructor(r,l,f){this.bounds=a.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=f||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const l=Math.pow(2,r.z),f=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*l),_=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*l),y=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*l),w=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*l);return r.x>=f&&r.x<y&&r.y>=_&&r.y<w}}class rr extends a.Evented{constructor(r,l,f,_){super(),this.id=r,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},l),a.extend(this,a.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=er(this._options,this.map._requestManager,(r,l)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new a.ErrorEvent(r)):l&&(a.extend(this,l),l.bounds&&(this.tileBounds=new tr(l.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(l.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const f=a.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);r.request=a.getImage(this.map._requestManager.transformRequest(_,a.ResourceType.Tile),(y,w,S,k)=>{if(delete r.request,r.aborted)r.state="unloaded",l(null);else if(y)r.state="errored",l(y);else if(w){this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:S,expires:k});const z=this.map.painter.context,P=z.gl;r.texture=this.map.painter.getTileTexture(w.width),r.texture?r.texture.update(w,{useMipmap:!0}):(r.texture=new a.Texture(z,w,P.RGBA,{useMipmap:!0}),r.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE),z.extTextureFilterAnisotropic&&P.texParameterf(P.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax)),r.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),l(null)}})}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l()}unloadTile(r,l){r.texture&&this.map.painter.saveTileTexture(r.texture),l()}hasTransition(){return!1}}let vt;function Ot(d,r,l,f,_,y,w,S){const k=[d,l,_,r,f,y,1,1,1],z=[w,S,1],P=a.adjoint([],k),[O,V,K]=a.transformMat3(z,z,a.transpose(P,P));return a.multiply(k,[O,0,0,0,V,0,0,0,K],k)}class Br extends a.Evented{constructor(r,l,f,_){super(),this.id=r,this.dispatcher=f,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=l}load(r,l){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(f,_)=>{this._loaded=!0,f?this.fire(new a.ErrorEvent(f)):_&&(this.image=a.exported.getImageData(_),this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),l&&l(),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this.options.url=r.url,this.load(r.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}setCoordinates(r){this.coordinates=r,delete this._boundsArray;const l=r.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(f){let _=1/0,y=1/0,w=-1/0,S=-1/0;for(const O of f)_=Math.min(_,O.x),y=Math.min(y,O.y),w=Math.max(w,O.x),S=Math.max(S,O.y);const k=Math.max(w-_,S-y),z=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),P=Math.pow(2,z);return new a.CanonicalTileID(z,Math.floor((_+w)/2*P),Math.floor((y+S)/2*P))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const r=a.tileTransform(this.tileID,this.map.transform.projection),[l,f,_,y]=this.coordinates.map(w=>{const S=r.projection.project(w[0],w[1]);return a.getTilePoint(r,S)._round()});return this.perspectiveTransform=function(w,S,k,z,P,O,V,K,Z,Y){const se=Ot(0,0,w,0,0,S,w,S),X=Ot(k,z,P,O,V,K,Z,Y);return a.multiply(X,a.adjoint(se,se),X),[X[6]/X[8]*w/a.EXTENT,X[7]/X[8]*S/a.EXTENT]}(this.width,this.height,l.x,l.y,f.x,f.y,y.x,y.y,_.x,_.y),this._boundsArray=new a.StructArrayLayout4i8,this._boundsArray.emplaceBack(l.x,l.y,0,0),this._boundsArray.emplaceBack(f.x,f.y,a.EXTENT,0),this._boundsArray.emplaceBack(y.x,y.y,0,a.EXTENT),this._boundsArray.emplaceBack(_.x,_.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,l=r.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,a.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new a.Texture(r,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}loadTile(r,l){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},l(null)):(r.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const $i={vector:class extends a.Evented{constructor(d,r,l,f){if(super(),this.id=d,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(r,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=er(this._options,this.map._requestManager,(d,r)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new a.ErrorEvent(d)):r&&(a.extend(this,r),r.bounds&&(this.tileBounds=new tr(r.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(r.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}onAdd(d){this.map=d,this.load()}setSourceProperty(d){this._tileJSONRequest&&this._tileJSONRequest.cancel(),d();const r=this.map.style._getSourceCaches(this.id);for(const l of r)l.clearTiles();this.load()}setTiles(d){return this.setSourceProperty(()=>{this._options.tiles=d}),this}setUrl(d){return this.setSourceProperty(()=>{this.url=d,this._options.url=d}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(d,r){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(l,a.ResourceType.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:d.isSymbolTile};if(f.request.collectResourceTiming=this._collectResourceTiming,d.actor&&d.state!=="expired")d.state==="loading"?d.reloadCallback=r:d.request=d.actor.send("reloadTile",f,_.bind(this));else if(d.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)d.request=d.actor.send("loadTile",f,_.bind(this),void 0,!0);else{const y=a.loadVectorTile.call({deduped:this._deduped},f,(w,S)=>{w||!S?_.call(this,w):(f.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},d.actor&&d.actor.send("loadTile",f,_.bind(this),void 0,!0))},!0);d.request={cancel:y}}function _(y,w){return delete d.request,d.aborted?r(null):y&&y.status!==404?r(y):(w&&w.resourceTiming&&(d.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&d.setExpiryData(w),d.loadVectorData(w,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(d.reloadCallback&&(this.loadTile(d,d.reloadCallback),d.reloadCallback=null)))}}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.actor&&d.actor.send("abortTile",{uid:d.uid,type:this.type,source:this.id})}unloadTile(d){d.unloadVectorData(),d.actor&&d.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:rr,"raster-dem":class extends rr{constructor(d,r,l,f){super(d,r,l,f),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(d,r){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(_,y){_&&(d.state="errored",r(_)),y&&(d.dem=y,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",r(null))}d.request=a.getImage(this.map._requestManager.transformRequest(l,a.ResourceType.Tile),function(_,y,w,S){if(delete d.request,d.aborted)d.state="unloaded",r(null);else if(_)d.state="errored",r(_);else if(y){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:w,expires:S});const k=a.window.ImageBitmap&&y instanceof a.window.ImageBitmap&&(vt==null&&(vt=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),vt),z=1-(y.width-a.prevPowerOfTwo(y.width))/2;z<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const P=k?y:a.exported.getImageData(y,z),O={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:P,encoding:this.encoding,padding:z};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",O,f.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(d){const r=d.canonical,l=Math.pow(2,r.z),f=(r.x-1+l)%l,_=r.x===0?d.wrap-1:d.wrap,y=(r.x+1+l)%l,w=r.x+1===l?d.wrap+1:d.wrap,S={};return S[new a.OverscaledTileID(d.overscaledZ,_,r.z,f,r.y).key]={backfilled:!1},S[new a.OverscaledTileID(d.overscaledZ,w,r.z,y,r.y).key]={backfilled:!1},r.y>0&&(S[new a.OverscaledTileID(d.overscaledZ,_,r.z,f,r.y-1).key]={backfilled:!1},S[new a.OverscaledTileID(d.overscaledZ,d.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},S[new a.OverscaledTileID(d.overscaledZ,w,r.z,y,r.y-1).key]={backfilled:!1}),r.y+1<l&&(S[new a.OverscaledTileID(d.overscaledZ,_,r.z,f,r.y+1).key]={backfilled:!1},S[new a.OverscaledTileID(d.overscaledZ,d.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},S[new a.OverscaledTileID(d.overscaledZ,w,r.z,y,r.y+1).key]={backfilled:!1}),S}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends a.Evented{constructor(d,r,l,f){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(f),this._data=r.data,this._options=a.extend({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const _=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*_,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*_,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:a.EXTENT,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*_,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},r),this}getClusterChildren(d,r){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},r),this}getClusterLeaves(d,r,l,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:r,offset:l},f),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=a.extend({},this.workerOptions),r=this._data;typeof r=="string"?(d.request=this.map._requestManager.transformRequest(a.exported.resolveURL(r),a.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(l,f)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new a.ErrorEvent(l));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(_.resourceTiming=f.resourceTiming[this.id]),this.fire(new a.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,r){const l=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(l,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(f,_)=>(delete d.request,d.unloadVectorData(),d.aborted?r(null):f?r(f):(d.loadVectorData(_,this.map.painter,l==="reloadTile"),r(null))),void 0,l==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Br{constructor(d,r,l,f){super(d,r,l,f),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const r of d.urls)this.urls.push(this.map._requestManager.transformRequest(r,a.ResourceType.Source).url);a.getVideo(this.urls,(r,l)=>{this._loaded=!0,r?this.fire(new a.ErrorEvent(r)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const r=this.video.seekable;d<r.start(0)||d>r.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,r=d.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(d,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,a.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2));for(const l in this.tiles){const f=this.tiles[l];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Br,canvas:class extends Br{constructor(d,r,l,f){super(d,r,l,f),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(y=>typeof y!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,l=r.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,a.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(r,this.canvas,l.RGBA,{premultiply:!0});for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}}},Dr=function(d,r,l,f){const _=new $i[r.type](d,r,l,f);if(_.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${_.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],_),_};function J(d,r){const l=a.identity([]);return a.scale(l,l,[.5*d.width,.5*-d.height,1]),a.translate(l,l,[1,-1,0]),a.multiply$1(l,l,d.calculateProjMatrix(r.toUnwrapped()))}function D(d,r,l,f,_,y,w,S=!1){const k=d.tilesIn(f,w,S);k.sort(H);const z=[];for(const O of k)z.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(r,l,d._state,O,_,y,J(d.transform,O.tile.tileID),S)});const P=function(O){const V={},K={};for(const Z of O){const Y=Z.queryResults,se=Z.wrappedTileID,X=K[se]=K[se]||{};for(const ie in Y){const ne=Y[ie],te=X[ie]=X[ie]||{},re=V[ie]=V[ie]||[];for(const ae of ne)te[ae.featureIndex]||(te[ae.featureIndex]=!0,re.push(ae))}}return V}(z);for(const O in P)P[O].forEach(V=>{const K=V.feature,Z=d.getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=Z});return P}function U(d,r){const l=d.getRenderableIds().map(y=>d.getTileByID(y)),f=[],_={};for(let y=0;y<l.length;y++){const w=l[y],S=w.tileID.canonical.key;_[S]||(_[S]=!0,w.querySourceFeatures(f,r))}return f}function H(d,r){const l=d.tileID,f=r.tileID;return l.overscaledZ-f.overscaledZ||l.canonical.y-f.canonical.y||l.wrap-f.wrap||l.canonical.x-f.canonical.x}function ee(){return To.workerClass!=null?new To.workerClass:new a.window.Worker(To.workerUrl)}const le="mapboxgl_preloaded_worker_pool";class de{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<de.workerCount;)this.workers.push(new ee);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[le]}numActive(){return Object.keys(this.active).length}}let pe;function ue(){return pe||(pe=new de),pe}function ge(d,r){const l={};for(const f in d)f!=="ref"&&(l[f]=d[f]);return a.refProperties.forEach(f=>{f in r&&(l[f]=r[f])}),l}function ke(d){d=d.slice();const r=Object.create(null);for(let l=0;l<d.length;l++)r[d[l].id]=d[l];for(let l=0;l<d.length;l++)"ref"in d[l]&&(d[l]=ge(d[l],r[d[l].ref]));return d}de.workerCount=2;const Oe={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ue(d,r,l){l.push({command:Oe.addSource,args:[d,r[d]]})}function lt(d,r,l){r.push({command:Oe.removeSource,args:[d]}),l[d]=!0}function ut(d,r,l,f){lt(d,l,f),Ue(d,r,l)}function ht(d,r,l){let f;for(f in d[l])if(d[l].hasOwnProperty(f)&&f!=="data"&&!q(d[l][f],r[l][f]))return!1;for(f in r[l])if(r[l].hasOwnProperty(f)&&f!=="data"&&!q(d[l][f],r[l][f]))return!1;return!0}function dt(d,r,l,f,_,y){let w;for(w in r=r||{},d=d||{})d.hasOwnProperty(w)&&(q(d[w],r[w])||l.push({command:y,args:[f,w,r[w],_]}));for(w in r)r.hasOwnProperty(w)&&!d.hasOwnProperty(w)&&(q(d[w],r[w])||l.push({command:y,args:[f,w,r[w],_]}))}function Mt(d){return d.id}function ir(d,r){return d[r.id]=r,d}class cr{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=a.clamp(r,0,1);let l=1,f=this._distances[l];const _=r*this.paddedLength+this.padding;for(;f<_&&l<this._distances.length;)f=this._distances[++l];const y=l-1,w=this._distances[y],S=f-w,k=S>0?(_-w)/S:0;return this.points[y].mult(1-k).add(this.points[l].mult(k))}}class sr{constructor(r,l,f){const _=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(r/f),this.yCellCount=Math.ceil(l/f);for(let w=0;w<this.xCellCount*this.yCellCount;w++)_.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,f,_,y){this._forEachCell(l,f,_,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(y)}insertCircle(r,l,f,_){this._forEachCell(l-_,f-_,l+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(f),this.circles.push(_)}_insertBoxCell(r,l,f,_,y,w){this.boxCells[y].push(w)}_insertCircleCell(r,l,f,_,y,w){this.circleCells[y].push(w)}_query(r,l,f,_,y,w){if(f<0||r>this.width||_<0||l>this.height)return!y&&[];const S=[];if(r<=0&&l<=0&&this.width<=f&&this.height<=_){if(y)return!0;for(let k=0;k<this.boxKeys.length;k++)S.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const z=this.circles[3*k],P=this.circles[3*k+1],O=this.circles[3*k+2];S.push({key:this.circleKeys[k],x1:z-O,y1:P-O,x2:z+O,y2:P+O})}return w?S.filter(w):S}return this._forEachCell(r,l,f,_,this._queryCell,S,{hitTest:y,seenUids:{box:{},circle:{}}},w),y?S.length>0:S}_queryCircle(r,l,f,_,y){const w=r-f,S=r+f,k=l-f,z=l+f;if(S<0||w>this.width||z<0||k>this.height)return!_&&[];const P=[];return this._forEachCell(w,k,S,z,this._queryCellCircle,P,{hitTest:_,circle:{x:r,y:l,radius:f},seenUids:{box:{},circle:{}}},y),_?P.length>0:P}query(r,l,f,_,y){return this._query(r,l,f,_,!1,y)}hitTest(r,l,f,_,y){return this._query(r,l,f,_,!0,y)}hitTestCircle(r,l,f,_){return this._queryCircle(r,l,f,!0,_)}_queryCell(r,l,f,_,y,w,S,k){const z=S.seenUids,P=this.boxCells[y];if(P!==null){const V=this.bboxes;for(const K of P)if(!z.box[K]){z.box[K]=!0;const Z=4*K;if(r<=V[Z+2]&&l<=V[Z+3]&&f>=V[Z+0]&&_>=V[Z+1]&&(!k||k(this.boxKeys[K]))){if(S.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[K],x1:V[Z],y1:V[Z+1],x2:V[Z+2],y2:V[Z+3]})}}}const O=this.circleCells[y];if(O!==null){const V=this.circles;for(const K of O)if(!z.circle[K]){z.circle[K]=!0;const Z=3*K;if(this._circleAndRectCollide(V[Z],V[Z+1],V[Z+2],r,l,f,_)&&(!k||k(this.circleKeys[K]))){if(S.hitTest)return w.push(!0),!0;{const Y=V[Z],se=V[Z+1],X=V[Z+2];w.push({key:this.circleKeys[K],x1:Y-X,y1:se-X,x2:Y+X,y2:se+X})}}}}}_queryCellCircle(r,l,f,_,y,w,S,k){const z=S.circle,P=S.seenUids,O=this.boxCells[y];if(O!==null){const K=this.bboxes;for(const Z of O)if(!P.box[Z]){P.box[Z]=!0;const Y=4*Z;if(this._circleAndRectCollide(z.x,z.y,z.radius,K[Y+0],K[Y+1],K[Y+2],K[Y+3])&&(!k||k(this.boxKeys[Z])))return w.push(!0),!0}}const V=this.circleCells[y];if(V!==null){const K=this.circles;for(const Z of V)if(!P.circle[Z]){P.circle[Z]=!0;const Y=3*Z;if(this._circlesCollide(K[Y],K[Y+1],K[Y+2],z.x,z.y,z.radius)&&(!k||k(this.circleKeys[Z])))return w.push(!0),!0}}}_forEachCell(r,l,f,_,y,w,S,k){const z=this._convertToXCellCoord(r),P=this._convertToYCellCoord(l),O=this._convertToXCellCoord(f),V=this._convertToYCellCoord(_);for(let K=z;K<=O;K++)for(let Z=P;Z<=V;Z++)if(y.call(this,r,l,f,_,this.xCellCount*Z+K,w,S,k))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,f,_,y,w){const S=_-r,k=y-l,z=f+w;return z*z>S*S+k*k}_circleAndRectCollide(r,l,f,_,y,w,S){const k=(w-_)/2,z=Math.abs(r-(_+k));if(z>k+f)return!1;const P=(S-y)/2,O=Math.abs(l-(y+P));if(O>P+f)return!1;if(z<=k||O<=P)return!0;const V=z-k,K=O-P;return V*V+K*K<=f*f}}const yr=Math.tan(85*Math.PI/180);function on(d,r,l,f,_,y){let w=a.create();if(l){if(_.projection.name==="globe")w=a.calculateGlobeMatrix(_,_.worldSize/_._projectionScaler,[0,0]),a.multiply$1(w,w,a.globeDenormalizeECEF(a.globeTileBounds(r)));else{const S=j([],y);w[0]=S[0],w[1]=S[1],w[4]=S[2],w[5]=S[3]}f||a.rotateZ(w,w,_.angle)}else a.multiply$1(w,_.labelPlaneMatrix,d);return w}function sn(d,r,l,f,_,y){if(l){if(_.projection.name==="globe"){const w=on(d,r,l,f,_,y);return a.invert(w,w),a.multiply$1(w,d,w),w}{const w=a.clone(d),S=a.identity([]);return S[0]=y[0],S[1]=y[1],S[4]=y[2],S[5]=y[3],a.multiply$1(w,w,S),f||a.rotateZ(w,w,-_.angle),w}}return _.glCoordMatrix}function qr(d,r,l=0){const f=[d.x,d.y,l,1];l?a.transformMat4$1(f,f,r):Ls(f,f,r);const _=f[3];return{point:new a.pointGeometry(f[0]/_,f[1]/_),signedDistanceFromCamera:_}}function Gi(d,r){return Math.min(.5+d/r*.5,1.5)}function Sa(d,r){const l=d[0]/d[3],f=d[1]/d[3];return l>=-r[0]&&l<=r[0]&&f>=-r[1]&&f<=r[1]}function zu(d,r,l,f,_,y,w,S,k,z){const P=l.transform,O=f?d.textSizeData:d.iconSizeData,V=a.evaluateSizeForZoom(O,l.transform.zoom),K=[256/l.width*2+1,256/l.height*2+1],Z=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;Z.clear();const Y=d.lineVertexArray,se=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,X=l.transform.width/l.transform.height;let ie=!1;for(let ne=0;ne<se.length;ne++){const te=se.get(ne);if(te.writingMode!==a.WritingMode.vertical||ie||ne!==0&&se.get(ne-1).writingMode===a.WritingMode.horizontal||(ie=!0),te.hidden||te.writingMode===a.WritingMode.vertical&&!ie){Sn(te.numGlyphs,Z);continue}ie=!1;const re=new a.pointGeometry(te.tileAnchorX,te.tileAnchorY),ae=k?k(re):[0,0,0],ve=P.projection.projectTilePoint(re.x,re.y,z.canonical),Ee=[ve.x+ae[0],ve.y+ae[1],ve.z+ae[2]],Xe=[...Ee,1];if(a.transformMat4$1(Xe,Xe,r),!Sa(Xe,K)){Sn(te.numGlyphs,Z);continue}const Ve=Gi(l.transform.cameraToCenterDistance,Xe[3]),je=a.evaluateSizeForFeature(O,V,te),Ce=w?je/Ve:je*Ve,Te=qr(new a.pointGeometry(Ee[0],Ee[1]),_,Ee[2]);if(Te.signedDistanceFromCamera<=0){Sn(te.numGlyphs,Z);continue}let Ne={};const De=w?null:k,ct=ec(te,Ce,!1,S,r,_,y,d.glyphOffsetArray,Y,Z,Te.point,re,Ne,X,De,P.projection,z);ie=ct.useVertical,De&&ct.needsFlipping&&(Ne={}),(ct.notEnoughRoom||ie||ct.needsFlipping&&ec(te,Ce,!0,S,r,_,y,d.glyphOffsetArray,Y,Z,Te.point,re,Ne,X,De,P.projection,z).notEnoughRoom)&&Sn(te.numGlyphs,Z)}f?d.text.dynamicLayoutVertexBuffer.updateData(Z):d.icon.dynamicLayoutVertexBuffer.updateData(Z)}function Ql(d,r,l,f,_,y,w,S,k,z,P,O,V,K,Z){const Y=S.glyphStartIndex+S.numGlyphs,se=S.lineStartIndex,X=S.lineStartIndex+S.lineLength,ie=r.getoffsetX(S.glyphStartIndex),ne=r.getoffsetX(Y-1),te=Ds(d*ie,l,f,_,y,w,S.segment,se,X,k,z,P,O,V,!0,K,Z);if(!te)return null;const re=Ds(d*ne,l,f,_,y,w,S.segment,se,X,k,z,P,O,V,!0,K,Z);return re?{first:te,last:re}:null}function Ps(d,r,l,f){return d.writingMode===a.WritingMode.horizontal&&Math.abs(l.y-r.y)>Math.abs(l.x-r.x)*f?{useVertical:!0}:d.writingMode===a.WritingMode.vertical?r.y<l.y?{needsFlipping:!0}:null:d.flipState!==0&&function(_,y,w){const S=(y.x-_.x)*w;return S===0||Math.abs((y.y-_.y)/S)>yr}(r,l,f)?d.flipState===1?{needsFlipping:!0}:null:r.x>l.x?{needsFlipping:!0}:null}function ec(d,r,l,f,_,y,w,S,k,z,P,O,V,K,Z,Y,se){const X=r/24,ie=d.lineOffsetX*X,ne=d.lineOffsetY*X;let te;if(d.numGlyphs>1){const re=d.glyphStartIndex+d.numGlyphs,ae=d.lineStartIndex,ve=d.lineStartIndex+d.lineLength,Ee=Ql(X,S,ie,ne,l,P,O,d,k,y,V,Z,!1,Y,se);if(!Ee)return{notEnoughRoom:!0};const Xe=qr(Ee.first.point,w).point,Ve=qr(Ee.last.point,w).point;if(f&&!l){const je=Ps(d,Xe,Ve,K);if(d.flipState=je&&je.needsFlipping?1:2,je)return je}te=[Ee.first];for(let je=d.glyphStartIndex+1;je<re-1;je++)te.push(Ds(X*S.getoffsetX(je),ie,ne,l,P,O,d.segment,ae,ve,k,y,V,Z,!1,!1,Y,se));te.push(Ee.last)}else{if(f&&!l){const ae=qr(O,_).point,ve=d.lineStartIndex+d.segment+1,Ee=new a.pointGeometry(k.getx(ve),k.gety(ve)),Xe=qr(Ee,_),Ve=Ps(d,ae,Xe.signedDistanceFromCamera>0?Xe.point:Ca(O,Ee,ae,1,_,void 0,Y,se.canonical),K);if(d.flipState=Ve&&Ve.needsFlipping?1:2,Ve)return Ve}const re=Ds(X*S.getoffsetX(d.glyphStartIndex),ie,ne,l,P,O,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,k,y,V,Z,!1,!1,Y,se);if(!re)return{notEnoughRoom:!0};te=[re]}for(const re of te)a.addDynamicAttributes(z,re.point,re.angle);return{}}function Aa(d,r,l,f,_){const y=f.projectTilePoint(d.x,d.y,r);if(!_)return qr(y,l,y.z);const w=_(d);return qr(new a.pointGeometry(y.x+w[0],y.y+w[1]),l,y.z+w[2])}function Ca(d,r,l,f,_,y,w,S){const k=Aa(d.add(d.sub(r)._unit()),S,_,w,y).point,z=l.sub(k);return l.add(z._mult(f/z.mag()))}function Ds(d,r,l,f,_,y,w,S,k,z,P,O,V,K,Z,Y,se){const X=f?d-r:d+r;let ie=X>0?1:-1,ne=0;f&&(ie*=-1,ne=Math.PI),ie<0&&(ne+=Math.PI);let te=ie>0?S+w:S+w+1,re=_,ae=_,ve=0,Ee=0;const Xe=Math.abs(X),Ve=[],je=[];let Ce=y;const Te=()=>{const We=te-ie;return ve===0?y:new a.pointGeometry(z.getx(We),z.gety(We))},Ne=()=>Ca(Te(),Ce,ae,Xe-ve+1,P,V,Y,se.canonical);for(;ve+Ee<=Xe;){if(te+=ie,te<S||te>=k)return null;if(ae=re,Ve.push(re),K&&je.push(Ce||Te()),re=O[te],re===void 0){Ce=new a.pointGeometry(z.getx(te),z.gety(te));const We=Aa(Ce,se.canonical,P,Y,V);re=We.signedDistanceFromCamera>0?O[te]=We.point:Ne()}else Ce=null;ve+=Ee,Ee=ae.dist(re)}Z&&V&&(Ce=Ce||new a.pointGeometry(z.getx(te),z.gety(te)),O[te]=re=O[te]===void 0?re:Ne(),Ee=ae.dist(re));const De=(Xe-ve)/Ee,ct=re.sub(ae),mt=ct.mult(De)._add(ae);l&&mt._add(ct._unit()._perp()._mult(l*ie));const It=ne+Math.atan2(re.y-ae.y,re.x-ae.x);return Ve.push(mt),K&&(Ce=Ce||new a.pointGeometry(z.getx(te),z.gety(te)),je.push(function(We,ft,xt){const ar=1-xt;return new a.pointGeometry(We.x*ar+ft.x*xt,We.y*ar+ft.y*xt)}(je.length>0?je[je.length-1]:Ce,Ce,De))),{point:mt,angle:It,path:Ve,tilePath:je}}const tc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Sn(d,r){for(let l=0;l<d;l++){const f=r.length;r.resize(f+4),r.float32.set(tc,3*f)}}function Ls(d,r,l){const f=r[0],_=r[1];return d[0]=l[0]*f+l[4]*_+l[12],d[1]=l[1]*f+l[5]*_+l[13],d[3]=l[3]*f+l[7]*_+l[15],d}const On=100;class Jd{constructor(r,l,f=new sr(r.width+200,r.height+200,25),_=new sr(r.width+200,r.height+200,25)){this.transform=r,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+On,this.screenBottomBoundary=r.height+On,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=l}placeCollisionBox(r,l,f,_,y,w,S){let k=l.projectedAnchorX,z=l.projectedAnchorY,P=l.projectedAnchorZ;const O=l.elevation,V=l.tileID;if(O&&V){const te=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),re=te.upVector(V.canonical,l.tileAnchorX,l.tileAnchorY),ae=te.upVectorScale(V.canonical);k+=re[0]*O*ae,z+=re[1]*O*ae,P+=re[2]*O*ae}const K=this.projectAndGetPerspectiveRatio(w,k,z,P,l.tileID),Z=y*K.perspectiveRatio,Y=(l.x1*r+f.x-l.padding)*Z+K.point.x,se=(l.y1*r+f.y-l.padding)*Z+K.point.y,X=(l.x2*r+f.x+l.padding)*Z+K.point.x,ie=(l.y2*r+f.y+l.padding)*Z+K.point.y,ne=K.perspectiveRatio<=.55||K.aboveHorizon;return!this.isInsideGrid(Y,se,X,ie)||!_&&this.grid.hitTest(Y,se,X,ie,S)||ne?{box:[],offscreen:!1}:{box:[Y,se,X,ie],offscreen:this.isOffscreen(Y,se,X,ie)}}placeCollisionCircles(r,l,f,_,y,w,S,k,z,P,O,V,K,Z){const Y=[],se=this.transform.elevation,X=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),ie=se?se.getAtTileOffsetFunc(Z,X):De=>[0,0,0],ne=new a.pointGeometry(l.tileAnchorX,l.tileAnchorY),te=this.transform.projection.projectTilePoint(l.tileAnchorX,l.tileAnchorY,Z.canonical),re=ie(ne),ae=[te.x+re[0],te.y+re[1],te.z+re[2]],ve=this.projectAndGetPerspectiveRatio(w,ae[0],ae[1],ae[2],Z),{perspectiveRatio:Ee}=ve,Xe=(P?y/Ee:y*Ee)/a.ONE_EM,Ve=qr(new a.pointGeometry(ae[0],ae[1]),S,ae[2]).point,je=ve.signedDistanceFromCamera>0?Ql(Xe,_,l.lineOffsetX*Xe,l.lineOffsetY*Xe,!1,Ve,ne,l,f,S,{},se&&!P?ie:null,P&&!!se,this.transform.projection,Z):null;let Ce=!1,Te=!1,Ne=!0;if(je&&!ve.aboveHorizon){const De=.5*V*Ee+K,ct=new a.pointGeometry(-100,-100),mt=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),It=new cr,We=je.first,ft=je.last;let xt=[];for(let yt=We.path.length-1;yt>=1;yt--)xt.push(We.path[yt]);for(let yt=1;yt<ft.path.length;yt++)xt.push(ft.path[yt]);const ar=2.5*De;if(k){const yt=xt.map(se?(Lt,Mr)=>{const ti=ie(Mr<We.path.length-1?We.tilePath[We.path.length-1-Mr]:ft.tilePath[Mr-We.path.length+2]);return qr(Lt,k,ti[2])}:Lt=>qr(Lt,k));xt=yt.some(Lt=>Lt.signedDistanceFromCamera<=0)?[]:yt.map(Lt=>Lt.point)}let vr=[];if(xt.length>0){const yt=xt[0].clone(),Lt=xt[0].clone();for(let Mr=1;Mr<xt.length;Mr++)yt.x=Math.min(yt.x,xt[Mr].x),yt.y=Math.min(yt.y,xt[Mr].y),Lt.x=Math.max(Lt.x,xt[Mr].x),Lt.y=Math.max(Lt.y,xt[Mr].y);vr=yt.x>=ct.x&&Lt.x<=mt.x&&yt.y>=ct.y&&Lt.y<=mt.y?[xt]:Lt.x<ct.x||yt.x>mt.x||Lt.y<ct.y||yt.y>mt.y?[]:a.clipLine([xt],ct.x,ct.y,mt.x,mt.y)}for(const yt of vr){It.reset(yt,.25*De);let Lt=0;Lt=It.length<=.5*De?1:Math.ceil(It.paddedLength/ar)+1;for(let Mr=0;Mr<Lt;Mr++){const ti=Mr/Math.max(Lt-1,1),Di=It.lerp(ti),hn=Di.x+On,In=Di.y+On;Y.push(hn,In,De,0);const $t=hn-De,bt=In-De,Ft=hn+De,jr=In+De;if(Ne=Ne&&this.isOffscreen($t,bt,Ft,jr),Te=Te||this.isInsideGrid($t,bt,Ft,jr),!r&&this.grid.hitTestCircle(hn,In,De,O)&&(Ce=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Ce}}}}return{circles:!z&&Ce||!Te?[]:Y,offscreen:Ne,collisionDetected:Ce}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let f=1/0,_=1/0,y=-1/0,w=-1/0;for(const P of r){const O=new a.pointGeometry(P.x+On,P.y+On);f=Math.min(f,O.x),_=Math.min(_,O.y),y=Math.max(y,O.x),w=Math.max(w,O.y),l.push(O)}const S=this.grid.query(f,_,y,w).concat(this.ignoredGrid.query(f,_,y,w)),k={},z={};for(const P of S){const O=P.key;if(k[O.bucketInstanceId]===void 0&&(k[O.bucketInstanceId]={}),k[O.bucketInstanceId][O.featureIndex])continue;const V=[new a.pointGeometry(P.x1,P.y1),new a.pointGeometry(P.x2,P.y1),new a.pointGeometry(P.x2,P.y2),new a.pointGeometry(P.x1,P.y2)];a.polygonIntersectsPolygon(l,V)&&(k[O.bucketInstanceId][O.featureIndex]=!0,z[O.bucketInstanceId]===void 0&&(z[O.bucketInstanceId]=[]),z[O.bucketInstanceId].push(O.featureIndex))}return z}insertCollisionBox(r,l,f,_,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:y},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,f,_,y){const w=l?this.ignoredGrid:this.grid,S={bucketInstanceId:f,featureIndex:_,collisionGroupID:y};for(let k=0;k<r.length;k+=4)w.insertCircle(S,r[k],r[k+1],r[k+2])}projectAndGetPerspectiveRatio(r,l,f,_,y){const w=[l,f,_||0,1];let S=!1;if(_||this.transform.pitch>0){a.transformMat4$1(w,w,r);let k=!1;this.fogState&&y&&(k=function(z,P,O,V,K,Z){const Y=Z.calculateFogTileMatrix(K),se=[P,O,V];return a.transformMat4(se,se,Y),at(z,se,Z.pitch,Z._fov)}(this.fogState,l,f,_||0,y.toUnwrapped(),this.transform)>.9),S=w[2]>w[3]||k}else Ls(w,w,r);return{point:new a.pointGeometry((w[0]/w[3]+1)/2*this.transform.width+On,(-w[1]/w[3]+1)/2*this.transform.height+On),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/w[3]*.5,1.5),signedDistanceFromCamera:w[3],aboveHorizon:S}}isOffscreen(r,l,f,_){return f<On||r>=this.screenRightBoundary||_<On||l>this.screenBottomBoundary}isInsideGrid(r,l,f,_){return f>=0&&r<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=a.identity([]);return a.translate(r,r,[-100,-100,0]),r}}class Pu{constructor(r,l,f,_){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class Jo{constructor(r,l,f,_,y,w=!1){this.text=new Pu(r?r.text:null,l,f,y),this.icon=new Pu(r?r.icon:null,l,_,y),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Qo{constructor(r,l,f,_=!1){this.text=r,this.icon=l,this.skipFade=f,this.clipped=_}}class Rs{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Du{constructor(r,l,f,_,y){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=y}}class Lu{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:f=>f.collisionGroupID===l}}return this.collisionGroups[r]}}function Ma(d,r,l,f,_){const{horizontalAlign:y,verticalAlign:w}=a.getAnchorAlignment(d),S=-(y-.5)*r,k=-(w-.5)*l,z=a.evaluateVariableOffset(d,f);return new a.pointGeometry(S+z[0]*_,k+z[1]*_)}function fo(d,r,l,f,_){const y=new a.pointGeometry(d,r);return l&&y._rotate(f?_:-_),y}class Ia{constructor(r,l,f,_,y){this.transform=r.clone(),this.collisionIndex=new Jd(this.transform,y),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Lu(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,f,_){const y=f.getBucket(l),w=f.latestFeatureIndex;if(!y||!w||l.id!==y.layerIds[0])return;const S=y.layers[0].layout,k=f.collisionBoxArray,z=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),P=f.tileSize/a.EXTENT,O=f.tileID.toUnwrapped(),V=this.transform.calculateProjMatrix(O),K=S.get("text-pitch-alignment")==="map",Z=S.get("text-rotation-alignment")==="map";l.compileFilter();const Y=l.dynamicFilter(),se=l.dynamicFilterNeedsFeature(),X=this.transform.calculatePixelsToTileUnitsMatrix(f),ie=on(V,f.tileID.canonical,K,Z,this.transform,X);let ne=null;if(K){const ae=sn(V,f.tileID.canonical,K,Z,this.transform,X);ne=a.multiply$1([],this.transform.labelPlaneMatrix,ae)}let te=null;Y&&f.latestFeatureIndex&&(te={unwrappedTileID:O,dynamicFilter:Y,dynamicFilterNeedsFeature:se,featureIndex:f.latestFeatureIndex}),this.retainedQueryData[y.bucketInstanceId]=new Du(y.bucketInstanceId,w,y.sourceLayerIndex,y.index,f.tileID);const re={bucket:y,layout:S,posMatrix:V,textLabelPlaneMatrix:ie,labelToScreenMatrix:ne,clippingData:te,scale:z,textPixelRatio:P,holdingForFade:f.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(y.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(_)for(const ae of y.sortKeyRanges){const{sortKey:ve,symbolInstanceStart:Ee,symbolInstanceEnd:Xe}=ae;r.push({sortKey:ve,symbolInstanceStart:Ee,symbolInstanceEnd:Xe,parameters:re})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:re})}attemptAnchorPlacement(r,l,f,_,y,w,S,k,z,P,O,V,K,Z,Y,se,X,ie){const ne=[V.textOffset0,V.textOffset1],te=Ma(r,f,_,ne,y),re=this.collisionIndex.placeCollisionBox(y,l,fo(te.x,te.y,w,S,this.transform.angle),O,k,z,P.predicate);if((!se||this.collisionIndex.placeCollisionBox(Z.getSymbolInstanceIconSize(ie,this.transform.zoom,K),se,fo(te.x,te.y,w,S,this.transform.angle),O,k,z,P.predicate).box.length!==0)&&re.box.length>0){let ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(ae=this.prevPlacement.variableOffsets[V.crossTileID].anchor),this.variableOffsets[V.crossTileID]={textOffset:ne,width:f,height:_,anchor:r,textScale:y,prevAnchor:ae},this.markUsedJustification(Z,r,V,Y),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,Y,V),this.placedOrientations[V.crossTileID]=Y),{shift:te,placedGlyphBoxes:re}}}placeLayerBucketPart(r,l,f,_){const{bucket:y,layout:w,posMatrix:S,textLabelPlaneMatrix:k,labelToScreenMatrix:z,clippingData:P,textPixelRatio:O,holdingForFade:V,collisionBoxArray:K,partiallyEvaluatedTextSize:Z,partiallyEvaluatedIconSize:Y,collisionGroup:se}=r.parameters,X=w.get("text-optional"),ie=w.get("icon-optional"),ne=w.get("text-allow-overlap"),te=w.get("icon-allow-overlap"),re=w.get("text-rotation-alignment")==="map",ae=w.get("text-pitch-alignment")==="map",ve=w.get("icon-text-fit")!=="none",Ee=w.get("symbol-z-order")==="viewport-y",Xe=ne&&(te||!y.hasIconData()||ie),Ve=te&&(ne||!y.hasTextData()||X);!y.collisionArrays&&K&&y.deserializeCollisionBoxes(K),f&&_&&y.updateCollisionDebugBuffers(this.transform.zoom,K);const je=(Ce,Te,Ne)=>{if(P){const $t={zoom:this.transform.zoom,pitch:this.transform.pitch};let bt=null;if(P.dynamicFilterNeedsFeature){const Ft=this.retainedQueryData[y.bucketInstanceId];bt=P.featureIndex.loadFeature({featureIndex:Ce.featureIndex,bucketIndex:Ft.bucketIndex,sourceLayerIndex:Ft.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,P.dynamicFilter)($t,bt,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new a.pointGeometry(Ce.tileAnchorX,Ce.tileAnchorY),this.transform.calculateDistanceTileData(P.unwrappedTileID)))return this.placements[Ce.crossTileID]=new Qo(!1,!1,!1,!0),void(l[Ce.crossTileID]=!0)}if(l[Ce.crossTileID])return;if(V)return void(this.placements[Ce.crossTileID]=new Qo(!1,!1,!1));let De=!1,ct=!1,mt=!0,It=null,We={box:null,offscreen:null},ft={box:null,offscreen:null},xt=null,ar=null,vr=null,yt=0,Lt=0,Mr=0;Ne.textFeatureIndex?yt=Ne.textFeatureIndex:Ce.useRuntimeCollisionCircles&&(yt=Ce.featureIndex),Ne.verticalTextFeatureIndex&&(Lt=Ne.verticalTextFeatureIndex);const ti=$t=>{$t.tileID=this.retainedQueryData[y.bucketInstanceId].tileID,(this.transform.elevation||$t.elevation)&&($t.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[y.bucketInstanceId].tileID,$t.tileAnchorX,$t.tileAnchorY):0)},Di=Ne.textBox;if(Di){ti(Di);const $t=Ft=>{let jr=a.WritingMode.horizontal;if(y.allowVerticalPlacement&&!Ft&&this.prevPlacement){const Zi=this.prevPlacement.placedOrientations[Ce.crossTileID];Zi&&(this.placedOrientations[Ce.crossTileID]=Zi,jr=Zi,this.markUsedOrientation(y,jr,Ce))}return jr},bt=(Ft,jr)=>{if(y.allowVerticalPlacement&&Ce.numVerticalGlyphVertices>0&&Ne.verticalTextBox){for(const Zi of y.writingModes)if(Zi===a.WritingMode.vertical?(We=jr(),ft=We):We=Ft(),We&&We.box&&We.box.length)break}else We=Ft()};if(w.get("text-variable-anchor")){let Ft=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ce.crossTileID]){const Ar=this.prevPlacement.variableOffsets[Ce.crossTileID];Ft.indexOf(Ar.anchor)>0&&(Ft=Ft.filter(Wi=>Wi!==Ar.anchor),Ft.unshift(Ar.anchor))}const jr=(Ar,Wi,sa)=>{const Li=y.getSymbolInstanceTextSize(Z,Ce,this.transform.zoom,Te),Uo=(Ar.x2-Ar.x1)*Li+2*Ar.padding,nt=(Ar.y2-Ar.y1)*Li+2*Ar.padding,pt=ve&&!te?Wi:null;pt&&ti(pt);let li={box:[],offscreen:!1};const jo=ne?2*Ft.length:Ft.length;for(let Eo=0;Eo<jo;++Eo){const pi=this.attemptAnchorPlacement(Ft[Eo%Ft.length],Ar,Uo,nt,Li,re,ae,O,S,se,Eo>=Ft.length,Ce,Te,y,sa,pt,Z,Y);if(pi&&(li=pi.placedGlyphBoxes,li&&li.box&&li.box.length)){De=!0,It=pi.shift;break}}return li};bt(()=>jr(Di,Ne.iconBox,a.WritingMode.horizontal),()=>{const Ar=Ne.verticalTextBox;return Ar&&ti(Ar),y.allowVerticalPlacement&&!(We&&We.box&&We.box.length)&&Ce.numVerticalGlyphVertices>0&&Ar?jr(Ar,Ne.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null}}),We&&(De=We.box,mt=We.offscreen);const Zi=$t(We&&We.box);if(!De&&this.prevPlacement){const Ar=this.prevPlacement.variableOffsets[Ce.crossTileID];Ar&&(this.variableOffsets[Ce.crossTileID]=Ar,this.markUsedJustification(y,Ar.anchor,Ce,Zi))}}else{const Ft=(jr,Zi)=>{const Ar=y.getSymbolInstanceTextSize(Z,Ce,this.transform.zoom,Te),Wi=this.collisionIndex.placeCollisionBox(Ar,jr,new a.pointGeometry(0,0),ne,O,S,se.predicate);return Wi&&Wi.box&&Wi.box.length&&(this.markUsedOrientation(y,Zi,Ce),this.placedOrientations[Ce.crossTileID]=Zi),Wi};bt(()=>Ft(Di,a.WritingMode.horizontal),()=>{const jr=Ne.verticalTextBox;return y.allowVerticalPlacement&&Ce.numVerticalGlyphVertices>0&&jr?(ti(jr),Ft(jr,a.WritingMode.vertical)):{box:null,offscreen:null}}),$t(We&&We.box&&We.box.length)}}if(xt=We,De=xt&&xt.box&&xt.box.length>0,mt=xt&&xt.offscreen,Ce.useRuntimeCollisionCircles){const $t=y.text.placedSymbolArray.get(Ce.centerJustifiedTextSymbolIndex>=0?Ce.centerJustifiedTextSymbolIndex:Ce.verticalPlacedTextSymbolIndex),bt=a.evaluateSizeForFeature(y.textSizeData,Z,$t),Ft=w.get("text-padding");ar=this.collisionIndex.placeCollisionCircles(ne,$t,y.lineVertexArray,y.glyphOffsetArray,bt,S,k,z,f,ae,se.predicate,Ce.collisionCircleDiameter*bt/a.ONE_EM,Ft,this.retainedQueryData[y.bucketInstanceId].tileID),De=ne||ar.circles.length>0&&!ar.collisionDetected,mt=mt&&ar.offscreen}if(Ne.iconFeatureIndex&&(Mr=Ne.iconFeatureIndex),Ne.iconBox){const $t=bt=>{ti(bt);const Ft=ve&&It?fo(It.x,It.y,re,ae,this.transform.angle):new a.pointGeometry(0,0),jr=y.getSymbolInstanceIconSize(Y,this.transform.zoom,Te);return this.collisionIndex.placeCollisionBox(jr,bt,Ft,te,O,S,se.predicate)};ft&&ft.box&&ft.box.length&&Ne.verticalIconBox?(vr=$t(Ne.verticalIconBox),ct=vr.box.length>0):(vr=$t(Ne.iconBox),ct=vr.box.length>0),mt=mt&&vr.offscreen}const hn=X||Ce.numHorizontalGlyphVertices===0&&Ce.numVerticalGlyphVertices===0,In=ie||Ce.numIconVertices===0;if(hn||In?In?hn||(ct=ct&&De):De=ct&&De:ct=De=ct&&De,De&&xt&&xt.box&&this.collisionIndex.insertCollisionBox(xt.box,w.get("text-ignore-placement"),y.bucketInstanceId,ft&&ft.box&&Lt?Lt:yt,se.ID),ct&&vr&&this.collisionIndex.insertCollisionBox(vr.box,w.get("icon-ignore-placement"),y.bucketInstanceId,Mr,se.ID),ar&&(De&&this.collisionIndex.insertCollisionCircles(ar.circles,w.get("text-ignore-placement"),y.bucketInstanceId,yt,se.ID),f)){const $t=y.bucketInstanceId;let bt=this.collisionCircleArrays[$t];bt===void 0&&(bt=this.collisionCircleArrays[$t]=new Rs);for(let Ft=0;Ft<ar.circles.length;Ft+=4)bt.circles.push(ar.circles[Ft+0]),bt.circles.push(ar.circles[Ft+1]),bt.circles.push(ar.circles[Ft+2]),bt.circles.push(ar.collisionDetected?1:0)}this.placements[Ce.crossTileID]=new Qo(De||Xe,ct||Ve,mt||y.justReloaded),l[Ce.crossTileID]=!0};if(Ee){const Ce=y.getSortedSymbolIndexes(this.transform.angle);for(let Te=Ce.length-1;Te>=0;--Te){const Ne=Ce[Te];je(y.symbolInstances.get(Ne),Ne,y.collisionArrays[Ne])}}else for(let Ce=r.symbolInstanceStart;Ce<r.symbolInstanceEnd;Ce++)je(y.symbolInstances.get(Ce),Ce,y.collisionArrays[Ce]);if(f&&y.bucketInstanceId in this.collisionCircleArrays){const Ce=this.collisionCircleArrays[y.bucketInstanceId];a.invert(Ce.invProjMatrix,S),Ce.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(r,l,f,_){let y;y=_===a.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(l)];const w=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const S of w)S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=y>=0&&S!==y?0:f.crossTileID)}markUsedOrientation(r,l,f){const _=l===a.WritingMode.horizontal||l===a.WritingMode.horizontalOnly?l:0,y=l===a.WritingMode.vertical?l:0,w=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const S of w)r.text.placedSymbolArray.get(S).placedOrientation=_;f.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let f=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const _=l?l.symbolFadeChange(r):1,y=l?l.opacities:{},w=l?l.variableOffsets:{},S=l?l.placedOrientations:{};for(const k in this.placements){const z=this.placements[k],P=y[k];P?(this.opacities[k]=new Jo(P,_,z.text,z.icon,null,z.clipped),f=f||z.text!==P.text.placed||z.icon!==P.icon.placed):(this.opacities[k]=new Jo(null,_,z.text,z.icon,z.skipFade,z.clipped),f=f||z.text||z.icon)}for(const k in y){const z=y[k];if(!this.opacities[k]){const P=new Jo(z,_,!1,!1);P.isHidden()||(this.opacities[k]=P,f=f||z.text.placed||z.icon.placed)}}for(const k in w)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=w[k]);for(const k in S)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=S[k]);f?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){const f={};for(const _ of l){const y=_.getBucket(r);y&&_.latestFeatureIndex&&r.id===y.layerIds[0]&&this.updateBucketOpacities(y,f,_.collisionBoxArray)}}updateBucketOpacities(r,l,f){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const _=r.layers[0].layout,y=!!r.layers[0].dynamicFilter(),w=new Jo(null,0,!1,!1,!0),S=_.get("text-allow-overlap"),k=_.get("icon-allow-overlap"),z=_.get("text-variable-anchor"),P=_.get("text-rotation-alignment")==="map",O=_.get("text-pitch-alignment")==="map",V=_.get("icon-text-fit")!=="none",K=new Jo(null,0,S&&(k||!r.hasIconData()||_.get("icon-optional")),k&&(S||!r.hasTextData()||_.get("text-optional")),!0);!r.collisionArrays&&f&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(f);const Z=(se,X,ie)=>{for(let ne=0;ne<X/4;ne++)se.opacityVertexArray.emplaceBack(ie)};let Y=0;for(let se=0;se<r.symbolInstances.length;se++){const X=r.symbolInstances.get(se),{numHorizontalGlyphVertices:ie,numVerticalGlyphVertices:ne,crossTileID:te}=X;let re=this.opacities[te];l[te]?re=w:re||(re=K,this.opacities[te]=re),l[te]=!0;const ae=ie>0||ne>0,ve=X.numIconVertices>0,Ee=this.placedOrientations[X.crossTileID],Xe=Ee===a.WritingMode.vertical,Ve=Ee===a.WritingMode.horizontal||Ee===a.WritingMode.horizontalOnly;if(!ae&&!ve||re.isHidden()||Y++,ae){const je=ka(re.text);Z(r.text,ie,Xe?_o:je),Z(r.text,ne,Ve?_o:je);const Ce=re.text.isHidden();[X.rightJustifiedTextSymbolIndex,X.centerJustifiedTextSymbolIndex,X.leftJustifiedTextSymbolIndex].forEach(De=>{De>=0&&(r.text.placedSymbolArray.get(De).hidden=Ce||Xe?1:0)}),X.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(X.verticalPlacedTextSymbolIndex).hidden=Ce||Ve?1:0);const Te=this.variableOffsets[X.crossTileID];Te&&this.markUsedJustification(r,Te.anchor,X,Ee);const Ne=this.placedOrientations[X.crossTileID];Ne&&(this.markUsedJustification(r,"left",X,Ne),this.markUsedOrientation(r,Ne,X))}if(ve){const je=ka(re.icon);X.placedIconSymbolIndex>=0&&(Z(r.icon,X.numIconVertices,Xe?_o:je),r.icon.placedSymbolArray.get(X.placedIconSymbolIndex).hidden=re.icon.isHidden()),X.verticalPlacedIconSymbolIndex>=0&&(Z(r.icon,X.numVerticalIconVertices,Ve?_o:je),r.icon.placedSymbolArray.get(X.verticalPlacedIconSymbolIndex).hidden=re.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const je=r.collisionArrays[se];if(je){let Ce=new a.pointGeometry(0,0),Te=!0;if(je.textBox||je.verticalTextBox){if(z){const De=this.variableOffsets[te];De?(Ce=Ma(De.anchor,De.width,De.height,De.textOffset,De.textScale),P&&Ce._rotate(O?this.transform.angle:-this.transform.angle)):Te=!1}y&&(Te=!re.clipped),je.textBox&&po(r.textCollisionBox.collisionVertexArray,re.text.placed,!Te||Xe,Ce.x,Ce.y),je.verticalTextBox&&po(r.textCollisionBox.collisionVertexArray,re.text.placed,!Te||Ve,Ce.x,Ce.y)}const Ne=Te&&Boolean(!Ve&&je.verticalIconBox);je.iconBox&&po(r.iconCollisionBox.collisionVertexArray,re.icon.placed,Ne,V?Ce.x:0,V?Ce.y:0),je.verticalIconBox&&po(r.iconCollisionBox.collisionVertexArray,re.icon.placed,!Ne,V?Ce.x:0,V?Ce.y:0)}}}if(r.fullyClipped=Y===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=se.invProjMatrix,r.placementViewportMatrix=se.viewportMatrix,r.collisionCircleArray=se.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const f=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*f>r}setStale(){this.stale=!0}}function po(d,r,l,f,_){d.emplaceBack(r?1:0,l?1:0,f||0,_||0),d.emplaceBack(r?1:0,l?1:0,f||0,_||0),d.emplaceBack(r?1:0,l?1:0,f||0,_||0),d.emplaceBack(r?1:0,l?1:0,f||0,_||0)}const Ae=Math.pow(2,25),et=Math.pow(2,24),Ru=Math.pow(2,17),mo=Math.pow(2,16),Zr=Math.pow(2,9),Zn=Math.pow(2,8),Bn=Math.pow(2,1);function ka(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const r=d.placed?1:0,l=Math.floor(127*d.opacity);return l*Ae+r*et+l*Ru+r*mo+l*Zr+r*Zn+l*Bn+r}const _o=0;class Qe{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,l,f,_,y){const w=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(w,_,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((S,k)=>S.sortKey-k.sortKey));this._currentPartIndex<w.length;){const S=w[this._currentPartIndex];if(l.placeLayerBucketPart(S,this._seenCrossTileIDs,f,S.symbolInstanceStart===0),this._currentPartIndex++,y())return!0}return!1}}class Bt{constructor(r,l,f,_,y,w,S,k){this.placement=new Ia(r,y,w,S,k),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(r,l,f){const _=a.exported.now(),y=()=>{const w=a.exported.now()-_;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){const w=l[r[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=S)&&(!w.maxzoom||w.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Qe(w)),this._inProgressLayer.continuePlacement(f[w.source],this.placement,this._showCollisionBoxes,w,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const zt=512/a.EXTENT/2;class Fn{constructor(r,l,f){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(let _=0;_<l.length;_++){const y=l.get(_),w=y.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:y.crossTileID,coord:this.getScaledCoordinates(y,r)})}}getScaledCoordinates(r,l){const f=zt/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*a.EXTENT+r.tileAnchorX)*f),y:Math.floor((l.canonical.y*a.EXTENT+r.tileAnchorY)*f)}}findMatches(r,l,f){const _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let y=0;y<r.length;y++){const w=r.get(y);if(w.crossTileID)continue;const S=this.indexedSymbolInstances[w.key];if(!S)continue;const k=this.getScaledCoordinates(w,l);for(const z of S)if(Math.abs(z.coord.x-k.x)<=_&&Math.abs(z.coord.y-k.y)<=_&&!f[z.crossTileID]){f[z.crossTileID]=!0,w.crossTileID=z.crossTileID;break}}}}class es{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Pt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(l!==0)for(const f in this.indexes){const _=this.indexes[f],y={};for(const w in _){const S=_[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+l),y[S.tileID.key]=S}this.indexes[f]=y}this.lng=r}addBucket(r,l,f){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let y=0;y<l.symbolInstances.length;y++)l.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const _=this.usedCrossTileIDs[r.overscaledZ];for(const y in this.indexes){const w=this.indexes[y];if(Number(y)>r.overscaledZ)for(const S in w){const k=w[S];k.tileID.isChildOf(r)&&k.findMatches(l.symbolInstances,r,_)}else{const S=w[r.scaledTo(Number(y)).key];S&&S.findMatches(l.symbolInstances,r,_)}}for(let y=0;y<l.symbolInstances.length;y++){const w=l.symbolInstances.get(y);w.crossTileID||(w.crossTileID=f.generate(),_[w.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Fn(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const f in l.indexedSymbolInstances)for(const _ of l.indexedSymbolInstances[f])delete this.usedCrossTileIDs[r][_.crossTileID]}removeStaleBuckets(r){let l=!1;for(const f in this.indexes){const _=this.indexes[f];for(const y in _)r[_[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[y]),delete _[y],l=!0)}return l}}class Os{constructor(){this.layerIndexes={},this.crossTileIDs=new es,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,f,_){let y=this.layerIndexes[r.id];y===void 0&&(y=this.layerIndexes[r.id]=new Pt);let w=!1;const S={};_.name!=="globe"&&y.handleWrapJump(f);for(const k of l){const z=k.getBucket(r);z&&r.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(k.tileID,z,this.crossTileIDs)&&(w=!0),S[z.bucketInstanceId]=!0)}return y.removeStaleBuckets(S)&&(w=!0),w}pruneUnusedLayers(r){const l={};r.forEach(f=>{l[f]=!0});for(const f in this.layerIndexes)l[f]||delete this.layerIndexes[f]}}const go=(d,r)=>a.emitValidationErrors(d,r&&r.filter(l=>l.identifier!=="source.canvas")),Bs=a.pick(Oe,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),an=a.pick(Oe,["setCenter","setZoom","setBearing","setPitch"]),Fr=function(){const d={},r=a.spec.$version;for(const l in a.spec.$root){const f=a.spec.$root[l];if(f.required){let _=null;_=l==="version"?r:f.type==="array"?[]:{},_!=null&&(d[l]=_)}}return d}(),Qd={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class zi extends a.Evented{constructor(r,l={}){super(),this.map=r,this.dispatcher=new $r(ue(),this),this.imageManager=new Le,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(r._requestManager,l.localFontFamily?a.LocalGlyphMode.all:l.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.lineAtlas=new a.LineAtlas(256,512),this.crossTileSymbolIndex=new Os,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const f=this;this._rtlTextPluginCallback=zi.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(y,w)=>{if(a.triggerPluginCompletionEvent(y),w&&w.every(S=>S))for(const S in f._sourceCaches){const k=f._sourceCaches[S],z=k.getSource().type;z!=="vector"&&z!=="geojson"||k.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const y=this.getSource(_.sourceId);if(y&&y.vectorLayerIds)for(const w in this._layers){const S=this._layers[w];S.source===y.id&&this._validateLayer(S)}})}loadURL(r,l={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const f=typeof l.validate=="boolean"?l.validate:!a.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,l.accessToken);const _=this.map._requestManager.transformRequest(r,a.ResourceType.Style);this._request=a.getJSON(_,(y,w)=>{this._request=null,y?this.fire(new a.ErrorEvent(y)):w&&this._load(w,f)})}loadJSON(r,l={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(r,l.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Fr,!1)}_updateLayerCount(r,l){const f=l?1:-1;r.is3D()&&(this._num3DLayers+=f),r.type==="circle"&&(this._numCircleLayers+=f),r.type==="symbol"&&(this._numSymbolLayers+=f)}_load(r,l){if(l&&go(this,a.validateStyle(r)))return;this._loaded=!0,this.stylesheet=r,this.updateProjection();for(const _ in r.sources)this.addSource(_,r.sources[_],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const f=ke(this.stylesheet.layers);this._order=f.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of f)_=a.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Se(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&this.terrain.drapeRenderMode===0}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const r=this.map.transform.projection,l=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),f=this.map.transform.projection;if(this._loaded&&(f.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),l){if(f.isReprojectedInTileSpace||r.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(r){this._spriteRequest=function(l,f,_){let y,w,S;const k=a.exported.devicePixelRatio>1?"@2x":"";let z=a.getJSON(f.transformRequest(f.normalizeSpriteURL(l,k,".json"),a.ResourceType.SpriteJSON),(V,K)=>{z=null,S||(S=V,y=K,O())}),P=a.getImage(f.transformRequest(f.normalizeSpriteURL(l,k,".png"),a.ResourceType.SpriteImage),(V,K)=>{P=null,S||(S=V,w=K,O())});function O(){if(S)_(S);else if(y&&w){const V=a.exported.getImageData(w),K={};for(const Z in y){const{width:Y,height:se,x:X,y:ie,sdf:ne,pixelRatio:te,stretchX:re,stretchY:ae,content:ve}=y[Z],Ee=new a.RGBAImage({width:Y,height:se});a.RGBAImage.copy(V,Ee,{x:X,y:ie},{x:0,y:0},{width:Y,height:se}),K[Z]={data:Ee,pixelRatio:te,sdf:ne,stretchX:re,stretchY:ae,content:ve}}_(null,K)}}return{cancel(){z&&(z.cancel(),z=null),P&&(P.cancel(),P=null)}}}(r,this.map._requestManager,(l,f)=>{if(this._spriteRequest=null,l)this.fire(new a.ErrorEvent(l));else if(f)for(const _ in f)this.imageManager.addImage(_,f[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(r){const l=this.getSource(r.source);if(!l)return;const f=r.sourceLayer;f&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(f)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${l.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const l=[];for(const f of r){const _=this._layers[f];_.type!=="custom"&&l.push(_.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&Qd[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const l=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(_.length||y.length)&&this._updateWorkerLayers(_,y);for(const w in this._updatedSources){const S=this._updatedSources[w];S==="reload"?this._reloadSource(w):S==="clear"&&this._clearSource(w)}this._updateTilesForChangedImages();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const f={};for(const _ in this._sourceCaches){const y=this._sourceCaches[_];f[_]=y.used,y.used=!1}for(const _ of this._order){const y=this._layers[_];if(y.recalculate(r,this._availableImages),!y.isHidden(r.zoom)){const S=this._getLayerSourceCache(y);S&&(S.used=!0)}const w=this.map.painter;if(w){const S=y.getProgramIds();if(!S)continue;const k=y.getProgramConfiguration(r.zoom);for(const z of S)w.useProgram(z,k)}}for(const _ in f){const y=this._sourceCaches[_];f[_]!==y.used&&y.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:y.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),go(this,a.validateStyle(r)))return!1;(r=a.clone$1(r)).layers=ke(r.layers);const l=function(_,y){if(!_)return[{command:Oe.setStyle,args:[y]}];let w=[];try{if(!q(_.version,y.version))return[{command:Oe.setStyle,args:[y]}];q(_.center,y.center)||w.push({command:Oe.setCenter,args:[y.center]}),q(_.zoom,y.zoom)||w.push({command:Oe.setZoom,args:[y.zoom]}),q(_.bearing,y.bearing)||w.push({command:Oe.setBearing,args:[y.bearing]}),q(_.pitch,y.pitch)||w.push({command:Oe.setPitch,args:[y.pitch]}),q(_.sprite,y.sprite)||w.push({command:Oe.setSprite,args:[y.sprite]}),q(_.glyphs,y.glyphs)||w.push({command:Oe.setGlyphs,args:[y.glyphs]}),q(_.transition,y.transition)||w.push({command:Oe.setTransition,args:[y.transition]}),q(_.light,y.light)||w.push({command:Oe.setLight,args:[y.light]}),q(_.fog,y.fog)||w.push({command:Oe.setFog,args:[y.fog]}),q(_.projection,y.projection)||w.push({command:Oe.setProjection,args:[y.projection]});const S={},k=[];(function(O,V,K,Z){let Y;for(Y in V=V||{},O=O||{})O.hasOwnProperty(Y)&&(V.hasOwnProperty(Y)||lt(Y,K,Z));for(Y in V)V.hasOwnProperty(Y)&&(O.hasOwnProperty(Y)?q(O[Y],V[Y])||(O[Y].type==="geojson"&&V[Y].type==="geojson"&&ht(O,V,Y)?K.push({command:Oe.setGeoJSONSourceData,args:[Y,V[Y].data]}):ut(Y,V,K,Z)):Ue(Y,V,K))})(_.sources,y.sources,k,S);const z=[];_.layers&&_.layers.forEach(O=>{S[O.source]?w.push({command:Oe.removeLayer,args:[O.id]}):z.push(O)});let P=_.terrain;P&&S[P.source]&&(w.push({command:Oe.setTerrain,args:[void 0]}),P=void 0),w=w.concat(k),q(P,y.terrain)||w.push({command:Oe.setTerrain,args:[y.terrain]}),function(O,V,K){V=V||[];const Z=(O=O||[]).map(Mt),Y=V.map(Mt),se=O.reduce(ir,{}),X=V.reduce(ir,{}),ie=Z.slice(),ne=Object.create(null);let te,re,ae,ve,Ee,Xe,Ve;for(te=0,re=0;te<Z.length;te++)ae=Z[te],X.hasOwnProperty(ae)?re++:(K.push({command:Oe.removeLayer,args:[ae]}),ie.splice(ie.indexOf(ae,re),1));for(te=0,re=0;te<Y.length;te++)ae=Y[Y.length-1-te],ie[ie.length-1-te]!==ae&&(se.hasOwnProperty(ae)?(K.push({command:Oe.removeLayer,args:[ae]}),ie.splice(ie.lastIndexOf(ae,ie.length-re),1)):re++,Xe=ie[ie.length-te],K.push({command:Oe.addLayer,args:[X[ae],Xe]}),ie.splice(ie.length-te,0,ae),ne[ae]=!0);for(te=0;te<Y.length;te++)if(ae=Y[te],ve=se[ae],Ee=X[ae],!ne[ae]&&!q(ve,Ee))if(q(ve.source,Ee.source)&&q(ve["source-layer"],Ee["source-layer"])&&q(ve.type,Ee.type)){for(Ve in dt(ve.layout,Ee.layout,K,ae,null,Oe.setLayoutProperty),dt(ve.paint,Ee.paint,K,ae,null,Oe.setPaintProperty),q(ve.filter,Ee.filter)||K.push({command:Oe.setFilter,args:[ae,Ee.filter]}),q(ve.minzoom,Ee.minzoom)&&q(ve.maxzoom,Ee.maxzoom)||K.push({command:Oe.setLayerZoomRange,args:[ae,Ee.minzoom,Ee.maxzoom]}),ve)ve.hasOwnProperty(Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&(Ve.indexOf("paint.")===0?dt(ve[Ve],Ee[Ve],K,ae,Ve.slice(6),Oe.setPaintProperty):q(ve[Ve],Ee[Ve])||K.push({command:Oe.setLayerProperty,args:[ae,Ve,Ee[Ve]]}));for(Ve in Ee)Ee.hasOwnProperty(Ve)&&!ve.hasOwnProperty(Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&(Ve.indexOf("paint.")===0?dt(ve[Ve],Ee[Ve],K,ae,Ve.slice(6),Oe.setPaintProperty):q(ve[Ve],Ee[Ve])||K.push({command:Oe.setLayerProperty,args:[ae,Ve,Ee[Ve]]}))}else K.push({command:Oe.removeLayer,args:[ae]}),Xe=ie[ie.lastIndexOf(ae)+1],K.push({command:Oe.addLayer,args:[Ee,Xe]})}(z,y.layers,w)}catch(S){console.warn("Unable to compute style diff:",S),w=[{command:Oe.setStyle,args:[y]}]}return w}(this.serialize(),r).filter(_=>!(_.command in an));if(l.length===0)return!1;const f=l.filter(_=>!(_.command in Bs));if(f.length>0)throw new Error(`Unimplemented: ${f.map(_=>_.command).join(", ")}.`);return l.forEach(_=>{_.command!=="setTransition"&&this[_.command].apply(this,_.args)}),this.stylesheet=r,this.updateProjection(),!0}addImage(r,l){if(this.getImage(r))return this.fire(new a.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(r,l),this._afterImageUpdated(r)}updateImage(r,l){this.imageManager.updateImage(r,l)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new a.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,l,f={}){if(this._checkLoaded(),this.getSource(r)!==void 0)throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(a.validateStyle.source,`sources.${r}`,l,null,f))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const _=Dr(r,l,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:r}));const y=w=>{const S=(w?"symbol:":"other:")+r,k=this._sourceCaches[S]=new a.SourceCache(S,_,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[r]=k,k.style=this,k.onAdd(this.map)};y(!1),l.type!=="vector"&&l.type!=="geojson"||y(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const l=this.getSource(r);if(l===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===r)return this.fire(new a.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new a.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const f=this._getSourceCaches(r);for(const _ of f)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,l){this._checkLoaded(),this.getSource(r).setData(l),this._changed=!0}getSource(r){const l=this._getSourceCache(r);return l&&l.getSource()}addLayer(r,l,f={}){this._checkLoaded();const _=r.id;if(this.getLayer(_))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let y;if(r.type==="custom"){if(go(this,a.validateCustomStyleLayer(r)))return;y=a.createStyleLayer(r)}else{if(typeof r.source=="object"&&(this.addSource(_,r.source),r=a.clone$1(r),r=a.extend(r,{source:_})),this._validate(a.validateStyle.layer,`layers.${_}`,r,{arrayIndex:-1},f))return;y=a.createStyleLayer(r),this._validateLayer(y),y.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0)}const w=l?this._order.indexOf(l):this._order.length;if(l&&w===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=y;const S=this._getLayerSourceCache(y);if(this._removedLayers[_]&&y.source&&S&&y.type!=="custom"){const k=this._removedLayers[_];delete this._removedLayers[_],k.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",S.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,l){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===l)return;const f=this._order.indexOf(r);this._order.splice(f,1);const _=l?this._order.indexOf(l):this._order.length;l&&_===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(_,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const l=this._layers[r];if(!l)return void this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const f=this._order.indexOf(r);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=l,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const l in this._layers)if(this._layers[l].type===r)return!0;return!1}setLayerZoomRange(r,l,f){this._checkLoaded();const _=this.getLayer(r);_?_.minzoom===l&&_.maxzoom===f||(l!=null&&(_.minzoom=l),f!=null&&(_.maxzoom=f),this._updateLayer(_)):this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,l,f={}){this._checkLoaded();const _=this.getLayer(r);if(_){if(!q(_.filter,l))return l==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(a.validateStyle.filter,`layers.${_.id}.filter`,l,{layerType:_.type},f)||(_.filter=a.clone$1(l),this._updateLayer(_)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){return a.clone$1(this.getLayer(r).filter)}setLayoutProperty(r,l,f,_={}){this._checkLoaded();const y=this.getLayer(r);y?q(y.getLayoutProperty(l),f)||(y.setLayoutProperty(l,f,_),this._updateLayer(y)):this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,l){const f=this.getLayer(r);if(f)return f.getLayoutProperty(l);this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,l,f,_={}){this._checkLoaded();const y=this.getLayer(r);y?q(y.getPaintProperty(l),f)||(y.setPaintProperty(l,f,_)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,l){return this.getLayer(r).getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();const f=r.source,_=r.sourceLayer,y=this.getSource(f);if(y===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const w=y.type;if(w==="geojson"&&_)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!_)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(f);for(const k of S)k.setFeatureState(_,r.id,l)}removeFeatureState(r,l){this._checkLoaded();const f=r.source,_=this.getSource(f);if(_===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const y=_.type,w=y==="vector"?r.sourceLayer:void 0;if(y==="vector"&&!w)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(f);for(const k of S)k.removeFeatureState(w,r.id,l)}getFeatureState(r){this._checkLoaded();const l=r.source,f=r.sourceLayer,_=this.getSource(l);if(_!==void 0){if(_.type!=="vector"||f)return r.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(f,r.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const l in this._sourceCaches){const f=this._sourceCaches[l].getSource();r[f.id]||(r[f.id]=f.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},l=>l!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0;const l=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&l&&l.getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",l.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const l=w=>this._layers[w].type==="fill-extrusion",f={},_=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(l(S)){f[S]=w;for(const k of r){const z=k[S];if(z)for(const P of z)_.push(P)}}}_.sort((w,S)=>S.intersectionZ-w.intersectionZ);const y=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(l(S))for(let k=_.length-1;k>=0;k--){const z=_[k].feature;if(f[z.layer.id]<w)break;y.push(z),_.pop()}else for(const k of r){const z=k[S];if(z)for(const P of z)y.push(P.feature)}}return y}queryRenderedFeatures(r,l,f){l&&l.filter&&this._validate(a.validateStyle.filter,"queryRenderedFeatures.filter",l.filter,null,l);const _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const k of l.layers){const z=this._layers[k];if(!z)return this.fire(new a.ErrorEvent(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];_[z.source]=!0}}const y=[];l.availableImages=this._availableImages;const w=l&&l.layers?l.layers.some(k=>{const z=this.getLayer(k);return z&&z.is3D()}):this.has3DLayers(),S=lr.createFromScreenPoints(r,f);for(const k in this._sourceCaches){const z=this._sourceCaches[k].getSource().id;l.layers&&!_[z]||y.push(D(this._sourceCaches[k],this._layers,this._serializedLayers,S,l,f,w,!!this.map._showQueryGeometry))}return this.placement&&y.push(function(k,z,P,O,V,K,Z){const Y={},se=K.queryRenderedSymbols(O),X=[];for(const ie of Object.keys(se).map(Number))X.push(Z[ie]);X.sort(H);for(const ie of X){const ne=ie.featureIndex.lookupSymbolFeatures(se[ie.bucketInstanceId],z,ie.bucketIndex,ie.sourceLayerIndex,V.filter,V.layers,V.availableImages,k);for(const te in ne){const re=Y[te]=Y[te]||[],ae=ne[te];ae.sort((ve,Ee)=>{const Xe=ie.featureSortOrder;if(Xe){const Ve=Xe.indexOf(ve.featureIndex);return Xe.indexOf(Ee.featureIndex)-Ve}return Ee.featureIndex-ve.featureIndex});for(const ve of ae)re.push(ve)}}for(const ie in Y)Y[ie].forEach(ne=>{const te=ne.feature,re=P(k[ie]).getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=re});return Y}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(r,l){l&&l.filter&&this._validate(a.validateStyle.filter,"querySourceFeatures.filter",l.filter,null,l);const f=this._getSourceCaches(r);let _=[];for(const y of f)_=_.concat(U(y,l));return _}addSourceType(r,l,f){return zi.getSourceType(r)?f(new Error(`A source type called "${r}" already exists.`)):(zi.setSourceType(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(r,l={}){this._checkLoaded();const f=this.light.getLight();let _=!1;for(const w in r)if(!q(r[w],f[w])){_=!0;break}if(!_)return;const y={now:a.exported.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,l),this.light.updateTransitions(y)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,l=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(l===1){if(typeof r.source=="object"){const f="terrain-dem-src";this.addSource(f,r.source),r=a.clone$1(r),r=a.extend(r,{source:f})}if(this._validate(a.validateStyle.terrain,"terrain",r))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode)this._createTerrain(r,l);else{const f=this.terrain,_=f.get();for(const y in r)if(!q(r[y],_[y])){f.set(r),this.stylesheet.terrain=r;const w={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};f.updateTransitions(w);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const l=this.fog=new Ut(r,this.map.transform);this.stylesheet.fog=r;const f={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,f=l.get();for(const _ in r)if(!q(r[_],f[_])){l.set(r),this.stylesheet.fog=r;const y={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(y);break}}else this._createFog(r);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(f=>this.isLayerDraped(this._layers[f])),l=this._order.filter(f=>!this.isLayerDraped(this._layers[f]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...l)}_createTerrain(r,l){const f=this.terrain=new it(r,l);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const _={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};f.updateTransitions(_)}_force3DLayerUpdate(){for(const r in this._layers){const l=this._layers[r];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const l=this._layers[r];l.type==="symbol"&&this._updateLayer(l)}}_validate(r,l,f,_,y={}){return(!y||y.validate!==!1)&&go(this,r.call(a.validateStyle,a.extend({key:l,style:this.serialize(),value:f,styleSpec:a.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const l=this._getSourceCaches(r);for(const f of l)f.clearTiles()}_reloadSource(r){const l=this._getSourceCaches(r);for(const f of l)f.resume(),f.reload()}_updateSources(r){for(const l in this._sourceCaches)this._sourceCaches[l].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const l=this._sourceCaches[r];l.resume(),l.reload()}}_updatePlacement(r,l,f,_,y=!1){let w=!1,S=!1;const k={};for(const z of this._order){const P=this._layers[z];if(P.type!=="symbol")continue;if(!k[P.source]){const V=this._getLayerSourceCache(P);if(!V)continue;k[P.source]=V.getRenderableIds(!0).map(K=>V.getTileByID(K)).sort((K,Z)=>Z.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(Z.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(P,k[P.source],r.center.lng,r.projection);w=w||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),y=y||this._layerOrderChanged||f===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(y||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),r.zoom))&&(this.pauseablePlacement=new Bt(r,this._order,y,l,f,_,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),S=!0),w&&this.pauseablePlacement.placement.setStale()),S||w)for(const z of this._order){const P=this._layers[z];P.type==="symbol"&&this.placement.updateLayerOpacities(P,k[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,l,f){this.imageManager.getImages(l.icons,f),this._updateTilesForChangedImages();const _=y=>{y&&y.setDependencies(l.tileID.key,l.type,l.icons)};_(this._otherSourceCaches[l.source]),_(this._symbolSourceCaches[l.source])}getGlyphs(r,l,f){this.glyphManager.getGlyphs(l.stacks,f)}getResource(r,l,f){return a.makeRequest(l,f)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const l=[];return this._otherSourceCaches[r]&&l.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&l.push(this._symbolSourceCaches[r]),l}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}zi.getSourceType=function(d){return $i[d]},zi.setSourceType=function(d,r){$i[d]=r},zi.registerForPluginStateChange=a.registerForPluginStateChange;var za=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,ts="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let rs={},is={};rs=St("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),is=St(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const Xt=St(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {
#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)
return mix(globe,mercator,t);
#else
return globe;
#endif
}
#ifdef PROJECTION_GLOBE_VIEW
mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Pa=za;var rc={background:St(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:St(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:St(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:St("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:St(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:St(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:St("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:St("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:St("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:St(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:St(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:St(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:St(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:St(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:St(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:St(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:St(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:St(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:St(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:St(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:St(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:St(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:St(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:St(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:St(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:St(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ts),skyboxGradient:St(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,ts),skyboxCapture:St(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:St(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:St(`uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)
discard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function St(d,r,l){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,y=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),w=d.match(_),S=r.match(_),k=za.match(_);let z=S?S.concat(w):w;l||(rs.staticUniforms&&(z=rs.staticUniforms.concat(z)),is.staticUniforms&&(z=is.staticUniforms.concat(z))),z&&(z=z.concat(k));const P={};return{fragmentSource:d=d.replace(f,(O,V,K,Z,Y)=>(P[Y]=!0,V==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
varying ${K} ${Z} ${Y};
#else
uniform ${K} ${Z} u_${Y};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Y}
    ${K} ${Z} ${Y} = u_${Y};
#endif
`)),vertexSource:r=r.replace(f,(O,V,K,Z,Y)=>{const se=Z==="float"?"vec2":"vec4",X=Y.match(/color/)?"color":se;return P[Y]?V==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
attribute ${K} ${se} a_${Y};
varying ${K} ${Z} ${Y};
#else
uniform ${K} ${Z} u_${Y};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = a_${Y};
#else
    ${K} ${Z} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = unpack_mix_${X}(a_${Y}, u_${Y}_t);
#else
    ${K} ${Z} ${Y} = u_${Y};
#endif
`:V==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
attribute ${K} ${se} a_${Y};
#else
uniform ${K} ${Z} u_${Y};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${K} ${Z} ${Y} = a_${Y};
#else
    ${K} ${Z} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${K} ${Z} ${Y} = unpack_mix_${X}(a_${Y}, u_${Y}_t);
#else
    ${K} ${Z} ${Y} = u_${Y};
#endif
`}),staticAttributes:y,staticUniforms:z}}class ln{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,l,f,_,y,w,S,k){this.context=r;let z=this.boundPaintVertexBuffers.length!==_.length;for(let P=0;!z&&P<_.length;P++)this.boundPaintVertexBuffers[P]!==_[P]&&(z=!0);r.extVertexArrayObject&&this.vao&&this.boundProgram===l&&this.boundLayoutVertexBuffer===f&&!z&&this.boundIndexBuffer===y&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===k?(r.bindVertexArrayOES.set(this.vao),S&&S.bind(),y&&y.dynamicDraw&&y.bind(),k&&k.bind()):this.freshBind(l,f,_,y,w,S,k)}freshBind(r,l,f,_,y,w,S){let k;const z=r.numAttributes,P=this.context,O=P.gl;if(P.extVertexArrayObject)this.vao&&this.destroy(),this.vao=P.extVertexArrayObject.createVertexArrayOES(),P.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=S;else{k=P.currentNumAttributes||0;for(let V=z;V<k;V++)O.disableVertexAttribArray(V)}l.enableAttributes(O,r);for(const V of f)V.enableAttributes(O,r);w&&w.enableAttributes(O,r),S&&S.enableAttributes(O,r),l.bind(),l.setVertexAttribPointers(O,r,y);for(const V of f)V.bind(),V.setVertexAttribPointers(O,r,y);w&&(w.bind(),w.setVertexAttribPointers(O,r,y)),_&&_.bind(),S&&(S.bind(),S.setVertexAttribPointers(O,r,y)),P.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ou(d,r){const l=Math.pow(2,r.canonical.z),f=r.canonical.y;return[new a.MercatorCoordinate(0,f/l).toLngLat().lat,new a.MercatorCoordinate(0,(f+1)/l).toLngLat().lat]}function Da(d,r,l,f,_,y,w){const S=d.context,k=S.gl,z=l.fbo;if(!z)return;d.prepareDrawTile(r);const P=d.useProgram("hillshade");S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,z.colorAttachment.get());const O=((Y,se,X,ie)=>{const ne=X.paint.get("hillshade-shadow-color"),te=X.paint.get("hillshade-highlight-color"),re=X.paint.get("hillshade-accent-color");let ae=X.paint.get("hillshade-illumination-direction")*(Math.PI/180);X.paint.get("hillshade-illumination-anchor")==="viewport"&&(ae-=Y.transform.angle);const ve=!Y.options.moving;return{u_matrix:ie||Y.transform.calculateProjMatrix(se.tileID.toUnwrapped(),ve),u_image:0,u_latrange:Ou(0,se.tileID),u_light:[X.paint.get("hillshade-exaggeration"),ae],u_shadow:ne,u_highlight:te,u_accent:re}})(d,l,f,d.terrain?r.projMatrix:null);d.prepareDrawProgram(S,P,r.toUnwrapped());const{tileBoundsBuffer:V,tileBoundsIndexBuffer:K,tileBoundsSegments:Z}=d.getTileBoundsBuffers(l);P.draw(S,k.TRIANGLES,_,y,w,a.CullFaceMode.disabled,O,f.id,V,K,Z)}function Hr(d,r,l){if(!r.needsDEMTextureUpload)return;const f=d.context,_=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||d.getTileTexture(l.stride);const y=l.getPixels();r.demTexture?r.demTexture.update(y,{premultiply:!1}):r.demTexture=new a.Texture(f,y,_.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Fs(d,r,l,f,_,y){const w=d.context,S=w.gl;if(!r.dem)return;const k=r.dem;if(w.activeTexture.set(S.TEXTURE1),Hr(d,r,k),!r.demTexture)return;r.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const z=k.dim;w.activeTexture.set(S.TEXTURE0);let P=r.fbo;if(!P){const Z=new a.Texture(w,{width:z,height:z,data:null},S.RGBA);Z.bind(S.LINEAR,S.CLAMP_TO_EDGE),P=r.fbo=w.createFramebuffer(z,z,!0),P.colorAttachment.set(Z.texture)}w.bindFramebuffer.set(P.framebuffer),w.viewport.set([0,0,z,z]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:V,tileBoundsSegments:K}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(w,S.TRIANGLES,f,_,y,a.CullFaceMode.disabled,((Z,Y)=>{const se=Y.stride,X=a.create();return a.ortho(X,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(X,X,[0,-a.EXTENT,0]),{u_matrix:X,u_image:1,u_dimension:[se,se],u_zoom:Z.overscaledZ,u_unpack:Y.unpackVector}})(r.tileID,k),l.id,O,V,K),r.needsHillshadePrepare=!1}const yo=(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_image0:new a.Uniform1i(d,r.u_image0),u_skirt_height:new a.Uniform1f(d,r.u_skirt_height)}),si=(d,r)=>({u_matrix:d,u_image0:0,u_skirt_height:r}),La=(d,r,l,f,_)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:r,u_merc_matrix:l,u_zoom_transition:f,u_merc_center:_,u_image0:0});function cn(d,r){return d!=null&&r!=null&&!(!d.hasData()||!r.hasData())&&d.demTexture!=null&&r.demTexture!=null&&d.tileID.key!==r.tileID.key}const Nn=new class{constructor(){this.operations={}}newMorphing(d,r,l,f,_){if(d in this.operations){const y=this.operations[d];y.to.tileID.key!==l.tileID.key&&(y.queued=l)}else this.operations[d]={startTime:f,phase:0,duration:_,from:r,to:l,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const r=this.operations[d];return{from:r.from,to:r.to,phase:r.phase}}update(d){for(const r in this.operations){const l=this.operations[r];for(l.phase=(d-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,d)){delete this.operations[r];break}}}_nextOp(d,r){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=r,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Bo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ef(d,r){const l=1<<d.z;return!r&&(d.x===0||d.x===l-1)||d.y===0||d.y===l-1}const Un=d=>({u_matrix:d});function Bu(d,r,l,f,_){if(_>0){const y=a.exported.now(),w=(y-d.timeAdded)/_,S=r?(y-r.timeAdded)/_:-1,k=l.getSource(),z=f.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),P=!r||Math.abs(r.tileID.overscaledZ-z)>Math.abs(d.tileID.overscaledZ-z),O=P&&d.refreshedUponExpiration?1:a.clamp(P?w:1-S,0,1);return d.refreshedUponExpiration&&w>=1&&(d.refreshedUponExpiration=!1),r?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}class Fu extends a.SourceCache{constructor(r){const l={type:"raster-dem",maxzoom:r.transform.maxZoom},f=new $r(ue(),null),_=Dr("mock-dem",l,f,r.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,l){r.state="loaded",l(null)}}class qi extends a.SourceCache{constructor(r){const l=Dr("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new $r(ue(),null),r.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,l,f){if(r.freezeTileCoverage)return;this.transform=r;const _=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,w)=>{if(y[w.key]="",!this._tiles[w.key]){const S=new a.Tile(w,this._source.tileSize*w.overscaleFactor(),r.tileZoom);S.state="loaded",this._tiles[w.key]=S}return y},{});for(const y in this._tiles)y in _||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(r){const l=this.proxyCachedFBO[r];if(l!==void 0){const f=Object.values(l);this.renderCachePool.push(...f),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ns extends a.OverscaledTileID{constructor(r,l,f){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=l,this.projMatrix=f}}class vo extends a.Elevation{constructor(r,l){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,_,y]=function(k){const z=new a.StructArrayLayout4i8,P=new a.StructArrayLayout3ui6,O=131;z.reserve(17161),P.reserve(33800);const V=a.EXTENT/128,K=a.EXTENT+V/2,Z=K+V;for(let se=-V;se<Z;se+=V)for(let X=-V;X<Z;X+=V){const ie=X<0||X>K||se<0||se>K?24575:0,ne=a.clamp(Math.round(X),0,a.EXTENT),te=a.clamp(Math.round(se),0,a.EXTENT);z.emplaceBack(ne+ie,te,ne,te)}const Y=(se,X)=>{const ie=X*O+se;P.emplaceBack(ie+1,ie,ie+O),P.emplaceBack(ie+O,ie+O+1,ie+1)};for(let se=1;se<129;se++)for(let X=1;X<129;X++)Y(X,se);return[0,129].forEach(se=>{for(let X=0;X<130;X++)Y(X,se),Y(se,X)}),[z,P,32768]}(),w=r.context;this.gridBuffer=w.createVertexBuffer(f,a.boundsAttributes.members),this.gridIndexBuffer=w.createIndexBuffer(_),this.gridSegments=a.SegmentVector.simpleSegment(0,0,f.length,_.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,f.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new qi(l.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,0,a.EXTENT,0,a.EXTENT,0,1);const S=w.gl;this._overlapStencilMode=new a.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Fu(l.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,l,f){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const _=r.terrain.properties;this.sourceCache=r.terrain.drapeRenderMode===0?this._mockSourceCache:r._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const y=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const w=this.getScaledDemTileSize();this.sourceCache.update(l,w,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,y(),this._initializing=!0),y(),l.updateElevation(!f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||r.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=l.getIds().map(k=>{const z=l.getTileByID(k).tileID;return z.projMatrix=f.calculateProjMatrix(z.toUnwrapped()),z});(function(k,z){const P=z.transform.pointCoordinate(z.transform.getCameraPoint()),O=new a.pointGeometry(P.x,P.y);k.sort((V,K)=>{if(K.overscaledZ-V.overscaledZ)return K.overscaledZ-V.overscaledZ;const Z=new a.pointGeometry(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),Y=new a.pointGeometry(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),se=O.mult(1<<V.canonical.z);return se.x-=.5,se.y-=.5,se.distSqr(Z)-se.distSqr(Y)})})(_,this.painter),this._previousZoom=f.zoom;const y=this.proxyToSource||{};this.proxyToSource={},_.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const w=this._style._sourceCaches;for(const k in w){const z=w[k];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,r[k],y),z.usedForTerrain))continue;const P=r[k];z.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[l.id]=_.map(k=>new Ns(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const S={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const z=this.terrainTileForTile[k.key];if(!z)continue;const P=z.tileID.key;P in S||(this._visibleDemTiles.push(z),S[P]=P)}}_assignTerrainTiles(r){this._initializing||r.forEach(l=>{if(this.terrainTileForTile[l.key])return;const f=this._findTileCoveringTileID(l,this.sourceCache);f&&(this.terrainTileForTile[l.key]=f)})}_prepareDEMTextures(){const r=this.painter.context,l=r.gl;for(const f in this.terrainTileForTile){const _=this.terrainTileForTile[f],y=_.dem;!y||_.demTexture&&!_.needsDEMTextureUpload||(r.activeTexture.set(l.TEXTURE1),Hr(this.painter,_,y))}}_prepareDemTileUniforms(r,l,f,_){if(!l||l.demTexture==null)return!1;const y=r.tileID.canonical,w=Math.pow(2,l.tileID.canonical.z-y.z),S=_||"";return f[`u_dem_tl${S}`]=[y.x*w%1,y.y*w%1],f[`u_dem_scale${S}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,l=r.gl;if(!this._emptyDepthBufferTexture){const f={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new a.Texture(r,f,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const l=this._visibleDemTiles.reduce((f,_)=>{if(!_.dem)return f;const y=_.dem.tree.minimums[0];return y>0&&r++,f+y},0);return r?l/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,l=r.gl;r.activeTexture.set(l.TEXTURE2);const f=this._getLoadedAreaMinimum(),_={width:1,height:1,data:new Uint8Array(a.DEMData.pack(f,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(_,{premultiply:!1}):y=this._emptyDEMTexture=new a.Texture(r,_,l.RGBA,{premultiply:!1}),y}setupElevationDraw(r,l,f){const _=this.painter.context,y=_.gl,w=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var S;w.u_dem_size=this.sourceCache.getSource().tileSize,w.u_exaggeration=this.exaggeration();const k=this.painter.transform,z=k.projection.createTileTransform(k,k.worldSize),P=r.tileID.canonical;w.u_tile_tl_up=z.upVector(P,0,0),w.u_tile_tr_up=z.upVector(P,a.EXTENT,0),w.u_tile_br_up=z.upVector(P,a.EXTENT,a.EXTENT),w.u_tile_bl_up=z.upVector(P,0,a.EXTENT),w.u_tile_up_scale=z.upVectorScale(P);let O=null,V=null,K=1;if(f&&f.morphing&&this._useVertexMorphing){const Z=f.morphing.srcDemTile,Y=f.morphing.dstDemTile;K=f.morphing.phase,Z&&Y&&(this._prepareDemTileUniforms(r,Z,w,"_prev")&&(V=Z),this._prepareDemTileUniforms(r,Y,w)&&(O=Y))}if(V&&O?(_.activeTexture.set(y.TEXTURE2),O.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),_.activeTexture.set(y.TEXTURE4),V.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE,y.NEAREST),w.u_dem_lerp=K):(O=this.terrainTileForTile[r.tileID.key],_.activeTexture.set(y.TEXTURE2),(this._prepareDemTileUniforms(r,O,w)?O.demTexture:this.emptyDEMTexture).bind(y.NEAREST,y.CLAMP_TO_EDGE)),_.activeTexture.set(y.TEXTURE3),f&&f.useDepthForOcclusion?(this._depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),w.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),w.u_depth_size_inv=[1,1]),f&&f.useMeterToDem&&O){const Z=(1<<O.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=Z}f&&f.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),l.setTerrainUniformValues(_,w)}renderToBackBuffer(r){const l=this.painter,f=this.painter.context;r.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,l.width,l.height]),this.renderingToTexture=!1,function(_,y,w,S,k){if(_.transform.projection.name==="globe")(function(z,P,O,V,K){const Z=z.context,Y=Z.gl;let se,X;const ie=z.options.showTerrainWireframe?2:0,ne=(je,Ce)=>{if(X===je)return;const Te=[];Ce&&Te.push(Bo[ie]),Te.push(Bo[je]),Te.push("PROJECTION_GLOBE_VIEW"),se=z.useProgram("globeRaster",null,Te),X=je},te=z.colorModeForRenderPass(),re=new a.DepthMode(Y.LEQUAL,a.DepthMode.ReadWrite,z.depthRangeFor3D);Nn.update(K);const ae=z.transform,ve=a.calculateGlobeMatrix(ae,ae.worldSize),Ee=a.calculateGlobeMercatorMatrix(ae),Xe=[a.mercatorXfromLng(ae.center.lng),a.mercatorYfromLat(ae.center.lat)],Ve=z.globeSharedBuffers;(ie?[!1,!0]:[!1]).forEach(je=>{X=-1;const Ce=je?Y.LINES:Y.TRIANGLES;for(const Te of V){const Ne=O.getTile(Te),De=Math.pow(2,Te.canonical.z),[ct,mt]=a.globeBuffersForTileMesh(z,Ne,Te,De),It=a.StencilMode.disabled,We=P.prevTerrainTileForTile[Te.key],ft=P.terrainTileForTile[Te.key];cn(We,ft)&&Nn.newMorphing(Te.key,We,ft,K,250),Z.activeTexture.set(Y.TEXTURE0),Ne.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const xt=Nn.getMorphValuesForProxy(Te.key),ar=xt?1:0,vr={};xt&&a.extend$1(vr,{morphing:{srcDemTile:xt.from,dstDemTile:xt.to,phase:a.easeCubicInOut(xt.phase)}});const yt=a.globeMatrixForTile(Te.canonical,ve),Lt=La(ae.projMatrix,yt,Ee,a.globeToMercatorTransition(ae.zoom),Xe);if(ne(ar,je),P.setupElevationDraw(Ne,se,vr),z.prepareDrawProgram(Z,se,Te.toUnwrapped()),Ve){const[Mr,ti]=je?Ve.getWirefameBuffer(z.context):[Ve.gridIndexBuffer,Ve.gridSegments];se.draw(Z,Ce,re,It,te,a.CullFaceMode.backCCW,Lt,"globe_raster",ct,Mr,ti)}if(!je){const Mr=[Te.canonical.y===0?a.globePoleMatrixForTile(Te.canonical,!1,ae):null,Te.canonical.y===De-1?a.globePoleMatrixForTile(Te.canonical,!0,ae):null];for(const ti of Mr){if(!ti)continue;const Di=La(ae.projMatrix,ti,ti,0,Xe);Ve&&se.draw(Z,Ce,re,It,te,a.CullFaceMode.disabled,Di,"globe_pole_raster",mt,Ve.poleIndexBuffer,Ve.poleSegments)}}}})})(_,y,w,S,k);else{const z=_.context,P=z.gl;let O,V;const K=_.options.showTerrainWireframe?2:0,Z=(ne,te)=>{if(V===ne)return;const re=[Bo[ne]];te&&re.push(Bo[K]),O=_.useProgram("terrainRaster",null,re),V=ne},Y=_.colorModeForRenderPass(),se=new a.DepthMode(P.LEQUAL,a.DepthMode.ReadWrite,_.depthRangeFor3D);Nn.update(k);const X=_.transform,ie=6*Math.pow(1.5,22-X.zoom)*y.exaggeration();(K?[!1,!0]:[!1]).forEach(ne=>{V=-1;const te=ne?P.LINES:P.TRIANGLES,[re,ae]=ne?y.getWirefameBuffer():[y.gridIndexBuffer,y.gridSegments];for(const ve of S){const Ee=w.getTile(ve),Xe=a.StencilMode.disabled,Ve=y.prevTerrainTileForTile[ve.key],je=y.terrainTileForTile[ve.key];cn(Ve,je)&&Nn.newMorphing(ve.key,Ve,je,k,250),z.activeTexture.set(P.TEXTURE0),Ee.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);const Ce=Nn.getMorphValuesForProxy(ve.key),Te=Ce?1:0;let Ne;Ce&&(Ne={morphing:{srcDemTile:Ce.from,dstDemTile:Ce.to,phase:a.easeCubicInOut(Ce.phase)}});const De=si(ve.projMatrix,ef(ve.canonical,X.renderWorldCopies)?ie/10:ie);Z(Te,ne),y.setupElevationDraw(Ee,O,Ne),_.prepareDrawProgram(z,O,ve.toUnwrapped()),O.draw(z,te,se,Xe,Y,a.CullFaceMode.backCCW,De,"terrain_raster",y.gridBuffer,re,ae)}})}}(l,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const l=this.painter,f=this.painter.context,_=this.proxySourceCache,y=this.proxiedCoords[_.id],w=this._drapedRenderBatches.shift(),S=[],k=l.style.order;let z=0;for(const P of y){const O=_.getTileByID(P.proxyTileKey),V=_.proxyCachedFBO[P.key]?_.proxyCachedFBO[P.key][r]:void 0,K=V!==void 0?_.renderCache[V]:this.pool[z++],Z=V!==void 0;if(O.texture=K.tex,Z&&!K.dirty){S.push(O.tileID);continue}let Y;f.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(f.clear({color:a.Color.transparent,stencil:0}),K.dirty=!1);for(let se=w.start;se<=w.end;++se){const X=l.style._layers[k[se]];if(X.isHidden(l.transform.zoom))continue;const ie=l.style._getLayerSourceCache(X),ne=ie?this.proxyToSource[P.key][ie.id]:[P];if(!ne)continue;const te=ne;f.viewport.set([0,0,K.fb.width,K.fb.height]),Y!==(ie?ie.id:null)&&(this._setupStencil(K,ne,X,ie),Y=ie?ie.id:null),l.renderLayer(l,ie,X,te)}this.renderedToTile?(K.dirty=!0,S.push(O.tileID)):Z||--z,z===5&&(z=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,l.width,l.height]),w.end+1}postRender(){}renderCacheEfficiency(r){const l=r.order.length;if(l===0)return{efficiency:100};let f,_=0,y=0,w=!1;for(let S=0;S<l;++S){const k=r._layers[r.order[S]];this._style.isLayerDraped(k)?(w&&++_,++y):w||(w=!0,f=k.id)}return y===0?{efficiency:100}:{efficiency:100*(1-_/y),firstUndrapedLayer:f}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{r=Math.min(r,l.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,l,f){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const w=y.tileID,S=Math.pow(2,w.overscaledZ),{x:k,y:z}=w.canonical,P=k/S,O=(k+1)/S,V=z/S,K=(z+1)/S;return{minx:P,miny:V,maxx:O,maxy:K,t:y.dem.tree.raycastRoot(P,V,O,K,r,l,f),tile:y}});_.sort((y,w)=>(y.t!==null?y.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const y of _){if(y.t==null)return null;const w=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,r,l,f);if(w!=null)return w}return null}_createFBO(){const r=this.painter.context,l=r.gl,f=this.drapeBufferSize;r.activeTexture.set(l.TEXTURE0);const _=new a.Texture(r,{width:f[0],height:f[1],data:null},l.RGBA);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);const y=r.createFramebuffer(f[0],f[1],!1);return y.colorAttachment.set(_.texture),y.depthAttachment=new gt(r,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:y,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const l=this._style._layers[r],f=l.isHidden(this.painter.transform.zoom),_=l.getCrossfadeParameters(),y=!!_&&_.t!==1,w=l.hasTransition();return l.type!=="custom"&&!f&&(y||w)})}_clearRasterFadeFromRenderCache(){let r=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof rr){r=!0;break}if(r)for(let l=0;l<this._style.order.length;++l){const f=this._style._layers[this._style.order[l]],_=f.isHidden(this.painter.transform.zoom),y=this._style._getLayerSourceCache(f);if(f.type!=="raster"||_||!y)continue;const w=f.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const k=this.proxyToSource[S.key][y.id];if(k)for(const z of k){const P=Bu(y.getTile(z),y.findLoadedParent(z,0),y,this.painter.transform,w);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(y.id,z)}}}}_setupDrapedRenderBatches(){const r=this._style.order,l=r.length;if(l===0)return;const f=[];let _,y=0,w=this._style._layers[r[y]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++y<l;)w=this._style._layers[r[y]];for(;y<l;++y){const S=this._style._layers[r[y]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?_===void 0&&(_=y):_!==void 0&&(f.push({start:_,end:y-1}),_=void 0))}_!==void 0&&f.push({start:_,end:y-1}),this._drapedRenderBatches=f}_setupRenderCache(r){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const w=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let S=0;S<w.length;++S){const k=Object.values(w[S]);l.renderCachePool.push(...k)}}return}this._clearRasterFadeFromRenderCache();const f=this.proxyCoords,_=this._tilesDirty;for(let w=f.length-1;w>=0;w--){const S=f[w];if(l.getTileByID(S.key),l.proxyCachedFBO[S.key]!==void 0){const k=r[S.key],z=this.proxyToSource[S.key];let P=0;for(const O in z){const V=z[O],K=k[O];if(!K||K.length!==V.length||V.some((Z,Y)=>Z!==K[Y]||_[O]&&_[O].hasOwnProperty(Z.key))){P=-1;break}++P}for(const O in l.proxyCachedFBO[S.key])l.renderCache[l.proxyCachedFBO[S.key][O]].dirty=P<0||P!==Object.values(k).length}}const y=[...this._drapedRenderBatches];y.sort((w,S)=>S.end-S.start-(w.end-w.start));for(const w of y)for(const S of f){if(l.proxyCachedFBO[S.key])continue;let k=l.renderCachePool.pop();k===void 0&&l.renderCache.length<50&&(k=l.renderCache.length,l.renderCache.push(this._createFBO())),k!==void 0&&(l.proxyCachedFBO[S.key]={},l.proxyCachedFBO[S.key][w.start]=k,l.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(r,l,f,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,w=y.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let S;if(f.isTileClipped())S=l.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(r,l){const f=this.painter,_=this.painter.context,y=_.gl;f._tileClippingMaskIDs={},_.setColorMode(a.ColorMode.disabled),_.setDepthMode(a.DepthMode.disabled);const w=f.useProgram("clippingMask");for(const S of r){const k=f._tileClippingMaskIDs[S.key]=--l;w.draw(_,y.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:y.ALWAYS,mask:0},k,255,y.KEEP,y.KEEP,y.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,Un(S.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(r){const l=this.painter.transform;if(r.x<0||r.x>l.width||r.y<0||r.y>l.height)return null;const f=[r.x,r.y,1,1];a.transformMat4$1(f,f,l.pixelMatrixInverse),a.scale$1(f,f,1/f[3]),f[0]/=l.worldSize,f[1]/=l.worldSize;const _=l._camera.position,y=a.mercatorZfromAltitude(1,l.center.lat),w=[_[0],_[1],_[2]/y,0],S=a.subtract([],f.slice(0,3),w);a.normalize(S,S);const k=this.raycast(w,S,this._exaggeration);return k!==null&&k?(a.scaleAndAdd(w,w,S,k),w[3]=w[2],w[2]*=y,w):null}drawDepth(){const r=this.painter,l=r.context,f=this.proxySourceCache,_=Math.ceil(r.width),y=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===y||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const w=l.gl,S=l.createFramebuffer(_,y,!0);l.activeTexture.set(w.TEXTURE0);const k=new a.Texture(l,{width:_,height:y,data:null},w.RGBA);k.bind(w.NEAREST,w.CLAMP_TO_EDGE),S.colorAttachment.set(k.texture);const z=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,_,y);S.depthAttachment.set(z),this._depthFBO=S,this._depthTexture=k}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,_,y]),function(w,S,k,z){if(w.transform.projection.name==="globe")return;const P=w.context,O=P.gl;P.clear({depth:1});const V=w.useProgram("terrainDepth"),K=new a.DepthMode(O.LESS,a.DepthMode.ReadWrite,w.depthRangeFor3D);for(const Z of z){const Y=k.getTile(Z),se=si(Z.projMatrix,0);S.setupElevationDraw(Y,V),V.draw(P,O.TRIANGLES,K,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,se,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(r,this,f,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,l,f){if(r.getSource()instanceof Br)return this._setupProxiedCoordsForImageSource(r,l,f);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const _=this.proxiedCoords[r.id]=[],y=this.proxyCoords;for(let S=0;S<y.length;S++){const k=y[S],z=this._findTileCoveringTileID(k,r);if(z){const P=this._createProxiedId(k,z,f[k.key]&&f[k.key][r.id]);_.push(P),this.proxyToSource[k.key][r.id]=[P]}}let w=!1;for(let S=0;S<l.length;S++){const k=r.getTile(l[S]);if(!k||!k.hasData())continue;const z=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==k.tileID.canonical.z){const P=this.proxyToSource[z.tileID.key][r.id],O=this._createProxiedId(z.tileID,k,f[z.tileID.key]&&f[z.tileID.key][r.id]);P?P.splice(P.length-1,0,O):this.proxyToSource[z.tileID.key][r.id]=[O],_.push(O),w=!0}}this._sourceTilesOverlap[r.id]=w}_setupProxiedCoordsForImageSource(r,l,f){if(!r.getSource().loaded())return;const _=this.proxiedCoords[r.id]=[],y=this.proxyCoords,w=r.getSource(),S=new a.pointGeometry(w.tileID.x,w.tileID.y)._div(1<<w.tileID.z),k=w.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((P,O)=>(P.min.x=Math.min(P.min.x,O.x-S.x),P.min.y=Math.min(P.min.y,O.y-S.y),P.max.x=Math.max(P.max.x,O.x-S.x),P.max.y=Math.max(P.max.y,O.y-S.y),P),{min:new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(P,O)=>{const V=P.wrap+P.canonical.x/(1<<P.canonical.z),K=P.canonical.y/(1<<P.canonical.z),Z=a.EXTENT/(1<<P.canonical.z),Y=O.wrap+O.canonical.x/(1<<O.canonical.z),se=O.canonical.y/(1<<O.canonical.z);return V+Z<Y+k.min.x||V>Y+k.max.x||K+Z<se+k.min.y||K>se+k.max.y};for(let P=0;P<y.length;P++){const O=y[P];for(let V=0;V<l.length;V++){const K=r.getTile(l[V]);if(!K||!K.hasData()||z(O,K.tileID))continue;const Z=this._createProxiedId(O,K,f[O.key]&&f[O.key][r.id]),Y=this.proxyToSource[O.key][r.id];Y?Y.push(Z):this.proxyToSource[O.key][r.id]=[Z],_.push(Z)}}}_createProxiedId(r,l,f){let _=this.orthoMatrix;if(f){const y=f.find(w=>w.key===l.tileID.key);if(y)return y}if(l.tileID.key!==r.key){const y=r.canonical.z-l.tileID.canonical.z;let w,S,k;_=a.create();const z=l.tileID.wrap-r.wrap<<r.overscaledZ;y>0?(w=a.EXTENT>>y,S=w*((l.tileID.canonical.x<<y)-r.canonical.x+z),k=w*((l.tileID.canonical.y<<y)-r.canonical.y)):(w=a.EXTENT<<-y,S=a.EXTENT*(l.tileID.canonical.x-(r.canonical.x+z<<-y)),k=a.EXTENT*(l.tileID.canonical.y-(r.canonical.y<<-y))),a.ortho(_,0,w,0,w,0,1),a.translate(_,_,[S,k,0])}return new Ns(l.tileID,r.key,_)}_findTileCoveringTileID(r,l){let f=l.getTile(r);if(f&&f.hasData())return f;const _=this._findCoveringTileCache[l.id],y=_[r.key];if(f=y?l.getTileByID(y):null,f&&f.hasData()||y===null)return f;let w=f?f.tileID:r,S=w.overscaledZ;const k=l.getSource().minzoom,z=[];if(!y){const O=l.getSource().maxzoom;if(r.canonical.z>=O){const V=r.canonical.z-O;l.getSource().reparseOverscaled?(S=Math.max(r.canonical.z+2,l.transform.tileZoom),w=new a.OverscaledTileID(S,r.wrap,O,r.canonical.x>>V,r.canonical.y>>V)):V!==0&&(S=O,w=new a.OverscaledTileID(S,r.wrap,O,r.canonical.x>>V,r.canonical.y>>V))}w.key!==r.key&&(z.push(w.key),f=l.getTile(w))}const P=O=>{z.forEach(V=>{_[V]=O}),z.length=0};for(S-=1;S>=k&&(!f||!f.hasData());S--){f&&P(f.tileID.key);const O=w.calculateScaledKey(S);if(f=l.getTileByID(O),f&&f.hasData())break;const V=_[O];if(V===null)break;V===void 0?z.push(O):f=l.getTileByID(V)}return P(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(r){this.renderedToTile=!0}_clearRenderCacheForTile(r,l){let f=this._tilesDirty[r];f||(f=this._tilesDirty[r]={}),f[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(l){let f,_,y;const w=new a.StructArrayLayout2ui4,S=131;for(_=1;_<129;_++){for(f=1;f<129;f++)y=_*S+f,w.emplaceBack(y,y+1),w.emplaceBack(y,y+S),w.emplaceBack(y+1,y+S),_===128&&w.emplaceBack(y+S,y+S+1);w.emplaceBack(y+1,y+1+S)}return w}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Ra(d){const r=[];for(let l=0;l<d.length;l++){if(d[l]===null)continue;const f=d[l].split(" ");r.push(f.pop())}return r}class Us{static cacheKey(r,l,f){let _=`${r}${f?f.cacheKey:""}`;for(const y of l)_+=`/${y}`;return _}constructor(r,l,f,_,y,w){const S=r.gl;this.program=S.createProgram();const k=Ra(f.staticAttributes),z=_?_.getBinderAttributes():[],P=k.concat(z),O=f.staticUniforms?Ra(f.staticUniforms):[],V=_?_.getBinderUniforms():[],K=O.concat(V),Z=[];for(const re of K)Z.indexOf(re)<0&&Z.push(re);let Y=_?_.defines():[];Y=Y.concat(w.map(re=>`#define ${re}`));const se=Y.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Pa,Xt.fragmentSource,is.fragmentSource,f.fragmentSource).join(`
`),X=Y.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Pa,Xt.vertexSource,is.vertexSource,rs.vertexSource,f.vertexSource).join(`
`),ie=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(ie,se),S.compileShader(ie),S.attachShader(this.program,ie);const ne=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(ne,X),S.compileShader(ne),S.attachShader(this.program,ne),this.attributes={};const te={};this.numAttributes=P.length;for(let re=0;re<this.numAttributes;re++)P[re]&&(S.bindAttribLocation(this.program,re,P[re]),this.attributes[P[re]]=re);S.linkProgram(this.program),S.deleteShader(ne),S.deleteShader(ie);for(let re=0;re<Z.length;re++){const ae=Z[re];if(ae&&!te[ae]){const ve=S.getUniformLocation(this.program,ae);ve&&(te[ae]=ve)}}this.fixedUniforms=y(r,te),this.binderUniforms=_?_.getUniforms(r,te):[],w.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((re,ae)=>({u_dem:new a.Uniform1i(re,ae.u_dem),u_dem_prev:new a.Uniform1i(re,ae.u_dem_prev),u_dem_unpack:new a.Uniform4f(re,ae.u_dem_unpack),u_dem_tl:new a.Uniform2f(re,ae.u_dem_tl),u_dem_scale:new a.Uniform1f(re,ae.u_dem_scale),u_dem_tl_prev:new a.Uniform2f(re,ae.u_dem_tl_prev),u_dem_scale_prev:new a.Uniform1f(re,ae.u_dem_scale_prev),u_dem_size:new a.Uniform1f(re,ae.u_dem_size),u_dem_lerp:new a.Uniform1f(re,ae.u_dem_lerp),u_exaggeration:new a.Uniform1f(re,ae.u_exaggeration),u_depth:new a.Uniform1i(re,ae.u_depth),u_depth_size_inv:new a.Uniform2f(re,ae.u_depth_size_inv),u_meter_to_dem:new a.Uniform1f(re,ae.u_meter_to_dem),u_label_plane_matrix_inv:new a.UniformMatrix4f(re,ae.u_label_plane_matrix_inv),u_tile_tl_up:new a.Uniform3f(re,ae.u_tile_tl_up),u_tile_tr_up:new a.Uniform3f(re,ae.u_tile_tr_up),u_tile_br_up:new a.Uniform3f(re,ae.u_tile_br_up),u_tile_bl_up:new a.Uniform3f(re,ae.u_tile_bl_up),u_tile_up_scale:new a.Uniform1f(re,ae.u_tile_up_scale)}))(r,te)),w.indexOf("FOG")!==-1&&(this.fogUniforms=((re,ae)=>({u_fog_matrix:new a.UniformMatrix4f(re,ae.u_fog_matrix),u_fog_range:new a.Uniform2f(re,ae.u_fog_range),u_fog_color:new a.Uniform4f(re,ae.u_fog_color),u_fog_horizon_blend:new a.Uniform1f(re,ae.u_fog_horizon_blend),u_fog_temporal_offset:new a.Uniform1f(re,ae.u_fog_temporal_offset)}))(r,te))}setTerrainUniformValues(r,l){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)f[_].set(l[_])}}setFogUniformValues(r,l){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)f[_].location&&f[_].set(l[_])}}draw(r,l,f,_,y,w,S,k,z,P,O,V,K,Z,Y,se){const X=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(f),r.setStencilMode(_),r.setColorMode(y),r.setCullFace(w);for(const ne of Object.keys(this.fixedUniforms))this.fixedUniforms[ne].set(S[ne]);Z&&Z.setUniforms(r,this.binderUniforms,V,{zoom:K});const ie={[X.LINES]:2,[X.TRIANGLES]:3,[X.LINE_STRIP]:1}[l];for(const ne of O.get()){const te=ne.vaos||(ne.vaos={});(te[k]||(te[k]=new ln)).bind(r,this,z,Z?Z.getPaintVertexBuffers():[],P,ne.vertexOffset,Y,se),X.drawElements(l,ne.primitiveLength*ie,X.UNSIGNED_SHORT,ne.primitiveOffset*ie*2)}}}function Nu(d,r,l){const f=1/Zt(l,1,r.transform.tileZoom),_=Math.pow(2,l.tileID.overscaledZ),y=l.tileSize*Math.pow(2,r.transform.tileZoom)/_,w=y*(l.tileID.canonical.x+l.tileID.wrap*_),S=y*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[f,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S]}}const Uu=(d,r,l,f)=>{const _=r.style.light,y=_.properties.get("position"),w=[y.x,y.y,y.z],S=a.create$1();_.properties.get("anchor")==="viewport"&&(a.fromRotation(S,-r.transform.angle),a.transformMat3(w,w,S));const k=_.properties.get("color");return{u_matrix:d,u_lightpos:w,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+l,u_opacity:f}},ic=(d,r,l,f,_,y,w)=>a.extend(Uu(d,r,l,f),Nu(y,r,w),{u_height_factor:-Math.pow(2,_.overscaledZ)/w.tileSize/8}),ju=d=>({u_matrix:d}),nc=(d,r,l,f)=>a.extend(ju(d),Nu(l,r,f)),tf=(d,r)=>({u_matrix:d,u_world:r}),Vu=(d,r,l,f,_)=>a.extend(nc(d,r,l,f),{u_world:_}),rf=(d,r,l,f)=>{const _=d.transform;let y;return y=f.paint.get("circle-pitch-alignment")==="map"?_.calculatePixelsToTileUnitsMatrix(l):new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]),{u_camera_to_center_distance:_.cameraToCenterDistance,u_matrix:d.translatePosMatrix(r.projMatrix,l,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:y}},oc=d=>{const r=[];return d.paint.get("circle-pitch-alignment")==="map"&&r.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&r.push("SCALE_WITH_MAP"),r},$u=(d,r,l)=>{const f=a.EXTENT/l.tileSize;return{u_matrix:d,u_camera_to_center_distance:r.cameraToCenterDistance,u_extrude_scale:[r.pixelsToGLUnits[0]/f,r.pixelsToGLUnits[1]/f]}},sc=(d,r,l=1)=>({u_matrix:d,u_color:r,u_overlay:0,u_overlay_scale:l}),Gu=(d,r,l,f)=>({u_matrix:d,u_extrude_scale:Zt(r,1,l),u_intensity:f}),qu=(d,r,l,f,_,y)=>{const w=d.transform,S=w.calculatePixelsToTileUnitsMatrix(r),k={u_matrix:js(d,r,l,_),u_pixels_to_tile_units:S,u_device_pixel_ratio:a.exported.devicePixelRatio,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Vs(l)){const z=ns(r,d.transform);k.u_texsize=r.lineAtlasTexture.size,k.u_scale=[z,f.fromScale,f.toScale],k.u_mix=f.t}return k},Fo=(d,r,l,f,_)=>{const y=d.transform,w=ns(r,y);return{u_matrix:js(d,r,l,_),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:y.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:a.exported.devicePixelRatio,u_image:0,u_scale:[w,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ns(d,r){return 1/Zt(d,1,r.tileZoom)}function js(d,r,l,f){return d.translatePosMatrix(f||r.tileID.projMatrix,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function Vs(d){const r=d.paint.get("line-dasharray").value;return r.value||r.kind!=="constant"}const Oa=(d,r,l,f,_,y)=>{return{u_matrix:d,u_tl_parent:r,u_scale_parent:l,u_fade_t:f.mix,u_opacity:f.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(S=_.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(w=_.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Ba(_.paint.get("raster-hue-rotate")),u_perspective_transform:y};var w,S};function Ba(d){d*=Math.PI/180;const r=Math.sin(d),l=Math.cos(d);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const Fa=(d,r,l,f,_,y,w,S,k,z,P,O,V,K)=>{const Z=_.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:Z.width/Z.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:w,u_coord_matrix:S,u_is_text:+k,u_pitch_with_map:+f,u_texsize:z,u_tile_id:P,u_zoom_transition:O,u_inv_rot_matrix:V,u_merc_center:K,u_texture:0}},$s=(d,r,l,f,_,y,w,S,k,z,P,O,V,K,Z)=>{const{cameraToCenterDistance:Y,_pitch:se}=_.transform;return a.extend(Fa(d,r,l,f,_,y,w,S,k,z,O,V,K,Z),{u_gamma_scale:f?Y*Math.cos(_.terrain?0:se):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+P})},Gs=(d,r,l,f,_,y,w,S,k,z,P,O,V,K)=>a.extend($s(d,r,l,f,_,y,w,S,!0,k,!0,P,O,V,K),{u_texsize_icon:z,u_texture_icon:1}),nr=(d,r,l)=>({u_matrix:d,u_opacity:r,u_color:l}),Na=(d,r,l,f,_,y)=>a.extend(function(w,S,k,z){const P=k.imageManager.getPattern(w.from.toString()),O=k.imageManager.getPattern(w.to.toString()),{width:V,height:K}=k.imageManager.getPixelSize(),Z=Math.pow(2,z.tileID.overscaledZ),Y=z.tileSize*Math.pow(2,k.transform.tileZoom)/Z,se=Y*(z.tileID.canonical.x+z.tileID.wrap*Z),X=Y*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[V,K],u_mix:S.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/Zt(z,1,k.transform.tileZoom),u_pixel_coord_upper:[se>>16,X>>16],u_pixel_coord_lower:[65535&se,65535&X]}}(f,y,l,_),{u_matrix:d,u_opacity:r}),Zu={fillExtrusion:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_lightpos:new a.Uniform3f(d,r.u_lightpos),u_lightintensity:new a.Uniform1f(d,r.u_lightintensity),u_lightcolor:new a.Uniform3f(d,r.u_lightcolor),u_vertical_gradient:new a.Uniform1f(d,r.u_vertical_gradient),u_opacity:new a.Uniform1f(d,r.u_opacity)}),fillExtrusionPattern:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_lightpos:new a.Uniform3f(d,r.u_lightpos),u_lightintensity:new a.Uniform1f(d,r.u_lightintensity),u_lightcolor:new a.Uniform3f(d,r.u_lightcolor),u_vertical_gradient:new a.Uniform1f(d,r.u_vertical_gradient),u_height_factor:new a.Uniform1f(d,r.u_height_factor),u_image:new a.Uniform1i(d,r.u_image),u_texsize:new a.Uniform2f(d,r.u_texsize),u_pixel_coord_upper:new a.Uniform2f(d,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(d,r.u_pixel_coord_lower),u_scale:new a.Uniform3f(d,r.u_scale),u_fade:new a.Uniform1f(d,r.u_fade),u_opacity:new a.Uniform1f(d,r.u_opacity)}),fill:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix)}),fillPattern:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_image:new a.Uniform1i(d,r.u_image),u_texsize:new a.Uniform2f(d,r.u_texsize),u_pixel_coord_upper:new a.Uniform2f(d,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(d,r.u_pixel_coord_lower),u_scale:new a.Uniform3f(d,r.u_scale),u_fade:new a.Uniform1f(d,r.u_fade)}),fillOutline:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_world:new a.Uniform2f(d,r.u_world)}),fillOutlinePattern:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_world:new a.Uniform2f(d,r.u_world),u_image:new a.Uniform1i(d,r.u_image),u_texsize:new a.Uniform2f(d,r.u_texsize),u_pixel_coord_upper:new a.Uniform2f(d,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(d,r.u_pixel_coord_lower),u_scale:new a.Uniform3f(d,r.u_scale),u_fade:new a.Uniform1f(d,r.u_fade)}),circle:(d,r)=>({u_camera_to_center_distance:new a.Uniform1f(d,r.u_camera_to_center_distance),u_extrude_scale:new a.UniformMatrix2f(d,r.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(d,r.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(d,r.u_matrix)}),collisionBox:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_camera_to_center_distance:new a.Uniform1f(d,r.u_camera_to_center_distance),u_extrude_scale:new a.Uniform2f(d,r.u_extrude_scale)}),collisionCircle:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_inv_matrix:new a.UniformMatrix4f(d,r.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(d,r.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(d,r.u_viewport_size)}),debug:(d,r)=>({u_color:new a.UniformColor(d,r.u_color),u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_overlay:new a.Uniform1i(d,r.u_overlay),u_overlay_scale:new a.Uniform1f(d,r.u_overlay_scale)}),clippingMask:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix)}),heatmap:(d,r)=>({u_extrude_scale:new a.Uniform1f(d,r.u_extrude_scale),u_intensity:new a.Uniform1f(d,r.u_intensity),u_matrix:new a.UniformMatrix4f(d,r.u_matrix)}),heatmapTexture:(d,r)=>({u_image:new a.Uniform1i(d,r.u_image),u_color_ramp:new a.Uniform1i(d,r.u_color_ramp),u_opacity:new a.Uniform1f(d,r.u_opacity)}),hillshade:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_image:new a.Uniform1i(d,r.u_image),u_latrange:new a.Uniform2f(d,r.u_latrange),u_light:new a.Uniform2f(d,r.u_light),u_shadow:new a.UniformColor(d,r.u_shadow),u_highlight:new a.UniformColor(d,r.u_highlight),u_accent:new a.UniformColor(d,r.u_accent)}),hillshadePrepare:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_image:new a.Uniform1i(d,r.u_image),u_dimension:new a.Uniform2f(d,r.u_dimension),u_zoom:new a.Uniform1f(d,r.u_zoom),u_unpack:new a.Uniform4f(d,r.u_unpack)}),line:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_pixels_to_tile_units:new a.UniformMatrix2f(d,r.u_pixels_to_tile_units),u_device_pixel_ratio:new a.Uniform1f(d,r.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(d,r.u_units_to_pixels),u_dash_image:new a.Uniform1i(d,r.u_dash_image),u_gradient_image:new a.Uniform1i(d,r.u_gradient_image),u_image_height:new a.Uniform1f(d,r.u_image_height),u_texsize:new a.Uniform2f(d,r.u_texsize),u_scale:new a.Uniform3f(d,r.u_scale),u_mix:new a.Uniform1f(d,r.u_mix),u_alpha_discard_threshold:new a.Uniform1f(d,r.u_alpha_discard_threshold)}),linePattern:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_texsize:new a.Uniform2f(d,r.u_texsize),u_pixels_to_tile_units:new a.UniformMatrix2f(d,r.u_pixels_to_tile_units),u_device_pixel_ratio:new a.Uniform1f(d,r.u_device_pixel_ratio),u_image:new a.Uniform1i(d,r.u_image),u_units_to_pixels:new a.Uniform2f(d,r.u_units_to_pixels),u_scale:new a.Uniform3f(d,r.u_scale),u_fade:new a.Uniform1f(d,r.u_fade),u_alpha_discard_threshold:new a.Uniform1f(d,r.u_alpha_discard_threshold)}),raster:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_tl_parent:new a.Uniform2f(d,r.u_tl_parent),u_scale_parent:new a.Uniform1f(d,r.u_scale_parent),u_fade_t:new a.Uniform1f(d,r.u_fade_t),u_opacity:new a.Uniform1f(d,r.u_opacity),u_image0:new a.Uniform1i(d,r.u_image0),u_image1:new a.Uniform1i(d,r.u_image1),u_brightness_low:new a.Uniform1f(d,r.u_brightness_low),u_brightness_high:new a.Uniform1f(d,r.u_brightness_high),u_saturation_factor:new a.Uniform1f(d,r.u_saturation_factor),u_contrast_factor:new a.Uniform1f(d,r.u_contrast_factor),u_spin_weights:new a.Uniform3f(d,r.u_spin_weights),u_perspective_transform:new a.Uniform2f(d,r.u_perspective_transform)}),symbolIcon:(d,r)=>({u_is_size_zoom_constant:new a.Uniform1i(d,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(d,r.u_is_size_feature_constant),u_size_t:new a.Uniform1f(d,r.u_size_t),u_size:new a.Uniform1f(d,r.u_size),u_camera_to_center_distance:new a.Uniform1f(d,r.u_camera_to_center_distance),u_pitch:new a.Uniform1f(d,r.u_pitch),u_rotate_symbol:new a.Uniform1i(d,r.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(d,r.u_aspect_ratio),u_fade_change:new a.Uniform1f(d,r.u_fade_change),u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(d,r.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(d,r.u_coord_matrix),u_is_text:new a.Uniform1i(d,r.u_is_text),u_pitch_with_map:new a.Uniform1i(d,r.u_pitch_with_map),u_texsize:new a.Uniform2f(d,r.u_texsize),u_tile_id:new a.Uniform3f(d,r.u_tile_id),u_zoom_transition:new a.Uniform1f(d,r.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(d,r.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(d,r.u_merc_center),u_texture:new a.Uniform1i(d,r.u_texture)}),symbolSDF:(d,r)=>({u_is_size_zoom_constant:new a.Uniform1i(d,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(d,r.u_is_size_feature_constant),u_size_t:new a.Uniform1f(d,r.u_size_t),u_size:new a.Uniform1f(d,r.u_size),u_camera_to_center_distance:new a.Uniform1f(d,r.u_camera_to_center_distance),u_pitch:new a.Uniform1f(d,r.u_pitch),u_rotate_symbol:new a.Uniform1i(d,r.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(d,r.u_aspect_ratio),u_fade_change:new a.Uniform1f(d,r.u_fade_change),u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(d,r.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(d,r.u_coord_matrix),u_is_text:new a.Uniform1i(d,r.u_is_text),u_pitch_with_map:new a.Uniform1i(d,r.u_pitch_with_map),u_texsize:new a.Uniform2f(d,r.u_texsize),u_texture:new a.Uniform1i(d,r.u_texture),u_gamma_scale:new a.Uniform1f(d,r.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(d,r.u_device_pixel_ratio),u_tile_id:new a.Uniform3f(d,r.u_tile_id),u_zoom_transition:new a.Uniform1f(d,r.u_zoom_transition),u_inv_rot_matrix:new a.UniformMatrix4f(d,r.u_inv_rot_matrix),u_merc_center:new a.Uniform2f(d,r.u_merc_center),u_is_halo:new a.Uniform1i(d,r.u_is_halo)}),symbolTextAndIcon:(d,r)=>({u_is_size_zoom_constant:new a.Uniform1i(d,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(d,r.u_is_size_feature_constant),u_size_t:new a.Uniform1f(d,r.u_size_t),u_size:new a.Uniform1f(d,r.u_size),u_camera_to_center_distance:new a.Uniform1f(d,r.u_camera_to_center_distance),u_pitch:new a.Uniform1f(d,r.u_pitch),u_rotate_symbol:new a.Uniform1i(d,r.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(d,r.u_aspect_ratio),u_fade_change:new a.Uniform1f(d,r.u_fade_change),u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(d,r.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(d,r.u_coord_matrix),u_is_text:new a.Uniform1i(d,r.u_is_text),u_pitch_with_map:new a.Uniform1i(d,r.u_pitch_with_map),u_texsize:new a.Uniform2f(d,r.u_texsize),u_texsize_icon:new a.Uniform2f(d,r.u_texsize_icon),u_texture:new a.Uniform1i(d,r.u_texture),u_texture_icon:new a.Uniform1i(d,r.u_texture_icon),u_gamma_scale:new a.Uniform1f(d,r.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(d,r.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(d,r.u_is_halo)}),background:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_opacity:new a.Uniform1f(d,r.u_opacity),u_color:new a.UniformColor(d,r.u_color)}),backgroundPattern:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_opacity:new a.Uniform1f(d,r.u_opacity),u_image:new a.Uniform1i(d,r.u_image),u_pattern_tl_a:new a.Uniform2f(d,r.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(d,r.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(d,r.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(d,r.u_pattern_br_b),u_texsize:new a.Uniform2f(d,r.u_texsize),u_mix:new a.Uniform1f(d,r.u_mix),u_pattern_size_a:new a.Uniform2f(d,r.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(d,r.u_pattern_size_b),u_scale_a:new a.Uniform1f(d,r.u_scale_a),u_scale_b:new a.Uniform1f(d,r.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(d,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(d,r.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(d,r.u_tile_units_to_pixels)}),terrainRaster:yo,terrainDepth:yo,skybox:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_sun_direction:new a.Uniform3f(d,r.u_sun_direction),u_cubemap:new a.Uniform1i(d,r.u_cubemap),u_opacity:new a.Uniform1f(d,r.u_opacity),u_temporal_offset:new a.Uniform1f(d,r.u_temporal_offset)}),skyboxGradient:(d,r)=>({u_matrix:new a.UniformMatrix4f(d,r.u_matrix),u_color_ramp:new a.Uniform1i(d,r.u_color_ramp),u_center_direction:new a.Uniform3f(d,r.u_center_direction),u_radius:new a.Uniform1f(d,r.u_radius),u_opacity:new a.Uniform1f(d,r.u_opacity),u_temporal_offset:new a.Uniform1f(d,r.u_temporal_offset)}),skyboxCapture:(d,r)=>({u_matrix_3f:new a.UniformMatrix3f(d,r.u_matrix_3f),u_sun_direction:new a.Uniform3f(d,r.u_sun_direction),u_sun_intensity:new a.Uniform1f(d,r.u_sun_intensity),u_color_tint_r:new a.Uniform4f(d,r.u_color_tint_r),u_color_tint_m:new a.Uniform4f(d,r.u_color_tint_m),u_luminance:new a.Uniform1f(d,r.u_luminance)}),globeRaster:(d,r)=>({u_proj_matrix:new a.UniformMatrix4f(d,r.u_proj_matrix),u_globe_matrix:new a.UniformMatrix4f(d,r.u_globe_matrix),u_merc_matrix:new a.UniformMatrix4f(d,r.u_merc_matrix),u_zoom_transition:new a.Uniform1f(d,r.u_zoom_transition),u_merc_center:new a.Uniform2f(d,r.u_merc_center),u_image0:new a.Uniform1i(d,r.u_image0)}),globeAtmosphere:(d,r)=>({u_center:new a.Uniform2f(d,r.u_center),u_radius:new a.Uniform1f(d,r.u_radius),u_screen_size:new a.Uniform2f(d,r.u_screen_size),u_pixel_ratio:new a.Uniform1f(d,r.u_pixel_ratio),u_opacity:new a.Uniform1f(d,r.u_opacity),u_fadeout_range:new a.Uniform1f(d,r.u_fadeout_range),u_start_color:new a.Uniform3f(d,r.u_start_color),u_end_color:new a.Uniform3f(d,r.u_end_color)})};let qs;function ac(d,r,l,f,_,y,w){const S=d.context,k=S.gl,z=d.useProgram("collisionBox"),P=[];let O=0,V=0;for(let ne=0;ne<f.length;ne++){const te=f[ne],re=r.getTile(te),ae=re.getBucket(l);if(!ae)continue;let ve=te.projMatrix;_[0]===0&&_[1]===0||(ve=d.translatePosMatrix(te.projMatrix,re,_,y));const Ee=w?ae.textCollisionBox:ae.iconCollisionBox,Xe=ae.collisionCircleArray;if(Xe.length>0){const Ve=a.create(),je=ve;a.mul(Ve,ae.placementInvProjMatrix,d.transform.glCoordMatrix),a.mul(Ve,Ve,ae.placementViewportMatrix),P.push({circleArray:Xe,circleOffset:V,transform:je,invTransform:Ve}),O+=Xe.length/4,V=O}Ee&&(d.terrain&&d.terrain.setupElevationDraw(re,z),z.draw(S,k.LINES,a.DepthMode.disabled,a.StencilMode.disabled,d.colorModeForRenderPass(),a.CullFaceMode.disabled,$u(ve,d.transform,re),l.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,null,d.transform.zoom,null,Ee.collisionVertexBuffer,Ee.collisionVertexBufferExt))}if(!w||!P.length)return;const K=d.useProgram("collisionCircle"),Z=new a.StructArrayLayout2f1f2i16;Z.resize(4*O),Z._trim();let Y=0;for(const ne of P)for(let te=0;te<ne.circleArray.length/4;te++){const re=4*te,ae=ne.circleArray[re+0],ve=ne.circleArray[re+1],Ee=ne.circleArray[re+2],Xe=ne.circleArray[re+3];Z.emplace(Y++,ae,ve,Ee,Xe,0),Z.emplace(Y++,ae,ve,Ee,Xe,1),Z.emplace(Y++,ae,ve,Ee,Xe,2),Z.emplace(Y++,ae,ve,Ee,Xe,3)}(!qs||qs.length<2*O)&&(qs=function(ne){const te=2*ne,re=new a.StructArrayLayout3ui6;re.resize(te),re._trim();for(let ae=0;ae<te;ae++){const ve=6*ae;re.uint16[ve+0]=4*ae+0,re.uint16[ve+1]=4*ae+1,re.uint16[ve+2]=4*ae+2,re.uint16[ve+3]=4*ae+2,re.uint16[ve+4]=4*ae+3,re.uint16[ve+5]=4*ae+0}return re}(O));const se=S.createIndexBuffer(qs,!0),X=S.createVertexBuffer(Z,a.collisionCircleLayout.members,!0);for(const ne of P){const te={u_matrix:ne.transform,u_inv_matrix:ne.invTransform,u_camera_to_center_distance:(ie=d.transform).cameraToCenterDistance,u_viewport_size:[ie.width,ie.height]};K.draw(S,k.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,d.colorModeForRenderPass(),a.CullFaceMode.disabled,te,l.id,X,se,a.SegmentVector.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,d.transform.zoom,null,null,null)}var ie;X.destroy(),se.destroy()}const Ua=a.identity(new Float32Array(16));function Wu(d,r,l,f,_,y){const{horizontalAlign:w,verticalAlign:S}=a.getAnchorAlignment(d),k=-(w-.5)*r,z=-(S-.5)*l,P=a.evaluateVariableOffset(d,f);return new a.pointGeometry((k/_+P[0])*y,(z/_+P[1])*y)}function nf(d,r,l,f,_,y,w,S,k,z,P,O){const V=d.text.placedSymbolArray,K=d.text.dynamicLayoutVertexArray,Z=d.icon.dynamicLayoutVertexArray,Y={},se=S.projMatrix,X=y.elevation,ie=X?X.getAtTileOffsetFunc(S,O):ne=>[0,0,0];K.clear();for(let ne=0;ne<V.length;ne++){const te=V.get(ne),re=d.allowVerticalPlacement&&!te.placedOrientation,ae=te.hidden||!te.crossTileID||re?null:f[te.crossTileID];if(ae){const ve=new a.pointGeometry(te.tileAnchorX,te.tileAnchorY),Ee=ie(ve),Xe=qr(ve,l?se:w,Ee[2]),Ve=Gi(y.cameraToCenterDistance,Xe.signedDistanceFromCamera);let je=_.evaluateSizeForFeature(d.textSizeData,z,te)*Ve/a.ONE_EM;l&&(je*=d.tilePixelRatio/k);const{width:Ce,height:Te,anchor:Ne,textOffset:De,textScale:ct}=ae,mt=Wu(Ne,Ce,Te,De,ct,je),It=l?qr(ve.add(mt),w,Ee[2]).point:Xe.point.add(r?mt.rotate(-y.angle):mt),We=d.allowVerticalPlacement&&te.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let ft=0;ft<te.numGlyphs;ft++)a.addDynamicAttributes(K,It,We);P&&te.associatedIconIndex>=0&&(Y[te.associatedIconIndex]={shiftedAnchor:It,angle:We})}else Sn(te.numGlyphs,K)}if(P){Z.clear();const ne=d.icon.placedSymbolArray;for(let te=0;te<ne.length;te++){const re=ne.get(te);if(re.hidden)Sn(re.numGlyphs,Z);else{const ae=Y[te];if(ae)for(let ve=0;ve<re.numGlyphs;ve++)a.addDynamicAttributes(Z,ae.shiftedAnchor,ae.angle);else Sn(re.numGlyphs,Z)}}d.icon.dynamicLayoutVertexBuffer.updateData(Z)}d.text.dynamicLayoutVertexBuffer.updateData(K)}function of(d,r,l){return l.iconsInText&&r?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function ja(d,r,l,f,_,y,w,S,k,z,P,O){const V=d.context,K=V.gl,Z=d.transform,Y=Z.projection.createTileTransform(Z,Z.worldSize),se=S==="map",X=k==="map",ie=se&&l.layout.get("symbol-placement")!=="point",ne=se&&!X&&!ie,te=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let re=!1;const ae=d.depthModeForSublayer(0,a.DepthMode.ReadOnly),ve=[a.mercatorXfromLng(Z.center.lng),a.mercatorYfromLat(Z.center.lat)],Ee=l.layout.get("text-variable-anchor"),Xe=Z.projection.name==="globe",Ve=Xe?a.globeToMercatorTransition(Z.zoom):0,je=[],Ce=[];d.terrain&&X&&Ce.push("PITCH_WITH_MAP_TERRAIN"),Xe&&Ce.push("PROJECTION_GLOBE_VIEW"),ie&&Ce.push("PROJECTED_POS_ON_VIEWPORT");for(const Te of f){const Ne=r.getTile(Te),De=Ne.getBucket(l);if(!De||De.projection!==Z.projection.name)continue;const ct=_?De.text:De.icon;if(!ct||De.fullyClipped||!ct.segments.get().length)continue;const mt=ct.programConfigurations.get(l.id),It=_||De.sdfIcons,We=_?De.textSizeData:De.iconSizeData,ft=X||Z.pitch!==0,xt=d.useProgram(of(It,_,De),mt,Ce),ar=a.evaluateSizeForZoom(We,Z.zoom),vr=[Te.canonical.x,Te.canonical.y,1<<Te.canonical.z];let yt,Lt,Mr,ti,Di=[0,0],hn=null;if(_){if(Lt=Ne.glyphAtlasTexture,Mr=K.LINEAR,yt=Ne.glyphAtlasTexture.size,De.iconsInText){Di=Ne.imageAtlasTexture.size,hn=Ne.imageAtlasTexture;const li=We.kind==="composite"||We.kind==="camera";ti=ft||d.options.rotating||d.options.zooming||li?K.LINEAR:K.NEAREST}}else{const li=l.layout.get("icon-size").constantOr(0)!==1||De.iconsNeedLinear;Lt=Ne.imageAtlasTexture,Mr=It||d.options.rotating||d.options.zooming||li||ft?K.LINEAR:K.NEAREST,yt=Ne.imageAtlasTexture.size}const In=d.transform.calculatePixelsToTileUnitsMatrix(Ne),$t=on(Te.projMatrix,Ne.tileID.canonical,X,se,d.transform,In),bt=d.terrain&&X&&ie?a.invert(new Float32Array(16),$t):Ua,Ft=sn(Te.projMatrix,Ne.tileID.canonical,X,se,d.transform,In),jr=Ee&&De.hasTextData(),Zi=l.layout.get("icon-text-fit")!=="none"&&jr&&De.hasIconData();if(ie){const li=Z.elevation,jo=li?li.getAtTileOffsetFunc(Te,Y):Eo=>[0,0,0];zu(De,Te.projMatrix,d,_,$t,Ft,X,z,jo,Te)}const Ar=d.translatePosMatrix(Te.projMatrix,Ne,y,w),Wi=ie||_&&Ee||Zi?Ua:$t,sa=d.translatePosMatrix(Ft,Ne,y,w,!0),Li=It&&l.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Uo;const nt=Y.createInversionMatrix(Te.toUnwrapped());Uo=It?De.iconsInText?Gs(We.kind,ar,ne,X,d,Ar,Wi,sa,yt,Di,vr,Ve,nt,ve):$s(We.kind,ar,ne,X,d,Ar,Wi,sa,_,yt,!0,vr,Ve,nt,ve):Fa(We.kind,ar,ne,X,d,Ar,Wi,sa,_,yt,vr,Ve,nt,ve);const pt={program:xt,buffers:ct,uniformValues:Uo,atlasTexture:Lt,atlasTextureIcon:hn,atlasInterpolation:Mr,atlasInterpolationIcon:ti,isSDF:It,hasHalo:Li,tile:Ne,labelPlaneMatrixInv:bt};if(te&&De.canOverlap){re=!0;const li=ct.segments.get();for(const jo of li)je.push({segments:new a.SegmentVector([jo]),sortKey:jo.sortKey,state:pt})}else je.push({segments:ct.segments,sortKey:0,state:pt})}re&&je.sort((Te,Ne)=>Te.sortKey-Ne.sortKey);for(const Te of je){const Ne=Te.state;if(d.terrain&&d.terrain.setupElevationDraw(Ne.tile,Ne.program,{useDepthForOcclusion:!Xe,labelPlaneMatrixInv:Ne.labelPlaneMatrixInv}),V.activeTexture.set(K.TEXTURE0),Ne.atlasTexture.bind(Ne.atlasInterpolation,K.CLAMP_TO_EDGE),Ne.atlasTextureIcon&&(V.activeTexture.set(K.TEXTURE1),Ne.atlasTextureIcon&&Ne.atlasTextureIcon.bind(Ne.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),Ne.isSDF){const De=Ne.uniformValues;Ne.hasHalo&&(De.u_is_halo=1,Va(Ne.buffers,Te.segments,l,d,Ne.program,ae,P,O,De)),De.u_is_halo=0}Va(Ne.buffers,Te.segments,l,d,Ne.program,ae,P,O,Ne.uniformValues)}}function Va(d,r,l,f,_,y,w,S,k){const z=f.context;_.draw(z,z.gl.TRIANGLES,y,w,S,a.CullFaceMode.disabled,k,l.id,d.layoutVertexBuffer,d.indexBuffer,r,l.paint,f.transform.zoom,d.programConfigurations.get(l.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function $a(d,r,l,f,_,y,w){const S=d.context.gl,k=l.paint.get("fill-pattern"),z=k&&k.constantOr(1),P=l.getCrossfadeParameters();let O,V,K,Z,Y;w?(V=z&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=S.LINES):(V=z?"fillPattern":"fill",O=S.TRIANGLES);for(const se of f){const X=r.getTile(se);if(z&&!X.patternsLoaded())continue;const ie=X.getBucket(l);if(!ie)continue;d.prepareDrawTile(se);const ne=ie.programConfigurations.get(l.id),te=d.useProgram(V,ne);z&&(d.context.activeTexture.set(S.TEXTURE0),X.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),ne.updatePaintBuffers(P));const re=k.constantOr(null);if(re&&X.imageAtlas){const ve=X.imageAtlas,Ee=ve.patternPositions[re.to.toString()],Xe=ve.patternPositions[re.from.toString()];Ee&&Xe&&ne.setConstantPatternPositions(Ee,Xe)}const ae=d.translatePosMatrix(se.projMatrix,X,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(w){Z=ie.indexBuffer2,Y=ie.segments2;const ve=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];K=V==="fillOutlinePattern"&&z?Vu(ae,d,P,X,ve):tf(ae,ve)}else Z=ie.indexBuffer,Y=ie.segments,K=z?nc(ae,d,P,X):ju(ae);d.prepareDrawProgram(d.context,te,se.toUnwrapped()),te.draw(d.context,O,_,d.stencilModeForClipping(se),y,a.CullFaceMode.disabled,K,l.id,ie.layoutVertexBuffer,Z,Y,l.paint,d.transform.zoom,ne)}}function Zs(d,r,l,f,_,y,w){const S=d.context,k=S.gl,z=l.paint.get("fill-extrusion-pattern"),P=z.constantOr(1),O=l.getCrossfadeParameters(),V=l.paint.get("fill-extrusion-opacity");for(const K of f){const Z=r.getTile(K),Y=Z.getBucket(l);if(!Y)continue;const se=Y.programConfigurations.get(l.id),X=d.useProgram(P?"fillExtrusionPattern":"fillExtrusion",se);if(d.terrain){const ae=d.terrain;if(!Y.enableTerrain)continue;if(ae.setupElevationDraw(Z,X,{useMeterToDem:!0}),Xu(S,r,K,Y,l,ae),!Y.centroidVertexBuffer){const ve=X.attributes.a_centroid_pos;ve!==void 0&&k.vertexAttrib2f(ve,0,0)}}P&&(d.context.activeTexture.set(k.TEXTURE0),Z.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),se.updatePaintBuffers(O));const ie=z.constantOr(null);if(ie&&Z.imageAtlas){const ae=Z.imageAtlas,ve=ae.patternPositions[ie.to.toString()],Ee=ae.patternPositions[ie.from.toString()];ve&&Ee&&se.setConstantPatternPositions(ve,Ee)}const ne=d.translatePosMatrix(K.projMatrix,Z,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),te=l.paint.get("fill-extrusion-vertical-gradient"),re=P?ic(ne,d,te,V,K,O,Z):Uu(ne,d,te,V);d.prepareDrawProgram(S,X,K.toUnwrapped()),X.draw(S,S.gl.TRIANGLES,_,y,w,a.CullFaceMode.backCCW,re,l.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,l.paint,d.transform.zoom,se,d.terrain?Y.centroidVertexBuffer:null)}}function Xu(d,r,l,f,_,y){const w=[X=>{let ie=X.canonical.x-1,ne=X.wrap;return ie<0&&(ie=(1<<X.canonical.z)-1,ne--),new a.OverscaledTileID(X.overscaledZ,ne,X.canonical.z,ie,X.canonical.y)},X=>{let ie=X.canonical.x+1,ne=X.wrap;return ie===1<<X.canonical.z&&(ie=0,ne++),new a.OverscaledTileID(X.overscaledZ,ne,X.canonical.z,ie,X.canonical.y)},X=>new a.OverscaledTileID(X.overscaledZ,X.wrap,X.canonical.z,X.canonical.x,(X.canonical.y===0?1<<X.canonical.z:X.canonical.y)-1),X=>new a.OverscaledTileID(X.overscaledZ,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y===(1<<X.canonical.z)-1?0:X.canonical.y+1)],S=X=>{const ie=r.getSource().maxzoom,ne=ve=>{const Ee=r.getTileByID(ve);if(Ee&&Ee.hasData())return Ee.getBucket(_)};let te,re,ae;return(X.overscaledZ===X.canonical.z||X.overscaledZ>=ie)&&(te=ne(X.key)),X.overscaledZ>=ie&&(re=ne(X.calculateScaledKey(X.overscaledZ+1))),X.overscaledZ>ie&&(ae=ne(X.calculateScaledKey(X.overscaledZ-1))),te||re||ae},k=[0,0,0],z=(X,ie)=>(k[0]=Math.min(X.min.y,ie.min.y),k[1]=Math.max(X.max.y,ie.max.y),k[2]=a.EXTENT-ie.min.x>X.max.x?ie.min.x-a.EXTENT:X.max.x,k),P=(X,ie)=>(k[0]=Math.min(X.min.x,ie.min.x),k[1]=Math.max(X.max.x,ie.max.x),k[2]=a.EXTENT-ie.min.y>X.max.y?ie.min.y-a.EXTENT:X.max.y,k),O=[(X,ie)=>z(X,ie),(X,ie)=>z(ie,X),(X,ie)=>P(X,ie),(X,ie)=>P(ie,X)],V=new a.pointGeometry(0,0);let K,Z,Y;const se=(X,ie,ne,te,re)=>{const ae=[[te?ne:X,te?X:ne,0],[te?ne:ie,te?ie:ne,0]],ve=re<0?a.EXTENT+re:re,Ee=[te?ve:(X+ie)/2,te?(X+ie)/2:ve,0];return ne===0&&re<0||ne!==0&&re>0?y.getForTilePoints(Y,[Ee],!0,Z):ae.push(Ee),y.getForTilePoints(l,ae,!0,K),Math.max(ae[0][2],ae[1][2],Ee[2])/y.exaggeration()};for(let X=0;X<4;X++){const ie=f.borders[X];if(ie.length===0&&(f.borderDone[X]=!0),f.borderDone[X])continue;const ne=Y=w[X](l),te=S(ne);if(!te||!te.enableTerrain||(Z=y.findDEMTileFor(ne),!Z||!Z.dem))continue;if(!K){const Ee=y.findDEMTileFor(l);if(!Ee||!Ee.dem)return;K=Ee}const re=(X<2?1:5)-X,ae=te.borders[re];let ve=0;for(let Ee=0;Ee<ie.length;Ee++){const Xe=f.featuresOnBorder[ie[Ee]],Ve=Xe.borders[X];let je;for(;ve<ae.length&&(je=te.featuresOnBorder[ae[ve]],!(je.borders[re][1]>Ve[0]+3));)te.borderDone[re]||te.encodeCentroid(void 0,je,!1),ve++;if(je&&ve<ae.length){const Ce=ve;let Te=0;for(;!(je.borders[re][0]>Ve[1]-3)&&(Te++,++ve!==ae.length);)je=te.featuresOnBorder[ae[ve]];if(je=te.featuresOnBorder[ae[Ce]],Xe.intersectsCount()>1||je.intersectsCount()>1||Te!==1){Te!==1&&(ve=Ce),f.encodeCentroid(void 0,Xe,!1),te.borderDone[re]||te.encodeCentroid(void 0,je,!1);continue}const Ne=O[X](Xe,je),De=X%2?a.EXTENT-1:0;V.x=se(Ne[0],Math.min(a.EXTENT-1,Ne[1]),De,X<2,Ne[2]),V.y=0,f.encodeCentroid(V,Xe,!1),te.borderDone[re]||te.encodeCentroid(V,je,!1)}else f.encodeCentroid(void 0,Xe,!1)}f.borderDone[X]=f.needsCentroidUpdate=!0,te.borderDone[re]||(te.borderDone[re]=te.needsCentroidUpdate=!0)}(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(d)}const Hu=new a.Color(1,0,0,1),sf=new a.Color(0,1,0,1),Ws=new a.Color(0,0,1,1),Xs=new a.Color(1,0,1,1),Ku=new a.Color(0,1,1,1);function Pi(d,r,l,f){No(d,0,r+l/2,d.transform.width,l,f)}function Ga(d,r,l,f){No(d,r-l/2,0,l,d.transform.height,f)}function No(d,r,l,f,_,y){const w=d.context,S=w.gl;S.enable(S.SCISSOR_TEST),S.scissor(r*a.exported.devicePixelRatio,l*a.exported.devicePixelRatio,f*a.exported.devicePixelRatio,_*a.exported.devicePixelRatio),w.clear({color:y}),S.disable(S.SCISSOR_TEST)}function qa(d,r,l){const f=d.context,_=f.gl,y=l.projMatrix,w=d.useProgram("debug"),S=r.getTileByID(l.key);d.terrain&&d.terrain.setupElevationDraw(S,w);const k=a.DepthMode.disabled,z=a.StencilMode.disabled,P=d.colorModeForRenderPass(),O="$debug";f.activeTexture.set(_.TEXTURE0),d.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),S._makeDebugTileBoundsBuffers(d.context,d.transform.projection);const V=S._tileDebugBuffer||d.debugBuffer,K=S._tileDebugIndexBuffer||d.debugIndexBuffer,Z=S._tileDebugSegments||d.debugSegments;w.draw(f,_.LINE_STRIP,k,z,P,a.CullFaceMode.disabled,sc(y,a.Color.red),O,V,K,Z);const Y=S.latestRawTileData,se=Math.floor((Y&&Y.byteLength||0)/1024),X=r.getTile(l).tileSize,ie=512/Math.min(X,512)*(l.overscaledZ/d.transform.zoom)*.5;let ne=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(ne+=` => ${l.overscaledZ}`),function(te,re){te.initDebugOverlayCanvas();const ae=te.debugOverlayCanvas,ve=te.context.gl,Ee=te.debugOverlayCanvas.getContext("2d");Ee.clearRect(0,0,ae.width,ae.height),Ee.shadowColor="white",Ee.shadowBlur=2,Ee.lineWidth=1.5,Ee.strokeStyle="white",Ee.textBaseline="top",Ee.font="bold 36px Open Sans, sans-serif",Ee.fillText(re,5,5),Ee.strokeText(re,5,5),te.debugOverlayTexture.update(ae),te.debugOverlayTexture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE)}(d,`${ne} ${se}kb`),w.draw(f,_.TRIANGLES,k,z,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,sc(y,a.Color.transparent,ie),O,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments)}const lc=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:cc}=lc;function An(d,r,l,f){d.emplaceBack(r,l,f)}class Za{constructor(r){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,An(this.vertexArray,-1,-1,1),An(this.vertexArray,1,-1,1),An(this.vertexArray,-1,1,1),An(this.vertexArray,1,1,1),An(this.vertexArray,-1,-1,-1),An(this.vertexArray,1,-1,-1),An(this.vertexArray,-1,1,-1),An(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,cc),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function xo(d,r,l,f,_,y){const w=d.gl,S=r.paint.get("sky-atmosphere-color"),k=r.paint.get("sky-atmosphere-halo-color"),z=r.paint.get("sky-atmosphere-sun-intensity"),P=((O,V,K,Z,Y)=>({u_matrix_3f:O,u_sun_direction:V,u_sun_intensity:K,u_color_tint_r:[Z.r,Z.g,Z.b,Z.a],u_color_tint_m:[Y.r,Y.g,Y.b,Y.a],u_luminance:5e-5}))(a.fromMat4([],f),_,z,S,k);w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+y,r.skyboxTexture,0),l.draw(d,w.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,P,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Hs={symbol:function(d,r,l,f,_){if(d.renderPass!=="translucent")return;const y=a.StencilMode.disabled,w=d.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(S,k,z,P,O,V,K){const Z=k.transform,Y=O==="map",se=V==="map",X=Z.projection.createTileTransform(Z,Z.worldSize);for(const ie of S){const ne=P.getTile(ie),te=ne.getBucket(z);if(!te||te.projection!==Z.projection.name||!te.text||!te.text.segments.get().length)continue;const re=a.evaluateSizeForZoom(te.textSizeData,Z.zoom),ae=k.transform.calculatePixelsToTileUnitsMatrix(ne),ve=on(ie.projMatrix,ne.tileID.canonical,se,Y,k.transform,ae),Ee=z.layout.get("icon-text-fit")!=="none"&&te.hasIconData();if(re){const Xe=Math.pow(2,Z.zoom-ne.tileID.overscaledZ);nf(te,Y,se,K,a.symbolSize,Z,ve,ie,Xe,re,Ee,X)}}}(f,d,l,r,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_),l.paint.get("icon-opacity").constantOr(1)!==0&&ja(d,r,l,f,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),y,w),l.paint.get("text-opacity").constantOr(1)!==0&&ja(d,r,l,f,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),y,w),r.map.showCollisionBoxes&&(ac(d,r,l,f,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),ac(d,r,l,f,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(d,r,l,f){if(d.renderPass!=="translucent")return;const _=l.paint.get("circle-opacity"),y=l.paint.get("circle-stroke-width"),w=l.paint.get("circle-stroke-opacity"),S=l.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)===0&&(y.constantOr(1)===0||w.constantOr(1)===0))return;const k=d.context,z=k.gl,P=d.depthModeForSublayer(0,a.DepthMode.ReadOnly),O=a.StencilMode.disabled,V=d.colorModeForRenderPass(),K=[];for(let Y=0;Y<f.length;Y++){const se=f[Y],X=r.getTile(se),ie=X.getBucket(l);if(!ie)continue;const ne=ie.programConfigurations.get(l.id),te=oc(l),re={programConfiguration:ne,program:d.useProgram("circle",ne,te),layoutVertexBuffer:ie.layoutVertexBuffer,indexBuffer:ie.indexBuffer,uniformValues:rf(d,se,X,l),tile:X};if(S){const ae=ie.segments.get();for(const ve of ae)K.push({segments:new a.SegmentVector([ve]),sortKey:ve.sortKey,state:re})}else K.push({segments:ie.segments,sortKey:0,state:re})}S&&K.sort((Y,se)=>Y.sortKey-se.sortKey);const Z={useDepthForOcclusion:d.transform.projection.name!=="globe"};for(const Y of K){const{programConfiguration:se,program:X,layoutVertexBuffer:ie,indexBuffer:ne,uniformValues:te,tile:re}=Y.state,ae=Y.segments;d.terrain&&d.terrain.setupElevationDraw(re,X,Z),d.prepareDrawProgram(k,X,re.tileID.toUnwrapped()),X.draw(k,z.TRIANGLES,P,O,V,a.CullFaceMode.disabled,te,l.id,ie,ne,ae,l.paint,d.transform.zoom,se)}},heatmap:function(d,r,l,f){if(l.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const _=d.context,y=_.gl,w=a.StencilMode.disabled,S=new a.ColorMode([y.ONE,y.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(k,z,P){const O=k.gl;k.activeTexture.set(O.TEXTURE1),k.viewport.set([0,0,z.width/4,z.height/4]);let V=P.heatmapFbo;if(V)O.bindTexture(O.TEXTURE_2D,V.colorAttachment.get()),k.bindFramebuffer.set(V.framebuffer);else{const K=O.createTexture();O.bindTexture(O.TEXTURE_2D,K),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR),V=P.heatmapFbo=k.createFramebuffer(z.width/4,z.height/4,!1),function(Z,Y,se,X){const ie=Z.gl;ie.texImage2D(ie.TEXTURE_2D,0,ie.RGBA,Y.width/4,Y.height/4,0,ie.RGBA,Z.extRenderToTextureHalfFloat?Z.extTextureHalfFloat.HALF_FLOAT_OES:ie.UNSIGNED_BYTE,null),X.colorAttachment.set(se)}(k,z,K,V)}})(_,d,l),_.clear({color:a.Color.transparent});for(let k=0;k<f.length;k++){const z=f[k];if(r.hasRenderableParent(z))continue;const P=r.getTile(z),O=P.getBucket(l);if(!O)continue;const V=O.programConfigurations.get(l.id),K=d.useProgram("heatmap",V),{zoom:Z}=d.transform;d.terrain&&d.terrain.setupElevationDraw(P,K),d.prepareDrawProgram(_,K,z.toUnwrapped()),K.draw(_,y.TRIANGLES,a.DepthMode.disabled,w,S,a.CullFaceMode.disabled,Gu(z.projMatrix,P,Z,l.paint.get("heatmap-intensity")),l.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,l.paint,d.transform.zoom,V)}_.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(_,y){const w=_.context,S=w.gl,k=y.heatmapFbo;if(!k)return;w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,k.colorAttachment.get()),w.activeTexture.set(S.TEXTURE1);let z=y.colorRampTexture;z||(z=y.colorRampTexture=new a.Texture(w,y.colorRamp,S.RGBA)),z.bind(S.LINEAR,S.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(w,S.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,_.colorModeForRenderPass(),a.CullFaceMode.disabled,((P,O,V,K)=>({u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}))(0,y),y.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,y.paint,_.transform.zoom)}(d,l))},line:function(d,r,l,f){if(d.renderPass!=="translucent")return;const _=l.paint.get("line-opacity"),y=l.paint.get("line-width");if(_.constantOr(1)===0||y.constantOr(1)===0)return;const w=d.depthModeForSublayer(0,a.DepthMode.ReadOnly),S=d.colorModeForRenderPass(),k=l.paint.get("line-dasharray"),z=k.constantOr(1),P=l.layout.get("line-cap"),O=l.paint.get("line-pattern"),V=O.constantOr(1),K=l.paint.get("line-gradient"),Z=l.getCrossfadeParameters(),Y=V?"linePattern":"line",se=d.context,X=se.gl,ie=(te=>{const re=[];Vs(te)&&re.push("RENDER_LINE_DASH"),te.paint.get("line-gradient")&&re.push("RENDER_LINE_GRADIENT");const ae=te.paint.get("line-pattern").constantOr(1),ve=te.paint.get("line-opacity").constantOr(1)!==1;return!ae&&ve&&re.push("RENDER_LINE_ALPHA_DISCARD"),re})(l);let ne=ie.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(ne=!1);for(const te of f){const re=r.getTile(te);if(V&&!re.patternsLoaded())continue;const ae=re.getBucket(l);if(!ae)continue;d.prepareDrawTile(te);const ve=ae.programConfigurations.get(l.id),Ee=d.useProgram(Y,ve,ie),Xe=O.constantOr(null);if(Xe&&re.imageAtlas){const De=re.imageAtlas,ct=De.patternPositions[Xe.to.toString()],mt=De.patternPositions[Xe.from.toString()];ct&&mt&&ve.setConstantPatternPositions(ct,mt)}const Ve=k.constantOr(null),je=P.constantOr(null);if(!V&&Ve&&je&&re.lineAtlas){const De=re.lineAtlas,ct=De.getDash(Ve.to,je),mt=De.getDash(Ve.from,je);ct&&mt&&ve.setConstantPatternPositions(ct,mt)}const Ce=d.terrain?te.projMatrix:null,Te=V?Fo(d,re,l,Z,Ce):qu(d,re,l,Z,Ce,ae.lineClipsArray.length);if(K){const De=ae.gradients[l.id];let ct=De.texture;if(l.gradientVersion!==De.version){let mt=256;if(l.stepInterpolant){const It=r.getSource().maxzoom,We=te.canonical.z===It?Math.ceil(1<<d.transform.maxZoom-te.canonical.z):1;mt=a.clamp(a.nextPowerOfTwo(ae.maxLineLength/a.EXTENT*1024*We),256,se.maxTextureSize)}De.gradient=a.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:mt,image:De.gradient||void 0,clips:ae.lineClipsArray}),De.texture?De.texture.update(De.gradient):De.texture=new a.Texture(se,De.gradient,X.RGBA),De.version=l.gradientVersion,ct=De.texture}se.activeTexture.set(X.TEXTURE1),ct.bind(l.stepInterpolant?X.NEAREST:X.LINEAR,X.CLAMP_TO_EDGE)}z&&(se.activeTexture.set(X.TEXTURE0),re.lineAtlasTexture.bind(X.LINEAR,X.REPEAT),ve.updatePaintBuffers(Z)),V&&(se.activeTexture.set(X.TEXTURE0),re.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),ve.updatePaintBuffers(Z)),d.prepareDrawProgram(se,Ee,te.toUnwrapped());const Ne=De=>{Ee.draw(se,X.TRIANGLES,w,De,S,a.CullFaceMode.disabled,Te,l.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,l.paint,d.transform.zoom,ve,ae.layoutVertexBuffer2)};if(ne){const De=d.stencilModeForClipping(te).ref;De===0&&d.terrain&&se.clear({stencil:0});const ct={func:X.EQUAL,mask:255};Te.u_alpha_discard_threshold=.8,Ne(new a.StencilMode(ct,De,255,X.KEEP,X.KEEP,X.INVERT)),Te.u_alpha_discard_threshold=0,Ne(new a.StencilMode(ct,De,255,X.KEEP,X.KEEP,X.KEEP))}else Ne(d.stencilModeForClipping(te))}ne&&(d.resetStencilClippingMasks(),d.terrain&&se.clear({stencil:0}))},fill:function(d,r,l,f){const _=l.paint.get("fill-color"),y=l.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const w=d.colorModeForRenderPass(),S=l.paint.get("fill-pattern"),k=d.opaquePassEnabledForLayer()&&!S.constantOr(1)&&_.constantOr(a.Color.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===k){const z=d.depthModeForSublayer(1,d.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);$a(d,r,l,f,z,w,!1)}if(d.renderPass==="translucent"&&l.paint.get("fill-antialias")){const z=d.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);$a(d,r,l,f,z,w,!0)}},"fill-extrusion":function(d,r,l,f){const _=l.paint.get("fill-extrusion-opacity");if(_!==0&&d.renderPass==="translucent"){const y=new a.DepthMode(d.context.gl.LEQUAL,a.DepthMode.ReadWrite,d.depthRangeFor3D);if(_!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))Zs(d,r,l,f,y,a.StencilMode.disabled,a.ColorMode.disabled),Zs(d,r,l,f,y,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{const w=d.colorModeForRenderPass();Zs(d,r,l,f,y,a.StencilMode.disabled,w)}}},hillshade:function(d,r,l,f){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const _=d.context,y=d.depthModeForSublayer(0,a.DepthMode.ReadOnly),w=d.colorModeForRenderPass(),S=d.terrain&&d.terrain.renderingToTexture,[k,z]=d.renderPass!=="translucent"||S?[{},f]:d.stencilConfigForOverlap(f);for(const P of z){const O=r.getTile(P);if(O.needsHillshadePrepare&&d.renderPass==="offscreen")Fs(d,O,l,y,a.StencilMode.disabled,w);else if(d.renderPass==="translucent"){const V=S&&d.terrain?d.terrain.stencilModeForRTTOverlap(P):k[P.overscaledZ];Da(d,P,O,l,y,V,w)}}_.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,r,l,f,_,y){if(d.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!f.length)return;const w=d.context,S=w.gl,k=r.getSource(),z=d.useProgram("raster"),P=d.colorModeForRenderPass(),O=d.terrain&&d.terrain.renderingToTexture,[V,K]=k instanceof Br||O?[{},f]:d.stencilConfigForOverlap(f),Z=K[K.length-1].overscaledZ,Y=!d.options.moving;for(const se of K){const X=O?a.DepthMode.disabled:d.depthModeForSublayer(se.overscaledZ-Z,l.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,S.LESS),ie=se.toUnwrapped(),ne=r.getTile(se);if(O&&(!ne||!ne.hasData()))continue;const te=O?se.projMatrix:d.transform.calculateProjMatrix(ie,Y),re=d.terrain&&O?d.terrain.stencilModeForRTTOverlap(se):V[se.overscaledZ],ae=y?0:l.paint.get("raster-fade-duration");ne.registerFadeDuration(ae);const ve=r.findLoadedParent(se,0),Ee=Bu(ne,ve,r,d.transform,ae);let Xe,Ve;d.terrain&&d.terrain.prepareDrawTile(se);const je=l.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;w.activeTexture.set(S.TEXTURE0),ne.texture.bind(je,S.CLAMP_TO_EDGE),w.activeTexture.set(S.TEXTURE1),ve?(ve.texture.bind(je,S.CLAMP_TO_EDGE),Xe=Math.pow(2,ve.tileID.overscaledZ-ne.tileID.overscaledZ),Ve=[ne.tileID.canonical.x*Xe%1,ne.tileID.canonical.y*Xe%1]):ne.texture.bind(je,S.CLAMP_TO_EDGE);const Ce=Oa(te,Ve||[0,0],Xe||1,Ee,l,k instanceof Br?k.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(w,z,ie),k instanceof Br)z.draw(w,S.TRIANGLES,X,a.StencilMode.disabled,P,a.CullFaceMode.disabled,Ce,l.id,k.boundsBuffer,d.quadTriangleIndexBuffer,k.boundsSegments);else{const{tileBoundsBuffer:Te,tileBoundsIndexBuffer:Ne,tileBoundsSegments:De}=d.getTileBoundsBuffers(ne);z.draw(w,S.TRIANGLES,X,re,P,a.CullFaceMode.disabled,Ce,l.id,Te,Ne,De)}}d.resetStencilClippingMasks()},background:function(d,r,l,f){const _=l.paint.get("background-color"),y=l.paint.get("background-opacity");if(y===0)return;const w=d.context,S=w.gl,k=d.transform,z=k.tileSize,P=l.paint.get("background-pattern");if(d.isPatternMissing(P))return;const O=!P&&_.a===1&&y===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==O)return;const V=a.StencilMode.disabled,K=d.depthModeForSublayer(0,O==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),Z=d.colorModeForRenderPass(),Y=d.useProgram(P?"backgroundPattern":"background");let se,X=f;X||(se=d.getBackgroundTiles(),X=Object.values(se).map(ne=>ne.tileID)),P&&(w.activeTexture.set(S.TEXTURE0),d.imageManager.bind(d.context));const ie=l.getCrossfadeParameters();for(const ne of X){const te=ne.toUnwrapped(),re=f?ne.projMatrix:d.transform.calculateProjMatrix(te);d.prepareDrawTile(ne);const ae=r?r.getTile(ne):se?se[ne.key]:new a.Tile(ne,z,k.zoom,d),ve=P?Na(re,y,d,P,{tileID:ne,tileSize:z},ie):nr(re,y,_);d.prepareDrawProgram(w,Y,te);const{tileBoundsBuffer:Ee,tileBoundsIndexBuffer:Xe,tileBoundsSegments:Ve}=d.getTileBoundsBuffers(ae);Y.draw(w,S.TRIANGLES,K,V,Z,a.CullFaceMode.disabled,ve,l.id,Ee,Xe,Ve)}},sky:function(d,r,l){const f=d.transform,_=f.projection.name==="mercator"||f.projection.name==="globe"?1:a.smoothstep(7,8,f.zoom),y=l.paint.get("sky-opacity")*_;if(y===0)return;const w=d.context,S=l.paint.get("sky-type"),k=new a.DepthMode(w.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),z=d.frameCounter/1e3%1;S==="atmosphere"?d.renderPass==="offscreen"?l.needsSkyboxCapture(d)&&(function(P,O,V,K){const Z=P.context,Y=Z.gl;let se=O.skyboxFbo;if(!se){se=O.skyboxFbo=Z.createFramebuffer(32,32,!1),O.skyboxGeometry=new Za(Z),O.skyboxTexture=Z.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,O.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let te=0;te<6;++te)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}Z.bindFramebuffer.set(se.framebuffer),Z.viewport.set([0,0,32,32]);const X=O.getCenter(P,!0),ie=P.useProgram("skyboxCapture"),ne=new Float64Array(16);a.identity(ne),a.rotateY(ne,ne,.5*-Math.PI),xo(Z,O,ie,ne,X,0),a.identity(ne),a.rotateY(ne,ne,.5*Math.PI),xo(Z,O,ie,ne,X,1),a.identity(ne),a.rotateX(ne,ne,.5*-Math.PI),xo(Z,O,ie,ne,X,2),a.identity(ne),a.rotateX(ne,ne,.5*Math.PI),xo(Z,O,ie,ne,X,3),a.identity(ne),xo(Z,O,ie,ne,X,4),a.identity(ne),a.rotateY(ne,ne,Math.PI),xo(Z,O,ie,ne,X,5),Z.viewport.set([0,0,P.width,P.height])}(d,l),l.markSkyboxValid(d)):d.renderPass==="sky"&&function(P,O,V,K,Z){const Y=P.context,se=Y.gl,X=P.transform,ie=P.useProgram("skybox");Y.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,O.skyboxTexture);const ne=((te,re,ae,ve,Ee)=>({u_matrix:te,u_sun_direction:re,u_cubemap:0,u_opacity:ve,u_temporal_offset:Ee}))(X.skyboxMatrix,O.getCenter(P,!1),0,K,Z);P.prepareDrawProgram(Y,ie),ie.draw(Y,se.TRIANGLES,V,a.StencilMode.disabled,P.colorModeForRenderPass(),a.CullFaceMode.backCW,ne,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(d,l,k,y,z):S==="gradient"&&d.renderPass==="sky"&&function(P,O,V,K,Z){const Y=P.context,se=Y.gl,X=P.transform,ie=P.useProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new Za(Y)),Y.activeTexture.set(se.TEXTURE0);let ne=O.colorRampTexture;ne||(ne=O.colorRampTexture=new a.Texture(Y,O.colorRamp,se.RGBA)),ne.bind(se.LINEAR,se.CLAMP_TO_EDGE);const te=((re,ae,ve,Ee,Xe)=>({u_matrix:re,u_color_ramp:0,u_center_direction:ae,u_radius:a.degToRad(ve),u_opacity:Ee,u_temporal_offset:Xe}))(X.skyboxMatrix,O.getCenter(P,!1),O.paint.get("sky-gradient-radius"),K,Z);P.prepareDrawProgram(Y,ie),ie.draw(Y,se.TRIANGLES,V,a.StencilMode.disabled,P.colorModeForRenderPass(),a.CullFaceMode.backCW,te,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(d,l,k,y,z)},debug:function(d,r,l){for(let f=0;f<l.length;f++)qa(d,r,l[f])},custom:function(d,r,l){const f=d.context,_=l.implementation;if(d.transform.projection.unsupportedLayers&&d.transform.projection.unsupportedLayers.includes("custom"))a.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(d.renderPass==="offscreen"){const y=_.prerender;y&&(d.setCustomLayerDefaults(),f.setColorMode(d.colorModeForRenderPass()),y.call(_,f.gl,d.transform.customLayerMatrix()),f.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),f.setColorMode(d.colorModeForRenderPass()),f.setStencilMode(a.StencilMode.disabled);const y=_.renderingMode==="3d"?new a.DepthMode(d.context.gl.LEQUAL,a.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,a.DepthMode.ReadOnly);f.setDepthMode(y),_.render(f.gl,d.transform.customLayerMatrix()),f.setDirty(),d.setBaseState(),f.bindFramebuffer.set(null)}}};class Yu{constructor(r,l){this.context=new Et(r),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Os,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,l){const f=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new vo(this,r));const _=this._terrain;this.transform.elevation=f?_:null,_.update(r,this.transform,l)}_updateFog(r){const l=r.fog;if(!l||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,_]=l.getFovAdjustedRange(this.transform._fov);if(f>_)return void(this.transform.fogCullDistSq=null);const y=f+.78*(_-f);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,l){if(this.width=r*a.exported.devicePixelRatio,this.height=l*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._layers[f].resize()}setup(){const r=this.context,l=new a.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(a.EXTENT,0),l.emplaceBack(0,a.EXTENT),l.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(l,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const f=new a.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(a.EXTENT,0),f.emplaceBack(0,a.EXTENT),f.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=r.createVertexBuffer(f,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const _=new a.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(_,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const y=new a.StructArrayLayout4i8;y.emplaceBack(0,0,0,0),y.emplaceBack(a.EXTENT,0,a.EXTENT,0),y.emplaceBack(0,a.EXTENT,0,a.EXTENT),y.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(y,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const w=new a.StructArrayLayout3ui6;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(w);const S=new a.StructArrayLayout1ui2;for(const z of[0,1,3,2,0])S.emplaceBack(z);this.debugIndexBuffer=r.createIndexBuffer(S),this.emptyTexture=new a.Texture(r,{width:1,height:1,data:new Uint8Array([0,0,0,0])},r.gl.RGBA),this.identityMat=a.create();const k=this.context.gl;this.stencilClearMode=new a.StencilMode({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(a.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,l=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,l.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,Un(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,l,f){if(!l||this.currentStencilSource===l.id||!r.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const k of f)if(this._tileClippingMaskIDs[k.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=l.id;const _=this.context,y=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(a.ColorMode.disabled),_.setDepthMode(a.DepthMode.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of f){const k=l.getTile(S),z=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:O,tileBoundsSegments:V}=this.getTileBoundsBuffers(k);w.draw(_,y.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:y.ALWAYS,mask:0},z,255,y.KEEP,y.KEEP,y.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,Un(S.projMatrix),"$clipping",P,O,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new a.StencilMode({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const l=this.context.gl;return new a.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,f=r.sort((w,S)=>S.overscaledZ-w.overscaledZ),_=f[f.length-1].overscaledZ,y=f[0].overscaledZ-_+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const w={};for(let S=0;S<y;S++)w[S+_]=new a.StencilMode({func:l.GEQUAL,mask:255},S+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=y,[w,f]}return[{[_]:a.StencilMode.disabled},f]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([r.CONSTANT_COLOR,r.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(r,l,f){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new a.DepthMode(f||this.context.gl.LEQUAL,l,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,l){this.style=r,this.options=l,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const f=this.style.order,_=this.style._sourceCaches;for(const z in _){const P=_[z];P.used&&P.prepare(this.context)}const y={},w={},S={};for(const z in _){const P=_[z];y[z]=P.getVisibleCoordinates(),w[z]=y[z].slice().reverse(),S[z]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<f.length;z++)if(this.style._layers[f[z]].is3D()){this.opaquePassCutoff=z;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),!a.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const z of f){const P=this.style._layers[z],O=r._getLayerSourceCache(P);if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const V=O?w[O.id]:void 0;(P.type==="custom"||P.isSky()||V&&V.length)&&this.renderLayer(this,O,P,V)}this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let k=a.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(k=this.style.fog.properties.get("color")),this.context.clear({color:l.showOverdrawInspector?a.Color.black:k,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[f[this.currentLayer]],P=r._getLayerSourceCache(z);if(z.isSky())continue;const O=P?w[P.id]:void 0;this._renderTileClippingMasks(z,P,O),this.renderLayer(this,P,z,O)}if(this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const z=this.style._layers[f[this.currentLayer]],P=r._getLayerSourceCache(z);z.isSky()&&this.renderLayer(this,P,z,P?w[P.id]:void 0)}for(this.transform.projection.name==="globe"&&function(z){const P=z.context,O=P.gl,V=z.transform,K=new a.DepthMode(O.LEQUAL,a.DepthMode.ReadOnly,[0,1]),Z=z.useProgram("globeAtmosphere"),Y=V._camera.getWorldToCamera(V.worldSize,1),se=V._camera.getCameraToClipPerspective(V._fov,V.width/V.height,V._nearZ,V._farZ),X=a.mul([],Y,a.calculateGlobeMatrix(V,V.worldSize)),ie=a.mul([],V.labelPlaneMatrix,se),ne=a.transformMat4([],[0,0,0],X),te=a.add([],ne,[V.worldSize/Math.PI/2,0,0]),re=a.transformMat4([],ne,ie),ae=a.transformMat4([],te,ie),ve=a.length(a.sub([],ae,re)),Ee=1-a.globeToMercatorTransition(V.zoom),Xe={u_center:re,u_radius:ve,u_screen_size:[V.width,V.height],u_pixel_ratio:a.exported.devicePixelRatio,u_opacity:Ee,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};z.prepareDrawProgram(P,Z);const Ve=z.globeSharedBuffers;Ve&&Z.draw(P,O.TRIANGLES,K,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,Xe,"skybox",Ve.atmosphereVertexBuffer,Ve.atmosphereIndexBuffer,Ve.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;){const z=this.style._layers[f[this.currentLayer]],P=r._getLayerSourceCache(z);if(z.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(z)){if(z.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const O=P?(z.type==="symbol"?S:w)[P.id]:void 0;this._renderTileClippingMasks(z,P,P?y[P.id]:void 0),this.renderLayer(this,P,z,O),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let z=null;a.values(this.style._layers).forEach(P=>{const O=r._getLayerSourceCache(P);O&&!P.isHidden(this.transform.zoom)&&(!z||z.getSource().maxzoom<O.getSource().maxzoom)&&(z=O)}),z&&this.options.showTileBoundaries&&Hs.debug(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const P=z.transform.padding;Pi(z,z.transform.height-(P.top||0),3,Hu),Pi(z,P.bottom||0,3,sf),Ga(z,P.left||0,3,Ws),Ga(z,z.transform.width-(P.right||0),3,Xs);const O=z.transform.centerPoint;(function(V,K,Z,Y){No(V,K-1,Z-10,2,20,Y),No(V,K-10,Z-1,20,2,Y)})(z,O.x,z.transform.height-O.y,Ku)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}renderLayer(r,l,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||_&&_.length)&&(this.id=f.id,this.gpuTimingStart(f),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(f.type)||Hs[f.type](r,l,f,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let f=this.gpuTimers[r.id];f||(f=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),f.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,f.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}queryGpuTimers(r){const l={};for(const f in r){const _=r[f],y=this.context.extTimerQuery,w=y.getQueryObjectEXT(_.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(_.query),l[f]=w}return l}translatePosMatrix(r,l,f,_,y){if(!f[0]&&!f[1])return r;const w=y?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(w){const z=Math.sin(w),P=Math.cos(w);f=[f[0]*P-f[1]*z,f[0]*z+f[1]*P]}const S=[y?f[0]:Zt(l,f[0],this.transform.zoom),y?f[1]:Zt(l,f[1],this.transform.zoom),0],k=new Float32Array(16);return a.translate(k,r,S),k}saveTileTexture(r){const l=this._tileTextures[r.size[0]];l?l.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const l=this.imageManager.getPattern(r.from.toString()),f=this.imageManager.getPattern(r.to.toString());return!l||!f}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,l=this.style&&this.style.fog,f=[];return this.terrain&&!this.terrain.renderingToTexture&&f.push("TERRAIN"),l&&!r&&l.getOpacity(this.transform.pitch)!==0&&f.push("FOG"),r&&f.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&f.push("OVERDRAW_INSPECTOR"),f}useProgram(r,l,f){this.cache=this.cache||{};const _=f||[],y=this.currentGlobalDefines().concat(_),w=Us.cacheKey(r,y,l);return this.cache[w]||(this.cache[w]=new Us(this.context,r,rc[r],l,Zu[r],y)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(r){this.terrain&&this.terrain.prepareDrawTile(r)}prepareDrawProgram(r,l,f){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const y=_.getOpacity(this.transform.pitch);y!==0&&l.setFogUniformValues(r,((w,S,k,z)=>{const P=S.properties.get("color"),O=w.frameCounter/1e3%1,V=[P.r/P.a,P.g/P.a,P.b/P.a,z];return{u_fog_matrix:k?w.transform.calculateFogTileMatrix(k):w.identityMat,u_fog_range:S.getFovAdjustedRange(w.transform._fov),u_fog_color:V,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:O}})(this,_,f,y))}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,l=r.createTexture();return r.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,l=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const _ of f)l[_.key]=r[_.key]||new a.Tile(_,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class Wa{constructor(r=0,l=0,f=0,_=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=f,this.right=_}interpolate(r,l,f){return l.top!=null&&r.top!=null&&(this.top=a.number(r.top,l.top,f)),l.bottom!=null&&r.bottom!=null&&(this.bottom=a.number(r.bottom,l.bottom,f)),l.left!=null&&r.left!=null&&(this.left=a.number(r.left,l.left,f)),l.right!=null&&r.right!=null&&(this.right=a.number(r.right,l.right,f)),this}getCenter(r,l){const f=a.clamp((this.left+r-this.right)/2,0,r),_=a.clamp((this.top+l-this.bottom)/2,0,l);return new a.pointGeometry(f,_)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Wa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function bo(d,r){const l=a.getColumn(d,3);a.fromQuat(d,r),a.setColumn(d,3,l)}function Ju(d,r){a.setColumn(d,3,[r[0],r[1],r[2],1])}function uc(d,r){const l=a.identity$1([]);return a.rotateZ$1(l,l,-r),a.rotateX$1(l,l,-d),l}function hc(d,r){const l=[d[0],d[1],0],f=[r[0],r[1],0];if(a.length(l)>=1e-15){const w=a.normalize([],l);a.scale$2(f,w,a.dot(f,w)),r[0]=f[0],r[1]=f[1]}const _=a.cross([],r,d);if(a.len(_)<1e-15)return null;const y=Math.atan2(-_[1],_[0]);return uc(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),y)}class Qu{constructor(r,l){this.position=r,this.orientation=l}get position(){return this._position}set position(r){this._position=this._renderWorldCopies?function(l){if(!l)return;const f=Array.isArray(l)?new a.MercatorCoordinate(l[0],l[1],l[2]):l;return f.x=a.wrap(f.x,0,1),f}(r):r}lookAtPoint(r,l){if(this.orientation=null,!this.position)return;const f=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(r)):0,_=this.position,y=a.MercatorCoordinate.fromLngLat(r,f),w=[y.x-_.x,y.y-_.y,y.z-_.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=hc(w,l)}setPitchBearing(r,l){this.orientation=uc(a.degToRad(r),a.degToRad(-l))}}class dc{constructor(r,l){this._transform=a.identity([]),this._orientation=a.identity$1([]),l&&(this._orientation=l,bo(this._transform,this._orientation)),r&&Ju(this._transform,r)}get mercatorPosition(){const r=this.position;return new a.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=a.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){Ju(this._transform,r)}get orientation(){return this._orientation}set orientation(r){this._orientation=r,bo(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,l){this._orientation=uc(r,l),bo(this._transform,this._orientation)}forward(){const r=a.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=a.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=a.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,l){const f=new Float64Array(16);return a.invert(f,this.getWorldToCamera(r,l)),f}getWorldToCameraPosition(r,l,f){const _=this.position;a.scale$2(_,_,-r);const y=new Float64Array(16);return a.fromScaling(y,[f,f,f]),a.translate(y,y,_),y[10]*=l,y}getWorldToCamera(r,l){const f=new Float64Array(16),_=new Float64Array(4),y=this.position;return a.conjugate(_,this._orientation),a.scale$2(y,y,-r),a.fromQuat(f,_),a.translate(f,f,y),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=l,f[9]*=l,f[10]*=l,f[11]*=l,f}getCameraToClipPerspective(r,l,f,_){const y=new Float64Array(16);return a.perspective(y,r,l,f,_),y}getDistanceToElevation(r){const l=r===0?0:a.mercatorZfromAltitude(r,this.position[1]),f=this.forward();return(l-this.position[2])/f[2]}clone(){return new dc([...this.position],[...this.orientation])}}function eh(d,r){const l=Ha(d),f=function(y,w,S,k,z){const P=new a.LngLat(S.lng-180*Cn,S.lat),O=new a.LngLat(S.lng+180*Cn,S.lat),V=y.project(P.lng,P.lat),K=y.project(O.lng,O.lat),Z=-Math.atan2(K.y-V.y,K.x-V.x),Y=a.MercatorCoordinate.fromLngLat(S);Y.y=a.clamp(Y.y,-.999975,.999975);const se=Y.toLngLat(),X=y.project(se.lng,se.lat),ie=a.MercatorCoordinate.fromLngLat(se);ie.x+=Cn;const ne=ie.toLngLat(),te=y.project(ne.lng,ne.lat),re=pc(te.x-X.x,te.y-X.y,Z),ae=a.MercatorCoordinate.fromLngLat(se);ae.y+=Cn;const ve=ae.toLngLat(),Ee=y.project(ve.lng,ve.lat),Xe=pc(Ee.x-X.x,Ee.y-X.y,Z),Ve=Math.abs(re.x)/Math.abs(Xe.y),je=a.identity([]);a.rotateZ(je,je,-Z*(1-(z?0:k)));const Ce=a.identity([]);return a.scale(Ce,Ce,[1,1-(1-Ve)*k,1]),Ce[4]=-Xe.x/Xe.y*k,a.rotateZ(Ce,Ce,Z),a.multiply$1(Ce,je,Ce),Ce}(d.projection,0,d.center,l,r),_=Xa(d);return a.scale(f,f,[_,_,1]),f}function Xa(d){const r=d.projection,l=Ha(d),f=fc(r,d.center),_=fc(r,a.LngLat.convert(r.center));return Math.pow(2,f*l+(1-l)*_)}function Ha(d){const r=d.projection.range;if(!r)return 0;const l=Math.max(d.width,d.height),f=Math.log(l/1024)/Math.LN2;return a.smoothstep(r[0]+f,r[1]+f,d.zoom)}const Cn=1/4e4;function fc(d,r){const l=a.clamp(r.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),f=new a.LngLat(r.lng-180*Cn,l),_=new a.LngLat(r.lng+180*Cn,l),y=d.project(f.lng,l),w=d.project(_.lng,l),S=a.MercatorCoordinate.fromLngLat(f),k=a.MercatorCoordinate.fromLngLat(_),z=w.x-y.x,P=w.y-y.y,O=k.x-S.x,V=k.y-S.y,K=Math.sqrt((O*O+V*V)/(z*z+P*P));return Math.log(K)/Math.LN2}function pc(d,r,l){const f=Math.cos(l),_=Math.sin(l);return{x:d*f-r*_,y:d*_+r*f}}class Ks{constructor(r,l,f,_,y){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=f==null?0:f,this._maxPitch=_==null?60:_,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Wa,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new dc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const r=new Ks(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r.setProjection(this.getProjection()),r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r.tileSize=this.tileSize,r.setMaxBounds(this.getMaxBounds()),r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._cameraZoom=this._cameraZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,r?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(r){this._terrainEnabled()&&this._cameraZoom==null&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),r&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(r){r==null&&(r={name:"mercator"}),this.projectionOptions=r;const l=this.projection?this.getProjection():void 0;return this.projection=a.getProjection(r),!q(l,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const l=-r*Math.PI/180;var f;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(f=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f),function(_,y,w){var S=y[0],k=y[1],z=y[2],P=y[3],O=Math.sin(w),V=Math.cos(w);_[0]=S*V+z*O,_[1]=k*V+P*O,_[2]=S*-O+z*V,_[3]=k*-O+P*V}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=a.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const r=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return r===-1?(this._cameraZoom=null,!1):(this._centerAltitude=r,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let _=0,y=0;for(let w=0;w<l.length;w++){const S=new a.pointGeometry(l[w][0]*this.width,f+l[w][1]*(this.height-f)),k=r.pointCoordinate(S);if(!k)continue;const z=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);_+=k[3]*z,y+=z}return y===0?NaN:_/y}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._cameraZoom==null||!this._elevation)return;const r=this._cameraZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*l,_=this._mercatorZfromZoom(r),y=this._mercatorZfromZoom(this._maxZoom),w=Math.max(_-f,y);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let f;f=r.z<this._camera.position[2]?[l.x,l.y,l.z]:[r.x,r.y,r.z];const _=a.length(a.sub([],this._camera.position,f));return a.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let l=!1;if(r.orientation&&!a.exactEquals(r.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(r.orientation)),r.position){const f=[r.position.x,r.position.y,r.position.z];a.exactEquals$1(f,this._camera.position)||(this._setCameraPosition(f),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,l=new Qu;return l.position=new a.MercatorCoordinate(r[0],r[1],r[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(r){if(!a.length$1(r))return!1;a.normalize$1(r,r);const l=a.transformQuat([],[0,0,-1],r),f=a.transformQuat([],[0,-1,0],r);if(f[2]<0)return!1;const _=hc(l,f);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(r){const l=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;r[2]=a.clamp(r[2],_/f,_/l),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,f){this._unmodified=!1,this._edgeInsets.interpolate(r,l,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new a.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const f=this.pointCoordinate(new a.pointGeometry(0,0)),_=this.pointCoordinate(new a.pointGeometry(this.width,0)),y=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),w=this.pointCoordinate(new a.pointGeometry(0,this.height)),S=Math.floor(Math.min(f.x,_.x,y.x,w.x)),k=Math.floor(Math.max(f.x,_.x,y.x,w.x)),z=1;for(let P=S-z;P<=k+z;P++)P!==0&&l.push(new a.UnwrappedTileID(P,r))}return l}coveringTiles(r){let l=this.coveringZoomLevel(r);const f=l,_=this.elevation&&!r.isTerrainDEM,y=this.projection.name==="mercator";if(r.minzoom!==void 0&&l<r.minzoom)return[];r.maxzoom!==void 0&&l>r.maxzoom&&(l=r.maxzoom);const w=this.locationCoordinate(this.center),S=1<<l,k=[S*w.x,S*w.y,0],z=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,this.projection.name!=="globe"),P=this.pointCoordinate(this.getCameraPoint()),O=S*a.mercatorZfromAltitude(1,this.center.lat),V=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),K=[S*P.x,S*P.y,V],Z=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),Y=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,se=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,X=r.isTerrainDEM?-se:this._elevation?this._elevation.getMinElevationBelowMSL():0,ie=this.projection.isReprojectedInTileSpace?Xa(this):1,ne=Te=>{const De=new a.MercatorCoordinate(Te.x+25e-6,Te.y,Te.z),ct=new a.MercatorCoordinate(Te.x,Te.y+25e-6,Te.z),mt=Te.toLngLat(),It=De.toLngLat(),We=ct.toLngLat(),ft=this.locationCoordinate(mt),xt=this.locationCoordinate(It),ar=this.locationCoordinate(We),vr=Math.hypot(xt.x-ft.x,xt.y-ft.y),yt=Math.hypot(ar.x-ft.x,ar.y-ft.y);return Math.sqrt(vr*yt)*ie/25e-6},te=Te=>{const Ne=se,De=X;return{aabb:a.tileAABB(this,S,0,0,0,Te,De,Ne,this.projection),zoom:0,x:0,y:0,minZ:De,maxZ:Ne,wrap:Te,fullyVisible:!1}},re=[];let ae=[];const ve=l,Ee=r.reparseOverscaled?f:l,Xe=Te=>Te*Te,Ve=Xe((V-this._centerAltitude)*O),je=Te=>{if(!this._elevation||!Te.tileID||!y)return;const Ne=this._elevation.getMinMaxForTile(Te.tileID),De=Te.aabb;Ne?(De.min[2]=Ne.min,De.max[2]=Ne.max,De.center[2]=(De.min[2]+De.max[2])/2):(Te.shouldSplit=Ce(Te),Te.shouldSplit||(De.min[2]=De.max[2]=De.center[2]=this._centerAltitude))},Ce=Te=>{if(Te.zoom<Y)return!0;if(Te.zoom===ve)return!1;if(Te.shouldSplit!=null)return Te.shouldSplit;const Ne=Te.aabb.distanceX(K),De=Te.aabb.distanceY(K);let ct=Ve;_&&(ct=Xe(Te.aabb.distanceZ(K)*O));let mt=1;if(this.projection.isReprojectedInTileSpace&&f<=5){const We=Math.pow(2,Te.zoom),ft=ne(new a.MercatorCoordinate((Te.x+.5)/We,(Te.y+.5)/We));mt=ft>.85?1:ft}const It=Ne*Ne+De*De+ct;return It<Xe((1<<ve-Te.zoom)*Z*mt*((We,ft)=>{if(ft*Xe(.707)<We)return 1;const xt=Math.sqrt(ft/We);return xt/(1.4144271570014144+(Math.pow(1.1,xt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ct,Ve),It))};if(this.renderWorldCopies)for(let Te=1;Te<=3;Te++)re.push(te(-Te)),re.push(te(Te));for(re.push(te(0));re.length>0;){const Te=re.pop(),Ne=Te.x,De=Te.y;let ct=Te.fullyVisible;if(!ct){const mt=Te.aabb.intersects(z);if(mt===0)continue;ct=mt===2}if(Te.zoom!==ve&&Ce(Te))for(let mt=0;mt<4;mt++){const It=(Ne<<1)+mt%2,We=(De<<1)+(mt>>1),ft={aabb:y?Te.aabb.quadrant(mt):a.tileAABB(this,S,Te.zoom+1,It,We,Te.wrap,Te.minZ,Te.maxZ,this.projection),zoom:Te.zoom+1,x:It,y:We,wrap:Te.wrap,fullyVisible:ct,tileID:void 0,shouldSplit:void 0,minZ:Te.minZ,maxZ:Te.maxZ};_&&(ft.tileID=new a.OverscaledTileID(Te.zoom+1===ve?Ee:Te.zoom+1,Te.wrap,Te.zoom+1,It,We),je(ft)),re.push(ft)}else{const mt=Te.zoom===ve?Ee:Te.zoom;if(r.minzoom&&r.minzoom>mt)continue;const It=k[0]-(.5+Ne+(Te.wrap<<Te.zoom))*(1<<l-Te.zoom),We=k[1]-.5-De,ft=Te.tileID?Te.tileID:new a.OverscaledTileID(mt,Te.wrap,Te.zoom,Ne,De);ae.push({tileID:ft,distanceSq:It*It+We*We})}}if(this.fogCullDistSq){const Te=this.fogCullDistSq,Ne=this.horizonLineFromTop();ae=ae.filter(De=>{const ct=[0,0,0,1],mt=[a.EXTENT,a.EXTENT,0,1],It=this.calculateFogTileMatrix(De.tileID.toUnwrapped());a.transformMat4$1(ct,ct,It),a.transformMat4$1(mt,mt,It);const We=a.getAABBPointSquareDist(ct,mt);if(We===0)return!0;let ft=!1;const xt=this._elevation;if(xt&&We>Te&&Ne!==0){const ar=this.calculateProjMatrix(De.tileID.toUnwrapped());let vr;r.isTerrainDEM||(vr=xt.getMinMaxForTile(De.tileID)),vr||(vr={min:X,max:se});const yt=a.furthestTileCorner(this.rotation),Lt=[yt[0]*a.EXTENT,yt[1]*a.EXTENT,vr.max];a.transformMat4(Lt,Lt,ar),ft=(1-Lt[1])*this.height*.5<Ne}return We<Te||ft})}return ae.sort((Te,Ne)=>Te.distanceSq-Ne.distanceSq).map(Te=>Te.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const l=a.clamp(r.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),f=this.projection.project(r.lng,l);return new a.pointGeometry(f.x*this.worldSize,f.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,l){const f=this.pointCoordinate(l),_=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(r);this.setLocation(new a.MercatorCoordinate(y.x-(f.x-_.x),y.y-(f.y-_.y)))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this._coordinatePoint(this.locationCoordinate(r),!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,l){const f=l?a.mercatorZfromAltitude(l,r.lat):void 0,_=this.projection.project(r.lng,r.lat);return new a.MercatorCoordinate(_.x,_.y,f)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,l){const f=l!=null?l:this._centerAltitude,_=[r.x,r.y,0,1],y=[r.x,r.y,1,1];a.transformMat4$1(_,_,this.pixelMatrixInverse),a.transformMat4$1(y,y,this.pixelMatrixInverse);const w=y[3];a.scale$1(_,_,1/_[3]),a.scale$1(y,y,1/w);const S=_[2],k=y[2];return{p0:_,p1:y,t:S===k?0:(f-S)/(k-S)}}screenPointToMercatorRay(r){const l=[r.x,r.y,0,1],f=[r.x,r.y,1,1];return a.transformMat4$1(l,l,this.pixelMatrixInverse),a.transformMat4$1(f,f,this.pixelMatrixInverse),a.scale$1(l,l,1/l[3]),a.scale$1(f,f,1/f[3]),l[2]=a.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,f[2]=a.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,a.scale$1(l,l,1/this.worldSize),a.scale$1(f,f,1/this.worldSize),new a.Ray([l[0],l[1],l[2]],a.normalize([],a.sub([],f,l)))}rayIntersectionCoordinate(r){const{p0:l,p1:f,t:_}=r,y=a.mercatorZfromAltitude(l[2],this._center.lat),w=a.mercatorZfromAltitude(f[2],this._center.lat);return new a.MercatorCoordinate(a.number(l[0],f[0],_)/this.worldSize,a.number(l[1],f[1],_)/this.worldSize,a.number(y,w,_))}pointCoordinate(r,l=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(r.x,r.y,l)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);const l=this.elevation;let f=this.elevation.pointCoordinate(r);if(f)return new a.MercatorCoordinate(f[0],f[1],f[2]);let _=0,y=this.horizonLineFromTop();if(r.y>y)return this.pointCoordinate(r);const w=.02*y,S=r.clone();for(let k=0;k<10&&y-_>w;k++){S.y=a.number(_,y,.66);const z=l.pointCoordinate(S);z?(y=S.y,f=z):_=S.y}return f?new a.MercatorCoordinate(f[0],f[1],f[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){if(this.elevation)return!this.elevation.pointCoordinate(r);{const l=this.horizonLineFromTop();return r.y<l}}_coordinatePoint(r,l){const f=l&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,_=[r.x*this.worldSize,r.y*this.worldSize,f+r.toAltitude(),1];return a.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new a.pointGeometry(_[0]/_[3],_[1]/_[3]):new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(r,l){const f=new a.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),_=new a.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),y=new a.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),w=new a.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let S=this.pointCoordinate(f,r),k=this.pointCoordinate(_,r);const z=this.pointCoordinate(y,l),P=this.pointCoordinate(w,l),O=(V,K)=>(K.y-V.y)/(K.x-V.x);return S.y>1&&k.y>=0?S=new a.MercatorCoordinate((1-P.y)/O(P,S)+P.x,1):S.y<0&&k.y<=1&&(S=new a.MercatorCoordinate(-P.y/O(P,S)+P.x,0)),k.y>1&&S.y>=0?k=new a.MercatorCoordinate((1-z.y)/O(z,k)+z.x,1):k.y<0&&S.y<=1&&(k=new a.MercatorCoordinate(-z.y/O(z,k)+z.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(S)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(P)).extend(this.coordinateLocation(z))}_getBounds3D(){const r=this.elevation;if(!r.visibleDemTiles.length)return this._getBounds(0,0);const l=r.visibleDemTiles.reduce((f,_)=>{if(_.dem){const y=_.dem.tree;f.min=Math.min(f.min,y.minimums[0]),f.max=Math.max(f.max,y.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*r.exaggeration(),l.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,f=this.height/2-l*(1-this._horizonShift);return r?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,l){return this.projection.createTileTransform(this,l).createTileMatrix(r)}calculateDistanceTileData(r){const l=r.key,f=this._distanceTileDataCache;if(f[l])return f[l];const _=r.canonical,y=1/this.height,w=this.cameraWorldSize/this.zoomScale(_.z),S=(_.x+Math.pow(2,_.z)*r.wrap)*w,k=_.y*w,z=this.point,P=this.angle,O=Math.sin(-P),V=-Math.cos(-P);return f[l]={bearing:[O,V],center:[(z.x-S)*y,(z.y-k)*y],scale:w/a.EXTENT*y},f[l]}calculateFogTileMatrix(r){const l=r.key,f=this._fogTileMatrixCache;if(f[l])return f[l];const _=this.calculatePosMatrix(r,this.cameraWorldSize);return a.multiply$1(_,this.worldToFogMatrix,_),f[l]=new Float32Array(_),f[l]}calculateProjMatrix(r,l=!1){const f=r.key,_=l?this._alignedProjMatrixCache:this._projMatrixCache;if(_[f])return _[f];const y=this.calculatePosMatrix(r,this.worldSize);return a.multiply$1(y,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,y),_[f]=new Float32Array(y),_[f]}calculatePixelsToTileUnitsMatrix(r){const l=r.tileID.key,f=this._pixelsToTileUnitsCache;if(f[l])return f[l];const _=function(y,w){const{scale:S}=y.tileTransform,k=S*a.EXTENT/(y.tileSize*Math.pow(2,w.zoom-y.tileID.overscaledZ+y.tileID.canonical.z));return z=new Float32Array(4),V=(P=w.inverseAdjustmentMatrix)[1],K=P[2],Z=P[3],se=(O=[k,k])[1],z[0]=P[0]*(Y=O[0]),z[1]=V*Y,z[2]=K*se,z[3]=Z*se,z;var z,P,O,V,K,Z,Y,se}(r,this);return f[l]=_,f[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const l=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(l),_=this._camera.forward(),y=a.mercatorZfromAltitude(1,this._center.lat);f[2]/=y,_[2]/=y,a.normalize(_,_);const w=r.raycast(f,_,r.exaggeration());if(w){const S=a.scaleAndAdd([],f,_,w),k=new a.MercatorCoordinate(S[0],S[1],a.mercatorZfromAltitude(S[2],a.latFromMercatorY(S[1]))),z=(k.z+a.length([k.x-f[0],k.y-f[1],k.z-f[2]*y]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(z),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const l=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(l),_=r.getAtPointOrZero(new a.MercatorCoordinate(...f)),y=this._minimumHeightOverTerrain()*Math.cos(a.degToRad(this._maxPitch)),w=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*_;if(w<y){const S=this.locationCoordinate(this._center,this._centerAltitude),k=[S.x-f[0],S.y-f[1],S.z-f[2]],z=a.length(k);k[2]-=(y-w)/this._projectionScaler;const P=a.length(k);if(P===0)return;a.scale$2(k,k,z/P*this._projectionScaler),this._camera.position=[S.x-k[0],S.y-k[1],S.z*this._projectionScaler-k[2]],this._camera.orientation=hc(k,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const O=this.center;return O.lat=a.clamp(O.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(O.lng=a.clamp(O.lng,this.minLng,this.maxLng)),this.center=O,void(this._constraining=!1)}const r=this._unmodified,{x:l,y:f}=this.point;let _=0,y=l,w=f;const S=this.width/2,k=this.height/2,z=this.worldMinY*this.scale,P=this.worldMaxY*this.scale;if(f-k<z&&(w=z+k),f+k>P&&(w=P-k),P-z<this.height&&(_=Math.max(_,this.height/(P-z)),w=(P+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const O=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,K=this.worldSize/2-(O+V)/2;y=(l+K+this.worldSize)%this.worldSize-K,y-S<O&&(y=O+S),y+S>V&&(y=V-S),V-O<this.width&&(_=Math.max(_,this.width/(V-O)),y=(V+O)/2)}y===l&&w===f||(this.center=this.unproject(new a.pointGeometry(y,w))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCameraAltitude(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this._fov/2,l=this.centerOffset,f=this.pixelsPerMeter;this._projectionScaler=f/(a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(r)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?f:1),y=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);y[8]=2*-l.x/this.width,y[9]=2*l.y/this.height;let w=a.mul([],y,_);if(this.projection.isReprojectedInTileSpace){const te=this.locationCoordinate(this.center),re=a.identity([]);a.translate(re,re,[te.x*this.worldSize,te.y*this.worldSize,0]),a.multiply$1(re,re,eh(this)),a.translate(re,re,[-te.x*this.worldSize,-te.y*this.worldSize,0]),a.multiply$1(w,w,re),this.inverseAdjustmentMatrix=function(ae){const ve=eh(ae,!0);return j([],[ve[0],ve[1],ve[4],ve[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],w,[this.worldSize,this.worldSize,this.worldSize/f,1]),this.projMatrix=w,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const S=new Float32Array(16);a.identity(S),a.scale(S,S,[1,-1,1]),a.rotateX(S,S,this._pitch),a.rotateZ(S,S,this.angle);const k=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-l.x/this.width,k[9]=2*(l.y+z)/this.height,this.skyboxMatrix=a.multiply$1(S,k,S);const P=this.point,O=P.x,V=P.y,K=this.width%2/2,Z=this.height%2/2,Y=Math.cos(this.angle),se=Math.sin(this.angle),X=O-Math.round(O)+Y*K+se*Z,ie=V-Math.round(V)+Y*Z+se*K,ne=new Float64Array(w);if(a.translate(ne,ne,[X>.5?X-1:X,ie>.5?ie-1:ie,0]),this.alignedProjMatrix=ne,w=a.create(),a.scale(w,w,[this.width/2,-this.height/2,1]),a.translate(w,w,[1,-1,0]),this.labelPlaneMatrix=w,w=a.create(),a.scale(w,w,[1,-1,1]),a.translate(w,w,[-1,-1,0]),a.scale(w,w,[2/this.width,2/this.height,1]),this.glCoordMatrix=w,this.pixelMatrix=a.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},w=a.invert(new Float64Array(16),this.pixelMatrix),!w)throw new Error("failed to invert matrix");this.pixelMatrixInverse=w,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSize,l=this.cameraPixelsPerMeter,f=this._camera.position,_=1/this.height,y=[r,r,l];a.scale$2(y,y,_),a.scale$2(f,f,-1),a.multiply$2(f,f,y);const w=a.create();a.translate(w,w,f),a.scale(w,w,y),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,l,_)}_computeCameraPosition(r){const l=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),_=this.point,y=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*l-r/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-f[0]*y,_.y/this.worldSize-f[1]*y,r/this.worldSize*this._centerAltitude-f[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=r[2];let _=1;f>0&&(_=Math.min((l-this._camera.position[2])/f,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,r,_),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,l=this._camera.forward(),{pitch:f,bearing:_}=this._camera.getPitchBearing(),y=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),S=Math.max((r[2]-y)/Math.cos(f),w),k=this._zoomFromMercatorZ(S);a.scaleAndAdd(r,r,l,S),this._pitch=a.clamp(f,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(_,-Math.PI,Math.PI),this._setZoom(a.clamp(k,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new a.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((this._cameraZoom!=null?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(r,l){const f=Math.min(r.x,l.x),_=Math.max(r.x,l.x),y=Math.min(r.y,l.y),w=Math.max(r.y,l.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new a.pointGeometry(f,y),new a.pointGeometry(_,w),new a.pointGeometry(f,w),new a.pointGeometry(_,y)],k=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const P of S){const O=this.pointRayIntersection(P);if(O.t<0)return!0;const V=this.rayIntersectionCoordinate(O);if(V.x<k||V.y<0||V.x>z||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.pointGeometry(0,0),new a.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,l){const f=a.length(a.sub([],this._camera.position,r)),_=this._zoomFromMercatorZ(f)+l;return f-this._mercatorZfromZoom(_)}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,r))}}function wo(d,r){let l=!1,f=null;const _=()=>{f=null,l&&(d(),f=setTimeout(_,r),l=!1)};return()=>(l=!0,f||_(),f)}class th{constructor(r){this._hashName=r&&encodeURIComponent(r),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=wo(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,a.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return a.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const l=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,_),w=Math.round(l.lng*y)/y,S=Math.round(l.lat*y)/y,k=this._map.getBearing(),z=this._map.getPitch();let P="";if(P+=r?`/${w}/${S}/${f}`:`${f}/${S}/${w}`,(k||z)&&(P+="/"+Math.round(10*k)/10),z&&(P+=`/${Math.round(z)}`),this._hashName){const O=this._hashName;let V=!1;const K=a.window.location.hash.slice(1).split("&").map(Z=>{const Y=Z.split("=")[0];return Y===O?(V=!0,`${Y}=${P}`):Z}).filter(Z=>Z);return V||K.push(`${O}=${P}`),`#${K.join("&")}`}return`#${P}`}_getCurrentHash(){const r=a.window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(l=f)}),(l&&l[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._getCurrentHash();if(r.length>=3&&!r.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:l,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,r)}}const Wn={linearity:.3,easing:a.bezier(0,0,.3,1)},os=a.extend({deceleration:2500,maxSpeed:1400},Wn),rh=a.extend({deceleration:20,maxSpeed:1400},Wn),mc=a.extend({deceleration:1e3,maxSpeed:360},Wn),Yt=a.extend({deceleration:1e3,maxSpeed:90},Wn);class Ka{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=a.exported.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)l.zoom+=y.zoomDelta||0,l.bearing+=y.bearingDelta||0,l.pitch+=y.pitchDelta||0,y.panDelta&&l.pan._add(y.panDelta),y.around&&(l.around=y.around),y.pinchAround&&(l.pinchAround=y.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){const y=Ys(l.pan.mag(),f,a.extend({},os,r||{}));_.offset=l.pan.mult(y.amount/l.pan.mag()),_.center=this._map.transform.center,Ya(_,y)}if(l.zoom){const y=Ys(l.zoom,f,rh);_.zoom=this._map.transform.zoom+y.amount,Ya(_,y)}if(l.bearing){const y=Ys(l.bearing,f,mc);_.bearing=this._map.transform.bearing+a.clamp(y.amount,-179,179),Ya(_,y)}if(l.pitch){const y=Ys(l.pitch,f,Yt);_.pitch=this._map.transform.pitch+y.amount,Ya(_,y)}if(_.zoom||_.bearing){const y=l.pinchAround===void 0?l.around:l.pinchAround;_.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),a.extend(_,{noMoveStart:!0})}}function Ya(d,r){(!d.duration||d.duration<r.duration)&&(d.duration=r.duration,d.easing=r.easing)}function Ys(d,r,l){const{maxSpeed:f,linearity:_,deceleration:y}=l,w=a.clamp(d*_/(r/1e3),-f,f),S=Math.abs(w)/(y*_);return{easing:l.easing,duration:1e3*S,amount:w*(S/2)}}class fi extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f,_={}){const y=G.mousePos(l.getCanvasContainer(),f),w=l.unproject(y);super(r,a.extend({point:y,lngLat:w,originalEvent:f},_)),this._defaultPrevented=!1,this.target=l}}class Ja extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f){const _=r==="touchend"?f.changedTouches:f.touches,y=G.touchPos(l.getCanvasContainer(),_),w=y.map(k=>l.unproject(k)),S=y.reduce((k,z,P,O)=>k.add(z.div(O.length)),new a.pointGeometry(0,0));super(r,{points:y,point:S,lngLats:w,lngLat:l.unproject(S),originalEvent:f}),this._defaultPrevented=!1}}class af extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f){super(r,{originalEvent:f}),this._defaultPrevented=!1}}class ih{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new af(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new fi(r.type,this._map,r))}mouseup(r){this._map.fire(new fi(r.type,this._map,r))}preclick(r){const l=a.extend({},r);l.type="preclick",this._map.fire(new fi(l.type,this._map,l))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(r),this._map.fire(new fi(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new fi(r.type,this._map,r))}mouseover(r){this._map.fire(new fi(r.type,this._map,r))}mouseout(r){this._map.fire(new fi(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Ja(r.type,this._map,r))}touchmove(r){this._map.fire(new Ja(r.type,this._map,r))}touchend(r){this._map.fire(new Ja(r.type,this._map,r))}touchcancel(r){this._map.fire(new Ja(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lf{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(r){this._map.fire(new fi(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new fi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new fi(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _c{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&r.button===0&&(G.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const f=l;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=f,this._box||(this._box=G.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const y=Math.min(_.x,f.x),w=Math.max(_.x,f.x),S=Math.min(_.y,f.y),k=Math.max(_.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${S}px)`,this._box.style.width=w-y+"px",this._box.style.height=k-S+"px")})}mouseupWindow(r,l){if(!this._active||r.button!==0)return;const f=this._startPos,_=l;if(this.reset(),G.suppressClick(),f.x!==_.x||f.y!==_.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:y=>y.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),G.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new a.Event(r,{originalEvent:l}))}}function ss(d,r){const l={};for(let f=0;f<d.length;f++)l[d[f].identifier]=r[f];return l}class Js{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,l,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),f.length===this.numTouches&&(this.centroid=function(_){const y=new a.pointGeometry(0,0);for(const w of _)y._add(w);return y.div(_.length)}(l),this.touches=ss(f,l)))}touchmove(r,l,f){if(this.aborted||!this.centroid)return;const _=ss(f,l);for(const y in this.touches){const w=this.touches[y],S=_[y];(!S||S.dist(w)>30)&&(this.aborted=!0)}}touchend(r,l,f){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Qs{constructor(r){this.singleTap=new Js(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,l,f){this.singleTap.touchstart(r,l,f)}touchmove(r,l,f){this.singleTap.touchmove(r,l,f)}touchend(r,l,f){const _=this.singleTap.touchend(r,l,f);if(_){const y=r.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(_)<30;if(y&&w||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class gc{constructor(){this._zoomIn=new Qs({numTouches:1,numTaps:2}),this._zoomOut=new Qs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,f){this._zoomIn.touchstart(r,l,f),this._zoomOut.touchstart(r,l,f)}touchmove(r,l,f){this._zoomIn.touchmove(r,l,f),this._zoomOut.touchmove(r,l,f)}touchend(r,l,f){const _=this._zoomIn.touchend(r,l,f),y=this._zoomOut.touchend(r,l,f);return _?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(_)},{originalEvent:r})}):y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(y)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const nh={0:1,2:2};class as{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(r,l){return!1}_move(r,l){return{}}mousedown(r,l){if(this._lastPoint)return;const f=G.mouseButton(r);this._correctButton(r,f)&&(this._lastPoint=l,this._eventButton=f)}mousemoveWindow(r,l){const f=this._lastPoint;if(f){if(r.preventDefault(),function(_,y){const w=nh[y];return _.buttons===void 0||(_.buttons&w)!==w}(r,this._eventButton))this.reset();else if(this._moved||!(l.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(f,l)}}mouseupWindow(r){this._lastPoint&&G.mouseButton(r)===this._eventButton&&(this._moved&&G.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qa extends as{mousedown(r,l){super.mousedown(r,l),this._lastPoint&&(this._active=!0)}_correctButton(r,l){return l===0&&!r.ctrlKey}_move(r,l){return{around:l,panDelta:l.sub(r)}}}class un extends as{_correctButton(r,l){return l===0&&r.ctrlKey||l===2}_move(r,l){const f=.8*(l.x-r.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(r){r.preventDefault()}}class yc extends as{_correctButton(r,l){return l===0&&r.ctrlKey||l===2}_move(r,l){const f=-.5*(l.y-r.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(r){r.preventDefault()}}class oh{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0)}touchstart(r,l,f){return this._calculateTransform(r,l,f)}touchmove(r,l,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.preventDefault(),this._calculateTransform(r,l,f)}}touchend(r,l,f){this._calculateTransform(r,l,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,f){f.length>0&&(this._active=!0);const _=ss(f,l),y=new a.pointGeometry(0,0),w=new a.pointGeometry(0,0);let S=0;for(const z in _){const P=_[z],O=this._touches[z];O&&(y._add(P),w._add(P.sub(O)),S++,_[z]=P)}if(this._touches=_,S<this._minTouches||!w.mag())return;const k=w.div(S);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(S),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class el{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(r){}_move(r,l,f){return{}}touchstart(r,l,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,f){if(!this._firstTwoTouches)return;r.preventDefault();const[_,y]=this._firstTwoTouches,w=Xn(f,l,_),S=Xn(f,l,y);if(!w||!S)return;const k=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],k,r)}touchend(r,l,f){if(!this._firstTwoTouches)return;const[_,y]=this._firstTwoTouches,w=Xn(f,l,_),S=Xn(f,l,y);w&&S||(this._active&&G.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Xn(d,r,l){for(let f=0;f<d.length;f++)if(d[f].identifier===l)return r[f]}function vc(d,r){return Math.log(d/r)/Math.LN2}class tl extends el{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const f=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(vc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:vc(this._distance,f),pinchAround:l}}}function rl(d,r){return 180*d.angleWith(r)/Math.PI}class il extends el{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const f=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:rl(this._vector,f),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,f=rl(r,this._startVector);return Math.abs(f)<l}}function nl(d){return Math.abs(d.y)>Math.abs(d.x)}class sh extends el{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(r){this._lastPoints=r,nl(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,f){const _=r[0].sub(this._lastPoints[0]),y=r[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&f.touches.length<3)&&(this._valid=this.gestureBeginsVertically(_,y,f.timeStamp),this._valid))return this._lastPoints=r,this._active=!0,{pitchDelta:(_.y+y.y)/2*-.5}}gestureBeginsVertically(r,l,f){if(this._valid!==void 0)return this._valid;const _=r.mag()>=2,y=l.mag()>=2;if(!_&&!y)return;if(!_||!y)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const w=r.y>0==l.y>0;return nl(r)&&nl(l)&&w}}const ls={panStep:100,bearingStep:15,pitchStep:10};class cf{constructor(){const r=ls;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,f=0,_=0,y=0,w=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?f=-1:(r.preventDefault(),y=-1);break;case 39:r.shiftKey?f=1:(r.preventDefault(),y=1);break;case 38:r.shiftKey?_=1:(r.preventDefault(),w=-1);break;case 40:r.shiftKey?_=-1:(r.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:S=>{const k=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:uf,zoom:l?Math.round(k)+l*(r.shiftKey?2:1):k,bearing:S.getBearing()+f*this._bearingStep,pitch:S.getPitch()+_*this._pitchStep,offset:[-y*this._panStep,-w*this._panStep],center:S.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function uf(d){return d*(2-d)}const xc=4.000244140625;class ol{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=r.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const f=a.exported.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,l!==0&&l%xc==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=G.mousePos(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform,l=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>xc?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&z!==0&&(z=1/z);const P=l(),O=Math.pow(2,P),V=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(V*z))),this._type==="wheel"&&(this._startZoom=l(),this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:l(),_=this._startZoom,y=this._easing;let w,S=!1;if(this._type==="wheel"&&_&&y){const k=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),z=y(k);w=a.number(_,f,z),k<1?this._frameId||(this._frameId=!0):S=!0}else w=f,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:w-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=a.ease;if(this._prevEase){const f=this._prevEase,_=(a.exported.now()-f.start)/f.duration,y=f.easing(_+.01)-f.easing(_),w=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-w*w);l=a.bezier(w,S,.25,1)}return this._prevEase={start:a.exported.now(),duration:r,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!a.window.document.fullscreenElement||!!a.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class bc{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ah{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,l){return r.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(r.shiftKey?-1:1),around:f.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lh{constructor(){this._tap=new Qs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(r,l,f){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=l[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(r,l,f))}touchmove(r,l,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const _=l[0],y=_.y-this._swipePoint.y;return this._swipePoint=_,r.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(r,l,f)}touchend(r,l,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(r,l,f)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sl{constructor(r,l,f){this._el=r,this._mousePan=l,this._touchPan=f}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class wc{constructor(r,l,f){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ch{constructor(r,l,f,_){this._el=r,this._touchZoom=l,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ea=d=>d.zoom||d.drag||d.pitch||d.rotate;class uh extends a.Event{}class hh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,l){const f=a.sub([],l,r);this.radius=a.length(f[2]<0?a.div([],f,this.constants):[f[0],f[1],0])}projectRay(r){a.div(r,r,this.constants),a.normalize(r,r),a.mul$1(r,r,this.constants);const l=a.scale$2([],r,this.radius);if(l[2]>0){const f=a.scale$2([],[0,0,1],a.dot(l,[0,0,1])),_=a.scale$2([],a.normalize([],[l[0],l[1],0]),this.radius),y=a.add([],l,a.scale$2([],a.sub([],a.add([],_,f),l),2));l[0]=y[0],l[1]=y[1]}return l}}function ta(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class cs{constructor(r,l){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ka(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new hh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),a.bindAll(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[_,y,w]of this._listeners)_.addEventListener(y,_===a.window.document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[r,l,f]of this._listeners)r.removeEventListener(l,r===a.window.document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(r){const l=this._map,f=l.getCanvasContainer();this._add("mapEvent",new ih(l,r));const _=l.boxZoom=new _c(l,r);this._add("boxZoom",_);const y=new gc,w=new ah;l.doubleClickZoom=new bc(w,y),this._add("tapZoom",y),this._add("clickZoom",w);const S=new lh;this._add("tapDragZoom",S);const k=l.touchPitch=new sh(l);this._add("touchPitch",k);const z=new un(r),P=new yc(r);l.dragRotate=new wc(r,z,P),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);const O=new Qa(r),V=new oh(l,r);l.dragPan=new sl(f,O,V),this._add("mousePan",O),this._add("touchPan",V,["touchZoom","touchRotate"]);const K=new il,Z=new tl;l.touchZoomRotate=new ch(f,Z,K,S),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new lf(l));const Y=l.scrollZoom=new ol(l,this);this._add("scrollZoom",Y,["mousePan"]);const se=l.keyboard=new cf;this._add("keyboard",se);for(const X of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[X]&&l[X].enable(r[X])}_add(r,l,f){this._handlers.push({handlerName:r,handler:l,allowed:f}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(ea(this._eventsInProgress))||this.isZooming()}_blockedByActive(r,l,f){for(const _ in r)if(_!==f&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const l=[];for(const f of r)this._el.contains(f.target)&&l.push(f);return l}handleEvent(r,l){this._updatingCamera=!0;const f=r.type==="renderFrame",_=f?void 0:r,y={needsRenderFrame:!1},w={},S={},k=r.touches?this._getMapTouches(r.touches):void 0,z=k?G.touchPos(this._el,k):f?void 0:G.mousePos(this._el,r);for(const{handlerName:V,handler:K,allowed:Z}of this._handlers){if(!K.isEnabled())continue;let Y;this._blockedByActive(S,Z,V)?K.reset():K[l||r.type]&&(Y=K[l||r.type](r,z,k),this.mergeHandlerResult(y,w,Y,V,_),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||K.isActive())&&(S[V]=K)}const P={};for(const V in this._previousActiveHandlers)S[V]||(P[V]=_);this._previousActiveHandlers=S,(Object.keys(P).length||ta(y))&&(this._changes.push([y,w,P]),this._triggerRenderFrame()),(Object.keys(S).length||ta(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=y;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(r,l,f,_,y){if(!f)return;a.extend(r,f);const w={handlerName:_,originalEvent:f.originalEvent||y};f.zoomDelta!==void 0&&(l.zoom=w),f.panDelta!==void 0&&(l.drag=w),f.pitchDelta!==void 0&&(l.pitch=w),f.bearingDelta!==void 0&&(l.rotate=w)}_applyChanges(){const r={},l={},f={};for(const[_,y,w]of this._changes)_.panDelta&&(r.panDelta=(r.panDelta||new a.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(r.around=_.around),_.aroundCoord!==void 0&&(r.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(r.pinchAround=_.pinchAround),_.noInertia&&(r.noInertia=_.noInertia),a.extend(l,y),a.extend(f,w);this._updateMapTransform(r,l,f),this._changes=[]}_updateMapTransform(r,l,f){const _=this._map,y=_.transform,w=ie=>[ie.x,ie.y,ie.z];if((ie=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!ta(r)){const ie=y.zoom;y.cameraElevationReference="sea",y.recenterOnTerrain(),y.cameraElevationReference="ground",ie!==y.zoom&&this._map._update(!0)}if(!ta(r))return this._fireEvents(l,f,!0);let{panDelta:S,zoomDelta:k,bearingDelta:z,pitchDelta:P,around:O,aroundCoord:V,pinchAround:K}=r;K!==void 0&&(O=K),(ie=>l.drag&&!this._eventsInProgress.drag)()&&O&&(this._dragOrigin=w(y.pointCoordinate3D(O)),this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",_._stop(!0),O=O||_.transform.centerPoint,z&&(y.bearing+=z),P&&(y.pitch+=P),y._updateCameraState();const Z=[0,0,0];if(S){const ie=y.pointCoordinate(O),ne=y.pointCoordinate(O.sub(S));ie&&ne&&(Z[0]=ne.x-ie.x,Z[1]=ne.y-ie.y)}const Y=y.zoom,se=[0,0,0];if(k){const ie=w(V||y.pointCoordinate3D(O)),ne={dir:a.normalize([],a.sub([],ie,y._camera.position))};if(ne.dir[2]<0){const te=y.zoomDeltaToMovement(ie,k);a.scale$2(se,ne.dir,te)}}const X=a.add(Z,Z,se);y._translateCameraConstrained(X),k&&Math.abs(y.zoom-Y)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,f,!0)}_fireEvents(r,l,f){const _=ea(this._eventsInProgress),y=ea(r),w={};for(const P in r){const{originalEvent:O}=r[P];this._eventsInProgress[P]||(w[`${P}start`]=O),this._eventsInProgress[P]=r[P]}!_&&y&&this._fireEvent("movestart",y.originalEvent);for(const P in w)this._fireEvent(P,w[P]);y&&this._fireEvent("move",y.originalEvent);for(const P in r){const{originalEvent:O}=r[P];this._fireEvent(P,O)}const S={};let k;for(const P in this._eventsInProgress){const{handlerName:O,originalEvent:V}=this._eventsInProgress[P];this._handlersById[O].isActive()||(delete this._eventsInProgress[P],k=l[O]||V,S[`${P}end`]=k)}for(const P in S)this._fireEvent(P,S[P]);const z=ea(this._eventsInProgress);if(f&&(_||y)&&!z){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;P?(O(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:k})):(this._map.fire(new a.Event("moveend",{originalEvent:k})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new a.Event(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new uh("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Tc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class dh extends a.Evented{constructor(r,l){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,f){return r=a.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,a.extend({offset:r},l),f)}panTo(r,l,f){return this.easeTo(a.extend({center:r},l),f)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,f){return this.easeTo(a.extend({zoom:r},l),f)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,f){return this.easeTo(a.extend({bearing:r},l),f)}resetNorth(r,l){return this.rotateTo(0,a.extend({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=a.LngLatBounds.convert(r);const f=l&&l.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),f,l)}_extendCameraOptions(r){const l={top:0,bottom:0,right:0,left:0};if(typeof(r=a.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){const f=r.padding;r.padding={top:f,bottom:f,right:f,left:f}}return r.padding=a.extend(l,r.padding),r}_cameraForBoxAndBearing(r,l,f,_){const y=this._extendCameraOptions(_),w=this.transform,S=w.padding,k=w.project(a.LngLat.convert(r)),z=w.project(a.LngLat.convert(l)),P=k.rotate(-a.degToRad(f)),O=z.rotate(-a.degToRad(f)),V=new a.pointGeometry(Math.max(P.x,O.x),Math.max(P.y,O.y)),K=new a.pointGeometry(Math.min(P.x,O.x),Math.min(P.y,O.y)),Z=V.sub(K),Y=(w.width-(S.left+S.right+y.padding.left+y.padding.right))/Z.x,se=(w.height-(S.top+S.bottom+y.padding.top+y.padding.bottom))/Z.y;if(se<0||Y<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const X=Math.min(w.scaleZoom(w.scale*Math.min(Y,se)),y.maxZoom),ie=typeof y.offset.x=="number"?new a.pointGeometry(y.offset.x,y.offset.y):a.pointGeometry.convert(y.offset),ne=new a.pointGeometry((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(f*Math.PI/180),te=ie.add(ne).mult(w.scale/w.zoomScale(X));return{center:w.unproject(k.add(z).div(2).sub(te)),zoom:X,bearing:f}}_cameraForBox(r,l,f,_,y){const w=this._extendCameraOptions(y);f=f||0,_=_||0,r=a.LngLat.convert(r),l=a.LngLat.convert(l);const S=this.transform.clone();S.padding=w.padding;const k=this.getFreeCameraOptions(),z=new a.LngLat(.5*(r.lng+l.lng),.5*(r.lat+l.lat)),P=.5*(f+_);if(S._camera.position[2]<a.mercatorZfromAltitude(P,z.lat))return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");k.lookAtPoint(z),S.setFreeCameraOptions(k);const O=a.MercatorCoordinate.fromLngLat(r),V=a.MercatorCoordinate.fromLngLat(l),K=S.pointRayIntersection(S.centerPoint,P),Z=[(Y=S.rayIntersectionCoordinate(K)).x,Y.y,Y.z];var Y;const se=S.screenPointToMercatorRay(S.centerPoint),X=S.projection.name!=="globe";let ie,ne=0;do{const te=Math.floor(S.zoom),re=1<<te,ae=Math.min(re*O.x,re*V.x),ve=Math.min(re*O.y,re*V.y),Ee=Math.max(re*O.x,re*V.x),Xe=Math.max(re*O.y,re*V.y),Ve=new a.Aabb([ae,ve,f],[Ee,Xe,_]),je=a.Frustum.fromInvProjectionMatrix(S.invProjMatrix,S.worldSize,te,X);if(Ve.intersects(je)!==2){ie&&(S._camera.position=a.scaleAndAdd([],S._camera.position,se.dir,-ie),S._updateStateFromCamera());break}const Ce=a.sub([],S._camera.position,Z);ie=.5*a.length(Ce),S._camera.position=a.scaleAndAdd([],S._camera.position,se.dir,ie);try{S._updateStateFromCamera()}catch{return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ne<10);return{center:S.center,zoom:S.zoom,bearing:S.bearing,pitch:S.pitch}}fitBounds(r,l,f){return this._fitInternal(this.cameraForBounds(r,l),l,f)}_raycastElevationBox(r,l){const f=this.transform.elevation;if(!f)return;const _=new a.pointGeometry(r.x,l.y),y=new a.pointGeometry(l.x,r.y),w=f.pointCoordinate(r);if(!w)return;const S=f.pointCoordinate(l);if(!S)return;const k=f.pointCoordinate(_);if(!k)return;const z=f.pointCoordinate(y);if(!z)return;const P=new a.MercatorCoordinate(w[0],w[1]).toLngLat(),O=new a.MercatorCoordinate(S[0],S[1]).toLngLat(),V=new a.MercatorCoordinate(k[0],k[1]).toLngLat(),K=new a.MercatorCoordinate(z[0],z[1]).toLngLat(),Z=Math.min(P.lng,Math.min(O.lng,Math.min(V.lng,K.lng))),Y=Math.min(P.lat,Math.min(O.lat,Math.min(V.lat,K.lat))),se=Math.max(P.lng,Math.max(O.lng,Math.max(V.lng,K.lng))),X=Math.max(P.lat,Math.max(O.lat,Math.max(V.lat,K.lat))),ie=Math.min(w[3],Math.min(S[3],Math.min(k[3],z[3]))),ne=Math.max(w[3],Math.max(S[3],Math.max(k[3],z[3])));return{minLngLat:new a.LngLat(Z,Y),maxLngLat:new a.LngLat(se,X),minAltitude:ie,maxAltitude:ne}}fitScreenCoordinates(r,l,f,_,y){let w,S,k,z;const P=a.pointGeometry.convert(r),O=a.pointGeometry.convert(l),V=this._raycastElevationBox(P,O);if(V)w=V.minLngLat,S=V.maxLngLat,k=V.minAltitude,z=V.maxAltitude;else{if(this.transform.anyCornerOffEdge(P,O))return this;w=this.transform.pointLocation(P),S=this.transform.pointLocation(O)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(a.pointGeometry.convert(r)),this.transform.pointLocation(a.pointGeometry.convert(l)),f,_):this._cameraForBox(w,S,k,z,_),_,y)}_fitInternal(r,l,f){return r?(delete(l=a.extend(r,l)).padding,l.linear?this.easeTo(l,f):this.flyTo(l,f)):this}jumpTo(r,l){this.stop();const f=r.preloadOnly?this.transform.clone():this.transform;let _=!1,y=!1,w=!1;return"zoom"in r&&f.zoom!==+r.zoom&&(_=!0,f.zoom=+r.zoom),r.center!==void 0&&(f.center=a.LngLat.convert(r.center)),"bearing"in r&&f.bearing!==+r.bearing&&(y=!0,f.bearing=+r.bearing),"pitch"in r&&f.pitch!==+r.pitch&&(w=!0,f.pitch=+r.pitch),r.padding==null||f.isPaddingEqual(r.padding)||(f.padding=r.padding),r.preloadOnly?(this._preloadTiles(f),this):(this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l)),_&&this.fire(new a.Event("zoomstart",l)).fire(new a.Event("zoom",l)).fire(new a.Event("zoomend",l)),y&&this.fire(new a.Event("rotatestart",l)).fire(new a.Event("rotate",l)).fire(new a.Event("rotateend",l)),w&&this.fire(new a.Event("pitchstart",l)).fire(new a.Event("pitch",l)).fire(new a.Event("pitchend",l)),this.fire(new a.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(Tc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,l){const f=this.transform;if(!f.projection.supportsFreeCamera)return void a.warnOnce(Tc);this.stop();const _=f.zoom,y=f.pitch,w=f.bearing;f.setFreeCameraOptions(r);const S=_!==f.zoom,k=y!==f.pitch,z=w!==f.bearing;return this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l)),S&&this.fire(new a.Event("zoomstart",l)).fire(new a.Event("zoom",l)).fire(new a.Event("zoomend",l)),z&&this.fire(new a.Event("rotatestart",l)).fire(new a.Event("rotate",l)).fire(new a.Event("rotateend",l)),k&&this.fire(new a.Event("pitchstart",l)).fire(new a.Event("pitch",l)).fire(new a.Event("pitchend",l)),this.fire(new a.Event("moveend",l)),this}easeTo(r,l){this._stop(!1,r.easeId),((r=a.extend({offset:[0,0],duration:500,easing:a.ease},r)).animate===!1||!r.essential&&a.exported.prefersReducedMotion)&&(r.duration=0);const f=this.transform,_=this.getZoom(),y=this.getBearing(),w=this.getPitch(),S=this.getPadding(),k="zoom"in r?+r.zoom:_,z="bearing"in r?this._normalizeBearing(r.bearing,y):y,P="pitch"in r?+r.pitch:w,O="padding"in r?r.padding:f.padding,V=a.pointGeometry.convert(r.offset);let K=f.centerPoint.add(V);const Z=f.projection.name==="globe"?f.pointCoordinate(K).toLngLat():f.pointLocation(K),Y=a.LngLat.convert(r.center||Z);this._normalizeCenter(Y);const se=f.project(Z),X=f.project(Y).sub(se),ie=f.zoomScale(k-_);let ne,te;r.around&&(ne=a.LngLat.convert(r.around),te=f.locationPoint(ne));const re=this._zooming||k!==_,ae=this._rotating||y!==z,ve=this._pitching||P!==w,Ee=!f.isPaddingEqual(O),Xe=je=>Ce=>{if(re&&(je.zoom=a.number(_,k,Ce)),ae&&(je.bearing=a.number(y,z,Ce)),ve&&(je.pitch=a.number(w,P,Ce)),Ee&&(je.interpolatePadding(S,O,Ce),K=je.centerPoint.add(V)),ne)je.setLocationAtPoint(ne,te);else{const Te=je.zoomScale(je.zoom-_),Ne=k>_?Math.min(2,ie):Math.max(.5,ie),De=Math.pow(Ne,1-Ce),ct=je.unproject(se.add(X.mult(Ce*De)).mult(Te));je.setLocationAtPoint(je.renderWorldCopies?ct.wrap():ct,K)}return r.preloadOnly||this._fireMoveEvents(l),je};if(r.preloadOnly){const je=this._emulate(Xe,r.duration,f);return this._preloadTiles(je),this}const Ve={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=ae,this._pitching=ve,this._padding=Ee,this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,Ve),this._ease(Xe(f),je=>{f.recenterOnTerrain(),this._afterEase(l,je)},r),this}_prepareEase(r,l,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||f.moving||this.fire(new a.Event("movestart",r)),this._zooming&&!f.zooming&&this.fire(new a.Event("zoomstart",r)),this._rotating&&!f.rotating&&this.fire(new a.Event("rotatestart",r)),this._pitching&&!f.pitching&&this.fire(new a.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new a.Event("move",r)),this._zooming&&this.fire(new a.Event("zoom",r)),this._rotating&&this.fire(new a.Event("rotate",r)),this._pitching&&this.fire(new a.Event("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId,this.transform.cameraElevationReference="ground";const f=this._zooming,_=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new a.Event("zoomend",r)),_&&this.fire(new a.Event("rotateend",r)),y&&this.fire(new a.Event("pitchend",r)),this.fire(new a.Event("moveend",r))}flyTo(r,l){if(!r.essential&&a.exported.prefersReducedMotion){const We=a.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(We,l)}this.stop(),r=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},r);const f=this.transform,_=this.getZoom(),y=this.getBearing(),w=this.getPitch(),S=this.getPadding(),k="zoom"in r?a.clamp(+r.zoom,f.minZoom,f.maxZoom):_,z="bearing"in r?this._normalizeBearing(r.bearing,y):y,P="pitch"in r?+r.pitch:w,O="padding"in r?r.padding:f.padding,V=f.zoomScale(k-_),K=a.pointGeometry.convert(r.offset);let Z=f.centerPoint.add(K);const Y=f.pointLocation(Z),se=a.LngLat.convert(r.center||Y);this._normalizeCenter(se);const X=f.project(Y),ie=f.project(se).sub(X);let ne=r.curve;const te=Math.max(f.width,f.height),re=te/V,ae=ie.mag();if("minZoom"in r){const We=a.clamp(Math.min(r.minZoom,_,k),f.minZoom,f.maxZoom),ft=te/f.zoomScale(We-_);ne=Math.sqrt(ft/ae*2)}const ve=ne*ne;function Ee(We){const ft=(re*re-te*te+(We?-1:1)*ve*ve*ae*ae)/(2*(We?re:te)*ve*ae);return Math.log(Math.sqrt(ft*ft+1)-ft)}function Xe(We){return(Math.exp(We)-Math.exp(-We))/2}function Ve(We){return(Math.exp(We)+Math.exp(-We))/2}const je=Ee(0);let Ce=function(We){return Ve(je)/Ve(je+ne*We)},Te=function(We){return te*((Ve(je)*(Xe(ft=je+ne*We)/Ve(ft))-Xe(je))/ve)/ae;var ft},Ne=(Ee(1)-je)/ne;if(Math.abs(ae)<1e-6||!isFinite(Ne)){if(Math.abs(te-re)<1e-6)return this.easeTo(r,l);const We=re<te?-1:1;Ne=Math.abs(Math.log(re/te))/ne,Te=function(){return 0},Ce=function(ft){return Math.exp(We*ne*ft)}}r.duration="duration"in r?+r.duration:1e3*Ne/("screenSpeed"in r?+r.screenSpeed/ne:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const De=y!==z,ct=P!==w,mt=!f.isPaddingEqual(O),It=We=>ft=>{const xt=ft*Ne,ar=1/Ce(xt);We.zoom=ft===1?k:_+We.scaleZoom(ar),De&&(We.bearing=a.number(y,z,ft)),ct&&(We.pitch=a.number(w,P,ft)),mt&&(We.interpolatePadding(S,O,ft),Z=We.centerPoint.add(K));const vr=ft===1?se:We.unproject(X.add(ie.mult(Te(xt))).mult(ar));return We.setLocationAtPoint(We.renderWorldCopies?vr.wrap():vr,Z),We._updateCenterElevation(),r.preloadOnly||this._fireMoveEvents(l),We};if(r.preloadOnly){const We=this._emulate(It,r.duration,f);return this._preloadTiles(We),this}return this._zooming=!0,this._rotating=De,this._pitching=ct,this._padding=mt,this._prepareEase(l,!1),this._ease(It(f),()=>this._afterEase(l),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,l)}if(!r){const f=this.handlers;f&&f.stop(!1)}return this}_ease(r,l,f){f.animate===!1||f.duration===0?(r(1),l()):(this._easeStart=a.exported.now(),this._easeOptions=f,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,l){r=a.wrap(r,-180,180);const f=Math.abs(r-l);return Math.abs(r-360-l)<f&&(r-=360),Math.abs(r+360-l)<f&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const f=r.lng-l.center.lng;r.lng+=f>180?-360:f<-180?360:0}_emulate(r,l,f){const _=Math.ceil(15*l/1e3),y=[],w=r(f.clone());for(let S=0;S<=_;S++){const k=w(S/_);y.push(k.clone())}return y}}class Ec{constructor(r={}){this.options=r,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const l=this.options&&this.options.compact;return this._map=r,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=G.create("button","mapboxgl-ctrl-attrib-button",this._container),G.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,l){const f=this._map._getUIString(`AttributionControl.${l}`);r.setAttribute("aria-label",f),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",f)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(r){const f=l.reduce((_,y,w)=>(y.value&&(_+=`${y.key}=${y.value}${w<l.length-1?"&":""}`),_),"?");r.href=`${a.config.FEEDBACK_URL}/${f}${this._map._hash?this._map._hash.getHashString(!0):""}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const l=this._map.style._sourceCaches;for(const _ in l){const y=l[_];if(y.used){const w=y.getSource();w.attribution&&r.indexOf(w.attribution)<0&&r.push(w.attribution)}}r.sort((_,y)=>_.length-y.length),r=r.filter((_,y)=>{for(let w=y+1;w<r.length;w++)if(r[w].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const f=r.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,r.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Sc{constructor(){a.bindAll(["_updateLogo"],this),a.bindAll(["_updateCompact"],this)}onAdd(r){this._map=r,this._container=G.create("div","mapboxgl-ctrl");const l=G.create("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const l in r){const f=r[l].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Ac{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,f=l?this._queue.concat(l):this._queue;for(const _ of f)if(_.id===r)return void(_.cancelled=!0)}run(r=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const f of l)if(!f.cancelled&&(f.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Cc(d,r,l){if(d=new a.LngLat(d.lng,d.lat),r){const f=new a.LngLat(d.lng-360,d.lat),_=new a.LngLat(d.lng+360,d.lat),y=360*Math.ceil(Math.abs(d.lng-l.center.lng)/360),w=l.locationPoint(d).distSqr(r),S=r.x<0||r.y<0||r.x>l.width||r.y>l.height;l.locationPoint(f).distSqr(r)<w&&(S||Math.abs(f.lng-l.center.lng)<y)?d=f:l.locationPoint(_).distSqr(r)<w&&(S||Math.abs(_.lng-l.center.lng)<y)&&(d=_)}for(;Math.abs(d.lng-l.center.lng)>180;){const f=l.locationPoint(d);if(f.x>=0&&f.y>=0&&f.x<=l.width&&f.y<=l.height)break;d.lng>l.center.lng?d.lng-=360:d.lng+=360}return d}const ai={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Mc extends a.Evented{constructor(r,l){if(super(),(r instanceof a.window.HTMLElement||l)&&(r=a.extend({element:r},l)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),r&&r.element)this._element=r.element,this._offset=a.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=G.create("div");const _=41,y=27,w=G.createSVG("svg",{display:"block",height:_*this._scale+"px",width:y*this._scale+"px",viewBox:`0 0 ${y} ${_}`},this._element),S=G.createSVG("radialGradient",{id:"shadowGradient"},G.createSVG("defs",{},w));G.createSVG("stop",{offset:"10%","stop-opacity":.4},S),G.createSVG("stop",{offset:"100%","stop-opacity":.05},S),G.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},w),G.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},w),G.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},w),G.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},w),this._offset=a.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const f=this._element.classList;for(const _ in ai)f.remove(`mapboxgl-marker-anchor-${_}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=a.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const l=r.code,f=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(r){const l=r.originalEvent.target,f=this._element;this._popup&&(l===f||f.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const r=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(r))return void this._clearFadeTimer();const l=this._map.unproject(r);let f=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const y=this._map.getFreeCameraOptions();if(y.position){const w=y.position.toLngLat();f=w.distanceTo(l)<.9*w.distanceTo(this._lngLat)}}const _=(1-this._map._queryFogOpacity(l))*(f?.2:1);this._element.style.opacity=`${_}`,this._popup&&this._popup._setOpacity(`${_}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(r){const l=this._map.transform;return!!r&&r.x>=0&&r.x<l.width&&r.y>=0&&r.y<l.height}_updateDOM(){const r=this._pos||new a.pointGeometry(0,0),l=this._calculatePitch(),f=this._calculateRotation();this._element.style.transform=`${ai[this._anchor]} translate(${r.x}px, ${r.y}px) rotateX(${l}deg) rotateZ(${f}deg)`}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(r){a.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=Cc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),r===!0?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const r=this._map.transform,l=this._offset.mult(this._scale);return this._rotationAlignment==="map"&&l._rotate(r.angle),this._pitchAlignment==="map"&&(l.y*=Math.cos(r._pitch)),l}getOffset(){return this._offset}setOffset(r){return this._offset=a.pointGeometry.convert(r),this._update(),this}_onMove(r){if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(r){this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Hn{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const l=a.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,l,f){this._start=this.getValue(l),this._end=r,this._startTime=l,this._endTime=l+f}}const fh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:Mn,HTMLElement:us,ImageBitmap:hs}=a.window,hf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Ic(d){d.parentNode&&d.parentNode.removeChild(d)}const df={showCompass:!0,showZoom:!0,visualizePitch:!1};class ph{constructor(r,l,f=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new un({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,f&&(this.mousePitch=new yc({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(r,l){this.mouseRotate.mousedown(r,l),this.mousePitch&&this.mousePitch.mousedown(r,l),G.disableDrag()}move(r,l){const f=this.map,_=this.mouseRotate.mousemoveWindow(r,l);if(_&&_.bearingDelta&&f.setBearing(f.getBearing()+_.bearingDelta),this.mousePitch){const y=this.mousePitch.mousemoveWindow(r,l);y&&y.pitchDelta&&f.setPitch(f.getPitch()+y.pitchDelta)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){G.enableDrag(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(a.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),G.mousePos(this.element,r)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,G.mousePos(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=G.touchPos(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=G.touchPos(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ra={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Ei,ia=0,ds=!1;const na={maxWidth:100,unit:"metric"};function rt(d,r,l){const f=l&&l.maxWidth||100,_=d._containerHeight/2,y=d.unproject([0,_]),w=d.unproject([f,_]),S=y.distanceTo(w);if(l&&l.unit==="imperial"){const k=3.2808*S;k>5280?fs(r,f,k/5280,d._getUIString("ScaleControl.Miles"),d):fs(r,f,k,d._getUIString("ScaleControl.Feet"),d)}else l&&l.unit==="nautical"?fs(r,f,S/1852,d._getUIString("ScaleControl.NauticalMiles"),d):S>=1e3?fs(r,f,S/1e3,d._getUIString("ScaleControl.Kilometers"),d):fs(r,f,S,d._getUIString("ScaleControl.Meters"),d)}function fs(d,r,l,f,_){const y=function(S){const k=Math.pow(10,`${Math.floor(S)}`.length-1);let z=S/k;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:function(P){const O=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*O)/O}(z),k*z}(l),w=y/l;_._requestDomTask(()=>{d.style.width=r*w+"px",d.innerHTML=`${y}&nbsp;${f}`})}const mh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},oa=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),To={version:a.version,supported:L,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends dh{constructor(d){if((d=a.extend({},hf,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(d.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ks(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._renderTaskQueue=new Ac,this._domRenderTaskQueue=new Ac,this._controls=[],this._markers=[],this._mapId=a.uniqueId(),this._locale=a.extend({},fh,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Hn(0),this._requestManager=new a.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,typeof d.container=="string"){if(this._container=a.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof us))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new cs(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new th(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,a.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new Ec({customAttribution:d.customAttribution})),this._logoControl=new Sc,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new a.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new a.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(d,r){if(r===void 0&&(r=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=d.onAdd(this);this._controls.push(d);const f=this._controlPositions[r];return r.indexOf("bottom")!==-1?f.insertBefore(l,f.firstChild):f.appendChild(l),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(d);return r>-1&&this._controls.splice(r,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new a.Event("movestart",d)).fire(new a.Event("move",d)),this.fire(new a.Event("resize",d)),r&&this.fire(new a.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(a.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d==null?85:d)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}getProjection(){return this.transform.getProjection()}setProjection(d){return this._lazyInitEmptyStyle(),typeof d=="string"&&(d={name:d}),this._runtimeProjection=d,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(d){return this.transform.locationPoint3D(a.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(a.pointGeometry.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(d,r,l){if(d==="mouseenter"||d==="mouseover"){let f=!1;const _=w=>{const S=r.filter(z=>this.getLayer(z)),k=S.length?this.queryRenderedFeatures(w.point,{layers:S}):[];k.length?f||(f=!0,l.call(this,new fi(d,this,w.originalEvent,{features:k}))):f=!1},y=()=>{f=!1};return{layers:new Set(r),listener:l,delegates:{mousemove:_,mouseout:y}}}if(d==="mouseleave"||d==="mouseout"){let f=!1;const _=w=>{const S=r.filter(k=>this.getLayer(k));(S.length?this.queryRenderedFeatures(w.point,{layers:S}):[]).length?f=!0:f&&(f=!1,l.call(this,new fi(d,this,w.originalEvent)))},y=w=>{f&&(f=!1,l.call(this,new fi(d,this,w.originalEvent)))};return{layers:new Set(r),listener:l,delegates:{mousemove:_,mouseout:y}}}{const f=_=>{const y=r.filter(S=>this.getLayer(S)),w=y.length?this.queryRenderedFeatures(_.point,{layers:y}):[];w.length&&(_.features=w,l.call(this,_),delete _.features)};return{layers:new Set(r),listener:l,delegates:{[d]:f}}}}on(d,r,l){if(l===void 0)return super.on(d,r);Array.isArray(r)||(r=[r]);const f=this._createDelegatedListener(d,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(const _ in f.delegates)this.on(_,f.delegates[_]);return this}once(d,r,l){if(l===void 0)return super.once(d,r);Array.isArray(r)||(r=[r]);const f=this._createDelegatedListener(d,r,l);for(const _ in f.delegates)this.once(_,f.delegates[_]);return this}off(d,r,l){if(l===void 0)return super.off(d,r);r=new Set(Array.isArray(r)?r:[r]);const f=(y,w)=>{if(y.size!==w.size)return!1;for(const S of y)if(!w.has(S))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[d]:void 0;return _&&(y=>{for(let w=0;w<y.length;w++){const S=y[w];if(S.listener===l&&f(S.layers,r)){for(const k in S.delegates)this.off(k,S.delegates[k]);return y.splice(w,1),this}}})(_),this}queryRenderedFeatures(d,r){return this.style?(r!==void 0||d===void 0||d instanceof a.pointGeometry||Array.isArray(d)||(r=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(d,r){return this.style.querySourceFeatures(d,r)}queryTerrainElevation(d,r){const l=this.transform.elevation;return l?(r=a.extend({},{exaggerated:!0},r),l.getAtPoint(a.MercatorCoordinate.fromLngLat(d),null,r.exaggerated)):null}setStyle(d,r){return(r=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(d,r))}_getUIString(d){const r=this._locale[d];if(r==null)throw new Error(`Missing UI string '${d}'`);return r}_updateStyle(d,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),d&&(this.style=new zi(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new zi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,r){if(typeof d=="string"){const l=this._requestManager.normalizeStyleURL(d),f=this._requestManager.transformRequest(l,a.ResourceType.Style);a.getJSON(f,(_,y)=>{_?this.fire(new a.ErrorEvent(_)):y&&this._updateDiff(y,r)})}else typeof d=="object"&&this._updateDiff(d,r)}_updateDiff(d,r){try{this.style.setState(d)&&this._update(!0)}catch(l){a.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(d,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.warnOnce("There is no style added to the map.")}addSource(d,r){return this._lazyInitEmptyStyle(),this.style.addSource(d,r),this._update(!0)}isSourceLoaded(d){const r=this.style&&this.style._getSourceCaches(d);if(r.length!==0)return r.every(l=>l.loaded());this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${d}'`)))}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const r in d){const l=d[r]._tiles;for(const f in l){const _=l[f];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(d,r,l){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,r,l)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,r,{pixelRatio:l=1,sdf:f=!1,stretchX:_,stretchY:y,content:w}={}){if(this._lazyInitEmptyStyle(),r instanceof Mn||hs&&r instanceof hs){const{width:S,height:k,data:z}=a.exported.getImageData(r);this.style.addImage(d,{data:new a.RGBAImage({width:S,height:k},z),pixelRatio:l,stretchX:_,stretchY:y,content:w,sdf:f,version:0})}else{if(r.width===void 0||r.height===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:k,data:z}=r,P=r;this.style.addImage(d,{data:new a.RGBAImage({width:S,height:k},new Uint8Array(z)),pixelRatio:l,stretchX:_,stretchY:y,content:w,sdf:f,version:0,userImage:P}),P.onAdd&&P.onAdd(this,d)}}}updateImage(d,r){const l=this.style.getImage(d);if(!l)return this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=r instanceof Mn||hs&&r instanceof hs?a.exported.getImageData(r):r,{width:_,height:y,data:w}=f;return _===void 0||y===void 0?this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):_!==l.data.width||y!==l.data.height?this.fire(new a.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(l.data.replace(w,!(r instanceof Mn||hs&&r instanceof hs)),void this.style.updateImage(d,l))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,r){a.getImage(this._requestManager.transformRequest(d,a.ResourceType.Image),(l,f)=>{r(l,f instanceof Mn?a.exported.getImageData(f):f)})}listImages(){return this.style.listImages()}addLayer(d,r){return this._lazyInitEmptyStyle(),this.style.addLayer(d,r),this._update(!0)}moveLayer(d,r){return this.style.moveLayer(d,r),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,r,l){return this.style.setLayerZoomRange(d,r,l),this._update(!0)}setFilter(d,r,l={}){return this.style.setFilter(d,r,l),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,r,l,f={}){return this.style.setPaintProperty(d,r,l,f),this._update(!0)}getPaintProperty(d,r){return this.style.getPaintProperty(d,r)}setLayoutProperty(d,r,l,f={}){return this.style.setLayoutProperty(d,r,l,f),this._update(!0)}getLayoutProperty(d,r){return this.style.getLayoutProperty(d,r)}setLight(d,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){this.transform.projection.name==="globe"&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(d),this.transform):0}setFeatureState(d,r){return this.style.setFeatureState(d,r),this._update()}removeFeatureState(d,r){return this.style.removeFeatureState(d,r),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let l,f=this._container;for(;f&&!l;){const _=a.window.getComputedStyle(f).transform;_&&_!=="none"&&(l=_.match(/matrix.*\((.+)\)/)[1].split(", ")),f=f.parentElement}l?(this._containerWidth=l[0]&&l[0]!=="0"?Math.abs(d/l[0]):d,this._containerHeight=l[3]&&l[3]!=="0"?Math.abs(r/l[3]):r):(this._containerWidth=d,this._containerHeight=r)}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=G.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=G.create("div","mapboxgl-canvas-container",d);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=G.create("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=G.create("div","mapboxgl-control-container",d),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{f[_]=G.create("div",`mapboxgl-ctrl-${_}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,r){const l=a.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(d),this._canvas.height=l*Math.ceil(r),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${r}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const r=this._markers.indexOf(d);r!==-1&&this._markers.splice(r,1)}_setupPainter(){const d=a.extend({},L.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);r?(a.storeAuthState(r,!0),this.painter=new Yu(r,this.transform),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(r)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let r;const l=this.painter.context.extTimerQuery,f=a.exported.now();this.listens("gpu-timing-frame")&&(r=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,r));let _=this._updateAverageElevation(f);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjection();let y=!1;const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,z=this.transform.pitch,P=a.exported.now();this.style.zoomHistory.update(k,P);const O=new a.EvaluationParameters(k,{now:P,fadeDuration:w,pitch:z,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),V=O.crossFadingFactor();V===1&&V===this._crossFadingFactor||(y=!0,this._crossFadingFactor=V),this.style.update(O)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const k=a.exported.now()-f;l.endQueryEXT(l.TIME_ELAPSED_EXT,r),setTimeout(()=>{const z=l.getQueryObjectEXT(r,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(r),this.fire(new a.Event("gpu-timing-frame",{cpuTime:k,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(k);this.fire(new a.Event("gpu-timing-layer",{layerTimes:z}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(S||this._repaint)this.triggerRepaint();else{const k=!this.isMoving()&&this.loaded();if(k&&(_=this._updateAverageElevation(f,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const d of this._markers)d._update()}_updateAverageElevation(d,r=!1){const l=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);if((r||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const f=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();isNaN(_)?_=0:this._averageElevationLastSampledAt=d;const y=Math.abs(f-_);if(y>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(_),l(_);this._averageElevation.easeTo(_,d,300)}else if(y>1e-4)return this._averageElevation.jumpTo(_),l(_)}return!!this._averageElevation.isEasing(d)&&l(this._averageElevation.getValue(d))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===a.AUTH_ERR_MSG||d.status===401)){const r=this.painter.context.gl;a.storeAuthState(r,!1),this._logoControl instanceof Sc&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const l=this.painter.context.gl,f=l.createFramebuffer();function _(y){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,y,0);const w=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,w),w}return l.bindFramebuffer(l.FRAMEBUFFER,f),this._canvasPixelComparison(_(d),r.canvasCopies.map(_),r.timeStamps)}_canvasPixelComparison(d,r,l){let f=l[1]-l[0];const _=d.length/4;for(let y=0;y<r.length;y++){const w=r[y];let S=0;for(let k=0;k<w.length;k+=4)w[k]===d[k]&&w[k+1]===d[k+1]&&w[k+2]===d[k+2]&&w[k+3]===d[k+3]&&(S+=1);f+=(l[y+2]-l[y+1])*(1-S/_)}return f}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),Ic(this._canvasContainer),Ic(this._controlContainer),Ic(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=a.exported.frame(r=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(r)}))}_preloadTiles(d){const r=this.style&&Object.values(this.style._sourceCaches)||[];return a.asyncAll(r,(l,f)=>l._preloadTiles(d,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}_setCacheLimits(d,r){a.setCacheLimits(d,r)}get version(){return a.version}},NavigationControl:class{constructor(d){this.options=a.extend({},df,d),this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),G.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),G.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=G.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const d=this._map.getZoom(),r=d===this._map.getMaxZoom(),l=d===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())}_rotateCompassArrow(){const d=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=d)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ph(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,r){const l=G.create("button",d,this._container);return l.type="button",l.addEventListener("click",r),l}_setButtonTitle(d,r){const l=this._map._getUIString(`NavigationControl.${r}`);d.setAttribute("aria-label",l),d.firstElementChild&&d.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends a.Evented{constructor(d){super(),this.options=a.extend({},ra,d),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=wo(this._updateMarkerRotation,20)}onAdd(d){var r;return this._map=d,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,Ei!==void 0?r(Ei):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(l=>{Ei=l.state!=="denied",r(Ei)}):(Ei=!!a.window.navigator.geolocation,r(Ei)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(a.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,ia=0,ds=!1}_isOutOfMapMaxBounds(d){const r=this._map.getMaxBounds(),l=d.coords;return r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",d)),this._finish()}}_updateCamera(d){const r=new a.LngLat(d.coords.longitude,d.coords.latitude),l=d.coords.accuracy,f=this._map.getBearing(),_=a.extend({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(l),_,{geolocateSource:!0})}_updateMarker(d){if(d){const r=new a.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map._containerHeight/2,r=this._map.unproject([0,d]),l=this._map.unproject([100,d]),f=r.distanceTo(l)/100,_=Math.ceil(2*this._accuracy/f);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&ds)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=G.create("button","mapboxgl-ctrl-geolocate",this._container),G.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",d===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G.create("div","mapboxgl-user-location"),this._dotElement.appendChild(G.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(G.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Mc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=G.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Mc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ia--,ds=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ia++,ia>1?(d={maximumAge:6e5,timeout:0},ds=!0):(d=this.options.positionOptions,ds=!1),this._geolocationWatchID=a.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else a.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&d()}).catch(console.error):d()}_clearWatch(){a.window.navigator.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ec,ScaleControl:class{constructor(d){this.options=a.extend({},na,d),a.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){rt(this._map,this._container,this.options)}onAdd(d){return this._map=d,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(d){this.options.unit=d,rt(this._map,this._container,this.options)}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof a.window.HTMLElement?this._container=d.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=G.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);G.create("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden",!0),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(d){super(),this.options=a.extend(Object.create(mh),d),a.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=a.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(a.window.document.createTextNode(d))}setHTML(d){const r=a.window.document.createDocumentFragment(),l=a.window.document.createElement("body");let f;for(l.innerHTML=d;f=l.firstChild,f;)r.appendChild(f);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=G.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._container&&this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._container&&this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let r;return this._classList.delete(d)?r=!1:(this._classList.add(d),r=!0),this._container&&this._updateClassList(),r}_createCloseButton(){this.options.closeButton&&(this._closeButton=G.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(d){this._update(d.point)}_onMouseMove(d){this._update(d.point)}_onDrag(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const r=this._pos,l=this._container.offsetWidth,f=this._container.offsetHeight;let _;return _=r.y+d.bottom.y<f?["top"]:r.y>this._map.transform.height-f?["bottom"]:[],r.x<l/2?_.push("left"):r.x>this._map.transform.width-l/2&&_.push("right"),_.length===0?"bottom":_.join("-")}_updateClassList(){const d=[...this._classList];d.push("mapboxgl-popup"),this._anchor&&d.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&d.push("mapboxgl-popup-track-pointer"),this._container.className=d.join(" ")}_update(d){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=G.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=G.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Cc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||d){const r=this._pos=this._trackPointer&&d?d:this._map.project(this._lngLat),l=function(y){if(y||(y=new a.pointGeometry(0,0)),typeof y=="number"){const w=Math.round(Math.sqrt(.5*Math.pow(y,2)));return{center:new a.pointGeometry(0,0),top:new a.pointGeometry(0,y),"top-left":new a.pointGeometry(w,w),"top-right":new a.pointGeometry(-w,w),bottom:new a.pointGeometry(0,-y),"bottom-left":new a.pointGeometry(w,-w),"bottom-right":new a.pointGeometry(-w,-w),left:new a.pointGeometry(y,0),right:new a.pointGeometry(-y,0)}}if(y instanceof a.pointGeometry||Array.isArray(y)){const w=a.pointGeometry.convert(y);return{center:w,top:w,"top-left":w,"top-right":w,bottom:w,"bottom-left":w,"bottom-right":w,left:w,right:w}}return{center:a.pointGeometry.convert(y.center||[0,0]),top:a.pointGeometry.convert(y.top||[0,0]),"top-left":a.pointGeometry.convert(y["top-left"]||[0,0]),"top-right":a.pointGeometry.convert(y["top-right"]||[0,0]),bottom:a.pointGeometry.convert(y.bottom||[0,0]),"bottom-left":a.pointGeometry.convert(y["bottom-left"]||[0,0]),"bottom-right":a.pointGeometry.convert(y["bottom-right"]||[0,0]),left:a.pointGeometry.convert(y.left||[0,0]),right:a.pointGeometry.convert(y.right||[0,0])}}(this.options.offset),f=this._anchor=this._getAnchor(l),_=r.add(l[f]).round();this._map._requestDomTask(()=>{this._container&&f&&(this._container.style.transform=`${ai[f]} translate(${_.x}px,${_.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(oa);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._content&&(this._content.style.opacity=d),this._tip&&(this._tip.style.opacity=d)}},Marker:Mc,Style:zi,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:Qu,Evented:a.Evented,config:a.config,prewarm:function(){ue().acquire(le)},clearPrewarmedResources:function(){const d=pe;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(le),pe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(d){a.config.ACCESS_TOKEN=d},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(d){a.config.API_URL=d},get workerCount(){return de.workerCount},set workerCount(d){de.workerCount=d},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){a.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){a.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return To});var M=v;return M})})(mm);var Gb=mm.exports,qb=Bb({__proto__:null,default:Gb},[mm.exports]);function Mv(n,s){for(var h in s)n[h]=s[h];return n}function jp(n,s){for(var h in n)if(h!=="__source"&&!(h in s))return!0;for(var m in s)if(m!=="__source"&&n[m]!==s[m])return!0;return!1}function Vp(n){this.props=n}function zs(n,s){function h(v){var b=this.props.ref,M=b==v.ref;return!M&&b&&(b.call?b(null):b.current=null),s?!s(this.props,v)||!M:jp(this.props,v)}function m(v){return this.shouldComponentUpdate=h,vn(n,v)}return m.displayName="Memo("+(n.displayName||n.name)+")",m.prototype.isReactComponent=!0,m.__f=!0,m}(Vp.prototype=new ao).isPureReactComponent=!0,Vp.prototype.shouldComponentUpdate=function(n,s){return jp(this.props,n)||jp(this.state,s)};var ey=_t.__b;_t.__b=function(n){n.type&&n.type.__f&&n.ref&&(n.props.ref=n.ref,n.ref=null),ey&&ey(n)};var Zb=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function Mu(n){function s(h,m){var v=Mv({},h);return delete v.ref,n(v,(m=h.ref||m)&&(typeof m!="object"||"current"in m)?m:null)}return s.$$typeof=Zb,s.render=s,s.prototype.isReactComponent=s.__f=!0,s.displayName="ForwardRef("+(n.displayName||n.name)+")",s}var ty=function(n,s){return n==null?null:Po(Po(n).map(s))},_m={map:ty,forEach:ty,count:function(n){return n?Po(n).length:0},only:function(n){var s=Po(n);if(s.length!==1)throw"Children.only";return s[0]},toArray:Po},Wb=_t.__e;_t.__e=function(n,s,h){if(n.then){for(var m,v=s;v=v.__;)if((m=v.__c)&&m.__c)return s.__e==null&&(s.__e=h.__e,s.__k=h.__k),m.__c(n,s)}Wb(n,s,h)};var ry=_t.unmount;function vd(){this.__u=0,this.t=null,this.__b=null}function Iv(n){var s=n.__.__c;return s&&s.__e&&s.__e(n)}function Xb(n){var s,h,m;function v(b){if(s||(s=n()).then(function(M){h=M.default||M},function(M){m=M}),m)throw m;if(!h)throw s;return vn(h,b)}return v.displayName="Lazy",v.__f=!0,v}function nu(){this.u=null,this.o=null}_t.unmount=function(n){var s=n.__c;s&&s.__R&&s.__R(),s&&n.__h===!0&&(n.type=null),ry&&ry(n)},(vd.prototype=new ao).__c=function(n,s){var h=s.__c,m=this;m.t==null&&(m.t=[]),m.t.push(h);var v=Iv(m.__v),b=!1,M=function(){b||(b=!0,h.__R=null,v?v(a):a())};h.__R=M;var a=function(){if(!--m.__u){if(m.state.__e){var F=m.state.__e;m.__v.__k[0]=function j(q,G,he){return q&&(q.__v=null,q.__k=q.__k&&q.__k.map(function(be){return j(be,G,he)}),q.__c&&q.__c.__P===G&&(q.__e&&he.insertBefore(q.__e,q.__d),q.__c.__e=!0,q.__c.__P=he)),q}(F,F.__c.__P,F.__c.__O)}var B;for(m.setState({__e:m.__b=null});B=m.t.pop();)B.forceUpdate()}},L=s.__h===!0;m.__u++||L||m.setState({__e:m.__b=m.__v.__k[0]}),n.then(M,M)},vd.prototype.componentWillUnmount=function(){this.t=[]},vd.prototype.render=function(n,s){if(this.__b){if(this.__v.__k){var h=document.createElement("div"),m=this.__v.__k[0].__c;this.__v.__k[0]=function b(M,a,L){return M&&(M.__c&&M.__c.__H&&(M.__c.__H.__.forEach(function(F){typeof F.__c=="function"&&F.__c()}),M.__c.__H=null),(M=Mv({},M)).__c!=null&&(M.__c.__P===L&&(M.__c.__P=a),M.__c=null),M.__k=M.__k&&M.__k.map(function(F){return b(F,a,L)})),M}(this.__b,h,m.__O=m.__P)}this.__b=null}var v=s.__e&&vn(Yo,null,n.fallback);return v&&(v.__h=null),[vn(Yo,null,s.__e?null:n.children),v]};var iy=function(n,s,h){if(++h[1]===h[0]&&n.o.delete(s),n.props.revealOrder&&(n.props.revealOrder[0]!=="t"||!n.o.size))for(h=n.u;h;){for(;h.length>3;)h.pop()();if(h[1]<h[0])break;n.u=h=h[2]}};function Hb(n){return this.getChildContext=function(){return n.context},n.children}function Kb(n){var s=this,h=n.i;s.componentWillUnmount=function(){jl(null,s.l),s.l=null,s.i=null},s.i&&s.i!==h&&s.componentWillUnmount(),n.__v?(s.l||(s.i=h,s.l={nodeType:1,parentNode:h,childNodes:[],appendChild:function(m){this.childNodes.push(m),s.i.appendChild(m)},insertBefore:function(m,v){this.childNodes.push(m),s.i.appendChild(m)},removeChild:function(m){this.childNodes.splice(this.childNodes.indexOf(m)>>>1,1),s.i.removeChild(m)}}),jl(vn(Hb,{context:s.context},n.__v),s.l)):s.l&&s.componentWillUnmount()}function qd(n,s){return vn(Kb,{__v:n,i:s})}(nu.prototype=new ao).__e=function(n){var s=this,h=Iv(s.__v),m=s.o.get(n);return m[0]++,function(v){var b=function(){s.props.revealOrder?(m.push(v),iy(s,n,m)):v()};h?h(b):b()}},nu.prototype.render=function(n){this.u=null,this.o=new Map;var s=Po(n.children);n.revealOrder&&n.revealOrder[0]==="b"&&s.reverse();for(var h=s.length;h--;)this.o.set(s[h],this.u=[1,0,this.u]);return n.children},nu.prototype.componentDidUpdate=nu.prototype.componentDidMount=function(){var n=this;this.o.forEach(function(s,h){iy(n,h,s)})};var kv=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.element")||60103,Yb=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|marker(?!H|W|U)|overline|paint|stop|strikethrough|stroke|text(?!L)|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Jb=typeof document!="undefined",Qb=function(n){return(typeof Symbol!="undefined"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(n)};function ew(n,s,h){return s.__k==null&&(s.textContent=""),jl(n,s),typeof h=="function"&&h(),n?n.__c:null}function tw(n,s,h){return fm(n,s),typeof h=="function"&&h(),n?n.__c:null}ao.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(n){Object.defineProperty(ao.prototype,n,{configurable:!0,get:function(){return this["UNSAFE_"+n]},set:function(s){Object.defineProperty(this,n,{configurable:!0,writable:!0,value:s})}})});var ny=_t.event;function rw(){}function iw(){return this.cancelBubble}function nw(){return this.defaultPrevented}_t.event=function(n){return ny&&(n=ny(n)),n.persist=rw,n.isPropagationStopped=iw,n.isDefaultPrevented=nw,n.nativeEvent=n};var zv,oy={configurable:!0,get:function(){return this.class}},sy=_t.vnode;_t.vnode=function(n){var s=n.type,h=n.props,m=h;if(typeof s=="string"){var v=s.indexOf("-")===-1;for(var b in m={},h){var M=h[b];Jb&&b==="children"&&s==="noscript"||b==="value"&&"defaultValue"in h&&M==null||(b==="defaultValue"&&"value"in h&&h.value==null?b="value":b==="download"&&M===!0?M="":/ondoubleclick/i.test(b)?b="ondblclick":/^onchange(textarea|input)/i.test(b+s)&&!Qb(h.type)?b="oninput":/^onfocus$/i.test(b)?b="onfocusin":/^onblur$/i.test(b)?b="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(b)?b=b.toLowerCase():v&&Yb.test(b)?b=b.replace(/[A-Z0-9]/,"-$&").toLowerCase():M===null&&(M=void 0),m[b]=M)}s=="select"&&m.multiple&&Array.isArray(m.value)&&(m.value=Po(h.children).forEach(function(a){a.props.selected=m.value.indexOf(a.props.value)!=-1})),s=="select"&&m.defaultValue!=null&&(m.value=Po(h.children).forEach(function(a){a.props.selected=m.multiple?m.defaultValue.indexOf(a.props.value)!=-1:m.defaultValue==a.props.value})),n.props=m,h.class!=h.className&&(oy.enumerable="className"in h,h.className!=null&&(m.class=h.className),Object.defineProperty(m,"className",oy))}n.$$typeof=kv,sy&&sy(n)};var ay=_t.__r;_t.__r=function(n){ay&&ay(n),zv=n.__c};var ow={ReactCurrentDispatcher:{current:{readContext:function(n){return zv.__n[n.__c].props.value}}}};function sw(n){return vn.bind(null,n)}function Pv(n){return!!n&&n.$$typeof===kv}function Dv(n){return Pv(n)?wv.apply(null,arguments):n}function aw(n){return!!n.__k&&(jl(null,n),!0)}function lw(n){return n&&(n.base||n.nodeType===1&&n)||null}var cw=function(n,s){return n(s)},uw=function(n,s){return n(s)},yn={useState:qn,useReducer:Ev,useEffect:gr,useLayoutEffect:Xl,useRef:kt,useImperativeHandle:Hl,useMemo:en,useCallback:ur,useContext:Ta,useDebugValue:Ho,version:"17.0.2",Children:_m,render:ew,hydrate:tw,unmountComponentAtNode:aw,createPortal:qd,createElement:vn,createContext:Gd,createFactory:sw,cloneElement:Dv,createRef:pv,Fragment:Yo,isValidElement:Pv,findDOMNode:lw,Component:ao,PureComponent:Vp,memo:zs,forwardRef:Mu,flushSync:uw,unstable_batchedUpdates:cw,StrictMode:Yo,Suspense:vd,SuspenseList:nu,lazy:Xb,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:ow};const hw=Gd(null);function ly(n){return{longitude:n.center.lng,latitude:n.center.lat,zoom:n.zoom,pitch:n.pitch,bearing:n.bearing,padding:n.padding}}function cy(n,s){const h=s.viewState||s;let m=!1;if("longitude"in h&&"latitude"in h){const v=n.center;n.center=new v.constructor(h.longitude,h.latitude),m=m||v!==n.center}if("zoom"in h){const v=n.zoom;n.zoom=h.zoom,m=m||v!==n.zoom}if("bearing"in h){const v=n.bearing;n.bearing=h.bearing,m=m||v!==n.bearing}if("pitch"in h){const v=n.pitch;n.pitch=h.pitch,m=m||v!==n.pitch}return h.padding&&!n.isPaddingEqual(h.padding)&&(m=!0,n.padding=h.padding),m}const dw=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function uy(n){if(!n)return null;if(typeof n=="string"||("toJS"in n&&(n=n.toJS()),!n.layers))return n;const s={};for(const m of n.layers)s[m.id]=m;const h=n.layers.map(m=>{const v=s[m.ref];let b=null;if("interactive"in m&&(b=_n({},m),delete b.interactive),v){b=b||_n({},m),delete b.ref;for(const M of dw)M in v&&(b[M]=v[M])}return b||m});return Cl(_n({},n),{layers:h})}function fw(n,s){const h=Array.isArray(n)?n[0]:n?n.x:0,m=Array.isArray(n)?n[1]:n?n.y:0,v=Array.isArray(s)?s[0]:s?s.x:0,b=Array.isArray(s)?s[1]:s?s.y:0;return h===v&&m===b}function Gn(n,s){if(n===s)return!0;if(!n||!s)return!1;if(Array.isArray(n)){if(!Array.isArray(s)||n.length!==s.length)return!1;for(let h=0;h<n.length;h++)if(!Gn(n[h],s[h]))return!1;return!0}else if(Array.isArray(s))return!1;if(typeof n=="object"&&typeof s=="object"){const h=Object.keys(n),m=Object.keys(s);if(h.length!==m.length)return!1;for(const v of h)if(!s.hasOwnProperty(v)||!Gn(n[v],s[v]))return!1;return!0}return!1}const hy={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Tp={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},dy={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},pw=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],mw=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class $l{constructor(s,h,m){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=v=>{const b=this.props[dy[v.type]];b&&b(v)},this._onPointerEvent=v=>{(v.type==="mousemove"||v.type==="mouseout")&&this._updateHover(v);const b=this.props[hy[v.type]];if(b){if(this.props.interactiveLayerIds&&v.type!=="mouseover"&&v.type!=="mouseout"){const M=this._hoveredFeatures||this._map.queryRenderedFeatures(v.point,{layers:this.props.interactiveLayerIds});if(!M.length)return;v.features=M}b(v),delete v.features}},this._onCameraEvent=v=>{if(!this._internalUpdate){const b=this.props[Tp[v.type]];b&&b(v)}v.type in this._deferredEvents&&(this._deferredEvents[v.type]=!1)},this._MapClass=s,this.props=h,this._initialize(m)}get map(){return this._map}get transform(){return this._renderTransform}setProps(s){const h=this.props;this.props=s;const m=this._updateSettings(s,h);m&&(this._renderTransform=this._map.transform.clone());const v=this._updateSize(s),b=this._updateViewState(s,!0);this._updateStyle(s,h),this._updateStyleComponents(s,h),this._updateHandlers(s,h),(m||v||b&&!this._map.isMoving())&&this.redraw()}static reuse(s,h){const m=$l.savedMaps.pop();if(!m)return null;const v=m.map,b=v.getContainer();for(h.className=b.className;b.childNodes.length>0;)h.appendChild(b.childNodes[0]);return v._container=h,s.initialViewState&&m._updateViewState(s.initialViewState,!1),v.resize(),m.setProps(Cl(_n({},s),{styleDiffing:!1})),v.isStyleLoaded()?v.fire("load"):v.once("styledata",()=>v.fire("load")),m}_initialize(s){const{props:h}=this,m=Cl(_n(_n({},h),h.initialViewState),{accessToken:h.mapboxAccessToken||_w()||null,container:s,style:uy(h.mapStyle)}),v=m.initialViewState||m.viewState||m;if(Object.assign(m,{center:[v.longitude||0,v.latitude||0],zoom:v.zoom||0,pitch:v.pitch||0,bearing:v.bearing||0}),h.gl){const F=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=F,h.gl)}const b=new this._MapClass(m);v.padding&&b.setPadding(v.padding),h.cursor&&(b.getCanvas().style.cursor=h.cursor),this._renderTransform=b.transform.clone();const M=b._render;b._render=F=>{this._inRender=!0,M.call(b,F),this._inRender=!1};const a=b._renderTaskQueue.run;b._renderTaskQueue.run=F=>{a.call(b._renderTaskQueue,F),this._onBeforeRepaint()},b.on("render",()=>this._onAfterRepaint());const L=b.fire;b.fire=this._fireEvent.bind(this,L),b.on("resize",()=>{this._renderTransform.resize(b.transform.width,b.transform.height)}),b.on("styledata",()=>this._updateStyleComponents(this.props,{})),b.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const F in hy)b.on(F,this._onPointerEvent);for(const F in Tp)b.on(F,this._onCameraEvent);for(const F in dy)b.on(F,this._onEvent);this._map=b}recycle(){$l.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const s=this._map;!this._inRender&&s.style&&(s._frame&&(s._frame.cancel(),s._frame=null),s._render())}_updateSize(s){const{viewState:h}=s;if(h){const m=this._map;if(h.width!==m.transform.width||h.height!==m.transform.height)return m.resize(),!0}return!1}_updateViewState(s,h){if(this._internalUpdate)return!1;const m=this._map,v=this._renderTransform,{zoom:b,pitch:M,bearing:a}=v,L=cy(v,_n(_n({},ly(m.transform)),s));if(L&&h){const F=this._deferredEvents;F.move=!0,F.zoom||(F.zoom=b!==v.zoom),F.rotate||(F.rotate=a!==v.bearing),F.pitch||(F.pitch=M!==v.pitch)}return m.isMoving()||cy(m.transform,s),L}_updateSettings(s,h){const m=this._map;let v=!1;for(const b of pw)b in s&&!Gn(s[b],h[b])&&(v=!0,m[`set${b[0].toUpperCase()}${b.slice(1)}`](s[b]));return v}_updateStyle(s,h){if(s.cursor!==h.cursor&&(this._map.getCanvas().style.cursor=s.cursor),s.mapStyle!==h.mapStyle){const m={diff:s.styleDiffing};return"localIdeographFontFamily"in s&&(m.localIdeographFontFamily=s.localIdeographFontFamily),this._map.setStyle(uy(s.mapStyle),m),!0}return!1}_updateStyleComponents(s,h){const m=this._map;let v=!1;return m.style.loaded()&&("light"in s&&!Gn(s.light,h.light)&&(v=!0,m.setLight(s.light)),"fog"in s&&!Gn(s.fog,h.fog)&&(v=!0,m.setFog(s.fog)),"terrain"in s&&!Gn(s.terrain,h.terrain)&&(!s.terrain||m.getSource(s.terrain.source))&&(v=!0,m.setTerrain(s.terrain),this._renderTransform.elevation=m.transform.elevation)),v}_updateHandlers(s,h){const m=this._map;let v=!1;for(const b of mw){const M=s[b];Gn(M,h[b])||(v=!0,M?m[b].enable(M):m[b].disable())}return v}_updateHover(s){var v;const{props:h}=this;if(h.interactiveLayerIds&&(h.onMouseMove||h.onMouseEnter||h.onMouseLeave)){const b=s.type,M=((v=this._hoveredFeatures)==null?void 0:v.length)>0;let a;if(b==="mousemove")try{a=this._map.queryRenderedFeatures(s.point,{layers:h.interactiveLayerIds})}catch{a=[]}else a=[];const L=a.length>0;!L&&M&&(s.type="mouseleave",this._onPointerEvent(s)),this._hoveredFeatures=a,L&&!M&&(s.type="mouseenter",this._onPointerEvent(s)),s.type=b}else this._hoveredFeatures=null}_fireEvent(s,h,m){const v=this._map,b=v.transform,M=typeof h=="string"?h:h.type;return M==="move"&&this._updateViewState(this.props,!1),M in Tp&&(typeof h=="object"&&(h.viewState=ly(b)),this._map.isMoving())?(v.transform=this._renderTransform,s.call(v,h,m),v.transform=b,v):(s.call(v,h,m),v)}_onBeforeRepaint(){const s=this._map;this._internalUpdate=!0;for(const m in this._deferredEvents)this._deferredEvents[m]&&s.fire(m);this._internalUpdate=!1;const h=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=h}}}$l.savedMaps=[];function _w(){let n=null;if(typeof location!="undefined"){const s=/access_token=([^&\/]*)/.exec(location.search);n=s&&s[1]}try{n=n||{}.MapboxAccessToken}catch{}try{n=n||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return n}const gw=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function yw(n,s){if(!n)return null;const h=n.map,m={getMap:()=>h,getCenter:()=>n.transform.center,getZoom:()=>n.transform.zoom,getBearing:()=>n.transform.bearing,getPitch:()=>n.transform.pitch,getPadding:()=>n.transform.padding,getBounds:()=>n.transform.getBounds(),project:v=>n.transform.locationPoint(s.LngLat.convert(v)),unproject:v=>n.transform.pointLocation(s.Point.convert(v))};for(const v of vw(h))!(v in m)&&!gw.includes(v)&&(m[v]=h[v].bind(h));return m}function vw(n){const s=new Set;let h=n;for(;h;){for(const m of Object.getOwnPropertyNames(h))m[0]!=="_"&&typeof n[m]=="function"&&m!=="fire"&&m!=="setEventedParent"&&s.add(m);h=Object.getPrototypeOf(h)}return Array.from(s)}const xw=typeof document!="undefined"?Xl:gr,bw=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function ww(n,s){for(const h of bw)h in s&&(n[h]=s[h]);s.RTLTextPlugin&&n.getRTLTextPluginStatus&&n.getRTLTextPluginStatus()==="unavailable"&&n.setRTLTextPlugin(s.RTLTextPlugin,h=>{h&&console.error(h)},!1)}const Kl=Gd(null),Tw={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:n=>console.error(n.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},Lv=Mu((n,s)=>{const h=Ta(hw),[m,v]=qn(null),b=kt(),{current:M}=kt({mapLib:null,map:null});gr(()=>{const L=n.mapLib;let F=!0,B;return Promise.resolve(L||Promise.resolve().then(function(){return qb})).then(j=>{if(!!F){if(j.Map||(j=j.default),!j||!j.Map)throw new Error("Invalid mapLib");if(j.supported(n))ww(j,n),n.reuseMaps&&(B=$l.reuse(n,b.current)),B||(B=new $l(j.Map,n,b.current)),M.map=yw(B,j),M.mapLib=j,v(B),h==null||h.onMapMount(M.map,n.id);else throw new Error("Map is not supported by this browser")}}).catch(j=>{n.onError({type:"error",target:null,originalEvent:null,error:j})}),()=>{F=!1,B&&(h==null||h.onMapUnmount(n.id),n.reuseMaps?B.recycle():B.destroy())}},[]),xw(()=>{m&&m.setProps(n)}),Hl(s,()=>M.map,[m]);const a=en(()=>_n({position:"relative",width:"100%",height:"100%"},n.style),[n.style]);return vn("div",{id:n.id,ref:b,style:a},m&&vn(Kl.Provider,{value:M},n.children))});Lv.displayName="Map";Lv.defaultProps=Tw;const Ew=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Ea(n,s){if(!n||!s)return;const h=n.style;for(const m in s){const v=s[m];Number.isFinite(v)&&!Ew.test(m)?h[m]=`${v}px`:h[m]=v}}const Sw={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function Rv(n){const{map:s,mapLib:h}=Ta(Kl),m=kt({props:n});m.current.props=n;const v=en(()=>{let b=!1;_m.forEach(n.children,L=>{L&&(b=!0)});const M=Cl(_n({},n),{element:b?document.createElement("div"):null}),a=new h.Marker(M).setLngLat([n.longitude,n.latitude]);return a.getElement().addEventListener("click",L=>{var F,B;(B=(F=m.current.props).onClick)==null||B.call(F,{type:"click",target:a,originalEvent:L})}),a.on("dragstart",L=>{var B,j;const F=L;F.lngLat=v.getLngLat(),(j=(B=m.current.props).onDragStart)==null||j.call(B,F)}),a.on("drag",L=>{var B,j;const F=L;F.lngLat=v.getLngLat(),(j=(B=m.current.props).onDrag)==null||j.call(B,F)}),a.on("dragend",L=>{var B,j;const F=L;F.lngLat=v.getLngLat(),(j=(B=m.current.props).onDragEnd)==null||j.call(B,F)}),a},[]);return gr(()=>(v.addTo(s.getMap()),()=>{v.remove()}),[]),gr(()=>{Ea(v.getElement(),n.style)},[n.style]),(v.getLngLat().lng!==n.longitude||v.getLngLat().lat!==n.latitude)&&v.setLngLat([n.longitude,n.latitude]),n.offset&&!fw(v.getOffset(),n.offset)&&v.setOffset(n.offset),v.isDraggable()!==n.draggable&&v.setDraggable(n.draggable),v.getRotation()!==n.rotation&&v.setRotation(n.rotation),v.getRotationAlignment()!==n.rotationAlignment&&v.setRotationAlignment(n.rotationAlignment),v.getPitchAlignment()!==n.pitchAlignment&&v.setPitchAlignment(n.pitchAlignment),v.getPopup()!==n.popup&&v.setPopup(n.popup),qd(n.children,v.getElement())}Rv.defaultProps=Sw;var NC=zs(Rv);function fy(n){return new Set(n?n.trim().split(/\s+/):[])}function Aw(n){const{map:s,mapLib:h}=Ta(Kl),m=en(()=>document.createElement("div"),[]),v=kt({props:n});v.current.props=n;const b=en(()=>{const M=_n({},n),a=new h.Popup(M).setLngLat([n.longitude,n.latitude]);return a.on("open",L=>{var F,B;(B=(F=v.current.props).onOpen)==null||B.call(F,L)}),a.on("close",L=>{var F,B;(B=(F=v.current.props).onClose)==null||B.call(F,L)}),a},[]);if(gr(()=>(b.setDOMContent(m).addTo(s.getMap()),()=>{b.isOpen()&&b.remove()}),[]),gr(()=>{Ea(b.getElement(),n.style)},[n.style]),b.isOpen()&&((b.getLngLat().lng!==n.longitude||b.getLngLat().lat!==n.latitude)&&b.setLngLat([n.longitude,n.latitude]),n.offset&&!Gn(b.options.offset,n.offset)&&b.setOffset(n.offset),(b.options.anchor!==n.anchor||b.options.maxWidth!==n.maxWidth)&&(b.options.anchor=n.anchor,b.setMaxWidth(n.maxWidth)),b.options.className!==n.className)){const M=fy(b.options.className),a=fy(n.className);for(const L of M)a.has(L)||b.removeClassName(L);for(const L of a)M.has(L)||b.addClassName(L);b.options.className=n.className}return qd(n.children,m)}zs(Aw);function Iu(n,s,h){const m=Ta(Kl),v=en(()=>n(m),[]);return gr(()=>{var M;const{map:b}=m;return b.hasControl(v)||b.addControl(v,(M=h||s)==null?void 0:M.position),()=>{typeof s=="function"&&s(m),b.hasControl(v)&&b.removeControl(v)}},[]),v}function Cw(n){const s=Iu(({mapLib:h})=>new h.AttributionControl(n),{position:n.position});return gr(()=>{Ea(s._container,n.style)},[n.style]),null}var UC=zs(Cw);function Mw(n){const s=Iu(({mapLib:h})=>new h.FullscreenControl({container:n.containerId&&document.getElementById(n.containerId)}),{position:n.position});return gr(()=>{Ea(s._controlContainer,n.style)},[n.style]),null}zs(Mw);const Ov=Mu((n,s)=>{const h=kt({props:n}),m=Iu(({mapLib:v})=>{const b=new v.GeolocateControl(n);return b.on("geolocate",M=>{var a,L;(L=(a=h.current.props).onGeolocate)==null||L.call(a,M)}),b.on("error",M=>{var a,L;(L=(a=h.current.props).onError)==null||L.call(a,M)}),b.on("outofmaxbounds",M=>{var a,L;(L=(a=h.current.props).onOutOfMaxBounds)==null||L.call(a,M)}),b.on("trackuserlocationstart",M=>{var a,L;(L=(a=h.current.props).onTrackUserLocationStart)==null||L.call(a,M)}),b.on("trackuserlocationend",M=>{var a,L;(L=(a=h.current.props).onTrackUserLocationEnd)==null||L.call(a,M)}),b},{position:n.position});return h.current.props=n,Hl(s,()=>({trigger:()=>m.trigger()}),[]),gr(()=>{Ea(m._container,n.style)},[n.style]),null});Ov.displayName="GeolocateControl";var jC=zs(Ov);function Iw(n){const s=Iu(({mapLib:h})=>new h.NavigationControl(n),{position:n.position});return gr(()=>{Ea(s._container,n.style)},[n.style]),null}var VC=zs(Iw);const kw={unit:"metric",maxWidth:100};function Bv(n){const s=Iu(({mapLib:h})=>new h.ScaleControl(n),{position:n.position});return(s.options.unit!==n.unit||s.options.maxWidth!==n.maxWidth)&&(s.options.maxWidth=n.maxWidth,s.setUnit(n.unit)),gr(()=>{Ea(s._container,n.style)},[n.style]),null}Bv.defaultProps=kw;zs(Bv);function kd(n,s){if(!n)throw new Error(s)}let zw=0;function Pw(n,s,h){if(n.style&&n.style._loaded){const m=_n({},h);return delete m.id,delete m.children,n.addSource(s,m),n.getSource(s)}return null}function Dw(n,s,h){kd(s.id===h.id,"source id changed"),kd(s.type===h.type,"source type changed");let m="",v=0;for(const M in s)M!=="children"&&M!=="id"&&!Gn(h[M],s[M])&&(m=M,v++);if(!v)return;const b=s.type;if(b==="geojson")n.setData(s.data);else if(b==="image")n.updateImage({url:s.url,coordinates:s.coordinates});else if((b==="canvas"||b==="video")&&v===1&&m==="coordinates")n.setCoordinates(s.coordinates);else if(b==="vector"&&"setUrl"in n)switch(m){case"url":n.setUrl(s.url);break;case"tiles":n.setTiles(s.tiles);break}else console.warn(`Unable to update <Source> prop: ${m}`)}function $C(n){const s=Ta(Kl).map.getMap(),h=kt(n),[,m]=qn(0),v=en(()=>n.id||`jsx-source-${zw++}`,[]);gr(()=>{if(s){const M=()=>m(a=>a+1);return s.on("styledata",M),M(),()=>{s.off("styledata",M),setTimeout(()=>{s.style&&s.style._loaded&&s.getSource(v)&&s.removeSource(v)},0)}}},[s]);let b=s&&s.style&&s.getSource(v);return b?Dw(b,n,h.current):b=Pw(s,v,n),h.current=n,b&&_m.map(n.children,M=>M&&Dv(M,{source:v}))||null}function Lw(n,s,h,m){if(kd(h.id===m.id,"layer id changed"),kd(h.type===m.type,"layer type changed"),h.type==="custom"||m.type==="custom")return;const{layout:v={},paint:b={},filter:M,minzoom:a,maxzoom:L,beforeId:F}=h;if(F!==m.beforeId&&n.moveLayer(s,F),v!==m.layout){const B=m.layout||{};for(const j in v)Gn(v[j],B[j])||n.setLayoutProperty(s,j,v[j]);for(const j in B)v.hasOwnProperty(j)||n.setLayoutProperty(s,j,void 0)}if(b!==m.paint){const B=m.paint||{};for(const j in b)Gn(b[j],B[j])||n.setPaintProperty(s,j,b[j]);for(const j in B)b.hasOwnProperty(j)||n.setPaintProperty(s,j,void 0)}Gn(M,m.filter)||n.setFilter(s,M),(a!==m.minzoom||L!==m.maxzoom)&&n.setLayerZoomRange(s,a,L)}function Rw(n,s,h){if(n.style&&n.style._loaded&&n.getSource(h.source)){const m=Cl(_n({},h),{id:s});delete m.beforeId,n.addLayer(m,h.beforeId)}}let Ow=0;function GC(n){const s=Ta(Kl).map.getMap(),h=kt(n),[,m]=qn(0),v=en(()=>n.id||`jsx-layer-${Ow++}`,[]);if(gr(()=>{if(s){const M=()=>m(a=>a+1);return s.on("styledata",M),M(),()=>{s.off("styledata",M),s.style&&s.style._loaded&&s.removeLayer(v)}}},[s]),s&&s.style&&s.getLayer(v))try{Lw(s,v,n,h.current)}catch(M){console.warn(M)}else Rw(s,v,n);return h.current=n,null}var Yl=Fw,Bw=Object.prototype.hasOwnProperty;function Fw(){for(var n={},s=0;s<arguments.length;s++){var h=arguments[s];for(var m in h)Bw.call(h,m)&&(n[m]=h[m])}return n}var Fv={exports:{}};(function(n,s){(function(){var h={};n.exports=h,h.simpleFilter=function(m,v){return v.filter(function(b){return h.test(m,b)})},h.test=function(m,v){return h.match(m,v)!==null},h.match=function(m,v,b){b=b||{};var M=0,a=[],L=v.length,F=0,B=0,j=b.pre||"",q=b.post||"",G=b.caseSensitive&&v||v.toLowerCase(),he;m=b.caseSensitive&&m||m.toLowerCase();for(var be=0;be<L;be++)he=v[be],G[be]===m[M]?(he=j+he+q,M+=1,B+=1+B):B=0,F+=B,a[a.length]=he;return M===m.length?(F=G===m?1/0:F,{rendered:a.join(""),score:F}):null},h.filter=function(m,v,b){return!v||v.length===0?[]:typeof m!="string"?v:(b=b||{},v.reduce(function(M,a,L,F){var B=a;b.extract&&(B=b.extract(a));var j=h.match(m,B,b);return j!=null&&(M[M.length]={string:j.rendered,score:j.score,index:L,original:a}),M},[]).sort(function(M,a){var L=a.score-M.score;return L||M.index-a.index}))}})()})(Fv);var xn=function(n){return this.component=n,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,n.el.parentNode.insertBefore(this.wrapper,n.el.nextSibling),this};xn.prototype.show=function(){this.element.style.display="block"};xn.prototype.hide=function(){this.element.style.display="none"};xn.prototype.add=function(n){this.items.push(n)};xn.prototype.clear=function(){this.items=[],this.active=0};xn.prototype.isEmpty=function(){return!this.items.length};xn.prototype.isVisible=function(){return this.element.style.display==="block"};xn.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var n=0;n<this.items.length;n++)this.drawItem(this.items[n],this.active===n);this.show()};xn.prototype.drawItem=function(n,s){var h=document.createElement("li"),m=document.createElement("a");s&&(h.className+=" active"),m.innerHTML=n.string,h.appendChild(m),this.element.appendChild(h),h.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),h.addEventListener("mouseup",function(){this.handleMouseUp.call(this,n)}.bind(this))};xn.prototype.handleMouseUp=function(n){this.selectingListItem=!1,this.component.value(n.original),this.clear(),this.draw()};xn.prototype.move=function(n){this.active=n,this.draw()};xn.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};xn.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};xn.prototype.drawError=function(n){var s=document.createElement("li");s.innerHTML=n,this.element.appendChild(s),this.show()};var Nw=xn,Uw=Yl,jw=Fv.exports,Vw=Nw,Ni=function(n,s,h){return h=h||{},this.options=Uw({minLength:2,limit:5,filter:!0,hideOnBlur:!0},h),this.el=n,this.data=s||[],this.list=new Vw(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(m){this.handleKeyUp(m.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(m){this.handleKeyDown(m)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(m){this.handlePaste(m)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Ni.prototype.handleKeyUp=function(n){n===40||n===38||n===27||n===13||n===9||this.handleInputChange(this.el.value)};Ni.prototype.handleKeyDown=function(n){switch(n.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&n.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Ni.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Ni.prototype.handlePaste=function(n){if(n.clipboardData)this.handleInputChange(n.clipboardData.getData("Text"));else{var s=this;setTimeout(function(){s.handleInputChange(n.target.value)},100)}};Ni.prototype.handleInputChange=function(n){if(this.query=this.normalize(n),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(s){for(var h=0;h<s.length&&(this.list.add(s[h]),h!==this.options.limit-1);h++);this.list.draw()}.bind(this))};Ni.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Ni.prototype.update=function(n){this.data=n,this.handleKeyUp()};Ni.prototype.clear=function(){this.data=[],this.list.clear()};Ni.prototype.normalize=function(n){return n=n.toLowerCase(),n};Ni.prototype.match=function(n,s){return n.indexOf(s)>-1};Ni.prototype.value=function(n){if(this.selected=n,this.el.value=this.getItemValue(n),document.createEvent){var s=document.createEvent("HTMLEvents");s.initEvent("change",!0,!1),this.el.dispatchEvent(s)}else this.el.fireEvent("onchange")};Ni.prototype.getCandidates=function(n){var s={pre:"<strong>",post:"</strong>",extract:function(m){return this.getItemValue(m)}.bind(this)},h;this.options.filter?(h=jw.filter(this.query,this.data,s),h=h.map(function(m){return{original:m.original,string:this.render(m.original,m.string)}}.bind(this))):h=this.data.map(function(m){var v=this.render(m);return{original:m,string:v}}.bind(this)),n(h)};Ni.prototype.getItemValue=function(n){return n};Ni.prototype.render=function(n,s){if(s)return s;for(var h=n.original?this.getItemValue(n.original):this.getItemValue(n),m=this.normalize(h),v=m.lastIndexOf(this.query);v>-1;){var b=v+this.query.length;h=h.slice(0,v)+"<strong>"+h.slice(v,b)+"</strong>"+h.slice(b),v=m.slice(0,v).lastIndexOf(this.query)}return h};Ni.prototype.renderError=function(n){this.list.drawError(n)};var $w=Ni,Nv=$w,Gw=Nv;typeof window!="undefined"&&(window.Suggestions=Nv);var qw="Expected a function",py=0/0,Zw="[object Symbol]",Ww=/^\s+|\s+$/g,Xw=/^[-+]0x[0-9a-f]+$/i,Hw=/^0b[01]+$/i,Kw=/^0o[0-7]+$/i,Yw=parseInt,Jw=typeof oo=="object"&&oo&&oo.Object===Object&&oo,Qw=typeof self=="object"&&self&&self.Object===Object&&self,eT=Jw||Qw||Function("return this")(),tT=Object.prototype,rT=tT.toString,iT=Math.max,nT=Math.min,Ep=function(){return eT.Date.now()};function oT(n,s,h){var m,v,b,M,a,L,F=0,B=!1,j=!1,q=!0;if(typeof n!="function")throw new TypeError(qw);s=my(s)||0,$p(h)&&(B=!!h.leading,j="maxWait"in h,b=j?iT(my(h.maxWait)||0,s):b,q="trailing"in h?!!h.trailing:q);function G(xe){var Se=m,Be=v;return m=v=void 0,F=xe,M=n.apply(Be,Se),M}function he(xe){return F=xe,a=setTimeout(Ie,s),B?G(xe):M}function be(xe){var Se=xe-L,Be=xe-F,Ye=s-Se;return j?nT(Ye,b-Be):Ye}function we(xe){var Se=xe-L,Be=xe-F;return L===void 0||Se>=s||Se<0||j&&Be>=b}function Ie(){var xe=Ep();if(we(xe))return E(xe);a=setTimeout(Ie,be(xe))}function E(xe){return a=void 0,q&&m?G(xe):(m=v=void 0,M)}function ye(){a!==void 0&&clearTimeout(a),F=0,m=L=v=a=void 0}function Le(){return a===void 0?M:E(Ep())}function Re(){var xe=Ep(),Se=we(xe);if(m=arguments,v=this,L=xe,Se){if(a===void 0)return he(L);if(j)return a=setTimeout(Ie,s),G(L)}return a===void 0&&(a=setTimeout(Ie,s)),M}return Re.cancel=ye,Re.flush=Le,Re}function $p(n){var s=typeof n;return!!n&&(s=="object"||s=="function")}function sT(n){return!!n&&typeof n=="object"}function aT(n){return typeof n=="symbol"||sT(n)&&rT.call(n)==Zw}function my(n){if(typeof n=="number")return n;if(aT(n))return py;if($p(n)){var s=typeof n.valueOf=="function"?n.valueOf():n;n=$p(s)?s+"":s}if(typeof n!="string")return n===0?n:+n;n=n.replace(Ww,"");var h=Hw.test(n);return h||Kw.test(n)?Yw(n.slice(2),h?2:8):Xw.test(n)?py:+n}var lT=oT,gm={exports:{}},Ol=typeof Reflect=="object"?Reflect:null,_y=Ol&&typeof Ol.apply=="function"?Ol.apply:function(s,h,m){return Function.prototype.apply.call(s,h,m)},xd;Ol&&typeof Ol.ownKeys=="function"?xd=Ol.ownKeys:Object.getOwnPropertySymbols?xd=function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:xd=function(s){return Object.getOwnPropertyNames(s)};function cT(n){console&&console.warn&&console.warn(n)}var Uv=Number.isNaN||function(s){return s!==s};function zr(){zr.init.call(this)}gm.exports=zr;gm.exports.once=fT;zr.EventEmitter=zr;zr.prototype._events=void 0;zr.prototype._eventsCount=0;zr.prototype._maxListeners=void 0;var gy=10;function Zd(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(zr,"defaultMaxListeners",{enumerable:!0,get:function(){return gy},set:function(n){if(typeof n!="number"||n<0||Uv(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");gy=n}});zr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};zr.prototype.setMaxListeners=function(s){if(typeof s!="number"||s<0||Uv(s))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+s+".");return this._maxListeners=s,this};function jv(n){return n._maxListeners===void 0?zr.defaultMaxListeners:n._maxListeners}zr.prototype.getMaxListeners=function(){return jv(this)};zr.prototype.emit=function(s){for(var h=[],m=1;m<arguments.length;m++)h.push(arguments[m]);var v=s==="error",b=this._events;if(b!==void 0)v=v&&b.error===void 0;else if(!v)return!1;if(v){var M;if(h.length>0&&(M=h[0]),M instanceof Error)throw M;var a=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw a.context=M,a}var L=b[s];if(L===void 0)return!1;if(typeof L=="function")_y(L,this,h);else for(var F=L.length,B=Zv(L,F),m=0;m<F;++m)_y(B[m],this,h);return!0};function Vv(n,s,h,m){var v,b,M;if(Zd(h),b=n._events,b===void 0?(b=n._events=Object.create(null),n._eventsCount=0):(b.newListener!==void 0&&(n.emit("newListener",s,h.listener?h.listener:h),b=n._events),M=b[s]),M===void 0)M=b[s]=h,++n._eventsCount;else if(typeof M=="function"?M=b[s]=m?[h,M]:[M,h]:m?M.unshift(h):M.push(h),v=jv(n),v>0&&M.length>v&&!M.warned){M.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(s)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=n,a.type=s,a.count=M.length,cT(a)}return n}zr.prototype.addListener=function(s,h){return Vv(this,s,h,!1)};zr.prototype.on=zr.prototype.addListener;zr.prototype.prependListener=function(s,h){return Vv(this,s,h,!0)};function uT(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function $v(n,s,h){var m={fired:!1,wrapFn:void 0,target:n,type:s,listener:h},v=uT.bind(m);return v.listener=h,m.wrapFn=v,v}zr.prototype.once=function(s,h){return Zd(h),this.on(s,$v(this,s,h)),this};zr.prototype.prependOnceListener=function(s,h){return Zd(h),this.prependListener(s,$v(this,s,h)),this};zr.prototype.removeListener=function(s,h){var m,v,b,M,a;if(Zd(h),v=this._events,v===void 0)return this;if(m=v[s],m===void 0)return this;if(m===h||m.listener===h)--this._eventsCount===0?this._events=Object.create(null):(delete v[s],v.removeListener&&this.emit("removeListener",s,m.listener||h));else if(typeof m!="function"){for(b=-1,M=m.length-1;M>=0;M--)if(m[M]===h||m[M].listener===h){a=m[M].listener,b=M;break}if(b<0)return this;b===0?m.shift():hT(m,b),m.length===1&&(v[s]=m[0]),v.removeListener!==void 0&&this.emit("removeListener",s,a||h)}return this};zr.prototype.off=zr.prototype.removeListener;zr.prototype.removeAllListeners=function(s){var h,m,v;if(m=this._events,m===void 0)return this;if(m.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):m[s]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete m[s]),this;if(arguments.length===0){var b=Object.keys(m),M;for(v=0;v<b.length;++v)M=b[v],M!=="removeListener"&&this.removeAllListeners(M);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(h=m[s],typeof h=="function")this.removeListener(s,h);else if(h!==void 0)for(v=h.length-1;v>=0;v--)this.removeListener(s,h[v]);return this};function Gv(n,s,h){var m=n._events;if(m===void 0)return[];var v=m[s];return v===void 0?[]:typeof v=="function"?h?[v.listener||v]:[v]:h?dT(v):Zv(v,v.length)}zr.prototype.listeners=function(s){return Gv(this,s,!0)};zr.prototype.rawListeners=function(s){return Gv(this,s,!1)};zr.listenerCount=function(n,s){return typeof n.listenerCount=="function"?n.listenerCount(s):qv.call(n,s)};zr.prototype.listenerCount=qv;function qv(n){var s=this._events;if(s!==void 0){var h=s[n];if(typeof h=="function")return 1;if(h!==void 0)return h.length}return 0}zr.prototype.eventNames=function(){return this._eventsCount>0?xd(this._events):[]};function Zv(n,s){for(var h=new Array(s),m=0;m<s;++m)h[m]=n[m];return h}function hT(n,s){for(;s+1<n.length;s++)n[s]=n[s+1];n.pop()}function dT(n){for(var s=new Array(n.length),h=0;h<s.length;++h)s[h]=n[h].listener||n[h];return s}function fT(n,s){return new Promise(function(h,m){function v(M){n.removeListener(s,b),m(M)}function b(){typeof n.removeListener=="function"&&n.removeListener("error",v),h([].slice.call(arguments))}Wv(n,s,b,{once:!0}),s!=="error"&&pT(n,v,{once:!0})})}function pT(n,s,h){typeof n.on=="function"&&Wv(n,"error",s,h)}function Wv(n,s,h,m){if(typeof n.on=="function")m.once?n.once(s,h):n.on(s,h);else if(typeof n.addEventListener=="function")n.addEventListener(s,function v(b){m.once&&n.removeEventListener(s,v),h(b)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var mT={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function _T(n){var s=n.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return s?{key:s[1],value:s[2]}:null}function gT(n){var s=n.match(/<?([^>]*)>(.*)/);if(!s)return null;var h=s[1],m=s[2].split(";"),v=null,b=m.reduce(function(M,a){var L=_T(a);return L?L.key==="rel"?(v||(v=L.value),M):(M[L.key]=L.value,M):M},{});return v?{url:h,rel:v,params:b}:null}function yT(n){return n?n.split(/,\s*</).reduce(function(s,h){var m=gT(h);if(!m)return s;var v=m.rel.split(/\s+/);return v.forEach(function(b){s[b]||(s[b]={url:m.url,params:m.params})}),s},{}):{}}var vT=yT,xT=vT;function ym(n,s){this.request=n,this.headers=s.headers,this.rawBody=s.body,this.statusCode=s.statusCode;try{this.body=JSON.parse(s.body||"{}")}catch{this.body=s.body}this.links=xT(this.headers.link)}ym.prototype.hasNextPage=function(){return!!this.links.next};ym.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var bT=ym,Wd={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},yy=Wd;function wT(n){var s=n.type||yy.ERROR_HTTP,h;if(n.body)try{h=JSON.parse(n.body)}catch{h=n.body}else h=null;var m=n.message||null;m||(typeof h=="string"?m=h:h&&typeof h.message=="string"?m=h.message:s===yy.ERROR_REQUEST_ABORTED&&(m="Request aborted")),this.message=m,this.type=s,this.statusCode=n.statusCode||null,this.request=n.request,this.body=h}var TT=wT;function ET(n){var s=n.indexOf(":"),h=n.substring(0,s).trim().toLowerCase(),m=n.substring(s+1).trim();return{name:h,value:m}}function ST(n){var s={};return n&&n.trim().split(/[\r|\n]+/).forEach(function(h){var m=ET(h);s[m.name]=m.value}),s}var AT=ST,CT=bT,vy=TT,Sp=Wd,MT=AT,zd={};function IT(n){var s=zd[n.id];!s||(s.abort(),delete zd[n.id])}function kT(n,s){return new CT(n,{body:s.response,headers:MT(s.getAllResponseHeaders()),statusCode:s.status})}function xy(n){var s=n.total,h=n.loaded,m=100*h/s;return{total:s,transferred:h,percent:m}}function Xv(n,s){return new Promise(function(h,m){s.onprogress=function(M){n.emitter.emit(Sp.EVENT_PROGRESS_DOWNLOAD,xy(M))};var v=n.file;v&&(s.upload.onprogress=function(M){n.emitter.emit(Sp.EVENT_PROGRESS_UPLOAD,xy(M))}),s.onerror=function(M){m(M)},s.onabort=function(){var M=new vy({request:n,type:Sp.ERROR_REQUEST_ABORTED});m(M)},s.onload=function(){if(delete zd[n.id],s.status<200||s.status>=400){var M=new vy({request:n,body:s.response,statusCode:s.status});m(M);return}h(s)};var b=n.body;typeof b=="string"?s.send(b):b?s.send(JSON.stringify(b)):v?s.send(v):s.send(),zd[n.id]=s}).then(function(h){return kT(n,h)})}function Hv(n,s){var h=n.url(s),m=new window.XMLHttpRequest;return m.open(n.method,h),Object.keys(n.headers).forEach(function(v){m.setRequestHeader(v,n.headers[v])}),m}function zT(n){return Promise.resolve().then(function(){var s=Hv(n,n.client.accessToken);return Xv(n,s)})}var PT={browserAbort:IT,sendRequestXhr:Xv,browserSend:zT,createRequestXhr:Hv},Gp={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */(function(n,s){(function(h){var m=s,v=n&&n.exports==m&&n,b=typeof oo=="object"&&oo;(b.global===b||b.window===b)&&(h=b);var M=function(he){this.message=he};M.prototype=new Error,M.prototype.name="InvalidCharacterError";var a=function(he){throw new M(he)},L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",F=/[\t\n\f\r ]/g,B=function(he){he=String(he).replace(F,"");var be=he.length;be%4==0&&(he=he.replace(/==?$/,""),be=he.length),(be%4==1||/[^+a-zA-Z0-9/]/.test(he))&&a("Invalid character: the string to be decoded is not correctly encoded.");for(var we=0,Ie,E,ye="",Le=-1;++Le<be;)E=L.indexOf(he.charAt(Le)),Ie=we%4?Ie*64+E:E,we++%4&&(ye+=String.fromCharCode(255&Ie>>(-2*we&6)));return ye},j=function(he){he=String(he),/[^\0-\xFF]/.test(he)&&a("The string to be encoded contains characters outside of the Latin1 range.");for(var be=he.length%3,we="",Ie=-1,E,ye,Le,Re,xe=he.length-be;++Ie<xe;)E=he.charCodeAt(Ie)<<16,ye=he.charCodeAt(++Ie)<<8,Le=he.charCodeAt(++Ie),Re=E+ye+Le,we+=L.charAt(Re>>18&63)+L.charAt(Re>>12&63)+L.charAt(Re>>6&63)+L.charAt(Re&63);return be==2?(E=he.charCodeAt(Ie)<<8,ye=he.charCodeAt(++Ie),Re=E+ye,we+=L.charAt(Re>>10)+L.charAt(Re>>4&63)+L.charAt(Re<<2&63)+"="):be==1&&(Re=he.charCodeAt(Ie),we+=L.charAt(Re>>2)+L.charAt(Re<<4&63)+"=="),we},q={encode:j,decode:B,version:"0.1.0"};if(m&&!m.nodeType)if(v)v.exports=q;else for(var G in q)q.hasOwnProperty(G)&&(m[G]=q[G]);else h.base64=q})(oo)})(Gp,Gp.exports);var DT=Gp.exports,Ap={};function LT(n){if(Ap[n])return Ap[n];var s=n.split("."),h=s[0],m=s[1];if(!m)throw new Error("Invalid token");var v=RT(m),b={usage:h,user:v.u};return ma(v,"a")&&(b.authorization=v.a),ma(v,"exp")&&(b.expires=v.exp*1e3),ma(v,"iat")&&(b.created=v.iat*1e3),ma(v,"scopes")&&(b.scopes=v.scopes),ma(v,"client")&&(b.client=v.client),ma(v,"ll")&&(b.lastLogin=v.ll),ma(v,"iu")&&(b.impersonator=v.iu),Ap[n]=b,b}function RT(n){try{return JSON.parse(DT.decode(n))}catch{throw new Error("Invalid token")}}function ma(n,s){return Object.prototype.hasOwnProperty.call(n,s)}var Kv=LT,Yv={exports:{}};(function(n){var s=Object.prototype.hasOwnProperty,h="~";function m(){}Object.create&&(m.prototype=Object.create(null),new m().__proto__||(h=!1));function v(L,F,B){this.fn=L,this.context=F,this.once=B||!1}function b(L,F,B,j,q){if(typeof B!="function")throw new TypeError("The listener must be a function");var G=new v(B,j||L,q),he=h?h+F:F;return L._events[he]?L._events[he].fn?L._events[he]=[L._events[he],G]:L._events[he].push(G):(L._events[he]=G,L._eventsCount++),L}function M(L,F){--L._eventsCount===0?L._events=new m:delete L._events[F]}function a(){this._events=new m,this._eventsCount=0}a.prototype.eventNames=function(){var F=[],B,j;if(this._eventsCount===0)return F;for(j in B=this._events)s.call(B,j)&&F.push(h?j.slice(1):j);return Object.getOwnPropertySymbols?F.concat(Object.getOwnPropertySymbols(B)):F},a.prototype.listeners=function(F){var B=h?h+F:F,j=this._events[B];if(!j)return[];if(j.fn)return[j.fn];for(var q=0,G=j.length,he=new Array(G);q<G;q++)he[q]=j[q].fn;return he},a.prototype.listenerCount=function(F){var B=h?h+F:F,j=this._events[B];return j?j.fn?1:j.length:0},a.prototype.emit=function(F,B,j,q,G,he){var be=h?h+F:F;if(!this._events[be])return!1;var we=this._events[be],Ie=arguments.length,E,ye;if(we.fn){switch(we.once&&this.removeListener(F,we.fn,void 0,!0),Ie){case 1:return we.fn.call(we.context),!0;case 2:return we.fn.call(we.context,B),!0;case 3:return we.fn.call(we.context,B,j),!0;case 4:return we.fn.call(we.context,B,j,q),!0;case 5:return we.fn.call(we.context,B,j,q,G),!0;case 6:return we.fn.call(we.context,B,j,q,G,he),!0}for(ye=1,E=new Array(Ie-1);ye<Ie;ye++)E[ye-1]=arguments[ye];we.fn.apply(we.context,E)}else{var Le=we.length,Re;for(ye=0;ye<Le;ye++)switch(we[ye].once&&this.removeListener(F,we[ye].fn,void 0,!0),Ie){case 1:we[ye].fn.call(we[ye].context);break;case 2:we[ye].fn.call(we[ye].context,B);break;case 3:we[ye].fn.call(we[ye].context,B,j);break;case 4:we[ye].fn.call(we[ye].context,B,j,q);break;default:if(!E)for(Re=1,E=new Array(Ie-1);Re<Ie;Re++)E[Re-1]=arguments[Re];we[ye].fn.apply(we[ye].context,E)}}return!0},a.prototype.on=function(F,B,j){return b(this,F,B,j,!1)},a.prototype.once=function(F,B,j){return b(this,F,B,j,!0)},a.prototype.removeListener=function(F,B,j,q){var G=h?h+F:F;if(!this._events[G])return this;if(!B)return M(this,G),this;var he=this._events[G];if(he.fn)he.fn===B&&(!q||he.once)&&(!j||he.context===j)&&M(this,G);else{for(var be=0,we=[],Ie=he.length;be<Ie;be++)(he[be].fn!==B||q&&!he[be].once||j&&he[be].context!==j)&&we.push(he[be]);we.length?this._events[G]=we.length===1?we[0]:we:M(this,G)}return this},a.prototype.removeAllListeners=function(F){var B;return F?(B=h?h+F:F,this._events[B]&&M(this,B)):(this._events=new m,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=h,a.EventEmitter=a,n.exports=a})(Yv);function OT(n){return n.map(encodeURIComponent).join(",")}function Jv(n){return Array.isArray(n)?OT(n):encodeURIComponent(String(n))}function Qv(n,s,h){if(h===!1||h===null)return n;var m=/\?/.test(n)?"&":"?",v=encodeURIComponent(s);return h!==void 0&&h!==""&&h!==!0&&(v+="="+Jv(h)),""+n+m+v}function BT(n,s){if(!s)return n;var h=n;return Object.keys(s).forEach(function(m){var v=s[m];v!==void 0&&(Array.isArray(v)&&(v=v.filter(function(b){return b!=null}).join(",")),h=Qv(h,m,v))}),h}function FT(n,s){if(!s||n.slice(0,4)==="http")return n;var h=n[0]==="/"?"":"/";return""+s.replace(/\/$/,"")+h+n}function NT(n,s){return s?n.replace(/\/:([a-zA-Z0-9]+)/g,function(h,m){var v=s[m];if(v===void 0)throw new Error("Unspecified route parameter "+m);var b=Jv(v);return"/"+b}):n}var UT={appendQueryObject:BT,appendQueryParam:Qv,prependOrigin:FT,interpolateRouteParams:NT},jT=Kv,vm=Yl,VT=Yv.exports,ed=UT,by=Wd,$T=1;function Is(n,s){if(!n)throw new Error("MapiRequest requires a client");if(!s||!s.path||!s.method)throw new Error("MapiRequest requires an options object with path and method properties");var h={};s.body&&(h["content-type"]="application/json");var m=vm(h,s.headers),v=Object.keys(m).reduce(function(b,M){return b[M.toLowerCase()]=m[M],b},{});this.id=$T++,this._options=s,this.emitter=new VT,this.client=n,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=s.path,this.method=s.method,this.origin=s.origin||n.origin,this.query=s.query||{},this.params=s.params||{},this.body=s.body||null,this.file=s.file||null,this.encoding=s.encoding||"utf8",this.sendFileAs=s.sendFileAs||null,this.headers=v}Is.prototype.url=function(s){var h=ed.prependOrigin(this.path,this.origin);h=ed.appendQueryObject(h,this.query);var m=this.params,v=s==null?this.client.accessToken:s;if(v){h=ed.appendQueryParam(h,"access_token",v);var b=jT(v).user;m=vm({ownerId:b},m)}return h=ed.interpolateRouteParams(h,m),h};Is.prototype.send=function(){var s=this;if(s.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return s.sent=!0,s.client.sendRequest(s).then(function(h){return s.response=h,s.emitter.emit(by.EVENT_RESPONSE,h),h},function(h){throw s.error=h,s.emitter.emit(by.EVENT_ERROR,h),h})};Is.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Is.prototype.eachPage=function(s){var h=this;function m(M){function a(){delete h._nextPageRequest;var L=M.nextPage();L&&(h._nextPageRequest=L,b(L))}s(null,M,a)}function v(M){s(M,null,function(){})}function b(M){M.send().then(m,v)}b(this)};Is.prototype.clone=function(){return this._extend()};Is.prototype._extend=function(s){var h=vm(this._options,s);return new Is(this.client,h)};var GT=Is,qT=Kv,ZT=GT,WT=Wd;function ex(n){if(!n||!n.accessToken)throw new Error("Cannot create a client without an access token");qT(n.accessToken),this.accessToken=n.accessToken,this.origin=n.origin||WT.API_ORIGIN}ex.prototype.createRequest=function(s){return new ZT(this,s)};var tx=ex,rx=PT,ix=tx;function Gl(n){ix.call(this,n)}Gl.prototype=Object.create(ix.prototype);Gl.prototype.constructor=Gl;Gl.prototype.sendRequest=rx.browserSend;Gl.prototype.abortRequest=rx.browserAbort;function XT(n){return new Gl(n)}var nx=XT,HT=nx,KT=HT,YT=Object.prototype.toString,JT=function(n){var s;return YT.call(n)==="[object Object]"&&(s=Object.getPrototypeOf(n),s===null||s===Object.getPrototypeOf({}))},QT=JT,e2=Yl,ox="value",Cp=`
  `,Ur={};Ur.assert=function(n,s){return s=s||{},function(h){var m=ks(n,h);if(!!m){var v=xm(m,s);throw s.apiName&&(v=s.apiName+": "+v),new Error(v)}}};Ur.shape=function(s){var h=n2(s);return function(v){var b=ks(Ur.plainObject,v);if(b)return b;for(var M,a,L=[],F=0;F<h.length;F++)M=h[F].key,a=h[F].value,b=ks(a,v[M]),b&&L.push([M].concat(b));return L.length<2?L[0]:function(B){L=L.map(function(G){var he=G[0],be=xm(G,B).split(`
`).join(Cp);return"- "+he+": "+be});var j=B.path.join("."),q=j===ox?"":" of "+j;return"The following properties"+q+" have invalid values:"+Cp+L.join(Cp)}}};Ur.strictShape=function(s){var h=Ur.shape(s);return function(v){var b=h(v);if(b)return b;var M=Object.keys(v).reduce(function(a,L){return s[L]===void 0&&a.push(L),a},[]);if(M.length!==0)return function(){return"The following keys are invalid: "+M.join(", ")}}};Ur.arrayOf=function(s){return sx(s)};Ur.tuple=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return sx(s)};function sx(n){var s=Array.isArray(n),h=function(m){return s?n[m]:n};return function(v){var b=ks(Ur.plainArray,v);if(b)return b;if(s&&v.length!==n.length)return"an array with "+n.length+" items";for(var M=0;M<v.length;M++)if(b=ks(h(M),v[M]),b)return[M].concat(b)}}Ur.required=function(s){function h(m){return m==null?function(v){return ax(v,lx(v.path)?"cannot be undefined/null.":"is required.")}:s.apply(this,arguments)}return h.__required=!0,h};Ur.oneOfType=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(m){var v=s.map(function(b){return ks(b,m)}).filter(Boolean);if(v.length===s.length)return v.every(function(b){return b.length===1&&typeof b[0]=="string"})?t2(v.map(function(b){return b[0]})):v.reduce(function(b,M){return M.length>b.length?M:b})}};Ur.equal=function(s){return function(m){if(m!==s)return JSON.stringify(s)}};Ur.oneOf=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),h=s.map(function(m){return Ur.equal(m)});return Ur.oneOfType.apply(this,h)};Ur.range=function(s){var h=s[0],m=s[1];return function(b){var M=ks(Ur.number,b);if(M||b<h||b>m)return"number between "+h+" & "+m+" (inclusive)"}};Ur.any=function(){};Ur.boolean=function(s){if(typeof s!="boolean")return"boolean"};Ur.number=function(s){if(typeof s!="number")return"number"};Ur.plainArray=function(s){if(!Array.isArray(s))return"array"};Ur.plainObject=function(s){if(!QT(s))return"object"};Ur.string=function(s){if(typeof s!="string")return"string"};Ur.func=function(s){if(typeof s!="function")return"function"};function ks(n,s){if(!(s==null&&!n.hasOwnProperty("__required"))){var h=n(s);if(h)return Array.isArray(h)?h:[h]}}function xm(n,s){var h=n.length,m=n[h-1],v=n.slice(0,h-1);return v.length===0&&(v=[ox]),s=e2(s,{path:v}),typeof m=="function"?m(s):ax(s,r2(m))}function t2(n){return n.length<2?n[0]:n.length===2?n.join(" or "):n.slice(0,-1).join(", ")+", or "+n.slice(-1)}function r2(n){return"must be "+i2(n)+"."}function i2(n){return/^an? /.test(n)?n:/^[aeiou]/i.test(n)?"an "+n:/^[a-z]/i.test(n)?"a "+n:n}function ax(n,s){var h=lx(n.path),m=n.path.join(".")+" "+s,v=h?"Item at position ":"";return v+m}function lx(n){return typeof n[n.length-1]=="number"||typeof n[0]=="number"}function n2(n){return Object.keys(n||{}).map(function(s){return{key:s,value:n[s]}})}Ur.validate=ks;Ur.processMessage=xm;var o2=Ur,s2=Yl,Bl=o2;function a2(n){if(typeof window!="undefined")return n instanceof oo.Blob||n instanceof oo.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof n=="string"||n.pipe!==void 0))return"Filename or Readable stream"}function l2(n,s){return Bl.assert(Bl.strictShape(n),s)}function c2(n){var s="date";if(typeof n=="boolean")return s;try{var h=new Date(n);if(h.getTime&&isNaN(h.getTime()))return s}catch{return s}}function u2(n){return Bl.tuple(Bl.number,Bl.number)(n)}var h2=s2(Bl,{file:a2,date:c2,coordinates:u2,assertShape:l2});function d2(n,s){var h=function(m,v){return s.indexOf(m)!==-1&&v!==void 0};return typeof s=="function"&&(h=s),Object.keys(n).filter(function(m){return h(m,n[m])}).reduce(function(m,v){return m[v]=n[v],m},{})}var f2=d2;function p2(n,s){return Object.keys(n).reduce(function(h,m){return h[m]=s(m,n[m]),h},{})}var m2=p2,_2=m2;function g2(n){return _2(n,function(s,h){return typeof h=="boolean"?JSON.stringify(h):h})}var y2=g2,v2=tx,x2=nx;function b2(n){return function(s){var h;v2.prototype.isPrototypeOf(s)?h=s:h=x2(s);var m=Object.create(n);return m.client=h,m}}var w2=b2,cx=Yl,or=h2,Pd=f2,ux=y2,T2=w2,bm={},hx=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];bm.forwardGeocode=function(n){or.assertShape({query:or.required(or.string),mode:or.oneOf("mapbox.places","mapbox.places-permanent"),countries:or.arrayOf(or.string),proximity:or.oneOf(or.coordinates,"ip"),types:or.arrayOf(or.oneOf(hx)),autocomplete:or.boolean,bbox:or.arrayOf(or.number),limit:or.number,language:or.arrayOf(or.string),routing:or.boolean,fuzzyMatch:or.boolean,worldview:or.string})(n),n.mode=n.mode||"mapbox.places";var s=ux(cx({country:n.countries},Pd(n,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Pd(n,["mode","query"]),query:s})};bm.reverseGeocode=function(n){or.assertShape({query:or.required(or.coordinates),mode:or.oneOf("mapbox.places","mapbox.places-permanent"),countries:or.arrayOf(or.string),types:or.arrayOf(or.oneOf(hx)),bbox:or.arrayOf(or.number),limit:or.number,language:or.arrayOf(or.string),reverseMode:or.oneOf("distance","score"),routing:or.boolean,worldview:or.string})(n),n.mode=n.mode||"mapbox.places";var s=ux(cx({country:n.countries},Pd(n,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Pd(n,["mode","query"]),query:s})};var E2=T2(bm);let S2="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",dx=n=>crypto.getRandomValues(new Uint8Array(n)),fx=(n,s,h)=>{let m=(2<<Math.log(n.length-1)/Math.LN2)-1,v=-~(1.6*m*s/n.length);return(b=s)=>{let M="";for(;;){let a=h(v),L=v;for(;L--;)if(M+=n[a[L]&m]||"",M.length===b)return M}}},A2=(n,s=21)=>fx(n,s,dx),C2=(n=21)=>{let s="",h=crypto.getRandomValues(new Uint8Array(n));for(;n--;){let m=h[n]&63;m<36?s+=m.toString(36):m<62?s+=(m-26).toString(36).toUpperCase():m<63?s+="_":s+="-"}return s};var M2=Object.freeze(Object.defineProperty({__proto__:null,nanoid:C2,customAlphabet:A2,customRandom:fx,urlAlphabet:S2,random:dx},Symbol.toStringTag,{value:"Module"})),I2=Av(M2),k2=I2.nanoid;function px(n){this.origin=n.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=n.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=n,this.send=this.send.bind(this),this.countries=n.countries?n.countries.split(","):null,this.types=n.types?n.types.split(","):null,this.bbox=n.bbox?n.bbox:null,this.language=n.language?n.language.split(","):null,this.limit=n.limit?+n.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(n),this.eventQueue=new Array,this.flushInterval=n.flushInterval||1e3,this.maxQueueSize=n.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}px.prototype={select:function(n,s){var h=this.getSelectedIndex(n,s),m=this.getEventPayload("search.select",s);if(m.resultIndex=h,m.resultPlaceName=n.place_name,m.resultId=n.id,!(h===this.lastSentIndex&&m.queryString===this.lastSentInput||h==-1)&&(this.lastSentIndex=h,this.lastSentInput=m.queryString,!!m.queryString))return this.push(m)},start:function(n){var s=this.getEventPayload("search.start",n);if(!!s.queryString)return this.push(s)},keyevent:function(n,s){if(!!n.key&&!(n.metaKey||[9,27,37,39,13,38,40].indexOf(n.keyCode)!==-1)){var h=this.getEventPayload("search.keystroke",s);if(h.lastAction=n.key,!!h.queryString)return this.push(h)}},send:function(n,s){if(!this.enableEventLogging)return s?s():void 0;var h=this.getRequestOptions(n);this.request(h,function(m){if(m)return this.handleError(m,s);if(s)return s()}.bind(this))},getRequestOptions:function(n){Array.isArray(n)||(n=[n]);var s={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(n)};return s},getEventPayload:function(n,s){var h;s.options.proximity?h=[s.options.proximity.longitude,s.options.proximity.latitude]:h=null;var m=s._map?s._map.getZoom():void 0,v={event:n,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:s.options.autocomplete,fuzzyMatch:s.options.fuzzyMatch,proximity:h,limit:s.options.limit,routing:s.options.routing,worldview:s.options.worldview,mapZoom:m,keyboardLocale:this.locale};return n==="search.select"?v.queryString=s.inputString:n!="search.select"&&s._inputEl?v.queryString=s._inputEl.value:v.queryString=s.inputString,v},request:function(n,s){var h=new XMLHttpRequest;h.onreadystatechange=function(){if(this.readyState==4)return this.status==204?s(null):s(this.statusText)},h.open(n.method,n.host+"/"+n.path,!0);for(var m in n.headers){var v=n.headers[m];h.setRequestHeader(m,v)}h.send(n.body)},handleError:function(n,s){if(s)return s(n)},generateSessionID:function(){return k2()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(n,s){if(!!s._typeahead){var h=s._typeahead.data,m=n.id,v=h.map(function(M){return M.id}),b=v.indexOf(m);return b}},shouldEnableLogging:function(n){return!(n.enableEventLogging===!1||n.origin&&n.origin.indexOf("api.mapbox.com")==-1||n.localGeocoder||n.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(n,s){this.eventQueue.push(n),(this.eventQueue.length>=this.maxQueueSize||s)&&this.flush()},remove:function(){this.flush()}};var z2=px,P2={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05DC\u05D7\u05E4\u05E9",ja:"\u30B5\u30FC\u30C1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041F\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641C\u7D22",cs:"Vyhled\xE1v\xE1n\xED",hu:"Keres\xE9s",ka:"\u10EB\u10D8\u10D4\u10D1\u10D0",nb:"S\xF8ke",sk:"Vyh\u013Ead\xE1vanie",th:"\u0E04\u0E49\u0E19\u0E2B\u0E32",fi:"Hae",is:"Leita",ko:"\uC218\uC0C9",pl:"Szukaj",sl:"Iskanje",fa:"\u062C\u0633\u062A\u062C\u0648",ru:"\u041F\u043E\u0438\u0441\u043A"},D2={placeholder:P2},mx={exports:{}};(function(n){(function(s,h,m){n.exports?n.exports=m():s[h]=m()})(oo,"subtag",function(){var s="",h=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function m(L){return L.match(h)||[]}function v(L){return m(L).filter(function(F,B){return F&&B})}function b(L){return L=m(L),{language:L[1]||s,extlang:L[2]||s,script:L[3]||s,region:L[4]||s}}function M(L,F,B){Object.defineProperty(L,F,{value:B,enumerable:!0})}function a(L,F,B){function j(q){return m(q)[L]||s}M(j,"pattern",F),M(b,B,j)}return a(1,/^[a-zA-Z]{2,3}$/,"language"),a(2,/^[a-zA-Z]{3}$/,"extlang"),a(3,/^[a-zA-Z]{4}$/,"script"),a(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),M(b,"split",v),b})})(mx);function _x(){}_x.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const n={enableHighAccuracy:!0};return new Promise(function(s,h){window.navigator.geolocation.getCurrentPosition(s,h,n)})}};var L2=_x;function R2(n,s){const h=gx(n),m=["address","street","place","country"];var v;if(typeof s=="function")return s(h);const b=m.indexOf(s);return b===-1?v=m:v=m.slice(b),v.reduce(function(M,a){return h[a]?(M!==""&&(M=M+", "),M+h[a]):M},"")}function gx(n){const s=n.address||"",h=n.text||"",m=n.place_name||"",b={address:m.split(",")[0],houseNumber:s,street:h,placeName:m};return n.context.forEach(function(M){const a=M.id.split(".")[0];b[a]=M.text}),b}var O2={transformFeatureToGeolocationText:R2,getAddressInfo:gx},B2=Gw,F2=lT,ga=Yl,N2=gm.exports.EventEmitter,wy=mT,Mp=KT,Ip=E2,U2=z2,j2=D2,V2=mx.exports,$2=L2,G2=O2;const Ss={FORWARD:0,LOCAL:1,REVERSE:2};function q2(){var n=document.createElement("div");return n.className="mapboxgl-ctrl-geocoder--powered-by",n.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',n}function yx(n){this._eventEmitter=new N2,this.options=ga({},this.options,n),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new $2}yx.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(n){return n.place_name},render:function(n){var s=n.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+s[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+s.splice(1,s.length).join(",")+"</div></div>"}},addTo:function(n){function s(h,m){if(!document.body.contains(m))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const v=h.onAdd();m.appendChild(v)}if(n._controlContainer)n.addControl(this);else if(n instanceof HTMLElement)s(this,n);else if(typeof n=="string"){const h=document.querySelectorAll(n);if(h.length===0)throw new Error("Element ",n,"not found.");if(h.length>1)throw new Error("Geocoder can only be added to a single html element");s(this,h[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(n){if(n&&typeof n!="string"&&(this._map=n),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Ip(Mp({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new U2(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var s=this.container=document.createElement("div");s.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var h=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",F2(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(a){this.eventManager.keyevent(a,this)}.bind(this));var m=document.createElement("div");m.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var v=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');this._clearEl.appendChild(v),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),m.appendChild(this._clearEl),m.appendChild(this._loadingEl),s.appendChild(h),s.appendChild(this._inputEl),s.appendChild(m),this.options.enableGeolocation&&this.geolocation.isSupport()&&(this._geolocateEl=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>'),m.appendChild(this._geolocateEl),this._geolocateEl.addEventListener("click",this._geolocateUser),this._showGeolocateButton());var b=this._typeahead=new B2(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),b.getItemValue=this.options.getItemValue;var M=b.list.draw;return b.list.draw=function(){M.call(this);var a=q2();a.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),a.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(a)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),s},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(n){this._hideLoadingIcon();const s={geometry:{type:"Point",coordinates:[n.coords.longitude,n.coords.latitude]}};this._handleMarker(s),this._fly(s),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(s),this._showClearButton(),this.fresh=!1;const h={limit:1,language:[this.options.language],query:s.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const m=s.geometry.coordinates[0]+","+s.geometry.coordinates[1];this._setInputValue(m),this._eventEmitter.emit("result",{result:s})}else this.geocoderService.reverseGeocode(h).send().then(function(m){const v=m.body.features[0];if(v){const b=G2.transformFeatureToGeolocationText(v,this.options.addressAccuracy);this._setInputValue(b),v.user_coordinates=s.geometry.coordinates,this._eventEmitter.emit("result",{result:v})}else this._eventEmitter.emit("result",{result:{user_coordinates:s.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(n){n.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton()}.bind(this))},createIcon:function(n,s){var h=document.createElementNS("http://www.w3.org/2000/svg","svg");return h.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+n),h.setAttribute("viewBox","0 0 18 18"),h.setAttribute("xml:space","preserve"),h.setAttribute("width",18),h.setAttribute("height",18),h.innerHTML=s,h},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(n){this._inputEl.value=n,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(n){var s=(n.clipboardData||window.clipboardData).getData("text");s.length>=this.options.minLength&&this._geocode(s)},_onKeyDown:function(n){var s=27,h=9;if(n.keyCode===s&&this.options.clearAndBlurOnEsc)return this._clear(n),this._inputEl.blur();var m=n.target&&n.target.shadowRoot?n.target.shadowRoot.activeElement:n.target,v=m?m.value:"";if(!v)return this.fresh=!0,n.keyCode!==h&&this.clear(n),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(n.metaKey||[h,s,37,39,13,38,40].indexOf(n.keyCode)!==-1)&&m.value.length>=this.options.minLength&&this._geocode(m.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_onBlur:function(n){this.options.clearOnBlur&&this._clearOnBlur(n),this.options.collapsed&&this._collapse()},_onChange:function(){var n=this._typeahead.selected;n&&JSON.stringify(n)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(n),this.options.marker&&this._mapboxgl&&this._handleMarker(n),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(n),this._eventEmitter.emit("result",{result:n}),this.eventManager.select(n,this))},_fly:function(n){var s;if(n.properties&&wy[n.properties.short_code])s=ga({},this.options.flyTo),this._map&&this._map.fitBounds(wy[n.properties.short_code].bbox,s);else if(n.bbox){var h=n.bbox;s=ga({},this.options.flyTo),this._map&&this._map.fitBounds([[h[0],h[1]],[h[2],h[3]]],s)}else{var m={zoom:this.options.zoom};s=ga({},m,this.options.flyTo),n.center?s.center=n.center:n.geometry&&n.geometry.type&&n.geometry.type==="Point"&&n.geometry.coordinates&&(s.center=n.geometry.coordinates),this._map&&this._map.flyTo(s)}},_requestType:function(n,s){var h;const m=/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;return n.localGeocoderOnly?h=Ss.LOCAL:n.reverseGeocode&&m.test(s)?h=Ss.REVERSE:h=Ss.FORWARD,h},_setupConfig:function(n,s){const h=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],m=/[\s,]+/;var v=this,b=h.reduce(function(a,L){if(v.options[L]===void 0||v.options[L]===null)return a;["countries","types","language"].indexOf(L)>-1?a[L]=v.options[L].split(m):a[L]=v.options[L];const F=typeof v.options[L].longitude=="number"&&typeof v.options[L].latitude=="number";if(L==="proximity"&&F){const B=v.options[L].longitude,j=v.options[L].latitude;a[L]=[B,j]}return a},{});switch(n){case Ss.REVERSE:{var M=s.split(m).map(function(a){return parseFloat(a,10)});v.options.flipCoordinates||M.reverse(),b.types&&b.types[0],b=ga(b,{query:M,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(a){a in b&&delete b[a]})}break;case Ss.FORWARD:/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)*[ ]*$/.test(s)&&(s=s.replace(/,/g," ")),b=ga(b,{query:s});break}return b},_geocode:function(n){this.inputString=n,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:n});const s=this._requestType(this.options,n),h=this._setupConfig(s,n);var m;switch(s){case Ss.LOCAL:m=Promise.resolve();break;case Ss.FORWARD:m=this.geocoderService.forwardGeocode(h).send();break;case Ss.REVERSE:m=this.geocoderService.reverseGeocode(h).send();break}var v=this.options.localGeocoder?this.options.localGeocoder(n)||[]:[],b=[],M=null;return m.catch(function(a){M=a}.bind(this)).then(function(a){this._hideLoadingIcon();var L={};return a?a.statusCode=="200"&&(L=a.body,L.request=a.request,L.headers=a.headers):L={type:"FeatureCollection",features:[]},L.config=h,this.fresh&&(this.eventManager.start(this),this.fresh=!1),L.features=L.features?v.concat(L.features):v,this.options.externalGeocoder?(b=this.options.externalGeocoder(n,L.features)||Promise.resolve([]),b.then(function(F){return L.features=L.features?F.concat(L.features):F,L},function(){return L})):L}.bind(this)).then(function(a){if(M)throw M;this.options.filter&&a.features.length&&(a.features=a.features.filter(this.options.filter)),a.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._eventEmitter.emit("results",a),this._typeahead.update(a.features)):(this._hideClearButton(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",a))}.bind(this)).catch(function(a){this._hideLoadingIcon(),v.length&&this.options.localGeocoder||b.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(v)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:v}),this._eventEmitter.emit("error",{error:a})}.bind(this)),m},_clear:function(n){n&&n.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(n){this._clear(n),this._inputEl.focus()},_clearOnBlur:function(n){var s=this;n.relatedTarget&&s._clear(n)},_onQueryResult:function(n){var s=n.body;if(!!s.features.length){var h=s.features[0];this._typeahead.selected=h,this._inputEl.value=h.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var n=this._map.getCenter().wrap();this.setProximity({longitude:n.lng,latitude:n.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(n){return this._geocode(n).then(this._onQueryResult),this},_renderError:function(){var n="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(n)},_renderLocationError:function(){var n="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(n)},_renderNoResults:function(){var n="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(n)},_renderUserDeniedGeolocationError:function(){var n="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(n)},_renderMessage:function(n){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(n)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var n=this.options.language.split(",")[0],s=V2.language(n),h=j2.placeholder[s];if(h)return h}return"Search"},setInput:function(n){return this._inputEl.value=n,this._typeahead.selected=null,this._typeahead.clear(),n.length>=this.options.minLength&&this._geocode(n),this},setProximity:function(n,s=!0){return this.options.proximity=n,s&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(n){return n&&typeof n=="function"&&(this._typeahead.render=n),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(n){var s=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=n||this.options.language||s,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(n){return this.options.zoom=n,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(n){return this.options.flyTo=n,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(n){return this.placeholder=n||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(n){return this.options.bbox=n,this},getCountries:function(){return this.options.countries},setCountries:function(n){return this.options.countries=n,this},getTypes:function(){return this.options.types},setTypes:function(n){return this.options.types=n,this},getMinLength:function(){return this.options.minLength},setMinLength:function(n){return this.options.minLength=n,this._typeahead&&(this._typeahead.options.minLength=n),this},getLimit:function(){return this.options.limit},setLimit:function(n){return this.options.limit=n,this._typeahead&&(this._typeahead.options.limit=n),this},getFilter:function(){return this.options.filter},setFilter:function(n){return this.options.filter=n,this},setOrigin:function(n){return this.options.origin=n,this.geocoderService=Ip(Mp({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(n){return this.options.accessToken=n,this.geocoderService=Ip(Mp({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(n){return this.options.autocomplete=n,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(n){return this.options.fuzzyMatch=n,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(n){return this.options.routing=n,this},getRouting:function(){return this.options.routing},setWorldview:function(n){return this.options.worldview=n,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(n){if(!!this._map){this._removeMarker();var s={color:"#4668F2"},h=ga({},s,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(h),n.center?this.mapMarker.setLngLat(n.center).addTo(this._map):n.geometry&&n.geometry.type&&n.geometry.type==="Point"&&n.geometry.coordinates&&this.mapMarker.setLngLat(n.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(n,s){return this._eventEmitter.on(n,s),this},off:function(n,s){return this._eventEmitter.removeListener(n,s),this.eventManager.remove(),this}};var qC=yx,Z2=function(s){var h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},v=void 0,b=void 0,M=void 0,a=[];return function(){var B=W2(h),j=new Date().getTime(),q=!v||j-v>B;v=j;for(var G=arguments.length,he=Array(G),be=0;be<G;be++)he[be]=arguments[be];if(q&&m.leading)return m.accumulate?Promise.resolve(s.call(this,[he])).then(function(Ie){return Ie[0]}):Promise.resolve(s.call.apply(s,[this].concat(he)));if(b?clearTimeout(M):b=X2(),a.push(he),M=setTimeout(L.bind(this),B),m.accumulate){var we=a.length-1;return b.promise.then(function(Ie){return Ie[we]})}return b.promise};function L(){var F=b;clearTimeout(M),Promise.resolve(m.accumulate?s.call(this,a):s.apply(this,a[a.length-1])).then(F.resolve,F.reject),a=[],b=null}};function W2(n){return typeof n=="function"?n():n}function X2(){var n={};return n.promise=new Promise(function(s,h){n.resolve=s,n.reject=h}),n}function H2(n){var s=null,h=null,m=new Promise(function(v,b){s=v,h=b});return n&&n.then(function(v){s&&s(v)},function(v){h&&h(v)}),{promise:m,resolve:function(v){s&&s(v)},reject:function(v){h&&h(v)},cancel:function(){s=null,h=null}}}function K2(n){var s=null,h=function(){for(var m=[],v=0;v<arguments.length;v++)m[v]=arguments[v];s&&s();var b=n.apply(void 0,m),M=H2(b),a=M.promise,L=M.cancel;return s=L,a};return h}/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var qp=function(){return qp=Object.assign||function(s){for(var h,m=1,v=arguments.length;m<v;m++){h=arguments[m];for(var b in h)Object.prototype.hasOwnProperty.call(h,b)&&(s[b]=h[b])}return s},qp.apply(this,arguments)},Y2={key:function(){for(var n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];return null},onlyResolvesLast:!0},J2=function(){function n(s){this.config=s,this.debounceSingleton=null,this.debounceCache={}}return n.prototype._createDebouncedFunction=function(){var s=Z2(this.config.func,this.config.wait,this.config.options);return this.config.options.onlyResolvesLast&&(s=K2(s)),{func:s}},n.prototype.getDebouncedFunction=function(s){var h,m=(h=this.config.options).key.apply(h,s);return m===null||typeof m=="undefined"?(this.debounceSingleton||(this.debounceSingleton=this._createDebouncedFunction()),this.debounceSingleton):(this.debounceCache[m]||(this.debounceCache[m]=this._createDebouncedFunction()),this.debounceCache[m])},n}();function ZC(n,s,h){var m=qp({},Y2,h),v=new J2({func:n,wait:s,options:m}),b=function(){for(var M=[],a=0;a<arguments.length;a++)M[a]=arguments[a];var L=v.getDebouncedFunction(M).func;return L.apply(void 0,M)};return b}var Q2=eE()?Xl:gr;function eE(){return!!(typeof window!="undefined"&&window.document&&window.document.createElement)}function tE(){var n=qn(Object.create(null)),s=n[1];return ur(function(){s(Object.create(null))},[])}var rE=function(s){var h=s.children,m=s.type,v=m===void 0?"reach-portal":m,b=kt(null),M=kt(null),a=tE();return Q2(function(){if(!!b.current){var L=b.current.ownerDocument;return M.current=L==null?void 0:L.createElement(v),L.body.appendChild(M.current),a(),function(){M.current&&M.current.ownerDocument&&M.current.ownerDocument.body.removeChild(M.current)}}},[v,a]),M.current?qd(h,M.current):vn("span",{ref:b})};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var st=function(){return st=Object.assign||function(s){for(var h,m=1,v=arguments.length;m<v;m++){h=arguments[m];for(var b in h)Object.prototype.hasOwnProperty.call(h,b)&&(s[b]=h[b])}return s},st.apply(this,arguments)};function wm(n,s){var h={};for(var m in n)Object.prototype.hasOwnProperty.call(n,m)&&s.indexOf(m)<0&&(h[m]=n[m]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var v=0,m=Object.getOwnPropertySymbols(n);v<m.length;v++)s.indexOf(m[v])<0&&Object.prototype.propertyIsEnumerable.call(n,m[v])&&(h[m[v]]=n[m[v]]);return h}function hr(n){var s=typeof Symbol=="function"&&Symbol.iterator,h=s&&n[s],m=0;if(h)return h.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&m>=n.length&&(n=void 0),{value:n&&n[m++],done:!n}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function Er(n,s){var h=typeof Symbol=="function"&&n[Symbol.iterator];if(!h)return n;var m=h.call(n),v,b=[],M;try{for(;(s===void 0||s-- >0)&&!(v=m.next()).done;)b.push(v.value)}catch(a){M={error:a}}finally{try{v&&!v.done&&(h=m.return)&&h.call(m)}finally{if(M)throw M.error}}return b}function ii(n,s,h){if(h||arguments.length===2)for(var m=0,v=s.length,b;m<v;m++)(b||!(m in s))&&(b||(b=Array.prototype.slice.call(s,0,m)),b[m]=s[m]);return n.concat(b||Array.prototype.slice.call(s))}var Pr;(function(n){n.Start="xstate.start",n.Stop="xstate.stop",n.Raise="xstate.raise",n.Send="xstate.send",n.Cancel="xstate.cancel",n.NullEvent="",n.Assign="xstate.assign",n.After="xstate.after",n.DoneState="done.state",n.DoneInvoke="done.invoke",n.Log="xstate.log",n.Init="xstate.init",n.Invoke="xstate.invoke",n.ErrorExecution="error.execution",n.ErrorCommunication="error.communication",n.ErrorPlatform="error.platform",n.ErrorCustom="xstate.error",n.Update="xstate.update",n.Pure="xstate.pure",n.Choose="xstate.choose"})(Pr||(Pr={}));var wu;(function(n){n.Parent="#_parent",n.Internal="#_internal"})(wu||(wu={}));var Zp=Pr.Start,Tm=Pr.Stop,Xd=Pr.Raise,Hd=Pr.Send,vx=Pr.Cancel,iE=Pr.NullEvent,Wp=Pr.Assign;Pr.After;Pr.DoneState;var xx=Pr.Log,nE=Pr.Init,Xp=Pr.Invoke;Pr.ErrorExecution;var Ty=Pr.ErrorPlatform,oE=Pr.ErrorCustom,bx=Pr.Update,sE=Pr.Choose,aE=Pr.Pure,wx=".",Ey={},Hp="xstate.guard",lE="",Jc=!0,td;function Em(n,s,h){h===void 0&&(h=wx);var m=uu(n,h),v=uu(s,h);return wr(v)?wr(m)?v===m:!1:wr(m)?m in v:Object.keys(m).every(function(b){return b in v?Em(m[b],v[b]):!1})}function Tx(n){try{return wr(n)||typeof n=="number"?"".concat(n):n.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function Kp(n,s){try{return Jl(n)?n:n.toString().split(s)}catch{throw new Error("'".concat(n,"' is not a valid state path."))}}function cE(n){return typeof n=="object"&&"value"in n&&"context"in n&&"event"in n&&"_event"in n}function uu(n,s){if(cE(n))return n.value;if(Jl(n))return Dd(n);if(typeof n!="string")return n;var h=Kp(n,s);return Dd(h)}function Dd(n){if(n.length===1)return n[0];for(var s={},h=s,m=0;m<n.length-1;m++)m===n.length-2?h[n[m]]=n[m+1]:(h[n[m]]={},h=h[n[m]]);return s}function ou(n,s){for(var h={},m=Object.keys(n),v=0;v<m.length;v++){var b=m[v];h[b]=s(n[b],b,n,v)}return h}function Sy(n,s,h){var m,v,b={};try{for(var M=hr(Object.keys(n)),a=M.next();!a.done;a=M.next()){var L=a.value,F=n[L];!h(F)||(b[L]=s(F,L,n))}}catch(B){m={error:B}}finally{try{a&&!a.done&&(v=M.return)&&v.call(M)}finally{if(m)throw m.error}}return b}var uE=function(n){return function(s){var h,m,v=s;try{for(var b=hr(n),M=b.next();!M.done;M=b.next()){var a=M.value;v=v[a]}}catch(L){h={error:L}}finally{try{M&&!M.done&&(m=b.return)&&m.call(b)}finally{if(h)throw h.error}}return v}};function hE(n,s){return function(h){var m,v,b=h;try{for(var M=hr(n),a=M.next();!a.done;a=M.next()){var L=a.value;b=b[s][L]}}catch(F){m={error:F}}finally{try{a&&!a.done&&(v=M.return)&&v.call(M)}finally{if(m)throw m.error}}return b}}function bd(n){if(!n)return[[]];if(wr(n))return[[n]];var s=Xr(Object.keys(n).map(function(h){var m=n[h];return typeof m!="string"&&(!m||!Object.keys(m).length)?[[h]]:bd(n[h]).map(function(v){return[h].concat(v)})}));return s}function Xr(n){var s;return(s=[]).concat.apply(s,ii([],Er(n),!1))}function Ex(n){return Jl(n)?n:[n]}function ro(n){return n===void 0?[]:Ex(n)}function Ld(n,s,h){var m,v;if(kr(n))return n(s,h.data);var b={};try{for(var M=hr(Object.keys(n)),a=M.next();!a.done;a=M.next()){var L=a.value,F=n[L];kr(F)?b[L]=F(s,h.data):b[L]=F}}catch(B){m={error:B}}finally{try{a&&!a.done&&(v=M.return)&&v.call(M)}finally{if(m)throw m.error}}return b}function dE(n){return/^(done|error)\./.test(n)}function Ay(n){return!!(n instanceof Promise||n!==null&&(kr(n)||typeof n=="object")&&kr(n.then))}function fE(n){return n!==null&&typeof n=="object"&&"transition"in n&&typeof n.transition=="function"}function Sx(n,s){var h,m,v=Er([[],[]],2),b=v[0],M=v[1];try{for(var a=hr(n),L=a.next();!L.done;L=a.next()){var F=L.value;s(F)?b.push(F):M.push(F)}}catch(B){h={error:B}}finally{try{L&&!L.done&&(m=a.return)&&m.call(a)}finally{if(h)throw h.error}}return[b,M]}function Ax(n,s){return ou(n.states,function(h,m){if(!!h){var v=(wr(s)?void 0:s[m])||(h?h.current:void 0);if(!!v)return{current:v,states:Ax(h,v)}}})}function pE(n,s){return{current:s,states:Ax(n,s)}}function Cy(n,s,h,m){var v=n&&h.reduce(function(b,M){var a,L,F=M.assignment,B={state:m,action:M,_event:s},j={};if(kr(F))j=F(b,s.data,B);else try{for(var q=hr(Object.keys(F)),G=q.next();!G.done;G=q.next()){var he=G.value,be=F[he];j[he]=kr(be)?be(b,s.data,B):be}}catch(we){a={error:we}}finally{try{G&&!G.done&&(L=q.return)&&L.call(q)}finally{if(a)throw a.error}}return Object.assign({},b,j)},n);return v}var hu=function(){};function Jl(n){return Array.isArray(n)}function kr(n){return typeof n=="function"}function wr(n){return typeof n=="string"}function Cx(n,s){if(!!n)return wr(n)?{type:Hp,name:n,predicate:s?s[n]:void 0}:kr(n)?{type:Hp,name:n.name,predicate:n}:n}function mE(n){try{return"subscribe"in n&&kr(n.subscribe)}catch{return!1}}var As=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();td={},td[As]=function(){return this},td[Symbol.observable]=function(){return this};function wa(n){return!!n&&"__xstatenode"in n}function _E(n){return!!n&&typeof n.send=="function"}function Sm(n,s){return wr(n)||typeof n=="number"?st({type:n},s):n}function Fi(n,s){if(!wr(n)&&"$$type"in n&&n.$$type==="scxml")return n;var h=Sm(n);return st({name:h.type,data:h,$$type:"scxml",type:"external"},s)}function Ml(n,s){var h=Ex(s).map(function(m){return typeof m=="undefined"||typeof m=="string"||wa(m)?{target:m,event:n}:st(st({},m),{event:n})});return h}function gE(n){if(!(n===void 0||n===lE))return ro(n)}function Mx(n,s,h,m,v){var b=n.options.guards,M={state:v,cond:s,_event:m};if(s.type===Hp)return((b==null?void 0:b[s.name])||s.predicate)(h,m.data,M);var a=b==null?void 0:b[s.type];if(!a)throw new Error("Guard '".concat(s.type,"' is not implemented on machine '").concat(n.id,"'."));return a(h,m.data,M)}function Ix(n){return typeof n=="string"?{type:n}:n}function Yp(n,s,h){if(typeof n=="object")return n;var m=function(){};return{next:n,error:s||m,complete:h||m}}function rd(n,s){return"".concat(n,":invocation[").concat(s,"]")}var Rd=Fi({type:nE});function Jp(n,s){return s&&s[n]||void 0}function Tu(n,s){var h;if(wr(n)||typeof n=="number"){var m=Jp(n,s);kr(m)?h={type:n,exec:m}:m?h=m:h={type:n,exec:void 0}}else if(kr(n))h={type:n.name||n.toString(),exec:n};else{var m=Jp(n.type,s);if(kr(m))h=st(st({},n),{exec:m});else if(m){var v=m.type||n.type;h=st(st(st({},m),n),{type:v})}else h=n}return h}var Od=function(n,s){if(!n)return[];var h=Jl(n)?n:[n];return h.map(function(m){return Tu(m,s)})};function Am(n){var s=Tu(n);return st(st({id:wr(n)?n:s.id},s),{type:s.type})}function yE(n){return wr(n)?{type:Xd,event:n}:kx(n,{to:wu.Internal})}function vE(n){return{type:Xd,_event:Fi(n.event)}}function kx(n,s){return{to:s?s.to:void 0,type:Hd,event:kr(n)?n:Sm(n),delay:s?s.delay:void 0,id:s&&s.id!==void 0?s.id:kr(n)?n.name:Tx(n)}}function xE(n,s,h,m){var v={_event:h},b=Fi(kr(n.event)?n.event(s,h.data,v):n.event),M;if(wr(n.delay)){var a=m&&m[n.delay];M=kr(a)?a(s,h.data,v):a}else M=kr(n.delay)?n.delay(s,h.data,v):n.delay;var L=kr(n.to)?n.to(s,h.data,v):n.to;return st(st({},n),{to:L,_event:b,event:b.data,delay:M})}var bE=function(n,s,h){return st(st({},n),{value:wr(n.expr)?n.expr:n.expr(s,h.data,{_event:h})})},wE=function(n){return{type:vx,sendId:n}};function TE(n){var s=Am(n);return{type:Pr.Start,activity:s,exec:void 0}}function EE(n){var s=kr(n)?n:Am(n);return{type:Pr.Stop,activity:s,exec:void 0}}function SE(n,s,h){var m=kr(n.activity)?n.activity(s,h.data):n.activity,v=typeof m=="string"?{id:m}:m,b={type:Pr.Stop,activity:v};return b}var AE=function(n){return{type:Wp,assignment:n}};function CE(n,s){var h=s?"#".concat(s):"";return"".concat(Pr.After,"(").concat(n,")").concat(h)}function id(n,s){var h="".concat(Pr.DoneState,".").concat(n),m={type:h,data:s};return m.toString=function(){return h},m}function wd(n,s){var h="".concat(Pr.DoneInvoke,".").concat(n),m={type:h,data:s};return m.toString=function(){return h},m}function su(n,s){var h="".concat(Pr.ErrorPlatform,".").concat(n),m={type:h,data:s};return m.toString=function(){return h},m}function Qp(n,s,h,m,v,b){b===void 0&&(b=!1);var M=Er(b?[[],v]:Sx(v,function(q){return q.type===Wp}),2),a=M[0],L=M[1],F=a.length?Cy(h,m,a,s):h,B=b?[h]:void 0,j=Xr(L.map(function(q){var G;switch(q.type){case Xd:return vE(q);case Hd:var he=xE(q,F,m,n.options.delays);return he;case xx:return bE(q,F,m);case sE:{var be=q,we=(G=be.conds.find(function(it){var at=Cx(it.cond,n.options.guards);return!at||Mx(n,at,F,m,s)}))===null||G===void 0?void 0:G.actions;if(!we)return[];var Ie=Er(Qp(n,s,F,m,Od(ro(we),n.options.actions),b),2),E=Ie[0],ye=Ie[1];return F=ye,B==null||B.push(F),E}case aE:{var we=q.get(F,m.data);if(!we)return[];var Le=Er(Qp(n,s,F,m,Od(ro(we),n.options.actions),b),2),Re=Le[0],xe=Le[1];return F=xe,B==null||B.push(F),Re}case Tm:return SE(q,F,m);case Wp:{F=Cy(F,m,[q],s),B==null||B.push(F);break}default:var Se=Tu(q,n.options.actions),Be=Se.exec;if(Be&&B){var Ye=B.length-1;Se=st(st({},Se),{exec:function(it){for(var at=[],wt=1;wt<arguments.length;wt++)at[wt-1]=arguments[wt];Be.apply(void 0,ii([B[Ye]],Er(at),!1))}})}return Se}}).filter(function(q){return!!q}));return[j,F]}var au=function(n,s){var h=s(n);return h};function zx(n){var s;return s={id:n,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:n}}},s[As]=function(){return this},s}function ME(n,s,h,m){var v,b=Ix(n.src),M=(v=s==null?void 0:s.options.services)===null||v===void 0?void 0:v[b.type],a=n.data?Ld(n.data,h,m):void 0,L=M?IE(M,n.id,a):zx(n.id);return L.meta=n,L}function IE(n,s,h){var m=zx(s);if(m.deferred=!0,wa(n)){var v=m.state=au(void 0,function(){return(h?n.withContext(h):n).initialState});m.getSnapshot=function(){return v}}return m}function kE(n){try{return typeof n.send=="function"}catch{return!1}}function zE(n){return kE(n)&&"id"in n}function PE(n){var s;return st((s={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},s[As]=function(){return this},s),n)}var Bd=function(n){return n.type==="atomic"||n.type==="final"};function ql(n){return Object.keys(n.states).map(function(s){return n.states[s]})}function Px(n){var s=[n];return Bd(n)?s:s.concat(Xr(ql(n).map(Px)))}function Dl(n,s){var h,m,v,b,M,a,L,F,B=new Set(n),j=em(B),q=new Set(s);try{for(var G=hr(q),he=G.next();!he.done;he=G.next())for(var be=he.value,we=be.parent;we&&!q.has(we);)q.add(we),we=we.parent}catch(Ye){h={error:Ye}}finally{try{he&&!he.done&&(m=G.return)&&m.call(G)}finally{if(h)throw h.error}}var Ie=em(q);try{for(var E=hr(q),ye=E.next();!ye.done;ye=E.next()){var be=ye.value;if(be.type==="compound"&&(!Ie.get(be)||!Ie.get(be).length))j.get(be)?j.get(be).forEach(function(it){return q.add(it)}):be.initialStateNodes.forEach(function(it){return q.add(it)});else if(be.type==="parallel")try{for(var Le=(M=void 0,hr(ql(be))),Re=Le.next();!Re.done;Re=Le.next()){var xe=Re.value;xe.type!=="history"&&(q.has(xe)||(q.add(xe),j.get(xe)?j.get(xe).forEach(function(it){return q.add(it)}):xe.initialStateNodes.forEach(function(it){return q.add(it)})))}}catch(it){M={error:it}}finally{try{Re&&!Re.done&&(a=Le.return)&&a.call(Le)}finally{if(M)throw M.error}}}}catch(Ye){v={error:Ye}}finally{try{ye&&!ye.done&&(b=E.return)&&b.call(E)}finally{if(v)throw v.error}}try{for(var Se=hr(q),Be=Se.next();!Be.done;Be=Se.next())for(var be=Be.value,we=be.parent;we&&!q.has(we);)q.add(we),we=we.parent}catch(Ye){L={error:Ye}}finally{try{Be&&!Be.done&&(F=Se.return)&&F.call(Se)}finally{if(L)throw L.error}}return q}function Dx(n,s){var h=s.get(n);if(!h)return{};if(n.type==="compound"){var m=h[0];if(m){if(Bd(m))return m.key}else return{}}var v={};return h.forEach(function(b){v[b.key]=Dx(b,s)}),v}function em(n){var s,h,m=new Map;try{for(var v=hr(n),b=v.next();!b.done;b=v.next()){var M=b.value;m.has(M)||m.set(M,[]),M.parent&&(m.has(M.parent)||m.set(M.parent,[]),m.get(M.parent).push(M))}}catch(a){s={error:a}}finally{try{b&&!b.done&&(h=v.return)&&h.call(v)}finally{if(s)throw s.error}}return m}function DE(n,s){var h=Dl([n],s);return Dx(n,em(h))}function Td(n,s){return Array.isArray(n)?n.some(function(h){return h===s}):n instanceof Set?n.has(s):!1}function LE(n){return ii([],Er(new Set(Xr(ii([],Er(n.map(function(s){return s.ownEvents})),!1)))),!1)}function du(n,s){return s.type==="compound"?ql(s).some(function(h){return h.type==="final"&&Td(n,h)}):s.type==="parallel"?ql(s).every(function(h){return du(n,h)}):!1}function RE(n){return n===void 0&&(n=[]),n.reduce(function(s,h){return h.meta!==void 0&&(s[h.id]=h.meta),s},{})}function My(n){return new Set(Xr(n.map(function(s){return s.tags})))}function Lx(n,s){if(n===s)return!0;if(n===void 0||s===void 0)return!1;if(wr(n)||wr(s))return n===s;var h=Object.keys(n),m=Object.keys(s);return h.length===m.length&&h.every(function(v){return Lx(n[v],s[v])})}function OE(n){return typeof n!="object"||n===null?!1:"value"in n&&"_event"in n}function BE(n,s){var h=n.exec,m=st(st({},n),{exec:h!==void 0?function(){return h(s.context,s.event,{action:n,state:s,_event:s._event})}:void 0});return m}var io=function(){function n(s){var h=this,m;this.actions=[],this.activities=Ey,this.meta={},this.events=[],this.value=s.value,this.context=s.context,this._event=s._event,this._sessionid=s._sessionid,this.event=this._event.data,this.historyValue=s.historyValue,this.history=s.history,this.actions=s.actions||[],this.activities=s.activities||Ey,this.meta=RE(s.configuration),this.events=s.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=s.configuration,this.transitions=s.transitions,this.children=s.children,this.done=!!s.done,this.tags=(m=Array.isArray(s.tags)?new Set(s.tags):s.tags)!==null&&m!==void 0?m:new Set,this.machine=s.machine,Object.defineProperty(this,"nextEvents",{get:function(){return LE(h.configuration)}})}return n.from=function(s,h){if(s instanceof n)return s.context!==h?new n({value:s.value,context:h,_event:s._event,_sessionid:null,historyValue:s.historyValue,history:s.history,actions:[],activities:s.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):s;var m=Rd;return new n({value:s,context:h,_event:m,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},n.create=function(s){return new n(s)},n.inert=function(s,h){if(s instanceof n){if(!s.actions.length)return s;var m=Rd;return new n({value:s.value,context:h,_event:m,_sessionid:null,historyValue:s.historyValue,history:s.history,activities:s.activities,configuration:s.configuration,transitions:[],children:{}})}return n.from(s,h)},n.prototype.toStrings=function(s,h){var m=this;if(s===void 0&&(s=this.value),h===void 0&&(h="."),wr(s))return[s];var v=Object.keys(s);return v.concat.apply(v,ii([],Er(v.map(function(b){return m.toStrings(s[b],h).map(function(M){return b+h+M})})),!1))},n.prototype.toJSON=function(){var s=this;s.configuration,s.transitions;var h=s.tags;s.machine;var m=wm(s,["configuration","transitions","tags","machine"]);return st(st({},m),{tags:Array.from(h)})},n.prototype.matches=function(s){return Em(s,this.value)},n.prototype.hasTag=function(s){return this.tags.has(s)},n.prototype.can=function(s){var h;hu(!!this.machine);var m=(h=this.machine)===null||h===void 0?void 0:h.getTransitionData(this,s);return!!(m!=null&&m.transitions.length)&&m.transitions.some(function(v){return v.target!==void 0||v.actions.length})},n}(),FE={deferEvents:!1},Iy=function(){function n(s){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=st(st({},FE),s)}return n.prototype.initialize=function(s){if(this.initialized=!0,s){if(!this.options.deferEvents){this.schedule(s);return}this.process(s)}this.flushEvents()},n.prototype.schedule=function(s){if(!this.initialized||this.processingEvent){this.queue.push(s);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(s),this.flushEvents()},n.prototype.clear=function(){this.queue=[]},n.prototype.flushEvents=function(){for(var s=this.queue.shift();s;)this.process(s),s=this.queue.shift()},n.prototype.process=function(s){this.processingEvent=!0;try{s()}catch(h){throw this.clear(),h}finally{this.processingEvent=!1}},n}(),kp=new Map,NE=0,nd={bookId:function(){return"x:".concat(NE++)},register:function(n,s){return kp.set(n,s),n},get:function(n){return kp.get(n)},free:function(n){kp.delete(n)}};function Cm(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global}function UE(){var n=Cm();if(n&&"__xstate__"in n)return n.__xstate__}function jE(n){if(!!Cm()){var s=UE();s&&s.register(n)}}function VE(n,s){s===void 0&&(s={});var h=n.initialState,m=new Set,v=[],b=!1,M=function(){if(!b){for(b=!0;v.length>0;){var F=v.shift();h=n.transition(h,F,L),m.forEach(function(B){return B.next(h)})}b=!1}},a=PE({id:s.id,send:function(F){v.push(F),M()},getSnapshot:function(){return h},subscribe:function(F,B,j){var q=Yp(F,B,j);return m.add(q),q.next(h),{unsubscribe:function(){m.delete(q)}}}}),L={parent:s.parent,self:a,id:s.id||"anonymous",observers:m};return h=n.start?n.start(L):h,a}var $E={sync:!1,autoForward:!1},gn;(function(n){n[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Stopped=2]="Stopped"})(gn||(gn={}));var GE=function(){function n(s,h){var m=this;h===void 0&&(h=n.defaultOptions),this.machine=s,this.scheduler=new Iy,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=gn.NotStarted,this.children=new Map,this.forwardTo=new Set,this.init=this.start,this.send=function(B,j){if(Jl(B))return m.batch(B),m.state;var q=Fi(Sm(B,j));if(m.status===gn.Stopped)return m.state;if(m.status!==gn.Running&&!m.options.deferEvents)throw new Error('Event "'.concat(q.name,'" was sent to uninitialized service "').concat(m.machine.id,`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `).concat(JSON.stringify(q.data)));return m.scheduler.schedule(function(){m.forward(q);var G=m.nextState(q);m.update(G,q)}),m._state},this.sendTo=function(B,j){var q=m.parent&&(j===wu.Parent||m.parent.id===j),G=q?m.parent:wr(j)?m.children.get(j)||nd.get(j):_E(j)?j:void 0;if(!G){if(!q)throw new Error("Unable to send event to child '".concat(j,"' from service '").concat(m.id,"'."));return}"machine"in G?G.send(st(st({},B),{name:B.name===oE?"".concat(su(m.id)):B.name,origin:m.sessionId})):G.send(B.data)};var v=st(st({},n.defaultOptions),h),b=v.clock,M=v.logger,a=v.parent,L=v.id,F=L!==void 0?L:s.id;this.id=F,this.logger=M,this.clock=b,this.parent=a,this.options=v,this.scheduler=new Iy({deferEvents:this.options.deferEvents}),this.sessionId=nd.bookId()}return Object.defineProperty(n.prototype,"initialState",{get:function(){var s=this;return this._initialState?this._initialState:au(this,function(){return s._initialState=s.machine.initialState,s._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),n.prototype.execute=function(s,h){var m,v;try{for(var b=hr(s.actions),M=b.next();!M.done;M=b.next()){var a=M.value;this.exec(a,s,h)}}catch(L){m={error:L}}finally{try{M&&!M.done&&(v=b.return)&&v.call(b)}finally{if(m)throw m.error}}},n.prototype.update=function(s,h){var m,v,b,M,a,L,F,B,j=this;if(s._sessionid=this.sessionId,this._state=s,this.options.execute&&this.execute(this.state),this.children.forEach(function(Ye){j.state.children[Ye.id]=Ye}),this.devTools&&this.devTools.send(h.data,s),s.event)try{for(var q=hr(this.eventListeners),G=q.next();!G.done;G=q.next()){var he=G.value;he(s.event)}}catch(Ye){m={error:Ye}}finally{try{G&&!G.done&&(v=q.return)&&v.call(q)}finally{if(m)throw m.error}}try{for(var be=hr(this.listeners),we=be.next();!we.done;we=be.next()){var he=we.value;he(s,s.event)}}catch(Ye){b={error:Ye}}finally{try{we&&!we.done&&(M=be.return)&&M.call(be)}finally{if(b)throw b.error}}try{for(var Ie=hr(this.contextListeners),E=Ie.next();!E.done;E=Ie.next()){var ye=E.value;ye(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(Ye){a={error:Ye}}finally{try{E&&!E.done&&(L=Ie.return)&&L.call(Ie)}finally{if(a)throw a.error}}var Le=du(s.configuration||[],this.machine);if(this.state.configuration&&Le){var Re=s.configuration.find(function(Ye){return Ye.type==="final"&&Ye.parent===j.machine}),xe=Re&&Re.doneData?Ld(Re.doneData,s.context,h):void 0;try{for(var Se=hr(this.doneListeners),Be=Se.next();!Be.done;Be=Se.next()){var he=Be.value;he(wd(this.id,xe))}}catch(Ye){F={error:Ye}}finally{try{Be&&!Be.done&&(B=Se.return)&&B.call(Se)}finally{if(F)throw F.error}}this.stop()}},n.prototype.onTransition=function(s){return this.listeners.add(s),this.status===gn.Running&&s(this.state,this.state.event),this},n.prototype.subscribe=function(s,h,m){var v=this;if(!s)return{unsubscribe:function(){}};var b,M=m;return typeof s=="function"?b=s:(b=s.next.bind(s),M=s.complete.bind(s)),this.listeners.add(b),this.status===gn.Running&&b(this.state),M&&this.onDone(M),{unsubscribe:function(){b&&v.listeners.delete(b),M&&v.doneListeners.delete(M)}}},n.prototype.onEvent=function(s){return this.eventListeners.add(s),this},n.prototype.onSend=function(s){return this.sendListeners.add(s),this},n.prototype.onChange=function(s){return this.contextListeners.add(s),this},n.prototype.onStop=function(s){return this.stopListeners.add(s),this},n.prototype.onDone=function(s){return this.doneListeners.add(s),this},n.prototype.off=function(s){return this.listeners.delete(s),this.eventListeners.delete(s),this.sendListeners.delete(s),this.stopListeners.delete(s),this.doneListeners.delete(s),this.contextListeners.delete(s),this},n.prototype.start=function(s){var h=this;if(this.status===gn.Running)return this;this.machine._init(),nd.register(this.sessionId,this),this.initialized=!0,this.status=gn.Running;var m=s===void 0?this.initialState:au(this,function(){return OE(s)?h.machine.resolveState(s):h.machine.resolveState(io.from(s,h.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){h.update(m,Rd)}),this},n.prototype.stop=function(){var s,h,m,v,b,M,a,L,F,B,j=this;try{for(var q=hr(this.listeners),G=q.next();!G.done;G=q.next()){var he=G.value;this.listeners.delete(he)}}catch(Be){s={error:Be}}finally{try{G&&!G.done&&(h=q.return)&&h.call(q)}finally{if(s)throw s.error}}try{for(var be=hr(this.stopListeners),we=be.next();!we.done;we=be.next()){var he=we.value;he(),this.stopListeners.delete(he)}}catch(Be){m={error:Be}}finally{try{we&&!we.done&&(v=be.return)&&v.call(be)}finally{if(m)throw m.error}}try{for(var Ie=hr(this.contextListeners),E=Ie.next();!E.done;E=Ie.next()){var he=E.value;this.contextListeners.delete(he)}}catch(Be){b={error:Be}}finally{try{E&&!E.done&&(M=Ie.return)&&M.call(Ie)}finally{if(b)throw b.error}}try{for(var ye=hr(this.doneListeners),Le=ye.next();!Le.done;Le=ye.next()){var he=Le.value;this.doneListeners.delete(he)}}catch(Be){a={error:Be}}finally{try{Le&&!Le.done&&(L=ye.return)&&L.call(ye)}finally{if(a)throw a.error}}if(!this.initialized)return this;ii([],Er(this.state.configuration),!1).sort(function(Be,Ye){return Ye.order-Be.order}).forEach(function(Be){var Ye,it;try{for(var at=hr(Be.definition.exit),wt=at.next();!wt.done;wt=at.next()){var dr=wt.value;j.exec(dr,j.state)}}catch(Sr){Ye={error:Sr}}finally{try{wt&&!wt.done&&(it=at.return)&&it.call(at)}finally{if(Ye)throw Ye.error}}}),this.children.forEach(function(Be){kr(Be.stop)&&Be.stop()});try{for(var Re=hr(Object.keys(this.delayedEventsMap)),xe=Re.next();!xe.done;xe=Re.next()){var Se=xe.value;this.clock.clearTimeout(this.delayedEventsMap[Se])}}catch(Be){F={error:Be}}finally{try{xe&&!xe.done&&(B=Re.return)&&B.call(Re)}finally{if(F)throw F.error}}return this.scheduler.clear(),this.initialized=!1,this.status=gn.Stopped,nd.free(this.sessionId),this},n.prototype.batch=function(s){var h=this;if(!(this.status===gn.NotStarted&&this.options.deferEvents)){if(this.status!==gn.Running)throw new Error("".concat(s.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'))}this.scheduler.schedule(function(){var m,v,b=h.state,M=!1,a=[],L=function(q){var G=Fi(q);h.forward(G),b=au(h,function(){return h.machine.transition(b,G)}),a.push.apply(a,ii([],Er(b.actions.map(function(he){return BE(he,b)})),!1)),M=M||!!b.changed};try{for(var F=hr(s),B=F.next();!B.done;B=F.next()){var j=B.value;L(j)}}catch(q){m={error:q}}finally{try{B&&!B.done&&(v=F.return)&&v.call(F)}finally{if(m)throw m.error}}b.changed=M,b.actions=a,h.update(b,Fi(s[s.length-1]))})},n.prototype.sender=function(s){return this.send.bind(this,s)},n.prototype.nextState=function(s){var h=this,m=Fi(s);if(m.name.indexOf(Ty)===0&&!this.state.nextEvents.some(function(b){return b.indexOf(Ty)===0}))throw m.data.data;var v=au(this,function(){return h.machine.transition(h.state,m)});return v},n.prototype.forward=function(s){var h,m;try{for(var v=hr(this.forwardTo),b=v.next();!b.done;b=v.next()){var M=b.value,a=this.children.get(M);if(!a)throw new Error("Unable to forward event '".concat(s,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(M,"'."));a.send(s)}}catch(L){h={error:L}}finally{try{b&&!b.done&&(m=v.return)&&m.call(v)}finally{if(h)throw h.error}}},n.prototype.defer=function(s){var h=this;this.delayedEventsMap[s.id]=this.clock.setTimeout(function(){s.to?h.sendTo(s._event,s.to):h.send(s._event)},s.delay)},n.prototype.cancel=function(s){this.clock.clearTimeout(this.delayedEventsMap[s]),delete this.delayedEventsMap[s]},n.prototype.exec=function(s,h,m){m===void 0&&(m=this.machine.options.actions);var v=h.context,b=h._event,M=s.exec||Jp(s.type,m),a=kr(M)?M:M?M.exec:s.exec;if(a)try{return a(v,b.data,{action:s,state:this.state,_event:b})}catch(Le){throw this.parent&&this.parent.send({type:"xstate.error",data:Le}),Le}switch(s.type){case Hd:var L=s;if(typeof L.delay=="number"){this.defer(L);return}else L.to?this.sendTo(L._event,L.to):this.send(L._event);break;case vx:this.cancel(s.sendId);break;case Zp:{if(this.status!==gn.Running)return;var F=s.activity;if(!this.state.activities[F.id||F.type])break;if(F.type===Pr.Invoke){var B=Ix(F.src),j=this.machine.options.services?this.machine.options.services[B.type]:void 0,q=F.id,G=F.data,he="autoForward"in F?F.autoForward:!!F.forward;if(!j)return;var be=G?Ld(G,v,b):void 0;if(typeof j=="string")return;var we=kr(j)?j(v,b.data,{data:be,src:B,meta:F.meta}):j;if(!we)return;var Ie=void 0;wa(we)&&(we=be?we.withContext(be):we,Ie={autoForward:he}),this.spawn(we,q,Ie)}else this.spawnActivity(F);break}case Tm:{this.stopChild(s.activity.id);break}case xx:var E=s.label,ye=s.value;E?this.logger(E,ye):this.logger(ye);break}},n.prototype.removeChild=function(s){var h;this.children.delete(s),this.forwardTo.delete(s),(h=this.state)===null||h===void 0||delete h.children[s]},n.prototype.stopChild=function(s){var h=this.children.get(s);!h||(this.removeChild(s),kr(h.stop)&&h.stop())},n.prototype.spawn=function(s,h,m){if(Ay(s))return this.spawnPromise(Promise.resolve(s),h);if(kr(s))return this.spawnCallback(s,h);if(zE(s))return this.spawnActor(s,h);if(mE(s))return this.spawnObservable(s,h);if(wa(s))return this.spawnMachine(s,st(st({},m),{id:h}));if(fE(s))return this.spawnBehavior(s,h);throw new Error('Unable to spawn entity "'.concat(h,'" of type "').concat(typeof s,'".'))},n.prototype.spawnMachine=function(s,h){var m=this;h===void 0&&(h={});var v=new n(s,st(st({},this.options),{parent:this,id:h.id||s.id})),b=st(st({},$E),h);b.sync&&v.onTransition(function(a){m.send(bx,{state:a,id:v.id})});var M=v;return this.children.set(v.id,M),b.autoForward&&this.forwardTo.add(v.id),v.onDone(function(a){m.removeChild(v.id),m.send(Fi(a,{origin:v.id}))}).start(),M},n.prototype.spawnBehavior=function(s,h){var m=VE(s,{id:h,parent:this});return this.children.set(h,m),m},n.prototype.spawnPromise=function(s,h){var m,v=this,b=!1,M;s.then(function(L){b||(M=L,v.removeChild(h),v.send(Fi(wd(h,L),{origin:h})))},function(L){if(!b){v.removeChild(h);var F=su(h,L);try{v.send(Fi(F,{origin:h}))}catch{v.devTools&&v.devTools.send(F,v.state),v.machine.strict&&v.stop()}}});var a=(m={id:h,send:function(){},subscribe:function(L,F,B){var j=Yp(L,F,B),q=!1;return s.then(function(G){q||(j.next(G),!q&&j.complete())},function(G){q||j.error(G)}),{unsubscribe:function(){return q=!0}}},stop:function(){b=!0},toJSON:function(){return{id:h}},getSnapshot:function(){return M}},m[As]=function(){return this},m);return this.children.set(h,a),a},n.prototype.spawnCallback=function(s,h){var m,v=this,b=!1,M=new Set,a=new Set,L,F=function(q){L=q,a.forEach(function(G){return G(q)}),!b&&v.send(Fi(q,{origin:h}))},B;try{B=s(F,function(q){M.add(q)})}catch(q){this.send(su(h,q))}if(Ay(B))return this.spawnPromise(B,h);var j=(m={id:h,send:function(q){return M.forEach(function(G){return G(q)})},subscribe:function(q){var G=Yp(q);return a.add(G.next),{unsubscribe:function(){a.delete(G.next)}}},stop:function(){b=!0,kr(B)&&B()},toJSON:function(){return{id:h}},getSnapshot:function(){return L}},m[As]=function(){return this},m);return this.children.set(h,j),j},n.prototype.spawnObservable=function(s,h){var m,v=this,b,M=s.subscribe(function(L){b=L,v.send(Fi(L,{origin:h}))},function(L){v.removeChild(h),v.send(Fi(su(h,L),{origin:h}))},function(){v.removeChild(h),v.send(Fi(wd(h),{origin:h}))}),a=(m={id:h,send:function(){},subscribe:function(L,F,B){return s.subscribe(L,F,B)},stop:function(){return M.unsubscribe()},getSnapshot:function(){return b},toJSON:function(){return{id:h}}},m[As]=function(){return this},m);return this.children.set(h,a),a},n.prototype.spawnActor=function(s,h){return this.children.set(h,s),s},n.prototype.spawnActivity=function(s){var h=this.machine.options&&this.machine.options.activities?this.machine.options.activities[s.type]:void 0;if(!!h){var m=h(this.state.context,s);this.spawnEffect(s.id,m)}},n.prototype.spawnEffect=function(s,h){var m;this.children.set(s,(m={id:s,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:h||void 0,getSnapshot:function(){},toJSON:function(){return{id:s}}},m[As]=function(){return this},m))},n.prototype.attachDev=function(){var s=Cm();if(this.options.devTools&&s){if(s.__REDUX_DEVTOOLS_EXTENSION__){var h=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=s.__REDUX_DEVTOOLS_EXTENSION__.connect(st(st({name:this.id,autoPause:!0,stateSanitizer:function(m){return{value:m.value,context:m.context,actions:m.actions}}},h),{features:st({jump:!1,skip:!1},h?h.features:void 0)}),this.machine),this.devTools.init(this.state)}jE(this)}},n.prototype.toJSON=function(){return{id:this.id}},n.prototype[As]=function(){return this},n.prototype.getSnapshot=function(){return this.status===gn.NotStarted?this.initialState:this._state},n.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(s,h){return setTimeout(s,h)},clearTimeout:function(s){return clearTimeout(s)}},logger:console.log.bind(console),devTools:!1},n.interpret=Rx,n}();function Rx(n,s){var h=new GE(n,s);return h}function qE(n){if(typeof n=="string"){var s={type:n};return s.toString=function(){return n},s}return n}function od(n){return st(st({type:Xp},n),{toJSON:function(){n.onDone,n.onError;var s=wm(n,["onDone","onError"]);return st(st({},s),{type:Xp,src:qE(n.src)})}})}var Ll="",tm="#",Qc="*",Il={},kl=function(n){return n[0]===tm},ZE=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},WE=function(n,s,h){var m=h.slice(0,-1).some(function(b){return!("cond"in b)&&!("in"in b)&&(wr(b.target)||wa(b.target))}),v=s===Ll?"the transient event":"event '".concat(s,"'");hu(!m,"One or more transitions for ".concat(v," on state '").concat(n.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")},XE=function(){function n(s,h,m,v){var b=this;m===void 0&&(m="context"in s?s.context:void 0);var M;this.config=s,this._context=m,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(ZE(),h),this.parent=v==null?void 0:v.parent,this.key=this.config.key||(v==null?void 0:v.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:wx),this.id=this.config.id||ii([this.machine.key],Er(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(M=this.config.schema)!==null&&M!==void 0?M:{},this.description=this.config.description,this.initial=this.config.initial,this.states=this.config.states?ou(this.config.states,function(F,B){var j,q=new n(F,{},void 0,{parent:b,key:B});return Object.assign(b.idMap,st((j={},j[q.id]=q,j),q.idMap)),q}):Il;var a=0;function L(F){var B,j;F.order=a++;try{for(var q=hr(ql(F)),G=q.next();!G.done;G=q.next()){var he=G.value;L(he)}}catch(be){B={error:be}}finally{try{G&&!G.done&&(j=q.return)&&j.call(q)}finally{if(B)throw B.error}}}L(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(F){var B=F.event;return B===Ll}):Ll in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=ro(this.config.entry||this.config.onEntry).map(function(F){return Tu(F)}),this.onExit=ro(this.config.exit||this.config.onExit).map(function(F){return Tu(F)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=ro(this.config.invoke).map(function(F,B){var j,q;if(wa(F)){var G=rd(b.id,B);return b.machine.options.services=st((j={},j[G]=F,j),b.machine.options.services),od({src:G,id:G})}else if(wr(F.src)){var G=F.id||rd(b.id,B);return od(st(st({},F),{id:G,src:F.src}))}else if(wa(F.src)||kr(F.src)){var G=F.id||rd(b.id,B);return b.machine.options.services=st((q={},q[G]=F.src,q),b.machine.options.services),od(st(st({id:G},F),{src:G}))}else{var he=F.src;return od(st(st({id:rd(b.id,B)},F),{src:he}))}}),this.activities=ro(this.config.activities).concat(this.invoke).map(function(F){return Am(F)}),this.transition=this.transition.bind(this),this.tags=ro(this.config.tags)}return n.prototype._init=function(){this.__cache.transitions||Px(this).forEach(function(s){return s.on})},n.prototype.withConfig=function(s,h){var m=this.options,v=m.actions,b=m.activities,M=m.guards,a=m.services,L=m.delays;return new n(this.config,{actions:st(st({},v),s.actions),activities:st(st({},b),s.activities),guards:st(st({},M),s.guards),services:st(st({},a),s.services),delays:st(st({},L),s.delays)},h!=null?h:this.context)},n.prototype.withContext=function(s){return new n(this.config,this.options,s)},Object.defineProperty(n.prototype,"context",{get:function(){return kr(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:ou(this.states,function(s){return s.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return this.definition},Object.defineProperty(n.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var s=this.transitions;return this.__cache.on=s.reduce(function(h,m){return h[m.eventType]=h[m.eventType]||[],h[m.eventType].push(m),h},{})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),n.prototype.getCandidates=function(s){if(this.__cache.candidates[s])return this.__cache.candidates[s];var h=s===Ll,m=this.transitions.filter(function(v){var b=v.eventType===s;return h?b:b||v.eventType===Qc});return this.__cache.candidates[s]=m,m},n.prototype.getDelayedTransitions=function(){var s=this,h=this.config.after;if(!h)return[];var m=function(b,M){var a=kr(b)?"".concat(s.id,":delay[").concat(M,"]"):b,L=CE(a,s.id);return s.onEntry.push(kx(L,{delay:b})),s.onExit.push(wE(L)),L},v=Jl(h)?h.map(function(b,M){var a=m(b.delay,M);return st(st({},b),{event:a})}):Xr(Object.keys(h).map(function(b,M){var a=h[b],L=wr(a)?{target:a}:a,F=isNaN(+b)?b:+b,B=m(F,M);return ro(L).map(function(j){return st(st({},j),{event:B,delay:F})})}));return v.map(function(b){var M=b.delay;return st(st({},s.formatTransition(b)),{delay:M})})},n.prototype.getStateNodes=function(s){var h,m=this;if(!s)return[];var v=s instanceof io?s.value:uu(s,this.delimiter);if(wr(v)){var b=this.getStateNode(v).initial;return b!==void 0?this.getStateNodes((h={},h[v]=b,h)):[this,this.states[v]]}var M=Object.keys(v),a=[this];return a.push.apply(a,ii([],Er(Xr(M.map(function(L){return m.getStateNode(L).getStateNodes(v[L])}))),!1)),a},n.prototype.handles=function(s){var h=Tx(s);return this.events.includes(h)},n.prototype.resolveState=function(s){var h=s instanceof io?s:io.create(s),m=Array.from(Dl([],this.getStateNodes(h.value)));return new io(st(st({},h),{value:this.resolve(h.value),configuration:m,done:du(m,this),tags:My(m),machine:this.machine}))},n.prototype.transitionLeafNode=function(s,h,m){var v=this.getStateNode(s),b=v.next(h,m);return!b||!b.transitions.length?this.next(h,m):b},n.prototype.transitionCompoundNode=function(s,h,m){var v=Object.keys(s),b=this.getStateNode(v[0]),M=b._transition(s[v[0]],h,m);return!M||!M.transitions.length?this.next(h,m):M},n.prototype.transitionParallelNode=function(s,h,m){var v,b,M={};try{for(var a=hr(Object.keys(s)),L=a.next();!L.done;L=a.next()){var F=L.value,B=s[F];if(!!B){var j=this.getStateNode(F),q=j._transition(B,h,m);q&&(M[F]=q)}}}catch(E){v={error:E}}finally{try{L&&!L.done&&(b=a.return)&&b.call(a)}finally{if(v)throw v.error}}var G=Object.keys(M).map(function(E){return M[E]}),he=Xr(G.map(function(E){return E.transitions})),be=G.some(function(E){return E.transitions.length>0});if(!be)return this.next(h,m);var we=Xr(G.map(function(E){return E.entrySet})),Ie=Xr(Object.keys(M).map(function(E){return M[E].configuration}));return{transitions:he,entrySet:we,exitSet:Xr(G.map(function(E){return E.exitSet})),configuration:Ie,source:h,actions:Xr(Object.keys(M).map(function(E){return M[E].actions}))}},n.prototype._transition=function(s,h,m){return wr(s)?this.transitionLeafNode(s,h,m):Object.keys(s).length===1?this.transitionCompoundNode(s,h,m):this.transitionParallelNode(s,h,m)},n.prototype.getTransitionData=function(s,h){return this._transition(s.value,s,Fi(h))},n.prototype.next=function(s,h){var m,v,b=this,M=h.name,a=[],L=[],F;try{for(var B=hr(this.getCandidates(M)),j=B.next();!j.done;j=B.next()){var q=j.value,G=q.cond,he=q.in,be=s.context,we=he?wr(he)&&kl(he)?s.matches(uu(this.getStateNodeById(he).path,this.delimiter)):Em(uu(he,this.delimiter),uE(this.path.slice(0,-2))(s.value)):!0,Ie=!1;try{Ie=!G||Mx(this.machine,G,be,h,s)}catch(Re){throw new Error("Unable to evaluate guard '".concat(G.name||G.type,"' in transition for event '").concat(M,"' in state node '").concat(this.id,`':
`).concat(Re.message))}if(Ie&&we){q.target!==void 0&&(L=q.target),a.push.apply(a,ii([],Er(q.actions),!1)),F=q;break}}}catch(Re){m={error:Re}}finally{try{j&&!j.done&&(v=B.return)&&v.call(B)}finally{if(m)throw m.error}}if(!!F){if(!L.length)return{transitions:[F],entrySet:[],exitSet:[],configuration:s.value?[this]:[],source:s,actions:a};var E=Xr(L.map(function(Re){return b.getRelativeStateNodes(Re,s.historyValue)})),ye=!!F.internal,Le=ye?[]:Xr(E.map(function(Re){return b.nodesFromChild(Re)}));return{transitions:[F],entrySet:Le,exitSet:ye?[]:[this],configuration:E,source:s,actions:a}}},n.prototype.nodesFromChild=function(s){if(s.escapes(this))return[];for(var h=[],m=s;m&&m!==this;)h.push(m),m=m.parent;return h.push(this),h},n.prototype.escapes=function(s){if(this===s)return!1;for(var h=this.parent;h;){if(h===s)return!1;h=h.parent}return!0},n.prototype.getActions=function(s,h,m,v){var b,M,a,L,F=Dl([],v?this.getStateNodes(v.value):[this]),B=s.configuration.length?Dl(F,s.configuration):F;try{for(var j=hr(B),q=j.next();!q.done;q=j.next()){var G=q.value;Td(F,G)||s.entrySet.push(G)}}catch(Se){b={error:Se}}finally{try{q&&!q.done&&(M=j.return)&&M.call(j)}finally{if(b)throw b.error}}try{for(var he=hr(F),be=he.next();!be.done;be=he.next()){var G=be.value;(!Td(B,G)||Td(s.exitSet,G.parent))&&s.exitSet.push(G)}}catch(Se){a={error:Se}}finally{try{be&&!be.done&&(L=he.return)&&L.call(he)}finally{if(a)throw a.error}}var we=Xr(s.entrySet.map(function(Se){var Be=[];if(Se.type!=="final")return Be;var Ye=Se.parent;if(!Ye.parent)return Be;Be.push(id(Se.id,Se.doneData),id(Ye.id,Se.doneData?Ld(Se.doneData,h,m):void 0));var it=Ye.parent;return it.type==="parallel"&&ql(it).every(function(at){return du(s.configuration,at)})&&Be.push(id(it.id)),Be}));s.exitSet.sort(function(Se,Be){return Be.order-Se.order}),s.entrySet.sort(function(Se,Be){return Se.order-Be.order});var Ie=new Set(s.entrySet),E=new Set(s.exitSet),ye=Er([Xr(Array.from(Ie).map(function(Se){return ii(ii([],Er(Se.activities.map(function(Be){return TE(Be)})),!1),Er(Se.onEntry),!1)})).concat(we.map(yE)),Xr(Array.from(E).map(function(Se){return ii(ii([],Er(Se.onExit),!1),Er(Se.activities.map(function(Be){return EE(Be)})),!1)}))],2),Le=ye[0],Re=ye[1],xe=Od(Re.concat(s.actions).concat(Le),this.machine.options.actions);return xe},n.prototype.transition=function(s,h,m){s===void 0&&(s=this.initialState);var v=Fi(h),b;if(s instanceof io)b=m===void 0?s:this.resolveState(io.from(s,m));else{var M=wr(s)?this.resolve(Dd(this.getResolvedPath(s))):this.resolve(s),a=m!=null?m:this.machine.context;b=this.resolveState(io.from(M,a))}if(!Jc&&v.name===Qc)throw new Error("An event cannot have the wildcard type ('".concat(Qc,"')"));if(this.strict&&!this.events.includes(v.name)&&!dE(v.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(v.name,"'"));var L=this._transition(b.value,b,v)||{transitions:[],configuration:[],entrySet:[],exitSet:[],source:b,actions:[]},F=Dl([],this.getStateNodes(b.value)),B=L.configuration.length?Dl(F,L.configuration):F;return L.configuration=ii([],Er(B),!1),this.resolveTransition(L,b,b.context,v)},n.prototype.resolveRaisedTransition=function(s,h,m){var v,b=s.actions;return s=this.transition(s,h),s._event=m,s.event=m.data,(v=s.actions).unshift.apply(v,ii([],Er(b),!1)),s},n.prototype.resolveTransition=function(s,h,m,v){var b,M,a=this;v===void 0&&(v=Rd);var L=s.configuration,F=!h||s.transitions.length>0,B=F?DE(this.machine,L):void 0,j=h?h.historyValue?h.historyValue:s.source?this.machine.historyValue(h.value):void 0:void 0,q=this.getActions(s,m,v,h),G=h?st({},h.activities):{};try{for(var he=hr(q),be=he.next();!be.done;be=he.next()){var we=be.value;we.type===Zp?G[we.activity.id||we.activity.type]=we:we.type===Tm&&(G[we.activity.id||we.activity.type]=!1)}}catch(At){b={error:At}}finally{try{be&&!be.done&&(M=he.return)&&M.call(he)}finally{if(b)throw b.error}}var Ie=Er(Qp(this,h,m,v,q,this.machine.config.preserveActionOrder),2),E=Ie[0],ye=Ie[1],Le=Er(Sx(E,function(At){return At.type===Xd||At.type===Hd&&At.to===wu.Internal}),2),Re=Le[0],xe=Le[1],Se=E.filter(function(At){var fr;return At.type===Zp&&((fr=At.activity)===null||fr===void 0?void 0:fr.type)===Xp}),Be=Se.reduce(function(At,fr){return At[fr.activity.id]=ME(fr.activity,a.machine,ye,v),At},h?st({},h.children):{}),Ye=F?s.configuration:h?h.configuration:[],it=du(Ye,this),at=new io({value:B||h.value,context:ye,_event:v,_sessionid:h?h._sessionid:null,historyValue:B?j?pE(j,B):void 0:h?h.historyValue:void 0,history:!B||s.source?h:void 0,actions:B?xe:[],activities:B?G:h?h.activities:{},events:[],configuration:Ye,transitions:s.transitions,children:Be,done:it,tags:h==null?void 0:h.tags,machine:this}),wt=m!==ye;at.changed=v.name===bx||wt;var dr=at.history;dr&&delete dr.history;var Sr=!it&&(this._transient||L.some(function(At){return At._transient}));if(!F&&(!Sr||v.name===Ll))return at;var Ut=at;if(!it)for(Sr&&(Ut=this.resolveRaisedTransition(Ut,{type:iE},v));Re.length;){var $r=Re.shift();Ut=this.resolveRaisedTransition(Ut,$r._event,v)}var Zt=Ut.changed||(dr?!!Ut.actions.length||wt||typeof dr.value!=typeof Ut.value||!Lx(Ut.value,dr.value):void 0);return Ut.changed=Zt,Ut.history=dr,Ut.tags=My(Ut.configuration),Ut},n.prototype.getStateNode=function(s){if(kl(s))return this.machine.getStateNodeById(s);if(!this.states)throw new Error("Unable to retrieve child state '".concat(s,"' from '").concat(this.id,"'; no child states exist."));var h=this.states[s];if(!h)throw new Error("Child state '".concat(s,"' does not exist on '").concat(this.id,"'"));return h},n.prototype.getStateNodeById=function(s){var h=kl(s)?s.slice(tm.length):s;if(h===this.id)return this;var m=this.machine.idMap[h];if(!m)throw new Error("Child state node '#".concat(h,"' does not exist on machine '").concat(this.id,"'"));return m},n.prototype.getStateNodeByPath=function(s){if(typeof s=="string"&&kl(s))try{return this.getStateNodeById(s.slice(1))}catch{}for(var h=Kp(s,this.delimiter).slice(),m=this;h.length;){var v=h.shift();if(!v.length)break;m=m.getStateNode(v)}return m},n.prototype.resolve=function(s){var h,m=this;if(!s)return this.initialStateValue||Il;switch(this.type){case"parallel":return ou(this.initialStateValue,function(b,M){return b?m.getStateNode(M).resolve(s[M]||b):Il});case"compound":if(wr(s)){var v=this.getStateNode(s);return v.type==="parallel"||v.type==="compound"?(h={},h[s]=v.initialStateValue,h):s}return Object.keys(s).length?ou(s,function(b,M){return b?m.getStateNode(M).resolve(b):Il}):this.initialStateValue||{};default:return s||Il}},n.prototype.getResolvedPath=function(s){if(kl(s)){var h=this.machine.idMap[s.slice(tm.length)];if(!h)throw new Error("Unable to find state node '".concat(s,"'"));return h.path}return Kp(s,this.delimiter)},Object.defineProperty(n.prototype,"initialStateValue",{get:function(){var s;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var h;if(this.type==="parallel")h=Sy(this.states,function(m){return m.initialStateValue||Il},function(m){return m.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));h=Bd(this.states[this.initial])?this.initial:(s={},s[this.initial]=this.states[this.initial].initialStateValue,s)}else h={};return this.__cache.initialStateValue=h,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),n.prototype.getInitialState=function(s,h){this._init();var m=this.getStateNodes(s);return this.resolveTransition({configuration:m,entrySet:m,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,h!=null?h:this.machine.context,void 0)},Object.defineProperty(n.prototype,"initialState",{get:function(){var s=this.initialStateValue;if(!s)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(s)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"target",{get:function(){var s;if(this.type==="history"){var h=this.config;wr(h.target)?s=kl(h.target)?Dd(this.machine.getStateNodeById(h.target).path.slice(this.path.length-1)):h.target:s=h.target}return s},enumerable:!1,configurable:!0}),n.prototype.getRelativeStateNodes=function(s,h,m){return m===void 0&&(m=!0),m?s.type==="history"?s.resolveHistory(h):s.initialStateNodes:[s]},Object.defineProperty(n.prototype,"initialStateNodes",{get:function(){var s=this;if(Bd(this))return[this];if(this.type==="compound"&&!this.initial)return Jc||hu(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this];var h=bd(this.initialStateValue);return Xr(h.map(function(m){return s.getFromRelativePath(m)}))},enumerable:!1,configurable:!0}),n.prototype.getFromRelativePath=function(s){if(!s.length)return[this];var h=Er(s),m=h[0],v=h.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(m,"' from node with no states"));var b=this.getStateNode(m);if(b.type==="history")return b.resolveHistory();if(!this.states[m])throw new Error("Child state '".concat(m,"' does not exist on '").concat(this.id,"'"));return this.states[m].getFromRelativePath(v)},n.prototype.historyValue=function(s){if(!!Object.keys(this.states).length)return{current:s||this.initialStateValue,states:Sy(this.states,function(h,m){if(!s)return h.historyValue();var v=wr(s)?void 0:s[m];return h.historyValue(v||h.initialStateValue)},function(h){return!h.history})}},n.prototype.resolveHistory=function(s){var h=this;if(this.type!=="history")return[this];var m=this.parent;if(!s){var v=this.target;return v?Xr(bd(v).map(function(M){return m.getFromRelativePath(M)})):m.initialStateNodes}var b=hE(m.path,"states")(s).current;return wr(b)?[m.getStateNode(b)]:Xr(bd(b).map(function(M){return h.history==="deep"?m.getFromRelativePath(M):[m.states[M[0]]]}))},Object.defineProperty(n.prototype,"stateIds",{get:function(){var s=this,h=Xr(Object.keys(this.states).map(function(m){return s.states[m].stateIds}));return[this.id].concat(h)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"events",{get:function(){var s,h,m,v;if(this.__cache.events)return this.__cache.events;var b=this.states,M=new Set(this.ownEvents);if(b)try{for(var a=hr(Object.keys(b)),L=a.next();!L.done;L=a.next()){var F=L.value,B=b[F];if(B.states)try{for(var j=(m=void 0,hr(B.events)),q=j.next();!q.done;q=j.next()){var G=q.value;M.add("".concat(G))}}catch(he){m={error:he}}finally{try{q&&!q.done&&(v=j.return)&&v.call(j)}finally{if(m)throw m.error}}}}catch(he){s={error:he}}finally{try{L&&!L.done&&(h=a.return)&&h.call(a)}finally{if(s)throw s.error}}return this.__cache.events=Array.from(M)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"ownEvents",{get:function(){var s=new Set(this.transitions.filter(function(h){return!(!h.target&&!h.actions.length&&h.internal)}).map(function(h){return h.eventType}));return Array.from(s)},enumerable:!1,configurable:!0}),n.prototype.resolveTarget=function(s){var h=this;if(s!==void 0)return s.map(function(m){if(!wr(m))return m;var v=m[0]===h.delimiter;if(v&&!h.parent)return h.getStateNodeByPath(m.slice(1));var b=v?h.key+m:m;if(h.parent)try{var M=h.parent.getStateNodeByPath(b);return M}catch(a){throw new Error("Invalid transition definition for state node '".concat(h.id,`':
`).concat(a.message))}else return h.getStateNodeByPath(b)})},n.prototype.formatTransition=function(s){var h=this,m=gE(s.target),v="internal"in s?s.internal:m?m.some(function(L){return wr(L)&&L[0]===h.delimiter}):!0,b=this.machine.options.guards,M=this.resolveTarget(m),a=st(st({},s),{actions:Od(ro(s.actions)),cond:Cx(s.cond,b),target:M,source:this,internal:v,eventType:s.event,toJSON:function(){return st(st({},a),{target:a.target?a.target.map(function(L){return"#".concat(L.id)}):void 0,source:"#".concat(h.id)})}});return a},n.prototype.formatTransitions=function(){var s,h,m=this,v;if(!this.config.on)v=[];else if(Array.isArray(this.config.on))v=this.config.on;else{var b=this.config.on,M=Qc,a=b[M],L=a===void 0?[]:a,F=wm(b,[typeof M=="symbol"?M:M+""]);v=Xr(Object.keys(F).map(function(E){!Jc&&E===Ll&&hu(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(m.id,'".'));var ye=Ml(E,F[E]);return Jc||WE(m,E,ye),ye}).concat(Ml(Qc,L)))}var B=this.config.always?Ml("",this.config.always):[],j=this.config.onDone?Ml(String(id(this.id)),this.config.onDone):[];Jc||hu(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var q=Xr(this.invoke.map(function(E){var ye=[];return E.onDone&&ye.push.apply(ye,ii([],Er(Ml(String(wd(E.id)),E.onDone)),!1)),E.onError&&ye.push.apply(ye,ii([],Er(Ml(String(su(E.id)),E.onError)),!1)),ye})),G=this.after,he=Xr(ii(ii(ii(ii([],Er(j),!1),Er(q),!1),Er(v),!1),Er(B),!1).map(function(E){return ro(E).map(function(ye){return m.formatTransition(ye)})}));try{for(var be=hr(G),we=be.next();!we.done;we=be.next()){var Ie=we.value;he.push(Ie)}}catch(E){s={error:E}}finally{try{we&&!we.done&&(h=be.return)&&h.call(be)}finally{if(s)throw s.error}}return he},n}();function HE(n,s,h){return h===void 0&&(h=n.context),new XE(n,s,h)}var KE=AE,rm;(function(n){n[n.Effect=1]="Effect",n[n.LayoutEffect=2]="LayoutEffect"})(rm||(rm={}));var fu=Xl;function ky(n){var s=kt();return s.current||(s.current={v:n()}),s.current.v}var YE=globalThis&&globalThis.__read||function(n,s){var h=typeof Symbol=="function"&&n[Symbol.iterator];if(!h)return n;var m=h.call(n),v,b=[],M;try{for(;(s===void 0||s-- >0)&&!(v=m.next()).done;)b.push(v.value)}catch(a){M={error:a}}finally{try{v&&!v.done&&(h=m.return)&&h.call(m)}finally{if(M)throw M.error}}return b},JE=globalThis&&globalThis.__values||function(n){var s=typeof Symbol=="function"&&Symbol.iterator,h=s&&n[s],m=0;if(h)return h.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&m>=n.length&&(n=void 0),{value:n&&n[m++],done:!n}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};function QE(n,s){var h,m,v=YE([[],[]],2),b=v[0],M=v[1];try{for(var a=JE(n),L=a.next();!L.done;L=a.next()){var F=L.value;s(F)?b.push(F):M.push(F)}}catch(B){h={error:B}}finally{try{L&&!L.done&&(m=a.return)&&m.call(a)}finally{if(h)throw h.error}}return[b,M]}var eu=globalThis&&globalThis.__read||function(n,s){var h=typeof Symbol=="function"&&n[Symbol.iterator];if(!h)return n;var m=h.call(n),v,b=[],M;try{for(;(s===void 0||s-- >0)&&!(v=m.next()).done;)b.push(v.value)}catch(a){M={error:a}}finally{try{v&&!v.done&&(h=m.return)&&h.call(m)}finally{if(M)throw M.error}}return b},zy=globalThis&&globalThis.__spreadArray||function(n,s,h){if(h||arguments.length===2)for(var m=0,v=s.length,b;m<v;m++)(b||!(m in s))&&(b||(b=Array.prototype.slice.call(s,0,m)),b[m]=s[m]);return n.concat(b||Array.prototype.slice.call(s))};function Py(n,s){var h=n.exec,m=h(s.context,s._event.data,{action:n,state:s,_event:s._event});m()}function eS(n){var s=kt([]),h=kt([]);fu(function(){var m=n.subscribe(function(v){var b,M;if(v.actions.length){var a=v.actions.filter(function(j){return typeof j.exec=="function"&&"__effect"in j.exec}),L=eu(QE(a,function(j){return j.exec.__effect===rm.Effect}),2),F=L[0],B=L[1];(b=s.current).push.apply(b,zy([],eu(F.map(function(j){return[j,v]})),!1)),(M=h.current).push.apply(M,zy([],eu(B.map(function(j){return[j,v]})),!1))}});return function(){m.unsubscribe()}},[]),fu(function(){for(;h.current.length;){var m=eu(h.current.shift(),2),v=m[0],b=m[1];Py(v,b)}}),gr(function(){for(;s.current.length;){var m=eu(s.current.shift(),2),v=m[0],b=m[1];Py(v,b)}})}var pu=globalThis&&globalThis.__assign||function(){return pu=Object.assign||function(n){for(var s,h=1,m=arguments.length;h<m;h++){s=arguments[h];for(var v in s)Object.prototype.hasOwnProperty.call(s,v)&&(n[v]=s[v])}return n},pu.apply(this,arguments)},tS=globalThis&&globalThis.__rest||function(n,s){var h={};for(var m in n)Object.prototype.hasOwnProperty.call(n,m)&&s.indexOf(m)<0&&(h[m]=n[m]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var v=0,m=Object.getOwnPropertySymbols(n);v<m.length;v++)s.indexOf(m[v])<0&&Object.prototype.propertyIsEnumerable.call(n,m[v])&&(h[m[v]]=n[m[v]]);return h};globalThis&&globalThis.__read;function rS(n,s,h){if(typeof n=="object")return n;var m=function(){};return{next:n,error:s||m,complete:h||m}}function iS(n,s,h){s===void 0&&(s={});var m=ky(function(){return typeof n=="function"?n():n}),v=s.context,b=s.guards,M=s.actions,a=s.activities,L=s.services,F=s.delays,B=s.state,j=tS(s,["context","guards","actions","activities","services","delays","state"]),q=ky(function(){var G={context:v,guards:b,actions:M,activities:a,services:L,delays:F},he=m.withConfig(G,function(){return pu(pu({},m.context),v)});return Rx(he,pu({deferEvents:!0},j))});return fu(function(){var G;return h&&(G=q.subscribe(rS(h))),function(){G==null||G.unsubscribe()}},[h]),fu(function(){return q.start(B?io.create(B):void 0),function(){q.stop()}},[]),fu(function(){Object.assign(q.machine.options.actions,M),Object.assign(q.machine.options.guards,b),Object.assign(q.machine.options.activities,a),Object.assign(q.machine.options.services,L),Object.assign(q.machine.options.delays,F)},[M,b,a,L,F]),eS(q),q}var nS=globalThis&&globalThis.__read||function(n,s){var h=typeof Symbol=="function"&&n[Symbol.iterator];if(!h)return n;var m=h.call(n),v,b=[],M;try{for(;(s===void 0||s-- >0)&&!(v=m.next()).done;)b.push(v.value)}catch(a){M={error:a}}finally{try{v&&!v.done&&(h=m.return)&&h.call(m)}finally{if(M)throw M.error}}return b};globalThis&&globalThis.__spreadArray;function oS(n,s){s===void 0&&(s={});var h=ur(function(a){var L=a.changed===void 0&&Object.keys(a.children).length;(a.changed||L)&&M(a)},[]),m=iS(n,s,h),v=nS(qn(function(){var a=m.machine.initialState;return s.state?io.create(s.state):a}),2),b=v[0],M=v[1];return[b,m.send,m]}function ni(){return ni=Object.assign||function(n){for(var s=1;s<arguments.length;s++){var h=arguments[s];for(var m in h)Object.prototype.hasOwnProperty.call(h,m)&&(n[m]=h[m])}return n},ni.apply(this,arguments)}function Fl(n,s){if(n==null)return{};var h={},m=Object.keys(n),v,b;for(b=0;b<m.length;b++)v=m[b],!(s.indexOf(v)>=0)&&(h[v]=n[v]);return h}const Kt={arr:Array.isArray,obj:n=>Object.prototype.toString.call(n)==="[object Object]",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",und:n=>n===void 0,nul:n=>n===null,set:n=>n instanceof Set,map:n=>n instanceof Map,equ(n,s){if(typeof n!=typeof s)return!1;if(Kt.str(n)||Kt.num(n))return n===s;if(Kt.obj(n)&&Kt.obj(s)&&Object.keys(n).length+Object.keys(s).length===0)return!0;let h;for(h in n)if(!(h in s))return!1;for(h in s)if(n[h]!==s[h])return!1;return Kt.und(h)?n===s:!0}};function sS(n,s){return s===void 0&&(s=!0),h=>(Kt.arr(h)?h:Object.keys(h)).reduce((m,v)=>{const b=s?v[0].toLowerCase()+v.substring(1):v;return m[b]=n(b),m},n)}function aS(){const n=qn(!1),s=n[1];return ur(()=>s(m=>!m),[])}function _a(n,s){return Kt.und(n)||Kt.nul(n)?s:n}function sd(n){return Kt.und(n)?[]:Kt.arr(n)?n:[n]}function Rl(n){for(var s=arguments.length,h=new Array(s>1?s-1:0),m=1;m<s;m++)h[m-1]=arguments[m];return Kt.fun(n)?n(...h):n}function lS(n){return n.to,n.from,n.config,n.onStart,n.onRest,n.onFrame,n.children,n.reset,n.reverse,n.force,n.immediate,n.delay,n.attach,n.destroyed,n.interpolateTo,n.ref,n.lazy,Fl(n,["to","from","config","onStart","onRest","onFrame","children","reset","reverse","force","immediate","delay","attach","destroyed","interpolateTo","ref","lazy"])}function zp(n){const s=lS(n);if(Kt.und(s))return ni({to:s},n);const h=Object.keys(n).reduce((m,v)=>Kt.und(s[v])?ni({},m,{[v]:n[v]}):m,{});return ni({to:s},h)}function cS(n,s){return s&&(Kt.fun(s)?s(n):Kt.obj(s)&&(s.current=n)),n}class no{constructor(){this.payload=void 0,this.children=[]}getAnimatedValue(){return this.getValue()}getPayload(){return this.payload||this}attach(){}detach(){}getChildren(){return this.children}addChild(s){this.children.length===0&&this.attach(),this.children.push(s)}removeChild(s){const h=this.children.indexOf(s);this.children.splice(h,1),this.children.length===0&&this.detach()}}class im extends no{constructor(){super(...arguments);this.payload=[],this.attach=()=>this.payload.forEach(s=>s instanceof no&&s.addChild(this)),this.detach=()=>this.payload.forEach(s=>s instanceof no&&s.removeChild(this))}}class Ox extends no{constructor(){super(...arguments);this.payload={},this.attach=()=>Object.values(this.payload).forEach(s=>s instanceof no&&s.addChild(this)),this.detach=()=>Object.values(this.payload).forEach(s=>s instanceof no&&s.removeChild(this))}getValue(s){s===void 0&&(s=!1);const h={};for(const m in this.payload){const v=this.payload[m];s&&!(v instanceof no)||(h[m]=v instanceof no?v[s?"getAnimatedValue":"getValue"]():v)}return h}getAnimatedValue(){return this.getValue(!0)}}let Mm;function uS(n,s){Mm={fn:n,transform:s}}let Bx;function hS(n){Bx=n}let Fx=n=>typeof window!="undefined"?window.requestAnimationFrame(n):-1,Fd;function dS(n){Fd=n}let Nx=()=>Date.now(),fS=n=>n.current,Ux;function pS(n){Ux=n}class mS extends Ox{constructor(s,h){super();this.update=void 0,this.payload=s.style?ni({},s,{style:Ux(s.style)}):s,this.update=h,this.attach()}}const _S=n=>Kt.fun(n)&&!(n.prototype instanceof yn.Component),gS=n=>Mu((h,m)=>{const v=aS(),b=kt(!0),M=kt(null),a=kt(null),L=ur(q=>{const G=M.current,he=()=>{let be=!1;a.current&&(be=Mm.fn(a.current,M.current.getAnimatedValue())),(!a.current||be===!1)&&v()};M.current=new mS(q,he),G&&G.detach()},[]);gr(()=>()=>{b.current=!1,M.current&&M.current.detach()},[]),Hl(m,()=>fS(a)),L(h);const F=M.current.getValue();F.scrollTop,F.scrollLeft;const B=Fl(F,["scrollTop","scrollLeft"]),j=_S(n)?void 0:q=>a.current=cS(q,m);return yn.createElement(n,ni({},B,{ref:j}))});let mu=!1;const va=new Set,jx=()=>{if(!mu)return!1;let n=Nx();for(let s of va){let h=!1;for(let m=0;m<s.configs.length;m++){let v=s.configs[m],b,M;for(let a=0;a<v.animatedValues.length;a++){let L=v.animatedValues[a];if(L.done)continue;let F=v.fromValues[a],B=v.toValues[a],j=L.lastPosition,q=B instanceof no,G=Array.isArray(v.initialVelocity)?v.initialVelocity[a]:v.initialVelocity;if(q&&(B=B.getValue()),v.immediate){L.setValue(B),L.done=!0;continue}if(typeof F=="string"||typeof B=="string"){L.setValue(B),L.done=!0;continue}if(v.duration!==void 0)j=F+v.easing((n-L.startTime)/v.duration)*(B-F),b=n>=L.startTime+v.duration;else if(v.decay)j=F+G/(1-.998)*(1-Math.exp(-(1-.998)*(n-L.startTime))),b=Math.abs(L.lastPosition-j)<.1,b&&(B=j);else{M=L.lastTime!==void 0?L.lastTime:n,G=L.lastVelocity!==void 0?L.lastVelocity:v.initialVelocity,n>M+64&&(M=n);let he=Math.floor(n-M);for(let E=0;E<he;++E){let ye=-v.tension*(j-B),Le=-v.friction*G,Re=(ye+Le)/v.mass;G=G+Re*1/1e3,j=j+G*1/1e3}let be=v.clamp&&v.tension!==0?F<B?j>B:j<B:!1,we=Math.abs(G)<=v.precision,Ie=v.tension!==0?Math.abs(B-j)<=v.precision:!0;b=be||we&&Ie,L.lastVelocity=G,L.lastTime=n}q&&!v.toValues[a].done&&(b=!1),b?(L.value!==B&&(j=B),L.done=!0):h=!0,L.setValue(j),L.lastPosition=j}s.props.onFrame&&(s.values[v.name]=v.interpolation.getValue())}s.props.onFrame&&s.props.onFrame(s.values),h||(va.delete(s),s.stop(!0))}return va.size?Fx(jx):mu=!1,mu},yS=n=>{va.has(n)||va.add(n),mu||(mu=!0,Fx(jx))},vS=n=>{va.has(n)&&va.delete(n)};function Nd(n,s,h){if(typeof n=="function")return n;if(Array.isArray(n))return Nd({range:n,output:s,extrapolate:h});if(Fd&&typeof n.output[0]=="string")return Fd(n);const m=n,v=m.output,b=m.range||[0,1],M=m.extrapolateLeft||m.extrapolate||"extend",a=m.extrapolateRight||m.extrapolate||"extend",L=m.easing||(F=>F);return F=>{const B=bS(F,b);return xS(F,b[B],b[B+1],v[B],v[B+1],L,M,a,m.map)}}function xS(n,s,h,m,v,b,M,a,L){let F=L?L(n):n;if(F<s){if(M==="identity")return F;M==="clamp"&&(F=s)}if(F>h){if(a==="identity")return F;a==="clamp"&&(F=h)}return m===v?m:s===h?n<=s?m:v:(s===-1/0?F=-F:h===1/0?F=F-s:F=(F-s)/(h-s),F=b(F),m===-1/0?F=-F:v===1/0?F=F+m:F=F*(v-m)+m,F)}function bS(n,s){for(var h=1;h<s.length-1&&!(s[h]>=n);++h);return h-1}class Zl extends im{constructor(s,h,m,v){super();this.calc=void 0,this.payload=s instanceof im&&!(s instanceof Zl)?s.getPayload():Array.isArray(s)?s:[s],this.calc=Nd(h,m,v)}getValue(){return this.calc(...this.payload.map(s=>s.getValue()))}updateConfig(s,h,m){this.calc=Nd(s,h,m)}interpolate(s,h,m){return new Zl(this,s,h,m)}}const zl=(n,s,h)=>n&&new Zl(n,s,h),wS={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}};function Vx(n,s){"update"in n?s.add(n):n.getChildren().forEach(h=>Vx(h,s))}class nm extends no{constructor(s){var h;super();h=this,this.animatedStyles=new Set,this.value=void 0,this.startPosition=void 0,this.lastPosition=void 0,this.lastVelocity=void 0,this.startTime=void 0,this.lastTime=void 0,this.done=!1,this.setValue=function(m,v){v===void 0&&(v=!0),h.value=m,v&&h.flush()},this.value=s,this.startPosition=s,this.lastPosition=s}flush(){this.animatedStyles.size===0&&Vx(this,this.animatedStyles),this.animatedStyles.forEach(s=>s.update())}clearStyles(){this.animatedStyles.clear()}getValue(){return this.value}interpolate(s,h,m){return new Zl(this,s,h,m)}}class TS extends im{constructor(s){super();this.payload=s.map(h=>new nm(h))}setValue(s,h){h===void 0&&(h=!0),Array.isArray(s)?s.length===this.payload.length&&s.forEach((m,v)=>this.payload[v].setValue(m,h)):this.payload.forEach(m=>m.setValue(s,h))}getValue(){return this.payload.map(s=>s.getValue())}interpolate(s,h){return new Zl(this,s,h)}}let ES=0;class SS{constructor(){this.id=void 0,this.idle=!0,this.hasChanged=!1,this.guid=0,this.local=0,this.props={},this.merged={},this.animations={},this.interpolations={},this.values={},this.configs=[],this.listeners=[],this.queue=[],this.localQueue=void 0,this.getValues=()=>this.interpolations,this.id=ES++}update(s){if(!s)return this;const h=zp(s),m=h.delay,v=m===void 0?0:m,b=h.to,M=Fl(h,["delay","to"]);if(Kt.arr(b)||Kt.fun(b))this.queue.push(ni({},M,{delay:v,to:b}));else if(b){let a={};Object.entries(b).forEach(L=>{let F=L[0],B=L[1];const j=ni({to:{[F]:B},delay:Rl(v,F)},M),q=a[j.delay]&&a[j.delay].to;a[j.delay]=ni({},a[j.delay],j,{to:ni({},q,j.to)})}),this.queue=Object.values(a)}return this.queue=this.queue.sort((a,L)=>a.delay-L.delay),this.diff(M),this}start(s){if(this.queue.length){this.idle=!1,this.localQueue&&this.localQueue.forEach(v=>{let b=v.from,M=b===void 0?{}:b,a=v.to,L=a===void 0?{}:a;Kt.obj(M)&&(this.merged=ni({},M,this.merged)),Kt.obj(L)&&(this.merged=ni({},this.merged,L))});const h=this.local=++this.guid,m=this.localQueue=this.queue;this.queue=[],m.forEach((v,b)=>{let M=v.delay,a=Fl(v,["delay"]);const L=B=>{b===m.length-1&&h===this.guid&&B&&(this.idle=!0,this.props.onRest&&this.props.onRest(this.merged)),s&&s()};let F=Kt.arr(a.to)||Kt.fun(a.to);M?setTimeout(()=>{h===this.guid&&(F?this.runAsync(a,L):this.diff(a).start(L))},M):F?this.runAsync(a,L):this.diff(a).start(L)})}else Kt.fun(s)&&this.listeners.push(s),this.props.onStart&&this.props.onStart(),yS(this);return this}stop(s){return this.listeners.forEach(h=>h(s)),this.listeners=[],this}pause(s){return this.stop(!0),s&&vS(this),this}runAsync(s,h){var m=this;s.delay;let v=Fl(s,["delay"]);const b=this.local;let M=Promise.resolve(void 0);if(Kt.arr(v.to))for(let a=0;a<v.to.length;a++){const L=a,F=ni({},v,zp(v.to[L]));Kt.arr(F.config)&&(F.config=F.config[L]),M=M.then(()=>{if(b===this.guid)return new Promise(B=>this.diff(F).start(B))})}else if(Kt.fun(v.to)){let a=0,L;M=M.then(()=>v.to(F=>{const B=ni({},v,zp(F));if(Kt.arr(B.config)&&(B.config=B.config[a]),a++,b===this.guid)return L=new Promise(j=>this.diff(B).start(j))},function(F){return F===void 0&&(F=!0),m.stop(F)}).then(()=>L))}M.then(h)}diff(s){this.props=ni({},this.props,s);let h=this.props,m=h.from,v=m===void 0?{}:m,b=h.to,M=b===void 0?{}:b,a=h.config,L=a===void 0?{}:a,F=h.reverse,B=h.attach,j=h.reset,q=h.immediate;if(F){var G=[M,v];v=G[0],M=G[1]}this.merged=ni({},v,this.merged,M),this.hasChanged=!1;let he=B&&B(this);if(this.animations=Object.entries(this.merged).reduce((be,we)=>{let Ie=we[0],E=we[1],ye=be[Ie]||{};const Le=Kt.num(E),Re=Kt.str(E)&&!E.startsWith("#")&&!/\d/.test(E)&&!Bx[E],xe=Kt.arr(E),Se=!Le&&!xe&&!Re;let Be=Kt.und(v[Ie])?E:v[Ie],Ye=Le||xe||Re?E:1,it=Rl(L,Ie);he&&(Ye=he.animations[Ie].parent);let at=ye.parent,wt=ye.interpolation,dr=sd(he?Ye.getPayload():Ye),Sr,Ut=E;Se&&(Ut=Fd({range:[0,1],output:[E,E]})(1));let $r=wt&&wt.getValue();const At=!Kt.und(at)&&ye.animatedValues.some(pr=>!pr.done),fr=!Kt.equ(Ut,$r),Or=!Kt.equ(Ut,ye.previous),Tt=!Kt.equ(it,ye.config);if(j||Or&&fr||Tt){if(Le||Re)at=wt=ye.parent||new nm(Be);else if(xe)at=wt=ye.parent||new TS(Be);else if(Se){let pr=ye.interpolation&&ye.interpolation.calc(ye.parent.value);pr=pr!==void 0&&!j?pr:Be,ye.parent?(at=ye.parent,at.setValue(0,!1)):at=new nm(0);const Ui={output:[pr,E]};ye.interpolation?(wt=ye.interpolation,ye.interpolation.updateConfig(Ui)):wt=at.interpolate(Ui)}return dr=sd(he?Ye.getPayload():Ye),Sr=sd(at.getPayload()),j&&!Se&&at.setValue(Be,!1),this.hasChanged=!0,Sr.forEach(pr=>{pr.startPosition=pr.value,pr.lastPosition=pr.value,pr.lastVelocity=At?pr.lastVelocity:void 0,pr.lastTime=At?pr.lastTime:void 0,pr.startTime=Nx(),pr.done=!1,pr.animatedStyles.clear()}),Rl(q,Ie)&&at.setValue(Se?Ye:E,!1),ni({},be,{[Ie]:ni({},ye,{name:Ie,parent:at,interpolation:wt,animatedValues:Sr,toValues:dr,previous:Ut,config:it,fromValues:sd(at.getValue()),immediate:Rl(q,Ie),initialVelocity:_a(it.velocity,0),clamp:_a(it.clamp,!1),precision:_a(it.precision,.01),tension:_a(it.tension,170),friction:_a(it.friction,26),mass:_a(it.mass,1),duration:it.duration,easing:_a(it.easing,pr=>pr),decay:it.decay})})}else return fr?be:(Se&&(at.setValue(1,!1),wt.updateConfig({output:[Ut,Ut]})),at.done=!0,this.hasChanged=!0,ni({},be,{[Ie]:ni({},be[Ie],{previous:Ut})}))},this.animations),this.hasChanged){this.configs=Object.values(this.animations),this.values={},this.interpolations={};for(let be in this.animations)this.interpolations[be]=this.animations[be].interpolation,this.values[be]=this.animations[be].interpolation.getValue()}return this}destroy(){this.stop(),this.props={},this.merged={},this.animations={},this.interpolations={},this.values={},this.configs=[],this.local=0}}const AS=(n,s)=>{const h=kt(!1),m=kt(),v=Kt.fun(s),b=en(()=>{m.current&&(m.current.map(j=>j.destroy()),m.current=void 0);let B;return[new Array(n).fill().map((j,q)=>{const G=new SS,he=v?Rl(s,q,G):s[q];return q===0&&(B=he.ref),G.update(he),B||G.start(),G}),B]},[n]),M=b[0],a=b[1];m.current=M,Hl(a,()=>({start:()=>Promise.all(m.current.map(B=>new Promise(j=>B.start(j)))),stop:B=>m.current.forEach(j=>j.stop(B)),get controllers(){return m.current}}));const L=en(()=>B=>m.current.map((j,q)=>{j.update(v?Rl(B,q,j):B[q]),a||j.start()}),[n]);gr(()=>{h.current?v||L(s):a||m.current.forEach(B=>B.start())}),gr(()=>(h.current=!0,()=>m.current.forEach(B=>B.destroy())),[]);const F=m.current.map(B=>B.getValues());return v?[F,L,B=>m.current.forEach(j=>j.pause(B))]:F},CS=n=>{const s=Kt.fun(n),h=AS(1,s?n:[n]),m=h[0],v=h[1],b=h[2];return s?[m[0],v,b]:m};class MS extends Ox{constructor(s){s===void 0&&(s={});super();s.transform&&!(s.transform instanceof no)&&(s=Mm.transform(s)),this.payload=s}}const Ud={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},so="[-+]?\\d*\\.?\\d+",jd=so+"%";function Kd(){for(var n=arguments.length,s=new Array(n),h=0;h<n;h++)s[h]=arguments[h];return"\\(\\s*("+s.join(")\\s*,\\s*(")+")\\s*\\)"}const IS=new RegExp("rgb"+Kd(so,so,so)),kS=new RegExp("rgba"+Kd(so,so,so,so)),zS=new RegExp("hsl"+Kd(so,jd,jd)),PS=new RegExp("hsla"+Kd(so,jd,jd,so)),DS=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,LS=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,RS=/^#([0-9a-fA-F]{6})$/,OS=/^#([0-9a-fA-F]{8})$/;function BS(n){let s;return typeof n=="number"?n>>>0===n&&n>=0&&n<=4294967295?n:null:(s=RS.exec(n))?parseInt(s[1]+"ff",16)>>>0:Ud.hasOwnProperty(n)?Ud[n]:(s=IS.exec(n))?(Pl(s[1])<<24|Pl(s[2])<<16|Pl(s[3])<<8|255)>>>0:(s=kS.exec(n))?(Pl(s[1])<<24|Pl(s[2])<<16|Pl(s[3])<<8|Ry(s[4]))>>>0:(s=DS.exec(n))?parseInt(s[1]+s[1]+s[2]+s[2]+s[3]+s[3]+"ff",16)>>>0:(s=OS.exec(n))?parseInt(s[1],16)>>>0:(s=LS.exec(n))?parseInt(s[1]+s[1]+s[2]+s[2]+s[3]+s[3]+s[4]+s[4],16)>>>0:(s=zS.exec(n))?(Dy(Ly(s[1]),ad(s[2]),ad(s[3]))|255)>>>0:(s=PS.exec(n))?(Dy(Ly(s[1]),ad(s[2]),ad(s[3]))|Ry(s[4]))>>>0:null}function Pp(n,s,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?n+(s-n)*6*h:h<1/2?s:h<2/3?n+(s-n)*(2/3-h)*6:n}function Dy(n,s,h){const m=h<.5?h*(1+s):h+s-h*s,v=2*h-m,b=Pp(v,m,n+1/3),M=Pp(v,m,n),a=Pp(v,m,n-1/3);return Math.round(b*255)<<24|Math.round(M*255)<<16|Math.round(a*255)<<8}function Pl(n){const s=parseInt(n,10);return s<0?0:s>255?255:s}function Ly(n){return(parseFloat(n)%360+360)%360/360}function Ry(n){const s=parseFloat(n);return s<0?0:s>1?255:Math.round(s*255)}function ad(n){const s=parseFloat(n);return s<0?0:s>100?1:s/100}function Oy(n){let s=BS(n);if(s===null)return n;s=s||0;let h=(s&4278190080)>>>24,m=(s&16711680)>>>16,v=(s&65280)>>>8,b=(s&255)/255;return`rgba(${h}, ${m}, ${v}, ${b})`}const ld=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,FS=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,NS=new RegExp(`(${Object.keys(Ud).join("|")})`,"g"),US=n=>{const s=n.output.map(v=>v.replace(FS,Oy)).map(v=>v.replace(NS,Oy)),h=s[0].match(ld).map(()=>[]);s.forEach(v=>{v.match(ld).forEach((b,M)=>h[M].push(+b))});const m=s[0].match(ld).map((v,b)=>Nd(ni({},n,{output:h[b]})));return v=>{let b=0;return s[0].replace(ld,()=>m[b++](v)).replace(/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,(M,a,L,F,B)=>`rgba(${Math.round(a)}, ${Math.round(L)}, ${Math.round(F)}, ${B})`)}};let _u={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};const jS=(n,s)=>n+s.charAt(0).toUpperCase()+s.substring(1),VS=["Webkit","Ms","Moz","O"];_u=Object.keys(_u).reduce((n,s)=>(VS.forEach(h=>n[jS(h,s)]=n[s]),n),_u);function $S(n,s,h){return s==null||typeof s=="boolean"||s===""?"":!h&&typeof s=="number"&&s!==0&&!(_u.hasOwnProperty(n)&&_u[n])?s+"px":(""+s).trim()}const By={};pS(n=>new MS(n));dS(US);hS(Ud);uS((n,s)=>{if(n.nodeType&&n.setAttribute!==void 0){const v=s.style,b=s.children,M=s.scrollTop,a=s.scrollLeft,L=Fl(s,["style","children","scrollTop","scrollLeft"]),F=n.nodeName==="filter"||n.parentNode&&n.parentNode.nodeName==="filter";M!==void 0&&(n.scrollTop=M),a!==void 0&&(n.scrollLeft=a),b!==void 0&&(n.textContent=b);for(let B in v)if(!!v.hasOwnProperty(B)){var h=B.indexOf("--")===0,m=$S(B,v[B],h);B==="float"&&(B="cssFloat"),h?n.style.setProperty(B,m):n.style[B]=m}for(let B in L){const j=F?B:By[B]||(By[B]=B.replace(/([A-Z])/g,q=>"-"+q.toLowerCase()));typeof n.getAttribute(j)!="undefined"&&n.setAttribute(j,L[B])}return}else return!1},n=>n);const GS=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],qS=sS(gS,!1),ZS=qS(GS);function Fy(n,s){return n.map(function(h,m){return h+s[m]})}function $x(n,s){return n.map(function(h,m){return h-s[m]})}function om(n){return Math.hypot.apply(Math,n)}function WS(n,s,h){var m=om(s),v=m===0?0:1/m,b=h===0?0:1/h,M=b*m,a=s.map(function(B){return b*B}),L=s.map(function(B){return v*B}),F=om(n);return{velocities:a,velocity:M,distance:F,direction:L}}function sm(n){return Math.sign?Math.sign(n):Number(n>0)-Number(n<0)||+n}function XS(n,s,h){return Math.max(s,Math.min(n,h))}function HS(n,s){return Math.pow(n,s*5)}function Ny(n,s,h){return s===0||Math.abs(s)===1/0?HS(n,h):n*s*h/(s+h*n)}function gu(n,s,h,m){return m===void 0&&(m=.15),m===0?XS(n,s,h):n<s?-Ny(s-n,h-s,m)+s:n>h?+Ny(n-h,h-s,m)+h:n}function Uy(n,s){for(var h=0;h<s.length;h++){var m=s[h];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(n,m.key,m)}}function KS(n,s,h){return s&&Uy(n.prototype,s),h&&Uy(n,h),n}function Ji(){return Ji=Object.assign||function(n){for(var s=1;s<arguments.length;s++){var h=arguments[s];for(var m in h)Object.prototype.hasOwnProperty.call(h,m)&&(n[m]=h[m])}return n},Ji.apply(this,arguments)}function Gx(n,s){n.prototype=Object.create(s.prototype),n.prototype.constructor=n,n.__proto__=s}function YS(n,s){if(n==null)return{};var h={},m=Object.keys(n),v,b;for(b=0;b<m.length;b++)v=m[b],!(s.indexOf(v)>=0)&&(h[v]=n[v]);return h}function cd(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function JS(n,s){if(!!n){if(typeof n=="string")return jy(n,s);var h=Object.prototype.toString.call(n).slice(8,-1);if(h==="Object"&&n.constructor&&(h=n.constructor.name),h==="Map"||h==="Set")return Array.from(n);if(h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h))return jy(n,s)}}function jy(n,s){(s==null||s>n.length)&&(s=n.length);for(var h=0,m=new Array(s);h<s;h++)m[h]=n[h];return m}function Yd(n,s){var h;if(typeof Symbol=="undefined"||n[Symbol.iterator]==null){if(Array.isArray(n)||(h=JS(n))||s&&n&&typeof n.length=="number"){h&&(n=h);var m=0;return function(){return m>=n.length?{done:!0}:{done:!1,value:n[m++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return h=n[Symbol.iterator](),h.next.bind(h)}function qx(){}function Zx(){for(var n=arguments.length,s=new Array(n),h=0;h<n;h++)s[h]=arguments[h];return s.length===0?qx:s.length===1?s[0]:function(){for(var m,v=Yd(s),b;!(b=v()).done;){var M=b.value;m=M.apply(this,arguments)||m}return m}}function Cs(n,s){if(n===void 0){if(s===void 0)throw new Error("Must define fallback value if undefined is expected");n=s}return Array.isArray(n)?n:[n,n]}function ud(n){if(typeof n=="function"){for(var s=arguments.length,h=new Array(s>1?s-1:0),m=1;m<s;m++)h[m-1]=arguments[m];return n.apply(void 0,h)}else return n}function Im(n,s){n===void 0&&(n={});for(var h={},m=0,v=Object.entries(s);m<v.length;m++){var b=v[m],M=b[0],a=b[1];switch(typeof a){case"function":h[M]=a.call(h,n[M],M,n);break;case"object":h[M]=Im(n[M],a);break;case"boolean":a&&(h[M]=n[M]);break}}return h}var QS=180,eA=.15,tA=.5,rA=60,iA={threshold:function(s){return s===void 0&&(s=0),Cs(s)},rubberband:function(s){switch(s===void 0&&(s=0),s){case!0:return Cs(eA);case!1:return Cs(0);default:return Cs(s)}},enabled:function(s){return s===void 0&&(s=!0),s},triggerAllEvents:function(s){return s===void 0&&(s=!1),s},initial:function(s){return s===void 0&&(s=0),typeof s=="function"?s:Cs(s)}},Wx=Ji({},iA,{axis:!0,lockDirection:function(s){return s===void 0&&(s=!1),s},bounds:function(s){if(s===void 0&&(s={}),typeof s=="function")return function(j){return Wx.bounds(s(j))};var h=s,m=h.left,v=m===void 0?-1/0:m,b=h.right,M=b===void 0?1/0:b,a=h.top,L=a===void 0?-1/0:a,F=h.bottom,B=F===void 0?1/0:F;return[[v,M],[L,B]]}}),nA=typeof window!="undefined"&&window.document&&window.document.createElement,oA={enabled:function(s){return s===void 0&&(s=!0),s},domTarget:!0,window:function(n){function s(h){return n.apply(this,arguments)}return s.toString=function(){return n.toString()},s}(function(n){return n===void 0&&(n=nA?window:void 0),n}),eventOptions:function(s){var h=s===void 0?{}:s,m=h.passive,v=m===void 0?!0:m,b=h.capture,M=b===void 0?!1:b;return{passive:v,capture:M}}},sA=Ji({},Wx,{threshold:function(s,h,m){var v=m.filterTaps,b=v===void 0?!1:v,M=m.lockDirection,a=M===void 0?!1:M,L=m.axis,F=L===void 0?void 0:L,B=Cs(s,b?3:a||F?1:0);return this.filterTaps=b||B[0]+B[1]>0,B},swipeVelocity:function(s){return s===void 0&&(s=tA),Cs(s)},swipeDistance:function(s){return s===void 0&&(s=rA),Cs(s)},delay:function(s){switch(s===void 0&&(s=0),s){case!0:return QS;case!1:return 0;default:return s}}});function aA(n){return n===void 0&&(n={}),Im(n,oA)}function lA(n){return n===void 0&&(n={}),Im(n,sA)}function cA(n){var s=n.domTarget,h=n.eventOptions,m=n.window,v=n.enabled,b=YS(n,["domTarget","eventOptions","window","enabled"]),M=aA({domTarget:s,eventOptions:h,window:m,enabled:v});return M.drag=lA(b),M}function tu(n){return Ji({_active:!1,_blocked:!1,_intentional:[!1,!1],_movement:[0,0],_initial:[0,0],_bounds:[[-1/0,1/0],[-1/0,1/0]],_lastEventType:void 0,event:void 0,intentional:!1,values:[0,0],velocities:[0,0],delta:[0,0],movement:[0,0],offset:[0,0],lastOffset:[0,0],direction:[0,0],initial:[0,0],previous:[0,0],first:!1,last:!1,active:!1,timeStamp:0,startTime:0,elapsedTime:0,cancel:qx,canceled:!1,memo:void 0,args:void 0},n)}function Xx(){var n={hovering:!1,scrolling:!1,wheeling:!1,dragging:!1,moving:!1,pinching:!1,touches:0,buttons:0,down:!1,shiftKey:!1,altKey:!1,metaKey:!1,ctrlKey:!1},s=tu({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0,_isTap:!0,_delayedEvent:!1,_pointerId:void 0,tap:!1,swipe:[0,0]}),h=tu({da:[0,0],vdva:[0,0],origin:void 0,turns:0}),m=tu({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),v=tu({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),b=tu({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0});return{shared:n,drag:s,pinch:h,wheel:m,move:v,scroll:b}}var ya=new Map,uA=function(){function n(h,m){var v=this;m===void 0&&(m=[]),this.controller=h,this.args=m,this.debounced=!0,this.setTimeout=function(b,M){var a;M===void 0&&(M=140),clearTimeout(v.controller.timeouts[v.stateKey]);for(var L=arguments.length,F=new Array(L>2?L-2:0),B=2;B<L;B++)F[B-2]=arguments[B];v.controller.timeouts[v.stateKey]=(a=window).setTimeout.apply(a,[b,M].concat(F))},this.clearTimeout=function(){clearTimeout(v.controller.timeouts[v.stateKey])},this.fireGestureHandler=function(b){if(b===void 0&&(b=!1),v.state._blocked)return v.debounced||(v.state._active=!1,v.clean()),null;if(!b&&!v.state.intentional&&!v.config.triggerAllEvents)return null;if(v.state.intentional){var M=v.state.active,a=v.state._active;v.state.active=a,v.state.first=a&&!M,v.state.last=M&&!a,v.controller.state.shared[v.ingKey]=a}var L=Ji({},v.controller.state.shared,v.state,v.mapStateValues(v.state)),F=v.handler(L);return v.state.memo=F!==void 0?F:v.state.memo,v.state._active||v.clean(),L}}var s=n.prototype;return s.updateSharedState=function(m){Object.assign(this.controller.state.shared,m)},s.updateGestureState=function(m){Object.assign(this.state,m)},s.checkIntentionality=function(m,v){return{_intentional:m,_blocked:!1}},s.getMovement=function(m){var v=this.config,b=v.initial,M=v.bounds,a=v.rubberband,L=v.threshold,F=this.state,B=F._bounds,j=F._initial,q=F._active,G=F._intentional,he=F.lastOffset,be=F.movement,we=this.getInternalMovement(m,this.state),Ie=G[0]===!1?Vy(we[0],L[0]):G[0],E=G[1]===!1?Vy(we[1],L[1]):G[1],ye=this.checkIntentionality([Ie,E],we);if(ye._blocked)return Ji({},ye,{_movement:we,delta:[0,0]});var Le=ye._intentional,Re=we,xe,Se;if(Le[0]!==!1&&G[0]===!1&&(Se=ud(b,this.state),xe=ud(M,this.state),j[0]=Se[0],B[0]=xe[0]),Le[1]!==!1&&G[1]===!1){var Be,Ye;Se=(Be=Se)!=null?Be:ud(b,this.state),xe=(Ye=xe)!=null?Ye:ud(M,this.state),j[1]=Se[1],B[1]=xe[1]}var it=[Le[0]!==!1?we[0]-Le[0]:j[0],Le[1]!==!1?we[1]-Le[1]:j[1]],at=Fy(it,he),wt=q?a:[0,0];return it=$y(B,Fy(it,j),wt),Ji({},ye,{intentional:Le[0]!==!1||Le[1]!==!1,_initial:j,_movement:Re,movement:it,values:m,offset:$y(B,at,wt),delta:$x(it,be)})},s.clean=function(){this.clearTimeout()},KS(n,[{key:"config",get:function(){return this.controller.config[this.stateKey]}},{key:"enabled",get:function(){return this.controller.config.enabled&&this.config.enabled}},{key:"state",get:function(){return this.controller.state[this.stateKey]}},{key:"handler",get:function(){return this.controller.handlers[this.stateKey]}}]),n}();function Vy(n,s){return Math.abs(n)>=s?sm(n)*s:!1}function $y(n,s,h){var m=s[0],v=s[1],b=h[0],M=h[1],a=n[0],L=a[0],F=a[1],B=n[1],j=B[0],q=B[1];return[gu(m,L,F,b),gu(v,j,q,M)]}function Dp(n,s,h){var m=n.state,v=n.args,b=s.timeStamp,M=s.type,a=m.values,L=h?0:b-m.startTime;return{_lastEventType:M,event:s,timeStamp:b,elapsedTime:L,args:v,previous:a}}function hA(n,s,h){var m=n.state.offset,v=h.timeStamp;return Ji({},Xx()[n.stateKey],{_active:!0,values:s,initial:s,offset:m,lastOffset:m,startTime:v})}function dA(n,s){return function(h){for(var m=arguments.length,v=new Array(m>1?m-1:0),b=1;b<m;b++)v[b-1]=arguments[b];return n.call.apply(n,[this,Ji({},s,{event:h})].concat(v))}}var fA=function(s){var h=this;this.classes=s,this.bind=function(){for(var m={},v=arguments.length,b=new Array(v),M=0;M<v;M++)b[M]=arguments[M];for(var a=Yd(h.classes),L;!(L=a()).done;){var F=L.value;new F(h,b).addBindings(m)}for(var B=0,j=Object.entries(h.nativeRefs);B<j.length;B++){var q=j[B],G=q[0],he=q[1];am(m,G,dA(he,Ji({},h.state.shared,{args:b})))}return h.config.domTarget?gA(h,m):yA(h,m)},this.effect=function(){return h.config.domTarget&&h.bind(),h.clean},this.clean=function(){var m=Kx(h.config),v=h.config.eventOptions;m&&ku(m,Hx(h.domListeners),v),Object.values(h.timeouts).forEach(clearTimeout),pA(h)},this.state=Xx(),this.timeouts={},this.domListeners=[],this.windowListeners={}};function pA(n){var s=n.config,h=s.window,m=s.eventOptions,v=n.windowListeners;if(!!h){for(var b in v){var M=v[b];ku(h,M,m)}n.windowListeners={}}}function mA(n,s){var h=n.config,m=n.windowListeners;!h.window||(ku(h.window,m[s],h.eventOptions),delete m[s])}function _A(n,s,h){var m=n.config,v=n.windowListeners;h===void 0&&(h=[]),m.window&&(ku(m.window,v[s],m.eventOptions),Yx(m.window,v[s]=h,m.eventOptions))}function gA(n,s){var h=n.config,m=n.domListeners,v=Kx(h);if(!v)throw new Error("domTarget must be defined");var b=h.eventOptions;ku(v,Hx(m),b);for(var M=0,a=Object.entries(s);M<a.length;M++){var L=a[M],F=L[0],B=L[1],j=F.slice(2).toLowerCase();m.push([j,Zx.apply(void 0,B)])}Yx(v,m,b)}function yA(n,s){for(var h=n.config,m={},v=h.eventOptions.capture?"Capture":"",b=0,M=Object.entries(s);b<M.length;b++){var a=M[b],L=a[0],F=a[1],B=Array.isArray(F)?F:[F],j=L+v;m[j]=Zx.apply(void 0,B)}return m}function Hx(n){return n===void 0&&(n=[]),n.splice(0,n.length)}function Kx(n){var s=n.domTarget;return s&&"current"in s?s.current:s}function am(n,s,h){n[s]||(n[s]=[]),n[s].push(h)}function Yx(n,s,h){s===void 0&&(s=[]),h===void 0&&(h={});for(var m=Yd(s),v;!(v=m()).done;){var b=v.value,M=b[0],a=b[1];n.addEventListener(M,a,h)}}function ku(n,s,h){s===void 0&&(s=[]),h===void 0&&(h={});for(var m=Yd(s),v;!(v=m()).done;){var b=v.value,M=b[0],a=b[1];n.removeEventListener(M,a,h)}}function vA(n,s,h){h===void 0&&(h={});var m=bA(n),v=yn.useMemo(function(){return new fA(m)},[]);return v.config=s,v.handlers=n,v.nativeRefs=h,yn.useEffect(v.effect,[]),v.config.domTarget?xA:v.bind}function xA(){}function bA(n){var s=new Set;return n.drag&&s.add(ya.get("drag")),n.wheel&&s.add(ya.get("wheel")),n.scroll&&s.add(ya.get("scroll")),n.move&&s.add(ya.get("move")),n.pinch&&s.add(ya.get("pinch")),n.hover&&s.add(ya.get("hover")),s}var wA=function(n){Gx(s,n);function s(){return n.apply(this,arguments)||this}var h=s.prototype;return h.getInternalMovement=function(v,b){return $x(v,b.initial)},h.checkIntentionality=function(v,b){if(v[0]===!1&&v[1]===!1)return{_intentional:v,axis:this.state.axis};var M=b.map(Math.abs),a=M[0],L=M[1],F=this.state.axis||(a>L?"x":a<L?"y":void 0);return!this.config.axis&&!this.config.lockDirection?{_intentional:v,_blocked:!1,axis:F}:F?!!this.config.axis&&F!==this.config.axis?{_intentional:v,_blocked:!0,axis:F}:(v[F==="x"?1:0]=!1,{_intentional:v,_blocked:!1,axis:F}):{_intentional:[!1,!1],_blocked:!1,axis:F}},h.getKinematics=function(v,b){var M=this.getMovement(v);if(!M._blocked){var a=b.timeStamp-this.state.timeStamp;Object.assign(M,WS(M.movement,M.delta,a))}return M},h.mapStateValues=function(v){return{xy:v.values,vxvy:v.velocities}},s}(uA);function Jx(n){if("touches"in n){var s=n.targetTouches,h=n.changedTouches;return s.length>0?s:h}return null}function Gy(n){var s="buttons"in n?n.buttons:0,h=Jx(n),m=h&&h.length||0,v=m>0||s>0,b=n.shiftKey,M=n.altKey,a=n.metaKey,L=n.ctrlKey;return{touches:m,down:v,buttons:s,shiftKey:b,altKey:M,metaKey:a,ctrlKey:L}}function qy(n){var s=Jx(n),h=s?s[0]:n,m=h.clientX,v=h.clientY;return[m,v]}var TA=3,EA=220,SA=function(n){Gx(s,n);function s(){var m;return m=n.apply(this,arguments)||this,m.ingKey="dragging",m.stateKey="drag",m.onDragStart=function(v){!m.enabled||m.state._active||(_A(m.controller,m.stateKey,[["pointermove",m.onDragChange],["pointerup",m.onDragEnd],["pointercancel",m.onDragEnd]]),m.updateGestureState({_pointerId:v.pointerId}),m.config.delay>0?(m.state._delayedEvent=!0,"persist"in v&&typeof v.persist=="function"&&v.persist(),m.setTimeout(m.startDrag.bind(cd(m)),m.config.delay,v)):m.startDrag(v))},m.onDragChange=function(v){if(!m.state.canceled&&v.pointerId===m.state._pointerId){if(!m.state._active){m.state._delayedEvent&&(m.clearTimeout(),m.startDrag(v));return}var b=Gy(v);if(!b.down){m.onDragEnd(v);return}m.updateSharedState(b);var M=qy(v),a=m.getKinematics(M,v),L=Dp(cd(m),v),F=m.state._isTap,B=om(a._movement);F&&B>=TA&&(F=!1),m.updateGestureState(Ji({},L,a,{_isTap:F})),m.fireGestureHandler()}},m.onDragEnd=function(v){if(v.pointerId===m.state._pointerId){m.state._active=!1,m.updateSharedState({down:!1,buttons:0,touches:0});var b=m.state._isTap,M=m.state.velocities,a=M[0],L=M[1],F=m.state.movement,B=F[0],j=F[1],q=m.state._intentional,G=q[0],he=q[1],be=m.config.swipeVelocity,we=be[0],Ie=be[1],E=m.config.swipeDistance,ye=E[0],Le=E[1],Re=Ji({},Dp(cd(m),v),m.getMovement(m.state.values)),xe=[0,0];Re.elapsedTime<EA&&(G!==!1&&Math.abs(a)>we&&Math.abs(B)>ye&&(xe[0]=sm(a)),he!==!1&&Math.abs(L)>Ie&&Math.abs(j)>Le&&(xe[1]=sm(L))),m.updateGestureState(Ji({},Re,{tap:b,swipe:xe})),m.fireGestureHandler(b===!0)}},m.clean=function(){n.prototype.clean.call(cd(m)),m.state._delayedEvent=!1,mA(m.controller,m.stateKey)},m.onCancel=function(){m.state.canceled||(m.updateGestureState({canceled:!0}),m.state._active=!1,m.updateSharedState({down:!1,buttons:0,touches:0}),requestAnimationFrame(function(){return m.fireGestureHandler()}))},m.onClick=function(v){m.state._isTap||v.stopPropagation()},m}var h=s.prototype;return h.startDrag=function(v){var b=qy(v);this.updateSharedState(Gy(v)),this.updateGestureState(Ji({},hA(this,b,v),Dp(this,v,!0),{_pointerId:v.pointerId,cancel:this.onCancel})),this.updateGestureState(this.getMovement(b)),this.fireGestureHandler()},h.addBindings=function(v){if(am(v,"onPointerDown",this.onDragStart),this.config.filterTaps){var b=this.controller.config.eventOptions.capture?"onClick":"onClickCapture";am(v,b,this.onClick)}},s}(wA);function AA(n,s){var h,m=[],v,b=!1;function M(){for(var a=arguments.length,L=new Array(a),F=0;F<a;F++)L[F]=arguments[F];return b&&h===this&&s(L,m)||(v=n.apply(this,L),b=!0,h=this,m=L),v}return M}function Ed(n,s){if(n===s)return!0;if(n&&s&&typeof n=="object"&&typeof s=="object"){if(n.constructor!==s.constructor)return!1;var h,m,v;if(Array.isArray(n)){if(h=n.length,h!==s.length)return!1;for(m=h;m--!==0;)if(!Ed(n[m],s[m]))return!1;return!0}var b;if(typeof Map=="function"&&n instanceof Map&&s instanceof Map){if(n.size!==s.size)return!1;for(b=n.entries();!(m=b.next()).done;)if(!s.has(m.value[0]))return!1;for(b=n.entries();!(m=b.next()).done;)if(!Ed(m.value[1],s.get(m.value[0])))return!1;return!0}if(typeof Set=="function"&&n instanceof Set&&s instanceof Set){if(n.size!==s.size)return!1;for(b=n.entries();!(m=b.next()).done;)if(!s.has(m.value[0]))return!1;return!0}if(n.constructor===RegExp)return n.source===s.source&&n.flags===s.flags;if(n.valueOf!==Object.prototype.valueOf)return n.valueOf()===s.valueOf();if(n.toString!==Object.prototype.toString)return n.toString()===s.toString();if(v=Object.keys(n),h=v.length,h!==Object.keys(s).length)return!1;for(m=h;m--!==0;)if(!Object.prototype.hasOwnProperty.call(s,v[m]))return!1;if(typeof Element!="undefined"&&n instanceof Element)return!1;for(m=h;m--!==0;)if(!(v[m]==="_owner"&&n.$$typeof)&&!Ed(n[v[m]],s[v[m]]))return!1;return!0}return n!==n&&s!==s}function CA(n,s){try{return Ed(n,s)}catch(h){if((h.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw h}}function MA(n,s){s===void 0&&(s={}),ya.set("drag",SA);var h=kt();return h.current||(h.current=AA(cA,CA)),vA({drag:n},h.current(s))}/*!
* tabbable 5.2.1
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var Qx=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],lm=Qx.join(","),Eu=typeof Element=="undefined"?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,e0=function(s,h,m){var v=Array.prototype.slice.apply(s.querySelectorAll(lm));return h&&Eu.call(s,lm)&&v.unshift(s),v=v.filter(m),v},IA=function(s){return s.contentEditable==="true"},t0=function(s){var h=parseInt(s.getAttribute("tabindex"),10);return isNaN(h)?IA(s)||(s.nodeName==="AUDIO"||s.nodeName==="VIDEO"||s.nodeName==="DETAILS")&&s.getAttribute("tabindex")===null?0:s.tabIndex:h},kA=function(s,h){return s.tabIndex===h.tabIndex?s.documentOrder-h.documentOrder:s.tabIndex-h.tabIndex},km=function(s){return s.tagName==="INPUT"},zA=function(s){return km(s)&&s.type==="hidden"},PA=function(s){var h=s.tagName==="DETAILS"&&Array.prototype.slice.apply(s.children).some(function(m){return m.tagName==="SUMMARY"});return h},DA=function(s,h){for(var m=0;m<s.length;m++)if(s[m].checked&&s[m].form===h)return s[m]},LA=function(s){if(!s.name)return!0;var h=s.form||s.ownerDocument,m=function(a){return h.querySelectorAll('input[type="radio"][name="'+a+'"]')},v;if(typeof window!="undefined"&&typeof window.CSS!="undefined"&&typeof window.CSS.escape=="function")v=m(window.CSS.escape(s.name));else try{v=m(s.name)}catch(M){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",M.message),!1}var b=DA(v,s.form);return!b||b===s},RA=function(s){return km(s)&&s.type==="radio"},OA=function(s){return RA(s)&&!LA(s)},BA=function(s,h){if(getComputedStyle(s).visibility==="hidden")return!0;var m=Eu.call(s,"details>summary:first-of-type"),v=m?s.parentElement:s;if(Eu.call(v,"details:not([open]) *"))return!0;if(!h||h==="full")for(;s;){if(getComputedStyle(s).display==="none")return!0;s=s.parentElement}else if(h==="non-zero-area"){var b=s.getBoundingClientRect(),M=b.width,a=b.height;return M===0&&a===0}return!1},FA=function(s){if(km(s)||s.tagName==="SELECT"||s.tagName==="TEXTAREA"||s.tagName==="BUTTON")for(var h=s.parentElement;h;){if(h.tagName==="FIELDSET"&&h.disabled){for(var m=0;m<h.children.length;m++){var v=h.children.item(m);if(v.tagName==="LEGEND")return!v.contains(s)}return!0}h=h.parentElement}return!1},zm=function(s,h){return!(h.disabled||zA(h)||BA(h,s.displayCheck)||PA(h)||FA(h))},r0=function(s,h){return!(!zm(s,h)||OA(h)||t0(h)<0)},NA=function(s,h){h=h||{};var m=[],v=[],b=e0(s,h.includeContainer,r0.bind(null,h));b.forEach(function(a,L){var F=t0(a);F===0?m.push(a):v.push({documentOrder:L,tabIndex:F,node:a})});var M=v.sort(kA).map(function(a){return a.node}).concat(m);return M},UA=function(s,h){h=h||{};var m=e0(s,h.includeContainer,zm.bind(null,h));return m},hd=function(s,h){if(h=h||{},!s)throw new Error("No node provided");return Eu.call(s,lm)===!1?!1:r0(h,s)},jA=Qx.concat("iframe").join(","),Lp=function(s,h){if(h=h||{},!s)throw new Error("No node provided");return Eu.call(s,jA)===!1?!1:zm(h,s)};/*!
* focus-trap 6.7.3
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function Zy(n,s){var h=Object.keys(n);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(n);s&&(m=m.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),h.push.apply(h,m)}return h}function VA(n){for(var s=1;s<arguments.length;s++){var h=arguments[s]!=null?arguments[s]:{};s%2?Zy(Object(h),!0).forEach(function(m){$A(n,m,h[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(h)):Zy(Object(h)).forEach(function(m){Object.defineProperty(n,m,Object.getOwnPropertyDescriptor(h,m))})}return n}function $A(n,s,h){return s in n?Object.defineProperty(n,s,{value:h,enumerable:!0,configurable:!0,writable:!0}):n[s]=h,n}var Wy=function(){var n=[];return{activateTrap:function(h){if(n.length>0){var m=n[n.length-1];m!==h&&m.pause()}var v=n.indexOf(h);v===-1||n.splice(v,1),n.push(h)},deactivateTrap:function(h){var m=n.indexOf(h);m!==-1&&n.splice(m,1),n.length>0&&n[n.length-1].unpause()}}}(),GA=function(s){return s.tagName&&s.tagName.toLowerCase()==="input"&&typeof s.select=="function"},qA=function(s){return s.key==="Escape"||s.key==="Esc"||s.keyCode===27},ZA=function(s){return s.key==="Tab"||s.keyCode===9},Xy=function(s){return setTimeout(s,0)},Rp=function(s,h){var m=-1;return s.every(function(v,b){return h(v)?(m=b,!1):!0}),m},ru=function(s){for(var h=arguments.length,m=new Array(h>1?h-1:0),v=1;v<h;v++)m[v-1]=arguments[v];return typeof s=="function"?s.apply(void 0,m):s},dd=function(s){return s.target.shadowRoot&&typeof s.composedPath=="function"?s.composedPath()[0]:s.target},WA=function(s,h){var m=(h==null?void 0:h.document)||document,v=VA({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},h),b={containers:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0},M,a=function(xe,Se,Be){return xe&&xe[Se]!==void 0?xe[Se]:v[Be||Se]},L=function(xe){return!!(xe&&b.containers.some(function(Se){return Se.contains(xe)}))},F=function(xe){var Se=v[xe];if(typeof Se=="function"){for(var Be=arguments.length,Ye=new Array(Be>1?Be-1:0),it=1;it<Be;it++)Ye[it-1]=arguments[it];Se=Se.apply(void 0,Ye)}if(!Se){if(Se===void 0||Se===!1)return Se;throw new Error("`".concat(xe,"` was specified but was not a node, or did not return a node"))}var at=Se;if(typeof Se=="string"&&(at=m.querySelector(Se),!at))throw new Error("`".concat(xe,"` as selector refers to no known node"));return at},B=function(){var xe=F("initialFocus");if(xe===!1)return!1;if(xe===void 0)if(L(m.activeElement))xe=m.activeElement;else{var Se=b.tabbableGroups[0],Be=Se&&Se.firstTabbableNode;xe=Be||F("fallbackFocus")}if(!xe)throw new Error("Your focus-trap needs to have at least one focusable element");return xe},j=function(){if(b.tabbableGroups=b.containers.map(function(xe){var Se=NA(xe),Be=UA(xe);if(Se.length>0)return{container:xe,firstTabbableNode:Se[0],lastTabbableNode:Se[Se.length-1],nextTabbableNode:function(it){var at=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,wt=Be.findIndex(function(dr){return dr===it});return at?Be.slice(wt+1).find(function(dr){return hd(dr)}):Be.slice(0,wt).reverse().find(function(dr){return hd(dr)})}}}).filter(function(xe){return!!xe}),b.tabbableGroups.length<=0&&!F("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},q=function Re(xe){if(xe!==!1&&xe!==m.activeElement){if(!xe||!xe.focus){Re(B());return}xe.focus({preventScroll:!!v.preventScroll}),b.mostRecentlyFocusedNode=xe,GA(xe)&&xe.select()}},G=function(xe){var Se=F("setReturnFocus",xe);return Se||(Se===!1?!1:xe)},he=function(xe){var Se=dd(xe);if(!L(Se)){if(ru(v.clickOutsideDeactivates,xe)){M.deactivate({returnFocus:v.returnFocusOnDeactivate&&!Lp(Se)});return}ru(v.allowOutsideClick,xe)||xe.preventDefault()}},be=function(xe){var Se=dd(xe),Be=L(Se);Be||Se instanceof Document?Be&&(b.mostRecentlyFocusedNode=Se):(xe.stopImmediatePropagation(),q(b.mostRecentlyFocusedNode||B()))},we=function(xe){var Se=dd(xe);j();var Be=null;if(b.tabbableGroups.length>0){var Ye=Rp(b.tabbableGroups,function(Zt){var At=Zt.container;return At.contains(Se)}),it=Ye>=0?b.tabbableGroups[Ye]:void 0;if(Ye<0)xe.shiftKey?Be=b.tabbableGroups[b.tabbableGroups.length-1].lastTabbableNode:Be=b.tabbableGroups[0].firstTabbableNode;else if(xe.shiftKey){var at=Rp(b.tabbableGroups,function(Zt){var At=Zt.firstTabbableNode;return Se===At});if(at<0&&(it.container===Se||Lp(Se)&&!hd(Se)&&!it.nextTabbableNode(Se,!1))&&(at=Ye),at>=0){var wt=at===0?b.tabbableGroups.length-1:at-1,dr=b.tabbableGroups[wt];Be=dr.lastTabbableNode}}else{var Sr=Rp(b.tabbableGroups,function(Zt){var At=Zt.lastTabbableNode;return Se===At});if(Sr<0&&(it.container===Se||Lp(Se)&&!hd(Se)&&!it.nextTabbableNode(Se))&&(Sr=Ye),Sr>=0){var Ut=Sr===b.tabbableGroups.length-1?0:Sr+1,$r=b.tabbableGroups[Ut];Be=$r.firstTabbableNode}}}else Be=F("fallbackFocus");Be&&(xe.preventDefault(),q(Be))},Ie=function(xe){if(qA(xe)&&ru(v.escapeDeactivates,xe)!==!1){xe.preventDefault(),M.deactivate();return}if(ZA(xe)){we(xe);return}},E=function(xe){if(!ru(v.clickOutsideDeactivates,xe)){var Se=dd(xe);L(Se)||ru(v.allowOutsideClick,xe)||(xe.preventDefault(),xe.stopImmediatePropagation())}},ye=function(){if(!!b.active)return Wy.activateTrap(M),b.delayInitialFocusTimer=v.delayInitialFocus?Xy(function(){q(B())}):q(B()),m.addEventListener("focusin",be,!0),m.addEventListener("mousedown",he,{capture:!0,passive:!1}),m.addEventListener("touchstart",he,{capture:!0,passive:!1}),m.addEventListener("click",E,{capture:!0,passive:!1}),m.addEventListener("keydown",Ie,{capture:!0,passive:!1}),M},Le=function(){if(!!b.active)return m.removeEventListener("focusin",be,!0),m.removeEventListener("mousedown",he,!0),m.removeEventListener("touchstart",he,!0),m.removeEventListener("click",E,!0),m.removeEventListener("keydown",Ie,!0),M};return M={activate:function(xe){if(b.active)return this;var Se=a(xe,"onActivate"),Be=a(xe,"onPostActivate"),Ye=a(xe,"checkCanFocusTrap");Ye||j(),b.active=!0,b.paused=!1,b.nodeFocusedBeforeActivation=m.activeElement,Se&&Se();var it=function(){Ye&&j(),ye(),Be&&Be()};return Ye?(Ye(b.containers.concat()).then(it,it),this):(it(),this)},deactivate:function(xe){if(!b.active)return this;clearTimeout(b.delayInitialFocusTimer),b.delayInitialFocusTimer=void 0,Le(),b.active=!1,b.paused=!1,Wy.deactivateTrap(M);var Se=a(xe,"onDeactivate"),Be=a(xe,"onPostDeactivate"),Ye=a(xe,"checkCanReturnFocus");Se&&Se();var it=a(xe,"returnFocus","returnFocusOnDeactivate"),at=function(){Xy(function(){it&&q(G(b.nodeFocusedBeforeActivation)),Be&&Be()})};return it&&Ye?(Ye(G(b.nodeFocusedBeforeActivation)).then(at,at),this):(at(),this)},pause:function(){return b.paused||!b.active?this:(b.paused=!0,Le(),this)},unpause:function(){return!b.paused||!b.active?this:(b.paused=!1,j(),ye(),this)},updateContainerElements:function(xe){var Se=[].concat(xe).filter(Boolean);return b.containers=Se.map(function(Be){return typeof Be=="string"?m.querySelector(Be):Be}),b.active&&j(),this}},M.updateContainerElements(s),M};function XA(n){if(Array.isArray(n)){for(var s=0,h=Array(n.length);s<n.length;s++)h[s]=n[s];return h}else return Array.from(n)}var Pm=!1;if(typeof window!="undefined"){var Hy={get passive(){Pm=!0}};window.addEventListener("testPassive",null,Hy),window.removeEventListener("testPassive",null,Hy)}var i0=typeof window!="undefined"&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||window.navigator.platform==="MacIntel"&&window.navigator.maxTouchPoints>1),Ms=[],Vd=!1,n0=-1,yu=void 0,vu=void 0,o0=function(s){return Ms.some(function(h){return!!(h.options.allowTouchMove&&h.options.allowTouchMove(s))})},$d=function(s){var h=s||window.event;return o0(h.target)||h.touches.length>1?!0:(h.preventDefault&&h.preventDefault(),!1)},HA=function(s){if(vu===void 0){var h=!!s&&s.reserveScrollBarGap===!0,m=window.innerWidth-document.documentElement.clientWidth;h&&m>0&&(vu=document.body.style.paddingRight,document.body.style.paddingRight=m+"px")}yu===void 0&&(yu=document.body.style.overflow,document.body.style.overflow="hidden")},KA=function(){vu!==void 0&&(document.body.style.paddingRight=vu,vu=void 0),yu!==void 0&&(document.body.style.overflow=yu,yu=void 0)},YA=function(s){return s?s.scrollHeight-s.scrollTop<=s.clientHeight:!1},JA=function(s,h){var m=s.targetTouches[0].clientY-n0;return o0(s.target)?!1:h&&h.scrollTop===0&&m>0||YA(h)&&m<0?$d(s):(s.stopPropagation(),!0)},QA=function(s,h){if(!s){console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.");return}if(!Ms.some(function(v){return v.targetElement===s})){var m={targetElement:s,options:h||{}};Ms=[].concat(XA(Ms),[m]),i0?(s.ontouchstart=function(v){v.targetTouches.length===1&&(n0=v.targetTouches[0].clientY)},s.ontouchmove=function(v){v.targetTouches.length===1&&JA(v,s)},Vd||(document.addEventListener("touchmove",$d,Pm?{passive:!1}:void 0),Vd=!0)):HA(h)}},eC=function(s){if(!s){console.error("enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.");return}Ms=Ms.filter(function(h){return h.targetElement!==s}),i0?(s.ontouchstart=null,s.ontouchmove=null,Vd&&Ms.length===0&&(document.removeEventListener("touchmove",$d,Pm?{passive:!1}:void 0),Vd=!1)):Ms.length||KA()},xa=[],tC=function(){return xa.some(function(n){return n.activeTargets.length>0})},rC=function(){return xa.some(function(n){return n.skippedTargets.length>0})},Ky="ResizeObserver loop completed with undelivered notifications.",iC=function(){var n;typeof ErrorEvent=="function"?n=new ErrorEvent("error",{message:Ky}):(n=document.createEvent("Event"),n.initEvent("error",!1,!1),n.message=Ky),window.dispatchEvent(n)},Su;(function(n){n.BORDER_BOX="border-box",n.CONTENT_BOX="content-box",n.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"})(Su||(Su={}));var ba=function(n){return Object.freeze(n)},nC=function(){function n(s,h){this.inlineSize=s,this.blockSize=h,ba(this)}return n}(),s0=function(){function n(s,h,m,v){return this.x=s,this.y=h,this.width=m,this.height=v,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,ba(this)}return n.prototype.toJSON=function(){var s=this,h=s.x,m=s.y,v=s.top,b=s.right,M=s.bottom,a=s.left,L=s.width,F=s.height;return{x:h,y:m,top:v,right:b,bottom:M,left:a,width:L,height:F}},n.fromRect=function(s){return new n(s.x,s.y,s.width,s.height)},n}(),Dm=function(n){return n instanceof SVGElement&&"getBBox"in n},a0=function(n){if(Dm(n)){var s=n.getBBox(),h=s.width,m=s.height;return!h&&!m}var v=n,b=v.offsetWidth,M=v.offsetHeight;return!(b||M||n.getClientRects().length)},Yy=function(n){var s,h;if(n instanceof Element)return!0;var m=(h=(s=n)===null||s===void 0?void 0:s.ownerDocument)===null||h===void 0?void 0:h.defaultView;return!!(m&&n instanceof m.Element)},oC=function(n){switch(n.tagName){case"INPUT":if(n.type!=="image")break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1},xu=typeof window!="undefined"?window:{},fd=new WeakMap,Jy=/auto|scroll/,sC=/^tb|vertical/,aC=/msie|trident/i.test(xu.navigator&&xu.navigator.userAgent),zo=function(n){return parseFloat(n||"0")},Nl=function(n,s,h){return n===void 0&&(n=0),s===void 0&&(s=0),h===void 0&&(h=!1),new nC((h?s:n)||0,(h?n:s)||0)},Qy=ba({devicePixelContentBoxSize:Nl(),borderBoxSize:Nl(),contentBoxSize:Nl(),contentRect:new s0(0,0,0,0)}),l0=function(n,s){if(s===void 0&&(s=!1),fd.has(n)&&!s)return fd.get(n);if(a0(n))return fd.set(n,Qy),Qy;var h=getComputedStyle(n),m=Dm(n)&&n.ownerSVGElement&&n.getBBox(),v=!aC&&h.boxSizing==="border-box",b=sC.test(h.writingMode||""),M=!m&&Jy.test(h.overflowY||""),a=!m&&Jy.test(h.overflowX||""),L=m?0:zo(h.paddingTop),F=m?0:zo(h.paddingRight),B=m?0:zo(h.paddingBottom),j=m?0:zo(h.paddingLeft),q=m?0:zo(h.borderTopWidth),G=m?0:zo(h.borderRightWidth),he=m?0:zo(h.borderBottomWidth),be=m?0:zo(h.borderLeftWidth),we=j+F,Ie=L+B,E=be+G,ye=q+he,Le=a?n.offsetHeight-ye-n.clientHeight:0,Re=M?n.offsetWidth-E-n.clientWidth:0,xe=v?we+E:0,Se=v?Ie+ye:0,Be=m?m.width:zo(h.width)-xe-Re,Ye=m?m.height:zo(h.height)-Se-Le,it=Be+we+Re+E,at=Ye+Ie+Le+ye,wt=ba({devicePixelContentBoxSize:Nl(Math.round(Be*devicePixelRatio),Math.round(Ye*devicePixelRatio),b),borderBoxSize:Nl(it,at,b),contentBoxSize:Nl(Be,Ye,b),contentRect:new s0(j,L,Be,Ye)});return fd.set(n,wt),wt},c0=function(n,s,h){var m=l0(n,h),v=m.borderBoxSize,b=m.contentBoxSize,M=m.devicePixelContentBoxSize;switch(s){case Su.DEVICE_PIXEL_CONTENT_BOX:return M;case Su.BORDER_BOX:return v;default:return b}},lC=function(){function n(s){var h=l0(s);this.target=s,this.contentRect=h.contentRect,this.borderBoxSize=ba([h.borderBoxSize]),this.contentBoxSize=ba([h.contentBoxSize]),this.devicePixelContentBoxSize=ba([h.devicePixelContentBoxSize])}return n}(),u0=function(n){if(a0(n))return 1/0;for(var s=0,h=n.parentNode;h;)s+=1,h=h.parentNode;return s},cC=function(){var n=1/0,s=[];xa.forEach(function(M){if(M.activeTargets.length!==0){var a=[];M.activeTargets.forEach(function(F){var B=new lC(F.target),j=u0(F.target);a.push(B),F.lastReportedSize=c0(F.target,F.observedBox),j<n&&(n=j)}),s.push(function(){M.callback.call(M.observer,a,M.observer)}),M.activeTargets.splice(0,M.activeTargets.length)}});for(var h=0,m=s;h<m.length;h++){var v=m[h];v()}return n},ev=function(n){xa.forEach(function(h){h.activeTargets.splice(0,h.activeTargets.length),h.skippedTargets.splice(0,h.skippedTargets.length),h.observationTargets.forEach(function(v){v.isActive()&&(u0(v.target)>n?h.activeTargets.push(v):h.skippedTargets.push(v))})})},uC=function(){var n=0;for(ev(n);tC();)n=cC(),ev(n);return rC()&&iC(),n>0},Op,h0=[],hC=function(){return h0.splice(0).forEach(function(n){return n()})},dC=function(n){if(!Op){var s=0,h=document.createTextNode(""),m={characterData:!0};new MutationObserver(function(){return hC()}).observe(h,m),Op=function(){h.textContent=""+(s?s--:s++)}}h0.push(n),Op()},fC=function(n){dC(function(){requestAnimationFrame(n)})},Sd=0,pC=function(){return!!Sd},mC=250,_C={attributes:!0,characterData:!0,childList:!0,subtree:!0},tv=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],rv=function(n){return n===void 0&&(n=0),Date.now()+n},Bp=!1,gC=function(){function n(){var s=this;this.stopped=!0,this.listener=function(){return s.schedule()}}return n.prototype.run=function(s){var h=this;if(s===void 0&&(s=mC),!Bp){Bp=!0;var m=rv(s);fC(function(){var v=!1;try{v=uC()}finally{if(Bp=!1,s=m-rv(),!pC())return;v?h.run(1e3):s>0?h.run(s):h.start()}})}},n.prototype.schedule=function(){this.stop(),this.run()},n.prototype.observe=function(){var s=this,h=function(){return s.observer&&s.observer.observe(document.body,_C)};document.body?h():xu.addEventListener("DOMContentLoaded",h)},n.prototype.start=function(){var s=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),tv.forEach(function(h){return xu.addEventListener(h,s.listener,!0)}))},n.prototype.stop=function(){var s=this;this.stopped||(this.observer&&this.observer.disconnect(),tv.forEach(function(h){return xu.removeEventListener(h,s.listener,!0)}),this.stopped=!0)},n}(),cm=new gC,iv=function(n){!Sd&&n>0&&cm.start(),Sd+=n,!Sd&&cm.stop()},yC=function(n){return!Dm(n)&&!oC(n)&&getComputedStyle(n).display==="inline"},vC=function(){function n(s,h){this.target=s,this.observedBox=h||Su.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return n.prototype.isActive=function(){var s=c0(this.target,this.observedBox,!0);return yC(this.target)&&(this.lastReportedSize=s),this.lastReportedSize.inlineSize!==s.inlineSize||this.lastReportedSize.blockSize!==s.blockSize},n}(),xC=function(){function n(s,h){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=s,this.callback=h}return n}(),pd=new WeakMap,nv=function(n,s){for(var h=0;h<n.length;h+=1)if(n[h].target===s)return h;return-1},md=function(){function n(){}return n.connect=function(s,h){var m=new xC(s,h);pd.set(s,m)},n.observe=function(s,h,m){var v=pd.get(s),b=v.observationTargets.length===0;nv(v.observationTargets,h)<0&&(b&&xa.push(v),v.observationTargets.push(new vC(h,m&&m.box)),iv(1),cm.schedule())},n.unobserve=function(s,h){var m=pd.get(s),v=nv(m.observationTargets,h),b=m.observationTargets.length===1;v>=0&&(b&&xa.splice(xa.indexOf(m),1),m.observationTargets.splice(v,1),iv(-1))},n.disconnect=function(s){var h=this,m=pd.get(s);m.observationTargets.slice().forEach(function(v){return h.unobserve(s,v.target)}),m.activeTargets.splice(0,m.activeTargets.length)},n}(),bC=function(){function n(s){if(arguments.length===0)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if(typeof s!="function")throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");md.connect(this,s)}return n.prototype.observe=function(s,h){if(arguments.length===0)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!Yy(s))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");md.observe(this,s,h)},n.prototype.unobserve=function(s){if(arguments.length===0)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!Yy(s))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");md.unobserve(this,s)},n.prototype.disconnect=function(){md.disconnect(this)},n.toString=function(){return"function ResizeObserver () { [polyfill code] }"},n}();function Yi(){return(Yi=Object.assign||function(n){for(var s=1;s<arguments.length;s++){var h=arguments[s];for(var m in h)Object.prototype.hasOwnProperty.call(h,m)&&(n[m]=h[m])}return n}).apply(this,arguments)}function Ad(n,s){if(n==null)return{};var h,m,v={},b=Object.keys(n);for(m=0;m<b.length;m++)s.indexOf(h=b[m])>=0||(v[h]=n[h]);return v}var bu=typeof window!="undefined"?Xl:gr;function iu(n,s,h){return s=(s=+s)==s?s:0,h=(h=+h)==h?h:0,(n=+n)==n&&(n=(n=n<=h?n:h)>=s?n:s),n}function _d(n){var s=Math.round(n);if(Number.isNaN(n))throw new TypeError("Found a NaN! Check your snapPoints / defaultSnap / snapTo ");return s}var wC={box:"border-box"};function Fp(n,s){var h=s.label,m=s.enabled,v=s.resizeSourceRef,b=qn(0),M=b[0],a=b[1];Ho(h+": "+M);var L=ur(function(F){a(F[0].borderBoxSize[0].blockSize),v.current="element"},[v]);return bu(function(){if(n.current&&m){var F=new bC(L);return F.observe(n.current,wC),function(){F.disconnect()}}},[n,L,m]),m?M:0}function Bi(n){return n===void 0&&(n=1e3),new Promise(function(s){return setTimeout(s,n)})}var ov={DRAG:{target:"#overlay.dragging",actions:"onOpenEnd"}},sv={RESIZE:{target:"#overlay.resizing",actions:"onOpenEnd"}},TC=HE({id:"overlay",initial:"closed",context:{initialState:"CLOSED"},states:{closed:{on:{OPEN:"opening",CLOSE:void 0}},opening:{initial:"start",states:{start:{invoke:{src:"onOpenStart",onDone:"transition"}},transition:{always:[{target:"immediately",cond:"initiallyOpen"},{target:"smoothly",cond:"initiallyClosed"}]},immediately:{initial:"open",states:{open:{invoke:{src:"openImmediately",onDone:"activating"}},activating:{invoke:{src:"activate",onDone:"#overlay.opening.end"},on:Yi({},ov,sv)}}},smoothly:{initial:"visuallyHidden",states:{visuallyHidden:{invoke:{src:"renderVisuallyHidden",onDone:"activating"}},activating:{invoke:{src:"activate",onDone:"open"}},open:{invoke:{src:"openSmoothly",onDone:"#overlay.opening.end"},on:Yi({},ov,sv)}}},end:{invoke:{src:"onOpenEnd",onDone:"done"},on:{CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:Yi({},{CLOSE:{target:"#overlay.closing",actions:"onOpenCancel"}}),onDone:"open"},open:{on:{DRAG:"#overlay.dragging",SNAP:"snapping",RESIZE:"resizing"}},dragging:{on:{SNAP:"snapping"}},snapping:{initial:"start",states:{start:{invoke:{src:"onSnapStart",onDone:"snappingSmoothly"},entry:[KE({y:function(n,s){return s.payload.y},velocity:function(n,s){return s.payload.velocity},snapSource:function(n,s){var h=s.payload.source;return h===void 0?"custom":h}})]},snappingSmoothly:{invoke:{src:"snapSmoothly",onDone:"end"}},end:{invoke:{src:"onSnapEnd",onDone:"done"},on:{RESIZE:"#overlay.resizing",SNAP:"#overlay.snapping",CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:{SNAP:{target:"snapping",actions:"onSnapEnd"},RESIZE:{target:"#overlay.resizing",actions:"onSnapCancel"},DRAG:{target:"#overlay.dragging",actions:"onSnapCancel"},CLOSE:{target:"#overlay.closing",actions:"onSnapCancel"}},onDone:"open"},resizing:{initial:"start",states:{start:{invoke:{src:"onResizeStart",onDone:"resizingSmoothly"}},resizingSmoothly:{invoke:{src:"resizeSmoothly",onDone:"end"}},end:{invoke:{src:"onResizeEnd",onDone:"done"},on:{SNAP:"#overlay.snapping",CLOSE:"#overlay.closing",DRAG:"#overlay.dragging"}},done:{type:"final"}},on:{RESIZE:{target:"resizing",actions:"onResizeEnd"},SNAP:{target:"snapping",actions:"onResizeCancel"},DRAG:{target:"#overlay.dragging",actions:"onResizeCancel"},CLOSE:{target:"#overlay.closing",actions:"onResizeCancel"}},onDone:"open"},closing:{initial:"start",states:{start:{invoke:{src:"onCloseStart",onDone:"deactivating"},on:{OPEN:{target:"#overlay.open",actions:"onCloseCancel"}}},deactivating:{invoke:{src:"deactivate",onDone:"closingSmoothly"}},closingSmoothly:{invoke:{src:"closeSmoothly",onDone:"end"}},end:{invoke:{src:"onCloseEnd",onDone:"done"},on:{OPEN:{target:"#overlay.opening",actions:"onCloseCancel"}}},done:{type:"final"}},on:{CLOSE:void 0,OPEN:{target:"#overlay.opening",actions:"onCloseCancel"}},onDone:"closed"}},on:{CLOSE:"closing"}},{actions:{onOpenCancel:function(n,s){},onSnapCancel:function(n,s){},onResizeCancel:function(n,s){},onCloseCancel:function(n,s){},onOpenEnd:function(n,s){},onSnapEnd:function(n,s){},onRezizeEnd:function(n,s){}},services:{onSnapStart:function(){try{return Promise.resolve(Bi()).then(function(){})}catch(n){return Promise.reject(n)}},onOpenStart:function(){try{return Promise.resolve(Bi()).then(function(){})}catch(n){return Promise.reject(n)}},onCloseStart:function(){try{return Promise.resolve(Bi()).then(function(){})}catch(n){return Promise.reject(n)}},onResizeStart:function(){try{return Promise.resolve(Bi()).then(function(){})}catch(n){return Promise.reject(n)}},onSnapEnd:function(){try{return Promise.resolve(Bi()).then(function(){})}catch(n){return Promise.reject(n)}},onOpenEnd:function(){try{return Promise.resolve(Bi()).then(function(){})}catch(n){return Promise.reject(n)}},onCloseEnd:function(){try{return Promise.resolve(Bi()).then(function(){})}catch(n){return Promise.reject(n)}},onResizeEnd:function(){try{return Promise.resolve(Bi()).then(function(){})}catch(n){return Promise.reject(n)}},renderVisuallyHidden:function(n,s){try{return Promise.resolve(Bi()).then(function(){})}catch(h){return Promise.reject(h)}},activate:function(n,s){try{return Promise.resolve(Bi()).then(function(){})}catch(h){return Promise.reject(h)}},deactivate:function(n,s){try{return Promise.resolve(Bi()).then(function(){})}catch(h){return Promise.reject(h)}},openSmoothly:function(n,s){try{return Promise.resolve(Bi()).then(function(){})}catch(h){return Promise.reject(h)}},openImmediately:function(n,s){try{return Promise.resolve(Bi()).then(function(){})}catch(h){return Promise.reject(h)}},snapSmoothly:function(n,s){try{return Promise.resolve(Bi()).then(function(){})}catch(h){return Promise.reject(h)}},resizeSmoothly:function(n,s){try{return Promise.resolve(Bi()).then(function(){})}catch(h){return Promise.reject(h)}},closeSmoothly:function(n,s){try{return Promise.resolve(Bi()).then(function(){})}catch(h){return Promise.reject(h)}}},guards:{initiallyClosed:function(n){return n.initialState==="CLOSED"},initiallyOpen:function(n){return n.initialState==="OPEN"}}}),EC=["children","sibling","className","footer","header","open","initialState","lastSnapRef","initialFocusRef","onDismiss","maxHeight","defaultSnap","snapPoints","blocking","scrollLocking","style","onSpringStart","onSpringCancel","onSpringEnd","reserveScrollBarGap","expandOnContentDrag"],SC=["velocity"],AC=["onRest","config"],d0=wS.default,CC=d0.tension,gd=d0.friction,MC=yn.forwardRef(function(n,s){var h=n.children,m=n.sibling,v=n.className,b=n.footer,M=n.header,a=n.open,L=n.initialState,F=n.lastSnapRef,B=n.initialFocusRef,j=n.onDismiss,q=n.maxHeight,G=n.defaultSnap,he=G===void 0?kC:G,be=n.snapPoints,we=be===void 0?zC:be,Ie=n.blocking,E=Ie===void 0||Ie,ye=n.scrollLocking,Le=ye===void 0||ye,Re=n.style,xe=n.onSpringStart,Se=n.onSpringCancel,Be=n.onSpringEnd,Ye=n.reserveScrollBarGap,it=Ye===void 0?E:Ye,at=n.expandOnContentDrag,wt=at!==void 0&&at,dr=Ad(n,EC),Sr=function(){var $e=qn(!1),gt=$e[0],Je=$e[1],Et=qn({}),lr=Et[0],Dt=Et[1],er=ur(function(tr){return Dt(function(rr){var vt;return Yi({},rr,((vt={})[tr]=!1,vt))}),function(){Dt(function(rr){var vt;return Yi({},rr,((vt={})[tr]=!0,vt))})}},[]);return gr(function(){var tr=Object.values(lr);tr.length!==0&&tr.every(Boolean)&&Je(!0)},[lr]),{ready:gt,registerReady:er}}(),Ut=Sr.ready,$r=Sr.registerReady,Zt=kt(!1),At=kt(xe),fr=kt(Se),Or=kt(Be);gr(function(){At.current=xe,fr.current=Se,Or.current=Be},[Se,xe,Be]);var Tt,pr,Ui=CS(function(){return{y:0,ready:0,maxHeight:0,minSnap:0,maxSnap:0}}),En=Ui[0],Do=Ui[1],Dn=kt(null),gi=kt(null),lo=kt(null),Lo=kt(null),Ro=kt(null),co=kt(null),Mi=kt(0),ji=kt(),Ct=kt(!1),Gr=(Tt=en(function(){return typeof window!="undefined"?window.matchMedia("(prefers-reduced-motion: reduce)"):null},[]),pr=kt(Tt==null?void 0:Tt.matches),Ho(pr.current?"reduce":"no-preference"),gr(function(){var $e=function(gt){pr.current=gt.matches};return Tt==null||Tt.addListener($e),function(){return Tt==null?void 0:Tt.removeListener($e)}},[Tt]),pr),Ii=function($e){var gt=$e.targetRef,Je=$e.enabled,Et=$e.reserveScrollBarGap,lr=kt({activate:function(){throw new TypeError("Tried to activate scroll lock too early")},deactivate:function(){}});return Ho(Je?"Enabled":"Disabled"),gr(function(){if(!Je)return lr.current.deactivate(),void(lr.current={activate:function(){},deactivate:function(){}});var Dt=gt.current,er=!1;lr.current={activate:function(){er||(er=!0,QA(Dt,{allowTouchMove:function(tr){return tr.closest("[data-body-scroll-lock-ignore]")},reserveScrollBarGap:Et}))},deactivate:function(){er&&(er=!1,eC(Dt))}}},[Je,gt,Et]),lr}({targetRef:gi,enabled:Ut&&Le,reserveScrollBarGap:it}),tn=function($e){var gt=$e.targetRef,Je=$e.enabled,Et=kt({activate:function(){throw new TypeError("Tried to activate aria hider too early")},deactivate:function(){}});return Ho(Je?"Enabled":"Disabled"),gr(function(){if(!Je)return Et.current.deactivate(),void(Et.current={activate:function(){},deactivate:function(){}});var lr=gt.current,Dt=!1,er=[],tr=[];Et.current={activate:function(){if(!Dt){Dt=!0;var rr=lr.parentNode;document.querySelectorAll("body > *").forEach(function(vt){if(vt!==rr){var Ot=vt.getAttribute("aria-hidden");Ot!==null&&Ot!=="false"||(er.push(Ot),tr.push(vt),vt.setAttribute("aria-hidden","true"))}})}},deactivate:function(){Dt&&(Dt=!1,tr.forEach(function(rr,vt){var Ot=er[vt];Ot===null?rr.removeAttribute("aria-hidden"):rr.setAttribute("aria-hidden",Ot)}),er=[],tr=[])}}},[gt,Je]),Et}({targetRef:Dn,enabled:Ut&&E}),rn=function($e){var gt=$e.targetRef,Je=$e.fallbackRef,Et=$e.initialFocusRef,lr=$e.enabled,Dt=kt({activate:function(){throw new TypeError("Tried to activate focus trap too early")},deactivate:function(){}});return Ho(lr?"Enabled":"Disabled"),gr(function(){if(!lr)return Dt.current.deactivate(),void(Dt.current={activate:function(){},deactivate:function(){}});var er=Je.current,tr=WA(gt.current,{onActivate:void 0,initialFocus:Et?function(){return(Et==null?void 0:Et.current)||er}:void 0,fallbackFocus:er,escapeDeactivates:!1,clickOutsideDeactivates:!1}),rr=!1;Dt.current={activate:function(){try{return rr?Promise.resolve():(rr=!0,Promise.resolve(tr.activate()).then(function(){return Promise.resolve(new Promise(function(vt){return setTimeout(function(){return vt(void 0)},0)})).then(function(){})}))}catch(vt){return Promise.reject(vt)}},deactivate:function(){rr&&(rr=!1,tr.deactivate())}}},[lr,Je,Et,gt]),Dt}({targetRef:Dn,fallbackRef:co,initialFocusRef:B||void 0,enabled:Ut&&E&&B!==!1}),Ln=function($e){var gt=$e.getSnapPoints,Je=$e.heightRef,Et=$e.lastSnapRef,lr=$e.ready,Dt=function(J){var D=J.contentRef,U=J.controlledMaxHeight,H=J.footerEnabled,ee=J.footerRef,le=J.headerEnabled,de=J.headerRef,pe=J.registerReady,ue=J.resizeSourceRef,ge=en(function(){return pe("contentHeight")},[pe]),ke=function(dt,Mt,ir){var cr=en(function(){return Mt("maxHeight")},[Mt]),sr=qn(function(){return _d(dt)||typeof window!="undefined"?window.innerHeight:0}),yr=sr[0],on=sr[1],sn=yr>0,qr=kt(0);return Ho(dt?"controlled":"auto"),gr(function(){sn&&cr()},[sn,cr]),bu(function(){if(dt)return on(_d(dt)),void(ir.current="maxheightprop");var Gi=function(){qr.current||(qr.current=requestAnimationFrame(function(){on(window.innerHeight),ir.current="window",qr.current=0}))};return window.addEventListener("resize",Gi),on(window.innerHeight),ir.current="window",cr(),function(){window.removeEventListener("resize",Gi),cancelAnimationFrame(qr.current)}},[dt,cr,ir]),yr}(U,pe,ue),Oe=Fp(de,{label:"headerHeight",enabled:le,resizeSourceRef:ue}),Ue=Fp(D,{label:"contentHeight",enabled:!0,resizeSourceRef:ue}),lt=Fp(ee,{label:"footerHeight",enabled:H,resizeSourceRef:ue}),ut=Math.min(ke-Oe-lt,Ue)+Oe+lt;Ho("minHeight: "+ut);var ht=Ue>0;return gr(function(){ht&&ge()},[ht,ge]),{maxHeight:ke,minHeight:ut,headerHeight:Oe,footerHeight:lt}}({contentRef:$e.contentRef,controlledMaxHeight:$e.controlledMaxHeight,footerEnabled:$e.footerEnabled,footerRef:$e.footerRef,headerEnabled:$e.headerEnabled,headerRef:$e.headerRef,registerReady:$e.registerReady,resizeSourceRef:$e.resizeSourceRef}),er=Dt.maxHeight,tr=Dt.minHeight,rr=Dt.headerHeight,vt=Dt.footerHeight,Ot=function(J,D){var U=[].concat(J).map(_d).reduce(function(de,pe){return de.add(iu(pe,0,D)),de},new Set),H=Array.from(U),ee=Math.min.apply(Math,H);if(Number.isNaN(ee))throw new TypeError("minSnap is NaN");var le=Math.max.apply(Math,H);if(Number.isNaN(le))throw new TypeError("maxSnap is NaN");return{snapPoints:H,minSnap:ee,maxSnap:le}}(lr?gt({height:Je.current,footerHeight:vt,headerHeight:rr,minHeight:tr,maxHeight:er}):[0],er),Br=Ot.snapPoints,$i=Ot.minSnap,Dr=Ot.maxSnap;return Ho("minSnap: "+$i+", maxSnap:"+Dr),{minSnap:$i,maxSnap:Dr,findSnap:function(J){var D=_d(typeof J=="function"?J({footerHeight:vt,headerHeight:rr,height:Je.current,minHeight:tr,maxHeight:er,snapPoints:Br,lastSnap:Et.current}):J);return Br.reduce(function(U,H){return Math.abs(H-D)<Math.abs(U-D)?H:U},$i)},maxHeight:er}}({contentRef:lo,controlledMaxHeight:q,footerEnabled:!!b,footerRef:Ro,getSnapPoints:we,headerEnabled:M!==!1,headerRef:Lo,heightRef:Mi,lastSnapRef:F,ready:Ut,registerReady:$r,resizeSourceRef:ji}),Vt=Ln.minSnap,ki=Ln.maxSnap,wi=Ln.maxHeight,nn=Ln.findSnap,yi=kt(wi),Wt=kt(Vt),Cr=kt(ki),Rn=kt(nn),vi=kt(0);bu(function(){yi.current=wi,Cr.current=ki,Wt.current=Vt,Rn.current=nn,vi.current=nn(he)},[nn,he,wi,ki,Vt]);var Tr=ur(function($e){var gt=$e.onRest,Je=$e.config,Et=(Je=Je===void 0?{}:Je).velocity,lr=Et===void 0?1:Et,Dt=Ad(Je,SC),er=Ad($e,AC);return new Promise(function(tr){return Do(Yi({},er,{config:Yi({velocity:lr},Dt,{mass:1,tension:CC,friction:Math.max(gd,gd+(gd-gd*lr))}),onRest:function(){var rr=[].slice.call(arguments);tr.apply(void 0,rr),gt==null||gt.apply(void 0,rr)}}))})},[Do]),Oo=oS(TC,{devTools:!1,actions:{onOpenCancel:ur(function(){return fr.current==null?void 0:fr.current({type:"OPEN"})},[]),onSnapCancel:ur(function($e){return fr.current==null?void 0:fr.current({type:"SNAP",source:$e.snapSource})},[]),onCloseCancel:ur(function(){return fr.current==null?void 0:fr.current({type:"CLOSE"})},[]),onResizeCancel:ur(function(){return fr.current==null?void 0:fr.current({type:"RESIZE",source:ji.current})},[]),onOpenEnd:ur(function(){return Or.current==null?void 0:Or.current({type:"OPEN"})},[]),onSnapEnd:ur(function($e,gt){return Or.current==null?void 0:Or.current({type:"SNAP",source:$e.snapSource})},[]),onResizeEnd:ur(function(){return Or.current==null?void 0:Or.current({type:"RESIZE",source:ji.current})},[])},context:{initialState:L},services:{onSnapStart:ur(function($e,gt){try{return Promise.resolve(At.current==null?void 0:At.current({type:"SNAP",source:gt.payload.source||"custom"}))}catch(Je){return Promise.reject(Je)}},[]),onOpenStart:ur(function(){try{return Promise.resolve(At.current==null?void 0:At.current({type:"OPEN"}))}catch($e){return Promise.reject($e)}},[]),onCloseStart:ur(function(){try{return Promise.resolve(At.current==null?void 0:At.current({type:"CLOSE"}))}catch($e){return Promise.reject($e)}},[]),onResizeStart:ur(function(){try{return Promise.resolve(At.current==null?void 0:At.current({type:"RESIZE",source:ji.current}))}catch($e){return Promise.reject($e)}},[]),onSnapEnd:ur(function($e,gt){try{return Promise.resolve(Or.current==null?void 0:Or.current({type:"SNAP",source:$e.snapSource}))}catch(Je){return Promise.reject(Je)}},[]),onOpenEnd:ur(function(){try{return Promise.resolve(Or.current==null?void 0:Or.current({type:"OPEN"}))}catch($e){return Promise.reject($e)}},[]),onCloseEnd:ur(function(){try{return Promise.resolve(Or.current==null?void 0:Or.current({type:"CLOSE"}))}catch($e){return Promise.reject($e)}},[]),onResizeEnd:ur(function(){try{return Promise.resolve(Or.current==null?void 0:Or.current({type:"RESIZE",source:ji.current}))}catch($e){return Promise.reject($e)}},[]),renderVisuallyHidden:ur(function($e,gt){try{return Promise.resolve(Tr({y:vi.current,ready:0,maxHeight:yi.current,maxSnap:Cr.current,minSnap:vi.current,immediate:!0})).then(function(){})}catch(Je){return Promise.reject(Je)}},[Tr]),activate:ur(function($e,gt){try{return Zt.current=!0,Promise.resolve(Promise.all([Ii.current.activate(),rn.current.activate(),tn.current.activate()])).then(function(){})}catch(Je){return Promise.reject(Je)}},[tn,rn,Ii]),deactivate:ur(function(){try{return Ii.current.deactivate(),rn.current.deactivate(),tn.current.deactivate(),Zt.current=!1,Promise.resolve()}catch($e){return Promise.reject($e)}},[tn,rn,Ii]),openImmediately:ur(function(){try{return Mi.current=vi.current,Promise.resolve(Tr({y:vi.current,ready:1,maxHeight:yi.current,maxSnap:Cr.current,minSnap:vi.current,immediate:!0})).then(function(){})}catch($e){return Promise.reject($e)}},[Tr]),openSmoothly:ur(function(){try{return Promise.resolve(Tr({y:0,ready:1,maxHeight:yi.current,maxSnap:Cr.current,minSnap:vi.current,immediate:!0})).then(function(){return Mi.current=vi.current,Promise.resolve(Tr({y:vi.current,ready:1,maxHeight:yi.current,maxSnap:Cr.current,minSnap:vi.current,immediate:Gr.current})).then(function(){})})}catch($e){return Promise.reject($e)}},[Tr,Gr]),snapSmoothly:ur(function($e,gt){try{var Je=Rn.current($e.y);return Mi.current=Je,F.current=Je,Promise.resolve(Tr({y:Je,ready:1,maxHeight:yi.current,maxSnap:Cr.current,minSnap:Wt.current,immediate:Gr.current,config:{velocity:$e.velocity}})).then(function(){})}catch(Et){return Promise.reject(Et)}},[Tr,F,Gr]),resizeSmoothly:ur(function(){try{var $e=Rn.current(Mi.current);return Mi.current=$e,F.current=$e,Promise.resolve(Tr({y:$e,ready:1,maxHeight:yi.current,maxSnap:Cr.current,minSnap:Wt.current,immediate:ji.current!=="element"||Gr.current})).then(function(){})}catch(gt){return Promise.reject(gt)}},[Tr,F,Gr]),closeSmoothly:ur(function($e,gt){try{return Tr({minSnap:Mi.current,immediate:!0}),Mi.current=0,Promise.resolve(Tr({y:0,maxHeight:yi.current,maxSnap:Cr.current,immediate:Gr.current})).then(function(){return Promise.resolve(Tr({ready:0,immediate:!0})).then(function(){})})}catch(Je){return Promise.reject(Je)}},[Tr,Gr])}}),uo=Oo[0],Ti=Oo[1];gr(function(){Ut&&Ti(a?"OPEN":"CLOSE")},[a,Ti,Ut]),bu(function(){(wi||ki||Vt)&&Ti("RESIZE")},[wi,ki,Vt,Ti]),gr(function(){return function(){Ii.current.deactivate(),rn.current.deactivate(),tn.current.deactivate()}},[tn,rn,Ii]),Hl(s,function(){return{snapTo:function($e,gt){var Je=gt===void 0?{}:gt,Et=Je.velocity,lr=Et===void 0?1:Et,Dt=Je.source,er=Dt===void 0?"custom":Dt;Ti("SNAP",{payload:{y:Rn.current($e),velocity:lr,source:er}})},get height(){return Mi.current}}},[Ti]),gr(function(){var $e=gi.current,gt=function(Et){Ct.current&&Et.preventDefault()},Je=function(Et){$e.scrollTop<0&&(requestAnimationFrame(function(){$e.style.overflow="hidden",$e.scrollTop=0,$e.style.removeProperty("overflow")}),Et.preventDefault())};return wt&&($e.addEventListener("scroll",gt),$e.addEventListener("touchmove",gt),$e.addEventListener("touchstart",Je)),function(){$e.removeEventListener("scroll",gt),$e.removeEventListener("touchmove",gt),$e.removeEventListener("touchstart",Je)}},[wt,gi]);var Vi=MA(function($e){var gt=$e.args,Je=(gt=gt===void 0?[]:gt)[0],Et=(Je=Je===void 0?{}:Je).closeOnTap,lr=Et!==void 0&&Et,Dt=Je.isContentDragging,er=Dt!==void 0&&Dt,tr=$e.cancel,rr=$e.direction[1],vt=$e.down,Ot=$e.first,Br=$e.last,$i=$e.memo,Dr=$i===void 0?En.y.getValue():$i,J=$e.tap,D=$e.velocity,U=-1*$e.movement[1];if(!Zt.current)return tr(),Dr;if(j&&lr&&J)return tr(),setTimeout(function(){return j()},0),Dr;if(J)return Dr;var H=Dr+U,ee=U*D,le=Math.max(Wt.current,Math.min(Cr.current,H+2*ee));if(!vt&&j&&rr>0&&H+ee<Wt.current/2)return tr(),j(),Dr;var de=vt?j||Wt.current!==Cr.current?gu(H,j?0:Wt.current,Cr.current,.55):H<Wt.current?gu(H,Wt.current,2*Cr.current,.55):gu(H,Wt.current/2,Cr.current,.55):le;return wt&&er?(de>=Cr.current&&(de=Cr.current),Dr===Cr.current&&gi.current.scrollTop>0&&(de=Cr.current),Ct.current=de<Cr.current):Ct.current=!1,Ot&&Ti("DRAG"),Br?(Ti("SNAP",{payload:{y:de,velocity:D>.05?D:1,source:"dragging"}}),Dr):(Do({y:de,ready:1,maxHeight:yi.current,maxSnap:Cr.current,minSnap:Wt.current,immediate:!0,config:{velocity:D}}),Dr)},{filterTaps:!0});if(Number.isNaN(Cr.current))throw new TypeError("maxSnapRef is NaN!!");if(Number.isNaN(Wt.current))throw new TypeError("minSnapRef is NaN!!");var ho=function($e){var gt,Je=$e.spring,Et=zl([Je.y,Je.maxHeight],function(vt,Ot){return Math.round(iu(Ot-vt,0,16))+"px"}),lr=zl([Je.y,Je.minSnap,Je.maxSnap],function(vt,Ot,Br){return iu(vt,Ot,Br)+"px"}),Dt=zl([Je.y,Je.minSnap,Je.maxSnap],function(vt,Ot,Br){return vt<Ot?Ot-vt+"px":vt>Br?Br-vt+"px":"0px"}),er=zl([Je.y,Je.maxSnap],function(vt,Ot){return vt>=Ot?Math.ceil(vt-Ot):0}),tr=zl([Je.y,Je.minSnap],function(vt,Ot){if(!Ot)return 0;var Br=Math.max(Ot/2-45,0);return iu((vt-Br)*(1/(Math.min(Ot/2+45,Ot)-Br)+0),0,1)}),rr=zl([Je.y,Je.minSnap],function(vt,Ot){return Ot?iu(vt/Ot,0,1):0});return(gt={})["--rsbs-content-opacity"]=tr,gt["--rsbs-backdrop-opacity"]=rr,gt["--rsbs-antigap-scale-y"]=er,gt["--rsbs-overlay-translate-y"]=Dt,gt["--rsbs-overlay-rounded"]=Et,gt["--rsbs-overlay-h"]=lr,gt}({spring:En});return yn.createElement(ZS.div,Yi({},dr,{"data-rsbs-root":!0,"data-rsbs-state":IC.find(uo.matches),"data-rsbs-is-blocking":E,"data-rsbs-is-dismissable":!!j,"data-rsbs-has-header":!!M,"data-rsbs-has-footer":!!b,className:v,ref:Dn,style:Yi({},ho,Re,{opacity:En.ready})}),m,E&&yn.createElement("div",Yi({key:"backdrop","data-rsbs-backdrop":!0},Vi({closeOnTap:!0}))),yn.createElement("div",{key:"overlay","aria-modal":"true",role:"dialog","data-rsbs-overlay":!0,tabIndex:-1,ref:co,onKeyDown:function($e){$e.key==="Escape"&&($e.stopPropagation(),j&&j())}},M!==!1&&yn.createElement("div",Yi({key:"header","data-rsbs-header":!0,ref:Lo},Vi()),M),yn.createElement("div",Yi({key:"scroll","data-rsbs-scroll":!0,ref:gi},wt?Vi({isContentDragging:!0}):{}),yn.createElement("div",{"data-rsbs-content":!0,ref:lo},h)),b&&yn.createElement("div",Yi({key:"footer",ref:Ro,"data-rsbs-footer":!0},Vi()),b)))}),IC=["closed","opening","open","closing","dragging","snapping","resizing"];function kC(n){var s=n.lastSnap;return s!=null?s:Math.min.apply(Math,n.snapPoints)}function zC(n){return n.minHeight}var PC=["onSpringStart","onSpringEnd","skipInitialTransition"],WC=Mu(function(n,s){var h=n.onSpringStart,m=n.onSpringEnd,v=n.skipInitialTransition,b=Ad(n,PC),M=qn(!1),a=M[0],L=M[1],F=kt(),B=kt(null),j=kt(v&&b.open?"OPEN":"CLOSED");bu(function(){if(b.open)return cancelAnimationFrame(F.current),L(!0),function(){j.current="CLOSED"}},[b.open]);var q=ur(function(he){try{return Promise.resolve(h==null?void 0:h(he)).then(function(){he.type==="OPEN"&&cancelAnimationFrame(F.current)})}catch(be){return Promise.reject(be)}},[h]),G=ur(function(he){try{return Promise.resolve(m==null?void 0:m(he)).then(function(){he.type==="CLOSE"&&(F.current=requestAnimationFrame(function(){return L(!1)}))})}catch(be){return Promise.reject(be)}},[m]);return a?yn.createElement(rE,{"data-rsbs-portal":!0},yn.createElement(MC,Yi({},b,{lastSnapRef:B,ref:s,initialState:j.current,onSpringStart:q,onSpringEnd:G}))):null});function bn(n,s){if(!s)return n;var h=+(Math.round(n+"e+2")+"e-2"),m=h.toString().split(".");return m[0]=m[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),m.join(".")}function wn(n,s){if(n!==s){var h=n==="area"?"an area measurement to a length measurement":"a length measurement to an area measurement";throw new Error(`Invalid conversion. You are trying to convert ${h}.`)}}var Tn={km:.001,km2:1e-6,hm:.01,hm2:1e-4,dam:.1,dam2:.01,m:1,m2:1,dm:10,dm2:100,cm:100,cm2:1e4,mm:1e3,mm2:1e6},um={km:{value:1e3,category:"length"},km2:{value:1e6,category:"area"},hm:{value:100,category:"length"},hm2:{value:1e4,category:"area"},dam:{value:10,category:"length"},dam2:{value:100,category:"area"},m:{value:1,category:"length"},m2:{value:1,category:"area"},dm:{value:.1,category:"length"},dm2:{value:.01,category:"area"},cm:{value:.01,category:"length"},cm2:{value:1e-4,category:"area"},mm:{value:.001,category:"length"},mm2:{value:1e-6,category:"area"}};function _i(n){if(!(this instanceof _i))return new _i(n);this.value=n===0?0:n||1,this.type=um.m}_i.prototype.input=function(n){if(!n in um)throw new Error("type "+n+" is not valid");return this.type=um[n],this};_i.prototype.km=function(){return wn(this.type.category,"length"),bn(this.value*this.type.value*Tn.km,this.prettify)+"km"};_i.prototype.km2=function(){return wn(this.type.category,"area"),bn(this.value*this.type.value*Tn.km2,this.prettify)+"km2"};_i.prototype.hm=function(){return wn(this.type.category,"length"),bn(this.value*this.type.value*Tn.hm,this.prettify)+"hm"};_i.prototype.hm2=function(){return wn(this.type.category,"area"),bn(this.value*this.type.value*Tn.hm2,this.prettify)+"hm2"};_i.prototype.dam=function(){return wn(this.type.category,"length"),bn(this.value*this.type.value*Tn.dam,this.prettify)+"dam"};_i.prototype.dam2=function(){return wn(this.type.category,"area"),bn(this.value*this.type.value*Tn.dam2,this.prettify)+"dam2"};_i.prototype.m=function(){return wn(this.type.category,"length"),bn(this.value*this.type.value*Tn.m,this.prettify)+"m"};_i.prototype.m2=function(){return wn(this.type.category,"area"),bn(this.value*this.type.value*Tn.m2,this.prettify)+"m2"};_i.prototype.dm=function(){return wn(this.type.category,"length"),bn(this.value*this.type.value*Tn.dm,this.prettify)+"dm"};_i.prototype.dm2=function(){return wn(this.type.category,"area"),bn(this.value*this.type.value*Tn.dm2,this.prettify)+"dm2"};_i.prototype.cm=function(){return wn(this.type.category,"length"),bn(this.value*this.type.value*Tn.cm,this.prettify)+"cm"};_i.prototype.cm2=function(){return wn(this.type.category,"area"),bn(this.value*this.type.value*Tn.cm2,this.prettify)+"cm2"};_i.prototype.mm=function(){return wn(this.type.category,"length"),bn(this.value*this.type.value*Tn.mm,this.prettify)+"mm"};_i.prototype.mm2=function(){return wn(this.type.category,"area"),bn(this.value*this.type.value*Tn.mm2,this.prettify)+"mm2"};_i.prototype.humanize=function(){var n=this.type.value*this.value,s=this.type.category;return this.prettify=!0,s==="area"?n>=1e6?this.km2():n>=1?this.m2():n>=.5?this.m2():n>=.1?this.cm2():this.mm2():n>=1e3?this.km():n>=1?this.m():n>=.5?this.m():n>=.1?this.cm():this.mm()};var XC=_i,f0={exports:{}};(function(n){(function(){var s={y:function(E){return E===1?"\u03C7\u03C1\u03CC\u03BD\u03BF\u03C2":"\u03C7\u03C1\u03CC\u03BD\u03B9\u03B1"},mo:function(E){return E===1?"\u03BC\u03AE\u03BD\u03B1\u03C2":"\u03BC\u03AE\u03BD\u03B5\u03C2"},w:function(E){return E===1?"\u03B5\u03B2\u03B4\u03BF\u03BC\u03AC\u03B4\u03B1":"\u03B5\u03B2\u03B4\u03BF\u03BC\u03AC\u03B4\u03B5\u03C2"},d:function(E){return E===1?"\u03BC\u03AD\u03C1\u03B1":"\u03BC\u03AD\u03C1\u03B5\u03C2"},h:function(E){return E===1?"\u03CE\u03C1\u03B1":"\u03CE\u03C1\u03B5\u03C2"},m:function(E){return E===1?"\u03BB\u03B5\u03C0\u03C4\u03CC":"\u03BB\u03B5\u03C0\u03C4\u03AC"},s:function(E){return E===1?"\u03B4\u03B5\u03C5\u03C4\u03B5\u03C1\u03CC\u03BB\u03B5\u03C0\u03C4\u03BF":"\u03B4\u03B5\u03C5\u03C4\u03B5\u03C1\u03CC\u03BB\u03B5\u03C0\u03C4\u03B1"},ms:function(E){return E===1?"\u03C7\u03B9\u03BB\u03B9\u03BF\u03C3\u03C4\u03CC \u03C4\u03BF\u03C5 \u03B4\u03B5\u03C5\u03C4\u03B5\u03C1\u03BF\u03BB\u03AD\u03C0\u03C4\u03BF\u03C5":"\u03C7\u03B9\u03BB\u03B9\u03BF\u03C3\u03C4\u03AC \u03C4\u03BF\u03C5 \u03B4\u03B5\u03C5\u03C4\u03B5\u03C1\u03BF\u03BB\u03AD\u03C0\u03C4\u03BF\u03C5"},decimal:","},h=["\u06F0","\u0661","\u0662","\u0663","\u0664","\u0665","\u0666","\u0667","\u0668","\u0669"],m={af:{y:"jaar",mo:function(E){return"maand"+(E===1?"":"e")},w:function(E){return E===1?"week":"weke"},d:function(E){return E===1?"dag":"dae"},h:function(E){return E===1?"uur":"ure"},m:function(E){return E===1?"minuut":"minute"},s:function(E){return"sekonde"+(E===1?"":"s")},ms:function(E){return"millisekonde"+(E===1?"":"s")},decimal:","},ar:{y:function(E){return["\u0633\u0646\u0629","\u0633\u0646\u062A\u0627\u0646","\u0633\u0646\u0648\u0627\u062A"][B(E)]},mo:function(E){return["\u0634\u0647\u0631","\u0634\u0647\u0631\u0627\u0646","\u0623\u0634\u0647\u0631"][B(E)]},w:function(E){return["\u0623\u0633\u0628\u0648\u0639","\u0623\u0633\u0628\u0648\u0639\u064A\u0646","\u0623\u0633\u0627\u0628\u064A\u0639"][B(E)]},d:function(E){return["\u064A\u0648\u0645","\u064A\u0648\u0645\u064A\u0646","\u0623\u064A\u0627\u0645"][B(E)]},h:function(E){return["\u0633\u0627\u0639\u0629","\u0633\u0627\u0639\u062A\u064A\u0646","\u0633\u0627\u0639\u0627\u062A"][B(E)]},m:function(E){return["\u062F\u0642\u064A\u0642\u0629","\u062F\u0642\u064A\u0642\u062A\u0627\u0646","\u062F\u0642\u0627\u0626\u0642"][B(E)]},s:function(E){return["\u062B\u0627\u0646\u064A\u0629","\u062B\u0627\u0646\u064A\u062A\u0627\u0646","\u062B\u0648\u0627\u0646\u064A"][B(E)]},ms:function(E){return["\u062C\u0632\u0621 \u0645\u0646 \u0627\u0644\u062B\u0627\u0646\u064A\u0629","\u062C\u0632\u0622\u0646 \u0645\u0646 \u0627\u0644\u062B\u0627\u0646\u064A\u0629","\u0623\u062C\u0632\u0627\u0621 \u0645\u0646 \u0627\u0644\u062B\u0627\u0646\u064A\u0629"][B(E)]},decimal:",",delimiter:" \u0648 ",_formatCount:function(E,ye){for(var Le=F(h,{".":ye}),Re=E.toString().split(""),xe=0;xe<Re.length;xe++){var Se=Re[xe];Ie(Le,Se)&&(Re[xe]=Le[Se])}return Re.join("")}},bg:{y:function(E){return["\u0433\u043E\u0434\u0438\u043D\u0438","\u0433\u043E\u0434\u0438\u043D\u0430","\u0433\u043E\u0434\u0438\u043D\u0438"][q(E)]},mo:function(E){return["\u043C\u0435\u0441\u0435\u0446\u0430","\u043C\u0435\u0441\u0435\u0446","\u043C\u0435\u0441\u0435\u0446\u0430"][q(E)]},w:function(E){return["\u0441\u0435\u0434\u043C\u0438\u0446\u0438","\u0441\u0435\u0434\u043C\u0438\u0446\u0430","\u0441\u0435\u0434\u043C\u0438\u0446\u0438"][q(E)]},d:function(E){return["\u0434\u043D\u0438","\u0434\u0435\u043D","\u0434\u043D\u0438"][q(E)]},h:function(E){return["\u0447\u0430\u0441\u0430","\u0447\u0430\u0441","\u0447\u0430\u0441\u0430"][q(E)]},m:function(E){return["\u043C\u0438\u043D\u0443\u0442\u0438","\u043C\u0438\u043D\u0443\u0442\u0430","\u043C\u0438\u043D\u0443\u0442\u0438"][q(E)]},s:function(E){return["\u0441\u0435\u043A\u0443\u043D\u0434\u0438","\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u0441\u0435\u043A\u0443\u043D\u0434\u0438"][q(E)]},ms:function(E){return["\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0438","\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0438"][q(E)]},decimal:","},bn:{y:"\u09AC\u099B\u09B0",mo:"\u09AE\u09BE\u09B8",w:"\u09B8\u09AA\u09CD\u09A4\u09BE\u09B9",d:"\u09A6\u09BF\u09A8",h:"\u0998\u09A8\u09CD\u099F\u09BE",m:"\u09AE\u09BF\u09A8\u09BF\u099F",s:"\u09B8\u09C7\u0995\u09C7\u09A8\u09CD\u09A1",ms:"\u09AE\u09BF\u09B2\u09BF\u09B8\u09C7\u0995\u09C7\u09A8\u09CD\u09A1"},ca:{y:function(E){return"any"+(E===1?"":"s")},mo:function(E){return"mes"+(E===1?"":"os")},w:function(E){return"setman"+(E===1?"a":"es")},d:function(E){return"di"+(E===1?"a":"es")},h:function(E){return"hor"+(E===1?"a":"es")},m:function(E){return"minut"+(E===1?"":"s")},s:function(E){return"segon"+(E===1?"":"s")},ms:function(E){return"milisegon"+(E===1?"":"s")},decimal:","},cs:{y:function(E){return["rok","roku","roky","let"][G(E)]},mo:function(E){return["m\u011Bs\xEDc","m\u011Bs\xEDce","m\u011Bs\xEDce","m\u011Bs\xEDc\u016F"][G(E)]},w:function(E){return["t\xFDden","t\xFDdne","t\xFDdny","t\xFDdn\u016F"][G(E)]},d:function(E){return["den","dne","dny","dn\xED"][G(E)]},h:function(E){return["hodina","hodiny","hodiny","hodin"][G(E)]},m:function(E){return["minuta","minuty","minuty","minut"][G(E)]},s:function(E){return["sekunda","sekundy","sekundy","sekund"][G(E)]},ms:function(E){return["milisekunda","milisekundy","milisekundy","milisekund"][G(E)]},decimal:","},cy:{y:"flwyddyn",mo:"mis",w:"wythnos",d:"diwrnod",h:"awr",m:"munud",s:"eiliad",ms:"milieiliad"},da:{y:"\xE5r",mo:function(E){return"m\xE5ned"+(E===1?"":"er")},w:function(E){return"uge"+(E===1?"":"r")},d:function(E){return"dag"+(E===1?"":"e")},h:function(E){return"time"+(E===1?"":"r")},m:function(E){return"minut"+(E===1?"":"ter")},s:function(E){return"sekund"+(E===1?"":"er")},ms:function(E){return"millisekund"+(E===1?"":"er")},decimal:","},de:{y:function(E){return"Jahr"+(E===1?"":"e")},mo:function(E){return"Monat"+(E===1?"":"e")},w:function(E){return"Woche"+(E===1?"":"n")},d:function(E){return"Tag"+(E===1?"":"e")},h:function(E){return"Stunde"+(E===1?"":"n")},m:function(E){return"Minute"+(E===1?"":"n")},s:function(E){return"Sekunde"+(E===1?"":"n")},ms:function(E){return"Millisekunde"+(E===1?"":"n")},decimal:","},el:s,en:{y:function(E){return"year"+(E===1?"":"s")},mo:function(E){return"month"+(E===1?"":"s")},w:function(E){return"week"+(E===1?"":"s")},d:function(E){return"day"+(E===1?"":"s")},h:function(E){return"hour"+(E===1?"":"s")},m:function(E){return"minute"+(E===1?"":"s")},s:function(E){return"second"+(E===1?"":"s")},ms:function(E){return"millisecond"+(E===1?"":"s")},decimal:"."},eo:{y:function(E){return"jaro"+(E===1?"":"j")},mo:function(E){return"monato"+(E===1?"":"j")},w:function(E){return"semajno"+(E===1?"":"j")},d:function(E){return"tago"+(E===1?"":"j")},h:function(E){return"horo"+(E===1?"":"j")},m:function(E){return"minuto"+(E===1?"":"j")},s:function(E){return"sekundo"+(E===1?"":"j")},ms:function(E){return"milisekundo"+(E===1?"":"j")},decimal:","},es:{y:function(E){return"a\xF1o"+(E===1?"":"s")},mo:function(E){return"mes"+(E===1?"":"es")},w:function(E){return"semana"+(E===1?"":"s")},d:function(E){return"d\xEDa"+(E===1?"":"s")},h:function(E){return"hora"+(E===1?"":"s")},m:function(E){return"minuto"+(E===1?"":"s")},s:function(E){return"segundo"+(E===1?"":"s")},ms:function(E){return"milisegundo"+(E===1?"":"s")},decimal:","},et:{y:function(E){return"aasta"+(E===1?"":"t")},mo:function(E){return"kuu"+(E===1?"":"d")},w:function(E){return"n\xE4dal"+(E===1?"":"at")},d:function(E){return"p\xE4ev"+(E===1?"":"a")},h:function(E){return"tund"+(E===1?"":"i")},m:function(E){return"minut"+(E===1?"":"it")},s:function(E){return"sekund"+(E===1?"":"it")},ms:function(E){return"millisekund"+(E===1?"":"it")},decimal:","},eu:{y:"urte",mo:"hilabete",w:"aste",d:"egun",h:"ordu",m:"minutu",s:"segundo",ms:"milisegundo",decimal:","},fa:{y:"\u0633\u0627\u0644",mo:"\u0645\u0627\u0647",w:"\u0647\u0641\u062A\u0647",d:"\u0631\u0648\u0632",h:"\u0633\u0627\u0639\u062A",m:"\u062F\u0642\u06CC\u0642\u0647",s:"\u062B\u0627\u0646\u06CC\u0647",ms:"\u0645\u06CC\u0644\u06CC \u062B\u0627\u0646\u06CC\u0647",decimal:"."},fi:{y:function(E){return E===1?"vuosi":"vuotta"},mo:function(E){return E===1?"kuukausi":"kuukautta"},w:function(E){return"viikko"+(E===1?"":"a")},d:function(E){return"p\xE4iv\xE4"+(E===1?"":"\xE4")},h:function(E){return"tunti"+(E===1?"":"a")},m:function(E){return"minuutti"+(E===1?"":"a")},s:function(E){return"sekunti"+(E===1?"":"a")},ms:function(E){return"millisekunti"+(E===1?"":"a")},decimal:","},fo:{y:"\xE1r",mo:function(E){return E===1?"m\xE1na\xF0ur":"m\xE1na\xF0ir"},w:function(E){return E===1?"vika":"vikur"},d:function(E){return E===1?"dagur":"dagar"},h:function(E){return E===1?"t\xEDmi":"t\xEDmar"},m:function(E){return E===1?"minuttur":"minuttir"},s:"sekund",ms:"millisekund",decimal:","},fr:{y:function(E){return"an"+(E>=2?"s":"")},mo:"mois",w:function(E){return"semaine"+(E>=2?"s":"")},d:function(E){return"jour"+(E>=2?"s":"")},h:function(E){return"heure"+(E>=2?"s":"")},m:function(E){return"minute"+(E>=2?"s":"")},s:function(E){return"seconde"+(E>=2?"s":"")},ms:function(E){return"milliseconde"+(E>=2?"s":"")},decimal:","},gr:s,he:{y:function(E){return E===1?"\u05E9\u05E0\u05D4":"\u05E9\u05E0\u05D9\u05DD"},mo:function(E){return E===1?"\u05D7\u05D5\u05D3\u05E9":"\u05D7\u05D5\u05D3\u05E9\u05D9\u05DD"},w:function(E){return E===1?"\u05E9\u05D1\u05D5\u05E2":"\u05E9\u05D1\u05D5\u05E2\u05D5\u05EA"},d:function(E){return E===1?"\u05D9\u05D5\u05DD":"\u05D9\u05DE\u05D9\u05DD"},h:function(E){return E===1?"\u05E9\u05E2\u05D4":"\u05E9\u05E2\u05D5\u05EA"},m:function(E){return E===1?"\u05D3\u05E7\u05D4":"\u05D3\u05E7\u05D5\u05EA"},s:function(E){return E===1?"\u05E9\u05E0\u05D9\u05D4":"\u05E9\u05E0\u05D9\u05D5\u05EA"},ms:function(E){return E===1?"\u05DE\u05D9\u05DC\u05D9\u05E9\u05E0\u05D9\u05D9\u05D4":"\u05DE\u05D9\u05DC\u05D9\u05E9\u05E0\u05D9\u05D5\u05EA"},decimal:"."},hr:{y:function(E){return E%10===2||E%10===3||E%10===4?"godine":"godina"},mo:function(E){return E===1?"mjesec":E===2||E===3||E===4?"mjeseca":"mjeseci"},w:function(E){return E%10===1&&E!==11?"tjedan":"tjedna"},d:function(E){return E===1?"dan":"dana"},h:function(E){return E===1?"sat":E===2||E===3||E===4?"sata":"sati"},m:function(E){var ye=E%10;return(ye===2||ye===3||ye===4)&&(E<10||E>14)?"minute":"minuta"},s:function(E){var ye=E%10;return ye===5||Math.floor(E)===E&&E>=10&&E<=19?"sekundi":ye===1?"sekunda":ye===2||ye===3||ye===4?"sekunde":"sekundi"},ms:function(E){return E===1?"milisekunda":E%10===2||E%10===3||E%10===4?"milisekunde":"milisekundi"},decimal:","},hi:{y:"\u0938\u093E\u0932",mo:function(E){return E===1?"\u092E\u0939\u0940\u0928\u093E":"\u092E\u0939\u0940\u0928\u0947"},w:function(E){return E===1?"\u0939\u095E\u094D\u0924\u093E":"\u0939\u092B\u094D\u0924\u0947"},d:"\u0926\u093F\u0928",h:function(E){return E===1?"\u0918\u0902\u091F\u093E":"\u0918\u0902\u091F\u0947"},m:"\u092E\u093F\u0928\u091F",s:"\u0938\u0947\u0915\u0902\u0921",ms:"\u092E\u093F\u0932\u0940\u0938\u0947\u0915\u0902\u0921",decimal:"."},hu:{y:"\xE9v",mo:"h\xF3nap",w:"h\xE9t",d:"nap",h:"\xF3ra",m:"perc",s:"m\xE1sodperc",ms:"ezredm\xE1sodperc",decimal:","},id:{y:"tahun",mo:"bulan",w:"minggu",d:"hari",h:"jam",m:"menit",s:"detik",ms:"milidetik",decimal:"."},is:{y:"\xE1r",mo:function(E){return"m\xE1nu\xF0"+(E===1?"ur":"ir")},w:function(E){return"vik"+(E===1?"a":"ur")},d:function(E){return"dag"+(E===1?"ur":"ar")},h:function(E){return"klukkut\xEDm"+(E===1?"i":"ar")},m:function(E){return"m\xEDn\xFAt"+(E===1?"a":"ur")},s:function(E){return"sek\xFAnd"+(E===1?"a":"ur")},ms:function(E){return"millisek\xFAnd"+(E===1?"a":"ur")},decimal:"."},it:{y:function(E){return"ann"+(E===1?"o":"i")},mo:function(E){return"mes"+(E===1?"e":"i")},w:function(E){return"settiman"+(E===1?"a":"e")},d:function(E){return"giorn"+(E===1?"o":"i")},h:function(E){return"or"+(E===1?"a":"e")},m:function(E){return"minut"+(E===1?"o":"i")},s:function(E){return"second"+(E===1?"o":"i")},ms:function(E){return"millisecond"+(E===1?"o":"i")},decimal:","},ja:{y:"\u5E74",mo:"\u30F6\u6708",w:"\u9031",d:"\u65E5",h:"\u6642\u9593",m:"\u5206",s:"\u79D2",ms:"\u30DF\u30EA\u79D2",decimal:"."},km:{y:"\u1786\u17D2\u1793\u17B6\u17C6",mo:"\u1781\u17C2",w:"\u179F\u1794\u17D2\u178F\u17B6\u17A0\u17CD",d:"\u1790\u17D2\u1784\u17C3",h:"\u1798\u17C9\u17C4\u1784",m:"\u1793\u17B6\u1791\u17B8",s:"\u179C\u17B7\u1793\u17B6\u1791\u17B8",ms:"\u1798\u17B7\u179B\u17D2\u179B\u17B8\u179C\u17B7\u1793\u17B6\u1791\u17B8"},kn:{y:function(E){return E===1?"\u0CB5\u0CB0\u0CCD\u0CB7":"\u0CB5\u0CB0\u0CCD\u0CB7\u0C97\u0CB3\u0CC1"},mo:function(E){return E===1?"\u0CA4\u0CBF\u0C82\u0C97\u0CB3\u0CC1":"\u0CA4\u0CBF\u0C82\u0C97\u0CB3\u0CC1\u0C97\u0CB3\u0CC1"},w:function(E){return E===1?"\u0CB5\u0CBE\u0CB0":"\u0CB5\u0CBE\u0CB0\u0C97\u0CB3\u0CC1"},d:function(E){return E===1?"\u0CA6\u0CBF\u0CA8":"\u0CA6\u0CBF\u0CA8\u0C97\u0CB3\u0CC1"},h:function(E){return E===1?"\u0C97\u0C82\u0C9F\u0CC6":"\u0C97\u0C82\u0C9F\u0CC6\u0C97\u0CB3\u0CC1"},m:function(E){return E===1?"\u0CA8\u0CBF\u0CAE\u0CBF\u0CB7":"\u0CA8\u0CBF\u0CAE\u0CBF\u0CB7\u0C97\u0CB3\u0CC1"},s:function(E){return E===1?"\u0CB8\u0CC6\u0C95\u0CC6\u0C82\u0CA1\u0CCD":"\u0CB8\u0CC6\u0C95\u0CC6\u0C82\u0CA1\u0CC1\u0C97\u0CB3\u0CC1"},ms:function(E){return E===1?"\u0CAE\u0CBF\u0CB2\u0CBF\u0CB8\u0CC6\u0C95\u0CC6\u0C82\u0CA1\u0CCD":"\u0CAE\u0CBF\u0CB2\u0CBF\u0CB8\u0CC6\u0C95\u0CC6\u0C82\u0CA1\u0CC1\u0C97\u0CB3\u0CC1"}},ko:{y:"\uB144",mo:"\uAC1C\uC6D4",w:"\uC8FC\uC77C",d:"\uC77C",h:"\uC2DC\uAC04",m:"\uBD84",s:"\uCD08",ms:"\uBC00\uB9AC \uCD08",decimal:"."},ku:{y:"sal",mo:"meh",w:"hefte",d:"roj",h:"seet",m:"deqe",s:"saniye",ms:"m\xEEl\xEE\xE7irk",decimal:","},lo:{y:"\u0E9B\u0EB5",mo:"\u0EC0\u0E94\u0EB7\u0EAD\u0E99",w:"\u0EAD\u0EB2\u0E97\u0EB4\u0E94",d:"\u0EA1\u0EB7\u0EC9",h:"\u0E8A\u0EBB\u0EC8\u0EA7\u0EC2\u0EA1\u0E87",m:"\u0E99\u0EB2\u0E97\u0EB5",s:"\u0EA7\u0EB4\u0E99\u0EB2\u0E97\u0EB5",ms:"\u0EA1\u0EB4\u0E99\u0EA5\u0EB4\u0EA7\u0EB4\u0E99\u0EB2\u0E97\u0EB5",decimal:","},lt:{y:function(E){return E%10===0||E%100>=10&&E%100<=20?"met\u0173":"metai"},mo:function(E){return["m\u0117nuo","m\u0117nesiai","m\u0117nesi\u0173"][he(E)]},w:function(E){return["savait\u0117","savait\u0117s","savai\u010Di\u0173"][he(E)]},d:function(E){return["diena","dienos","dien\u0173"][he(E)]},h:function(E){return["valanda","valandos","valand\u0173"][he(E)]},m:function(E){return["minut\u0117","minut\u0117s","minu\u010Di\u0173"][he(E)]},s:function(E){return["sekund\u0117","sekund\u0117s","sekund\u017Ei\u0173"][he(E)]},ms:function(E){return["milisekund\u0117","milisekund\u0117s","milisekund\u017Ei\u0173"][he(E)]},decimal:","},lv:{y:function(E){return be(E)?"gads":"gadi"},mo:function(E){return be(E)?"m\u0113nesis":"m\u0113ne\u0161i"},w:function(E){return be(E)?"ned\u0113\u013Ca":"ned\u0113\u013Cas"},d:function(E){return be(E)?"diena":"dienas"},h:function(E){return be(E)?"stunda":"stundas"},m:function(E){return be(E)?"min\u016Bte":"min\u016Btes"},s:function(E){return be(E)?"sekunde":"sekundes"},ms:function(E){return be(E)?"milisekunde":"milisekundes"},decimal:","},mk:{y:function(E){return E===1?"\u0433\u043E\u0434\u0438\u043D\u0430":"\u0433\u043E\u0434\u0438\u043D\u0438"},mo:function(E){return E===1?"\u043C\u0435\u0441\u0435\u0446":"\u043C\u0435\u0441\u0435\u0446\u0438"},w:function(E){return E===1?"\u043D\u0435\u0434\u0435\u043B\u0430":"\u043D\u0435\u0434\u0435\u043B\u0438"},d:function(E){return E===1?"\u0434\u0435\u043D":"\u0434\u0435\u043D\u0430"},h:function(E){return E===1?"\u0447\u0430\u0441":"\u0447\u0430\u0441\u0430"},m:function(E){return E===1?"\u043C\u0438\u043D\u0443\u0442\u0430":"\u043C\u0438\u043D\u0443\u0442\u0438"},s:function(E){return E===1?"\u0441\u0435\u043A\u0443\u043D\u0434\u0430":"\u0441\u0435\u043A\u0443\u043D\u0434\u0438"},ms:function(E){return E===1?"\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0430":"\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0438"},decimal:","},mr:{y:function(E){return E===1?"\u0935\u0930\u094D\u0937":"\u0935\u0930\u094D\u0937\u0947"},mo:function(E){return E===1?"\u092E\u0939\u093F\u0928\u093E":"\u092E\u0939\u093F\u0928\u0947"},w:function(E){return E===1?"\u0906\u0920\u0935\u0921\u093E":"\u0906\u0920\u0935\u0921\u0947"},d:"\u0926\u093F\u0935\u0938",h:"\u0924\u093E\u0938",m:function(E){return E===1?"\u092E\u093F\u0928\u093F\u091F":"\u092E\u093F\u0928\u093F\u091F\u0947"},s:"\u0938\u0947\u0915\u0902\u0926",ms:"\u092E\u093F\u0932\u093F\u0938\u0947\u0915\u0902\u0926"},ms:{y:"tahun",mo:"bulan",w:"minggu",d:"hari",h:"jam",m:"minit",s:"saat",ms:"milisaat",decimal:"."},nl:{y:"jaar",mo:function(E){return E===1?"maand":"maanden"},w:function(E){return E===1?"week":"weken"},d:function(E){return E===1?"dag":"dagen"},h:"uur",m:function(E){return E===1?"minuut":"minuten"},s:function(E){return E===1?"seconde":"seconden"},ms:function(E){return E===1?"milliseconde":"milliseconden"},decimal:","},no:{y:"\xE5r",mo:function(E){return"m\xE5ned"+(E===1?"":"er")},w:function(E){return"uke"+(E===1?"":"r")},d:function(E){return"dag"+(E===1?"":"er")},h:function(E){return"time"+(E===1?"":"r")},m:function(E){return"minutt"+(E===1?"":"er")},s:function(E){return"sekund"+(E===1?"":"er")},ms:function(E){return"millisekund"+(E===1?"":"er")},decimal:","},pl:{y:function(E){return["rok","roku","lata","lat"][j(E)]},mo:function(E){return["miesi\u0105c","miesi\u0105ca","miesi\u0105ce","miesi\u0119cy"][j(E)]},w:function(E){return["tydzie\u0144","tygodnia","tygodnie","tygodni"][j(E)]},d:function(E){return["dzie\u0144","dnia","dni","dni"][j(E)]},h:function(E){return["godzina","godziny","godziny","godzin"][j(E)]},m:function(E){return["minuta","minuty","minuty","minut"][j(E)]},s:function(E){return["sekunda","sekundy","sekundy","sekund"][j(E)]},ms:function(E){return["milisekunda","milisekundy","milisekundy","milisekund"][j(E)]},decimal:","},pt:{y:function(E){return"ano"+(E===1?"":"s")},mo:function(E){return E===1?"m\xEAs":"meses"},w:function(E){return"semana"+(E===1?"":"s")},d:function(E){return"dia"+(E===1?"":"s")},h:function(E){return"hora"+(E===1?"":"s")},m:function(E){return"minuto"+(E===1?"":"s")},s:function(E){return"segundo"+(E===1?"":"s")},ms:function(E){return"milissegundo"+(E===1?"":"s")},decimal:","},ro:{y:function(E){return E===1?"an":"ani"},mo:function(E){return E===1?"lun\u0103":"luni"},w:function(E){return E===1?"s\u0103pt\u0103m\xE2n\u0103":"s\u0103pt\u0103m\xE2ni"},d:function(E){return E===1?"zi":"zile"},h:function(E){return E===1?"or\u0103":"ore"},m:function(E){return E===1?"minut":"minute"},s:function(E){return E===1?"secund\u0103":"secunde"},ms:function(E){return E===1?"milisecund\u0103":"milisecunde"},decimal:","},ru:{y:function(E){return["\u043B\u0435\u0442","\u0433\u043E\u0434","\u0433\u043E\u0434\u0430"][q(E)]},mo:function(E){return["\u043C\u0435\u0441\u044F\u0446\u0435\u0432","\u043C\u0435\u0441\u044F\u0446","\u043C\u0435\u0441\u044F\u0446\u0430"][q(E)]},w:function(E){return["\u043D\u0435\u0434\u0435\u043B\u044C","\u043D\u0435\u0434\u0435\u043B\u044F","\u043D\u0435\u0434\u0435\u043B\u0438"][q(E)]},d:function(E){return["\u0434\u043D\u0435\u0439","\u0434\u0435\u043D\u044C","\u0434\u043D\u044F"][q(E)]},h:function(E){return["\u0447\u0430\u0441\u043E\u0432","\u0447\u0430\u0441","\u0447\u0430\u0441\u0430"][q(E)]},m:function(E){return["\u043C\u0438\u043D\u0443\u0442","\u043C\u0438\u043D\u0443\u0442\u0430","\u043C\u0438\u043D\u0443\u0442\u044B"][q(E)]},s:function(E){return["\u0441\u0435\u043A\u0443\u043D\u0434","\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u0441\u0435\u043A\u0443\u043D\u0434\u044B"][q(E)]},ms:function(E){return["\u043C\u0438\u043B\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434","\u043C\u0438\u043B\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u043C\u0438\u043B\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u044B"][q(E)]},decimal:","},sq:{y:function(E){return E===1?"vit":"vjet"},mo:"muaj",w:"jav\xEB",d:"dit\xEB",h:"or\xEB",m:function(E){return"minut"+(E===1?"\xEB":"a")},s:function(E){return"sekond"+(E===1?"\xEB":"a")},ms:function(E){return"milisekond"+(E===1?"\xEB":"a")},decimal:","},sr:{y:function(E){return["\u0433\u043E\u0434\u0438\u043D\u0438","\u0433\u043E\u0434\u0438\u043D\u0430","\u0433\u043E\u0434\u0438\u043D\u0435"][q(E)]},mo:function(E){return["\u043C\u0435\u0441\u0435\u0446\u0438","\u043C\u0435\u0441\u0435\u0446","\u043C\u0435\u0441\u0435\u0446\u0430"][q(E)]},w:function(E){return["\u043D\u0435\u0434\u0435\u0459\u0438","\u043D\u0435\u0434\u0435\u0459\u0430","\u043D\u0435\u0434\u0435\u0459\u0435"][q(E)]},d:function(E){return["\u0434\u0430\u043D\u0438","\u0434\u0430\u043D","\u0434\u0430\u043D\u0430"][q(E)]},h:function(E){return["\u0441\u0430\u0442\u0438","\u0441\u0430\u0442","\u0441\u0430\u0442\u0430"][q(E)]},m:function(E){return["\u043C\u0438\u043D\u0443\u0442\u0430","\u043C\u0438\u043D\u0443\u0442","\u043C\u0438\u043D\u0443\u0442\u0430"][q(E)]},s:function(E){return["\u0441\u0435\u043A\u0443\u043D\u0434\u0438","\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u0441\u0435\u043A\u0443\u043D\u0434\u0435"][q(E)]},ms:function(E){return["\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0438","\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u043C\u0438\u043B\u0438\u0441\u0435\u043A\u0443\u043D\u0434\u0435"][q(E)]},decimal:","},ta:{y:function(E){return E===1?"\u0BB5\u0BB0\u0BC1\u0B9F\u0BAE\u0BCD":"\u0B86\u0BA3\u0BCD\u0B9F\u0BC1\u0B95\u0BB3\u0BCD"},mo:function(E){return E===1?"\u0BAE\u0BBE\u0BA4\u0BAE\u0BCD":"\u0BAE\u0BBE\u0BA4\u0B99\u0BCD\u0B95\u0BB3\u0BCD"},w:function(E){return E===1?"\u0BB5\u0BBE\u0BB0\u0BAE\u0BCD":"\u0BB5\u0BBE\u0BB0\u0B99\u0BCD\u0B95\u0BB3\u0BCD"},d:function(E){return E===1?"\u0BA8\u0BBE\u0BB3\u0BCD":"\u0BA8\u0BBE\u0B9F\u0BCD\u0B95\u0BB3\u0BCD"},h:function(E){return E===1?"\u0BAE\u0BA3\u0BBF":"\u0BAE\u0BA3\u0BBF\u0BA8\u0BC7\u0BB0\u0BAE\u0BCD"},m:function(E){return"\u0BA8\u0BBF\u0BAE\u0BBF\u0B9F"+(E===1?"\u0BAE\u0BCD":"\u0B99\u0BCD\u0B95\u0BB3\u0BCD")},s:function(E){return"\u0BB5\u0BBF\u0BA9\u0BBE\u0B9F\u0BBF"+(E===1?"":"\u0B95\u0BB3\u0BCD")},ms:function(E){return"\u0BAE\u0BBF\u0BB2\u0BCD\u0BB2\u0BBF \u0BB5\u0BBF\u0BA8\u0BBE\u0B9F\u0BBF"+(E===1?"":"\u0B95\u0BB3\u0BCD")}},te:{y:function(E){return"\u0C38\u0C02\u0C35\u0C24\u0C4D\u0C38"+(E===1?"\u0C30\u0C02":"\u0C30\u0C3E\u0C32")},mo:function(E){return"\u0C28\u0C46\u0C32"+(E===1?"":"\u0C32")},w:function(E){return E===1?"\u0C35\u0C3E\u0C30\u0C02":"\u0C35\u0C3E\u0C30\u0C3E\u0C32\u0C41"},d:function(E){return"\u0C30\u0C4B\u0C1C\u0C41"+(E===1?"":"\u0C32\u0C41")},h:function(E){return"\u0C17\u0C02\u0C1F"+(E===1?"":"\u0C32\u0C41")},m:function(E){return E===1?"\u0C28\u0C3F\u0C2E\u0C3F\u0C37\u0C02":"\u0C28\u0C3F\u0C2E\u0C3F\u0C37\u0C3E\u0C32\u0C41"},s:function(E){return E===1?"\u0C38\u0C46\u0C15\u0C28\u0C41":"\u0C38\u0C46\u0C15\u0C28\u0C4D\u0C32\u0C41"},ms:function(E){return E===1?"\u0C2E\u0C3F\u0C32\u0C4D\u0C32\u0C40\u0C38\u0C46\u0C15\u0C28\u0C4D":"\u0C2E\u0C3F\u0C32\u0C4D\u0C32\u0C40\u0C38\u0C46\u0C15\u0C28\u0C4D\u0C32\u0C41"}},uk:{y:function(E){return["\u0440\u043E\u043A\u0456\u0432","\u0440\u0456\u043A","\u0440\u043E\u043A\u0438"][q(E)]},mo:function(E){return["\u043C\u0456\u0441\u044F\u0446\u0456\u0432","\u043C\u0456\u0441\u044F\u0446\u044C","\u043C\u0456\u0441\u044F\u0446\u0456"][q(E)]},w:function(E){return["\u0442\u0438\u0436\u043D\u0456\u0432","\u0442\u0438\u0436\u0434\u0435\u043D\u044C","\u0442\u0438\u0436\u043D\u0456"][q(E)]},d:function(E){return["\u0434\u043D\u0456\u0432","\u0434\u0435\u043D\u044C","\u0434\u043D\u0456"][q(E)]},h:function(E){return["\u0433\u043E\u0434\u0438\u043D","\u0433\u043E\u0434\u0438\u043D\u0430","\u0433\u043E\u0434\u0438\u043D\u0438"][q(E)]},m:function(E){return["\u0445\u0432\u0438\u043B\u0438\u043D","\u0445\u0432\u0438\u043B\u0438\u043D\u0430","\u0445\u0432\u0438\u043B\u0438\u043D\u0438"][q(E)]},s:function(E){return["\u0441\u0435\u043A\u0443\u043D\u0434","\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u0441\u0435\u043A\u0443\u043D\u0434\u0438"][q(E)]},ms:function(E){return["\u043C\u0456\u043B\u0456\u0441\u0435\u043A\u0443\u043D\u0434","\u043C\u0456\u043B\u0456\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u043C\u0456\u043B\u0456\u0441\u0435\u043A\u0443\u043D\u0434\u0438"][q(E)]},decimal:","},ur:{y:"\u0633\u0627\u0644",mo:function(E){return E===1?"\u0645\u06C1\u06CC\u0646\u06C1":"\u0645\u06C1\u06CC\u0646\u06D2"},w:function(E){return E===1?"\u06C1\u0641\u062A\u06C1":"\u06C1\u0641\u062A\u06D2"},d:"\u062F\u0646",h:function(E){return E===1?"\u06AF\u06BE\u0646\u0679\u06C1":"\u06AF\u06BE\u0646\u0679\u06D2"},m:"\u0645\u0646\u0679",s:"\u0633\u06CC\u06A9\u0646\u0688",ms:"\u0645\u0644\u06CC \u0633\u06CC\u06A9\u0646\u0688",decimal:"."},sk:{y:function(E){return["rok","roky","roky","rokov"][G(E)]},mo:function(E){return["mesiac","mesiace","mesiace","mesiacov"][G(E)]},w:function(E){return["t\xFD\u017Ede\u0148","t\xFD\u017Edne","t\xFD\u017Edne","t\xFD\u017Ed\u0148ov"][G(E)]},d:function(E){return["de\u0148","dni","dni","dn\xED"][G(E)]},h:function(E){return["hodina","hodiny","hodiny","hod\xEDn"][G(E)]},m:function(E){return["min\xFAta","min\xFAty","min\xFAty","min\xFAt"][G(E)]},s:function(E){return["sekunda","sekundy","sekundy","sek\xFAnd"][G(E)]},ms:function(E){return["milisekunda","milisekundy","milisekundy","milisek\xFAnd"][G(E)]},decimal:","},sl:{y:function(E){return E%10===1?"leto":E%100===2?"leti":E%100===3||E%100===4||Math.floor(E)!==E&&E%100<=5?"leta":"let"},mo:function(E){return E%10===1?"mesec":E%100===2||Math.floor(E)!==E&&E%100<=5?"meseca":E%10===3||E%10===4?"mesece":"mesecev"},w:function(E){return E%10===1?"teden":E%10===2||Math.floor(E)!==E&&E%100<=4?"tedna":E%10===3||E%10===4?"tedne":"tednov"},d:function(E){return E%100===1?"dan":"dni"},h:function(E){return E%10===1?"ura":E%100===2?"uri":E%10===3||E%10===4||Math.floor(E)!==E?"ure":"ur"},m:function(E){return E%10===1?"minuta":E%10===2?"minuti":E%10===3||E%10===4||Math.floor(E)!==E&&E%100<=4?"minute":"minut"},s:function(E){return E%10===1?"sekunda":E%100===2?"sekundi":E%100===3||E%100===4||Math.floor(E)!==E?"sekunde":"sekund"},ms:function(E){return E%10===1?"milisekunda":E%100===2?"milisekundi":E%100===3||E%100===4||Math.floor(E)!==E?"milisekunde":"milisekund"},decimal:","},sv:{y:"\xE5r",mo:function(E){return"m\xE5nad"+(E===1?"":"er")},w:function(E){return"veck"+(E===1?"a":"or")},d:function(E){return"dag"+(E===1?"":"ar")},h:function(E){return"timm"+(E===1?"e":"ar")},m:function(E){return"minut"+(E===1?"":"er")},s:function(E){return"sekund"+(E===1?"":"er")},ms:function(E){return"millisekund"+(E===1?"":"er")},decimal:","},sw:{y:function(E){return E===1?"mwaka":"miaka"},mo:function(E){return E===1?"mwezi":"miezi"},w:"wiki",d:function(E){return E===1?"siku":"masiku"},h:function(E){return E===1?"saa":"masaa"},m:"dakika",s:"sekunde",ms:"milisekunde",decimal:"."},tr:{y:"y\u0131l",mo:"ay",w:"hafta",d:"g\xFCn",h:"saat",m:"dakika",s:"saniye",ms:"milisaniye",decimal:","},th:{y:"\u0E1B\u0E35",mo:"\u0E40\u0E14\u0E37\u0E2D\u0E19",w:"\u0E2A\u0E31\u0E1B\u0E14\u0E32\u0E2B\u0E4C",d:"\u0E27\u0E31\u0E19",h:"\u0E0A\u0E31\u0E48\u0E27\u0E42\u0E21\u0E07",m:"\u0E19\u0E32\u0E17\u0E35",s:"\u0E27\u0E34\u0E19\u0E32\u0E17\u0E35",ms:"\u0E21\u0E34\u0E25\u0E25\u0E34\u0E27\u0E34\u0E19\u0E32\u0E17\u0E35",decimal:"."},vi:{y:"n\u0103m",mo:"th\xE1ng",w:"tu\u1EA7n",d:"ng\xE0y",h:"gi\u1EDD",m:"ph\xFAt",s:"gi\xE2y",ms:"mili gi\xE2y",decimal:","},zh_CN:{y:"\u5E74",mo:"\u4E2A\u6708",w:"\u5468",d:"\u5929",h:"\u5C0F\u65F6",m:"\u5206\u949F",s:"\u79D2",ms:"\u6BEB\u79D2",decimal:"."},zh_TW:{y:"\u5E74",mo:"\u500B\u6708",w:"\u5468",d:"\u5929",h:"\u5C0F\u6642",m:"\u5206\u9418",s:"\u79D2",ms:"\u6BEB\u79D2",decimal:"."}};function v(E){var ye=function(Re,xe){var Se=F({},ye,xe||{});return a(Re,Se)};return F(ye,{language:"en",spacer:" ",conjunction:"",serialComma:!0,units:["y","mo","w","d","h","m","s"],languages:{},round:!1,unitMeasures:{y:315576e5,mo:26298e5,w:6048e5,d:864e5,h:36e5,m:6e4,s:1e3,ms:1}},E)}var b=v({});function M(E){var ye=[E.language];if(Ie(E,"fallbacks"))if(we(E.fallbacks)&&E.fallbacks.length)ye=ye.concat(E.fallbacks);else throw new Error("fallbacks must be an array with at least one element");for(var Le=0;Le<ye.length;Le++){var Re=ye[Le];if(Ie(E.languages,Re))return E.languages[Re];if(Ie(m,Re))return m[Re]}throw new Error("No language found.")}function a(E,ye){var Le,Re,xe;E=Math.abs(E);var Se=M(ye),Be=[],Ye,it,at;for(Le=0,Re=ye.units.length;Le<Re;Le++){if(Ye=ye.units[Le],it=ye.unitMeasures[Ye],Le+1===Re)if(Ie(ye,"maxDecimalPoints")){var wt=Math.pow(10,ye.maxDecimalPoints),dr=E/it;at=parseFloat((Math.floor(wt*dr)/wt).toFixed(ye.maxDecimalPoints))}else at=E/it;else at=Math.floor(E/it);Be.push({unitCount:at,unitName:Ye}),E-=at*it}var Sr=0;for(Le=0;Le<Be.length;Le++)if(Be[Le].unitCount){Sr=Le;break}if(ye.round){var Ut,$r;for(Le=Be.length-1;Le>=0&&(xe=Be[Le],xe.unitCount=Math.round(xe.unitCount),Le!==0);Le--)$r=Be[Le-1],Ut=ye.unitMeasures[$r.unitName]/ye.unitMeasures[xe.unitName],(xe.unitCount%Ut===0||ye.largest&&ye.largest-1<Le-Sr)&&($r.unitCount+=xe.unitCount/Ut,xe.unitCount=0)}var Zt=[];for(Le=0,Be.length;Le<Re&&(xe=Be[Le],xe.unitCount&&Zt.push(L(xe.unitCount,xe.unitName,Se,ye)),Zt.length!==ye.largest);Le++);if(Zt.length){var At;if(Ie(ye,"delimiter")?At=ye.delimiter:Ie(Se,"delimiter")?At=Se.delimiter:At=", ",!ye.conjunction||Zt.length===1)return Zt.join(At);if(Zt.length===2)return Zt.join(ye.conjunction);if(Zt.length>2)return Zt.slice(0,-1).join(At)+(ye.serialComma?",":"")+ye.conjunction+Zt.slice(-1)}else return L(0,ye.units[ye.units.length-1],Se,ye)}function L(E,ye,Le,Re){var xe;Ie(Re,"decimal")?xe=Re.decimal:Ie(Le,"decimal")?xe=Le.decimal:xe=".";var Se;typeof Le._formatCount=="function"?Se=Le._formatCount(E,xe):Se=E.toString().replace(".",xe);var Be=Le[ye],Ye;return typeof Be=="function"?Ye=Be(E):Ye=Be,Se+Re.spacer+Ye}function F(E){for(var ye,Le=1;Le<arguments.length;Le++){ye=arguments[Le];for(var Re in ye)Ie(ye,Re)&&(E[Re]=ye[Re])}return E}function B(E){return E===1?0:E===2?1:E>2&&E<11?2:0}function j(E){return E===1?0:Math.floor(E)!==E?1:E%10>=2&&E%10<=4&&!(E%100>10&&E%100<20)?2:3}function q(E){return Math.floor(E)!==E?2:E%100>=5&&E%100<=20||E%10>=5&&E%10<=9||E%10===0?0:E%10===1?1:E>1?2:0}function G(E){return E===1?0:Math.floor(E)!==E?1:E%10>=2&&E%10<=4&&E%100<10?2:3}function he(E){return E===1||E%10===1&&E%100>20?0:Math.floor(E)!==E||E%10>=2&&E%100>20||E%10>=2&&E%100<10?1:2}function be(E){return E%10===1&&E%100!==11}var we=Array.isArray||function(E){return Object.prototype.toString.call(E)==="[object Array]"};function Ie(E,ye){return Object.prototype.hasOwnProperty.call(E,ye)}b.getSupportedLanguages=function(){var ye=[];for(var Le in m)Ie(m,Le)&&Le!=="gr"&&ye.push(Le);return ye},b.humanizer=v,n.exports?n.exports=b:this.humanizeDuration=b})()})(f0);var HC=f0.exports,DC=Av(Vb),LC,RC,OC,hm=DC,BC=0;function av(n,s,h,m,v){var b,M,a={};for(M in s)M=="ref"?b=s[M]:a[M]=s[M];var L={type:n,props:a,key:h,ref:b,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--BC,__source:m,__self:v};if(typeof n=="function"&&(b=n.defaultProps))for(M in b)a[M]===void 0&&(a[M]=b[M]);return hm.options.vnode&&hm.options.vnode(L),L}OC=hm.Fragment,RC=av,LC=av;export{ZC as A,OC as F,jC as G,WC as J,GC as L,Lv as M,VC as N,$C as S,LC as a,UC as b,NC as c,en as d,qC as e,jl as f,HC as h,RC as j,qn as l,Gb as m,XC as p,kt as s,Iu as u,gr as y};
//# sourceMappingURL=vendor.ca7819ad.js.map
